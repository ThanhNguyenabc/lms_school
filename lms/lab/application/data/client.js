/*!
 * Chart.js v3.7.0
 * https://www.chartjs.org
 * (c) 2021 Chart.js Contributors
 * Released under the MIT License
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Chart=e()}(this,(function(){"use strict";const t="undefined"==typeof window?function(t){return t()}:window.requestAnimationFrame;function e(e,i,s){const n=s||(t=>Array.prototype.slice.call(t));let o=!1,a=[];return function(...s){a=n(s),o||(o=!0,t.call(window,(()=>{o=!1,e.apply(i,a)})))}}function i(t,e){let i;return function(...s){return e?(clearTimeout(i),i=setTimeout(t,e,s)):t.apply(this,s),e}}const s=t=>"start"===t?"left":"end"===t?"right":"center",n=(t,e,i)=>"start"===t?e:"end"===t?i:(e+i)/2,o=(t,e,i,s)=>t===(s?"left":"right")?i:"center"===t?(e+i)/2:e;var a=new class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,i,s){const n=e.listeners[s],o=e.duration;n.forEach((s=>s({chart:t,initial:e.initial,numSteps:o,currentStep:Math.min(i-e.start,o)})))}_refresh(){this._request||(this._running=!0,this._request=t.call(window,(()=>{this._update(),this._request=null,this._running&&this._refresh()})))}_update(t=Date.now()){let e=0;this._charts.forEach(((i,s)=>{if(!i.running||!i.items.length)return;const n=i.items;let o,a=n.length-1,r=!1;for(;a>=0;--a)o=n[a],o._active?(o._total>i.duration&&(i.duration=o._total),o.tick(t),r=!0):(n[a]=n[n.length-1],n.pop());r&&(s.draw(),this._notify(s,i,t,"progress")),n.length||(i.running=!1,this._notify(s,i,t,"complete"),i.initial=!1),e+=n.length})),this._lastDate=t,0===e&&(this._running=!1)}_getAnims(t){const e=this._charts;let i=e.get(t);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,i)),i}listen(t,e,i){this._getAnims(t).listeners[e].push(i)}add(t,e){e&&e.length&&this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce(((t,e)=>Math.max(t,e._duration)),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!!(e&&e.running&&e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const i=e.items;let s=i.length-1;for(;s>=0;--s)i[s].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}};
/*!
 * @kurkle/color v0.1.9
 * https://github.com/kurkle/color#readme
 * (c) 2020 Jukka Kurkela
 * Released under the MIT License
 */const r={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},l="0123456789ABCDEF",h=t=>l[15&t],c=t=>l[(240&t)>>4]+l[15&t],d=t=>(240&t)>>4==(15&t);function u(t){var e=function(t){return d(t.r)&&d(t.g)&&d(t.b)&&d(t.a)}(t)?h:c;return t?"#"+e(t.r)+e(t.g)+e(t.b)+(t.a<255?e(t.a):""):t}function f(t){return t+.5|0}const g=(t,e,i)=>Math.max(Math.min(t,i),e);function p(t){return g(f(2.55*t),0,255)}function m(t){return g(f(255*t),0,255)}function x(t){return g(f(t/2.55)/100,0,1)}function b(t){return g(f(100*t),0,100)}const _=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;const y=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function v(t,e,i){const s=e*Math.min(i,1-i),n=(e,n=(e+t/30)%12)=>i-s*Math.max(Math.min(n-3,9-n,1),-1);return[n(0),n(8),n(4)]}function w(t,e,i){const s=(s,n=(s+t/60)%6)=>i-i*e*Math.max(Math.min(n,4-n,1),0);return[s(5),s(3),s(1)]}function M(t,e,i){const s=v(t,1,.5);let n;for(e+i>1&&(n=1/(e+i),e*=n,i*=n),n=0;n<3;n++)s[n]*=1-e-i,s[n]+=e;return s}function k(t){const e=t.r/255,i=t.g/255,s=t.b/255,n=Math.max(e,i,s),o=Math.min(e,i,s),a=(n+o)/2;let r,l,h;return n!==o&&(h=n-o,l=a>.5?h/(2-n-o):h/(n+o),r=n===e?(i-s)/h+(i<s?6:0):n===i?(s-e)/h+2:(e-i)/h+4,r=60*r+.5),[0|r,l||0,a]}function S(t,e,i,s){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,i,s)).map(m)}function P(t,e,i){return S(v,t,e,i)}function D(t){return(t%360+360)%360}function C(t){const e=y.exec(t);let i,s=255;if(!e)return;e[5]!==i&&(s=e[6]?p(+e[5]):m(+e[5]));const n=D(+e[2]),o=+e[3]/100,a=+e[4]/100;return i="hwb"===e[1]?function(t,e,i){return S(M,t,e,i)}(n,o,a):"hsv"===e[1]?function(t,e,i){return S(w,t,e,i)}(n,o,a):P(n,o,a),{r:i[0],g:i[1],b:i[2],a:s}}const O={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},A={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let T;function L(t){T||(T=function(){const t={},e=Object.keys(A),i=Object.keys(O);let s,n,o,a,r;for(s=0;s<e.length;s++){for(a=r=e[s],n=0;n<i.length;n++)o=i[n],r=r.replace(o,O[o]);o=parseInt(A[a],16),t[r]=[o>>16&255,o>>8&255,255&o]}return t}(),T.transparent=[0,0,0,0]);const e=T[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:4===e.length?e[3]:255}}function R(t,e,i){if(t){let s=k(t);s[e]=Math.max(0,Math.min(s[e]+s[e]*i,0===e?360:1)),s=P(s),t.r=s[0],t.g=s[1],t.b=s[2]}}function E(t,e){return t?Object.assign(e||{},t):t}function I(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=m(t[3]))):(e=E(t,{r:0,g:0,b:0,a:1})).a=m(e.a),e}function z(t){return"r"===t.charAt(0)?function(t){const e=_.exec(t);let i,s,n,o=255;if(e){if(e[7]!==i){const t=+e[7];o=255&(e[8]?p(t):255*t)}return i=+e[1],s=+e[3],n=+e[5],i=255&(e[2]?p(i):i),s=255&(e[4]?p(s):s),n=255&(e[6]?p(n):n),{r:i,g:s,b:n,a:o}}}(t):C(t)}class F{constructor(t){if(t instanceof F)return t;const e=typeof t;let i;var s,n,o;"object"===e?i=I(t):"string"===e&&(o=(s=t).length,"#"===s[0]&&(4===o||5===o?n={r:255&17*r[s[1]],g:255&17*r[s[2]],b:255&17*r[s[3]],a:5===o?17*r[s[4]]:255}:7!==o&&9!==o||(n={r:r[s[1]]<<4|r[s[2]],g:r[s[3]]<<4|r[s[4]],b:r[s[5]]<<4|r[s[6]],a:9===o?r[s[7]]<<4|r[s[8]]:255})),i=n||L(t)||z(t)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var t=E(this._rgb);return t&&(t.a=x(t.a)),t}set rgb(t){this._rgb=I(t)}rgbString(){return this._valid?(t=this._rgb)&&(t.a<255?`rgba(${t.r}, ${t.g}, ${t.b}, ${x(t.a)})`:`rgb(${t.r}, ${t.g}, ${t.b})`):this._rgb;var t}hexString(){return this._valid?u(this._rgb):this._rgb}hslString(){return this._valid?function(t){if(!t)return;const e=k(t),i=e[0],s=b(e[1]),n=b(e[2]);return t.a<255?`hsla(${i}, ${s}%, ${n}%, ${x(t.a)})`:`hsl(${i}, ${s}%, ${n}%)`}(this._rgb):this._rgb}mix(t,e){const i=this;if(t){const s=i.rgb,n=t.rgb;let o;const a=e===o?.5:e,r=2*a-1,l=s.a-n.a,h=((r*l==-1?r:(r+l)/(1+r*l))+1)/2;o=1-h,s.r=255&h*s.r+o*n.r+.5,s.g=255&h*s.g+o*n.g+.5,s.b=255&h*s.b+o*n.b+.5,s.a=a*s.a+(1-a)*n.a,i.rgb=s}return i}clone(){return new F(this.rgb)}alpha(t){return this._rgb.a=m(t),this}clearer(t){return this._rgb.a*=1-t,this}greyscale(){const t=this._rgb,e=f(.3*t.r+.59*t.g+.11*t.b);return t.r=t.g=t.b=e,this}opaquer(t){return this._rgb.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return R(this._rgb,2,t),this}darken(t){return R(this._rgb,2,-t),this}saturate(t){return R(this._rgb,1,t),this}desaturate(t){return R(this._rgb,1,-t),this}rotate(t){return function(t,e){var i=k(t);i[0]=D(i[0]+e),i=P(i),t.r=i[0],t.g=i[1],t.b=i[2]}(this._rgb,t),this}}function B(t){return new F(t)}const V=t=>t instanceof CanvasGradient||t instanceof CanvasPattern;function W(t){return V(t)?t:B(t)}function N(t){return V(t)?t:B(t).saturate(.5).darken(.1).hexString()}function H(){}const j=function(){let t=0;return function(){return t++}}();function $(t){return null==t}function Y(t){if(Array.isArray&&Array.isArray(t))return!0;const e=Object.prototype.toString.call(t);return"[object"===e.substr(0,7)&&"Array]"===e.substr(-6)}function U(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)}const X=t=>("number"==typeof t||t instanceof Number)&&isFinite(+t);function q(t,e){return X(t)?t:e}function K(t,e){return void 0===t?e:t}const G=(t,e)=>"string"==typeof t&&t.endsWith("%")?parseFloat(t)/100:t/e,Z=(t,e)=>"string"==typeof t&&t.endsWith("%")?parseFloat(t)/100*e:+t;function J(t,e,i){if(t&&"function"==typeof t.call)return t.apply(i,e)}function Q(t,e,i,s){let n,o,a;if(Y(t))if(o=t.length,s)for(n=o-1;n>=0;n--)e.call(i,t[n],n);else for(n=0;n<o;n++)e.call(i,t[n],n);else if(U(t))for(a=Object.keys(t),o=a.length,n=0;n<o;n++)e.call(i,t[a[n]],a[n])}function tt(t,e){let i,s,n,o;if(!t||!e||t.length!==e.length)return!1;for(i=0,s=t.length;i<s;++i)if(n=t[i],o=e[i],n.datasetIndex!==o.datasetIndex||n.index!==o.index)return!1;return!0}function et(t){if(Y(t))return t.map(et);if(U(t)){const e=Object.create(null),i=Object.keys(t),s=i.length;let n=0;for(;n<s;++n)e[i[n]]=et(t[i[n]]);return e}return t}function it(t){return-1===["__proto__","prototype","constructor"].indexOf(t)}function st(t,e,i,s){if(!it(t))return;const n=e[t],o=i[t];U(n)&&U(o)?nt(n,o,s):e[t]=et(o)}function nt(t,e,i){const s=Y(e)?e:[e],n=s.length;if(!U(t))return t;const o=(i=i||{}).merger||st;for(let a=0;a<n;++a){if(!U(e=s[a]))continue;const n=Object.keys(e);for(let s=0,a=n.length;s<a;++s)o(n[s],t,e,i)}return t}function ot(t,e){return nt(t,e,{merger:at})}function at(t,e,i){if(!it(t))return;const s=e[t],n=i[t];U(s)&&U(n)?ot(s,n):Object.prototype.hasOwnProperty.call(e,t)||(e[t]=et(n))}function rt(t,e){const i=t.indexOf(".",e);return-1===i?t.length:i}function lt(t,e){if(""===e)return t;let i=0,s=rt(e,i);for(;t&&s>i;)t=t[e.substr(i,s-i)],i=s+1,s=rt(e,i);return t}function ht(t){return t.charAt(0).toUpperCase()+t.slice(1)}const ct=t=>void 0!==t,dt=t=>"function"==typeof t,ut=(t,e)=>{if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0};function ft(t){return"mouseup"===t.type||"click"===t.type||"contextmenu"===t.type}const gt=Object.create(null),pt=Object.create(null);function mt(t,e){if(!e)return t;const i=e.split(".");for(let e=0,s=i.length;e<s;++e){const s=i[e];t=t[s]||(t[s]=Object.create(null))}return t}function xt(t,e,i){return"string"==typeof e?nt(mt(t,e),i):nt(mt(t,""),e)}var bt=new class{constructor(t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=t=>t.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(t,e)=>N(e.backgroundColor),this.hoverBorderColor=(t,e)=>N(e.borderColor),this.hoverColor=(t,e)=>N(e.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t)}set(t,e){return xt(this,t,e)}get(t){return mt(this,t)}describe(t,e){return xt(pt,t,e)}override(t,e){return xt(gt,t,e)}route(t,e,i,s){const n=mt(this,t),o=mt(this,i),a="_"+e;Object.defineProperties(n,{[a]:{value:n[e],writable:!0},[e]:{enumerable:!0,get(){const t=this[a],e=o[s];return U(t)?Object.assign({},e,t):K(t,e)},set(t){this[a]=t}}})}}({_scriptable:t=>!t.startsWith("on"),_indexable:t=>"events"!==t,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}});const _t=Math.PI,yt=2*_t,vt=yt+_t,wt=Number.POSITIVE_INFINITY,Mt=_t/180,kt=_t/2,St=_t/4,Pt=2*_t/3,Dt=Math.log10,Ct=Math.sign;function Ot(t){const e=Math.round(t);t=Lt(t,e,t/1e3)?e:t;const i=Math.pow(10,Math.floor(Dt(t))),s=t/i;return(s<=1?1:s<=2?2:s<=5?5:10)*i}function At(t){const e=[],i=Math.sqrt(t);let s;for(s=1;s<i;s++)t%s==0&&(e.push(s),e.push(t/s));return i===(0|i)&&e.push(i),e.sort(((t,e)=>t-e)).pop(),e}function Tt(t){return!isNaN(parseFloat(t))&&isFinite(t)}function Lt(t,e,i){return Math.abs(t-e)<i}function Rt(t,e){const i=Math.round(t);return i-e<=t&&i+e>=t}function Et(t,e,i){let s,n,o;for(s=0,n=t.length;s<n;s++)o=t[s][i],isNaN(o)||(e.min=Math.min(e.min,o),e.max=Math.max(e.max,o))}function It(t){return t*(_t/180)}function zt(t){return t*(180/_t)}function Ft(t){if(!X(t))return;let e=1,i=0;for(;Math.round(t*e)/e!==t;)e*=10,i++;return i}function Bt(t,e){const i=e.x-t.x,s=e.y-t.y,n=Math.sqrt(i*i+s*s);let o=Math.atan2(s,i);return o<-.5*_t&&(o+=yt),{angle:o,distance:n}}function Vt(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Wt(t,e){return(t-e+vt)%yt-_t}function Nt(t){return(t%yt+yt)%yt}function Ht(t,e,i,s){const n=Nt(t),o=Nt(e),a=Nt(i),r=Nt(o-n),l=Nt(a-n),h=Nt(n-o),c=Nt(n-a);return n===o||n===a||s&&o===a||r>l&&h<c}function jt(t,e,i){return Math.max(e,Math.min(i,t))}function $t(t){return jt(t,-32768,32767)}function Yt(t,e,i,s=1e-6){return t>=Math.min(e,i)-s&&t<=Math.max(e,i)+s}function Ut(t){return!t||$(t.size)||$(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}function Xt(t,e,i,s,n){let o=e[n];return o||(o=e[n]=t.measureText(n).width,i.push(n)),o>s&&(s=o),s}function qt(t,e,i,s){let n=(s=s||{}).data=s.data||{},o=s.garbageCollect=s.garbageCollect||[];s.font!==e&&(n=s.data={},o=s.garbageCollect=[],s.font=e),t.save(),t.font=e;let a=0;const r=i.length;let l,h,c,d,u;for(l=0;l<r;l++)if(d=i[l],null!=d&&!0!==Y(d))a=Xt(t,n,o,a,d);else if(Y(d))for(h=0,c=d.length;h<c;h++)u=d[h],null==u||Y(u)||(a=Xt(t,n,o,a,u));t.restore();const f=o.length/2;if(f>i.length){for(l=0;l<f;l++)delete n[o[l]];o.splice(0,f)}return a}function Kt(t,e,i){const s=t.currentDevicePixelRatio,n=0!==i?Math.max(i/2,.5):0;return Math.round((e-n)*s)/s+n}function Gt(t,e){(e=e||t.getContext("2d")).save(),e.resetTransform(),e.clearRect(0,0,t.width,t.height),e.restore()}function Zt(t,e,i,s){let n,o,a,r,l;const h=e.pointStyle,c=e.rotation,d=e.radius;let u=(c||0)*Mt;if(h&&"object"==typeof h&&(n=h.toString(),"[object HTMLImageElement]"===n||"[object HTMLCanvasElement]"===n))return t.save(),t.translate(i,s),t.rotate(u),t.drawImage(h,-h.width/2,-h.height/2,h.width,h.height),void t.restore();if(!(isNaN(d)||d<=0)){switch(t.beginPath(),h){default:t.arc(i,s,d,0,yt),t.closePath();break;case"triangle":t.moveTo(i+Math.sin(u)*d,s-Math.cos(u)*d),u+=Pt,t.lineTo(i+Math.sin(u)*d,s-Math.cos(u)*d),u+=Pt,t.lineTo(i+Math.sin(u)*d,s-Math.cos(u)*d),t.closePath();break;case"rectRounded":l=.516*d,r=d-l,o=Math.cos(u+St)*r,a=Math.sin(u+St)*r,t.arc(i-o,s-a,l,u-_t,u-kt),t.arc(i+a,s-o,l,u-kt,u),t.arc(i+o,s+a,l,u,u+kt),t.arc(i-a,s+o,l,u+kt,u+_t),t.closePath();break;case"rect":if(!c){r=Math.SQRT1_2*d,t.rect(i-r,s-r,2*r,2*r);break}u+=St;case"rectRot":o=Math.cos(u)*d,a=Math.sin(u)*d,t.moveTo(i-o,s-a),t.lineTo(i+a,s-o),t.lineTo(i+o,s+a),t.lineTo(i-a,s+o),t.closePath();break;case"crossRot":u+=St;case"cross":o=Math.cos(u)*d,a=Math.sin(u)*d,t.moveTo(i-o,s-a),t.lineTo(i+o,s+a),t.moveTo(i+a,s-o),t.lineTo(i-a,s+o);break;case"star":o=Math.cos(u)*d,a=Math.sin(u)*d,t.moveTo(i-o,s-a),t.lineTo(i+o,s+a),t.moveTo(i+a,s-o),t.lineTo(i-a,s+o),u+=St,o=Math.cos(u)*d,a=Math.sin(u)*d,t.moveTo(i-o,s-a),t.lineTo(i+o,s+a),t.moveTo(i+a,s-o),t.lineTo(i-a,s+o);break;case"line":o=Math.cos(u)*d,a=Math.sin(u)*d,t.moveTo(i-o,s-a),t.lineTo(i+o,s+a);break;case"dash":t.moveTo(i,s),t.lineTo(i+Math.cos(u)*d,s+Math.sin(u)*d)}t.fill(),e.borderWidth>0&&t.stroke()}}function Jt(t,e,i){return i=i||.5,!e||t&&t.x>e.left-i&&t.x<e.right+i&&t.y>e.top-i&&t.y<e.bottom+i}function Qt(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()}function te(t){t.restore()}function ee(t,e,i,s,n){if(!e)return t.lineTo(i.x,i.y);if("middle"===n){const s=(e.x+i.x)/2;t.lineTo(s,e.y),t.lineTo(s,i.y)}else"after"===n!=!!s?t.lineTo(e.x,i.y):t.lineTo(i.x,e.y);t.lineTo(i.x,i.y)}function ie(t,e,i,s){if(!e)return t.lineTo(i.x,i.y);t.bezierCurveTo(s?e.cp1x:e.cp2x,s?e.cp1y:e.cp2y,s?i.cp2x:i.cp1x,s?i.cp2y:i.cp1y,i.x,i.y)}function se(t,e,i,s,n,o={}){const a=Y(e)?e:[e],r=o.strokeWidth>0&&""!==o.strokeColor;let l,h;for(t.save(),t.font=n.string,function(t,e){e.translation&&t.translate(e.translation[0],e.translation[1]);$(e.rotation)||t.rotate(e.rotation);e.color&&(t.fillStyle=e.color);e.textAlign&&(t.textAlign=e.textAlign);e.textBaseline&&(t.textBaseline=e.textBaseline)}(t,o),l=0;l<a.length;++l)h=a[l],r&&(o.strokeColor&&(t.strokeStyle=o.strokeColor),$(o.strokeWidth)||(t.lineWidth=o.strokeWidth),t.strokeText(h,i,s,o.maxWidth)),t.fillText(h,i,s,o.maxWidth),ne(t,i,s,h,o),s+=n.lineHeight;t.restore()}function ne(t,e,i,s,n){if(n.strikethrough||n.underline){const o=t.measureText(s),a=e-o.actualBoundingBoxLeft,r=e+o.actualBoundingBoxRight,l=i-o.actualBoundingBoxAscent,h=i+o.actualBoundingBoxDescent,c=n.strikethrough?(l+h)/2:h;t.strokeStyle=t.fillStyle,t.beginPath(),t.lineWidth=n.decorationWidth||2,t.moveTo(a,c),t.lineTo(r,c),t.stroke()}}function oe(t,e){const{x:i,y:s,w:n,h:o,radius:a}=e;t.arc(i+a.topLeft,s+a.topLeft,a.topLeft,-kt,_t,!0),t.lineTo(i,s+o-a.bottomLeft),t.arc(i+a.bottomLeft,s+o-a.bottomLeft,a.bottomLeft,_t,kt,!0),t.lineTo(i+n-a.bottomRight,s+o),t.arc(i+n-a.bottomRight,s+o-a.bottomRight,a.bottomRight,kt,0,!0),t.lineTo(i+n,s+a.topRight),t.arc(i+n-a.topRight,s+a.topRight,a.topRight,0,-kt,!0),t.lineTo(i+a.topLeft,s)}function ae(t,e,i){i=i||(i=>t[i]<e);let s,n=t.length-1,o=0;for(;n-o>1;)s=o+n>>1,i(s)?o=s:n=s;return{lo:o,hi:n}}const re=(t,e,i)=>ae(t,i,(s=>t[s][e]<i)),le=(t,e,i)=>ae(t,i,(s=>t[s][e]>=i));function he(t,e,i){let s=0,n=t.length;for(;s<n&&t[s]<e;)s++;for(;n>s&&t[n-1]>i;)n--;return s>0||n<t.length?t.slice(s,n):t}const ce=["push","pop","shift","splice","unshift"];function de(t,e){t._chartjs?t._chartjs.listeners.push(e):(Object.defineProperty(t,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),ce.forEach((e=>{const i="_onData"+ht(e),s=t[e];Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value(...e){const n=s.apply(this,e);return t._chartjs.listeners.forEach((t=>{"function"==typeof t[i]&&t[i](...e)})),n}})})))}function ue(t,e){const i=t._chartjs;if(!i)return;const s=i.listeners,n=s.indexOf(e);-1!==n&&s.splice(n,1),s.length>0||(ce.forEach((e=>{delete t[e]})),delete t._chartjs)}function fe(t){const e=new Set;let i,s;for(i=0,s=t.length;i<s;++i)e.add(t[i]);return e.size===s?t:Array.from(e)}function ge(){return"undefined"!=typeof window&&"undefined"!=typeof document}function pe(t){let e=t.parentNode;return e&&"[object ShadowRoot]"===e.toString()&&(e=e.host),e}function me(t,e,i){let s;return"string"==typeof t?(s=parseInt(t,10),-1!==t.indexOf("%")&&(s=s/100*e.parentNode[i])):s=t,s}const xe=t=>window.getComputedStyle(t,null);function be(t,e){return xe(t).getPropertyValue(e)}const _e=["top","right","bottom","left"];function ye(t,e,i){const s={};i=i?"-"+i:"";for(let n=0;n<4;n++){const o=_e[n];s[o]=parseFloat(t[e+"-"+o+i])||0}return s.width=s.left+s.right,s.height=s.top+s.bottom,s}function ve(t,e){const{canvas:i,currentDevicePixelRatio:s}=e,n=xe(i),o="border-box"===n.boxSizing,a=ye(n,"padding"),r=ye(n,"border","width"),{x:l,y:h,box:c}=function(t,e){const i=t.native||t,s=i.touches,n=s&&s.length?s[0]:i,{offsetX:o,offsetY:a}=n;let r,l,h=!1;if(((t,e,i)=>(t>0||e>0)&&(!i||!i.shadowRoot))(o,a,i.target))r=o,l=a;else{const t=e.getBoundingClientRect();r=n.clientX-t.left,l=n.clientY-t.top,h=!0}return{x:r,y:l,box:h}}(t,i),d=a.left+(c&&r.left),u=a.top+(c&&r.top);let{width:f,height:g}=e;return o&&(f-=a.width+r.width,g-=a.height+r.height),{x:Math.round((l-d)/f*i.width/s),y:Math.round((h-u)/g*i.height/s)}}const we=t=>Math.round(10*t)/10;function Me(t,e,i,s){const n=xe(t),o=ye(n,"margin"),a=me(n.maxWidth,t,"clientWidth")||wt,r=me(n.maxHeight,t,"clientHeight")||wt,l=function(t,e,i){let s,n;if(void 0===e||void 0===i){const o=pe(t);if(o){const t=o.getBoundingClientRect(),a=xe(o),r=ye(a,"border","width"),l=ye(a,"padding");e=t.width-l.width-r.width,i=t.height-l.height-r.height,s=me(a.maxWidth,o,"clientWidth"),n=me(a.maxHeight,o,"clientHeight")}else e=t.clientWidth,i=t.clientHeight}return{width:e,height:i,maxWidth:s||wt,maxHeight:n||wt}}(t,e,i);let{width:h,height:c}=l;if("content-box"===n.boxSizing){const t=ye(n,"border","width"),e=ye(n,"padding");h-=e.width+t.width,c-=e.height+t.height}return h=Math.max(0,h-o.width),c=Math.max(0,s?Math.floor(h/s):c-o.height),h=we(Math.min(h,a,l.maxWidth)),c=we(Math.min(c,r,l.maxHeight)),h&&!c&&(c=we(h/2)),{width:h,height:c}}function ke(t,e,i){const s=e||1,n=Math.floor(t.height*s),o=Math.floor(t.width*s);t.height=n/s,t.width=o/s;const a=t.canvas;return a.style&&(i||!a.style.height&&!a.style.width)&&(a.style.height=`${t.height}px`,a.style.width=`${t.width}px`),(t.currentDevicePixelRatio!==s||a.height!==n||a.width!==o)&&(t.currentDevicePixelRatio=s,a.height=n,a.width=o,t.ctx.setTransform(s,0,0,s,0,0),!0)}const Se=function(){let t=!1;try{const e={get passive(){return t=!0,!1}};window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch(t){}return t}();function Pe(t,e){const i=be(t,e),s=i&&i.match(/^(\d+)(\.\d+)?px$/);return s?+s[1]:void 0}function De(t,e){return"native"in t?{x:t.x,y:t.y}:ve(t,e)}function Ce(t,e,i,s){const{controller:n,data:o,_sorted:a}=t,r=n._cachedMeta.iScale;if(r&&e===r.axis&&"r"!==e&&a&&o.length){const t=r._reversePixels?le:re;if(!s)return t(o,e,i);if(n._sharedOptions){const s=o[0],n="function"==typeof s.getRange&&s.getRange(e);if(n){const s=t(o,e,i-n),a=t(o,e,i+n);return{lo:s.lo,hi:a.hi}}}}return{lo:0,hi:o.length-1}}function Oe(t,e,i,s,n){const o=t.getSortedVisibleDatasetMetas(),a=i[e];for(let t=0,i=o.length;t<i;++t){const{index:i,data:r}=o[t],{lo:l,hi:h}=Ce(o[t],e,a,n);for(let t=l;t<=h;++t){const e=r[t];e.skip||s(e,i,t)}}}function Ae(t,e,i,s){const n=[];if(!Jt(e,t.chartArea,t._minPadding))return n;return Oe(t,i,e,(function(t,i,o){t.inRange(e.x,e.y,s)&&n.push({element:t,datasetIndex:i,index:o})}),!0),n}function Te(t,e,i,s,n){let o=[];const a=function(t){const e=-1!==t.indexOf("x"),i=-1!==t.indexOf("y");return function(t,s){const n=e?Math.abs(t.x-s.x):0,o=i?Math.abs(t.y-s.y):0;return Math.sqrt(Math.pow(n,2)+Math.pow(o,2))}}(i);let r=Number.POSITIVE_INFINITY;return Oe(t,i,e,(function(i,l,h){const c=i.inRange(e.x,e.y,n);if(s&&!c)return;const d=i.getCenterPoint(n);if(!Jt(d,t.chartArea,t._minPadding)&&!c)return;const u=a(e,d);u<r?(o=[{element:i,datasetIndex:l,index:h}],r=u):u===r&&o.push({element:i,datasetIndex:l,index:h})})),o}function Le(t,e,i,s,n){return Jt(e,t.chartArea,t._minPadding)?"r"!==i||s?Te(t,e,i,s,n):function(t,e,i,s){let n=[];return Oe(t,i,e,(function(t,i,o){const{startAngle:a,endAngle:r}=t.getProps(["startAngle","endAngle"],s),{angle:l}=Bt(t,{x:e.x,y:e.y});Ht(l,a,r)&&n.push({element:t,datasetIndex:i,index:o})})),n}(t,e,i,n):[]}function Re(t,e,i,s){const n=De(e,t),o=[],a=i.axis,r="x"===a?"inXRange":"inYRange";let l=!1;return function(t,e){const i=t.getSortedVisibleDatasetMetas();let s,n,o;for(let t=0,a=i.length;t<a;++t){({index:s,data:n}=i[t]);for(let t=0,i=n.length;t<i;++t)o=n[t],o.skip||e(o,s,t)}}(t,((t,e,i)=>{t[r](n[a],s)&&o.push({element:t,datasetIndex:e,index:i}),t.inRange(n.x,n.y,s)&&(l=!0)})),i.intersect&&!l?[]:o}var Ee={modes:{index(t,e,i,s){const n=De(e,t),o=i.axis||"x",a=i.intersect?Ae(t,n,o,s):Le(t,n,o,!1,s),r=[];return a.length?(t.getSortedVisibleDatasetMetas().forEach((t=>{const e=a[0].index,i=t.data[e];i&&!i.skip&&r.push({element:i,datasetIndex:t.index,index:e})})),r):[]},dataset(t,e,i,s){const n=De(e,t),o=i.axis||"xy";let a=i.intersect?Ae(t,n,o,s):Le(t,n,o,!1,s);if(a.length>0){const e=a[0].datasetIndex,i=t.getDatasetMeta(e).data;a=[];for(let t=0;t<i.length;++t)a.push({element:i[t],datasetIndex:e,index:t})}return a},point:(t,e,i,s)=>Ae(t,De(e,t),i.axis||"xy",s),nearest:(t,e,i,s)=>Le(t,De(e,t),i.axis||"xy",i.intersect,s),x:(t,e,i,s)=>Re(t,e,{axis:"x",intersect:i.intersect},s),y:(t,e,i,s)=>Re(t,e,{axis:"y",intersect:i.intersect},s)}};const Ie=new RegExp(/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/),ze=new RegExp(/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/);function Fe(t,e){const i=(""+t).match(Ie);if(!i||"normal"===i[1])return 1.2*e;switch(t=+i[2],i[3]){case"px":return t;case"%":t/=100}return e*t}function Be(t,e){const i={},s=U(e),n=s?Object.keys(e):e,o=U(t)?s?i=>K(t[i],t[e[i]]):e=>t[e]:()=>t;for(const t of n)i[t]=+o(t)||0;return i}function Ve(t){return Be(t,{top:"y",right:"x",bottom:"y",left:"x"})}function We(t){return Be(t,["topLeft","topRight","bottomLeft","bottomRight"])}function Ne(t){const e=Ve(t);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function He(t,e){t=t||{},e=e||bt.font;let i=K(t.size,e.size);"string"==typeof i&&(i=parseInt(i,10));let s=K(t.style,e.style);s&&!(""+s).match(ze)&&(console.warn('Invalid font style specified: "'+s+'"'),s="");const n={family:K(t.family,e.family),lineHeight:Fe(K(t.lineHeight,e.lineHeight),i),size:i,style:s,weight:K(t.weight,e.weight),string:""};return n.string=Ut(n),n}function je(t,e,i,s){let n,o,a,r=!0;for(n=0,o=t.length;n<o;++n)if(a=t[n],void 0!==a&&(void 0!==e&&"function"==typeof a&&(a=a(e),r=!1),void 0!==i&&Y(a)&&(a=a[i%a.length],r=!1),void 0!==a))return s&&!r&&(s.cacheable=!1),a}function $e(t,e,i){const{min:s,max:n}=t,o=Z(e,(n-s)/2),a=(t,e)=>i&&0===t?0:t+e;return{min:a(s,-Math.abs(o)),max:a(n,o)}}function Ye(t,e){return Object.assign(Object.create(t),e)}const Ue=["left","top","right","bottom"];function Xe(t,e){return t.filter((t=>t.pos===e))}function qe(t,e){return t.filter((t=>-1===Ue.indexOf(t.pos)&&t.box.axis===e))}function Ke(t,e){return t.sort(((t,i)=>{const s=e?i:t,n=e?t:i;return s.weight===n.weight?s.index-n.index:s.weight-n.weight}))}function Ge(t,e){const i=function(t){const e={};for(const i of t){const{stack:t,pos:s,stackWeight:n}=i;if(!t||!Ue.includes(s))continue;const o=e[t]||(e[t]={count:0,placed:0,weight:0,size:0});o.count++,o.weight+=n}return e}(t),{vBoxMaxWidth:s,hBoxMaxHeight:n}=e;let o,a,r;for(o=0,a=t.length;o<a;++o){r=t[o];const{fullSize:a}=r.box,l=i[r.stack],h=l&&r.stackWeight/l.weight;r.horizontal?(r.width=h?h*s:a&&e.availableWidth,r.height=n):(r.width=s,r.height=h?h*n:a&&e.availableHeight)}return i}function Ze(t,e,i,s){return Math.max(t[i],e[i])+Math.max(t[s],e[s])}function Je(t,e){t.top=Math.max(t.top,e.top),t.left=Math.max(t.left,e.left),t.bottom=Math.max(t.bottom,e.bottom),t.right=Math.max(t.right,e.right)}function Qe(t,e,i,s){const{pos:n,box:o}=i,a=t.maxPadding;if(!U(n)){i.size&&(t[n]-=i.size);const e=s[i.stack]||{size:0,count:1};e.size=Math.max(e.size,i.horizontal?o.height:o.width),i.size=e.size/e.count,t[n]+=i.size}o.getPadding&&Je(a,o.getPadding());const r=Math.max(0,e.outerWidth-Ze(a,t,"left","right")),l=Math.max(0,e.outerHeight-Ze(a,t,"top","bottom")),h=r!==t.w,c=l!==t.h;return t.w=r,t.h=l,i.horizontal?{same:h,other:c}:{same:c,other:h}}function ti(t,e){const i=e.maxPadding;function s(t){const s={left:0,top:0,right:0,bottom:0};return t.forEach((t=>{s[t]=Math.max(e[t],i[t])})),s}return s(t?["left","right"]:["top","bottom"])}function ei(t,e,i,s){const n=[];let o,a,r,l,h,c;for(o=0,a=t.length,h=0;o<a;++o){r=t[o],l=r.box,l.update(r.width||e.w,r.height||e.h,ti(r.horizontal,e));const{same:a,other:d}=Qe(e,i,r,s);h|=a&&n.length,c=c||d,l.fullSize||n.push(r)}return h&&ei(n,e,i,s)||c}function ii(t,e,i,s,n){t.top=i,t.left=e,t.right=e+s,t.bottom=i+n,t.width=s,t.height=n}function si(t,e,i,s){const n=i.padding;let{x:o,y:a}=e;for(const r of t){const t=r.box,l=s[r.stack]||{count:1,placed:0,weight:1},h=r.stackWeight/l.weight||1;if(r.horizontal){const s=e.w*h,o=l.size||t.height;ct(l.start)&&(a=l.start),t.fullSize?ii(t,n.left,a,i.outerWidth-n.right-n.left,o):ii(t,e.left+l.placed,a,s,o),l.start=a,l.placed+=s,a=t.bottom}else{const s=e.h*h,a=l.size||t.width;ct(l.start)&&(o=l.start),t.fullSize?ii(t,o,n.top,a,i.outerHeight-n.bottom-n.top):ii(t,o,e.top+l.placed,a,s),l.start=o,l.placed+=s,o=t.right}}e.x=o,e.y=a}bt.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}});var ni={addBox(t,e){t.boxes||(t.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},t.boxes.push(e)},removeBox(t,e){const i=t.boxes?t.boxes.indexOf(e):-1;-1!==i&&t.boxes.splice(i,1)},configure(t,e,i){e.fullSize=i.fullSize,e.position=i.position,e.weight=i.weight},update(t,e,i,s){if(!t)return;const n=Ne(t.options.layout.padding),o=Math.max(e-n.width,0),a=Math.max(i-n.height,0),r=function(t){const e=function(t){const e=[];let i,s,n,o,a,r;for(i=0,s=(t||[]).length;i<s;++i)n=t[i],({position:o,options:{stack:a,stackWeight:r=1}}=n),e.push({index:i,box:n,pos:o,horizontal:n.isHorizontal(),weight:n.weight,stack:a&&o+a,stackWeight:r});return e}(t),i=Ke(e.filter((t=>t.box.fullSize)),!0),s=Ke(Xe(e,"left"),!0),n=Ke(Xe(e,"right")),o=Ke(Xe(e,"top"),!0),a=Ke(Xe(e,"bottom")),r=qe(e,"x"),l=qe(e,"y");return{fullSize:i,leftAndTop:s.concat(o),rightAndBottom:n.concat(l).concat(a).concat(r),chartArea:Xe(e,"chartArea"),vertical:s.concat(n).concat(l),horizontal:o.concat(a).concat(r)}}(t.boxes),l=r.vertical,h=r.horizontal;Q(t.boxes,(t=>{"function"==typeof t.beforeLayout&&t.beforeLayout()}));const c=l.reduce(((t,e)=>e.box.options&&!1===e.box.options.display?t:t+1),0)||1,d=Object.freeze({outerWidth:e,outerHeight:i,padding:n,availableWidth:o,availableHeight:a,vBoxMaxWidth:o/2/c,hBoxMaxHeight:a/2}),u=Object.assign({},n);Je(u,Ne(s));const f=Object.assign({maxPadding:u,w:o,h:a,x:n.left,y:n.top},n),g=Ge(l.concat(h),d);ei(r.fullSize,f,d,g),ei(l,f,d,g),ei(h,f,d,g)&&ei(l,f,d,g),function(t){const e=t.maxPadding;function i(i){const s=Math.max(e[i]-t[i],0);return t[i]+=s,s}t.y+=i("top"),t.x+=i("left"),i("right"),i("bottom")}(f),si(r.leftAndTop,f,d,g),f.x+=f.w,f.y+=f.h,si(r.rightAndBottom,f,d,g),t.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},Q(r.chartArea,(e=>{const i=e.box;Object.assign(i,t.chartArea),i.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})}))}};function oi(t,e=[""],i=t,s,n=(()=>t[0])){ct(s)||(s=mi("_fallback",t));const o={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:t,_rootScopes:i,_fallback:s,_getTarget:n,override:n=>oi([n,...t],e,i,s)};return new Proxy(o,{deleteProperty:(e,i)=>(delete e[i],delete e._keys,delete t[0][i],!0),get:(i,s)=>ci(i,s,(()=>function(t,e,i,s){let n;for(const o of e)if(n=mi(li(o,t),i),ct(n))return hi(t,n)?gi(i,s,t,n):n}(s,e,t,i))),getOwnPropertyDescriptor:(t,e)=>Reflect.getOwnPropertyDescriptor(t._scopes[0],e),getPrototypeOf:()=>Reflect.getPrototypeOf(t[0]),has:(t,e)=>xi(t).includes(e),ownKeys:t=>xi(t),set(t,e,i){const s=t._storage||(t._storage=n());return t[e]=s[e]=i,delete t._keys,!0}})}function ai(t,e,i,s){const n={_cacheable:!1,_proxy:t,_context:e,_subProxy:i,_stack:new Set,_descriptors:ri(t,s),setContext:e=>ai(t,e,i,s),override:n=>ai(t.override(n),e,i,s)};return new Proxy(n,{deleteProperty:(e,i)=>(delete e[i],delete t[i],!0),get:(t,e,i)=>ci(t,e,(()=>function(t,e,i){const{_proxy:s,_context:n,_subProxy:o,_descriptors:a}=t;let r=s[e];dt(r)&&a.isScriptable(e)&&(r=function(t,e,i,s){const{_proxy:n,_context:o,_subProxy:a,_stack:r}=i;if(r.has(t))throw new Error("Recursion detected: "+Array.from(r).join("->")+"->"+t);r.add(t),e=e(o,a||s),r.delete(t),hi(t,e)&&(e=gi(n._scopes,n,t,e));return e}(e,r,t,i));Y(r)&&r.length&&(r=function(t,e,i,s){const{_proxy:n,_context:o,_subProxy:a,_descriptors:r}=i;if(ct(o.index)&&s(t))e=e[o.index%e.length];else if(U(e[0])){const i=e,s=n._scopes.filter((t=>t!==i));e=[];for(const l of i){const i=gi(s,n,t,l);e.push(ai(i,o,a&&a[t],r))}}return e}(e,r,t,a.isIndexable));hi(e,r)&&(r=ai(r,n,o&&o[e],a));return r}(t,e,i))),getOwnPropertyDescriptor:(e,i)=>e._descriptors.allKeys?Reflect.has(t,i)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(t,i),getPrototypeOf:()=>Reflect.getPrototypeOf(t),has:(e,i)=>Reflect.has(t,i),ownKeys:()=>Reflect.ownKeys(t),set:(e,i,s)=>(t[i]=s,delete e[i],!0)})}function ri(t,e={scriptable:!0,indexable:!0}){const{_scriptable:i=e.scriptable,_indexable:s=e.indexable,_allKeys:n=e.allKeys}=t;return{allKeys:n,scriptable:i,indexable:s,isScriptable:dt(i)?i:()=>i,isIndexable:dt(s)?s:()=>s}}const li=(t,e)=>t?t+ht(e):e,hi=(t,e)=>U(e)&&"adapters"!==t&&(null===Object.getPrototypeOf(e)||e.constructor===Object);function ci(t,e,i){if(Object.prototype.hasOwnProperty.call(t,e))return t[e];const s=i();return t[e]=s,s}function di(t,e,i){return dt(t)?t(e,i):t}const ui=(t,e)=>!0===t?e:"string"==typeof t?lt(e,t):void 0;function fi(t,e,i,s,n){for(const o of e){const e=ui(i,o);if(e){t.add(e);const o=di(e._fallback,i,n);if(ct(o)&&o!==i&&o!==s)return o}else if(!1===e&&ct(s)&&i!==s)return null}return!1}function gi(t,e,i,s){const n=e._rootScopes,o=di(e._fallback,i,s),a=[...t,...n],r=new Set;r.add(s);let l=pi(r,a,i,o||i,s);return null!==l&&((!ct(o)||o===i||(l=pi(r,a,o,l,s),null!==l))&&oi(Array.from(r),[""],n,o,(()=>function(t,e,i){const s=t._getTarget();e in s||(s[e]={});const n=s[e];if(Y(n)&&U(i))return i;return n}(e,i,s))))}function pi(t,e,i,s,n){for(;i;)i=fi(t,e,i,s,n);return i}function mi(t,e){for(const i of e){if(!i)continue;const e=i[t];if(ct(e))return e}}function xi(t){let e=t._keys;return e||(e=t._keys=function(t){const e=new Set;for(const i of t)for(const t of Object.keys(i).filter((t=>!t.startsWith("_"))))e.add(t);return Array.from(e)}(t._scopes)),e}const bi=Number.EPSILON||1e-14,_i=(t,e)=>e<t.length&&!t[e].skip&&t[e],yi=t=>"x"===t?"y":"x";function vi(t,e,i,s){const n=t.skip?e:t,o=e,a=i.skip?e:i,r=Vt(o,n),l=Vt(a,o);let h=r/(r+l),c=l/(r+l);h=isNaN(h)?0:h,c=isNaN(c)?0:c;const d=s*h,u=s*c;return{previous:{x:o.x-d*(a.x-n.x),y:o.y-d*(a.y-n.y)},next:{x:o.x+u*(a.x-n.x),y:o.y+u*(a.y-n.y)}}}function wi(t,e="x"){const i=yi(e),s=t.length,n=Array(s).fill(0),o=Array(s);let a,r,l,h=_i(t,0);for(a=0;a<s;++a)if(r=l,l=h,h=_i(t,a+1),l){if(h){const t=h[e]-l[e];n[a]=0!==t?(h[i]-l[i])/t:0}o[a]=r?h?Ct(n[a-1])!==Ct(n[a])?0:(n[a-1]+n[a])/2:n[a-1]:n[a]}!function(t,e,i){const s=t.length;let n,o,a,r,l,h=_i(t,0);for(let c=0;c<s-1;++c)l=h,h=_i(t,c+1),l&&h&&(Lt(e[c],0,bi)?i[c]=i[c+1]=0:(n=i[c]/e[c],o=i[c+1]/e[c],r=Math.pow(n,2)+Math.pow(o,2),r<=9||(a=3/Math.sqrt(r),i[c]=n*a*e[c],i[c+1]=o*a*e[c])))}(t,n,o),function(t,e,i="x"){const s=yi(i),n=t.length;let o,a,r,l=_i(t,0);for(let h=0;h<n;++h){if(a=r,r=l,l=_i(t,h+1),!r)continue;const n=r[i],c=r[s];a&&(o=(n-a[i])/3,r[`cp1${i}`]=n-o,r[`cp1${s}`]=c-o*e[h]),l&&(o=(l[i]-n)/3,r[`cp2${i}`]=n+o,r[`cp2${s}`]=c+o*e[h])}}(t,o,e)}function Mi(t,e,i){return Math.max(Math.min(t,i),e)}function ki(t,e,i,s,n){let o,a,r,l;if(e.spanGaps&&(t=t.filter((t=>!t.skip))),"monotone"===e.cubicInterpolationMode)wi(t,n);else{let i=s?t[t.length-1]:t[0];for(o=0,a=t.length;o<a;++o)r=t[o],l=vi(i,r,t[Math.min(o+1,a-(s?0:1))%a],e.tension),r.cp1x=l.previous.x,r.cp1y=l.previous.y,r.cp2x=l.next.x,r.cp2y=l.next.y,i=r}e.capBezierPoints&&function(t,e){let i,s,n,o,a,r=Jt(t[0],e);for(i=0,s=t.length;i<s;++i)a=o,o=r,r=i<s-1&&Jt(t[i+1],e),o&&(n=t[i],a&&(n.cp1x=Mi(n.cp1x,e.left,e.right),n.cp1y=Mi(n.cp1y,e.top,e.bottom)),r&&(n.cp2x=Mi(n.cp2x,e.left,e.right),n.cp2y=Mi(n.cp2y,e.top,e.bottom)))}(t,i)}const Si=t=>0===t||1===t,Pi=(t,e,i)=>-Math.pow(2,10*(t-=1))*Math.sin((t-e)*yt/i),Di=(t,e,i)=>Math.pow(2,-10*t)*Math.sin((t-e)*yt/i)+1,Ci={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>-t*(t-2),easeInOutQuad:t=>(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1),easeInCubic:t=>t*t*t,easeOutCubic:t=>(t-=1)*t*t+1,easeInOutCubic:t=>(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2),easeInQuart:t=>t*t*t*t,easeOutQuart:t=>-((t-=1)*t*t*t-1),easeInOutQuart:t=>(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>(t-=1)*t*t*t*t+1,easeInOutQuint:t=>(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),easeInSine:t=>1-Math.cos(t*kt),easeOutSine:t=>Math.sin(t*kt),easeInOutSine:t=>-.5*(Math.cos(_t*t)-1),easeInExpo:t=>0===t?0:Math.pow(2,10*(t-1)),easeOutExpo:t=>1===t?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>Si(t)?t:t<.5?.5*Math.pow(2,10*(2*t-1)):.5*(2-Math.pow(2,-10*(2*t-1))),easeInCirc:t=>t>=1?t:-(Math.sqrt(1-t*t)-1),easeOutCirc:t=>Math.sqrt(1-(t-=1)*t),easeInOutCirc:t=>(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),easeInElastic:t=>Si(t)?t:Pi(t,.075,.3),easeOutElastic:t=>Si(t)?t:Di(t,.075,.3),easeInOutElastic(t){const e=.1125;return Si(t)?t:t<.5?.5*Pi(2*t,e,.45):.5+.5*Di(2*t-1,e,.45)},easeInBack(t){const e=1.70158;return t*t*((e+1)*t-e)},easeOutBack(t){const e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},easeInOutBack(t){let e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},easeInBounce:t=>1-Ci.easeOutBounce(1-t),easeOutBounce(t){const e=7.5625,i=2.75;return t<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375},easeInOutBounce:t=>t<.5?.5*Ci.easeInBounce(2*t):.5*Ci.easeOutBounce(2*t-1)+.5};function Oi(t,e,i,s){return{x:t.x+i*(e.x-t.x),y:t.y+i*(e.y-t.y)}}function Ai(t,e,i,s){return{x:t.x+i*(e.x-t.x),y:"middle"===s?i<.5?t.y:e.y:"after"===s?i<1?t.y:e.y:i>0?e.y:t.y}}function Ti(t,e,i,s){const n={x:t.cp2x,y:t.cp2y},o={x:e.cp1x,y:e.cp1y},a=Oi(t,n,i),r=Oi(n,o,i),l=Oi(o,e,i),h=Oi(a,r,i),c=Oi(r,l,i);return Oi(h,c,i)}const Li=new Map;function Ri(t,e,i){return function(t,e){e=e||{};const i=t+JSON.stringify(e);let s=Li.get(i);return s||(s=new Intl.NumberFormat(t,e),Li.set(i,s)),s}(e,i).format(t)}function Ei(t,e,i){return t?function(t,e){return{x:i=>t+t+e-i,setWidth(t){e=t},textAlign:t=>"center"===t?t:"right"===t?"left":"right",xPlus:(t,e)=>t-e,leftForLtr:(t,e)=>t-e}}(e,i):{x:t=>t,setWidth(t){},textAlign:t=>t,xPlus:(t,e)=>t+e,leftForLtr:(t,e)=>t}}function Ii(t,e){let i,s;"ltr"!==e&&"rtl"!==e||(i=t.canvas.style,s=[i.getPropertyValue("direction"),i.getPropertyPriority("direction")],i.setProperty("direction",e,"important"),t.prevTextDirection=s)}function zi(t,e){void 0!==e&&(delete t.prevTextDirection,t.canvas.style.setProperty("direction",e[0],e[1]))}function Fi(t){return"angle"===t?{between:Ht,compare:Wt,normalize:Nt}:{between:Yt,compare:(t,e)=>t-e,normalize:t=>t}}function Bi({start:t,end:e,count:i,loop:s,style:n}){return{start:t%i,end:e%i,loop:s&&(e-t+1)%i==0,style:n}}function Vi(t,e,i){if(!i)return[t];const{property:s,start:n,end:o}=i,a=e.length,{compare:r,between:l,normalize:h}=Fi(s),{start:c,end:d,loop:u,style:f}=function(t,e,i){const{property:s,start:n,end:o}=i,{between:a,normalize:r}=Fi(s),l=e.length;let h,c,{start:d,end:u,loop:f}=t;if(f){for(d+=l,u+=l,h=0,c=l;h<c&&a(r(e[d%l][s]),n,o);++h)d--,u--;d%=l,u%=l}return u<d&&(u+=l),{start:d,end:u,loop:f,style:t.style}}(t,e,i),g=[];let p,m,x,b=!1,_=null;const y=()=>b||l(n,x,p)&&0!==r(n,x),v=()=>!b||0===r(o,p)||l(o,x,p);for(let t=c,i=c;t<=d;++t)m=e[t%a],m.skip||(p=h(m[s]),p!==x&&(b=l(p,n,o),null===_&&y()&&(_=0===r(p,n)?t:i),null!==_&&v()&&(g.push(Bi({start:_,end:t,loop:u,count:a,style:f})),_=null),i=t,x=p));return null!==_&&g.push(Bi({start:_,end:d,loop:u,count:a,style:f})),g}function Wi(t,e){const i=[],s=t.segments;for(let n=0;n<s.length;n++){const o=Vi(s[n],t.points,e);o.length&&i.push(...o)}return i}function Ni(t,e){const i=t.points,s=t.options.spanGaps,n=i.length;if(!n)return[];const o=!!t._loop,{start:a,end:r}=function(t,e,i,s){let n=0,o=e-1;if(i&&!s)for(;n<e&&!t[n].skip;)n++;for(;n<e&&t[n].skip;)n++;for(n%=e,i&&(o+=n);o>n&&t[o%e].skip;)o--;return o%=e,{start:n,end:o}}(i,n,o,s);if(!0===s)return Hi(t,[{start:a,end:r,loop:o}],i,e);return Hi(t,function(t,e,i,s){const n=t.length,o=[];let a,r=e,l=t[e];for(a=e+1;a<=i;++a){const i=t[a%n];i.skip||i.stop?l.skip||(s=!1,o.push({start:e%n,end:(a-1)%n,loop:s}),e=r=i.stop?a:null):(r=a,l.skip&&(e=a)),l=i}return null!==r&&o.push({start:e%n,end:r%n,loop:s}),o}(i,a,r<a?r+n:r,!!t._fullLoop&&0===a&&r===n-1),i,e)}function Hi(t,e,i,s){return s&&s.setContext&&i?function(t,e,i,s){const n=t._chart.getContext(),o=ji(t.options),{_datasetIndex:a,options:{spanGaps:r}}=t,l=i.length,h=[];let c=o,d=e[0].start,u=d;function f(t,e,s,n){const o=r?-1:1;if(t!==e){for(t+=l;i[t%l].skip;)t-=o;for(;i[e%l].skip;)e+=o;t%l!=e%l&&(h.push({start:t%l,end:e%l,loop:s,style:n}),c=n,d=e%l)}}for(const t of e){d=r?d:t.start;let e,o=i[d%l];for(u=d+1;u<=t.end;u++){const r=i[u%l];e=ji(s.setContext(Ye(n,{type:"segment",p0:o,p1:r,p0DataIndex:(u-1)%l,p1DataIndex:u%l,datasetIndex:a}))),$i(e,c)&&f(d,u-1,t.loop,c),o=r,c=e}d<u-1&&f(d,u-1,t.loop,c)}return h}(t,e,i,s):e}function ji(t){return{backgroundColor:t.backgroundColor,borderCapStyle:t.borderCapStyle,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderJoinStyle:t.borderJoinStyle,borderWidth:t.borderWidth,borderColor:t.borderColor}}function $i(t,e){return e&&JSON.stringify(t)!==JSON.stringify(e)}var Yi=Object.freeze({__proto__:null,easingEffects:Ci,color:W,getHoverColor:N,noop:H,uid:j,isNullOrUndef:$,isArray:Y,isObject:U,isFinite:X,finiteOrDefault:q,valueOrDefault:K,toPercentage:G,toDimension:Z,callback:J,each:Q,_elementsEqual:tt,clone:et,_merger:st,merge:nt,mergeIf:ot,_mergerIf:at,_deprecated:function(t,e,i,s){void 0!==e&&console.warn(t+': "'+i+'" is deprecated. Please use "'+s+'" instead')},resolveObjectKey:lt,_capitalize:ht,defined:ct,isFunction:dt,setsEqual:ut,_isClickEvent:ft,toFontString:Ut,_measureText:Xt,_longestText:qt,_alignPixel:Kt,clearCanvas:Gt,drawPoint:Zt,_isPointInArea:Jt,clipArea:Qt,unclipArea:te,_steppedLineTo:ee,_bezierCurveTo:ie,renderText:se,addRoundedRectPath:oe,_lookup:ae,_lookupByKey:re,_rlookupByKey:le,_filterBetween:he,listenArrayEvents:de,unlistenArrayEvents:ue,_arrayUnique:fe,_createResolver:oi,_attachContext:ai,_descriptors:ri,splineCurve:vi,splineCurveMonotone:wi,_updateBezierControlPoints:ki,_isDomSupported:ge,_getParentNode:pe,getStyle:be,getRelativePosition:ve,getMaximumSize:Me,retinaScale:ke,supportsEventListenerOptions:Se,readUsedSize:Pe,fontString:function(t,e,i){return e+" "+t+"px "+i},requestAnimFrame:t,throttled:e,debounce:i,_toLeftRightCenter:s,_alignStartEnd:n,_textX:o,_pointInLine:Oi,_steppedInterpolation:Ai,_bezierInterpolation:Ti,formatNumber:Ri,toLineHeight:Fe,_readValueToProps:Be,toTRBL:Ve,toTRBLCorners:We,toPadding:Ne,toFont:He,resolve:je,_addGrace:$e,createContext:Ye,PI:_t,TAU:yt,PITAU:vt,INFINITY:wt,RAD_PER_DEG:Mt,HALF_PI:kt,QUARTER_PI:St,TWO_THIRDS_PI:Pt,log10:Dt,sign:Ct,niceNum:Ot,_factorize:At,isNumber:Tt,almostEquals:Lt,almostWhole:Rt,_setMinAndMaxByKey:Et,toRadians:It,toDegrees:zt,_decimalPlaces:Ft,getAngleFromPoint:Bt,distanceBetweenPoints:Vt,_angleDiff:Wt,_normalizeAngle:Nt,_angleBetween:Ht,_limitValue:jt,_int16Range:$t,_isBetween:Yt,getRtlAdapter:Ei,overrideTextDirection:Ii,restoreTextDirection:zi,_boundSegment:Vi,_boundSegments:Wi,_computeSegments:Ni});class Ui{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,i){}removeEventListener(t,e,i){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,i,s){return e=Math.max(0,e||t.width),i=i||t.height,{width:e,height:Math.max(0,s?Math.floor(e/s):i)}}isAttached(t){return!0}updateConfig(t){}}class Xi extends Ui{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const qi={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Ki=t=>null===t||""===t;const Gi=!!Se&&{passive:!0};function Zi(t,e,i){t.canvas.removeEventListener(e,i,Gi)}function Ji(t,e){for(const i of t)if(i===e||i.contains(e))return!0}function Qi(t,e,i){const s=t.canvas,n=new MutationObserver((t=>{let e=!1;for(const i of t)e=e||Ji(i.addedNodes,s),e=e&&!Ji(i.removedNodes,s);e&&i()}));return n.observe(document,{childList:!0,subtree:!0}),n}function ts(t,e,i){const s=t.canvas,n=new MutationObserver((t=>{let e=!1;for(const i of t)e=e||Ji(i.removedNodes,s),e=e&&!Ji(i.addedNodes,s);e&&i()}));return n.observe(document,{childList:!0,subtree:!0}),n}const es=new Map;let is=0;function ss(){const t=window.devicePixelRatio;t!==is&&(is=t,es.forEach(((e,i)=>{i.currentDevicePixelRatio!==t&&e()})))}function ns(t,i,s){const n=t.canvas,o=n&&pe(n);if(!o)return;const a=e(((t,e)=>{const i=o.clientWidth;s(t,e),i<o.clientWidth&&s()}),window),r=new ResizeObserver((t=>{const e=t[0],i=e.contentRect.width,s=e.contentRect.height;0===i&&0===s||a(i,s)}));return r.observe(o),function(t,e){es.size||window.addEventListener("resize",ss),es.set(t,e)}(t,a),r}function os(t,e,i){i&&i.disconnect(),"resize"===e&&function(t){es.delete(t),es.size||window.removeEventListener("resize",ss)}(t)}function as(t,i,s){const n=t.canvas,o=e((e=>{null!==t.ctx&&s(function(t,e){const i=qi[t.type]||t.type,{x:s,y:n}=ve(t,e);return{type:i,chart:e,native:t,x:void 0!==s?s:null,y:void 0!==n?n:null}}(e,t))}),t,(t=>{const e=t[0];return[e,e.offsetX,e.offsetY]}));return function(t,e,i){t.addEventListener(e,i,Gi)}(n,i,o),o}class rs extends Ui{acquireContext(t,e){const i=t&&t.getContext&&t.getContext("2d");return i&&i.canvas===t?(function(t,e){const i=t.style,s=t.getAttribute("height"),n=t.getAttribute("width");if(t.$chartjs={initial:{height:s,width:n,style:{display:i.display,height:i.height,width:i.width}}},i.display=i.display||"block",i.boxSizing=i.boxSizing||"border-box",Ki(n)){const e=Pe(t,"width");void 0!==e&&(t.width=e)}if(Ki(s))if(""===t.style.height)t.height=t.width/(e||2);else{const e=Pe(t,"height");void 0!==e&&(t.height=e)}}(t,e),i):null}releaseContext(t){const e=t.canvas;if(!e.$chartjs)return!1;const i=e.$chartjs.initial;["height","width"].forEach((t=>{const s=i[t];$(s)?e.removeAttribute(t):e.setAttribute(t,s)}));const s=i.style||{};return Object.keys(s).forEach((t=>{e.style[t]=s[t]})),e.width=e.width,delete e.$chartjs,!0}addEventListener(t,e,i){this.removeEventListener(t,e);const s=t.$proxies||(t.$proxies={}),n={attach:Qi,detach:ts,resize:ns}[e]||as;s[e]=n(t,e,i)}removeEventListener(t,e){const i=t.$proxies||(t.$proxies={}),s=i[e];if(!s)return;({attach:os,detach:os,resize:os}[e]||Zi)(t,e,s),i[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,i,s){return Me(t,e,i,s)}isAttached(t){const e=pe(t);return!(!e||!e.isConnected)}}function ls(t){return!ge()||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas?Xi:rs}var hs=Object.freeze({__proto__:null,_detectPlatform:ls,BasePlatform:Ui,BasicPlatform:Xi,DomPlatform:rs});const cs="transparent",ds={boolean:(t,e,i)=>i>.5?e:t,color(t,e,i){const s=W(t||cs),n=s.valid&&W(e||cs);return n&&n.valid?n.mix(s,i).hexString():e},number:(t,e,i)=>t+(e-t)*i};class us{constructor(t,e,i,s){const n=e[i];s=je([t.to,s,n,t.from]);const o=je([t.from,n,s]);this._active=!0,this._fn=t.fn||ds[t.type||typeof o],this._easing=Ci[t.easing]||Ci.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=i,this._from=o,this._to=s,this._promises=void 0}active(){return this._active}update(t,e,i){if(this._active){this._notify(!1);const s=this._target[this._prop],n=i-this._start,o=this._duration-n;this._start=i,this._duration=Math.floor(Math.max(o,t.duration)),this._total+=n,this._loop=!!t.loop,this._to=je([t.to,e,s,t.from]),this._from=je([t.from,s,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,i=this._duration,s=this._prop,n=this._from,o=this._loop,a=this._to;let r;if(this._active=n!==a&&(o||e<i),!this._active)return this._target[s]=a,void this._notify(!0);e<0?this._target[s]=n:(r=e/i%2,r=o&&r>1?2-r:r,r=this._easing(Math.min(1,Math.max(0,r))),this._target[s]=this._fn(n,a,r))}wait(){const t=this._promises||(this._promises=[]);return new Promise(((e,i)=>{t.push({res:e,rej:i})}))}_notify(t){const e=t?"res":"rej",i=this._promises||[];for(let t=0;t<i.length;t++)i[t][e]()}}bt.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0});const fs=Object.keys(bt.animation);bt.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>"onProgress"!==t&&"onComplete"!==t&&"fn"!==t}),bt.set("animations",{colors:{type:"color",properties:["color","borderColor","backgroundColor"]},numbers:{type:"number",properties:["x","y","borderWidth","radius","tension"]}}),bt.describe("animations",{_fallback:"animation"}),bt.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>0|t}}}});class gs{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!U(t))return;const e=this._properties;Object.getOwnPropertyNames(t).forEach((i=>{const s=t[i];if(!U(s))return;const n={};for(const t of fs)n[t]=s[t];(Y(s.properties)&&s.properties||[i]).forEach((t=>{t!==i&&e.has(t)||e.set(t,n)}))}))}_animateOptions(t,e){const i=e.options,s=function(t,e){if(!e)return;let i=t.options;if(!i)return void(t.options=e);i.$shared&&(t.options=i=Object.assign({},i,{$shared:!1,$animations:{}}));return i}(t,i);if(!s)return[];const n=this._createAnimations(s,i);return i.$shared&&function(t,e){const i=[],s=Object.keys(e);for(let e=0;e<s.length;e++){const n=t[s[e]];n&&n.active()&&i.push(n.wait())}return Promise.all(i)}(t.options.$animations,i).then((()=>{t.options=i}),(()=>{})),n}_createAnimations(t,e){const i=this._properties,s=[],n=t.$animations||(t.$animations={}),o=Object.keys(e),a=Date.now();let r;for(r=o.length-1;r>=0;--r){const l=o[r];if("$"===l.charAt(0))continue;if("options"===l){s.push(...this._animateOptions(t,e));continue}const h=e[l];let c=n[l];const d=i.get(l);if(c){if(d&&c.active()){c.update(d,h,a);continue}c.cancel()}d&&d.duration?(n[l]=c=new us(d,t,l,h),s.push(c)):t[l]=h}return s}update(t,e){if(0===this._properties.size)return void Object.assign(t,e);const i=this._createAnimations(t,e);return i.length?(a.add(this._chart,i),!0):void 0}}function ps(t,e){const i=t&&t.options||{},s=i.reverse,n=void 0===i.min?e:0,o=void 0===i.max?e:0;return{start:s?o:n,end:s?n:o}}function ms(t,e){const i=[],s=t._getSortedDatasetMetas(e);let n,o;for(n=0,o=s.length;n<o;++n)i.push(s[n].index);return i}function xs(t,e,i,s={}){const n=t.keys,o="single"===s.mode;let a,r,l,h;if(null!==e){for(a=0,r=n.length;a<r;++a){if(l=+n[a],l===i){if(s.all)continue;break}h=t.values[l],X(h)&&(o||0===e||Ct(e)===Ct(h))&&(e+=h)}return e}}function bs(t,e){const i=t&&t.options.stacked;return i||void 0===i&&void 0!==e.stack}function _s(t,e,i){const s=t[e]||(t[e]={});return s[i]||(s[i]={})}function ys(t,e,i,s){for(const n of e.getMatchingVisibleMetas(s).reverse()){const e=t[n.index];if(i&&e>0||!i&&e<0)return n.index}return null}function vs(t,e){const{chart:i,_cachedMeta:s}=t,n=i._stacks||(i._stacks={}),{iScale:o,vScale:a,index:r}=s,l=o.axis,h=a.axis,c=function(t,e,i){return`${t.id}.${e.id}.${i.stack||i.type}`}(o,a,s),d=e.length;let u;for(let t=0;t<d;++t){const i=e[t],{[l]:o,[h]:d}=i;u=(i._stacks||(i._stacks={}))[h]=_s(n,c,o),u[r]=d,u._top=ys(u,a,!0,s.type),u._bottom=ys(u,a,!1,s.type)}}function ws(t,e){const i=t.scales;return Object.keys(i).filter((t=>i[t].axis===e)).shift()}function Ms(t,e){const i=t.controller.index,s=t.vScale&&t.vScale.axis;if(s){e=e||t._parsed;for(const t of e){const e=t._stacks;if(!e||void 0===e[s]||void 0===e[s][i])return;delete e[s][i]}}}const ks=t=>"reset"===t||"none"===t,Ss=(t,e)=>e?t:Object.assign({},t);class Ps{constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.$context=void 0,this._syncList=[],this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=bs(t.vScale,t),this.addElements()}updateIndex(t){this.index!==t&&Ms(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,i=this.getDataset(),s=(t,e,i,s)=>"x"===t?e:"r"===t?s:i,n=e.xAxisID=K(i.xAxisID,ws(t,"x")),o=e.yAxisID=K(i.yAxisID,ws(t,"y")),a=e.rAxisID=K(i.rAxisID,ws(t,"r")),r=e.indexAxis,l=e.iAxisID=s(r,n,o,a),h=e.vAxisID=s(r,o,n,a);e.xScale=this.getScaleForId(n),e.yScale=this.getScaleForId(o),e.rScale=this.getScaleForId(a),e.iScale=this.getScaleForId(l),e.vScale=this.getScaleForId(h)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&ue(this._data,this),t._stacked&&Ms(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),i=this._data;if(U(e))this._data=function(t){const e=Object.keys(t),i=new Array(e.length);let s,n,o;for(s=0,n=e.length;s<n;++s)o=e[s],i[s]={x:o,y:t[o]};return i}(e);else if(i!==e){if(i){ue(i,this);const t=this._cachedMeta;Ms(t),t._parsed=[]}e&&Object.isExtensible(e)&&de(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,i=this.getDataset();let s=!1;this._dataCheck();const n=e._stacked;e._stacked=bs(e.vScale,e),e.stack!==i.stack&&(s=!0,Ms(e),e.stack=i.stack),this._resyncElements(t),(s||n!==e._stacked)&&vs(this,e._parsed)}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),i=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:i,_data:s}=this,{iScale:n,_stacked:o}=i,a=n.axis;let r,l,h,c=0===t&&e===s.length||i._sorted,d=t>0&&i._parsed[t-1];if(!1===this._parsing)i._parsed=s,i._sorted=!0,h=s;else{h=Y(s[t])?this.parseArrayData(i,s,t,e):U(s[t])?this.parseObjectData(i,s,t,e):this.parsePrimitiveData(i,s,t,e);const n=()=>null===l[a]||d&&l[a]<d[a];for(r=0;r<e;++r)i._parsed[r+t]=l=h[r],c&&(n()&&(c=!1),d=l);i._sorted=c}o&&vs(this,h)}parsePrimitiveData(t,e,i,s){const{iScale:n,vScale:o}=t,a=n.axis,r=o.axis,l=n.getLabels(),h=n===o,c=new Array(s);let d,u,f;for(d=0,u=s;d<u;++d)f=d+i,c[d]={[a]:h||n.parse(l[f],f),[r]:o.parse(e[f],f)};return c}parseArrayData(t,e,i,s){const{xScale:n,yScale:o}=t,a=new Array(s);let r,l,h,c;for(r=0,l=s;r<l;++r)h=r+i,c=e[h],a[r]={x:n.parse(c[0],h),y:o.parse(c[1],h)};return a}parseObjectData(t,e,i,s){const{xScale:n,yScale:o}=t,{xAxisKey:a="x",yAxisKey:r="y"}=this._parsing,l=new Array(s);let h,c,d,u;for(h=0,c=s;h<c;++h)d=h+i,u=e[d],l[h]={x:n.parse(lt(u,a),d),y:o.parse(lt(u,r),d)};return l}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,i){const s=this.chart,n=this._cachedMeta,o=e[t.axis];return xs({keys:ms(s,!0),values:e._stacks[t.axis]},o,n.index,{mode:i})}updateRangeFromParsed(t,e,i,s){const n=i[e.axis];let o=null===n?NaN:n;const a=s&&i._stacks[e.axis];s&&a&&(s.values=a,o=xs(s,n,this._cachedMeta.index)),t.min=Math.min(t.min,o),t.max=Math.max(t.max,o)}getMinMax(t,e){const i=this._cachedMeta,s=i._parsed,n=i._sorted&&t===i.iScale,o=s.length,a=this._getOtherScale(t),r=((t,e,i)=>t&&!e.hidden&&e._stacked&&{keys:ms(i,!0),values:null})(e,i,this.chart),l={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:h,max:c}=function(t){const{min:e,max:i,minDefined:s,maxDefined:n}=t.getUserBounds();return{min:s?e:Number.NEGATIVE_INFINITY,max:n?i:Number.POSITIVE_INFINITY}}(a);let d,u;function f(){u=s[d];const e=u[a.axis];return!X(u[t.axis])||h>e||c<e}for(d=0;d<o&&(f()||(this.updateRangeFromParsed(l,t,u,r),!n));++d);if(n)for(d=o-1;d>=0;--d)if(!f()){this.updateRangeFromParsed(l,t,u,r);break}return l}getAllParsedValues(t){const e=this._cachedMeta._parsed,i=[];let s,n,o;for(s=0,n=e.length;s<n;++s)o=e[s][t.axis],X(o)&&i.push(o);return i}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,i=e.iScale,s=e.vScale,n=this.getParsed(t);return{label:i?""+i.getLabelForValue(n[i.axis]):"",value:s?""+s.getLabelForValue(n[s.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=function(t){let e,i,s,n;return U(t)?(e=t.top,i=t.right,s=t.bottom,n=t.left):e=i=s=n=t,{top:e,right:i,bottom:s,left:n,disabled:!1===t}}(K(this.options.clip,function(t,e,i){if(!1===i)return!1;const s=ps(t,i),n=ps(e,i);return{top:n.end,right:s.end,bottom:n.start,left:s.start}}(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,i=this._cachedMeta,s=i.data||[],n=e.chartArea,o=[],a=this._drawStart||0,r=this._drawCount||s.length-a,l=this.options.drawActiveElementsOnTop;let h;for(i.dataset&&i.dataset.draw(t,n,a,r),h=a;h<a+r;++h){const e=s[h];e.hidden||(e.active&&l?o.push(e):e.draw(t,n))}for(h=0;h<o.length;++h)o[h].draw(t,n)}getStyle(t,e){const i=e?"active":"default";return void 0===t&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(t||0,i)}getContext(t,e,i){const s=this.getDataset();let n;if(t>=0&&t<this._cachedMeta.data.length){const e=this._cachedMeta.data[t];n=e.$context||(e.$context=function(t,e,i){return Ye(t,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:i,index:e,mode:"default",type:"data"})}(this.getContext(),t,e)),n.parsed=this.getParsed(t),n.raw=s.data[t],n.index=n.dataIndex=t}else n=this.$context||(this.$context=function(t,e){return Ye(t,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),n.dataset=s,n.index=n.datasetIndex=this.index;return n.active=!!e,n.mode=i,n}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",i){const s="active"===e,n=this._cachedDataOpts,o=t+"-"+e,a=n[o],r=this.enableOptionSharing&&ct(i);if(a)return Ss(a,r);const l=this.chart.config,h=l.datasetElementScopeKeys(this._type,t),c=s?[`${t}Hover`,"hover",t,""]:[t,""],d=l.getOptionScopes(this.getDataset(),h),u=Object.keys(bt.elements[t]),f=l.resolveNamedOptions(d,u,(()=>this.getContext(i,s)),c);return f.$shared&&(f.$shared=r,n[o]=Object.freeze(Ss(f,r))),f}_resolveAnimations(t,e,i){const s=this.chart,n=this._cachedDataOpts,o=`animation-${e}`,a=n[o];if(a)return a;let r;if(!1!==s.options.animation){const s=this.chart.config,n=s.datasetAnimationScopeKeys(this._type,e),o=s.getOptionScopes(this.getDataset(),n);r=s.createResolver(o,this.getContext(t,i,e))}const l=new gs(s,r&&r.animations);return r&&r._cacheable&&(n[o]=Object.freeze(l)),l}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||ks(t)||this.chart._animationsDisabled}updateElement(t,e,i,s){ks(s)?Object.assign(t,i):this._resolveAnimations(e,s).update(t,i)}updateSharedOptions(t,e,i){t&&!ks(e)&&this._resolveAnimations(void 0,e).update(t,i)}_setStyle(t,e,i,s){t.active=s;const n=this.getStyle(e,s);this._resolveAnimations(e,i,s).update(t,{options:!s&&this.getSharedOptions(n)||n})}removeHoverStyle(t,e,i){this._setStyle(t,i,"active",!1)}setHoverStyle(t,e,i){this._setStyle(t,i,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,i=this._cachedMeta.data;for(const[t,e,i]of this._syncList)this[t](e,i);this._syncList=[];const s=i.length,n=e.length,o=Math.min(n,s);o&&this.parse(0,o),n>s?this._insertElements(s,n-s,t):n<s&&this._removeElements(n,s-n)}_insertElements(t,e,i=!0){const s=this._cachedMeta,n=s.data,o=t+e;let a;const r=t=>{for(t.length+=e,a=t.length-1;a>=o;a--)t[a]=t[a-e]};for(r(n),a=t;a<o;++a)n[a]=new this.dataElementType;this._parsing&&r(s._parsed),this.parse(t,e),i&&this.updateElements(n,t,e,"reset")}updateElements(t,e,i,s){}_removeElements(t,e){const i=this._cachedMeta;if(this._parsing){const s=i._parsed.splice(t,e);i._stacked&&Ms(i,s)}i.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,i,s]=t;this[e](i,s)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const i=arguments.length-2;i&&this._sync(["_insertElements",t,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}Ps.defaults={},Ps.prototype.datasetElementType=null,Ps.prototype.dataElementType=null;class Ds{constructor(){this.x=void 0,this.y=void 0,this.active=!1,this.options=void 0,this.$animations=void 0}tooltipPosition(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}hasValue(){return Tt(this.x)&&Tt(this.y)}getProps(t,e){const i=this.$animations;if(!e||!i)return this;const s={};return t.forEach((t=>{s[t]=i[t]&&i[t].active()?i[t]._to:this[t]})),s}}Ds.defaults={},Ds.defaultRoutes=void 0;const Cs={values:t=>Y(t)?t:""+t,numeric(t,e,i){if(0===t)return"0";const s=this.chart.options.locale;let n,o=t;if(i.length>1){const e=Math.max(Math.abs(i[0].value),Math.abs(i[i.length-1].value));(e<1e-4||e>1e15)&&(n="scientific"),o=function(t,e){let i=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;Math.abs(i)>=1&&t!==Math.floor(t)&&(i=t-Math.floor(t));return i}(t,i)}const a=Dt(Math.abs(o)),r=Math.max(Math.min(-1*Math.floor(a),20),0),l={notation:n,minimumFractionDigits:r,maximumFractionDigits:r};return Object.assign(l,this.options.ticks.format),Ri(t,s,l)},logarithmic(t,e,i){if(0===t)return"0";const s=t/Math.pow(10,Math.floor(Dt(t)));return 1===s||2===s||5===s?Cs.numeric.call(this,t,e,i):""}};var Os={formatters:Cs};function As(t,e){const i=t.options.ticks,s=i.maxTicksLimit||function(t){const e=t.options.offset,i=t._tickSize(),s=t._length/i+(e?0:1),n=t._maxLength/i;return Math.floor(Math.min(s,n))}(t),n=i.major.enabled?function(t){const e=[];let i,s;for(i=0,s=t.length;i<s;i++)t[i].major&&e.push(i);return e}(e):[],o=n.length,a=n[0],r=n[o-1],l=[];if(o>s)return function(t,e,i,s){let n,o=0,a=i[0];for(s=Math.ceil(s),n=0;n<t.length;n++)n===a&&(e.push(t[n]),o++,a=i[o*s])}(e,l,n,o/s),l;const h=function(t,e,i){const s=function(t){const e=t.length;let i,s;if(e<2)return!1;for(s=t[0],i=1;i<e;++i)if(t[i]-t[i-1]!==s)return!1;return s}(t),n=e.length/i;if(!s)return Math.max(n,1);const o=At(s);for(let t=0,e=o.length-1;t<e;t++){const e=o[t];if(e>n)return e}return Math.max(n,1)}(n,e,s);if(o>0){let t,i;const s=o>1?Math.round((r-a)/(o-1)):null;for(Ts(e,l,h,$(s)?0:a-s,a),t=0,i=o-1;t<i;t++)Ts(e,l,h,n[t],n[t+1]);return Ts(e,l,h,r,$(s)?e.length:r+s),l}return Ts(e,l,h),l}function Ts(t,e,i,s,n){const o=K(s,0),a=Math.min(K(n,t.length),t.length);let r,l,h,c=0;for(i=Math.ceil(i),n&&(r=n-s,i=r/Math.floor(r/i)),h=o;h<0;)c++,h=Math.round(o+c*i);for(l=Math.max(o,0);l<a;l++)l===h&&(e.push(t[l]),c++,h=Math.round(o+c*i))}bt.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1,borderDash:[],borderDashOffset:0,borderWidth:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Os.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),bt.route("scale.ticks","color","","color"),bt.route("scale.grid","color","","borderColor"),bt.route("scale.grid","borderColor","","borderColor"),bt.route("scale.title","color","","color"),bt.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&"callback"!==t&&"parser"!==t,_indexable:t=>"borderDash"!==t&&"tickBorderDash"!==t}),bt.describe("scales",{_fallback:"scale"}),bt.describe("scale.ticks",{_scriptable:t=>"backdropPadding"!==t&&"callback"!==t,_indexable:t=>"backdropPadding"!==t});const Ls=(t,e,i)=>"top"===e||"left"===e?t[e]+i:t[e]-i;function Rs(t,e){const i=[],s=t.length/e,n=t.length;let o=0;for(;o<n;o+=s)i.push(t[Math.floor(o)]);return i}function Es(t,e,i){const s=t.ticks.length,n=Math.min(e,s-1),o=t._startPixel,a=t._endPixel,r=1e-6;let l,h=t.getPixelForTick(n);if(!(i&&(l=1===s?Math.max(h-o,a-h):0===e?(t.getPixelForTick(1)-h)/2:(h-t.getPixelForTick(n-1))/2,h+=n<e?l:-l,h<o-r||h>a+r)))return h}function Is(t){return t.drawTicks?t.tickLength:0}function zs(t,e){if(!t.display)return 0;const i=He(t.font,e),s=Ne(t.padding);return(Y(t.text)?t.text.length:1)*i.lineHeight+s.height}function Fs(t,e,i){let n=s(t);return(i&&"right"!==e||!i&&"right"===e)&&(n=(t=>"left"===t?"right":"right"===t?"left":t)(n)),n}class Bs extends Ds{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:i,_suggestedMax:s}=this;return t=q(t,Number.POSITIVE_INFINITY),e=q(e,Number.NEGATIVE_INFINITY),i=q(i,Number.POSITIVE_INFINITY),s=q(s,Number.NEGATIVE_INFINITY),{min:q(t,i),max:q(e,s),minDefined:X(t),maxDefined:X(e)}}getMinMax(t){let e,{min:i,max:s,minDefined:n,maxDefined:o}=this.getUserBounds();if(n&&o)return{min:i,max:s};const a=this.getMatchingVisibleMetas();for(let r=0,l=a.length;r<l;++r)e=a[r].controller.getMinMax(this,t),n||(i=Math.min(i,e.min)),o||(s=Math.max(s,e.max));return i=o&&i>s?s:i,s=n&&i>s?i:s,{min:q(i,q(s,i)),max:q(s,q(i,s))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){J(this.options.beforeUpdate,[this])}update(t,e,i){const{beginAtZero:s,grace:n,ticks:o}=this.options,a=o.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=$e(this,n,s),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const r=a<this.ticks.length;this._convertTicksToLabels(r?Rs(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||"auto"===o.source)&&(this.ticks=As(this,this.ticks),this._labelSizes=null),r&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t,e,i=this.options.reverse;this.isHorizontal()?(t=this.left,e=this.right):(t=this.top,e=this.bottom,i=!i),this._startPixel=t,this._endPixel=e,this._reversePixels=i,this._length=e-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){J(this.options.afterUpdate,[this])}beforeSetDimensions(){J(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){J(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),J(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){J(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let i,s,n;for(i=0,s=t.length;i<s;i++)n=t[i],n.label=J(e.callback,[n.value,i,t],this)}afterTickToLabelConversion(){J(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){J(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,i=this.ticks.length,s=e.minRotation||0,n=e.maxRotation;let o,a,r,l=s;if(!this._isVisible()||!e.display||s>=n||i<=1||!this.isHorizontal())return void(this.labelRotation=s);const h=this._getLabelSizes(),c=h.widest.width,d=h.highest.height,u=jt(this.chart.width-c,0,this.maxWidth);o=t.offset?this.maxWidth/i:u/(i-1),c+6>o&&(o=u/(i-(t.offset?.5:1)),a=this.maxHeight-Is(t.grid)-e.padding-zs(t.title,this.chart.options.font),r=Math.sqrt(c*c+d*d),l=zt(Math.min(Math.asin(jt((h.highest.height+6)/o,-1,1)),Math.asin(jt(a/r,-1,1))-Math.asin(jt(d/r,-1,1)))),l=Math.max(s,Math.min(n,l))),this.labelRotation=l}afterCalculateLabelRotation(){J(this.options.afterCalculateLabelRotation,[this])}beforeFit(){J(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:i,title:s,grid:n}}=this,o=this._isVisible(),a=this.isHorizontal();if(o){const o=zs(s,e.options.font);if(a?(t.width=this.maxWidth,t.height=Is(n)+o):(t.height=this.maxHeight,t.width=Is(n)+o),i.display&&this.ticks.length){const{first:e,last:s,widest:n,highest:o}=this._getLabelSizes(),r=2*i.padding,l=It(this.labelRotation),h=Math.cos(l),c=Math.sin(l);if(a){const e=i.mirror?0:c*n.width+h*o.height;t.height=Math.min(this.maxHeight,t.height+e+r)}else{const e=i.mirror?0:h*n.width+c*o.height;t.width=Math.min(this.maxWidth,t.width+e+r)}this._calculatePadding(e,s,c,h)}}this._handleMargins(),a?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,i,s){const{ticks:{align:n,padding:o},position:a}=this.options,r=0!==this.labelRotation,l="top"!==a&&"x"===this.axis;if(this.isHorizontal()){const a=this.getPixelForTick(0)-this.left,h=this.right-this.getPixelForTick(this.ticks.length-1);let c=0,d=0;r?l?(c=s*t.width,d=i*e.height):(c=i*t.height,d=s*e.width):"start"===n?d=e.width:"end"===n?c=t.width:(c=t.width/2,d=e.width/2),this.paddingLeft=Math.max((c-a+o)*this.width/(this.width-a),0),this.paddingRight=Math.max((d-h+o)*this.width/(this.width-h),0)}else{let i=e.height/2,s=t.height/2;"start"===n?(i=0,s=t.height):"end"===n&&(i=e.height,s=0),this.paddingTop=i+o,this.paddingBottom=s+o}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){J(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return"top"===e||"bottom"===e||"x"===t}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){let e,i;for(this.beforeTickToLabelConversion(),this.generateTickLabels(t),e=0,i=t.length;e<i;e++)$(t[e].label)&&(t.splice(e,1),i--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let i=this.ticks;e<i.length&&(i=Rs(i,e)),this._labelSizes=t=this._computeLabelSizes(i,i.length)}return t}_computeLabelSizes(t,e){const{ctx:i,_longestTextCache:s}=this,n=[],o=[];let a,r,l,h,c,d,u,f,g,p,m,x=0,b=0;for(a=0;a<e;++a){if(h=t[a].label,c=this._resolveTickFontOptions(a),i.font=d=c.string,u=s[d]=s[d]||{data:{},gc:[]},f=c.lineHeight,g=p=0,$(h)||Y(h)){if(Y(h))for(r=0,l=h.length;r<l;++r)m=h[r],$(m)||Y(m)||(g=Xt(i,u.data,u.gc,g,m),p+=f)}else g=Xt(i,u.data,u.gc,g,h),p=f;n.push(g),o.push(p),x=Math.max(g,x),b=Math.max(p,b)}!function(t,e){Q(t,(t=>{const i=t.gc,s=i.length/2;let n;if(s>e){for(n=0;n<s;++n)delete t.data[i[n]];i.splice(0,s)}}))}(s,e);const _=n.indexOf(x),y=o.indexOf(b),v=t=>({width:n[t]||0,height:o[t]||0});return{first:v(0),last:v(e-1),widest:v(_),highest:v(y),widths:n,heights:o}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return $t(this._alignToPixels?Kt(this.chart,e,0):e)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const i=e[t];return i.$context||(i.$context=function(t,e,i){return Ye(t,{tick:i,index:e,type:"tick"})}(this.getContext(),t,i))}return this.$context||(this.$context=Ye(this.chart.getContext(),{scale:this,type:"scale"}))}_tickSize(){const t=this.options.ticks,e=It(this.labelRotation),i=Math.abs(Math.cos(e)),s=Math.abs(Math.sin(e)),n=this._getLabelSizes(),o=t.autoSkipPadding||0,a=n?n.widest.width+o:0,r=n?n.highest.height+o:0;return this.isHorizontal()?r*i>a*s?a/i:r/s:r*s<a*i?r/i:a/s}_isVisible(){const t=this.options.display;return"auto"!==t?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,i=this.chart,s=this.options,{grid:n,position:o}=s,a=n.offset,r=this.isHorizontal(),l=this.ticks.length+(a?1:0),h=Is(n),c=[],d=n.setContext(this.getContext()),u=d.drawBorder?d.borderWidth:0,f=u/2,g=function(t){return Kt(i,t,u)};let p,m,x,b,_,y,v,w,M,k,S,P;if("top"===o)p=g(this.bottom),y=this.bottom-h,w=p-f,k=g(t.top)+f,P=t.bottom;else if("bottom"===o)p=g(this.top),k=t.top,P=g(t.bottom)-f,y=p+f,w=this.top+h;else if("left"===o)p=g(this.right),_=this.right-h,v=p-f,M=g(t.left)+f,S=t.right;else if("right"===o)p=g(this.left),M=t.left,S=g(t.right)-f,_=p+f,v=this.left+h;else if("x"===e){if("center"===o)p=g((t.top+t.bottom)/2+.5);else if(U(o)){const t=Object.keys(o)[0],e=o[t];p=g(this.chart.scales[t].getPixelForValue(e))}k=t.top,P=t.bottom,y=p+f,w=y+h}else if("y"===e){if("center"===o)p=g((t.left+t.right)/2);else if(U(o)){const t=Object.keys(o)[0],e=o[t];p=g(this.chart.scales[t].getPixelForValue(e))}_=p-f,v=_-h,M=t.left,S=t.right}const D=K(s.ticks.maxTicksLimit,l),C=Math.max(1,Math.ceil(l/D));for(m=0;m<l;m+=C){const t=n.setContext(this.getContext(m)),e=t.lineWidth,s=t.color,o=n.borderDash||[],l=t.borderDashOffset,h=t.tickWidth,d=t.tickColor,u=t.tickBorderDash||[],f=t.tickBorderDashOffset;x=Es(this,m,a),void 0!==x&&(b=Kt(i,x,e),r?_=v=M=S=b:y=w=k=P=b,c.push({tx1:_,ty1:y,tx2:v,ty2:w,x1:M,y1:k,x2:S,y2:P,width:e,color:s,borderDash:o,borderDashOffset:l,tickWidth:h,tickColor:d,tickBorderDash:u,tickBorderDashOffset:f}))}return this._ticksLength=l,this._borderValue=p,c}_computeLabelItems(t){const e=this.axis,i=this.options,{position:s,ticks:n}=i,o=this.isHorizontal(),a=this.ticks,{align:r,crossAlign:l,padding:h,mirror:c}=n,d=Is(i.grid),u=d+h,f=c?-h:u,g=-It(this.labelRotation),p=[];let m,x,b,_,y,v,w,M,k,S,P,D,C="middle";if("top"===s)v=this.bottom-f,w=this._getXAxisLabelAlignment();else if("bottom"===s)v=this.top+f,w=this._getXAxisLabelAlignment();else if("left"===s){const t=this._getYAxisLabelAlignment(d);w=t.textAlign,y=t.x}else if("right"===s){const t=this._getYAxisLabelAlignment(d);w=t.textAlign,y=t.x}else if("x"===e){if("center"===s)v=(t.top+t.bottom)/2+u;else if(U(s)){const t=Object.keys(s)[0],e=s[t];v=this.chart.scales[t].getPixelForValue(e)+u}w=this._getXAxisLabelAlignment()}else if("y"===e){if("center"===s)y=(t.left+t.right)/2-u;else if(U(s)){const t=Object.keys(s)[0],e=s[t];y=this.chart.scales[t].getPixelForValue(e)}w=this._getYAxisLabelAlignment(d).textAlign}"y"===e&&("start"===r?C="top":"end"===r&&(C="bottom"));const O=this._getLabelSizes();for(m=0,x=a.length;m<x;++m){b=a[m],_=b.label;const t=n.setContext(this.getContext(m));M=this.getPixelForTick(m)+n.labelOffset,k=this._resolveTickFontOptions(m),S=k.lineHeight,P=Y(_)?_.length:1;const e=P/2,i=t.color,r=t.textStrokeColor,h=t.textStrokeWidth;let d;if(o?(y=M,D="top"===s?"near"===l||0!==g?-P*S+S/2:"center"===l?-O.highest.height/2-e*S+S:-O.highest.height+S/2:"near"===l||0!==g?S/2:"center"===l?O.highest.height/2-e*S:O.highest.height-P*S,c&&(D*=-1)):(v=M,D=(1-P)*S/2),t.showLabelBackdrop){const e=Ne(t.backdropPadding),i=O.heights[m],s=O.widths[m];let n=v+D-e.top,o=y-e.left;switch(C){case"middle":n-=i/2;break;case"bottom":n-=i}switch(w){case"center":o-=s/2;break;case"right":o-=s}d={left:o,top:n,width:s+e.width,height:i+e.height,color:t.backdropColor}}p.push({rotation:g,label:_,font:k,color:i,strokeColor:r,strokeWidth:h,textOffset:D,textAlign:w,textBaseline:C,translation:[y,v],backdrop:d})}return p}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-It(this.labelRotation))return"top"===t?"left":"right";let i="center";return"start"===e.align?i="left":"end"===e.align&&(i="right"),i}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:i,mirror:s,padding:n}}=this.options,o=t+n,a=this._getLabelSizes().widest.width;let r,l;return"left"===e?s?(l=this.right+n,"near"===i?r="left":"center"===i?(r="center",l+=a/2):(r="right",l+=a)):(l=this.right-o,"near"===i?r="right":"center"===i?(r="center",l-=a/2):(r="left",l=this.left)):"right"===e?s?(l=this.left+n,"near"===i?r="right":"center"===i?(r="center",l-=a/2):(r="left",l-=a)):(l=this.left+o,"near"===i?r="left":"center"===i?(r="center",l+=a/2):(r="right",l=this.right)):r="right",{textAlign:r,x:l}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;return"left"===e||"right"===e?{top:0,left:this.left,bottom:t.height,right:this.right}:"top"===e||"bottom"===e?{top:this.top,left:0,bottom:this.bottom,right:t.width}:void 0}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:i,top:s,width:n,height:o}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(i,s,n,o),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const i=this.ticks.findIndex((e=>e.value===t));if(i>=0){return e.setContext(this.getContext(i)).lineWidth}return 0}drawGrid(t){const e=this.options.grid,i=this.ctx,s=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let n,o;const a=(t,e,s)=>{s.width&&s.color&&(i.save(),i.lineWidth=s.width,i.strokeStyle=s.color,i.setLineDash(s.borderDash||[]),i.lineDashOffset=s.borderDashOffset,i.beginPath(),i.moveTo(t.x,t.y),i.lineTo(e.x,e.y),i.stroke(),i.restore())};if(e.display)for(n=0,o=s.length;n<o;++n){const t=s[n];e.drawOnChartArea&&a({x:t.x1,y:t.y1},{x:t.x2,y:t.y2},t),e.drawTicks&&a({x:t.tx1,y:t.ty1},{x:t.tx2,y:t.ty2},{color:t.tickColor,width:t.tickWidth,borderDash:t.tickBorderDash,borderDashOffset:t.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{grid:i}}=this,s=i.setContext(this.getContext()),n=i.drawBorder?s.borderWidth:0;if(!n)return;const o=i.setContext(this.getContext(0)).lineWidth,a=this._borderValue;let r,l,h,c;this.isHorizontal()?(r=Kt(t,this.left,n)-n/2,l=Kt(t,this.right,o)+o/2,h=c=a):(h=Kt(t,this.top,n)-n/2,c=Kt(t,this.bottom,o)+o/2,r=l=a),e.save(),e.lineWidth=s.borderWidth,e.strokeStyle=s.borderColor,e.beginPath(),e.moveTo(r,h),e.lineTo(l,c),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const e=this.ctx,i=this._computeLabelArea();i&&Qt(e,i);const s=this._labelItems||(this._labelItems=this._computeLabelItems(t));let n,o;for(n=0,o=s.length;n<o;++n){const t=s[n],i=t.font,o=t.label;t.backdrop&&(e.fillStyle=t.backdrop.color,e.fillRect(t.backdrop.left,t.backdrop.top,t.backdrop.width,t.backdrop.height)),se(e,o,0,t.textOffset,i,t)}i&&te(e)}drawTitle(){const{ctx:t,options:{position:e,title:i,reverse:s}}=this;if(!i.display)return;const o=He(i.font),a=Ne(i.padding),r=i.align;let l=o.lineHeight/2;"bottom"===e||"center"===e||U(e)?(l+=a.bottom,Y(i.text)&&(l+=o.lineHeight*(i.text.length-1))):l+=a.top;const{titleX:h,titleY:c,maxWidth:d,rotation:u}=function(t,e,i,s){const{top:o,left:a,bottom:r,right:l,chart:h}=t,{chartArea:c,scales:d}=h;let u,f,g,p=0;const m=r-o,x=l-a;if(t.isHorizontal()){if(f=n(s,a,l),U(i)){const t=Object.keys(i)[0],s=i[t];g=d[t].getPixelForValue(s)+m-e}else g="center"===i?(c.bottom+c.top)/2+m-e:Ls(t,i,e);u=l-a}else{if(U(i)){const t=Object.keys(i)[0],s=i[t];f=d[t].getPixelForValue(s)-x+e}else f="center"===i?(c.left+c.right)/2-x+e:Ls(t,i,e);g=n(s,r,o),p="left"===i?-kt:kt}return{titleX:f,titleY:g,maxWidth:u,rotation:p}}(this,l,e,r);se(t,i.text,0,0,o,{color:i.color,maxWidth:d,rotation:u,textAlign:Fs(r,e,s),textBaseline:"middle",translation:[h,c]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,i=K(t.grid&&t.grid.z,-1);return this._isVisible()&&this.draw===Bs.prototype.draw?[{z:i,draw:t=>{this.drawBackground(),this.drawGrid(t),this.drawTitle()}},{z:i+1,draw:()=>{this.drawBorder()}},{z:e,draw:t=>{this.drawLabels(t)}}]:[{z:e,draw:t=>{this.draw(t)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",s=[];let n,o;for(n=0,o=e.length;n<o;++n){const o=e[n];o[i]!==this.id||t&&o.type!==t||s.push(o)}return s}_resolveTickFontOptions(t){return He(this.options.ticks.setContext(this.getContext(t)).font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class Vs{constructor(t,e,i){this.type=t,this.scope=e,this.override=i,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let i;(function(t){return"id"in t&&"defaults"in t})(e)&&(i=this.register(e));const s=this.items,n=t.id,o=this.scope+"."+n;if(!n)throw new Error("class does not have id: "+t);return n in s||(s[n]=t,function(t,e,i){const s=nt(Object.create(null),[i?bt.get(i):{},bt.get(e),t.defaults]);bt.set(e,s),t.defaultRoutes&&function(t,e){Object.keys(e).forEach((i=>{const s=i.split("."),n=s.pop(),o=[t].concat(s).join("."),a=e[i].split("."),r=a.pop(),l=a.join(".");bt.route(o,n,l,r)}))}(e,t.defaultRoutes);t.descriptors&&bt.describe(e,t.descriptors)}(t,o,i),this.override&&bt.override(t.id,t.overrides)),o}get(t){return this.items[t]}unregister(t){const e=this.items,i=t.id,s=this.scope;i in e&&delete e[i],s&&i in bt[s]&&(delete bt[s][i],this.override&&delete gt[i])}}var Ws=new class{constructor(){this.controllers=new Vs(Ps,"datasets",!0),this.elements=new Vs(Ds,"elements"),this.plugins=new Vs(Object,"plugins"),this.scales=new Vs(Bs,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,i){[...e].forEach((e=>{const s=i||this._getRegistryForType(e);i||s.isForType(e)||s===this.plugins&&e.id?this._exec(t,s,e):Q(e,(e=>{const s=i||this._getRegistryForType(e);this._exec(t,s,e)}))}))}_exec(t,e,i){const s=ht(t);J(i["before"+s],[],i),e[t](i),J(i["after"+s],[],i)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const i=this._typedRegistries[e];if(i.isForType(t))return i}return this.plugins}_get(t,e,i){const s=e.get(t);if(void 0===s)throw new Error('"'+t+'" is not a registered '+i+".");return s}};class Ns{constructor(){this._init=[]}notify(t,e,i,s){"beforeInit"===e&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install"));const n=s?this._descriptors(t).filter(s):this._descriptors(t),o=this._notify(n,t,e,i);return"afterDestroy"===e&&(this._notify(n,t,"stop"),this._notify(this._init,t,"uninstall")),o}_notify(t,e,i,s){s=s||{};for(const n of t){const t=n.plugin;if(!1===J(t[i],[e,s,n.options],t)&&s.cancelable)return!1}return!0}invalidate(){$(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const i=t&&t.config,s=K(i.options&&i.options.plugins,{}),n=function(t){const e=[],i=Object.keys(Ws.plugins.items);for(let t=0;t<i.length;t++)e.push(Ws.getPlugin(i[t]));const s=t.plugins||[];for(let t=0;t<s.length;t++){const i=s[t];-1===e.indexOf(i)&&e.push(i)}return e}(i);return!1!==s||e?function(t,e,i,s){const n=[],o=t.getContext();for(let a=0;a<e.length;a++){const r=e[a],l=Hs(i[r.id],s);null!==l&&n.push({plugin:r,options:js(t.config,r,l,o)})}return n}(t,n,s,e):[]}_notifyStateChanges(t){const e=this._oldCache||[],i=this._cache,s=(t,e)=>t.filter((t=>!e.some((e=>t.plugin.id===e.plugin.id))));this._notify(s(e,i),t,"stop"),this._notify(s(i,e),t,"start")}}function Hs(t,e){return e||!1!==t?!0===t?{}:t:null}function js(t,e,i,s){const n=t.pluginScopeKeys(e),o=t.getOptionScopes(i,n);return t.createResolver(o,s,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function $s(t,e){const i=bt.datasets[t]||{};return((e.datasets||{})[t]||{}).indexAxis||e.indexAxis||i.indexAxis||"x"}function Ys(t,e){return"x"===t||"y"===t?t:e.axis||("top"===(i=e.position)||"bottom"===i?"x":"left"===i||"right"===i?"y":void 0)||t.charAt(0).toLowerCase();var i}function Us(t){const e=t.options||(t.options={});e.plugins=K(e.plugins,{}),e.scales=function(t,e){const i=gt[t.type]||{scales:{}},s=e.scales||{},n=$s(t.type,e),o=Object.create(null),a=Object.create(null);return Object.keys(s).forEach((t=>{const e=s[t];if(!U(e))return console.error(`Invalid scale configuration for scale: ${t}`);if(e._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${t}`);const r=Ys(t,e),l=function(t,e){return t===e?"_index_":"_value_"}(r,n),h=i.scales||{};o[r]=o[r]||t,a[t]=ot(Object.create(null),[{axis:r},e,h[r],h[l]])})),t.data.datasets.forEach((i=>{const n=i.type||t.type,r=i.indexAxis||$s(n,e),l=(gt[n]||{}).scales||{};Object.keys(l).forEach((t=>{const e=function(t,e){let i=t;return"_index_"===t?i=e:"_value_"===t&&(i="x"===e?"y":"x"),i}(t,r),n=i[e+"AxisID"]||o[e]||e;a[n]=a[n]||Object.create(null),ot(a[n],[{axis:e},s[n],l[t]])}))})),Object.keys(a).forEach((t=>{const e=a[t];ot(e,[bt.scales[e.type],bt.scale])})),a}(t,e)}function Xs(t){return(t=t||{}).datasets=t.datasets||[],t.labels=t.labels||[],t}const qs=new Map,Ks=new Set;function Gs(t,e){let i=qs.get(t);return i||(i=e(),qs.set(t,i),Ks.add(i)),i}const Zs=(t,e,i)=>{const s=lt(e,i);void 0!==s&&t.add(s)};class Js{constructor(t){this._config=function(t){return(t=t||{}).data=Xs(t.data),Us(t),t}(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=Xs(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),Us(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return Gs(t,(()=>[[`datasets.${t}`,""]]))}datasetAnimationScopeKeys(t,e){return Gs(`${t}.transition.${e}`,(()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]]))}datasetElementScopeKeys(t,e){return Gs(`${t}-${e}`,(()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]]))}pluginScopeKeys(t){const e=t.id;return Gs(`${this.type}-plugin-${e}`,(()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]]))}_cachedScopes(t,e){const i=this._scopeCache;let s=i.get(t);return s&&!e||(s=new Map,i.set(t,s)),s}getOptionScopes(t,e,i){const{options:s,type:n}=this,o=this._cachedScopes(t,i),a=o.get(e);if(a)return a;const r=new Set;e.forEach((e=>{t&&(r.add(t),e.forEach((e=>Zs(r,t,e)))),e.forEach((t=>Zs(r,s,t))),e.forEach((t=>Zs(r,gt[n]||{},t))),e.forEach((t=>Zs(r,bt,t))),e.forEach((t=>Zs(r,pt,t)))}));const l=Array.from(r);return 0===l.length&&l.push(Object.create(null)),Ks.has(e)&&o.set(e,l),l}chartOptionScopes(){const{options:t,type:e}=this;return[t,gt[e]||{},bt.datasets[e]||{},{type:e},bt,pt]}resolveNamedOptions(t,e,i,s=[""]){const n={$shared:!0},{resolver:o,subPrefixes:a}=Qs(this._resolverCache,t,s);let r=o;if(function(t,e){const{isScriptable:i,isIndexable:s}=ri(t);for(const n of e){const e=i(n),o=s(n),a=(o||e)&&t[n];if(e&&(dt(a)||tn(a))||o&&Y(a))return!0}return!1}(o,e)){n.$shared=!1;r=ai(o,i=dt(i)?i():i,this.createResolver(t,i,a))}for(const t of e)n[t]=r[t];return n}createResolver(t,e,i=[""],s){const{resolver:n}=Qs(this._resolverCache,t,i);return U(e)?ai(n,e,void 0,s):n}}function Qs(t,e,i){let s=t.get(e);s||(s=new Map,t.set(e,s));const n=i.join();let o=s.get(n);if(!o){o={resolver:oi(e,i),subPrefixes:i.filter((t=>!t.toLowerCase().includes("hover")))},s.set(n,o)}return o}const tn=t=>U(t)&&Object.getOwnPropertyNames(t).reduce(((e,i)=>e||dt(t[i])),!1);const en=["top","bottom","left","right","chartArea"];function sn(t,e){return"top"===t||"bottom"===t||-1===en.indexOf(t)&&"x"===e}function nn(t,e){return function(i,s){return i[t]===s[t]?i[e]-s[e]:i[t]-s[t]}}function on(t){const e=t.chart,i=e.options.animation;e.notifyPlugins("afterRender"),J(i&&i.onComplete,[t],e)}function an(t){const e=t.chart,i=e.options.animation;J(i&&i.onProgress,[t],e)}function rn(t){return ge()&&"string"==typeof t?t=document.getElementById(t):t&&t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas),t}const ln={},hn=t=>{const e=rn(t);return Object.values(ln).filter((t=>t.canvas===e)).pop()};function cn(t,e,i){const s=Object.keys(t);for(const n of s){const s=+n;if(s>=e){const o=t[n];delete t[n],(i>0||s>e)&&(t[s+i]=o)}}}class dn{constructor(t,e){const s=this.config=new Js(e),n=rn(t),o=hn(n);if(o)throw new Error("Canvas is already in use. Chart with ID '"+o.id+"' must be destroyed before the canvas can be reused.");const r=s.createResolver(s.chartOptionScopes(),this.getContext());this.platform=new(s.platform||ls(n)),this.platform.updateConfig(s);const l=this.platform.acquireContext(n,r.aspectRatio),h=l&&l.canvas,c=h&&h.height,d=h&&h.width;this.id=j(),this.ctx=l,this.canvas=h,this.width=d,this.height=c,this._options=r,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new Ns,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=i((t=>this.update(t)),r.resizeDelay||0),this._dataChanges=[],ln[this.id]=this,l&&h?(a.listen(this,"complete",on),a.listen(this,"progress",an),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:i,height:s,_aspectRatio:n}=this;return $(t)?e&&n?n:s?i/s:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():ke(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Gt(this.canvas,this.ctx),this}stop(){return a.stop(this),this}resize(t,e){a.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const i=this.options,s=this.canvas,n=i.maintainAspectRatio&&this.aspectRatio,o=this.platform.getMaximumSize(s,t,e,n),a=i.devicePixelRatio||this.platform.getDevicePixelRatio(),r=this.width?"resize":"attach";this.width=o.width,this.height=o.height,this._aspectRatio=this.aspectRatio,ke(this,a,!0)&&(this.notifyPlugins("resize",{size:o}),J(i.onResize,[this,o],this),this.attached&&this._doResize(r)&&this.render())}ensureScalesHaveIDs(){Q(this.options.scales||{},((t,e)=>{t.id=e}))}buildOrUpdateScales(){const t=this.options,e=t.scales,i=this.scales,s=Object.keys(i).reduce(((t,e)=>(t[e]=!1,t)),{});let n=[];e&&(n=n.concat(Object.keys(e).map((t=>{const i=e[t],s=Ys(t,i),n="r"===s,o="x"===s;return{options:i,dposition:n?"chartArea":o?"bottom":"left",dtype:n?"radialLinear":o?"category":"linear"}})))),Q(n,(e=>{const n=e.options,o=n.id,a=Ys(o,n),r=K(n.type,e.dtype);void 0!==n.position&&sn(n.position,a)===sn(e.dposition)||(n.position=e.dposition),s[o]=!0;let l=null;if(o in i&&i[o].type===r)l=i[o];else{l=new(Ws.getScale(r))({id:o,type:r,ctx:this.ctx,chart:this}),i[l.id]=l}l.init(n,t)})),Q(s,((t,e)=>{t||delete i[e]})),Q(i,(t=>{ni.configure(this,t,t.options),ni.addBox(this,t)}))}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,i=t.length;if(t.sort(((t,e)=>t.index-e.index)),i>e){for(let t=e;t<i;++t)this._destroyDatasetMeta(t);t.splice(e,i-e)}this._sortedMetasets=t.slice(0).sort(nn("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach(((t,i)=>{0===e.filter((e=>e===t._dataset)).length&&this._destroyDatasetMeta(i)}))}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let i,s;for(this._removeUnreferencedMetasets(),i=0,s=e.length;i<s;i++){const s=e[i];let n=this.getDatasetMeta(i);const o=s.type||this.config.type;if(n.type&&n.type!==o&&(this._destroyDatasetMeta(i),n=this.getDatasetMeta(i)),n.type=o,n.indexAxis=s.indexAxis||$s(o,this.options),n.order=s.order||0,n.index=i,n.label=""+s.label,n.visible=this.isDatasetVisible(i),n.controller)n.controller.updateIndex(i),n.controller.linkScales();else{const e=Ws.getController(o),{datasetElementType:s,dataElementType:a}=bt.datasets[o];Object.assign(e.prototype,{dataElementType:Ws.getElement(a),datasetElementType:s&&Ws.getElement(s)}),n.controller=new e(this,i),t.push(n.controller)}}return this._updateMetasets(),t}_resetElements(){Q(this.data.datasets,((t,e)=>{this.getDatasetMeta(e).controller.reset()}),this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const i=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),s=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0}))return;const n=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let o=0;for(let t=0,e=this.data.datasets.length;t<e;t++){const{controller:e}=this.getDatasetMeta(t),i=!s&&-1===n.indexOf(e);e.buildOrUpdateElements(i),o=Math.max(+e.getMaxOverflow(),o)}o=this._minPadding=i.layout.autoPadding?o:0,this._updateLayout(o),s||Q(n,(t=>{t.reset()})),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(nn("z","_idx"));const{_active:a,_lastEvent:r}=this;r?this._eventHandler(r,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){Q(this.scales,(t=>{ni.removeBox(this,t)})),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),i=new Set(t.events);ut(e,i)&&!!this._responsiveListeners===t.responsive||(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:i,start:s,count:n}of e){cn(t,s,"_removeElements"===i?-n:n)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,i=e=>new Set(t.filter((t=>t[0]===e)).map(((t,e)=>e+","+t.splice(1).join(",")))),s=i(0);for(let t=1;t<e;t++)if(!ut(s,i(t)))return;return Array.from(s).map((t=>t.split(","))).map((t=>({method:t[1],start:+t[2],count:+t[3]})))}_updateLayout(t){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;ni.update(this,this.width,this.height,t);const e=this.chartArea,i=e.width<=0||e.height<=0;this._layers=[],Q(this.boxes,(t=>{i&&"chartArea"===t.position||(t.configure&&t.configure(),this._layers.push(...t._layers()))}),this),this._layers.forEach(((t,e)=>{t._idx=e})),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})){for(let t=0,e=this.data.datasets.length;t<e;++t)this.getDatasetMeta(t).controller.configure();for(let e=0,i=this.data.datasets.length;e<i;++e)this._updateDataset(e,dt(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const i=this.getDatasetMeta(t),s={meta:i,index:t,mode:e,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",s)&&(i.controller._update(e),s.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",s))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(a.has(this)?this.attached&&!a.running(this)&&a.start(this):(this.draw(),on({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:t,height:e}=this._resizeBeforeDraw;this._resize(t,e),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0)return;if(!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,i=[];let s,n;for(s=0,n=e.length;s<n;++s){const n=e[s];t&&!n.visible||i.push(n)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,i=t._clip,s=!i.disabled,n=this.chartArea,o={meta:t,index:t.index,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetDraw",o)&&(s&&Qt(e,{left:!1===i.left?0:n.left-i.left,right:!1===i.right?this.width:n.right+i.right,top:!1===i.top?0:n.top-i.top,bottom:!1===i.bottom?this.height:n.bottom+i.bottom}),t.controller.draw(),s&&te(e),o.cancelable=!1,this.notifyPlugins("afterDatasetDraw",o))}getElementsAtEventForMode(t,e,i,s){const n=Ee.modes[e];return"function"==typeof n?n(this,t,i,s):[]}getDatasetMeta(t){const e=this.data.datasets[t],i=this._metasets;let s=i.filter((t=>t&&t._dataset===e)).pop();return s||(s={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},i.push(s)),s}getContext(){return this.$context||(this.$context=Ye(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const i=this.getDatasetMeta(t);return"boolean"==typeof i.hidden?!i.hidden:!e.hidden}setDatasetVisibility(t,e){this.getDatasetMeta(t).hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,i){const s=i?"show":"hide",n=this.getDatasetMeta(t),o=n.controller._resolveAnimations(void 0,s);ct(e)?(n.data[e].hidden=!i,this.update()):(this.setDatasetVisibility(t,i),o.update(n,{visible:i}),this.update((e=>e.datasetIndex===t?s:void 0)))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),a.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),Gt(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),this.notifyPlugins("destroy"),delete ln[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,i=(i,s)=>{e.addEventListener(this,i,s),t[i]=s},s=(t,e,i)=>{t.offsetX=e,t.offsetY=i,this._eventHandler(t)};Q(this.options.events,(t=>i(t,s)))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,i=(i,s)=>{e.addEventListener(this,i,s),t[i]=s},s=(i,s)=>{t[i]&&(e.removeEventListener(this,i,s),delete t[i])},n=(t,e)=>{this.canvas&&this.resize(t,e)};let o;const a=()=>{s("attach",a),this.attached=!0,this.resize(),i("resize",n),i("detach",o)};o=()=>{this.attached=!1,s("resize",n),this._stop(),this._resize(0,0),i("attach",a)},e.isAttached(this.canvas)?a():o()}unbindEvents(){Q(this._listeners,((t,e)=>{this.platform.removeEventListener(this,e,t)})),this._listeners={},Q(this._responsiveListeners,((t,e)=>{this.platform.removeEventListener(this,e,t)})),this._responsiveListeners=void 0}updateHoverStyle(t,e,i){const s=i?"set":"remove";let n,o,a,r;for("dataset"===e&&(n=this.getDatasetMeta(t[0].datasetIndex),n.controller["_"+s+"DatasetHoverStyle"]()),a=0,r=t.length;a<r;++a){o=t[a];const e=o&&this.getDatasetMeta(o.datasetIndex).controller;e&&e[s+"HoverStyle"](o.element,o.datasetIndex,o.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],i=t.map((({datasetIndex:t,index:e})=>{const i=this.getDatasetMeta(t);if(!i)throw new Error("No dataset found at index "+t);return{datasetIndex:t,element:i.data[e],index:e}}));!tt(i,e)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,e))}notifyPlugins(t,e,i){return this._plugins.notify(this,t,e,i)}_updateHoverStyles(t,e,i){const s=this.options.hover,n=(t,e)=>t.filter((t=>!e.some((e=>t.datasetIndex===e.datasetIndex&&t.index===e.index)))),o=n(e,t),a=i?t:n(t,e);o.length&&this.updateHoverStyle(o,s.mode,!1),a.length&&s.mode&&this.updateHoverStyle(a,s.mode,!0)}_eventHandler(t,e){const i={event:t,replay:e,cancelable:!0,inChartArea:Jt(t,this.chartArea,this._minPadding)},s=e=>(e.options.events||this.options.events).includes(t.native.type);if(!1===this.notifyPlugins("beforeEvent",i,s))return;const n=this._handleEvent(t,e,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,s),(n||i.changed)&&this.render(),this}_handleEvent(t,e,i){const{_active:s=[],options:n}=this,o=e,a=this._getActiveElements(t,s,i,o),r=ft(t),l=function(t,e,i,s){return i&&"mouseout"!==t.type?s?e:t:null}(t,this._lastEvent,i,r);i&&(this._lastEvent=null,J(n.onHover,[t,a,this],this),r&&J(n.onClick,[t,a,this],this));const h=!tt(a,s);return(h||e)&&(this._active=a,this._updateHoverStyles(a,s,e)),this._lastEvent=l,h}_getActiveElements(t,e,i,s){if("mouseout"===t.type)return[];if(!i)return e;const n=this.options.hover;return this.getElementsAtEventForMode(t,n.mode,n,s)}}const un=()=>Q(dn.instances,(t=>t._plugins.invalidate())),fn=!0;function gn(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}Object.defineProperties(dn,{defaults:{enumerable:fn,value:bt},instances:{enumerable:fn,value:ln},overrides:{enumerable:fn,value:gt},registry:{enumerable:fn,value:Ws},version:{enumerable:fn,value:"3.7.0"},getChart:{enumerable:fn,value:hn},register:{enumerable:fn,value:(...t)=>{Ws.add(...t),un()}},unregister:{enumerable:fn,value:(...t)=>{Ws.remove(...t),un()}}});class pn{constructor(t){this.options=t||{}}formats(){return gn()}parse(t,e){return gn()}format(t,e){return gn()}add(t,e,i){return gn()}diff(t,e,i){return gn()}startOf(t,e,i){return gn()}endOf(t,e){return gn()}}pn.override=function(t){Object.assign(pn.prototype,t)};var mn={_date:pn};function xn(t){const e=t.iScale,i=function(t,e){if(!t._cache.$bar){const i=t.getMatchingVisibleMetas(e);let s=[];for(let e=0,n=i.length;e<n;e++)s=s.concat(i[e].controller.getAllParsedValues(t));t._cache.$bar=fe(s.sort(((t,e)=>t-e)))}return t._cache.$bar}(e,t.type);let s,n,o,a,r=e._length;const l=()=>{32767!==o&&-32768!==o&&(ct(a)&&(r=Math.min(r,Math.abs(o-a)||r)),a=o)};for(s=0,n=i.length;s<n;++s)o=e.getPixelForValue(i[s]),l();for(a=void 0,s=0,n=e.ticks.length;s<n;++s)o=e.getPixelForTick(s),l();return r}function bn(t,e,i,s){return Y(t)?function(t,e,i,s){const n=i.parse(t[0],s),o=i.parse(t[1],s),a=Math.min(n,o),r=Math.max(n,o);let l=a,h=r;Math.abs(a)>Math.abs(r)&&(l=r,h=a),e[i.axis]=h,e._custom={barStart:l,barEnd:h,start:n,end:o,min:a,max:r}}(t,e,i,s):e[i.axis]=i.parse(t,s),e}function _n(t,e,i,s){const n=t.iScale,o=t.vScale,a=n.getLabels(),r=n===o,l=[];let h,c,d,u;for(h=i,c=i+s;h<c;++h)u=e[h],d={},d[n.axis]=r||n.parse(a[h],h),l.push(bn(u,d,o,h));return l}function yn(t){return t&&void 0!==t.barStart&&void 0!==t.barEnd}function vn(t,e,i,s){let n=e.borderSkipped;const o={};if(!n)return void(t.borderSkipped=o);const{start:a,end:r,reverse:l,top:h,bottom:c}=function(t){let e,i,s,n,o;return t.horizontal?(e=t.base>t.x,i="left",s="right"):(e=t.base<t.y,i="bottom",s="top"),e?(n="end",o="start"):(n="start",o="end"),{start:i,end:s,reverse:e,top:n,bottom:o}}(t);"middle"===n&&i&&(t.enableBorderRadius=!0,(i._top||0)===s?n=h:(i._bottom||0)===s?n=c:(o[wn(c,a,r,l)]=!0,n=h)),o[wn(n,a,r,l)]=!0,t.borderSkipped=o}function wn(t,e,i,s){var n,o,a;return s?(a=i,t=Mn(t=(n=t)===(o=e)?a:n===a?o:n,i,e)):t=Mn(t,e,i),t}function Mn(t,e,i){return"start"===t?e:"end"===t?i:t}function kn(t,{inflateAmount:e},i){t.inflateAmount="auto"===e?1===i?.33:0:e}class Sn extends Ps{parsePrimitiveData(t,e,i,s){return _n(t,e,i,s)}parseArrayData(t,e,i,s){return _n(t,e,i,s)}parseObjectData(t,e,i,s){const{iScale:n,vScale:o}=t,{xAxisKey:a="x",yAxisKey:r="y"}=this._parsing,l="x"===n.axis?a:r,h="x"===o.axis?a:r,c=[];let d,u,f,g;for(d=i,u=i+s;d<u;++d)g=e[d],f={},f[n.axis]=n.parse(lt(g,l),d),c.push(bn(lt(g,h),f,o,d));return c}updateRangeFromParsed(t,e,i,s){super.updateRangeFromParsed(t,e,i,s);const n=i._custom;n&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,n.min),t.max=Math.max(t.max,n.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:i,vScale:s}=e,n=this.getParsed(t),o=n._custom,a=yn(o)?"["+o.start+", "+o.end+"]":""+s.getLabelForValue(n[s.axis]);return{label:""+i.getLabelForValue(n[i.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();this._cachedMeta.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,i,s){const n="reset"===s,{index:o,_cachedMeta:{vScale:a}}=this,r=a.getBasePixel(),l=a.isHorizontal(),h=this._getRuler(),c=this.resolveDataElementOptions(e,s),d=this.getSharedOptions(c),u=this.includeOptions(s,d);this.updateSharedOptions(d,s,c);for(let c=e;c<e+i;c++){const e=this.getParsed(c),i=n||$(e[a.axis])?{base:r,head:r}:this._calculateBarValuePixels(c),f=this._calculateBarIndexPixels(c,h),g=(e._stacks||{})[a.axis],p={horizontal:l,base:i.base,enableBorderRadius:!g||yn(e._custom)||o===g._top||o===g._bottom,x:l?i.head:f.center,y:l?f.center:i.head,height:l?f.size:Math.abs(i.size),width:l?Math.abs(i.size):f.size};u&&(p.options=d||this.resolveDataElementOptions(c,t[c].active?"active":s));const m=p.options||t[c].options;vn(p,m,g,o),kn(p,m,h.ratio),this.updateElement(t[c],c,p,s)}}_getStacks(t,e){const i=this._cachedMeta.iScale,s=i.getMatchingVisibleMetas(this._type),n=i.options.stacked,o=s.length,a=[];let r,l;for(r=0;r<o;++r)if(l=s[r],l.controller.options.grouped){if(void 0!==e){const t=l.controller.getParsed(e)[l.controller._cachedMeta.vScale.axis];if($(t)||isNaN(t))continue}if((!1===n||-1===a.indexOf(l.stack)||void 0===n&&void 0===l.stack)&&a.push(l.stack),l.index===t)break}return a.length||a.push(void 0),a}_getStackCount(t){return this._getStacks(void 0,t).length}_getStackIndex(t,e,i){const s=this._getStacks(t,i),n=void 0!==e?s.indexOf(e):-1;return-1===n?s.length-1:n}_getRuler(){const t=this.options,e=this._cachedMeta,i=e.iScale,s=[];let n,o;for(n=0,o=e.data.length;n<o;++n)s.push(i.getPixelForValue(this.getParsed(n)[i.axis],n));const a=t.barThickness;return{min:a||xn(e),pixels:s,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:t.grouped,ratio:a?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:i},options:{base:s,minBarLength:n}}=this,o=s||0,a=this.getParsed(t),r=a._custom,l=yn(r);let h,c,d=a[e.axis],u=0,f=i?this.applyStack(e,a,i):d;f!==d&&(u=f-d,f=d),l&&(d=r.barStart,f=r.barEnd-r.barStart,0!==d&&Ct(d)!==Ct(r.barEnd)&&(u=0),u+=d);const g=$(s)||l?u:s;let p=e.getPixelForValue(g);if(h=this.chart.getDataVisibility(t)?e.getPixelForValue(u+f):p,c=h-p,Math.abs(c)<n&&(c=function(t,e,i){return 0!==t?Ct(t):(e.isHorizontal()?1:-1)*(e.min>=i?1:-1)}(c,e,o)*n,d===o&&(p-=c/2),h=p+c),p===e.getPixelForValue(o)){const t=Ct(c)*e.getLineWidthForValue(o)/2;p+=t,c-=t}return{size:c,base:p,head:h,center:h+c/2}}_calculateBarIndexPixels(t,e){const i=e.scale,s=this.options,n=s.skipNull,o=K(s.maxBarThickness,1/0);let a,r;if(e.grouped){const i=n?this._getStackCount(t):e.stackCount,l="flex"===s.barThickness?function(t,e,i,s){const n=e.pixels,o=n[t];let a=t>0?n[t-1]:null,r=t<n.length-1?n[t+1]:null;const l=i.categoryPercentage;null===a&&(a=o-(null===r?e.end-e.start:r-o)),null===r&&(r=o+o-a);const h=o-(o-Math.min(a,r))/2*l;return{chunk:Math.abs(r-a)/2*l/s,ratio:i.barPercentage,start:h}}(t,e,s,i):function(t,e,i,s){const n=i.barThickness;let o,a;return $(n)?(o=e.min*i.categoryPercentage,a=i.barPercentage):(o=n*s,a=1),{chunk:o/s,ratio:a,start:e.pixels[t]-o/2}}(t,e,s,i),h=this._getStackIndex(this.index,this._cachedMeta.stack,n?t:void 0);a=l.start+l.chunk*h+l.chunk/2,r=Math.min(o,l.chunk*l.ratio)}else a=i.getPixelForValue(this.getParsed(t)[i.axis],t),r=Math.min(o,e.min*e.ratio);return{base:a-r/2,head:a+r/2,center:a,size:r}}draw(){const t=this._cachedMeta,e=t.vScale,i=t.data,s=i.length;let n=0;for(;n<s;++n)null!==this.getParsed(n)[e.axis]&&i[n].draw(this._ctx)}}Sn.id="bar",Sn.defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}},Sn.overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};class Pn extends Ps{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,i,s){const n=super.parsePrimitiveData(t,e,i,s);for(let t=0;t<n.length;t++)n[t]._custom=this.resolveDataElementOptions(t+i).radius;return n}parseArrayData(t,e,i,s){const n=super.parseArrayData(t,e,i,s);for(let t=0;t<n.length;t++){const s=e[i+t];n[t]._custom=K(s[2],this.resolveDataElementOptions(t+i).radius)}return n}parseObjectData(t,e,i,s){const n=super.parseObjectData(t,e,i,s);for(let t=0;t<n.length;t++){const s=e[i+t];n[t]._custom=K(s&&s.r&&+s.r,this.resolveDataElementOptions(t+i).radius)}return n}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let i=t.length-1;i>=0;--i)e=Math.max(e,t[i].size(this.resolveDataElementOptions(i))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,{xScale:i,yScale:s}=e,n=this.getParsed(t),o=i.getLabelForValue(n.x),a=s.getLabelForValue(n.y),r=n._custom;return{label:e.label,value:"("+o+", "+a+(r?", "+r:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,i,s){const n="reset"===s,{iScale:o,vScale:a}=this._cachedMeta,r=this.resolveDataElementOptions(e,s),l=this.getSharedOptions(r),h=this.includeOptions(s,l),c=o.axis,d=a.axis;for(let r=e;r<e+i;r++){const e=t[r],i=!n&&this.getParsed(r),l={},u=l[c]=n?o.getPixelForDecimal(.5):o.getPixelForValue(i[c]),f=l[d]=n?a.getBasePixel():a.getPixelForValue(i[d]);l.skip=isNaN(u)||isNaN(f),h&&(l.options=this.resolveDataElementOptions(r,e.active?"active":s),n&&(l.options.radius=0)),this.updateElement(e,r,l,s)}this.updateSharedOptions(l,s,r)}resolveDataElementOptions(t,e){const i=this.getParsed(t);let s=super.resolveDataElementOptions(t,e);s.$shared&&(s=Object.assign({},s,{$shared:!1}));const n=s.radius;return"active"!==e&&(s.radius=0),s.radius+=K(i&&i._custom,n),s}}Pn.id="bubble",Pn.defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}},Pn.overrides={scales:{x:{type:"linear"},y:{type:"linear"}},plugins:{tooltip:{callbacks:{title:()=>""}}}};class Dn extends Ps{constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const i=this.getDataset().data,s=this._cachedMeta;if(!1===this._parsing)s._parsed=i;else{let n,o,a=t=>+i[t];if(U(i[t])){const{key:t="value"}=this._parsing;a=e=>+lt(i[e],t)}for(n=t,o=t+e;n<o;++n)s._parsed[n]=a(n)}}_getRotation(){return It(this.options.rotation-90)}_getCircumference(){return It(this.options.circumference)}_getRotationExtents(){let t=yt,e=-yt;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)){const s=this.chart.getDatasetMeta(i).controller,n=s._getRotation(),o=s._getCircumference();t=Math.min(t,n),e=Math.max(e,n+o)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:i}=e,s=this._cachedMeta,n=s.data,o=this.getMaxBorderWidth()+this.getMaxOffset(n)+this.options.spacing,a=Math.max((Math.min(i.width,i.height)-o)/2,0),r=Math.min(G(this.options.cutout,a),1),l=this._getRingWeight(this.index),{circumference:h,rotation:c}=this._getRotationExtents(),{ratioX:d,ratioY:u,offsetX:f,offsetY:g}=function(t,e,i){let s=1,n=1,o=0,a=0;if(e<yt){const r=t,l=r+e,h=Math.cos(r),c=Math.sin(r),d=Math.cos(l),u=Math.sin(l),f=(t,e,s)=>Ht(t,r,l,!0)?1:Math.max(e,e*i,s,s*i),g=(t,e,s)=>Ht(t,r,l,!0)?-1:Math.min(e,e*i,s,s*i),p=f(0,h,d),m=f(kt,c,u),x=g(_t,h,d),b=g(_t+kt,c,u);s=(p-x)/2,n=(m-b)/2,o=-(p+x)/2,a=-(m+b)/2}return{ratioX:s,ratioY:n,offsetX:o,offsetY:a}}(c,h,r),p=(i.width-o)/d,m=(i.height-o)/u,x=Math.max(Math.min(p,m)/2,0),b=Z(this.options.radius,x),_=(b-Math.max(b*r,0))/this._getVisibleDatasetWeightTotal();this.offsetX=f*b,this.offsetY=g*b,s.total=this.calculateTotal(),this.outerRadius=b-_*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-_*l,0),this.updateElements(n,0,n.length,t)}_circumference(t,e){const i=this.options,s=this._cachedMeta,n=this._getCircumference();return e&&i.animation.animateRotate||!this.chart.getDataVisibility(t)||null===s._parsed[t]||s.data[t].hidden?0:this.calculateCircumference(s._parsed[t]*n/yt)}updateElements(t,e,i,s){const n="reset"===s,o=this.chart,a=o.chartArea,r=o.options.animation,l=(a.left+a.right)/2,h=(a.top+a.bottom)/2,c=n&&r.animateScale,d=c?0:this.innerRadius,u=c?0:this.outerRadius,f=this.resolveDataElementOptions(e,s),g=this.getSharedOptions(f),p=this.includeOptions(s,g);let m,x=this._getRotation();for(m=0;m<e;++m)x+=this._circumference(m,n);for(m=e;m<e+i;++m){const e=this._circumference(m,n),i=t[m],o={x:l+this.offsetX,y:h+this.offsetY,startAngle:x,endAngle:x+e,circumference:e,outerRadius:u,innerRadius:d};p&&(o.options=g||this.resolveDataElementOptions(m,i.active?"active":s)),x+=e,this.updateElement(i,m,o,s)}this.updateSharedOptions(g,s,f)}calculateTotal(){const t=this._cachedMeta,e=t.data;let i,s=0;for(i=0;i<e.length;i++){const n=t._parsed[i];null===n||isNaN(n)||!this.chart.getDataVisibility(i)||e[i].hidden||(s+=Math.abs(n))}return s}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?yt*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,s=i.data.labels||[],n=Ri(e._parsed[t],i.options.locale);return{label:s[t]||"",value:n}}getMaxBorderWidth(t){let e=0;const i=this.chart;let s,n,o,a,r;if(!t)for(s=0,n=i.data.datasets.length;s<n;++s)if(i.isDatasetVisible(s)){o=i.getDatasetMeta(s),t=o.data,a=o.controller;break}if(!t)return 0;for(s=0,n=t.length;s<n;++s)r=a.resolveDataElementOptions(s),"inner"!==r.borderAlign&&(e=Math.max(e,r.borderWidth||0,r.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let i=0,s=t.length;i<s;++i){const t=this.resolveDataElementOptions(i);e=Math.max(e,t.offset||0,t.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let i=0;i<t;++i)this.chart.isDatasetVisible(i)&&(e+=this._getRingWeight(i));return e}_getRingWeight(t){return Math.max(K(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}Dn.id="doughnut",Dn.defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"},Dn.descriptors={_scriptable:t=>"spacing"!==t,_indexable:t=>"spacing"!==t},Dn.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:i}}=t.legend.options;return e.labels.map(((e,s)=>{const n=t.getDatasetMeta(0).controller.getStyle(s);return{text:e,fillStyle:n.backgroundColor,strokeStyle:n.borderColor,lineWidth:n.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(s),index:s}}))}return[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}},tooltip:{callbacks:{title:()=>"",label(t){let e=t.label;const i=": "+t.formattedValue;return Y(e)?(e=e.slice(),e[0]+=i):e+=i,e}}}}};class Cn extends Ps{initialize(){this.enableOptionSharing=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:i,data:s=[],_dataset:n}=e,o=this.chart._animationsDisabled;let{start:a,count:r}=function(t,e,i){const s=e.length;let n=0,o=s;if(t._sorted){const{iScale:a,_parsed:r}=t,l=a.axis,{min:h,max:c,minDefined:d,maxDefined:u}=a.getUserBounds();d&&(n=jt(Math.min(re(r,a.axis,h).lo,i?s:re(e,l,a.getPixelForValue(h)).lo),0,s-1)),o=u?jt(Math.max(re(r,a.axis,c).hi+1,i?0:re(e,l,a.getPixelForValue(c)).hi+1),n,s)-n:s-n}return{start:n,count:o}}(e,s,o);this._drawStart=a,this._drawCount=r,function(t){const{xScale:e,yScale:i,_scaleRanges:s}=t,n={xmin:e.min,xmax:e.max,ymin:i.min,ymax:i.max};if(!s)return t._scaleRanges=n,!0;const o=s.xmin!==e.min||s.xmax!==e.max||s.ymin!==i.min||s.ymax!==i.max;return Object.assign(s,n),o}(e)&&(a=0,r=s.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!n._decimated,i.points=s;const l=this.resolveDatasetElementOptions(t);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(i,void 0,{animated:!o,options:l},t),this.updateElements(s,a,r,t)}updateElements(t,e,i,s){const n="reset"===s,{iScale:o,vScale:a,_stacked:r,_dataset:l}=this._cachedMeta,h=this.resolveDataElementOptions(e,s),c=this.getSharedOptions(h),d=this.includeOptions(s,c),u=o.axis,f=a.axis,{spanGaps:g,segment:p}=this.options,m=Tt(g)?g:Number.POSITIVE_INFINITY,x=this.chart._animationsDisabled||n||"none"===s;let b=e>0&&this.getParsed(e-1);for(let h=e;h<e+i;++h){const e=t[h],i=this.getParsed(h),g=x?e:{},_=$(i[f]),y=g[u]=o.getPixelForValue(i[u],h),v=g[f]=n||_?a.getBasePixel():a.getPixelForValue(r?this.applyStack(a,i,r):i[f],h);g.skip=isNaN(y)||isNaN(v)||_,g.stop=h>0&&i[u]-b[u]>m,p&&(g.parsed=i,g.raw=l.data[h]),d&&(g.options=c||this.resolveDataElementOptions(h,e.active?"active":s)),x||this.updateElement(e,h,g,s),b=i}this.updateSharedOptions(c,s,h)}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,i=e.options&&e.options.borderWidth||0,s=t.data||[];if(!s.length)return i;const n=s[0].size(this.resolveDataElementOptions(0)),o=s[s.length-1].size(this.resolveDataElementOptions(s.length-1));return Math.max(i,n,o)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}Cn.id="line",Cn.defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1},Cn.overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};class On extends Ps{constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,s=i.data.labels||[],n=Ri(e._parsed[t].r,i.options.locale);return{label:s[t]||"",value:n}}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}_updateRadius(){const t=this.chart,e=t.chartArea,i=t.options,s=Math.min(e.right-e.left,e.bottom-e.top),n=Math.max(s/2,0),o=(n-Math.max(i.cutoutPercentage?n/100*i.cutoutPercentage:1,0))/t.getVisibleDatasetCount();this.outerRadius=n-o*this.index,this.innerRadius=this.outerRadius-o}updateElements(t,e,i,s){const n="reset"===s,o=this.chart,a=this.getDataset(),r=o.options.animation,l=this._cachedMeta.rScale,h=l.xCenter,c=l.yCenter,d=l.getIndexAngle(0)-.5*_t;let u,f=d;const g=360/this.countVisibleElements();for(u=0;u<e;++u)f+=this._computeAngle(u,s,g);for(u=e;u<e+i;u++){const e=t[u];let i=f,p=f+this._computeAngle(u,s,g),m=o.getDataVisibility(u)?l.getDistanceFromCenterForValue(a.data[u]):0;f=p,n&&(r.animateScale&&(m=0),r.animateRotate&&(i=p=d));const x={x:h,y:c,innerRadius:0,outerRadius:m,startAngle:i,endAngle:p,options:this.resolveDataElementOptions(u,e.active?"active":s)};this.updateElement(e,u,x,s)}}countVisibleElements(){const t=this.getDataset(),e=this._cachedMeta;let i=0;return e.data.forEach(((e,s)=>{!isNaN(t.data[s])&&this.chart.getDataVisibility(s)&&i++})),i}_computeAngle(t,e,i){return this.chart.getDataVisibility(t)?It(this.resolveDataElementOptions(t,e).angle||i):0}}On.id="polarArea",On.defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0},On.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:i}}=t.legend.options;return e.labels.map(((e,s)=>{const n=t.getDatasetMeta(0).controller.getStyle(s);return{text:e,fillStyle:n.backgroundColor,strokeStyle:n.borderColor,lineWidth:n.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(s),index:s}}))}return[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}},tooltip:{callbacks:{title:()=>"",label:t=>t.chart.data.labels[t.dataIndex]+": "+t.formattedValue}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};class An extends Dn{}An.id="pie",An.defaults={cutout:0,rotation:0,circumference:360,radius:"100%"};class Tn extends Ps{getLabelAndValue(t){const e=this._cachedMeta.vScale,i=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(i[e.axis])}}update(t){const e=this._cachedMeta,i=e.dataset,s=e.data||[],n=e.iScale.getLabels();if(i.points=s,"resize"!==t){const e=this.resolveDatasetElementOptions(t);this.options.showLine||(e.borderWidth=0);const o={_loop:!0,_fullLoop:n.length===s.length,options:e};this.updateElement(i,void 0,o,t)}this.updateElements(s,0,s.length,t)}updateElements(t,e,i,s){const n=this.getDataset(),o=this._cachedMeta.rScale,a="reset"===s;for(let r=e;r<e+i;r++){const e=t[r],i=this.resolveDataElementOptions(r,e.active?"active":s),l=o.getPointPositionForValue(r,n.data[r]),h=a?o.xCenter:l.x,c=a?o.yCenter:l.y,d={x:h,y:c,angle:l.angle,skip:isNaN(h)||isNaN(c),options:i};this.updateElement(e,r,d,s)}}}Tn.id="radar",Tn.defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}},Tn.overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};class Ln extends Cn{}Ln.id="scatter",Ln.defaults={showLine:!1,fill:!1},Ln.overrides={interaction:{mode:"point"},plugins:{tooltip:{callbacks:{title:()=>"",label:t=>"("+t.label+", "+t.formattedValue+")"}}},scales:{x:{type:"linear"},y:{type:"linear"}}};var Rn=Object.freeze({__proto__:null,BarController:Sn,BubbleController:Pn,DoughnutController:Dn,LineController:Cn,PolarAreaController:On,PieController:An,RadarController:Tn,ScatterController:Ln});function En(t,e,i){const{startAngle:s,pixelMargin:n,x:o,y:a,outerRadius:r,innerRadius:l}=e;let h=n/r;t.beginPath(),t.arc(o,a,r,s-h,i+h),l>n?(h=n/l,t.arc(o,a,l,i+h,s-h,!0)):t.arc(o,a,n,i+kt,s-kt),t.closePath(),t.clip()}function In(t,e,i,s){const n=Be(t.options.borderRadius,["outerStart","outerEnd","innerStart","innerEnd"]);const o=(i-e)/2,a=Math.min(o,s*e/2),r=t=>{const e=(i-Math.min(o,t))*s/2;return jt(t,0,Math.min(o,e))};return{outerStart:r(n.outerStart),outerEnd:r(n.outerEnd),innerStart:jt(n.innerStart,0,a),innerEnd:jt(n.innerEnd,0,a)}}function zn(t,e,i,s){return{x:i+t*Math.cos(e),y:s+t*Math.sin(e)}}function Fn(t,e,i,s,n){const{x:o,y:a,startAngle:r,pixelMargin:l,innerRadius:h}=e,c=Math.max(e.outerRadius+s+i-l,0),d=h>0?h+s+i+l:0;let u=0;const f=n-r;if(s){const t=((h>0?h-s:0)+(c>0?c-s:0))/2;u=(f-(0!==t?f*t/(t+s):f))/2}const g=(f-Math.max(.001,f*c-i/_t)/c)/2,p=r+g+u,m=n-g-u,{outerStart:x,outerEnd:b,innerStart:_,innerEnd:y}=In(e,d,c,m-p),v=c-x,w=c-b,M=p+x/v,k=m-b/w,S=d+_,P=d+y,D=p+_/S,C=m-y/P;if(t.beginPath(),t.arc(o,a,c,M,k),b>0){const e=zn(w,k,o,a);t.arc(e.x,e.y,b,k,m+kt)}const O=zn(P,m,o,a);if(t.lineTo(O.x,O.y),y>0){const e=zn(P,C,o,a);t.arc(e.x,e.y,y,m+kt,C+Math.PI)}if(t.arc(o,a,d,m-y/d,p+_/d,!0),_>0){const e=zn(S,D,o,a);t.arc(e.x,e.y,_,D+Math.PI,p-kt)}const A=zn(v,p,o,a);if(t.lineTo(A.x,A.y),x>0){const e=zn(v,M,o,a);t.arc(e.x,e.y,x,p-kt,M)}t.closePath()}function Bn(t,e,i,s,n){const{options:o}=e,{borderWidth:a,borderJoinStyle:r}=o,l="inner"===o.borderAlign;a&&(l?(t.lineWidth=2*a,t.lineJoin=r||"round"):(t.lineWidth=a,t.lineJoin=r||"bevel"),e.fullCircles&&function(t,e,i){const{x:s,y:n,startAngle:o,pixelMargin:a,fullCircles:r}=e,l=Math.max(e.outerRadius-a,0),h=e.innerRadius+a;let c;for(i&&En(t,e,o+yt),t.beginPath(),t.arc(s,n,h,o+yt,o,!0),c=0;c<r;++c)t.stroke();for(t.beginPath(),t.arc(s,n,l,o,o+yt),c=0;c<r;++c)t.stroke()}(t,e,l),l&&En(t,e,n),Fn(t,e,i,s,n),t.stroke())}class Vn extends Ds{constructor(t){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,t&&Object.assign(this,t)}inRange(t,e,i){const s=this.getProps(["x","y"],i),{angle:n,distance:o}=Bt(s,{x:t,y:e}),{startAngle:a,endAngle:r,innerRadius:l,outerRadius:h,circumference:c}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),d=this.options.spacing/2,u=K(c,r-a)>=yt||Ht(n,a,r),f=Yt(o,l+d,h+d);return u&&f}getCenterPoint(t){const{x:e,y:i,startAngle:s,endAngle:n,innerRadius:o,outerRadius:a}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius","circumference"],t),{offset:r,spacing:l}=this.options,h=(s+n)/2,c=(o+a+l+r)/2;return{x:e+Math.cos(h)*c,y:i+Math.sin(h)*c}}tooltipPosition(t){return this.getCenterPoint(t)}draw(t){const{options:e,circumference:i}=this,s=(e.offset||0)/2,n=(e.spacing||0)/2;if(this.pixelMargin="inner"===e.borderAlign?.33:0,this.fullCircles=i>yt?Math.floor(i/yt):0,0===i||this.innerRadius<0||this.outerRadius<0)return;t.save();let o=0;if(s){o=s/2;const e=(this.startAngle+this.endAngle)/2;t.translate(Math.cos(e)*o,Math.sin(e)*o),this.circumference>=_t&&(o=s)}t.fillStyle=e.backgroundColor,t.strokeStyle=e.borderColor;const a=function(t,e,i,s){const{fullCircles:n,startAngle:o,circumference:a}=e;let r=e.endAngle;if(n){Fn(t,e,i,s,o+yt);for(let e=0;e<n;++e)t.fill();isNaN(a)||(r=o+a%yt,a%yt==0&&(r+=yt))}return Fn(t,e,i,s,r),t.fill(),r}(t,this,o,n);Bn(t,this,o,n,a),t.restore()}}function Wn(t,e,i=e){t.lineCap=K(i.borderCapStyle,e.borderCapStyle),t.setLineDash(K(i.borderDash,e.borderDash)),t.lineDashOffset=K(i.borderDashOffset,e.borderDashOffset),t.lineJoin=K(i.borderJoinStyle,e.borderJoinStyle),t.lineWidth=K(i.borderWidth,e.borderWidth),t.strokeStyle=K(i.borderColor,e.borderColor)}function Nn(t,e,i){t.lineTo(i.x,i.y)}function Hn(t,e,i={}){const s=t.length,{start:n=0,end:o=s-1}=i,{start:a,end:r}=e,l=Math.max(n,a),h=Math.min(o,r),c=n<a&&o<a||n>r&&o>r;return{count:s,start:l,loop:e.loop,ilen:h<l&&!c?s+h-l:h-l}}function jn(t,e,i,s){const{points:n,options:o}=e,{count:a,start:r,loop:l,ilen:h}=Hn(n,i,s),c=function(t){return t.stepped?ee:t.tension||"monotone"===t.cubicInterpolationMode?ie:Nn}(o);let d,u,f,{move:g=!0,reverse:p}=s||{};for(d=0;d<=h;++d)u=n[(r+(p?h-d:d))%a],u.skip||(g?(t.moveTo(u.x,u.y),g=!1):c(t,f,u,p,o.stepped),f=u);return l&&(u=n[(r+(p?h:0))%a],c(t,f,u,p,o.stepped)),!!l}function $n(t,e,i,s){const n=e.points,{count:o,start:a,ilen:r}=Hn(n,i,s),{move:l=!0,reverse:h}=s||{};let c,d,u,f,g,p,m=0,x=0;const b=t=>(a+(h?r-t:t))%o,_=()=>{f!==g&&(t.lineTo(m,g),t.lineTo(m,f),t.lineTo(m,p))};for(l&&(d=n[b(0)],t.moveTo(d.x,d.y)),c=0;c<=r;++c){if(d=n[b(c)],d.skip)continue;const e=d.x,i=d.y,s=0|e;s===u?(i<f?f=i:i>g&&(g=i),m=(x*m+e)/++x):(_(),t.lineTo(e,i),u=s,x=0,f=g=i),p=i}_()}function Yn(t){const e=t.options,i=e.borderDash&&e.borderDash.length;return!(t._decimated||t._loop||e.tension||"monotone"===e.cubicInterpolationMode||e.stepped||i)?$n:jn}Vn.id="arc",Vn.defaults={borderAlign:"center",borderColor:"#fff",borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0},Vn.defaultRoutes={backgroundColor:"backgroundColor"};const Un="function"==typeof Path2D;function Xn(t,e,i,s){Un&&!e.options.segment?function(t,e,i,s){let n=e._path;n||(n=e._path=new Path2D,e.path(n,i,s)&&n.closePath()),Wn(t,e.options),t.stroke(n)}(t,e,i,s):function(t,e,i,s){const{segments:n,options:o}=e,a=Yn(e);for(const r of n)Wn(t,o,r.style),t.beginPath(),a(t,e,r,{start:i,end:i+s-1})&&t.closePath(),t.stroke()}(t,e,i,s)}class qn extends Ds{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const i=this.options;if((i.tension||"monotone"===i.cubicInterpolationMode)&&!i.stepped&&!this._pointsUpdated){const s=i.spanGaps?this._loop:this._fullLoop;ki(this._points,i,t,s,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=Ni(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,i=t.length;return i&&e[t[i-1].end]}interpolate(t,e){const i=this.options,s=t[e],n=this.points,o=Wi(this,{property:e,start:s,end:s});if(!o.length)return;const a=[],r=function(t){return t.stepped?Ai:t.tension||"monotone"===t.cubicInterpolationMode?Ti:Oi}(i);let l,h;for(l=0,h=o.length;l<h;++l){const{start:h,end:c}=o[l],d=n[h],u=n[c];if(d===u){a.push(d);continue}const f=r(d,u,Math.abs((s-d[e])/(u[e]-d[e])),i.stepped);f[e]=t[e],a.push(f)}return 1===a.length?a[0]:a}pathSegment(t,e,i){return Yn(this)(t,this,e,i)}path(t,e,i){const s=this.segments,n=Yn(this);let o=this._loop;e=e||0,i=i||this.points.length-e;for(const a of s)o&=n(t,this,a,{start:e,end:e+i-1});return!!o}draw(t,e,i,s){const n=this.options||{};(this.points||[]).length&&n.borderWidth&&(t.save(),Xn(t,this,i,s),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function Kn(t,e,i,s){const n=t.options,{[i]:o}=t.getProps([i],s);return Math.abs(e-o)<n.radius+n.hitRadius}qn.id="line",qn.defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0},qn.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"},qn.descriptors={_scriptable:!0,_indexable:t=>"borderDash"!==t&&"fill"!==t};class Gn extends Ds{constructor(t){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,e,i){const s=this.options,{x:n,y:o}=this.getProps(["x","y"],i);return Math.pow(t-n,2)+Math.pow(e-o,2)<Math.pow(s.hitRadius+s.radius,2)}inXRange(t,e){return Kn(this,t,"x",e)}inYRange(t,e){return Kn(this,t,"y",e)}getCenterPoint(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}size(t){let e=(t=t||this.options||{}).radius||0;e=Math.max(e,e&&t.hoverRadius||0);return 2*(e+(e&&t.borderWidth||0))}draw(t,e){const i=this.options;this.skip||i.radius<.1||!Jt(this,e,this.size(i)/2)||(t.strokeStyle=i.borderColor,t.lineWidth=i.borderWidth,t.fillStyle=i.backgroundColor,Zt(t,i,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}function Zn(t,e){const{x:i,y:s,base:n,width:o,height:a}=t.getProps(["x","y","base","width","height"],e);let r,l,h,c,d;return t.horizontal?(d=a/2,r=Math.min(i,n),l=Math.max(i,n),h=s-d,c=s+d):(d=o/2,r=i-d,l=i+d,h=Math.min(s,n),c=Math.max(s,n)),{left:r,top:h,right:l,bottom:c}}function Jn(t,e,i,s){return t?0:jt(e,i,s)}function Qn(t){const e=Zn(t),i=e.right-e.left,s=e.bottom-e.top,n=function(t,e,i){const s=t.options.borderWidth,n=t.borderSkipped,o=Ve(s);return{t:Jn(n.top,o.top,0,i),r:Jn(n.right,o.right,0,e),b:Jn(n.bottom,o.bottom,0,i),l:Jn(n.left,o.left,0,e)}}(t,i/2,s/2),o=function(t,e,i){const{enableBorderRadius:s}=t.getProps(["enableBorderRadius"]),n=t.options.borderRadius,o=We(n),a=Math.min(e,i),r=t.borderSkipped,l=s||U(n);return{topLeft:Jn(!l||r.top||r.left,o.topLeft,0,a),topRight:Jn(!l||r.top||r.right,o.topRight,0,a),bottomLeft:Jn(!l||r.bottom||r.left,o.bottomLeft,0,a),bottomRight:Jn(!l||r.bottom||r.right,o.bottomRight,0,a)}}(t,i/2,s/2);return{outer:{x:e.left,y:e.top,w:i,h:s,radius:o},inner:{x:e.left+n.l,y:e.top+n.t,w:i-n.l-n.r,h:s-n.t-n.b,radius:{topLeft:Math.max(0,o.topLeft-Math.max(n.t,n.l)),topRight:Math.max(0,o.topRight-Math.max(n.t,n.r)),bottomLeft:Math.max(0,o.bottomLeft-Math.max(n.b,n.l)),bottomRight:Math.max(0,o.bottomRight-Math.max(n.b,n.r))}}}}function to(t,e,i,s){const n=null===e,o=null===i,a=t&&!(n&&o)&&Zn(t,s);return a&&(n||Yt(e,a.left,a.right))&&(o||Yt(i,a.top,a.bottom))}function eo(t,e){t.rect(e.x,e.y,e.w,e.h)}function io(t,e,i={}){const s=t.x!==i.x?-e:0,n=t.y!==i.y?-e:0,o=(t.x+t.w!==i.x+i.w?e:0)-s,a=(t.y+t.h!==i.y+i.h?e:0)-n;return{x:t.x+s,y:t.y+n,w:t.w+o,h:t.h+a,radius:t.radius}}Gn.id="point",Gn.defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0},Gn.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};class so extends Ds{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:i,backgroundColor:s}}=this,{inner:n,outer:o}=Qn(this),a=(r=o.radius).topLeft||r.topRight||r.bottomLeft||r.bottomRight?oe:eo;var r;t.save(),o.w===n.w&&o.h===n.h||(t.beginPath(),a(t,io(o,e,n)),t.clip(),a(t,io(n,-e,o)),t.fillStyle=i,t.fill("evenodd")),t.beginPath(),a(t,io(n,e)),t.fillStyle=s,t.fill(),t.restore()}inRange(t,e,i){return to(this,t,e,i)}inXRange(t,e){return to(this,t,null,e)}inYRange(t,e){return to(this,null,t,e)}getCenterPoint(t){const{x:e,y:i,base:s,horizontal:n}=this.getProps(["x","y","base","horizontal"],t);return{x:n?(e+s)/2:e,y:n?i:(i+s)/2}}getRange(t){return"x"===t?this.width/2:this.height/2}}so.id="bar",so.defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0},so.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};var no=Object.freeze({__proto__:null,ArcElement:Vn,LineElement:qn,PointElement:Gn,BarElement:so});function oo(t){if(t._decimated){const e=t._data;delete t._decimated,delete t._data,Object.defineProperty(t,"data",{value:e})}}function ao(t){t.data.datasets.forEach((t=>{oo(t)}))}var ro={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(t,e,i)=>{if(!i.enabled)return void ao(t);const s=t.width;t.data.datasets.forEach(((e,n)=>{const{_data:o,indexAxis:a}=e,r=t.getDatasetMeta(n),l=o||e.data;if("y"===je([a,t.options.indexAxis]))return;if("line"!==r.type)return;const h=t.scales[r.xAxisID];if("linear"!==h.type&&"time"!==h.type)return;if(t.options.parsing)return;let{start:c,count:d}=function(t,e){const i=e.length;let s,n=0;const{iScale:o}=t,{min:a,max:r,minDefined:l,maxDefined:h}=o.getUserBounds();return l&&(n=jt(re(e,o.axis,a).lo,0,i-1)),s=h?jt(re(e,o.axis,r).hi+1,n,i)-n:i-n,{start:n,count:s}}(r,l);if(d<=(i.threshold||4*s))return void oo(e);let u;switch($(o)&&(e._data=l,delete e.data,Object.defineProperty(e,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(t){this._data=t}})),i.algorithm){case"lttb":u=function(t,e,i,s,n){const o=n.samples||s;if(o>=i)return t.slice(e,e+i);const a=[],r=(i-2)/(o-2);let l=0;const h=e+i-1;let c,d,u,f,g,p=e;for(a[l++]=t[p],c=0;c<o-2;c++){let s,n=0,o=0;const h=Math.floor((c+1)*r)+1+e,m=Math.min(Math.floor((c+2)*r)+1,i)+e,x=m-h;for(s=h;s<m;s++)n+=t[s].x,o+=t[s].y;n/=x,o/=x;const b=Math.floor(c*r)+1+e,_=Math.min(Math.floor((c+1)*r)+1,i)+e,{x:y,y:v}=t[p];for(u=f=-1,s=b;s<_;s++)f=.5*Math.abs((y-n)*(t[s].y-v)-(y-t[s].x)*(o-v)),f>u&&(u=f,d=t[s],g=s);a[l++]=d,p=g}return a[l++]=t[h],a}(l,c,d,s,i);break;case"min-max":u=function(t,e,i,s){let n,o,a,r,l,h,c,d,u,f,g=0,p=0;const m=[],x=e+i-1,b=t[e].x,_=t[x].x-b;for(n=e;n<e+i;++n){o=t[n],a=(o.x-b)/_*s,r=o.y;const e=0|a;if(e===l)r<u?(u=r,h=n):r>f&&(f=r,c=n),g=(p*g+o.x)/++p;else{const i=n-1;if(!$(h)&&!$(c)){const e=Math.min(h,c),s=Math.max(h,c);e!==d&&e!==i&&m.push({...t[e],x:g}),s!==d&&s!==i&&m.push({...t[s],x:g})}n>0&&i!==d&&m.push(t[i]),m.push(o),l=e,p=0,u=f=r,h=c=d=n}}return m}(l,c,d,s);break;default:throw new Error(`Unsupported decimation algorithm '${i.algorithm}'`)}e._decimated=u}))},destroy(t){ao(t)}};function lo(t,e,i){const s=function(t){const e=t.options,i=e.fill;let s=K(i&&i.target,i);return void 0===s&&(s=!!e.backgroundColor),!1!==s&&null!==s&&(!0===s?"origin":s)}(t);if(U(s))return!isNaN(s.value)&&s;let n=parseFloat(s);return X(n)&&Math.floor(n)===n?("-"!==s[0]&&"+"!==s[0]||(n=e+n),!(n===e||n<0||n>=i)&&n):["origin","start","end","stack","shape"].indexOf(s)>=0&&s}class ho{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,i){const{x:s,y:n,radius:o}=this;return e=e||{start:0,end:yt},t.arc(s,n,o,e.end,e.start,!0),!i.bounds}interpolate(t){const{x:e,y:i,radius:s}=this,n=t.angle;return{x:e+Math.cos(n)*s,y:i+Math.sin(n)*s,angle:n}}}function co(t){return(t.scale||{}).getPointPositionForValue?function(t){const{scale:e,fill:i}=t,s=e.options,n=e.getLabels().length,o=[],a=s.reverse?e.max:e.min,r=s.reverse?e.min:e.max;let l,h,c;if(c="start"===i?a:"end"===i?r:U(i)?i.value:e.getBaseValue(),s.grid.circular)return h=e.getPointPositionForValue(0,a),new ho({x:h.x,y:h.y,radius:e.getDistanceFromCenterForValue(c)});for(l=0;l<n;++l)o.push(e.getPointPositionForValue(l,c));return o}(t):function(t){const{scale:e={},fill:i}=t;let s,n=null;return"start"===i?n=e.bottom:"end"===i?n=e.top:U(i)?n=e.getPixelForValue(i.value):e.getBasePixel&&(n=e.getBasePixel()),X(n)?(s=e.isHorizontal(),{x:s?n:null,y:s?null:n}):null}(t)}function uo(t,e,i){for(;e>t;e--){const t=i[e];if(!isNaN(t.x)&&!isNaN(t.y))break}return e}function fo(t,e,i){const s=[];for(let n=0;n<i.length;n++){const o=i[n],{first:a,last:r,point:l}=go(o,e,"x");if(!(!l||a&&r))if(a)s.unshift(l);else if(t.push(l),!r)break}t.push(...s)}function go(t,e,i){const s=t.interpolate(e,i);if(!s)return{};const n=s[i],o=t.segments,a=t.points;let r=!1,l=!1;for(let t=0;t<o.length;t++){const e=o[t],s=a[e.start][i],h=a[e.end][i];if(Yt(n,s,h)){r=n===s,l=n===h;break}}return{first:r,last:l,point:s}}function po(t){const{chart:e,fill:i,line:s}=t;if(X(i))return function(t,e){const i=t.getDatasetMeta(e);return i&&t.isDatasetVisible(e)?i.dataset:null}(e,i);if("stack"===i)return function(t){const{scale:e,index:i,line:s}=t,n=[],o=s.segments,a=s.points,r=function(t,e){const i=[],s=t.getMatchingVisibleMetas("line");for(let t=0;t<s.length;t++){const n=s[t];if(n.index===e)break;n.hidden||i.unshift(n.dataset)}return i}(e,i);r.push(mo({x:null,y:e.bottom},s));for(let t=0;t<o.length;t++){const e=o[t];for(let t=e.start;t<=e.end;t++)fo(n,a[t],r)}return new qn({points:n,options:{}})}(t);if("shape"===i)return!0;const n=co(t);return n instanceof ho?n:mo(n,s)}function mo(t,e){let i=[],s=!1;return Y(t)?(s=!0,i=t):i=function(t,e){const{x:i=null,y:s=null}=t||{},n=e.points,o=[];return e.segments.forEach((({start:t,end:e})=>{e=uo(t,e,n);const a=n[t],r=n[e];null!==s?(o.push({x:a.x,y:s}),o.push({x:r.x,y:s})):null!==i&&(o.push({x:i,y:a.y}),o.push({x:i,y:r.y}))})),o}(t,e),i.length?new qn({points:i,options:{tension:0},_loop:s,_fullLoop:s}):null}function xo(t,e,i){let s=t[e].fill;const n=[e];let o;if(!i)return s;for(;!1!==s&&-1===n.indexOf(s);){if(!X(s))return s;if(o=t[s],!o)return!1;if(o.visible)return s;n.push(s),s=o.fill}return!1}function bo(t,e,i){t.beginPath(),e.path(t),t.lineTo(e.last().x,i),t.lineTo(e.first().x,i),t.closePath(),t.clip()}function _o(t,e,i,s){if(s)return;let n=e[t],o=i[t];return"angle"===t&&(n=Nt(n),o=Nt(o)),{property:t,start:n,end:o}}function yo(t,e,i,s){return t&&e?s(t[i],e[i]):t?t[i]:e?e[i]:0}function vo(t,e,i){const{top:s,bottom:n}=e.chart.chartArea,{property:o,start:a,end:r}=i||{};"x"===o&&(t.beginPath(),t.rect(a,s,r-a,n-s),t.clip())}function wo(t,e,i,s){const n=e.interpolate(i,s);n&&t.lineTo(n.x,n.y)}function Mo(t,e){const{line:i,target:s,property:n,color:o,scale:a}=e,r=function(t,e,i){const s=t.segments,n=t.points,o=e.points,a=[];for(const t of s){let{start:s,end:r}=t;r=uo(s,r,n);const l=_o(i,n[s],n[r],t.loop);if(!e.segments){a.push({source:t,target:l,start:n[s],end:n[r]});continue}const h=Wi(e,l);for(const e of h){const s=_o(i,o[e.start],o[e.end],e.loop),r=Vi(t,n,s);for(const t of r)a.push({source:t,target:e,start:{[i]:yo(l,s,"start",Math.max)},end:{[i]:yo(l,s,"end",Math.min)}})}}return a}(i,s,n);for(const{source:e,target:l,start:h,end:c}of r){const{style:{backgroundColor:r=o}={}}=e,d=!0!==s;t.save(),t.fillStyle=r,vo(t,a,d&&_o(n,h,c)),t.beginPath();const u=!!i.pathSegment(t,e);let f;if(d){u?t.closePath():wo(t,s,c,n);const e=!!s.pathSegment(t,l,{move:u,reverse:!0});f=u&&e,f||wo(t,s,h,n)}t.closePath(),t.fill(f?"evenodd":"nonzero"),t.restore()}}function ko(t,e,i){const s=po(e),{line:n,scale:o,axis:a}=e,r=n.options,l=r.fill,h=r.backgroundColor,{above:c=h,below:d=h}=l||{};s&&n.points.length&&(Qt(t,i),function(t,e){const{line:i,target:s,above:n,below:o,area:a,scale:r}=e,l=i._loop?"angle":e.axis;t.save(),"x"===l&&o!==n&&(bo(t,s,a.top),Mo(t,{line:i,target:s,color:n,scale:r,property:l}),t.restore(),t.save(),bo(t,s,a.bottom)),Mo(t,{line:i,target:s,color:o,scale:r,property:l}),t.restore()}(t,{line:n,target:s,above:c,below:d,area:i,scale:o,axis:a}),te(t))}var So={id:"filler",afterDatasetsUpdate(t,e,i){const s=(t.data.datasets||[]).length,n=[];let o,a,r,l;for(a=0;a<s;++a)o=t.getDatasetMeta(a),r=o.dataset,l=null,r&&r.options&&r instanceof qn&&(l={visible:t.isDatasetVisible(a),index:a,fill:lo(r,a,s),chart:t,axis:o.controller.options.indexAxis,scale:o.vScale,line:r}),o.$filler=l,n.push(l);for(a=0;a<s;++a)l=n[a],l&&!1!==l.fill&&(l.fill=xo(n,a,i.propagate))},beforeDraw(t,e,i){const s="beforeDraw"===i.drawTime,n=t.getSortedVisibleDatasetMetas(),o=t.chartArea;for(let e=n.length-1;e>=0;--e){const i=n[e].$filler;i&&(i.line.updateControlPoints(o,i.axis),s&&ko(t.ctx,i,o))}},beforeDatasetsDraw(t,e,i){if("beforeDatasetsDraw"!==i.drawTime)return;const s=t.getSortedVisibleDatasetMetas();for(let e=s.length-1;e>=0;--e){const i=s[e].$filler;i&&ko(t.ctx,i,t.chartArea)}},beforeDatasetDraw(t,e,i){const s=e.meta.$filler;s&&!1!==s.fill&&"beforeDatasetDraw"===i.drawTime&&ko(t.ctx,s,t.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const Po=(t,e)=>{let{boxHeight:i=e,boxWidth:s=e}=t;return t.usePointStyle&&(i=Math.min(i,e),s=Math.min(s,e)),{boxWidth:s,boxHeight:i,itemHeight:Math.max(e,i)}};class Do extends Ds{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,i){this.maxWidth=t,this.maxHeight=e,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=J(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter((e=>t.filter(e,this.chart.data)))),t.sort&&(e=e.sort(((e,i)=>t.sort(e,i,this.chart.data)))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display)return void(this.width=this.height=0);const i=t.labels,s=He(i.font),n=s.size,o=this._computeTitleHeight(),{boxWidth:a,itemHeight:r}=Po(i,n);let l,h;e.font=s.string,this.isHorizontal()?(l=this.maxWidth,h=this._fitRows(o,n,a,r)+10):(h=this.maxHeight,l=this._fitCols(o,n,a,r)+10),this.width=Math.min(l,t.maxWidth||this.maxWidth),this.height=Math.min(h,t.maxHeight||this.maxHeight)}_fitRows(t,e,i,s){const{ctx:n,maxWidth:o,options:{labels:{padding:a}}}=this,r=this.legendHitBoxes=[],l=this.lineWidths=[0],h=s+a;let c=t;n.textAlign="left",n.textBaseline="middle";let d=-1,u=-h;return this.legendItems.forEach(((t,f)=>{const g=i+e/2+n.measureText(t.text).width;(0===f||l[l.length-1]+g+2*a>o)&&(c+=h,l[l.length-(f>0?0:1)]=0,u+=h,d++),r[f]={left:0,top:u,row:d,width:g,height:s},l[l.length-1]+=g+a})),c}_fitCols(t,e,i,s){const{ctx:n,maxHeight:o,options:{labels:{padding:a}}}=this,r=this.legendHitBoxes=[],l=this.columnSizes=[],h=o-t;let c=a,d=0,u=0,f=0,g=0;return this.legendItems.forEach(((t,o)=>{const p=i+e/2+n.measureText(t.text).width;o>0&&u+s+2*a>h&&(c+=d+a,l.push({width:d,height:u}),f+=d+a,g++,d=u=0),r[o]={left:f,top:u,col:g,width:p,height:s},d=Math.max(d,p),u+=s+a})),c+=d,l.push({width:d,height:u}),c}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:i,labels:{padding:s},rtl:o}}=this,a=Ei(o,this.left,this.width);if(this.isHorizontal()){let o=0,r=n(i,this.left+s,this.right-this.lineWidths[o]);for(const l of e)o!==l.row&&(o=l.row,r=n(i,this.left+s,this.right-this.lineWidths[o])),l.top+=this.top+t+s,l.left=a.leftForLtr(a.x(r),l.width),r+=l.width+s}else{let o=0,r=n(i,this.top+t+s,this.bottom-this.columnSizes[o].height);for(const l of e)l.col!==o&&(o=l.col,r=n(i,this.top+t+s,this.bottom-this.columnSizes[o].height)),l.top=r,l.left+=this.left+s,l.left=a.leftForLtr(a.x(l.left),l.width),r+=l.height+s}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const t=this.ctx;Qt(t,this),this._draw(),te(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:i,ctx:s}=this,{align:a,labels:r}=t,l=bt.color,h=Ei(t.rtl,this.left,this.width),c=He(r.font),{color:d,padding:u}=r,f=c.size,g=f/2;let p;this.drawTitle(),s.textAlign=h.textAlign("left"),s.textBaseline="middle",s.lineWidth=.5,s.font=c.string;const{boxWidth:m,boxHeight:x,itemHeight:b}=Po(r,f),_=this.isHorizontal(),y=this._computeTitleHeight();p=_?{x:n(a,this.left+u,this.right-i[0]),y:this.top+u+y,line:0}:{x:this.left+u,y:n(a,this.top+y+u,this.bottom-e[0].height),line:0},Ii(this.ctx,t.textDirection);const v=b+u;this.legendItems.forEach(((w,M)=>{s.strokeStyle=w.fontColor||d,s.fillStyle=w.fontColor||d;const k=s.measureText(w.text).width,S=h.textAlign(w.textAlign||(w.textAlign=r.textAlign)),P=m+g+k;let D=p.x,C=p.y;h.setWidth(this.width),_?M>0&&D+P+u>this.right&&(C=p.y+=v,p.line++,D=p.x=n(a,this.left+u,this.right-i[p.line])):M>0&&C+v>this.bottom&&(D=p.x=D+e[p.line].width+u,p.line++,C=p.y=n(a,this.top+y+u,this.bottom-e[p.line].height));!function(t,e,i){if(isNaN(m)||m<=0||isNaN(x)||x<0)return;s.save();const n=K(i.lineWidth,1);if(s.fillStyle=K(i.fillStyle,l),s.lineCap=K(i.lineCap,"butt"),s.lineDashOffset=K(i.lineDashOffset,0),s.lineJoin=K(i.lineJoin,"miter"),s.lineWidth=n,s.strokeStyle=K(i.strokeStyle,l),s.setLineDash(K(i.lineDash,[])),r.usePointStyle){const o={radius:m*Math.SQRT2/2,pointStyle:i.pointStyle,rotation:i.rotation,borderWidth:n},a=h.xPlus(t,m/2);Zt(s,o,a,e+g)}else{const o=e+Math.max((f-x)/2,0),a=h.leftForLtr(t,m),r=We(i.borderRadius);s.beginPath(),Object.values(r).some((t=>0!==t))?oe(s,{x:a,y:o,w:m,h:x,radius:r}):s.rect(a,o,m,x),s.fill(),0!==n&&s.stroke()}s.restore()}(h.x(D),C,w),D=o(S,D+m+g,_?D+P:this.right,t.rtl),function(t,e,i){se(s,i.text,t,e+b/2,c,{strikethrough:i.hidden,textAlign:h.textAlign(i.textAlign)})}(h.x(D),C,w),_?p.x+=P+u:p.y+=v})),zi(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,i=He(e.font),o=Ne(e.padding);if(!e.display)return;const a=Ei(t.rtl,this.left,this.width),r=this.ctx,l=e.position,h=i.size/2,c=o.top+h;let d,u=this.left,f=this.width;if(this.isHorizontal())f=Math.max(...this.lineWidths),d=this.top+c,u=n(t.align,u,this.right-f);else{const e=this.columnSizes.reduce(((t,e)=>Math.max(t,e.height)),0);d=c+n(t.align,this.top,this.bottom-e-t.labels.padding-this._computeTitleHeight())}const g=n(l,u,u+f);r.textAlign=a.textAlign(s(l)),r.textBaseline="middle",r.strokeStyle=e.color,r.fillStyle=e.color,r.font=i.string,se(r,e.text,g,d,i)}_computeTitleHeight(){const t=this.options.title,e=He(t.font),i=Ne(t.padding);return t.display?e.lineHeight+i.height:0}_getLegendItemAt(t,e){let i,s,n;if(Yt(t,this.left,this.right)&&Yt(e,this.top,this.bottom))for(n=this.legendHitBoxes,i=0;i<n.length;++i)if(s=n[i],Yt(t,s.left,s.left+s.width)&&Yt(e,s.top,s.top+s.height))return this.legendItems[i];return null}handleEvent(t){const e=this.options;if(!function(t,e){if("mousemove"===t&&(e.onHover||e.onLeave))return!0;if(e.onClick&&("click"===t||"mouseup"===t))return!0;return!1}(t.type,e))return;const i=this._getLegendItemAt(t.x,t.y);if("mousemove"===t.type){const o=this._hoveredItem,a=(n=i,null!==(s=o)&&null!==n&&s.datasetIndex===n.datasetIndex&&s.index===n.index);o&&!a&&J(e.onLeave,[t,o,this],this),this._hoveredItem=i,i&&!a&&J(e.onHover,[t,i,this],this)}else i&&J(e.onClick,[t,i,this],this);var s,n}}var Co={id:"legend",_element:Do,start(t,e,i){const s=t.legend=new Do({ctx:t.ctx,options:i,chart:t});ni.configure(t,s,i),ni.addBox(t,s)},stop(t){ni.removeBox(t,t.legend),delete t.legend},beforeUpdate(t,e,i){const s=t.legend;ni.configure(t,s,i),s.options=i},afterUpdate(t){const e=t.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(t,e){e.replay||t.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(t,e,i){const s=e.datasetIndex,n=i.chart;n.isDatasetVisible(s)?(n.hide(s),e.hidden=!0):(n.show(s),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:t=>t.chart.options.color,boxWidth:40,padding:10,generateLabels(t){const e=t.data.datasets,{labels:{usePointStyle:i,pointStyle:s,textAlign:n,color:o}}=t.legend.options;return t._getSortedDatasetMetas().map((t=>{const a=t.controller.getStyle(i?0:void 0),r=Ne(a.borderWidth);return{text:e[t.index].label,fillStyle:a.backgroundColor,fontColor:o,hidden:!t.visible,lineCap:a.borderCapStyle,lineDash:a.borderDash,lineDashOffset:a.borderDashOffset,lineJoin:a.borderJoinStyle,lineWidth:(r.width+r.height)/4,strokeStyle:a.borderColor,pointStyle:s||a.pointStyle,rotation:a.rotation,textAlign:n||a.textAlign,borderRadius:0,datasetIndex:t.index}}),this)}},title:{color:t=>t.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:t=>!t.startsWith("on"),labels:{_scriptable:t=>!["generateLabels","filter","sort"].includes(t)}}};class Oo extends Ds{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const i=this.options;if(this.left=0,this.top=0,!i.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=t,this.height=this.bottom=e;const s=Y(i.text)?i.text.length:1;this._padding=Ne(i.padding);const n=s*He(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=n:this.width=n}isHorizontal(){const t=this.options.position;return"top"===t||"bottom"===t}_drawArgs(t){const{top:e,left:i,bottom:s,right:o,options:a}=this,r=a.align;let l,h,c,d=0;return this.isHorizontal()?(h=n(r,i,o),c=e+t,l=o-i):("left"===a.position?(h=i+t,c=n(r,s,e),d=-.5*_t):(h=o-t,c=n(r,e,s),d=.5*_t),l=s-e),{titleX:h,titleY:c,maxWidth:l,rotation:d}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const i=He(e.font),n=i.lineHeight/2+this._padding.top,{titleX:o,titleY:a,maxWidth:r,rotation:l}=this._drawArgs(n);se(t,e.text,0,0,i,{color:e.color,maxWidth:r,rotation:l,textAlign:s(e.align),textBaseline:"middle",translation:[o,a]})}}var Ao={id:"title",_element:Oo,start(t,e,i){!function(t,e){const i=new Oo({ctx:t.ctx,options:e,chart:t});ni.configure(t,i,e),ni.addBox(t,i),t.titleBlock=i}(t,i)},stop(t){const e=t.titleBlock;ni.removeBox(t,e),delete t.titleBlock},beforeUpdate(t,e,i){const s=t.titleBlock;ni.configure(t,s,i),s.options=i},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const To=new WeakMap;var Lo={id:"subtitle",start(t,e,i){const s=new Oo({ctx:t.ctx,options:i,chart:t});ni.configure(t,s,i),ni.addBox(t,s),To.set(t,s)},stop(t){ni.removeBox(t,To.get(t)),To.delete(t)},beforeUpdate(t,e,i){const s=To.get(t);ni.configure(t,s,i),s.options=i},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Ro={average(t){if(!t.length)return!1;let e,i,s=0,n=0,o=0;for(e=0,i=t.length;e<i;++e){const i=t[e].element;if(i&&i.hasValue()){const t=i.tooltipPosition();s+=t.x,n+=t.y,++o}}return{x:s/o,y:n/o}},nearest(t,e){if(!t.length)return!1;let i,s,n,o=e.x,a=e.y,r=Number.POSITIVE_INFINITY;for(i=0,s=t.length;i<s;++i){const s=t[i].element;if(s&&s.hasValue()){const t=Vt(e,s.getCenterPoint());t<r&&(r=t,n=s)}}if(n){const t=n.tooltipPosition();o=t.x,a=t.y}return{x:o,y:a}}};function Eo(t,e){return e&&(Y(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function Io(t){return("string"==typeof t||t instanceof String)&&t.indexOf("\n")>-1?t.split("\n"):t}function zo(t,e){const{element:i,datasetIndex:s,index:n}=e,o=t.getDatasetMeta(s).controller,{label:a,value:r}=o.getLabelAndValue(n);return{chart:t,label:a,parsed:o.getParsed(n),raw:t.data.datasets[s].data[n],formattedValue:r,dataset:o.getDataset(),dataIndex:n,datasetIndex:s,element:i}}function Fo(t,e){const i=t.chart.ctx,{body:s,footer:n,title:o}=t,{boxWidth:a,boxHeight:r}=e,l=He(e.bodyFont),h=He(e.titleFont),c=He(e.footerFont),d=o.length,u=n.length,f=s.length,g=Ne(e.padding);let p=g.height,m=0,x=s.reduce(((t,e)=>t+e.before.length+e.lines.length+e.after.length),0);if(x+=t.beforeBody.length+t.afterBody.length,d&&(p+=d*h.lineHeight+(d-1)*e.titleSpacing+e.titleMarginBottom),x){p+=f*(e.displayColors?Math.max(r,l.lineHeight):l.lineHeight)+(x-f)*l.lineHeight+(x-1)*e.bodySpacing}u&&(p+=e.footerMarginTop+u*c.lineHeight+(u-1)*e.footerSpacing);let b=0;const _=function(t){m=Math.max(m,i.measureText(t).width+b)};return i.save(),i.font=h.string,Q(t.title,_),i.font=l.string,Q(t.beforeBody.concat(t.afterBody),_),b=e.displayColors?a+2+e.boxPadding:0,Q(s,(t=>{Q(t.before,_),Q(t.lines,_),Q(t.after,_)})),b=0,i.font=c.string,Q(t.footer,_),i.restore(),m+=g.width,{width:m,height:p}}function Bo(t,e,i,s){const{x:n,width:o}=i,{width:a,chartArea:{left:r,right:l}}=t;let h="center";return"center"===s?h=n<=(r+l)/2?"left":"right":n<=o/2?h="left":n>=a-o/2&&(h="right"),function(t,e,i,s){const{x:n,width:o}=s,a=i.caretSize+i.caretPadding;return"left"===t&&n+o+a>e.width||"right"===t&&n-o-a<0||void 0}(h,t,e,i)&&(h="center"),h}function Vo(t,e,i){const s=i.yAlign||e.yAlign||function(t,e){const{y:i,height:s}=e;return i<s/2?"top":i>t.height-s/2?"bottom":"center"}(t,i);return{xAlign:i.xAlign||e.xAlign||Bo(t,e,i,s),yAlign:s}}function Wo(t,e,i,s){const{caretSize:n,caretPadding:o,cornerRadius:a}=t,{xAlign:r,yAlign:l}=i,h=n+o,{topLeft:c,topRight:d,bottomLeft:u,bottomRight:f}=We(a);let g=function(t,e){let{x:i,width:s}=t;return"right"===e?i-=s:"center"===e&&(i-=s/2),i}(e,r);const p=function(t,e,i){let{y:s,height:n}=t;return"top"===e?s+=i:s-="bottom"===e?n+i:n/2,s}(e,l,h);return"center"===l?"left"===r?g+=h:"right"===r&&(g-=h):"left"===r?g-=Math.max(c,u)+n:"right"===r&&(g+=Math.max(d,f)+n),{x:jt(g,0,s.width-e.width),y:jt(p,0,s.height-e.height)}}function No(t,e,i){const s=Ne(i.padding);return"center"===e?t.x+t.width/2:"right"===e?t.x+t.width-s.right:t.x+s.left}function Ho(t){return Eo([],Io(t))}function jo(t,e){const i=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return i?t.override(i):t}class $o extends Ds{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart||t._chart,this._chart=this.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,i=this.options.setContext(this.getContext()),s=i.enabled&&e.options.animation&&i.animations,n=new gs(this.chart,s);return s._cacheable&&(this._cachedAnimations=Object.freeze(n)),n}getContext(){return this.$context||(this.$context=(t=this.chart.getContext(),e=this,i=this._tooltipItems,Ye(t,{tooltip:e,tooltipItems:i,type:"tooltip"})));var t,e,i}getTitle(t,e){const{callbacks:i}=e,s=i.beforeTitle.apply(this,[t]),n=i.title.apply(this,[t]),o=i.afterTitle.apply(this,[t]);let a=[];return a=Eo(a,Io(s)),a=Eo(a,Io(n)),a=Eo(a,Io(o)),a}getBeforeBody(t,e){return Ho(e.callbacks.beforeBody.apply(this,[t]))}getBody(t,e){const{callbacks:i}=e,s=[];return Q(t,(t=>{const e={before:[],lines:[],after:[]},n=jo(i,t);Eo(e.before,Io(n.beforeLabel.call(this,t))),Eo(e.lines,n.label.call(this,t)),Eo(e.after,Io(n.afterLabel.call(this,t))),s.push(e)})),s}getAfterBody(t,e){return Ho(e.callbacks.afterBody.apply(this,[t]))}getFooter(t,e){const{callbacks:i}=e,s=i.beforeFooter.apply(this,[t]),n=i.footer.apply(this,[t]),o=i.afterFooter.apply(this,[t]);let a=[];return a=Eo(a,Io(s)),a=Eo(a,Io(n)),a=Eo(a,Io(o)),a}_createItems(t){const e=this._active,i=this.chart.data,s=[],n=[],o=[];let a,r,l=[];for(a=0,r=e.length;a<r;++a)l.push(zo(this.chart,e[a]));return t.filter&&(l=l.filter(((e,s,n)=>t.filter(e,s,n,i)))),t.itemSort&&(l=l.sort(((e,s)=>t.itemSort(e,s,i)))),Q(l,(e=>{const i=jo(t.callbacks,e);s.push(i.labelColor.call(this,e)),n.push(i.labelPointStyle.call(this,e)),o.push(i.labelTextColor.call(this,e))})),this.labelColors=s,this.labelPointStyles=n,this.labelTextColors=o,this.dataPoints=l,l}update(t,e){const i=this.options.setContext(this.getContext()),s=this._active;let n,o=[];if(s.length){const t=Ro[i.position].call(this,s,this._eventPosition);o=this._createItems(i),this.title=this.getTitle(o,i),this.beforeBody=this.getBeforeBody(o,i),this.body=this.getBody(o,i),this.afterBody=this.getAfterBody(o,i),this.footer=this.getFooter(o,i);const e=this._size=Fo(this,i),a=Object.assign({},t,e),r=Vo(this.chart,i,a),l=Wo(i,a,r,this.chart);this.xAlign=r.xAlign,this.yAlign=r.yAlign,n={opacity:1,x:l.x,y:l.y,width:e.width,height:e.height,caretX:t.x,caretY:t.y}}else 0!==this.opacity&&(n={opacity:0});this._tooltipItems=o,this.$context=void 0,n&&this._resolveAnimations().update(this,n),t&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,i,s){const n=this.getCaretPosition(t,i,s);e.lineTo(n.x1,n.y1),e.lineTo(n.x2,n.y2),e.lineTo(n.x3,n.y3)}getCaretPosition(t,e,i){const{xAlign:s,yAlign:n}=this,{caretSize:o,cornerRadius:a}=i,{topLeft:r,topRight:l,bottomLeft:h,bottomRight:c}=We(a),{x:d,y:u}=t,{width:f,height:g}=e;let p,m,x,b,_,y;return"center"===n?(_=u+g/2,"left"===s?(p=d,m=p-o,b=_+o,y=_-o):(p=d+f,m=p+o,b=_-o,y=_+o),x=p):(m="left"===s?d+Math.max(r,h)+o:"right"===s?d+f-Math.max(l,c)-o:this.caretX,"top"===n?(b=u,_=b-o,p=m-o,x=m+o):(b=u+g,_=b+o,p=m+o,x=m-o),y=b),{x1:p,x2:m,x3:x,y1:b,y2:_,y3:y}}drawTitle(t,e,i){const s=this.title,n=s.length;let o,a,r;if(n){const l=Ei(i.rtl,this.x,this.width);for(t.x=No(this,i.titleAlign,i),e.textAlign=l.textAlign(i.titleAlign),e.textBaseline="middle",o=He(i.titleFont),a=i.titleSpacing,e.fillStyle=i.titleColor,e.font=o.string,r=0;r<n;++r)e.fillText(s[r],l.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+a,r+1===n&&(t.y+=i.titleMarginBottom-a)}}_drawColorBox(t,e,i,s,n){const o=this.labelColors[i],a=this.labelPointStyles[i],{boxHeight:r,boxWidth:l,boxPadding:h}=n,c=He(n.bodyFont),d=No(this,"left",n),u=s.x(d),f=r<c.lineHeight?(c.lineHeight-r)/2:0,g=e.y+f;if(n.usePointStyle){const e={radius:Math.min(l,r)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},i=s.leftForLtr(u,l)+l/2,h=g+r/2;t.strokeStyle=n.multiKeyBackground,t.fillStyle=n.multiKeyBackground,Zt(t,e,i,h),t.strokeStyle=o.borderColor,t.fillStyle=o.backgroundColor,Zt(t,e,i,h)}else{t.lineWidth=o.borderWidth||1,t.strokeStyle=o.borderColor,t.setLineDash(o.borderDash||[]),t.lineDashOffset=o.borderDashOffset||0;const e=s.leftForLtr(u,l-h),i=s.leftForLtr(s.xPlus(u,1),l-h-2),a=We(o.borderRadius);Object.values(a).some((t=>0!==t))?(t.beginPath(),t.fillStyle=n.multiKeyBackground,oe(t,{x:e,y:g,w:l,h:r,radius:a}),t.fill(),t.stroke(),t.fillStyle=o.backgroundColor,t.beginPath(),oe(t,{x:i,y:g+1,w:l-2,h:r-2,radius:a}),t.fill()):(t.fillStyle=n.multiKeyBackground,t.fillRect(e,g,l,r),t.strokeRect(e,g,l,r),t.fillStyle=o.backgroundColor,t.fillRect(i,g+1,l-2,r-2))}t.fillStyle=this.labelTextColors[i]}drawBody(t,e,i){const{body:s}=this,{bodySpacing:n,bodyAlign:o,displayColors:a,boxHeight:r,boxWidth:l,boxPadding:h}=i,c=He(i.bodyFont);let d=c.lineHeight,u=0;const f=Ei(i.rtl,this.x,this.width),g=function(i){e.fillText(i,f.x(t.x+u),t.y+d/2),t.y+=d+n},p=f.textAlign(o);let m,x,b,_,y,v,w;for(e.textAlign=o,e.textBaseline="middle",e.font=c.string,t.x=No(this,p,i),e.fillStyle=i.bodyColor,Q(this.beforeBody,g),u=a&&"right"!==p?"center"===o?l/2+h:l+2+h:0,_=0,v=s.length;_<v;++_){for(m=s[_],x=this.labelTextColors[_],e.fillStyle=x,Q(m.before,g),b=m.lines,a&&b.length&&(this._drawColorBox(e,t,_,f,i),d=Math.max(c.lineHeight,r)),y=0,w=b.length;y<w;++y)g(b[y]),d=c.lineHeight;Q(m.after,g)}u=0,d=c.lineHeight,Q(this.afterBody,g),t.y-=n}drawFooter(t,e,i){const s=this.footer,n=s.length;let o,a;if(n){const r=Ei(i.rtl,this.x,this.width);for(t.x=No(this,i.footerAlign,i),t.y+=i.footerMarginTop,e.textAlign=r.textAlign(i.footerAlign),e.textBaseline="middle",o=He(i.footerFont),e.fillStyle=i.footerColor,e.font=o.string,a=0;a<n;++a)e.fillText(s[a],r.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+i.footerSpacing}}drawBackground(t,e,i,s){const{xAlign:n,yAlign:o}=this,{x:a,y:r}=t,{width:l,height:h}=i,{topLeft:c,topRight:d,bottomLeft:u,bottomRight:f}=We(s.cornerRadius);e.fillStyle=s.backgroundColor,e.strokeStyle=s.borderColor,e.lineWidth=s.borderWidth,e.beginPath(),e.moveTo(a+c,r),"top"===o&&this.drawCaret(t,e,i,s),e.lineTo(a+l-d,r),e.quadraticCurveTo(a+l,r,a+l,r+d),"center"===o&&"right"===n&&this.drawCaret(t,e,i,s),e.lineTo(a+l,r+h-f),e.quadraticCurveTo(a+l,r+h,a+l-f,r+h),"bottom"===o&&this.drawCaret(t,e,i,s),e.lineTo(a+u,r+h),e.quadraticCurveTo(a,r+h,a,r+h-u),"center"===o&&"left"===n&&this.drawCaret(t,e,i,s),e.lineTo(a,r+c),e.quadraticCurveTo(a,r,a+c,r),e.closePath(),e.fill(),s.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,i=this.$animations,s=i&&i.x,n=i&&i.y;if(s||n){const i=Ro[t.position].call(this,this._active,this._eventPosition);if(!i)return;const o=this._size=Fo(this,t),a=Object.assign({},i,this._size),r=Vo(e,t,a),l=Wo(t,a,r,e);s._to===l.x&&n._to===l.y||(this.xAlign=r.xAlign,this.yAlign=r.yAlign,this.width=o.width,this.height=o.height,this.caretX=i.x,this.caretY=i.y,this._resolveAnimations().update(this,l))}}draw(t){const e=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(e);const s={width:this.width,height:this.height},n={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const o=Ne(e.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&a&&(t.save(),t.globalAlpha=i,this.drawBackground(n,t,s,e),Ii(t,e.textDirection),n.y+=o.top,this.drawTitle(n,t,e),this.drawBody(n,t,e),this.drawFooter(n,t,e),zi(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const i=this._active,s=t.map((({datasetIndex:t,index:e})=>{const i=this.chart.getDatasetMeta(t);if(!i)throw new Error("Cannot find a dataset at index "+t);return{datasetIndex:t,element:i.data[e],index:e}})),n=!tt(i,s),o=this._positionChanged(s,e);(n||o)&&(this._active=s,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,i=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const s=this.options,n=this._active||[],o=this._getActiveElements(t,n,e,i),a=this._positionChanged(o,t),r=e||!tt(o,n)||a;return r&&(this._active=o,(s.enabled||s.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),r}_getActiveElements(t,e,i,s){const n=this.options;if("mouseout"===t.type)return[];if(!s)return e;const o=this.chart.getElementsAtEventForMode(t,n.mode,n,i);return n.reverse&&o.reverse(),o}_positionChanged(t,e){const{caretX:i,caretY:s,options:n}=this,o=Ro[n.position].call(this,t,e);return!1!==o&&(i!==o.x||s!==o.y)}}$o.positioners=Ro;var Yo={id:"tooltip",_element:$o,positioners:Ro,afterInit(t,e,i){i&&(t.tooltip=new $o({chart:t,options:i}))},beforeUpdate(t,e,i){t.tooltip&&t.tooltip.initialize(i)},reset(t,e,i){t.tooltip&&t.tooltip.initialize(i)},afterDraw(t){const e=t.tooltip,i={tooltip:e};!1!==t.notifyPlugins("beforeTooltipDraw",i)&&(e&&e.draw(t.ctx),t.notifyPlugins("afterTooltipDraw",i))},afterEvent(t,e){if(t.tooltip){const i=e.replay;t.tooltip.handleEvent(e.event,i,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(t,e)=>e.bodyFont.size,boxWidth:(t,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:{beforeTitle:H,title(t){if(t.length>0){const e=t[0],i=e.chart.data.labels,s=i?i.length:0;if(this&&this.options&&"dataset"===this.options.mode)return e.dataset.label||"";if(e.label)return e.label;if(s>0&&e.dataIndex<s)return i[e.dataIndex]}return""},afterTitle:H,beforeBody:H,beforeLabel:H,label(t){if(this&&this.options&&"dataset"===this.options.mode)return t.label+": "+t.formattedValue||t.formattedValue;let e=t.dataset.label||"";e&&(e+=": ");const i=t.formattedValue;return $(i)||(e+=i),e},labelColor(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:H,afterBody:H,beforeFooter:H,footer:H,afterFooter:H}},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:t=>"filter"!==t&&"itemSort"!==t&&"external"!==t,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},Uo=Object.freeze({__proto__:null,Decimation:ro,Filler:So,Legend:Co,SubTitle:Lo,Title:Ao,Tooltip:Yo});function Xo(t,e,i,s){const n=t.indexOf(e);if(-1===n)return((t,e,i,s)=>("string"==typeof e?(i=t.push(e)-1,s.unshift({index:i,label:e})):isNaN(e)&&(i=null),i))(t,e,i,s);return n!==t.lastIndexOf(e)?i:n}class qo extends Bs{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const t=this.getLabels();for(const{index:i,label:s}of e)t[i]===s&&t.splice(i,1);this._addedLabels=[]}super.init(t)}parse(t,e){if($(t))return null;const i=this.getLabels();return((t,e)=>null===t?null:jt(Math.round(t),0,e))(e=isFinite(e)&&i[e]===t?e:Xo(i,t,K(e,t),this._addedLabels),i.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:i,max:s}=this.getMinMax(!0);"ticks"===this.options.bounds&&(t||(i=0),e||(s=this.getLabels().length-1)),this.min=i,this.max=s}buildTicks(){const t=this.min,e=this.max,i=this.options.offset,s=[];let n=this.getLabels();n=0===t&&e===n.length-1?n:n.slice(t,e+1),this._valueRange=Math.max(n.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let i=t;i<=e;i++)s.push({value:i});return s}getLabelForValue(t){const e=this.getLabels();return t>=0&&t<e.length?e[t]:t}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return"number"!=typeof t&&(t=this.parse(t)),null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}function Ko(t,e,{horizontal:i,minRotation:s}){const n=It(s),o=(i?Math.sin(n):Math.cos(n))||.001,a=.75*e*(""+t).length;return Math.min(e/o,a)}qo.id="category",qo.defaults={ticks:{callback:qo.prototype.getLabelForValue}};class Go extends Bs{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return $(t)||("number"==typeof t||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:i}=this.getUserBounds();let{min:s,max:n}=this;const o=t=>s=e?s:t,a=t=>n=i?n:t;if(t){const t=Ct(s),e=Ct(n);t<0&&e<0?a(0):t>0&&e>0&&o(0)}if(s===n){let e=1;(n>=Number.MAX_SAFE_INTEGER||s<=Number.MIN_SAFE_INTEGER)&&(e=Math.abs(.05*n)),a(n+e),t||o(s-e)}this.min=s,this.max=n}getTickLimit(){const t=this.options.ticks;let e,{maxTicksLimit:i,stepSize:s}=t;return s?(e=Math.ceil(this.max/s)-Math.floor(this.min/s)+1,e>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${s} would result generating up to ${e} ticks. Limiting to 1000.`),e=1e3)):(e=this.computeTickLimit(),i=i||11),i&&(e=Math.min(i,e)),e}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let i=this.getTickLimit();i=Math.max(2,i);const s=function(t,e){const i=[],{bounds:s,step:n,min:o,max:a,precision:r,count:l,maxTicks:h,maxDigits:c,includeBounds:d}=t,u=n||1,f=h-1,{min:g,max:p}=e,m=!$(o),x=!$(a),b=!$(l),_=(p-g)/(c+1);let y,v,w,M,k=Ot((p-g)/f/u)*u;if(k<1e-14&&!m&&!x)return[{value:g},{value:p}];M=Math.ceil(p/k)-Math.floor(g/k),M>f&&(k=Ot(M*k/f/u)*u),$(r)||(y=Math.pow(10,r),k=Math.ceil(k*y)/y),"ticks"===s?(v=Math.floor(g/k)*k,w=Math.ceil(p/k)*k):(v=g,w=p),m&&x&&n&&Rt((a-o)/n,k/1e3)?(M=Math.round(Math.min((a-o)/k,h)),k=(a-o)/M,v=o,w=a):b?(v=m?o:v,w=x?a:w,M=l-1,k=(w-v)/M):(M=(w-v)/k,M=Lt(M,Math.round(M),k/1e3)?Math.round(M):Math.ceil(M));const S=Math.max(Ft(k),Ft(v));y=Math.pow(10,$(r)?S:r),v=Math.round(v*y)/y,w=Math.round(w*y)/y;let P=0;for(m&&(d&&v!==o?(i.push({value:o}),v<o&&P++,Lt(Math.round((v+P*k)*y)/y,o,Ko(o,_,t))&&P++):v<o&&P++);P<M;++P)i.push({value:Math.round((v+P*k)*y)/y});return x&&d&&w!==a?i.length&&Lt(i[i.length-1].value,a,Ko(a,_,t))?i[i.length-1].value=a:i.push({value:a}):x&&w!==a||i.push({value:w}),i}({maxTicks:i,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:!1!==e.includeBounds},this._range||this);return"ticks"===t.bounds&&Et(s,this,"value"),t.reverse?(s.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),s}configure(){const t=this.ticks;let e=this.min,i=this.max;if(super.configure(),this.options.offset&&t.length){const s=(i-e)/Math.max(t.length-1,1)/2;e-=s,i+=s}this._startValue=e,this._endValue=i,this._valueRange=i-e}getLabelForValue(t){return Ri(t,this.chart.options.locale,this.options.ticks.format)}}class Zo extends Go{determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=X(t)?t:0,this.max=X(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,i=It(this.options.ticks.minRotation),s=(t?Math.sin(i):Math.cos(i))||.001,n=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,n.lineHeight/s))}getPixelForValue(t){return null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}function Jo(t){return 1===t/Math.pow(10,Math.floor(Dt(t)))}Zo.id="linear",Zo.defaults={ticks:{callback:Os.formatters.numeric}};class Qo extends Bs{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const i=Go.prototype.parse.apply(this,[t,e]);if(0!==i)return X(i)&&i>0?i:null;this._zero=!0}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=X(t)?Math.max(0,t):null,this.max=X(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let i=this.min,s=this.max;const n=e=>i=t?i:e,o=t=>s=e?s:t,a=(t,e)=>Math.pow(10,Math.floor(Dt(t))+e);i===s&&(i<=0?(n(1),o(10)):(n(a(i,-1)),o(a(s,1)))),i<=0&&n(a(s,-1)),s<=0&&o(a(i,1)),this._zero&&this.min!==this._suggestedMin&&i===a(this.min,0)&&n(a(i,-1)),this.min=i,this.max=s}buildTicks(){const t=this.options,e=function(t,e){const i=Math.floor(Dt(e.max)),s=Math.ceil(e.max/Math.pow(10,i)),n=[];let o=q(t.min,Math.pow(10,Math.floor(Dt(e.min)))),a=Math.floor(Dt(o)),r=Math.floor(o/Math.pow(10,a)),l=a<0?Math.pow(10,Math.abs(a)):1;do{n.push({value:o,major:Jo(o)}),++r,10===r&&(r=1,++a,l=a>=0?1:l),o=Math.round(r*Math.pow(10,a)*l)/l}while(a<i||a===i&&r<s);const h=q(t.max,o);return n.push({value:h,major:Jo(o)}),n}({min:this._userMin,max:this._userMax},this);return"ticks"===t.bounds&&Et(e,this,"value"),t.reverse?(e.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),e}getLabelForValue(t){return void 0===t?"0":Ri(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=Dt(t),this._valueRange=Dt(this.max)-Dt(t)}getPixelForValue(t){return void 0!==t&&0!==t||(t=this.min),null===t||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(Dt(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}function ta(t){const e=t.ticks;if(e.display&&t.display){const t=Ne(e.backdropPadding);return K(e.font&&e.font.size,bt.font.size)+t.height}return 0}function ea(t,e,i,s,n){return t===s||t===n?{start:e-i/2,end:e+i/2}:t<s||t>n?{start:e-i,end:e}:{start:e,end:e+i}}function ia(t){const e={l:t.left+t._padding.left,r:t.right-t._padding.right,t:t.top+t._padding.top,b:t.bottom-t._padding.bottom},i=Object.assign({},e),s=[],n=[],o=t._pointLabels.length,a=t.options.pointLabels,r=a.centerPointLabels?_t/o:0;for(let d=0;d<o;d++){const o=a.setContext(t.getPointLabelContext(d));n[d]=o.padding;const u=t.getPointPosition(d,t.drawingArea+n[d],r),f=He(o.font),g=(l=t.ctx,h=f,c=Y(c=t._pointLabels[d])?c:[c],{w:qt(l,h.string,c),h:c.length*h.lineHeight});s[d]=g;const p=Nt(t.getIndexAngle(d)+r),m=Math.round(zt(p));sa(i,e,p,ea(m,u.x,g.w,0,180),ea(m,u.y,g.h,90,270))}var l,h,c;t.setCenterPoint(e.l-i.l,i.r-e.r,e.t-i.t,i.b-e.b),t._pointLabelItems=function(t,e,i){const s=[],n=t._pointLabels.length,o=t.options,a=ta(o)/2,r=t.drawingArea,l=o.pointLabels.centerPointLabels?_t/n:0;for(let o=0;o<n;o++){const n=t.getPointPosition(o,r+a+i[o],l),h=Math.round(zt(Nt(n.angle+kt))),c=e[o],d=aa(n.y,c.h,h),u=na(h),f=oa(n.x,c.w,u);s.push({x:n.x,y:d,textAlign:u,left:f,top:d,right:f+c.w,bottom:d+c.h})}return s}(t,s,n)}function sa(t,e,i,s,n){const o=Math.abs(Math.sin(i)),a=Math.abs(Math.cos(i));let r=0,l=0;s.start<e.l?(r=(e.l-s.start)/o,t.l=Math.min(t.l,e.l-r)):s.end>e.r&&(r=(s.end-e.r)/o,t.r=Math.max(t.r,e.r+r)),n.start<e.t?(l=(e.t-n.start)/a,t.t=Math.min(t.t,e.t-l)):n.end>e.b&&(l=(n.end-e.b)/a,t.b=Math.max(t.b,e.b+l))}function na(t){return 0===t||180===t?"center":t<180?"left":"right"}function oa(t,e,i){return"right"===i?t-=e:"center"===i&&(t-=e/2),t}function aa(t,e,i){return 90===i||270===i?t-=e/2:(i>270||i<90)&&(t-=e),t}function ra(t,e,i,s){const{ctx:n}=t;if(i)n.arc(t.xCenter,t.yCenter,e,0,yt);else{let i=t.getPointPosition(0,e);n.moveTo(i.x,i.y);for(let o=1;o<s;o++)i=t.getPointPosition(o,e),n.lineTo(i.x,i.y)}}Qo.id="logarithmic",Qo.defaults={ticks:{callback:Os.formatters.logarithmic,major:{enabled:!0}}};class la extends Go{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=Ne(ta(this.options)/2),e=this.width=this.maxWidth-t.width,i=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+i/2+t.top),this.drawingArea=Math.floor(Math.min(e,i)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=X(t)&&!isNaN(t)?t:0,this.max=X(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/ta(this.options))}generateTickLabels(t){Go.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map(((t,e)=>{const i=J(this.options.pointLabels.callback,[t,e],this);return i||0===i?i:""})).filter(((t,e)=>this.chart.getDataVisibility(e)))}fit(){const t=this.options;t.display&&t.pointLabels.display?ia(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,i,s){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((i-s)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,i,s))}getIndexAngle(t){return Nt(t*(yt/(this._pointLabels.length||1))+It(this.options.startAngle||0))}getDistanceFromCenterForValue(t){if($(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if($(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const i=e[t];return function(t,e,i){return Ye(t,{label:i,index:e,type:"pointLabel"})}(this.getContext(),t,i)}}getPointPosition(t,e,i=0){const s=this.getIndexAngle(t)-kt+i;return{x:Math.cos(s)*e+this.xCenter,y:Math.sin(s)*e+this.yCenter,angle:s}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:i,right:s,bottom:n}=this._pointLabelItems[t];return{left:e,top:i,right:s,bottom:n}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const i=this.ctx;i.save(),i.beginPath(),ra(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),i.closePath(),i.fillStyle=t,i.fill(),i.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:i,grid:s}=e,n=this._pointLabels.length;let o,a,r;if(e.pointLabels.display&&function(t,e){const{ctx:i,options:{pointLabels:s}}=t;for(let n=e-1;n>=0;n--){const e=s.setContext(t.getPointLabelContext(n)),o=He(e.font),{x:a,y:r,textAlign:l,left:h,top:c,right:d,bottom:u}=t._pointLabelItems[n],{backdropColor:f}=e;if(!$(f)){const t=Ne(e.backdropPadding);i.fillStyle=f,i.fillRect(h-t.left,c-t.top,d-h+t.width,u-c+t.height)}se(i,t._pointLabels[n],a,r+o.lineHeight/2,o,{color:e.color,textAlign:l,textBaseline:"middle"})}}(this,n),s.display&&this.ticks.forEach(((t,e)=>{if(0!==e){a=this.getDistanceFromCenterForValue(t.value);!function(t,e,i,s){const n=t.ctx,o=e.circular,{color:a,lineWidth:r}=e;!o&&!s||!a||!r||i<0||(n.save(),n.strokeStyle=a,n.lineWidth=r,n.setLineDash(e.borderDash),n.lineDashOffset=e.borderDashOffset,n.beginPath(),ra(t,i,o,s),n.closePath(),n.stroke(),n.restore())}(this,s.setContext(this.getContext(e-1)),a,n)}})),i.display){for(t.save(),o=n-1;o>=0;o--){const s=i.setContext(this.getPointLabelContext(o)),{color:n,lineWidth:l}=s;l&&n&&(t.lineWidth=l,t.strokeStyle=n,t.setLineDash(s.borderDash),t.lineDashOffset=s.borderDashOffset,a=this.getDistanceFromCenterForValue(e.ticks.reverse?this.min:this.max),r=this.getPointPosition(o,a),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(r.x,r.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,i=e.ticks;if(!i.display)return;const s=this.getIndexAngle(0);let n,o;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(s),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach(((s,a)=>{if(0===a&&!e.reverse)return;const r=i.setContext(this.getContext(a)),l=He(r.font);if(n=this.getDistanceFromCenterForValue(this.ticks[a].value),r.showLabelBackdrop){t.font=l.string,o=t.measureText(s.label).width,t.fillStyle=r.backdropColor;const e=Ne(r.backdropPadding);t.fillRect(-o/2-e.left,-n-l.size/2-e.top,o+e.width,l.size+e.height)}se(t,s.label,0,-n,l,{color:r.color})})),t.restore()}drawTitle(){}}la.id="radialLinear",la.defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Os.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:t=>t,padding:5,centerPointLabels:!1}},la.defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"},la.descriptors={angleLines:{_fallback:"grid"}};const ha={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},ca=Object.keys(ha);function da(t,e){return t-e}function ua(t,e){if($(e))return null;const i=t._adapter,{parser:s,round:n,isoWeekday:o}=t._parseOpts;let a=e;return"function"==typeof s&&(a=s(a)),X(a)||(a="string"==typeof s?i.parse(a,s):i.parse(a)),null===a?null:(n&&(a="week"!==n||!Tt(o)&&!0!==o?i.startOf(a,n):i.startOf(a,"isoWeek",o)),+a)}function fa(t,e,i,s){const n=ca.length;for(let o=ca.indexOf(t);o<n-1;++o){const t=ha[ca[o]],n=t.steps?t.steps:Number.MAX_SAFE_INTEGER;if(t.common&&Math.ceil((i-e)/(n*t.size))<=s)return ca[o]}return ca[n-1]}function ga(t,e,i){if(i){if(i.length){const{lo:s,hi:n}=ae(i,e);t[i[s]>=e?i[s]:i[n]]=!0}}else t[e]=!0}function pa(t,e,i){const s=[],n={},o=e.length;let a,r;for(a=0;a<o;++a)r=e[a],n[r]=a,s.push({value:r,major:!1});return 0!==o&&i?function(t,e,i,s){const n=t._adapter,o=+n.startOf(e[0].value,s),a=e[e.length-1].value;let r,l;for(r=o;r<=a;r=+n.add(r,1,s))l=i[r],l>=0&&(e[l].major=!0);return e}(t,s,n,i):s}class ma extends Bs{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e){const i=t.time||(t.time={}),s=this._adapter=new mn._date(t.adapters.date);ot(i.displayFormats,s.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return void 0===t?null:ua(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,i=t.time.unit||"day";let{min:s,max:n,minDefined:o,maxDefined:a}=this.getUserBounds();function r(t){o||isNaN(t.min)||(s=Math.min(s,t.min)),a||isNaN(t.max)||(n=Math.max(n,t.max))}o&&a||(r(this._getLabelBounds()),"ticks"===t.bounds&&"labels"===t.ticks.source||r(this.getMinMax(!1))),s=X(s)&&!isNaN(s)?s:+e.startOf(Date.now(),i),n=X(n)&&!isNaN(n)?n:+e.endOf(Date.now(),i)+1,this.min=Math.min(s,n-1),this.max=Math.max(s+1,n)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],i=t[t.length-1]),{min:e,max:i}}buildTicks(){const t=this.options,e=t.time,i=t.ticks,s="labels"===i.source?this.getLabelTimestamps():this._generate();"ticks"===t.bounds&&s.length&&(this.min=this._userMin||s[0],this.max=this._userMax||s[s.length-1]);const n=this.min,o=he(s,n,this.max);return this._unit=e.unit||(i.autoSkip?fa(e.minUnit,this.min,this.max,this._getLabelCapacity(n)):function(t,e,i,s,n){for(let o=ca.length-1;o>=ca.indexOf(i);o--){const i=ca[o];if(ha[i].common&&t._adapter.diff(n,s,i)>=e-1)return i}return ca[i?ca.indexOf(i):0]}(this,o.length,e.minUnit,this.min,this.max)),this._majorUnit=i.major.enabled&&"year"!==this._unit?function(t){for(let e=ca.indexOf(t)+1,i=ca.length;e<i;++e)if(ha[ca[e]].common)return ca[e]}(this._unit):void 0,this.initOffsets(s),t.reverse&&o.reverse(),pa(this,o,this._majorUnit)}initOffsets(t){let e,i,s=0,n=0;this.options.offset&&t.length&&(e=this.getDecimalForValue(t[0]),s=1===t.length?1-e:(this.getDecimalForValue(t[1])-e)/2,i=this.getDecimalForValue(t[t.length-1]),n=1===t.length?i:(i-this.getDecimalForValue(t[t.length-2]))/2);const o=t.length<3?.5:.25;s=jt(s,0,o),n=jt(n,0,o),this._offsets={start:s,end:n,factor:1/(s+1+n)}}_generate(){const t=this._adapter,e=this.min,i=this.max,s=this.options,n=s.time,o=n.unit||fa(n.minUnit,e,i,this._getLabelCapacity(e)),a=K(n.stepSize,1),r="week"===o&&n.isoWeekday,l=Tt(r)||!0===r,h={};let c,d,u=e;if(l&&(u=+t.startOf(u,"isoWeek",r)),u=+t.startOf(u,l?"day":o),t.diff(i,e,o)>1e5*a)throw new Error(e+" and "+i+" are too far apart with stepSize of "+a+" "+o);const f="data"===s.ticks.source&&this.getDataTimestamps();for(c=u,d=0;c<i;c=+t.add(c,a,o),d++)ga(h,c,f);return c!==i&&"ticks"!==s.bounds&&1!==d||ga(h,c,f),Object.keys(h).sort(((t,e)=>t-e)).map((t=>+t))}getLabelForValue(t){const e=this._adapter,i=this.options.time;return i.tooltipFormat?e.format(t,i.tooltipFormat):e.format(t,i.displayFormats.datetime)}_tickFormatFunction(t,e,i,s){const n=this.options,o=n.time.displayFormats,a=this._unit,r=this._majorUnit,l=a&&o[a],h=r&&o[r],c=i[e],d=r&&h&&c&&c.major,u=this._adapter.format(t,s||(d?h:l)),f=n.ticks.callback;return f?J(f,[u,e,i],this):u}generateTickLabels(t){let e,i,s;for(e=0,i=t.length;e<i;++e)s=t[e],s.label=this._tickFormatFunction(s.value,e,t)}getDecimalForValue(t){return null===t?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,i=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+i)*e.factor)}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+i*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,i=this.ctx.measureText(t).width,s=It(this.isHorizontal()?e.maxRotation:e.minRotation),n=Math.cos(s),o=Math.sin(s),a=this._resolveTickFontOptions(0).size;return{w:i*n+a*o,h:i*o+a*n}}_getLabelCapacity(t){const e=this.options.time,i=e.displayFormats,s=i[e.unit]||i.millisecond,n=this._tickFormatFunction(t,0,pa(this,[t],this._majorUnit),s),o=this._getLabelSize(n),a=Math.floor(this.isHorizontal()?this.width/o.w:this.height/o.h)-1;return a>0?a:1}getDataTimestamps(){let t,e,i=this._cache.data||[];if(i.length)return i;const s=this.getMatchingVisibleMetas();if(this._normalized&&s.length)return this._cache.data=s[0].controller.getAllParsedValues(this);for(t=0,e=s.length;t<e;++t)i=i.concat(s[t].controller.getAllParsedValues(this));return this._cache.data=this.normalize(i)}getLabelTimestamps(){const t=this._cache.labels||[];let e,i;if(t.length)return t;const s=this.getLabels();for(e=0,i=s.length;e<i;++e)t.push(ua(this,s[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return fe(t.sort(da))}}function xa(t,e,i){let s,n,o,a,r=0,l=t.length-1;i?(e>=t[r].pos&&e<=t[l].pos&&({lo:r,hi:l}=re(t,"pos",e)),({pos:s,time:o}=t[r]),({pos:n,time:a}=t[l])):(e>=t[r].time&&e<=t[l].time&&({lo:r,hi:l}=re(t,"time",e)),({time:s,pos:o}=t[r]),({time:n,pos:a}=t[l]));const h=n-s;return h?o+(a-o)*(e-s)/h:o}ma.id="time",ma.defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",major:{enabled:!1}}};class ba extends ma{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=xa(e,this.min),this._tableRange=xa(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:i}=this,s=[],n=[];let o,a,r,l,h;for(o=0,a=t.length;o<a;++o)l=t[o],l>=e&&l<=i&&s.push(l);if(s.length<2)return[{time:e,pos:0},{time:i,pos:1}];for(o=0,a=s.length;o<a;++o)h=s[o+1],r=s[o-1],l=s[o],Math.round((h+r)/2)!==l&&n.push({time:l,pos:o/(a-1)});return n}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),i=this.getLabelTimestamps();return t=e.length&&i.length?this.normalize(e.concat(i)):e.length?e:i,t=this._cache.all=t,t}getDecimalForValue(t){return(xa(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return xa(this._table,i*this._tableRange+this._minPos,!0)}}ba.id="timeseries",ba.defaults=ma.defaults;var _a=Object.freeze({__proto__:null,CategoryScale:qo,LinearScale:Zo,LogarithmicScale:Qo,RadialLinearScale:la,TimeScale:ma,TimeSeriesScale:ba});return dn.register(Rn,_a,no,Uo),dn.helpers={...Yi},dn._adapters=mn,dn.Animation=us,dn.Animations=gs,dn.animator=a,dn.controllers=Ws.controllers.items,dn.DatasetController=Ps,dn.Element=Ds,dn.elements=no,dn.Interaction=Ee,dn.layouts=ni,dn.platforms=hs,dn.Scale=Bs,dn.Ticks=Os,Object.assign(dn,Rn,_a,no,Uo,hs),dn.Chart=dn,"undefined"!=typeof window&&(window.Chart=dn),dn}));


/*!
 * chartjs-plugin-datalabels v2.0.0
 * https://chartjs-plugin-datalabels.netlify.app
 * (c) 2017-2021 chartjs-plugin-datalabels contributors
 * Released under the MIT license
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("chart.js/helpers"),require("chart.js")):"function"==typeof define&&define.amd?define(["chart.js/helpers","chart.js"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).ChartDataLabels=e(t.Chart.helpers,t.Chart)}(this,(function(t,e){"use strict";var r=function(){if("undefined"!=typeof window){if(window.devicePixelRatio)return window.devicePixelRatio;var t=window.screen;if(t)return(t.deviceXDPI||1)/(t.logicalXDPI||1)}return 1}(),a=function(e){var r,a=[];for(e=[].concat(e);e.length;)"string"==typeof(r=e.pop())?a.unshift.apply(a,r.split("\n")):Array.isArray(r)?e.push.apply(e,r):t.isNullOrUndef(e)||a.unshift(""+r);return a},o=function(t,e,r){var a,o=[].concat(e),n=o.length,i=t.font,l=0;for(t.font=r.string,a=0;a<n;++a)l=Math.max(t.measureText(o[a]).width,l);return t.font=i,{height:n*r.lineHeight,width:l}},n=function(t,e,r){return Math.max(t,Math.min(e,r))},i=function(t,e){var r,a,o,n,i=t.slice(),l=[];for(r=0,o=e.length;r<o;++r)n=e[r],-1===(a=i.indexOf(n))?l.push([n,1]):i.splice(a,1);for(r=0,o=i.length;r<o;++r)l.push([i[r],-1]);return l};function l(t,e){var r=e.x,a=e.y;if(null===r)return{x:0,y:-1};if(null===a)return{x:1,y:0};var o=t.x-r,n=t.y-a,i=Math.sqrt(o*o+n*n);return{x:i?o/i:0,y:i?n/i:-1}}function s(t,e,r){var a=0;return t<r.left?a|=1:t>r.right&&(a|=2),e<r.top?a|=8:e>r.bottom&&(a|=4),a}function u(t,e){var r,a,o=e.anchor,n=t;return e.clamp&&(n=function(t,e){for(var r,a,o,n=t.x0,i=t.y0,l=t.x1,u=t.y1,d=s(n,i,e),c=s(l,u,e);d|c&&!(d&c);)8&(r=d||c)?(a=n+(l-n)*(e.top-i)/(u-i),o=e.top):4&r?(a=n+(l-n)*(e.bottom-i)/(u-i),o=e.bottom):2&r?(o=i+(u-i)*(e.right-n)/(l-n),a=e.right):1&r&&(o=i+(u-i)*(e.left-n)/(l-n),a=e.left),r===d?d=s(n=a,i=o,e):c=s(l=a,u=o,e);return{x0:n,x1:l,y0:i,y1:u}}(n,e.area)),"start"===o?(r=n.x0,a=n.y0):"end"===o?(r=n.x1,a=n.y1):(r=(n.x0+n.x1)/2,a=(n.y0+n.y1)/2),function(t,e,r,a,o){switch(o){case"center":r=a=0;break;case"bottom":r=0,a=1;break;case"right":r=1,a=0;break;case"left":r=-1,a=0;break;case"top":r=0,a=-1;break;case"start":r=-r,a=-a;break;case"end":break;default:o*=Math.PI/180,r=Math.cos(o),a=Math.sin(o)}return{x:t,y:e,vx:r,vy:a}}(r,a,t.vx,t.vy,e.align)}var d=function(t,e){var r=(t.startAngle+t.endAngle)/2,a=Math.cos(r),o=Math.sin(r),n=t.innerRadius,i=t.outerRadius;return u({x0:t.x+a*n,y0:t.y+o*n,x1:t.x+a*i,y1:t.y+o*i,vx:a,vy:o},e)},c=function(t,e){var r=l(t,e.origin),a=r.x*t.options.radius,o=r.y*t.options.radius;return u({x0:t.x-a,y0:t.y-o,x1:t.x+a,y1:t.y+o,vx:r.x,vy:r.y},e)},h=function(t,e){var r=l(t,e.origin),a=t.x,o=t.y,n=0,i=0;return t.horizontal?(a=Math.min(t.x,t.base),n=Math.abs(t.base-t.x)):(o=Math.min(t.y,t.base),i=Math.abs(t.base-t.y)),u({x0:a,y0:o+i,x1:a+n,y1:o,vx:r.x,vy:r.y},e)},f=function(t,e){var r=l(t,e.origin);return u({x0:t.x,y0:t.y,x1:t.x,y1:t.y,vx:r.x,vy:r.y},e)},x=function(t){return Math.round(t*r)/r};function y(t,e){var r=e.chart.getDatasetMeta(e.datasetIndex).vScale;if(!r)return null;if(void 0!==r.xCenter&&void 0!==r.yCenter)return{x:r.xCenter,y:r.yCenter};var a=r.getBasePixel();return t.horizontal?{x:a,y:null}:{x:null,y:a}}function v(t,e,r){var a=r.backgroundColor,o=r.borderColor,n=r.borderWidth;(a||o&&n)&&(t.beginPath(),function(t,e,r,a,o,n){var i=Math.PI/2;if(n){var l=Math.min(n,o/2,a/2),s=e+l,u=r+l,d=e+a-l,c=r+o-l;t.moveTo(e,u),s<d&&u<c?(t.arc(s,u,l,-Math.PI,-i),t.arc(d,u,l,-i,0),t.arc(d,c,l,0,i),t.arc(s,c,l,i,Math.PI)):s<d?(t.moveTo(s,r),t.arc(d,u,l,-i,i),t.arc(s,u,l,i,Math.PI+i)):u<c?(t.arc(s,u,l,-Math.PI,0),t.arc(s,c,l,0,Math.PI)):t.arc(s,u,l,-Math.PI,Math.PI),t.closePath(),t.moveTo(e,r)}else t.rect(e,r,a,o)}(t,x(e.x)+n/2,x(e.y)+n/2,x(e.w)-n,x(e.h)-n,r.borderRadius),t.closePath(),a&&(t.fillStyle=a,t.fill()),o&&n&&(t.strokeStyle=o,t.lineWidth=n,t.lineJoin="miter",t.stroke()))}function b(t,e,r){var a=t.shadowBlur,o=r.stroked,n=x(r.x),i=x(r.y),l=x(r.w);o&&t.strokeText(e,n,i,l),r.filled&&(a&&o&&(t.shadowBlur=0),t.fillText(e,n,i,l),a&&o&&(t.shadowBlur=a))}var _=function(t,e,r,a){var o=this;o._config=t,o._index=a,o._model=null,o._rects=null,o._ctx=e,o._el=r};t.merge(_.prototype,{_modelize:function(r,a,n,i){var l,s=this,u=s._index,x=t.toFont(t.resolve([n.font,{}],i,u)),v=t.resolve([n.color,e.defaults.color],i,u);return{align:t.resolve([n.align,"center"],i,u),anchor:t.resolve([n.anchor,"center"],i,u),area:i.chart.chartArea,backgroundColor:t.resolve([n.backgroundColor,null],i,u),borderColor:t.resolve([n.borderColor,null],i,u),borderRadius:t.resolve([n.borderRadius,0],i,u),borderWidth:t.resolve([n.borderWidth,0],i,u),clamp:t.resolve([n.clamp,!1],i,u),clip:t.resolve([n.clip,!1],i,u),color:v,display:r,font:x,lines:a,offset:t.resolve([n.offset,0],i,u),opacity:t.resolve([n.opacity,1],i,u),origin:y(s._el,i),padding:t.toPadding(t.resolve([n.padding,0],i,u)),positioner:(l=s._el,l instanceof e.ArcElement?d:l instanceof e.PointElement?c:l instanceof e.BarElement?h:f),rotation:t.resolve([n.rotation,0],i,u)*(Math.PI/180),size:o(s._ctx,a,x),textAlign:t.resolve([n.textAlign,"start"],i,u),textShadowBlur:t.resolve([n.textShadowBlur,0],i,u),textShadowColor:t.resolve([n.textShadowColor,v],i,u),textStrokeColor:t.resolve([n.textStrokeColor,v],i,u),textStrokeWidth:t.resolve([n.textStrokeWidth,0],i,u)}},update:function(e){var r,o,n,i=this,l=null,s=null,u=i._index,d=i._config,c=t.resolve([d.display,!0],e,u);c&&(r=e.dataset.data[u],o=t.valueOrDefault(t.callback(d.formatter,[r,e]),r),(n=t.isNullOrUndef(o)?[]:a(o)).length&&(s=function(t){var e=t.borderWidth||0,r=t.padding,a=t.size.height,o=t.size.width,n=-o/2,i=-a/2;return{frame:{x:n-r.left-e,y:i-r.top-e,w:o+r.width+2*e,h:a+r.height+2*e},text:{x:n,y:i,w:o,h:a}}}(l=i._modelize(c,n,d,e)))),i._model=l,i._rects=s},geometry:function(){return this._rects?this._rects.frame:{}},rotation:function(){return this._model?this._model.rotation:0},visible:function(){return this._model&&this._model.opacity},model:function(){return this._model},draw:function(t,e){var r,a=t.ctx,o=this._model,i=this._rects;this.visible()&&(a.save(),o.clip&&(r=o.area,a.beginPath(),a.rect(r.left,r.top,r.right-r.left,r.bottom-r.top),a.clip()),a.globalAlpha=n(0,o.opacity,1),a.translate(x(e.x),x(e.y)),a.rotate(o.rotation),v(a,i.frame,o),function(t,e,r,a){var o,n=a.textAlign,i=a.color,l=!!i,s=a.font,u=e.length,d=a.textStrokeColor,c=a.textStrokeWidth,h=d&&c;if(u&&(l||h))for(r=function(t,e,r){var a=r.lineHeight,o=t.w,n=t.x;return"center"===e?n+=o/2:"end"!==e&&"right"!==e||(n+=o),{h:a,w:o,x:n,y:t.y+a/2}}(r,n,s),t.font=s.string,t.textAlign=n,t.textBaseline="middle",t.shadowBlur=a.textShadowBlur,t.shadowColor=a.textShadowColor,l&&(t.fillStyle=i),h&&(t.lineJoin="round",t.lineWidth=c,t.strokeStyle=d),o=0,u=e.length;o<u;++o)b(t,e[o],{stroked:h,filled:l,w:r.w,x:r.x,y:r.y+r.h*o})}(a,o.lines,i.text,o),a.restore())}});var p=Number.MIN_SAFE_INTEGER||-9007199254740991,g=Number.MAX_SAFE_INTEGER||9007199254740991;function m(t,e,r){var a=Math.cos(r),o=Math.sin(r),n=e.x,i=e.y;return{x:n+a*(t.x-n)-o*(t.y-i),y:i+o*(t.x-n)+a*(t.y-i)}}function w(t,e){var r,a,o,n,i,l=g,s=p,u=e.origin;for(r=0;r<t.length;++r)o=(a=t[r]).x-u.x,n=a.y-u.y,i=e.vx*o+e.vy*n,l=Math.min(l,i),s=Math.max(s,i);return{min:l,max:s}}function M(t,e){var r=e.x-t.x,a=e.y-t.y,o=Math.sqrt(r*r+a*a);return{vx:(e.x-t.x)/o,vy:(e.y-t.y)/o,origin:t,ln:o}}var k=function(){this._rotation=0,this._rect={x:0,y:0,w:0,h:0}};function $(t,e,r){var a=e.positioner(t,e),o=a.vx,n=a.vy;if(!o&&!n)return{x:a.x,y:a.y};var i=r.w,l=r.h,s=e.rotation,u=Math.abs(i/2*Math.cos(s))+Math.abs(l/2*Math.sin(s)),d=Math.abs(i/2*Math.sin(s))+Math.abs(l/2*Math.cos(s)),c=1/Math.max(Math.abs(o),Math.abs(n));return u*=o*c,d*=n*c,u+=e.offset*o,d+=e.offset*n,{x:a.x+u,y:a.y+d}}t.merge(k.prototype,{center:function(){var t=this._rect;return{x:t.x+t.w/2,y:t.y+t.h/2}},update:function(t,e,r){this._rotation=r,this._rect={x:e.x+t.x,y:e.y+t.y,w:e.w,h:e.h}},contains:function(t){var e=this,r=e._rect;return!((t=m(t,e.center(),-e._rotation)).x<r.x-1||t.y<r.y-1||t.x>r.x+r.w+2||t.y>r.y+r.h+2)},intersects:function(t){var e,r,a,o=this._points(),n=t._points(),i=[M(o[0],o[1]),M(o[0],o[3])];for(this._rotation!==t._rotation&&i.push(M(n[0],n[1]),M(n[0],n[3])),e=0;e<i.length;++e)if(r=w(o,i[e]),a=w(n,i[e]),r.max<a.min||a.max<r.min)return!1;return!0},_points:function(){var t=this,e=t._rect,r=t._rotation,a=t.center();return[m({x:e.x,y:e.y},a,r),m({x:e.x+e.w,y:e.y},a,r),m({x:e.x+e.w,y:e.y+e.h},a,r),m({x:e.x,y:e.y+e.h},a,r)]}});var C={prepare:function(t){var e,r,a,o,n,i=[];for(e=0,a=t.length;e<a;++e)for(r=0,o=t[e].length;r<o;++r)n=t[e][r],i.push(n),n.$layout={_box:new k,_hidable:!1,_visible:!0,_set:e,_idx:r};return i.sort((function(t,e){var r=t.$layout,a=e.$layout;return r._idx===a._idx?a._set-r._set:a._idx-r._idx})),this.update(i),i},update:function(t){var e,r,a,o,n,i=!1;for(e=0,r=t.length;e<r;++e)o=(a=t[e]).model(),(n=a.$layout)._hidable=o&&"auto"===o.display,n._visible=a.visible(),i|=n._hidable;i&&function(t){var e,r,a,o,n,i,l;for(e=0,r=t.length;e<r;++e)(o=(a=t[e]).$layout)._visible&&(l=new Proxy(a._el,{get:(t,e)=>t.getProps([e],!0)[e]}),n=a.geometry(),i=$(l,a.model(),n),o._box.update(i,n,a.rotation()));(function(t,e){var r,a,o,n;for(r=t.length-1;r>=0;--r)for(o=t[r].$layout,a=r-1;a>=0&&o._visible;--a)(n=t[a].$layout)._visible&&o._box.intersects(n._box)&&e(o,n)})(t,(function(t,e){var r=t._hidable,a=e._hidable;r&&a||a?e._visible=!1:r&&(t._visible=!1)}))}(t)},lookup:function(t,e){var r,a;for(r=t.length-1;r>=0;--r)if((a=t[r].$layout)&&a._visible&&a._box.contains(e))return t[r];return null},draw:function(t,e){var r,a,o,n,i,l;for(r=0,a=e.length;r<a;++r)(n=(o=e[r]).$layout)._visible&&(i=o.geometry(),l=$(o._el,o.model(),i),n._box.update(l,i,o.rotation()),o.draw(t,l))}},P="$default";function S(e,r,a){if(r){var o,n=a.$context,i=a.$groups;r[i._set]&&(o=r[i._set][i._key])&&!0===t.callback(o,[n])&&(e.$datalabels._dirty=!0,a.update(n))}}function I(t,e){var r,a,o=t.$datalabels,n=o._listeners;if(n.enter||n.leave){if("mousemove"===e.type)a=C.lookup(o._labels,e);else if("mouseout"!==e.type)return;r=o._hovered,o._hovered=a,function(t,e,r,a){var o,n;(r||a)&&(r?a?r!==a&&(n=o=!0):n=!0:o=!0,n&&S(t,e.leave,r),o&&S(t,e.enter,a))}(t,n,r,a)}}return{id:"datalabels",defaults:{align:"center",anchor:"center",backgroundColor:null,borderColor:null,borderRadius:0,borderWidth:0,clamp:!1,clip:!1,color:void 0,display:!0,font:{family:void 0,lineHeight:1.2,size:void 0,style:void 0,weight:null},formatter:function(e){if(t.isNullOrUndef(e))return null;var r,a,o,n=e;if(t.isObject(e))if(t.isNullOrUndef(e.label))if(t.isNullOrUndef(e.r))for(n="",o=0,a=(r=Object.keys(e)).length;o<a;++o)n+=(0!==o?", ":"")+r[o]+": "+e[r[o]];else n=e.r;else n=e.label;return""+n},labels:void 0,listeners:{},offset:4,opacity:1,padding:{top:4,right:4,bottom:4,left:4},rotation:0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,textShadowBlur:0,textShadowColor:void 0},beforeInit:function(t){t.$datalabels={_actives:[]}},beforeUpdate:function(t){var e=t.$datalabels;e._listened=!1,e._listeners={},e._datasets=[],e._labels=[]},afterDatasetUpdate:function(e,r,a){var o,n,i,l,s,u,d,c,h=r.index,f=e.$datalabels,x=f._datasets[h]=[],y=e.isDatasetVisible(h),v=e.data.datasets[h],b=function(e,r){var a,o,n,i=e.datalabels,l=[];return!1===i?null:(!0===i&&(i={}),r=t.merge({},[r,i]),o=r.labels||{},n=Object.keys(o),delete r.labels,n.length?n.forEach((function(e){o[e]&&l.push(t.merge({},[r,o[e],{_key:e}]))})):l.push(r),a=l.reduce((function(e,r){return t.each(r.listeners||{},(function(t,a){e[a]=e[a]||{},e[a][r._key||P]=t})),delete r.listeners,e}),{}),{labels:l,listeners:a})}(v,a),p=r.meta.data||[],g=e.ctx;for(g.save(),o=0,i=p.length;o<i;++o)if((d=p[o]).$datalabels=[],y&&d&&e.getDataVisibility(o)&&!d.skip)for(n=0,l=b.labels.length;n<l;++n)u=(s=b.labels[n])._key,(c=new _(s,g,d,o)).$groups={_set:h,_key:u||P},c.$context={active:!1,chart:e,dataIndex:o,dataset:v,datasetIndex:h},c.update(c.$context),d.$datalabels.push(c),x.push(c);g.restore(),t.merge(f._listeners,b.listeners,{merger:function(t,e,a){e[t]=e[t]||{},e[t][r.index]=a[t],f._listened=!0}})},afterUpdate:function(t,e){t.$datalabels._labels=C.prepare(t.$datalabels._datasets,e)},afterDatasetsDraw:function(t){C.draw(t,t.$datalabels._labels)},beforeEvent:function(t,e){if(t.$datalabels._listened){var r=e.event;switch(r.type){case"mousemove":case"mouseout":I(t,r);break;case"click":!function(t,e){var r=t.$datalabels,a=r._listeners.click,o=a&&C.lookup(r._labels,e);o&&S(t,a,o)}(t,r)}}},afterEvent:function(t){var e,r,a,o,n,l,s,u=t.$datalabels,d=u._actives,c=u._actives=t.getActiveElements(),h=i(d,c);for(e=0,r=h.length;e<r;++e)if((n=h[e])[1])for(a=0,o=(s=n[0].element.$datalabels||[]).length;a<o;++a)(l=s[a]).$context.active=1===n[1],l.update(l.$context);(u._dirty||h.length)&&(C.update(u._labels),t.render()),delete u._dirty}}}));

Chart.register(ChartDataLabels);// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          D A T E S                                             //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Date_Now()
{
 var forcetime = Client_Location_Parameter("forcetime");
 if(forcetime) return forcetime;
 
 var now = new Date();

 return Date_From_JS(now); 
}




function Date_To_JS(date)
{
 var year    = date.substr(0,  4);
 var month   = date.substr(4,  2) - 1;
 var day     = date.substr(6,  2);
 var hour    = date.substr(8,  2);
 var minutes = date.substr(10, 2);
 var seconds = date.substr(12, 2);
 
 return new Date(year, month, day, hour, minutes, seconds);
}



function Date_From_Input(date, separator = "-")
{
 if(!date) var date = "";
 
 var date = date.split(separator);
 date     = date.join("");
 
 return date;
}



function Date_To_Input(date, separator = "-")
{
 if(!date) var date = "";
	 
 var year    = String(date.substr(0,  4)).padStart(4, "0");
 var month   = String(date.substr(4,  2)).padStart(2, "0");
 var day     = String(date.substr(6,  2)).padStart(2, "0");
 
 var date    =  [year, month, day].join(separator);
 
 return date;
}




function Date_From_JS(date)
{
 var year    = date.getFullYear(); 
 var month   = date.getMonth() + 1;
 var day     = date.getDate(); 
 var hour    = date.getHours();
 var minutes = date.getMinutes();
 var seconds = date.getSeconds();
 
 return String(year) + String(month).padStart(2, "0") + String(day).padStart(2, "0") + String(hour).padStart(2, "0") + String(minutes).padStart(2, "0") + String(seconds).padStart(2, "0");
}




function Date_Complete(date)
{ 
 // MISSING TIME?
 if(date.length >= 8 && date.length < 14) return date.padEnd(14, 0);
}




function Date_Portion(date, mode, complete)
{
 switch(mode)
 {  
  case "no-seconds":
	var portion = date.substr(0, 12);  
  break;
  
  case "date-only":
	var portion = date.substr(0, 8);
  break;
  
  case "time-only":
	var portion = date.substr(8, 4);  
  break;
  
  case "time-timecode":
	var portion = date.substr(8, 2) + ":" + date.substr(10, 2);
  break;
  
  case "time-seconds":
	var portion = date.substr(8);  
  break;
 }
 
 if(complete) portion = Date_Complete(portion);
 
 return portion;
}





function Date_Get(date, components, separator = "/")
{
 if(typeof components == "string") var components = [components];
 
 var parts = [];
 for(var component of components)
 {
  switch(component)
  {
   case "year":
 	var part = date.substr(0, 4);
   break;
  
   case "month":
	var part = date.substr(4, 2);
   break;
   
   case "day":
	var part = date.substr(6, 2);
   break;
   
   case "hour":
	var part = date.substr(8, 2);
   break;
   
   case "minutes":
	var part = date.substr(10, 2);
   break;
  }
  
  parts.push(part);
 }

 return parts.join(separator); 
}



function Date_Weekday_Name(day, format = "long", locale = "en-US")
{ 
 day = parseInt(day);
 day = day.toString().padStart(2, "0");
 
 return Date_Format("000601" + day, locale, {weekday:format});
}




function Date_Weekday_Get(date)
{
 var jsdate  = Date_To_JS(date);
 var weekday = jsdate.getDay();
 
 if(weekday == 0) weekday = 7;
 
 return weekday;
}




function Date_Format(date, locale = "en-US", format = "full", options = {})
{
 if(typeof format == "object") 
 {
  var config = format;
 }
 else
 {
  
  switch(format)
  {
   case "full":
	 var config = 
	 { 
	  dateStyle: "full", 
	  timeStyle: "short", 
	  hourCycle: "h24"
	 }
   break;
  
   case "date-long-weekday":
     var config =
	 {
	  weekday: "long", 
	  day:     "numeric", 
	  month:   "long", 
	  year:    "numeric"
	 }  
   break;
   
   case "date-long-weekday-noyear":
     var config =
	 {
	  weekday: "long", 
	  day:     "numeric", 
	  month:   "long", 
	 }  
   break;
   
   case "date-shortmonth-weekday-noyear":
     var config =
	 {
	  weekday: "long", 
	  day:     "numeric", 
	  month:   "short"
	 }  
   break;
   
   case "date-short-weekday":
     var config =
	 {
	  weekday: "short", 
	  day:     "numeric", 
	  month:   "short", 
	  year:    "numeric"
	 }  
   break;
   
   case "date-short-weekday-noyear":
     var config =
	 {
	  weekday: "short", 
	  day:     "numeric", 
	  month:   "short", 
	 }  
   break;
   
   case "date-short-noyear":
     var config =
	 {
	  day:     "numeric", 
	  month:   "short", 
	 }  
   break;
  
   case "day-weekday":
	var config =
	 {
	  day:     "numeric",
      weekday: "long" 	  
	 }  
   break;
   
   case "date-time-compact":
     var config =
	 {
	  weekday:   "long", 
	  day:       "numeric", 
	  month:     "short",
	  hour:      "2-digit", 
	  minute:    "2-digit", 
	  hourCycle: "h24"	  
	 }  
   break;
   
   case "date-compact":
     var config =
	 {
	  weekday:   "long", 
	  day:       "2-digit", 
	  month:     "short"
	 }  
   break;
   
   case "monthdayyear-compact":
     var config =
	 {
	  day:       "2-digit", 
	  month:     "short",
	  year:      "numeric"
	 }  
   break;
  
   case "time-only":
	 var config = 
	 {
	  hour:      "2-digit", 
	  minute:    "2-digit", 
	  hourCycle: "h24"
	 }
   break;
  }
  
 }
 
 
 Object.assign(config, options);
 
 
 var jsdate    = Date_To_JS(date);
 var formatted = new Intl.DateTimeFormat(locale, config).format(jsdate);
 
 return formatted;
}





function Date_Format_Period(date_from, date_to, options = {})
{
 var config = {};
 
 // SPECIFIC LOCALE?
 var locale = options["locale"];
 
 // USE "TOMORROW", "YESTERDAY", "LAST WEEK" ETC.?
 if(options["conversational"]) config["numeric"] = "auto"; else config["numeric"] = "always";
 
 const formatter = new Intl.RelativeTimeFormat(locale, config);
 const DIVISIONS = 
 [
  { amount: 60, name: 'seconds' },
  { amount: 60, name: 'minutes' },
  { amount: 24, name: 'hours' },
  { amount: 7, name: 'days' },
  { amount: 4.34524, name: 'weeks' },
  { amount: 12, name: 'months' },
  { amount: Number.POSITIVE_INFINITY, name: 'years' }
 ]

 if(!date_from) var date_from = Date_Now(); 
 
 var duration = (Date_To_JS(date_to) - Date_To_JS(date_from)) / 1000;
 for (let i = 0; i <= DIVISIONS.length; i++) 
 {
  const division = DIVISIONS[i]
   
  if (Math.abs(duration) < division.amount) 
  {
   return formatter.format(Math.round(duration), division.name);
  }
   
  duration /= division.amount
 }
}





function Date_Distance(date_from, date_to, unit = "seconds")
{
 date_from   = Date_To_JS(date_from);
 date_to     = Date_To_JS(date_to);
 var seconds = (date_to - date_from) / 1000;
 
 switch(unit)
 {
  case "seconds":
	var distance = seconds;
  break;
  
  case "minutes":
	var distance = Math.floor(seconds / 60);
  break;
  
  case "hours":
	var distance = Math.floor(seconds / 3600);
  break;
  
  case "days":
	var distance = Math.floor(seconds / 86400);
  break;
  
  case "months":
	var distance = date_to.getMonth() - date_from.getMonth() + 12 * (date_to.getFullYear() - date_from.getFullYear());
  break;
  
  case "years":
	var distance = date_to.getFullYear() - date_from.getFullYear();
  break;
 }
 
 return distance;
}




function Date_Timezone()
{
 return Intl.DateTimeFormat().resolvedOptions().timeZone;
}



function Date_Month_Name(month, format = "long", locale = "en-US")
{  
 month = parseInt(month);
 month = month + 1;
 month = month.toString().padStart(2, "0");
 
 return Date_Format("0000" + month, locale, {month:format});
}



function Date_Month_FirstDay(date)
{
 if(!date) var date = Date_Now(); 
 
 var jsdate = Date_To_JS(date);
 var first  = new Date(jsdate.getFullYear(), jsdate.getMonth(), 1); 
 first      = Date_From_JS(first);
 
 return first;
}



function Date_Month_LastDay(date)
{
 if(!date) var date = Date_Now(); 
 
 var jsdate = Date_To_JS(date);
 var last   = new Date(jsdate.getFullYear(), jsdate.getMonth() + 1, 0); 
 last       = Date_From_JS(last);
 
 return last;
}




function Date_Month_ListDays(month, year) 
{
 var month = month - 1; // FIX, JS DATE MONTHS START WITH 0 (!!)
 var date  = new Date(year, month, 1);
 var days  = [];
 
 while (date.getMonth() === month) 
 {
  var day = Date_From_JS(new Date(date));
  
  days.push(day);
  date.setDate(date.getDate() + 1);
 }

 return days;
}




function Date_Week_FirstDay(date)
{
 if(!date) var date = Date_Now();
 var jsdate = Date_To_JS(date);
 
 while (jsdate.getDay() != 1) 
 {
  jsdate.setDate(jsdate.getDate() - 1);
 }

 return Date_From_JS(jsdate);
}




function Date_Week_LastDay(date)
{
 var date = Date_Week_FirstDay(date);
 date     = Date_Add_Days(date, 6);
 
 return date;
}




function Date_Add_Months(date, months)
{
 var jsdate = Date_To_JS(date);
 var month  = jsdate.getMonth();
 
 jsdate.setMonth(month + months);
 
 // FIX: IF MONTHS DO NOT HAVE SAME NUMBER OF DAYS THERE MIGHT BE A PROBLEM, AND MONTH WON'T CHANGE
 while(jsdate.getMonth() == month)
 {
  if(months < 0)
  {
   jsdate.setDate(jsdate.getDate() - 1);
  }
  else
  {
   jsdate.setDate(jsdate.getDate() + 1);
  }
 }
 
 return Date_From_JS(jsdate);
}





function Date_Add_Days(date, days)
{
 var jsdate = Date_To_JS(date);
 
 jsdate.setDate(jsdate.getDate() + days);
 
 return Date_From_JS(jsdate);
}





function Date_Add_Minutes(date, minutes)
{
 var jsdate = Date_To_JS(date);
 
 jsdate.setMinutes(jsdate.getMinutes() + minutes);
 
 return Date_From_JS(jsdate);
}





function Date_Add_Hours(date, hours)
{
 var jsdate = Date_To_JS(date);
 
 jsdate.setHours(jsdate.getHours() + hours);
 
 return Date_From_JS(jsdate);
}



function Date_Period_Detail(token, defaultedge = "start")
{
 var detail = {};
 
 var parts = token.split(" of ");
 
 if(parts.length < 2)
 {
  detail["time"] = token;
  detail["edge"] = defaultedge;
 }
 else
 {  
  detail["time"] = parts[1].trim().toLowerCase();
  detail["edge"] = parts[0].trim().toLowerCase();
 }
 
 return detail;
}



function Date_Range(period)
{ 
 var parts = period.split(" to ");
 for(var i in parts) parts[i] = parts[i].toLowerCase().trim();
 
 if(parts.length == 1) parts[1] = parts[0];

 var range     = {};
 
 var detail = Date_Period_Detail(parts[0], "start"); 
 range["from"] = Date_Period_Time(detail["time"], detail["edge"]);
 
 var detail = Date_Period_Detail(parts[1], "end"); 
 range["to"] = Date_Period_Time(detail["time"], detail["edge"]);
 
 return range;
}



function Date_Period_Time(period, edge)
{
 switch(period)
 {
  // PRESENT
  case "today":
	var today = Date_Now();
	
	if(edge == "start")
	{
	 var day   = Date_Portion(today, "date-only") + "0000";
	}
	else
	{
	 var day   = Date_Portion(today, "date-only") + "2359";
	}	
  break;
 
  case "this week":
	if(edge == "start")
	{
     var day = Date_Portion(Date_Week_FirstDay(Date_Now()), "date-only") + "0000"; 
	}
	else
	{
	 var day = Date_Portion(Date_Week_LastDay(Date_Now()), "date-only") + "2359";
	}
  break;
 
  case "this month":
    var thismonth = Date_Month_FirstDay(Date_Now()); 
	
	if(edge == "start")
	{
	 var day = Date_Portion(Date_Month_FirstDay(Date_Now()), "date-only") + "0000"; 
	}
	else
    {
     var day = Date_Portion(Date_Month_LastDay(Date_Now()), "date-only") + "2359"; 
	}
  break;
  
  // FUTURE
  case "future":
	day = "290001010000";
  break;
  
  case "tomorrow":
	var tomorrow = Date_Add_Days(Date_Now(), 1);
	
	if(edge == "start")
	{
	 var day = Date_Portion(tomorrow, "date-only") + "0000";
	}
	else
	{
	 var day = Date_Portion(tomorrow, "date-only") + "2359";
	}	
  break;
  
  case "next week":
	var nextweek = Date_Add_Days(Date_Week_FirstDay(Date_Now()), 7);
	
	if(edge == "start")
	{
     var day = Date_Portion(Date_Week_FirstDay(nextweek), "date-only") + "0000"; 
	}
	else
	{
	 var day = Date_Portion(Date_Week_LastDay(nextweek), "date-only") + "2359";
	}
  break;
  
  case "next month":
	var nextmonth = Date_Add_Days(Date_Month_LastDay(Date_Now()), 1);
	
	if(edge == "start")
	{
	 var day = Date_Portion(Date_Month_FirstDay(nextmonth), "date-only") + "0000"; 
	}
	else
    {
     var day = Date_Portion(Date_Month_LastDay(nextmonth), "date-only") + "2359"; 
	}
  break;
  
  // PAST
  case "past":
	day = "197001010000";
  break;
  
  case "yesterday":
	var yesterday = Date_Add_Days(Date_Now(), -1);
	
	if(edge == "start")
	{
	 var day = Date_Portion(yesterday, "date-only") + "0000";
	}
	else
	{
	 var day = Date_Portion(yesterday, "date-only") + "2359";
	}	
  break;
  
  case "last week":
	var lastweek = Date_Add_Days(Date_Week_FirstDay(Date_Now()), -7);
	
	if(edge == "start")
	{
     var day = Date_Portion(Date_Week_FirstDay(lastweek), "date-only") + "0000"; 
	}
	else
	{
	 var day = Date_Portion(Date_Week_LastDay(lastweek), "date-only") + "2359";
	}
  break;
  
  case "last month":
    var lastmonth = Date_Month_FirstDay(Date_Add_Days(Date_Month_FirstDay(Date_Now()), -1));

	if(edge == "start")
	{
	 var day = Date_Portion(Date_Month_FirstDay(lastmonth), "date-only") + "0000"; 
	}
	else
    {
     var day = Date_Portion(Date_Month_LastDay(lastmonth), "date-only") + "2359"; 
	}
  break;
 }
 
 return day;
}



function Time_Now()
{
 return new Date().getTime(); 
}



function Time_From_Minutes(minutes, separator = ":")
{
 var hours   = Math.floor(minutes / 60);
 var minutes = minutes % 60;
 
 return hours.toString().padStart(2, "0") + separator + minutes.toString().padStart(2, "0");
}


function Time_To_Minutes(time)
{
 time        = String_Filter_AllowDigits(String(time));
 
 var hours   = parseInt(time.substr(0, 2));
 var minutes = parseInt(time.substr(2, 2));
 
 return (hours * 60) + minutes;
}




function Time_Seconds_ToTimecode(seconds, separator = ":")
{
 var hours   = Math.floor(seconds / 3600);
 seconds     = seconds - (hours * 3600);
 
 var minutes = Math.floor(seconds / 60);
 seconds     = seconds - (minutes * 60);
 
 return hours.toString().padStart(2, "0") + separator + minutes.toString().padStart(2, "0") + separator + seconds.toString().padStart(2, "0");
}



function Time_Timecode_ToSeconds(timecode, separator = ":")
{
 var parts   = timecode.split(separator);
 var seconds = 0;
 
 if(parts.length > 0)	
 {
  seconds = seconds + parts[0] * 60 * 60;
 }	 
 
 if(parts.length > 1)	
 {
  seconds = seconds + parts[1] * 60;
 }	

 if(parts.length > 2)	
 {
  seconds = seconds + parts[2];
 }	 
  
 return seconds;
}





function Time_Format_Period(minutes, locale = "en", separator = ", ")
{
 var hours   = Math.floor(minutes / 60);
 var minutes = minutes % 60;
 
 var time    = [];
 
 if(hours > 0)
 {
  var component = new Intl.NumberFormat(locale, {style:"unit", unit:"hour", unitDisplay:"long"}).format(hours);
  time.push(component);
 }
 
 if(minutes > 0)
 {
  var component = new Intl.NumberFormat(locale, {style:"unit", unit:"minute", unitDisplay:"long"}).format(minutes);
  time.push(component);
 }
 
 return time.join(separator);
}function Debug_Elements_Outline()
{
 var elements = Document_Element_Children(document.body, true);
 
 for(var element of elements) 
 { 
  element.style.outline = "1px solid rgba(1, 0, 1, 0.5)"; 
  element.style.outlineOffset = -1;
 }
}
// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                     D O C U M E N T                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//







// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                       E V E N T S                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

function Document_Event_Trigger(element, type)
{
 var event = new Event(type);
 element.dispatchEvent(event);
}



function Document_Event_RelativeCoords(event)
{
 var element = event.currentTarget;
 
 var rect    = element.getBoundingClientRect();
  
 //CHECK ZOOM PAGE
 var zoom = 1;
 if(!Number.isNaN(parseFloat(document.body.style.zoom))) zoom = parseFloat(document.body.style.zoom);

 var x       = (event.clientX/zoom - rect.left); 
 var y       = (event.clientY/zoom - rect.top);
 
 return {x,y};
}







// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                     E L E M E N T S                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Document_Element_Create(html)
{
 var element       = document.createElement(null); 
 element.innerHTML = html;
 element           = element.firstElementChild;
 
 return element;
}



function Document_Element_Disable(element, css)
{
 var style = {fields:[], css:false};
 
 for(var field of ["pointer-events", "user-select"])
 {
  style["fields"][field] = element.style[field];
  element.style[field]   = "none";  
 }
 
 if(css)
 {
  Document_CSS_SetClass(element, css);
  style["css"] = css;
 }
 
 Document_Element_SetObject(element, "beforedisable", style);
}




function Document_Element_Restore(element, enable)
{
 var style = Document_Element_GetObject(element, "beforedisable") || {};
 
 for(var field in style["fields"])
 {
  element.style[field] = style["fields"][field];
 }
 
 if(style["css"]) Document_CSS_UnsetClass(element, style["css"]);
 
 if(enable)
 {
  element.style.pointerEvents = "";
 }
}







function Document_Element_FindParent(root, fieldname, fieldvalue, options = [])
{
 var element = root;

 do
 {  
  if(element && element.dataset[fieldname] && (!fieldvalue || element.dataset[fieldname] == fieldvalue)) return element;
 
  element = element.parentElement;
 } 
 while(element);
 
 return undefined;
}




function Document_Element_Children(element, recurse)
{
 if(!element || typeof element != "object") return [];
 
 if(recurse) 
 {
  var collection = element.getElementsByTagName("*"); 
 }
 else 
 {
  var collection = element.children;
 }
 
 var elements = [];
 for(var e of collection)
 {
  elements.push(e);
 }
 
 return elements;
}





function Document_Element_FindChildren(element, fieldname, fieldvalue, options = [])
{
 // RECURSE CHIDREN?
 var recurse = options.includes("recurse")
	
 // SEARCH AN EXACT MATCH?
 var match    = (options.includes("match"));
	
	
 var children = Document_Element_Children(element, recurse);
 var list     = [];

 
 for(var child of children)
 {
  // FIELD MUST EXIST	 
  if(child.dataset[fieldname] !== undefined) 
  {	   
   // IF NO SPECIFIC VALUE REQUESTED OR REQUESTED AND MATCHED...
   if((fieldvalue === undefined) || (child.dataset[fieldname] == fieldvalue)) 
   {
	if(match) return child; else list.push(child);
   }
  }
 }
 
 if(match) return undefined; else return list;
}





function Document_Element_FindChild(element, fieldname, fieldvalue, options = [])
{
 // MUST FIND AN EXACT MATCH
 options.push("match");
 
 var child = Document_Element_FindChildren(element, fieldname, fieldvalue, options);
 
 return child;
}




function Document_Element_Index(element)
{
 if(!element.parentElement) return -1;
 
 var index = 0;
 for(var child of element.parentElement.children)
 {
  if(child == element) return index;
  
  index = index + 1;
 }
}




function Document_Element_ShuffleChildren(element, options = {preservenull:true})
{ 
 var elements = [];
 
 while(element.children.length > 0)
 {
  var child = element.children[0];
  
  elements.push(child); 
  child.remove();
 }
 
 elements.sort((a, b) => 0.5 - Math.random());
 

 element.append(...elements);
}





function Document_Element_ListColliding(element)
{
 var list = [];
 
 if(element.parentElement)
 {
  var element_rect = element.getBoundingClientRect();
  var siblings     = Document_Element_Children(element.parentElement);
  
  for(var sibling of siblings)
  {
   if(sibling != element)
   {
	var sibling_rect = sibling.getBoundingClientRect();
	
	var collides     = Geometry_Rect_Intersect(element_rect, sibling_rect);
	if(collides) list.push(sibling);
   }
  }
  
 }
 
 return list;
}





function Document_Element_SetData(element, id, value)
{
 element.dataset[id] = value;
}




function Document_Element_GetData(element, id)
{
 var value = element.dataset[id];
 
 return value;
}




function Document_Element_SetObject(element, id, obj, options = [])
{
 if(options.includes("propagate"))
 {
  var children = Document_Element_Children(element, true);
  
  for(var child of children) 
  {
   Safe_Set(child, ["data-objects", id], obj);
  }
 }
 
 return Safe_Set(element, ["data-objects", id], obj);
}




function Document_Element_GetObject(element, id)
{
 var obj = Safe_Get(element, ["data-objects", id], undefined);
 
 return obj;
}




function Document_Element_Show(element)
{
 if(!element || !element.style) return;
 
 if(element.style.visibility != "visible") element.style.visibility = "visible";
}





function Document_Element_Hide(element)
{
 if(!element || !element.style) return;
 
 if(element.style.visibility != "hidden") element.style.visibility = "hidden";
}





function Document_Element_Position(element)
{
 var position     = {};
 
 var rect         = element.getBoundingClientRect();
 
 position["left"] = rect.left;
 position["top"]  = rect.top;
 
 //position["left"] = element.offsetLeft;
 //position["top"]  = element.offsetTop;
 
 return position;
}




function Document_Element_Size(element)
{
 var size       = {};
 
 var rect       = element.getBoundingClientRect();
 
 size["width"]  = rect.width;
 size["height"] = rect.height;
 
 return size;
}




function Document_Element_Corner(element, corner)
{
 var rect  = element.getBoundingClientRect();
 var point = Geometry_Rect_Corner(rect, corner);

 return point; 
}




function Document_Element_Center(element)
{ 
 var center     = {};
 
 var rect       = element.getBoundingClientRect();
 center["left"] = rect.left + rect.width  / 2;
 center["top"]  = rect.top  + rect.height / 2;
 
 
 //center["left"] = element.offsetLeft + element.offsetWidth  / 2;
 //center["top"]  = element.offsetTop  + element.offsetHeight / 2;
 
 return center;
}






function Document_Element_ScaleStyle(element, field, scale)
{
 if(element.style[field].includes("%")) return;
 
 element.style[field] = (parseInt(element.style[field]) * scale) + "px";
}




function Document_Element_Scale(element, scale_x, scale_y)
{
 
 for(var field of ["left", "width", "font-size", "border-width", "border-radius", "padding"])
 {
  Document_Element_ScaleStyle(element, field, scale_x);
 }
 
 for(var field of ["top", "height"])
 {
  Document_Element_ScaleStyle(element, field, scale_y);
 }
 
}




function Document_Element_IsVisible(element)
{
 var rect = element.getBoundingClientRect();
 
 return  (rect.top >= 0) && (rect.left >= 0) && (rect.bottom <= (window.innerHeight || document.documentElement.clientHeight)) && (rect.right <= (window.innerWidth || document.documentElement.clientWidth))
}




function Document_Element_Overflows(element, direction = "both")
{
 switch(direction)
 {
  case "both":
	return element.scrollHeight > element.clientHeight || element.scrollWidth > element.clientWidth;
  break;
  
  case "vertical":
	return element.scrollHeight > element.clientHeight;
  break;
  
  case "horizontal":	
	element.scrollWidth > element.clientWidth;
  break;
 }
}



function Document_Element_ScrollSync(dest, source, mode = "both")
{
 Document_Element_SetData(dest,   "scrollsync", mode);
 Document_Element_SetObject(dest, "scrollsync", dest);
 
 dest.onscroll =
 function(event)
 {
  var element = event.currentTarget;
  
  var mode    = Document_Element_GetData(element, "scrollsync");
  var source  = Document_Element_GetObject(element, "scrollsync");
  
  switch(mode)
  {
   case "horizontal":
	 element.scrollLeft = source.scrollLeft; 
   break;
  
   case "vertical":
     element.scrollTop = source.scrollTop; 
   break;
  
   case "both":
	 element.scrollLeft = source.scrollLeft; 
     element.scrollTop  = source.scrollTop;
   break;
  }
 }
 
}




function Document_Element_FitText(element, options = {mode:"vertical"})
{
 var control = options["control"] || element;

 
 // STORE OVERFLOW OF CHECK-ELEMENT AND UNDO IT
 var old_overflow = control.style.overflow;
 control.style.overflow = "auto";

 switch(options["mode"])
 {
  case "vertical":
	var timeout = options["timeout"] || screen.height;
	var height  = Document_Element_Size(element).height;
	
	while(Document_Element_Overflows(control) && (timeout > 0)) 
    {
     element.style.height = height + "px";
     height = height + 1;
	 
	 timeout = timeout - 1;
    }
  break;
 }
 
 // RESTORE OVERFLOW OF CONTROL ELEMENT
 control.style.overflow = old_overflow;
}




function Document_Element_FitContent(element, delta = 0.05, options = {})
{  
 var check = options["check"] || element;


 // STORE OVERFLOW OF CHECK-ELEMENT AND UNDO IT
 var old_overflow = check.style.overflow;
 check.style.overflow = "auto";
 
 
 // PREPARE CHILDREN ELEMENTS
 for(var child of element.children)
 {
  // SET/RESET ZOOM
  if(child.style.zoom == "") child.style.zoom = 1;
  
  if(options["advanced"])
  {
   // STORE A SET OF PROPERTIES AND UNDO THEM
   // SUCH PROPERTIES CAN CAUSE AN ELEMENT TO ALWAYS MAKE ITS CONTAINER OVERFLOW  
   var style    = window.getComputedStyle(child);
   var previous = {};
   for(var key of ["outline", "border", "margin"]) 
   {
    previous[key]    = style[key];
    child.style[key] = "none";
   }
   Document_Element_SetObject(child, "prevstyle", previous);
  }
  
 }
 
 
 
 // TRY EXPANDING SIZE OF ELEMENTS
 if(options["expand"])
 {
  var timeout = 1;
 
  while(!Document_Element_Overflows(check) && (timeout > 0))
  {
   for(var child of element.children)
   {
    child.style.zoom = child.style.zoom + delta;
   }
   
   timeout = timeout - delta;
  }
 }
 
 
 // KEEP REDUCING SIZE OF ELEMENTS
 var timeout = 1;
 
 while(Document_Element_Overflows(check) && (timeout > 0))
 {
  for(var child of element.children)
  {
   child.style.zoom = child.style.zoom - delta;
  }
  
  timeout = timeout - delta;
 }
 
 
 
 // RESTORE OVERFLOW OF CHECK-ELEMENT
 check.style.overflow = old_overflow;
 
 
 if(options["advanced"])
 {
  // RESTORE CHILDREN ELEMENTS' PREVIOUS STYLE
  for(var child of element.children)
  {
   var previous = Document_Element_GetObject(child, "prevstyle");
   
   for(var key in previous) child.style[key] = previous[key];
  }
 }
}



/*
function Document_Element_FitStretch(element, delta = 1)
{
 var container = element.parentElement;
 element.style.transformOrigin = "top left";
 scalex = 0;
 scaley = 0;
 
 var temp = container.style.overflowX;
 container.style.overflowX = "auto";
 while(!Document_Element_Overflows(container, "horizontal"))
 {
  
 }

}
*/


/*
function Document_Element_Protect(element)
{	
 element.attributes["listener-protect"] =
 function(event)
 {
  event.preventDefault();
  event.stopImmediatePropagation(); 
  return false;
 };

 for(var eventname of ["contextmenu", "selectstart"]) element.addEventListener(eventname, element.attributes["listener-protect"]);  
}




function Document_Element_Unprotect(element)
{  
 for(var eventname of ["contextmenu", "selectstart"]) element.removeEventListener(eventname, element.attributes["listener-protect"]);
}
*/






async function Document_Element_Interpolate(element, position, time, onchange)
{
 var thread = Interpolation_Thread(element["style"], position, time, undefined, 
 {
  onchange:
  function(interpolator)
  {
   if(onchange) onchange(element, interpolator);
  }
 });
 
 return thread;
}






async function Document_Element_Zoom(element, factor, time)
{
 var width   = parseFloat(element.style.width)  * factor;
 var height  = parseFloat(element.style.height) * factor;  console.log(factor, width, height);

 var centerx = parseFloat(element.style.left) + (parseFloat(element.style.width)  / 2);
 var centery = parseFloat(element.style.top)  + (parseFloat(element.style.height) / 2);

 var thread = Document_Element_Interpolate(element, {width:width, height:height}, time,
 function(element, interpolator)
 { 
  element.style.left = centerx - parseFloat(element.style.width) / 2;
  element.style.top  = centery - parseFloat(element.style.height) / 2;
 });
 
 return thread;
}







function Document_Elements_Swap(element_a, element_b)
{
 const parent_a = element_a.parentNode;
 const sibling_a = element_a.nextSibling === element_b ? element_a : element_a.nextSibling;

 // Move `nodeA` to before the `nodeB`
 element_b.parentNode.insertBefore(element_a, element_b);

 // Move `nodeB` to before the sibling of `nodeA`
 parent_a.insertBefore(element_b, sibling_a);
};





function Document_Element_Toggle(element, what)
{
 if(!element || !element.style) return;
 
 switch(what)
 {
  case "visibility":
  
	if(element.style.visibility == "visible")  
	{
     element.style.visibility = "hidden"; 
	 return false;
	}
	else 
	{
     element.style.visibility = "visible";
	 return true;
	}
  break;
 }
}







// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                         I M A G E S                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Document_Image_Load(img, sources, options = {})
{
 var promise = new Promise((resolve, reject) =>
 {
  // IF THERE ARE SOURCES AVAILABLE...
  if(sources && sources.length > 0)
  { 
   // GET FIRST SOURCE AND REMOVE IT FROM THE LIST
   var source = sources[0];
   sources.splice(0, 1);
    
   // TRY 
   img.onerror =
   async function(event)
   {
    var element = event.currentTarget;
    await Document_Image_Load(element, sources, options);
   }
  
   // SPECIAL SOURCES OR JUST ASSIGN
   switch(source)
   {
    case "hide":
 	  img.style.visibility = "hidden";
	  
	  resolve("hide");
    break;
    
    default:
       if(options["nocache"]) source = source + "?c=" + Date.now();
       img.src = encodeURI(source);
	   
	   if(options["waitloaded"])
	   {
		img.onload =
		function()
		{
	     resolve(true);
		}
		img.onerror =
		function()
		{
		  resolve(true);
		}
	   }
	   else
	   {
	    resolve(true);
	   }
    break;
   }
   
  }
 });
 
 return promise;
}




async function Document_Image_Resize(data, options = {})
{	
 var promise = new Promise((resolve, reject) =>
 {
  var image = new Image();
 
  // PROCESS THAT WILL BE INITIATED ONCE IMAGE IS ASSIGNED DATA
  image.onload =
  function()
  {
   // CALCULATE SCALE
   var scale = options["scale"] || 1;

   if(options["constraints"])
   { 
    if(image.width  > options["constraints"]["width"])  var wscale = options["constraints"]["width"]  / image.width;  else wscale = 1;
    if(image.height > options["constraints"]["height"]) var hscale = options["constraints"]["height"] / image.height; else hscale = 1;
    
    if(wscale < hscale) scale = wscale; else scale = hscale;
   }
  
   // SCALE THROUGH CANVAS
   var canvas    = document.createElement("canvas");    
   canvas.width  = image.width  * scale;
   canvas.height = image.height * scale;
  
   var context                   = canvas.getContext("2d");
   context.imageSmoothingEnabled = true;
   context.imageSmoothingQuality = options["resample"] || "high";
     
   context.drawImage(image, 0, 0, canvas.width, canvas.height);
  
   // DETERMINE FORMAT
   var format  = options["format"] || "image/png";
   if(!format.includes("image/")) format  = "image/" + format;
   
   // DETERMINE QUALITY
   var quality = options["quality"] || 1;
   
   // ENCODE AND RETURN
   canvas.toBlob(
   function(blob)
   {
	// RETURN RESAMPLED IMAGE
	blob["type"] = format;
	
	resolve(blob);
   }, 
   
   format, quality);
  }
 
  // INITIATE PROCESS
  image.src = data;
 });
 
 return promise;
}




function Document_Image_HasTransparency(image)
{
 var canvas    = document.createElement("canvas");    
 canvas.width  = image.width;
 canvas.height = image.height;
  
 var context   = canvas.getContext("2d");
 context.drawImage(image, 0, 0);
  
 var pixels = context.getImageData(0, 0, image.width, image.height).data;
 var length = Math.floor(pixels.length / 4);
 for(var i = 0; i < length -1; i++)
 {
  alphaindex = (i * 4) + 3;
  if(pixels[alphaindex] != 255)
  {
   return true;
  }
 }
  
 return false; 
}




async function Document_Image_FromFile(file)
{
 var promise = new Promise(async(resolve, reject) =>
 {
  var data = await Storage_File_Read(file, {whole:true});
 
  var image = new Image();
 
  image.onload =
  async function()
  {
   resolve(image);
  }
 
  image.src = data;
 });
 
 return promise;
}







// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                     A N I M A T I O N                                          //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Document_Element_Animate(element, animation) 
{
 if(!element) return;
 
 var promise = new Promise((resolve, reject) =>
 {
  element.addEventListener('animationend', 
  function() 
  {
   if(element.style.animationFillMode != "forwards") element.style.animation = "";
   resolve();
  }, 
  {once:true, capture:false});
  
  // FIRE UP ANIMATION
  element.style.animation = animation;
 });
 
 return promise;
}




async function Document_Element_Transition(element, style, mode) 
{
 var promise = new Promise((resolve, reject) =>
 {
  element.addEventListener('transitionend', 
  function() 
  {
   element.style.transition = "";
   resolve();
  }, 
  {once:true, capture:false});
  
  // SET UP TRANSITION
  element.style.transition = "all " + mode;
  
  // FIRE UP THE TRANSITION BY ALTERING THE ELEMENT:
  // IF STYLE IS A STRING, THEN WE ALTER THE ELEMENT BY SWITCHING A CLASS ON/OFF
  if(typeof style == "string") 
  {
   Document_CSS_SwitchClass(element, style);
  }
  else 
  // OTHERWISE WE TREAT STYLE AS AN OBJECT CONTAINING UPDATES TO THE ELEMENT'S STYLE
  {
   Object.assign(element.style, style); 
  }
 });
 
 return promise;
}




async function Document_Element_AnimateChildren(element, animation, config = {interval:0, delay:0, onstart:false, onend:false}) 
{
 var promise = new Promise((resolve, reject) =>
 {
  var n        = 0;
  var delay    = config["delay"]    || 0;
  var interval = config["interval"] || 0;
 
  var done     = 0;
 
  for(let child of element.children)
  {
   if(config["appear"])    element.style.visibility = "hidden";
	   
   setTimeout(
   async function()
   {
    if(config["onstart"]) config["onstart"](child);
    
    await Document_Element_Animate(child, animation);
    
	if(config["appear"])    element.style.visibility = "visible";
	
    if(config["onend"]) await config["onend"](child);
	
	if(config["disappear"]) element.style.visibility = "hidden";
	
    done++;
    if(done == element.children.length -1)
    {
 	 resolve();
    }
   }, 
   delay + (interval * n));
  
   n++; 
  }
 });
 
 return promise;
}






// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                         I N P U T                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

function Document_Input_Set(element, value)
{
 switch(element.type)
 {
  case "text":
  case "textarea":
	element.value = value;
  break;
  
  case "select-one":
	element.value = value;
  break;
  
  
  case "select-multiple":
    for(var option of element.options) 
    {
     option.selected = value.includes(option.value);
    }
  break;
  
  
  case "date":
	element.value = Date_To_Input(value);
  break;
  
  
  default:
	element.value = value;
  break;
 }
}




function Document_Input_Get(element)
{
 switch(element.type)
 {
  case "text":
  case "textarea":
	var value = element.value;
  break;
  
  
  case "select-one":
	var value = element.value;
  break;
  
  
  case "select-multiple":
	var value = [];
 
    for(var option of element.options) 
    {
     if(option.selected) value.push(option.value);
    }
  break;
  
  
  case "date":
	var value = Date_From_Input(element.value);
  break;
  
  
  default:
	var value = element.value;
  break;
 }
 
 return value;
}





// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                       S E L E C T                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Document_Select_Clear(select)
{
 select.innerHTML = "";
}



function Document_Select_SelectedOption(select)
{
 var index = select.selectedIndex;
 if(index == -1) return undefined;
 
 var option = select.options[index];
 
 return option;
}



function Document_Select_SelectedValues(select, format = "array")
{
 var options = select.selectedOptions;
 
 switch(format)
 {
  case "array":
	var values  = [];
 
    for(var option of options) 
    {
     values.push(option.value);
    }
  break;
  
  case "object":
	var values = {};
	
	for(var option of options) 
    {
     values[option.value] = true;
    }
  break;
 }
 
 return values;
}



function Document_Select_AddOption(select, text, value, obj)
{
 var option   = new Option();
 option.text  = text;
 option.value = value;
 
 select.appendChild(option);
 
 if(obj)
 {
  Document_Element_SetObject(option, "object", obj);
 }
 
 return option;
}




function Document_Select_OptionsFromObjects(select, objects, textfield = false, valuefield = false)
{
 for(var i in objects)
 {
  var item = objects[i];
  
  var option   = new Option();
  
  if(!textfield)  option.text  = i;  else option.text  = item[textfield];
  if(!valuefield) option.value = i; else option.value = item[valuefield];
  
  select.appendChild(option);
 }
}


function Document_Select_OptionsFromValues(select, texts = [], values = [])
{
 for(var i in values)
 {
  var option   = new Option();
  
  option.text  = texts[i] || "";
  option.value = values[i];
  
  select.appendChild(option);
 }
}




function Document_Select_InsertOption(select, text, value, obj)
{
 if(!select.firstChild) 
 {
  Document_Select_AddOption(select, text, value, obj);
  return;
 }
 
 
 var option   = new Option();
 option.text  = text;
 option.value = value;
 
 select.insertBefore(option, select.firstChild);
 
 if(obj)
 {
  Document_Element_SetObject(option, "object", obj);
 }
 
 return option;
}





function Document_Select_OptionByObject(select, obj)
{
 for(var option of select.options)
 {
  if(Document_Element_GetObject(option, "object") == obj) return option;
 }
}




function Document_Select_OptionByValue(select, value)
{
 for(var option of select.options)
 {
  if(option.value == value) return option;
 }
}




function Document_Select_ClearSelection(select)
{
 for(var option of select.options) option.selected = false;
}





function Document_Select_SelectByValue(select, value)
{
 if(typeof value == "array")
 {
  for(var option of select.options) option.selected = (value.includes(option.value));
 }
 else
 {
  for(var option of select.options) option.selected = (option.value == value);
 }
}




function Document_Select_SetMulti(select)
{
 // FUNCTION TO SETUP OPTIONS TO PREVENT DEFAULT BEHAVIOR
 var setupoptions = 
 function()
 {
  for(var option of select.options)
  {
   option.onmousedown =  
   function(event)
   {
    event.preventDefault();
	var position = select.scrollTop;
	
	event.target.selected = !event.target.selected;
	setTimeout(function(){select.scrollTop = position}, 0);

    select.focus();
	
	return false;
   }
   
   option.onmousemove =
   function(event)
   {
	event.preventDefault();  
   }
  }
 }

 
 // OBSERVER TO CONTROL IF ANY OPTIONS ARE ADDED IN THE FUTURE
 var observer = new MutationObserver(
 function(mutations)
 {  
  for(var mutation of mutations)
  {   
   if(mutation.type == "childList")
   {
    // REFRESH OPTIONS SETUP
    setupoptions();
	
	break;
   }
  }
 });
 
 
 // SETUP CURRENT OPTIONS AND OBSERVE FOR FUTURE CHANGES
 setupoptions();
 //observer.observe(select, {childList:true});
}




function Document_Select_Sort(select, options = {field:"text", mode:"ascending"})
{
 var items = [];
 for(var option of select.options) items.push(option);
 
 var field = options["field"];
 var mode  = options["mode"];
 
 items.sort(
 function(a,b)
 {
  switch(mode)
  {
   case "ascending":
	  if (a[field] > b[field]) return 1;
	  else if (a[field] < b[field]) return -1;
	  else return 0;
   break;
   
   case "descending":
	  if (a[field] < b[field]) return 1;
	  else if (a[field] > b[field]) return -1;
	  else return 0;
   break;
  }
 }); 
  
 
 select.innerHTML = "";
 select.append(...items);
}







// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                           C S S                                                //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Document_CSS_GetClasses(element)
{
 var classes = [];
 
 for(var cssclass of element.classList)
 {
  classes.push(cssclass);
 }
 
 return classes; 
}





function Document_CSS_SetClasses(element, classes)
{
 element.className = "";
 
 for(var cssclass of classes)
 {
  Document_CSS_SetClass(element, cssclass);
 }
 
}





function Document_CSS_SwitchClass(element, cssclass)
{
 if(element.classList.contains(cssclass)) element.classList.remove(cssclass); else element.classList.add(cssclass); 
}




function Document_CSS_SetClass(element, cssclass)
{
 if(!element.classList.contains(cssclass)) element.classList.add(cssclass); 
}



function Document_CSS_UnsetClass(element, cssclass)
{
 while(element.classList.contains(cssclass)) element.classList.remove(cssclass); 
}




function Document_CSS_SetClasses(element, classes)
{
 for(var cssclass of classes) Document_CSS_SetClass(element, cssclass);
}




function Document_CSS_PurgeClasses(element, tag)
{
 var purge = [];
 
 for(var cssclass of element.classList)
 {
  if(cssclass.startsWith(tag)) purge.push(cssclass);
 }
 
 for(var cssclass of purge) element.classList.remove(cssclass);
 
 return purge;
}




function Document_CSS_GetValue(selector, style, sheet) 
{
 selector = "." + selector;	
	
 var sheets = typeof sheet !== 'undefined' ? [sheet] : document.styleSheets;
 
 for(var i = 0, l = sheets.length; i < l; i++) 
 {
  var sheet = sheets[i];
 
  if(!sheet.cssRules) continue; 
  
  for(var j = 0, k = sheet.cssRules.length; j < k; j++) 
  {
   var rule = sheet.cssRules[j];
   if(rule.selectorText && rule.selectorText.split(',').indexOf(selector) !== -1) 
   {
    return rule.style[style];
   }
  }
 }
 
 return null;
}





function Document_CSS_GetVariable(name)
{
 var style = getComputedStyle(document.documentElement);
 var value = style.getPropertyValue("--" + name);
 
 return value;
}




function Document_CSS_SetVariable(name, value)
{
 document.documentElement.style.setProperty("--" + name, value);
}




function Document_CSS_Percentage(a, b)
{
 var p = ((parseFloat(a) / parseFloat(b)) * 100) + "%";

 return p;
}








// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                        F O N T S                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Document_Fonts_List()
{
 var list = [];
 
 var fonts = document.fonts.entries();
 do
 {
  var item = fonts.next();
   
  if(!item.done)
  {
   list.push(item.value[0]["family"]);
  }
 }
 while(!item.done)
 
 return list;
}









// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                  P R O C E S S I N G                                           //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



function Document_Conditional_Class(container, cssclass, condition_data, condition_value)
{
 if(typeof cssclass == "string")
 {
  var cssclass = [cssclass];
 }
 
 
 if(!container.children) var elements = container;
 else
 {
  var elements = Document_Element_Children(container);
 }
 
 
 for(var element of elements)
 {
  var select = undefined;
  
  // DETERMINE WHETHER TO SELECT OR NOT
  switch(typeof condition_data)
  {
   case "function":
	select = condition_data(element);
   break;
   
   case "object":
	select = (element == condition_data)
   break;

   case "string":
	select = (Document_Element_GetData(element, condition_data) == condition_value);
   break;
  }
  
  // APPLY SELECTION
  switch(select)
  {
   case true:
     for(var css of cssclass) Document_CSS_SetClass(element, css);
   break;
  
   case false:  
	 for(var css of cssclass) Document_CSS_UnsetClass(element, css);
   break;
  }
  
 }
 
}



function Document_Conditional_Style(container, style_selected, style_unselected, condition_data, condition_value)
{
 if(!container.children) var elements = container;
 else
 {
  var elements = Document_Element_Children(container);
 }
 
 
 for(var element of elements)
 {
  var select = undefined;
  
  // DETERMINE WHETHER TO SELECT OR NOT
  switch(typeof condition_data)
  {
   case "function":
	select = condition_data(element);
   break;
   
   case "object":
	select = (element == condition_data)
   break;

   case "string":
	select = (Document_Element_GetData(element, condition_data) == condition_value);
   break;
  }
  
  // APPLY SELECTION
  switch(select)
  {
   case true:
     Object.assign(element.style, style_selected);
   break;
  
   case false:  
	 Object.assign(element.style, style_unselected);
   break;
  }
  
 }
 
 
}





// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      H A N D L E R S                                           //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Document_Handler_FileDrop(element, options, ondrop)
{
 element.ondragover = 
 function(event)
 {
  event.preventDefault();
 }
 
 element.ondrop = 
 function(event)
 {
  event.preventDefault();
  
  var files = [];
  for(var item of event.dataTransfer.items)
  {
   var file = item.getAsFile();
   files.push(file);
  }
  
  ondrop(files);
 }
}






function Document_Handler_Paste(events = {}, target = document)
{ console.log(target);
 target.onpaste = 
 function(event)
 { 
  // SCAN CLIPBOARD ITEMS
  for(var item of event.clipboardData.items)
  {
   // IF THERE IS AN EVENT ASSOCIATED WITH THE CLIPBOARD ITEM TYPE, CALL IT
   for(var key in events)
   {
    if(item.type.indexOf(key) === 0)
    {		 
     events[key](item, event);
    }  
   }
   
  }
 }
 
}





function Document_Handler_EnterKey(element, onenter)
{
	
 element.addEventListener("keyup", 
 function(event) 
 {
  event.preventDefault();
  if(event.keyCode == 13) onenter();
 });
 
}



function Document_Handler_SelectionRectangle(container, style, onselecting, onselected)
{
 container.style.position  = "relative";
 container.style.draggable = false;
 container.ondragstart     = function(){return false};
 
 container.addEventListener("mousedown",
 function(event)
 {
  var rectangle = Document_Element_GetObject(container, "selectionrectangle");
  if(rectangle) rectangle.remove();
  
  var rectangle = document.createElement("div");
  Document_CSS_SetClass(rectangle, style);
  rectangle.style.position      = "absolute";
  rectangle.style.zIndex        = 10000;
  rectangle.style.pointerEvents = "none"; 
  
  var rect = container.getBoundingClientRect();
  rectangle.style.left = (event.clientX - rect.left); 
  rectangle.style.top  = (event.clientY - rect.top);
  
  Document_Element_SetObject(container, "selectionrectangle", rectangle);
  
  container.appendChild(rectangle);
 });
 
 
 
 container.addEventListener("mousemove",
 function(event)
 {
  var rectangle = Document_Element_GetObject(container, "selectionrectangle");
  if(!rectangle) return;
  
  var rect = container.getBoundingClientRect();
  rectangle.style.width  = (event.clientX - rect.left) - parseInt(rectangle.style.left);
  rectangle.style.height = (event.clientY - rect.top)  - parseInt(rectangle.style.top);
  
  var list = Document_Element_ListColliding(rectangle);
  
  if(onselecting) onselecting(rectangle, list);
 });
 
 
 
 container.addEventListener("mouseup",
 function(event)
 {
  var rectangle = Document_Element_GetObject(container, "selectionrectangle");
  if(!rectangle) return;
  
  rectangle.remove();
  
  Document_Element_SetObject(container, "selectionrectangle", false);
  
  if(onselected) onselected(rectangle);
 });
 
}





function Document_Handler_DragSwap(elements, highlight, onswap)
{
 for(var element of elements)
 {
  element.draggable = true;	 
	 
  // START DRAGGING
  element.ondrag =
  function(event)
  {
   var element = event.currentTarget;
    
   utils["dragging"]        = element;
   element.style.visibility = "hidden";
   
   event.preventDefault();
  }
 
 
 
  // DRAGGING OVER
  element.ondragover =
  function(event)
  {
   var element = event.currentTarget;
   
   if(highlight) Document_CSS_SetClass(element, highlight);
   
   event.preventDefault();
  }
  
  
  
  // DRAG LEAVE
  element.ondragleave =
  function(event)
  {
   var element = event.currentTarget;
   
   if(highlight) Document_CSS_UnsetClass(element, highlight);
   
   event.preventDefault();
  }

 
  // DROPPING
  element.ondrop =
  function(event)
  {
   var dragged = utils["dragging"]; 
   var dropped = event.currentTarget;
   
   //dragged.parentNode.insertBefore(dragged, dropped);
   Document_Elements_Swap(dragged, dropped);
   
   if(onswap) onswap(
   {
    success: true,   
	dragged: dragged,
    dropped: dropped    
   });
   
   if(highlight) Document_CSS_UnsetClass(dropped, highlight);
   
   utils["lastdrag"] = true;
   delete utils["dragging"];
   
   event.preventDefault();
  }
  
  
  // END OF DRAGGING
  element.ondragend =
  function(event)
  {
   var element = event.currentTarget;
   
   element.style.visibility = "visible";
   
   if(!utils["lastdrag"] && onswap) onswap(
   {
	success: false,
	dragged: element
   });
   
   delete utils["lastdrag"];
   delete utils["dragging"];
   
   event.preventDefault();
  }
  
 
 }
}






function Document_Handler_DragSwapParent(containers, highlight, onswap)
{
 for(let container of containers)
 {
  var elements = Document_Element_Children(container);
  
  for(var element of elements)
  {
   element.draggable = true;
   
   // BEGIN ELEMENT DRAGGING
   element.ondrag =
   function(event)
   {
    var element = event.currentTarget;
    
    utils["dragging"]        = element;
    element.style.visibility = "hidden";

    event.preventDefault();
   }
   
   // CANCELLED ELEMENT DRAGGING
   element.ondragend =
   function(event)
   {
    var element = event.currentTarget;
   
    element.style.visibility = "visible";
   
    if(!utils["lastdrag"] && onswap) onswap(
    {
 	 success: false,
	 dragged: element
    });
   
    delete utils["lastdrag"];
    delete utils["dragging"];
   
    event.preventDefault();
   }
  } 
 
 
  // DRAGGING OVER CONTAINER
  container.ondragover =
  function(event)
  {
   var dropon = event.currentTarget;
   
   if(highlight) Document_CSS_SetClass(dropon, highlight);
   
   event.preventDefault();
  }
  
  
  
  // DRAGGIN AWAY FROM CONTAINER
  container.ondragleave =
  function(event)
  {
   var dropon = event.currentTarget;
   
   if(highlight) Document_CSS_UnsetClass(dropon, highlight);
   
   event.preventDefault();
  }

 
  // DROPPING OVER CONTAINER
  container.ondrop =
  function(event)
  {
   var element = utils["dragging"]; 
   var dropon  = event.currentTarget;
   var from    = element.parentElement;
   
   from.removeChild(element);
   dropon.appendChild(element);
   
   if(onswap) onswap(
   {
    success:   true,   
	dragged:   element,
	from:      from,
    container: dropon,    
   });
   
   if(highlight) Document_CSS_UnsetClass(dropon, highlight);
   
   utils["lastdrag"] = true;
   delete utils["dragging"];
   
   event.preventDefault();
  }
  
 
 }
}




function Document_Handler_DragVirtual(sources, destinations, highlight, ondragstart, ondragdrop)
{
 // SET ALL SOURCES TO BE DRAGGABLE
 for(var source of sources)
 {
  source.draggable = true;   
   
  source.ondragstart = 
  function(event)
  {
   if(ondragstart) ondragstart(event);
  }
 }
 
 
 // SET ALL DESTINATION ELEMENTS TO ACCEPT RECEIVING
 for(var destination of destinations)
 {
  destination.ondragover =
  function(event)
  {
   var element = event.currentTarget;
   if(highlight) Document_CSS_SetClass(element, highlight);
	
   event.preventDefault();
  }
  
  destination.ondragleave = 
  function(event)
  {
   var element = event.currentTarget;
   if(highlight) Document_CSS_UnsetClass(element, highlight);
  }
  
  destination.ondrop = 
  function(event)
  {
   var element = event.currentTarget;
   if(highlight) Document_CSS_UnsetClass(element, highlight);
   
   if(ondragdrop) ondragdrop(event);
  }
 }
 
}





function Document_Handler_Dragging(container, ondragstart, onmouseup, onmousemove)
{
 container.style.position = "relative";
 var crect    = container.getBoundingClientRect();

 var elements = Document_Element_Children(container); 
 for(var element of elements) 
 {
  var rect = element.getBoundingClientRect();
  
  element.style.position = "absolute";
  element.style.left     = rect.left - crect.left;
  element.style.top      = rect.top  - crect.top;  
  
  console.log(element.style.left, element.style.top);
 }
	
	
 container.ondragstart = 
 function(event)
 {
  event.preventDefault();
 
  var container = event.currentTarget;
  var element   = event.srcElement;
  
  if(element == container) return;
  
  Document_Element_SetObject(container, "dragging", element);
  Document_CSS_SwitchClass(element, "style-drag-dragging");
 }
 
 
 container.onmouseup = 
 function(event)
 {
  var container = event.currentTarget;
  var element = Document_Element_GetObject(container, "dragging");
  
  if(element)
  {
   Document_Element_SetObject(container, "dragging", undefined);
   Document_CSS_SwitchClass(element, "style-drag-dragging");
  }
 }
 
 
 container.onmousemove = 
 function(event)
 { 
  var container = event.currentTarget;
  var element = Document_Element_GetObject(container, "dragging");
  
  if(element)
  {
   var crect = container.getBoundingClientRect();
   var erect = element.getBoundingClientRect();
  
   var left = erect.left - crect.left;
   var top  = erect.top  - crect.top;   
   
   element.style.left = parseFloat(left) + event.movementX;
   element.style.top  = parseFloat(top)  + event.movementY;   
  }
 }
 
}




function Document_Handler_ScrollReduce(scroller, target, config = {direction:"vertical", size:"0px", threshold:0.2, time:1})
{
 // WHEN *SCROLLER* SCROLLS BEYOND *THRESHOLD*, IN *DIRECTION*
 // TAKE *TARGET* AND SHRINK IT TO *SIZE* IN *TIME* SECONDS
 target.style.transition = "all " + config["time"] + "s";
 
 scroller.addEventListener("scroll",
 function(event)
 {
  if(config["direction"] == "vertical") 
  {
   var field    = "height";
   var position = "scrollTop";
  }
  else
  {
   var field    = "width"; 
   var position = "scrollLeft";
  }
  
  var amount  = scroller[position] / scroller.getBoundingClientRect()[field];   console.log(amount);
  var reduced = Document_Element_GetData(target, "scrollreduced");
  
  if(!reduced && amount >= config["threshold"])
  {
   Document_Element_SetData(target, "beforescrollreduce", target.style[field]);
   
   target.style[field] = config["size"];   
   Document_Element_SetData(target, "scrollreduced", true);
  }
  else
  if(reduced && amount < config["threshold"])  
  {
   target.style[field] = Document_Element_GetData(target, "beforescrollreduce");
   Document_Element_SetData(target, "scrollreduced", false);
  }
  
 }, true);
 
 //temp2.scrollTop / temp2.getBoundingClientRect().height
}





function Document_Handler_KeyFilter(element, keys)
{
 // PREVENT TYPING
 element.onkeydown = 
 function(event)
 { 
  if(keys.includes(event.key)) return false;
 }

 // PREVENT PASTING
 /*
 element.onpaste =
 function(event)
 {  
  var text = (event.clipboardData || window.clipboardData).getData("text");
  for(var key of keys) text = text.replaceAll(key, "");

  const selection = window.getSelection();
  if (!selection.rangeCount) return false;
  
  selection.deleteFromDocument();
  selection.getRangeAt(0).insertNode(document.createTextNode(text));
 
  event.preventDefault();
 }
 */
}/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 */
!function(A,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(A="undefined"!=typeof globalThis?globalThis:A||self).html2canvas=e()}(this,function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var r=function(A,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,e){A.__proto__=e}||function(A,e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(A[t]=e[t])})(A,e)};function A(A,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=A}r(A,e),A.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}var h=function(){return(h=Object.assign||function(A){for(var e,t=1,r=arguments.length;t<r;t++)for(var B in e=arguments[t])Object.prototype.hasOwnProperty.call(e,B)&&(A[B]=e[B]);return A}).apply(this,arguments)};function a(A,s,o,i){return new(o=o||Promise)(function(t,e){function r(A){try{n(i.next(A))}catch(A){e(A)}}function B(A){try{n(i.throw(A))}catch(A){e(A)}}function n(A){var e;A.done?t(A.value):((e=A.value)instanceof o?e:new o(function(A){A(e)})).then(r,B)}n((i=i.apply(A,s||[])).next())})}function H(t,r){var B,n,s,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},A={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(A[Symbol.iterator]=function(){return this}),A;function e(e){return function(A){return function(e){if(B)throw new TypeError("Generator is already executing.");for(;o;)try{if(B=1,n&&(s=2&e[0]?n.return:e[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,e[1])).done)return s;switch(n=0,(e=s?[2&e[0],s.value]:e)[0]){case 0:case 1:s=e;break;case 4:return o.label++,{value:e[1],done:!1};case 5:o.label++,n=e[1],e=[0];continue;case 7:e=o.ops.pop(),o.trys.pop();continue;default:if(!(s=0<(s=o.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){o=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){o.label=e[1];break}if(6===e[0]&&o.label<s[1]){o.label=s[1],s=e;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(e);break}s[2]&&o.ops.pop(),o.trys.pop();continue}e=r.call(t,o)}catch(A){e=[6,A],n=0}finally{B=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,A])}}}function t(A,e,t){if(t||2===arguments.length)for(var r,B=0,n=e.length;B<n;B++)!r&&B in e||((r=r||Array.prototype.slice.call(e,0,B))[B]=e[B]);return A.concat(r||e)}var d=(B.prototype.add=function(A,e,t,r){return new B(this.left+A,this.top+e,this.width+t,this.height+r)},B.fromClientRect=function(A,e){return new B(e.left+A.windowBounds.left,e.top+A.windowBounds.top,e.width,e.height)},B.fromDOMRectList=function(A,e){e=Array.from(e).find(function(A){return 0!==A.width});return e?new B(e.left+A.windowBounds.left,e.top+A.windowBounds.top,e.width,e.height):B.EMPTY},B.EMPTY=new B(0,0,0,0),B);function B(A,e,t,r){this.left=A,this.top=e,this.width=t,this.height=r}for(var f=function(A,e){return d.fromClientRect(A,e.getBoundingClientRect())},Q=function(A){for(var e=[],t=0,r=A.length;t<r;){var B,n=A.charCodeAt(t++);55296<=n&&n<=56319&&t<r?56320==(64512&(B=A.charCodeAt(t++)))?e.push(((1023&n)<<10)+(1023&B)+65536):(e.push(n),t--):e.push(n)}return e},g=function(){for(var A=[],e=0;e<arguments.length;e++)A[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,A);var t=A.length;if(!t)return"";for(var r=[],B=-1,n="";++B<t;){var s=A[B];s<=65535?r.push(s):(s-=65536,r.push(55296+(s>>10),s%1024+56320)),(B+1===t||16384<r.length)&&(n+=String.fromCharCode.apply(String,r),r.length=0)}return n},e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="undefined"==typeof Uint8Array?[]:new Uint8Array(256),s=0;s<e.length;s++)n[e.charCodeAt(s)]=s;for(var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c="undefined"==typeof Uint8Array?[]:new Uint8Array(256),i=0;i<o.length;i++)c[o.charCodeAt(i)]=i;function w(A,e,t){return A.slice?A.slice(e,t):new Uint16Array(Array.prototype.slice.call(A,e,t))}var U=(l.prototype.get=function(A){var e;if(0<=A){if(A<55296||56319<A&&A<=65535)return e=this.index[A>>5],this.data[e=(e<<2)+(31&A)];if(A<=65535)return e=this.index[2048+(A-55296>>5)],this.data[e=(e<<2)+(31&A)];if(A<this.highStart)return e=this.index[e=2080+(A>>11)],e=this.index[e+=A>>5&63],this.data[e=(e<<2)+(31&A)];if(A<=1114111)return this.data[this.highValueIndex]}return this.errorValue},l);function l(A,e,t,r,B,n){this.initialValue=A,this.errorValue=e,this.highStart=t,this.highValueIndex=r,this.index=B,this.data=n}for(var C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u="undefined"==typeof Uint8Array?[]:new Uint8Array(256),F=0;F<C.length;F++)u[C.charCodeAt(F)]=F;function p(A,e,t,r){var B=r[t];if(Array.isArray(A)?-1!==A.indexOf(B):A===B)for(var n=t;n<=r.length;){if((o=r[++n])===e)return 1;if(o!==D)break}if(B===D)for(n=t;0<n;){var s=r[--n];if(Array.isArray(A)?-1!==A.indexOf(s):A===s)for(var o,i=t;i<=r.length;){if((o=r[++i])===e)return 1;if(o!==D)break}if(s!==D)break}}function E(A,e){for(var t=A;0<=t;){var r=e[t];if(r!==D)return r;t--}return 0}function I(t,A){var e=(B=function(A,r){void 0===r&&(r="strict");var B=[],n=[],s=[];return A.forEach(function(A,e){var t=rA.get(A);if(50<t?(s.push(!0),t-=50):s.push(!1),-1!==["normal","auto","loose"].indexOf(r)&&-1!==[8208,8211,12316,12448].indexOf(A))return n.push(e),B.push(16);if(4!==t&&11!==t)return n.push(e),31===t?B.push("strict"===r?O:q):t===AA||29===t?B.push(J):43===t?131072<=A&&A<=196605||196608<=A&&A<=262141?B.push(q):B.push(J):void B.push(t);if(0===e)return n.push(e),B.push(J);t=B[e-1];return-1===iA.indexOf(t)?(n.push(n[e-1]),B.push(t)):(n.push(e),B.push(J))}),[n,B,s]}(t,(A=A||{lineBreak:"normal",wordBreak:"normal"}).lineBreak))[0],r=B[1],B=B[2];return[e,r="break-all"===A.wordBreak||"break-word"===A.wordBreak?r.map(function(A){return-1!==[R,J,AA].indexOf(A)?q:A}):r,"keep-all"===A.wordBreak?B.map(function(A,e){return A&&19968<=t[e]&&t[e]<=40959}):void 0]}var y,K,m,L,b,D=10,v=13,x=15,M=17,S=18,T=19,G=20,O=21,V=22,k=24,R=25,N=26,P=27,X=28,J=30,Y=32,W=33,Z=34,_=35,q=37,j=38,z=39,$=40,AA=42,eA=[9001,65288],tA="×",rA=(m=function(A){var e,t,r,B,n=.75*A.length,s=A.length,o=0;"="===A[A.length-1]&&(n--,"="===A[A.length-2]&&n--);for(var n=new("undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?ArrayBuffer:Array)(n),i=Array.isArray(n)?n:new Uint8Array(n),Q=0;Q<s;Q+=4)e=c[A.charCodeAt(Q)],t=c[A.charCodeAt(Q+1)],r=c[A.charCodeAt(Q+2)],B=c[A.charCodeAt(Q+3)],i[o++]=e<<2|t>>4,i[o++]=(15&t)<<4|r>>2,i[o++]=(3&r)<<6|63&B;return n}(y="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA=="),L=Array.isArray(m)?function(A){for(var e=A.length,t=[],r=0;r<e;r+=4)t.push(A[r+3]<<24|A[r+2]<<16|A[r+1]<<8|A[r]);return t}(m):new Uint32Array(m),b=Array.isArray(m)?function(A){for(var e=A.length,t=[],r=0;r<e;r+=2)t.push(A[r+1]<<8|A[r]);return t}(m):new Uint16Array(m),y=w(b,12,L[4]/2),K=2===L[5]?w(b,(24+L[4])/2):(m=L,b=Math.ceil((24+L[4])/4),m.slice?m.slice(b,K):new Uint32Array(Array.prototype.slice.call(m,b,K))),new U(L[0],L[1],L[2],L[3],y,K)),BA=[J,36],nA=[1,2,3,5],sA=[D,8],oA=[P,N],iA=nA.concat(sA),QA=[j,z,$,Z,_],cA=[x,v],aA=(gA.prototype.slice=function(){return g.apply(void 0,this.codePoints.slice(this.start,this.end))},gA);function gA(A,e,t,r){this.codePoints=A,this.required="!"===e,this.start=t,this.end=r}function wA(A,e){var t=Q(A),r=(e=I(t,e))[0],B=e[1],n=e[2],s=t.length,o=0,i=0;return{next:function(){if(s<=i)return{done:!0,value:null};for(var A=tA;i<s&&(A=function(A,e,t,r,B){if(0===t[r])return tA;var n=r-1;if(Array.isArray(B)&&!0===B[n])return tA;var s=n-1,o=1+n,i=e[n],r=0<=s?e[s]:0,B=e[o];if(2===i&&3===B)return tA;if(-1!==nA.indexOf(i))return"!";if(-1!==nA.indexOf(B))return tA;if(-1!==sA.indexOf(B))return tA;if(8===E(n,e))return"÷";if(11===rA.get(A[n]))return tA;if((i===Y||i===W)&&11===rA.get(A[o]))return tA;if(7===i||7===B)return tA;if(9===i)return tA;if(-1===[D,v,x].indexOf(i)&&9===B)return tA;if(-1!==[M,S,T,k,X].indexOf(B))return tA;if(E(n,e)===V)return tA;if(p(23,V,n,e))return tA;if(p([M,S],O,n,e))return tA;if(p(12,12,n,e))return tA;if(i===D)return"÷";if(23===i||23===B)return tA;if(16===B||16===i)return"÷";if(-1!==[v,x,O].indexOf(B)||14===i)return tA;if(36===r&&-1!==cA.indexOf(i))return tA;if(i===X&&36===B)return tA;if(B===G)return tA;if(-1!==BA.indexOf(B)&&i===R||-1!==BA.indexOf(i)&&B===R)return tA;if(i===P&&-1!==[q,Y,W].indexOf(B)||-1!==[q,Y,W].indexOf(i)&&B===N)return tA;if(-1!==BA.indexOf(i)&&-1!==oA.indexOf(B)||-1!==oA.indexOf(i)&&-1!==BA.indexOf(B))return tA;if(-1!==[P,N].indexOf(i)&&(B===R||-1!==[V,x].indexOf(B)&&e[1+o]===R)||-1!==[V,x].indexOf(i)&&B===R||i===R&&-1!==[R,X,k].indexOf(B))return tA;if(-1!==[R,X,k,M,S].indexOf(B))for(var Q=n;0<=Q;){if((c=e[Q])===R)return tA;if(-1===[X,k].indexOf(c))break;Q--}if(-1!==[P,N].indexOf(B))for(var c,Q=-1!==[M,S].indexOf(i)?s:n;0<=Q;){if((c=e[Q])===R)return tA;if(-1===[X,k].indexOf(c))break;Q--}if(j===i&&-1!==[j,z,Z,_].indexOf(B)||-1!==[z,Z].indexOf(i)&&-1!==[z,$].indexOf(B)||-1!==[$,_].indexOf(i)&&B===$)return tA;if(-1!==QA.indexOf(i)&&-1!==[G,N].indexOf(B)||-1!==QA.indexOf(B)&&i===P)return tA;if(-1!==BA.indexOf(i)&&-1!==BA.indexOf(B))return tA;if(i===k&&-1!==BA.indexOf(B))return tA;if(-1!==BA.concat(R).indexOf(i)&&B===V&&-1===eA.indexOf(A[o])||-1!==BA.concat(R).indexOf(B)&&i===S)return tA;if(41===i&&41===B){for(var a=t[n],g=1;0<a&&41===e[--a];)g++;if(g%2!=0)return tA}return i===Y&&B===W?tA:"÷"}(t,B,r,++i,n))===tA;);if(A===tA&&i!==s)return{done:!0,value:null};var e=new aA(t,A,o,i);return o=i,{value:e,done:!1}}}}function UA(A){return 48<=A&&A<=57}function lA(A){return UA(A)||65<=A&&A<=70||97<=A&&A<=102}function CA(A){return 10===A||9===A||32===A}function uA(A){return 97<=(t=e=A)&&t<=122||65<=(e=e)&&e<=90||128<=A||95===A;var e,t}function FA(A){return uA(A)||UA(A)||45===A}function hA(A,e){return 92===A&&10!==e}function dA(A,e,t){return 45===A?uA(e)||hA(e,t):!!uA(A)||92===A&&10!==e}function fA(A,e,t){return 43===A||45===A?!!UA(e)||46===e&&UA(t):UA(46===A?e:A)}var HA={type:2},pA={type:3},EA={type:4},IA={type:13},yA={type:8},KA={type:21},mA={type:9},LA={type:10},bA={type:11},DA={type:12},vA={type:14},xA={type:23},MA={type:1},SA={type:25},TA={type:24},GA={type:26},OA={type:27},VA={type:28},kA={type:29},RA={type:31},NA={type:32},PA=(XA.prototype.write=function(A){this._value=this._value.concat(Q(A))},XA.prototype.read=function(){for(var A=[],e=this.consumeToken();e!==NA;)A.push(e),e=this.consumeToken();return A},XA.prototype.consumeToken=function(){var A=this.consumeCodePoint();switch(A){case 34:return this.consumeStringToken(34);case 35:var e=this.peekCodePoint(0),t=this.peekCodePoint(1),r=this.peekCodePoint(2);if(FA(e)||hA(t,r)){var B=dA(e,t,r)?2:1;return{type:5,value:this.consumeName(),flags:B}}break;case 36:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),IA;break;case 39:return this.consumeStringToken(39);case 40:return HA;case 41:return pA;case 42:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),vA;break;case 43:if(fA(A,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(A),this.consumeNumericToken();break;case 44:return EA;case 45:var r=A,B=this.peekCodePoint(0),n=this.peekCodePoint(1);if(fA(r,B,n))return this.reconsumeCodePoint(A),this.consumeNumericToken();if(dA(r,B,n))return this.reconsumeCodePoint(A),this.consumeIdentLikeToken();if(45===B&&62===n)return this.consumeCodePoint(),this.consumeCodePoint(),TA;break;case 46:if(fA(A,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(A),this.consumeNumericToken();break;case 47:if(42===this.peekCodePoint(0))for(this.consumeCodePoint();;){var s=this.consumeCodePoint();if(42===s&&47===(s=this.consumeCodePoint()))return this.consumeToken();if(-1===s)return this.consumeToken()}break;case 58:return GA;case 59:return OA;case 60:if(33===this.peekCodePoint(0)&&45===this.peekCodePoint(1)&&45===this.peekCodePoint(2))return this.consumeCodePoint(),this.consumeCodePoint(),SA;break;case 64:var n=this.peekCodePoint(0),o=this.peekCodePoint(1),i=this.peekCodePoint(2);if(dA(n,o,i))return{type:7,value:this.consumeName()};break;case 91:return VA;case 92:if(hA(A,this.peekCodePoint(0)))return this.reconsumeCodePoint(A),this.consumeIdentLikeToken();break;case 93:return kA;case 61:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),yA;break;case 123:return bA;case 125:return DA;case 117:case 85:o=this.peekCodePoint(0),i=this.peekCodePoint(1);return 43!==o||!lA(i)&&63!==i||(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(A),this.consumeIdentLikeToken();case 124:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),mA;if(124===this.peekCodePoint(0))return this.consumeCodePoint(),KA;break;case 126:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),LA;break;case-1:return NA}return CA(A)?(this.consumeWhiteSpace(),RA):UA(A)?(this.reconsumeCodePoint(A),this.consumeNumericToken()):uA(A)?(this.reconsumeCodePoint(A),this.consumeIdentLikeToken()):{type:6,value:g(A)}},XA.prototype.consumeCodePoint=function(){var A=this._value.shift();return void 0===A?-1:A},XA.prototype.reconsumeCodePoint=function(A){this._value.unshift(A)},XA.prototype.peekCodePoint=function(A){return A>=this._value.length?-1:this._value[A]},XA.prototype.consumeUnicodeRangeToken=function(){for(var A=[],e=this.consumeCodePoint();lA(e)&&A.length<6;)A.push(e),e=this.consumeCodePoint();for(var t=!1;63===e&&A.length<6;)A.push(e),e=this.consumeCodePoint(),t=!0;if(t)return{type:30,start:parseInt(g.apply(void 0,A.map(function(A){return 63===A?48:A})),16),end:parseInt(g.apply(void 0,A.map(function(A){return 63===A?70:A})),16)};var r=parseInt(g.apply(void 0,A),16);if(45===this.peekCodePoint(0)&&lA(this.peekCodePoint(1))){this.consumeCodePoint();for(var e=this.consumeCodePoint(),B=[];lA(e)&&B.length<6;)B.push(e),e=this.consumeCodePoint();return{type:30,start:r,end:parseInt(g.apply(void 0,B),16)}}return{type:30,start:r,end:r}},XA.prototype.consumeIdentLikeToken=function(){var A=this.consumeName();return"url"===A.toLowerCase()&&40===this.peekCodePoint(0)?(this.consumeCodePoint(),this.consumeUrlToken()):40===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:19,value:A}):{type:20,value:A}},XA.prototype.consumeUrlToken=function(){var A=[];if(this.consumeWhiteSpace(),-1===this.peekCodePoint(0))return{type:22,value:""};var e,t=this.peekCodePoint(0);if(39===t||34===t){t=this.consumeStringToken(this.consumeCodePoint());return 0===t.type&&(this.consumeWhiteSpace(),-1===this.peekCodePoint(0)||41===this.peekCodePoint(0))?(this.consumeCodePoint(),{type:22,value:t.value}):(this.consumeBadUrlRemnants(),xA)}for(;;){var r=this.consumeCodePoint();if(-1===r||41===r)return{type:22,value:g.apply(void 0,A)};if(CA(r))return this.consumeWhiteSpace(),-1===this.peekCodePoint(0)||41===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:22,value:g.apply(void 0,A)}):(this.consumeBadUrlRemnants(),xA);if(34===r||39===r||40===r||(0<=(e=r)&&e<=8||11===e||14<=e&&e<=31||127===e))return this.consumeBadUrlRemnants(),xA;if(92===r){if(!hA(r,this.peekCodePoint(0)))return this.consumeBadUrlRemnants(),xA;A.push(this.consumeEscapedCodePoint())}else A.push(r)}},XA.prototype.consumeWhiteSpace=function(){for(;CA(this.peekCodePoint(0));)this.consumeCodePoint()},XA.prototype.consumeBadUrlRemnants=function(){for(;;){var A=this.consumeCodePoint();if(41===A||-1===A)return;hA(A,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},XA.prototype.consumeStringSlice=function(A){for(var e="";0<A;){var t=Math.min(5e4,A);e+=g.apply(void 0,this._value.splice(0,t)),A-=t}return this._value.shift(),e},XA.prototype.consumeStringToken=function(A){for(var e="",t=0;;){var r,B=this._value[t];if(-1===B||void 0===B||B===A)return{type:0,value:e+=this.consumeStringSlice(t)};if(10===B)return this._value.splice(0,t),MA;92!==B||-1!==(r=this._value[t+1])&&void 0!==r&&(10===r?(e+=this.consumeStringSlice(t),t=-1,this._value.shift()):hA(B,r)&&(e+=this.consumeStringSlice(t),e+=g(this.consumeEscapedCodePoint()),t=-1)),t++}},XA.prototype.consumeNumber=function(){var A=[],e=4;for(43!==(t=this.peekCodePoint(0))&&45!==t||A.push(this.consumeCodePoint());UA(this.peekCodePoint(0));)A.push(this.consumeCodePoint());var t=this.peekCodePoint(0),r=this.peekCodePoint(1);if(46===t&&UA(r))for(A.push(this.consumeCodePoint(),this.consumeCodePoint()),e=8;UA(this.peekCodePoint(0));)A.push(this.consumeCodePoint());t=this.peekCodePoint(0);var r=this.peekCodePoint(1),B=this.peekCodePoint(2);if((69===t||101===t)&&((43===r||45===r)&&UA(B)||UA(r)))for(A.push(this.consumeCodePoint(),this.consumeCodePoint()),e=8;UA(this.peekCodePoint(0));)A.push(this.consumeCodePoint());return[function(A){var e=0,t=1;43!==A[e]&&45!==A[e]||(45===A[e]&&(t=-1),e++);for(var r=[];UA(A[e]);)r.push(A[e++]);var B=r.length?parseInt(g.apply(void 0,r),10):0;46===A[e]&&e++;for(var n=[];UA(A[e]);)n.push(A[e++]);var s=n.length,o=s?parseInt(g.apply(void 0,n),10):0;69!==A[e]&&101!==A[e]||e++;var i=1;43!==A[e]&&45!==A[e]||(45===A[e]&&(i=-1),e++);for(var Q=[];UA(A[e]);)Q.push(A[e++]);var c=Q.length?parseInt(g.apply(void 0,Q),10):0;return t*(B+o*Math.pow(10,-s))*Math.pow(10,i*c)}(A),e]},XA.prototype.consumeNumericToken=function(){var A=this.consumeNumber(),e=A[0],t=A[1],r=this.peekCodePoint(0),B=this.peekCodePoint(1),A=this.peekCodePoint(2);return dA(r,B,A)?{type:15,number:e,flags:t,unit:this.consumeName()}:37===r?(this.consumeCodePoint(),{type:16,number:e,flags:t}):{type:17,number:e,flags:t}},XA.prototype.consumeEscapedCodePoint=function(){var A,e=this.consumeCodePoint();if(lA(e)){for(var t=g(e);lA(this.peekCodePoint(0))&&t.length<6;)t+=g(this.consumeCodePoint());CA(this.peekCodePoint(0))&&this.consumeCodePoint();var r=parseInt(t,16);return 0===r||55296<=(A=r)&&A<=57343||1114111<r?65533:r}return-1===e?65533:e},XA.prototype.consumeName=function(){for(var A="";;){var e=this.consumeCodePoint();if(FA(e))A+=g(e);else{if(!hA(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),A;A+=g(this.consumeEscapedCodePoint())}}},XA);function XA(){this._value=[]}var JA=(YA.create=function(A){var e=new PA;return e.write(A),new YA(e.read())},YA.parseValue=function(A){return YA.create(A).parseComponentValue()},YA.parseValues=function(A){return YA.create(A).parseComponentValues()},YA.prototype.parseComponentValue=function(){for(var A=this.consumeToken();31===A.type;)A=this.consumeToken();if(32===A.type)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(A);for(var e=this.consumeComponentValue();31===(A=this.consumeToken()).type;);if(32===A.type)return e;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},YA.prototype.parseComponentValues=function(){for(var A=[];;){var e=this.consumeComponentValue();if(32===e.type)return A;A.push(e),A.push()}},YA.prototype.consumeComponentValue=function(){var A=this.consumeToken();switch(A.type){case 11:case 28:case 2:return this.consumeSimpleBlock(A.type);case 19:return this.consumeFunction(A)}return A},YA.prototype.consumeSimpleBlock=function(A){for(var e={type:A,values:[]},t=this.consumeToken();;){if(32===t.type||ce(t,A))return e;this.reconsumeToken(t),e.values.push(this.consumeComponentValue()),t=this.consumeToken()}},YA.prototype.consumeFunction=function(A){for(var e={name:A.value,values:[],type:18};;){var t=this.consumeToken();if(32===t.type||3===t.type)return e;this.reconsumeToken(t),e.values.push(this.consumeComponentValue())}},YA.prototype.consumeToken=function(){var A=this._tokens.shift();return void 0===A?NA:A},YA.prototype.reconsumeToken=function(A){this._tokens.unshift(A)},YA);function YA(A){this._tokens=A}function WA(A){return 15===A.type}function ZA(A){return 17===A.type}function _A(A){return 20===A.type}function qA(A){return 0===A.type}function jA(A,e){return _A(A)&&A.value===e}function zA(A){return 31!==A.type}function $A(A){return 31!==A.type&&4!==A.type}function Ae(A){var e=[],t=[];return A.forEach(function(A){if(4===A.type){if(0===t.length)throw new Error("Error parsing function args, zero tokens for arg");return e.push(t),void(t=[])}31!==A.type&&t.push(A)}),t.length&&e.push(t),e}function ee(A){return 17===A.type||15===A.type}function te(A){return 16===A.type||ee(A)}function re(A){return 1<A.length?[A[0],A[1]]:[A[0]]}function Be(A,e,t){var r=A[0],A=A[1];return[Ue(r,e),Ue(void 0!==A?A:r,t)]}function ne(A){return 15===A.type&&("deg"===A.unit||"grad"===A.unit||"rad"===A.unit||"turn"===A.unit)}function se(A){switch(A.filter(_A).map(function(A){return A.value}).join(" ")){case"to bottom right":case"to right bottom":case"left top":case"top left":return[ae,ae];case"to top":case"bottom":return Ce(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[ae,we];case"to right":case"left":return Ce(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[we,we];case"to bottom":case"top":return Ce(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[we,ae];case"to left":case"right":return Ce(270)}return 0}function oe(A){return 0==(255&A)}function ie(A){var e=255&A,t=255&A>>8,r=255&A>>16,A=255&A>>24;return e<255?"rgba("+A+","+r+","+t+","+e/255+")":"rgb("+A+","+r+","+t+")"}function Qe(A,e){if(17===A.type)return A.number;if(16!==A.type)return 0;var t=3===e?1:255;return 3===e?A.number/100*t:Math.round(A.number/100*t)}var ce=function(A,e){return 11===e&&12===A.type||(28===e&&29===A.type||2===e&&3===A.type)},ae={type:17,number:0,flags:4},ge={type:16,number:50,flags:4},we={type:16,number:100,flags:4},Ue=function(A,e){if(16===A.type)return A.number/100*e;if(WA(A))switch(A.unit){case"rem":case"em":return 16*A.number;default:return A.number}return A.number},le=function(A,e){if(15===e.type)switch(e.unit){case"deg":return Math.PI*e.number/180;case"grad":return Math.PI/200*e.number;case"rad":return e.number;case"turn":return 2*Math.PI*e.number}throw new Error("Unsupported angle type")},Ce=function(A){return Math.PI*A/180},ue=function(A,e){if(18===e.type){var t=me[e.name];if(void 0===t)throw new Error('Attempting to parse an unsupported color function "'+e.name+'"');return t(A,e.values)}if(5===e.type){if(3===e.value.length){var r=e.value.substring(0,1),B=e.value.substring(1,2),n=e.value.substring(2,3);return Fe(parseInt(r+r,16),parseInt(B+B,16),parseInt(n+n,16),1)}if(4===e.value.length){var r=e.value.substring(0,1),B=e.value.substring(1,2),n=e.value.substring(2,3),s=e.value.substring(3,4);return Fe(parseInt(r+r,16),parseInt(B+B,16),parseInt(n+n,16),parseInt(s+s,16)/255)}if(6===e.value.length){r=e.value.substring(0,2),B=e.value.substring(2,4),n=e.value.substring(4,6);return Fe(parseInt(r,16),parseInt(B,16),parseInt(n,16),1)}if(8===e.value.length){r=e.value.substring(0,2),B=e.value.substring(2,4),n=e.value.substring(4,6),s=e.value.substring(6,8);return Fe(parseInt(r,16),parseInt(B,16),parseInt(n,16),parseInt(s,16)/255)}}if(20===e.type){e=Le[e.value.toUpperCase()];if(void 0!==e)return e}return Le.TRANSPARENT},Fe=function(A,e,t,r){return(A<<24|e<<16|t<<8|Math.round(255*r)<<0)>>>0},he=function(A,e){e=e.filter($A);if(3===e.length){var t=e.map(Qe),r=t[0],B=t[1],t=t[2];return Fe(r,B,t,1)}if(4!==e.length)return 0;e=e.map(Qe),r=e[0],B=e[1],t=e[2],e=e[3];return Fe(r,B,t,e)};function de(A,e,t){return t<0&&(t+=1),1<=t&&--t,t<1/6?(e-A)*t*6+A:t<.5?e:t<2/3?6*(e-A)*(2/3-t)+A:A}function fe(A,e){return ue(A,JA.create(e).parseComponentValue())}function He(A,e){return A=ue(A,e[0]),(e=e[1])&&te(e)?{color:A,stop:e}:{color:A,stop:null}}function pe(A,t){var e=A[0],r=A[A.length-1];null===e.stop&&(e.stop=ae),null===r.stop&&(r.stop=we);for(var B=[],n=0,s=0;s<A.length;s++){var o=A[s].stop;null!==o?(n<(o=Ue(o,t))?B.push(o):B.push(n),n=o):B.push(null)}for(var i=null,s=0;s<B.length;s++){var Q=B[s];if(null===Q)null===i&&(i=s);else if(null!==i){for(var c=s-i,a=(Q-B[i-1])/(1+c),g=1;g<=c;g++)B[i+g-1]=a*g;i=null}}return A.map(function(A,e){return{color:A.color,stop:Math.max(Math.min(1,B[e]/t),0)}})}function Ee(A,e,t){var r="number"==typeof A?A:(s=e/2,r=(n=t)/2,s=Ue((B=A)[0],e)-s,n=r-Ue(B[1],n),(Math.atan2(n,s)+2*Math.PI)%(2*Math.PI)),B=Math.abs(e*Math.sin(r))+Math.abs(t*Math.cos(r)),n=e/2,s=t/2,e=B/2,t=Math.sin(r-Math.PI/2)*e,e=Math.cos(r-Math.PI/2)*e;return[B,n-e,n+e,s-t,s+t]}function Ie(A,e){return Math.sqrt(A*A+e*e)}function ye(A,e,B,n,s){return[[0,0],[0,e],[A,0],[A,e]].reduce(function(A,e){var t=e[0],r=e[1],r=Ie(B-t,n-r);return(s?r<A.optimumDistance:r>A.optimumDistance)?{optimumCorner:e,optimumDistance:r}:A},{optimumDistance:s?1/0:-1/0,optimumCorner:null}).optimumCorner}var Ke=function(A,e){var t=e.filter($A),r=t[0],B=t[1],n=t[2],e=t[3],t=(17===r.type?Ce(r.number):le(A,r))/(2*Math.PI),A=te(B)?B.number/100:0,r=te(n)?n.number/100:0,B=void 0!==e&&te(e)?Ue(e,1):1;if(0==A)return Fe(255*r,255*r,255*r,1);n=r<=.5?r*(1+A):r+A-r*A,e=2*r-n,A=de(e,n,t+1/3),r=de(e,n,t),t=de(e,n,t-1/3);return Fe(255*A,255*r,255*t,B)},me={hsl:Ke,hsla:Ke,rgb:he,rgba:he},Le={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},be={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(A,e){return e.map(function(A){if(_A(A))switch(A.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},De={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Ke=function(t,A){var r=Ce(180),B=[];return Ae(A).forEach(function(A,e){if(0===e){e=A[0];if(20===e.type&&-1!==["top","left","right","bottom"].indexOf(e.value))return void(r=se(A));if(ne(e))return void(r=(le(t,e)+Ce(270))%Ce(360))}A=He(t,A);B.push(A)}),{angle:r,stops:B,type:1}},ve="closest-side",xe="farthest-side",Me="closest-corner",Se="farthest-corner",Te="ellipse",Ge="contain",he=function(r,A){var B=0,n=3,s=[],o=[];return Ae(A).forEach(function(A,e){var t=!0;0===e?t=A.reduce(function(A,e){if(_A(e))switch(e.value){case"center":return o.push(ge),!1;case"top":case"left":return o.push(ae),!1;case"right":case"bottom":return o.push(we),!1}else if(te(e)||ee(e))return o.push(e),!1;return A},t):1===e&&(t=A.reduce(function(A,e){if(_A(e))switch(e.value){case"circle":return B=0,!1;case Te:return!(B=1);case Ge:case ve:return n=0,!1;case xe:return!(n=1);case Me:return!(n=2);case"cover":case Se:return!(n=3)}else if(ee(e)||te(e))return(n=!Array.isArray(n)?[]:n).push(e),!1;return A},t)),t&&(A=He(r,A),s.push(A))}),{size:n,shape:B,stops:s,position:o,type:2}},Oe=function(A,e){if(22===e.type){var t={url:e.value,type:0};return A.cache.addImage(e.value),t}if(18!==e.type)throw new Error("Unsupported image type "+e.type);t=ke[e.name];if(void 0===t)throw new Error('Attempting to parse an unsupported image function "'+e.name+'"');return t(A,e.values)};var Ve,ke={"linear-gradient":function(t,A){var r=Ce(180),B=[];return Ae(A).forEach(function(A,e){if(0===e){e=A[0];if(20===e.type&&"to"===e.value)return void(r=se(A));if(ne(e))return void(r=le(t,e))}A=He(t,A);B.push(A)}),{angle:r,stops:B,type:1}},"-moz-linear-gradient":Ke,"-ms-linear-gradient":Ke,"-o-linear-gradient":Ke,"-webkit-linear-gradient":Ke,"radial-gradient":function(B,A){var n=0,s=3,o=[],i=[];return Ae(A).forEach(function(A,e){var t,r=!0;0===e&&(t=!1,r=A.reduce(function(A,e){if(t)if(_A(e))switch(e.value){case"center":return i.push(ge),A;case"top":case"left":return i.push(ae),A;case"right":case"bottom":return i.push(we),A}else(te(e)||ee(e))&&i.push(e);else if(_A(e))switch(e.value){case"circle":return n=0,!1;case Te:return!(n=1);case"at":return!(t=!0);case ve:return s=0,!1;case"cover":case xe:return!(s=1);case Ge:case Me:return!(s=2);case Se:return!(s=3)}else if(ee(e)||te(e))return(s=!Array.isArray(s)?[]:s).push(e),!1;return A},r)),r&&(A=He(B,A),o.push(A))}),{size:s,shape:n,stops:o,position:i,type:2}},"-moz-radial-gradient":he,"-ms-radial-gradient":he,"-o-radial-gradient":he,"-webkit-radial-gradient":he,"-webkit-gradient":function(r,A){var e=Ce(180),B=[],n=1;return Ae(A).forEach(function(A,e){var t,A=A[0];if(0===e){if(_A(A)&&"linear"===A.value)return void(n=1);if(_A(A)&&"radial"===A.value)return void(n=2)}18===A.type&&("from"===A.name?(t=ue(r,A.values[0]),B.push({stop:ae,color:t})):"to"===A.name?(t=ue(r,A.values[0]),B.push({stop:we,color:t})):"color-stop"!==A.name||2===(A=A.values.filter($A)).length&&(t=ue(r,A[1]),A=A[0],ZA(A)&&B.push({stop:{type:16,number:100*A.number,flags:A.flags},color:t})))}),1===n?{angle:(e+Ce(180))%Ce(360),stops:B,type:n}:{size:3,shape:0,stops:B,position:[],type:n}}},Re={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(e,A){if(0===A.length)return[];var t=A[0];return 20===t.type&&"none"===t.value?[]:A.filter(function(A){return $A(A)&&!(20===(A=A).type&&"none"===A.value||18===A.type&&!ke[A.name])}).map(function(A){return Oe(e,A)})}},Ne={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(A,e){return e.map(function(A){if(_A(A))switch(A.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},Pe={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(A,e){return Ae(e).map(function(A){return A.filter(te)}).map(re)}},Xe={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(A,e){return Ae(e).map(function(A){return A.filter(_A).map(function(A){return A.value}).join(" ")}).map(Je)}},Je=function(A){switch(A){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;default:return 0}};(he=Ve=Ve||{}).AUTO="auto",he.CONTAIN="contain";function Ye(A,e){return _A(A)&&"normal"===A.value?1.2*e:17===A.type?e*A.number:te(A)?Ue(A,e):e}var We,Ze,_e={name:"background-size",initialValue:"0",prefix:!(he.COVER="cover"),type:1,parse:function(A,e){return Ae(e).map(function(A){return A.filter(qe)})}},qe=function(A){return _A(A)||te(A)},he=function(A){return{name:"border-"+A+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},je=he("top"),ze=he("right"),$e=he("bottom"),At=he("left"),he=function(A){return{name:"border-radius-"+A,initialValue:"0 0",prefix:!1,type:1,parse:function(A,e){return re(e.filter(te))}}},et=he("top-left"),tt=he("top-right"),rt=he("bottom-right"),Bt=he("bottom-left"),he=function(A){return{name:"border-"+A+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(A,e){switch(e){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},nt=he("top"),st=he("right"),ot=he("bottom"),it=he("left"),he=function(A){return{name:"border-"+A+"-width",initialValue:"0",type:0,prefix:!1,parse:function(A,e){return WA(e)?e.number:0}}},Qt=he("top"),ct=he("right"),at=he("bottom"),gt=he("left"),wt={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Ut={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(A,e){return"rtl"!==e?0:1}},lt={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(A,e){return e.filter(_A).reduce(function(A,e){return A|Ct(e.value)},0)}},Ct=function(A){switch(A){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},ut={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(A,e){switch(e){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},Ft={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(A,e){return!(20===e.type&&"normal"===e.value||17!==e.type&&15!==e.type)?e.number:0}},ht={name:"line-break",initialValue:(he=We=We||{}).NORMAL="normal",prefix:!(he.STRICT="strict"),type:2,parse:function(A,e){return"strict"!==e?We.NORMAL:We.STRICT}},dt={name:"line-height",initialValue:"normal",prefix:!1,type:4},ft={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(A,e){return 20===e.type&&"none"===e.value?null:Oe(A,e)}},Ht={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(A,e){return"inside"!==e?1:0}},pt={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(A,e){switch(e){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;default:return-1}}},he=function(A){return{name:"margin-"+A,initialValue:"0",prefix:!1,type:4}},Et=he("top"),It=he("right"),yt=he("bottom"),Kt=he("left"),mt={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(A,e){return e.filter(_A).map(function(A){switch(A.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;default:return 0}})}},Lt={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(A,e){return"break-word"!==e?"normal":"break-word"}},he=function(A){return{name:"padding-"+A,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},bt=he("top"),Dt=he("right"),vt=he("bottom"),xt=he("left"),Mt={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(A,e){switch(e){case"right":return 2;case"center":case"justify":return 1;default:return 0}}},St={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(A,e){switch(e){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},Tt={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(n,A){return 1===A.length&&jA(A[0],"none")?[]:Ae(A).map(function(A){for(var e={color:Le.TRANSPARENT,offsetX:ae,offsetY:ae,blur:ae},t=0,r=0;r<A.length;r++){var B=A[r];ee(B)?(0===t?e.offsetX=B:1===t?e.offsetY=B:e.blur=B,t++):e.color=ue(n,B)}return e})}},Gt={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(A,e){switch(e){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},Ot={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(A,e){if(20===e.type&&"none"===e.value)return null;if(18!==e.type)return null;var t=Vt[e.name];if(void 0===t)throw new Error('Attempting to parse an unsupported transform function "'+e.name+'"');return t(e.values)}},Vt={matrix:function(A){A=A.filter(function(A){return 17===A.type}).map(function(A){return A.number});return 6===A.length?A:null},matrix3d:function(A){var e=A.filter(function(A){return 17===A.type}).map(function(A){return A.number}),t=e[0],r=e[1];e[2],e[3];var B=e[4],n=e[5];e[6],e[7],e[8],e[9],e[10],e[11];var s=e[12],A=e[13];return e[14],e[15],16===e.length?[t,r,B,n,s,A]:null}},he={type:16,number:50,flags:4},kt=[he,he],Rt={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(A,e){e=e.filter(te);return 2!==e.length?kt:[e[0],e[1]]}},Nt={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(A,e){switch(e){case"hidden":return 1;case"collapse":return 2;default:return 0}}};(he=Ze=Ze||{}).NORMAL="normal",he.BREAK_ALL="break-all";function Pt(A,e){return 0!=(A&e)}function Xt(A,e,t){return(A=A&&A[Math.min(e,A.length-1)])?t?A.open:A.close:""}var Jt={name:"word-break",initialValue:"normal",prefix:!(he.KEEP_ALL="keep-all"),type:2,parse:function(A,e){switch(e){case"break-all":return Ze.BREAK_ALL;case"keep-all":return Ze.KEEP_ALL;default:return Ze.NORMAL}}},Yt={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(A,e){if(20===e.type)return{auto:!0,order:0};if(ZA(e))return{auto:!1,order:e.number};throw new Error("Invalid z-index number parsed")}},Wt=function(A,e){if(15===e.type)switch(e.unit.toLowerCase()){case"s":return 1e3*e.number;case"ms":return e.number}throw new Error("Unsupported time type")},Zt={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(A,e){return ZA(e)?e.number:1}},_t={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},qt={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(A,e){return e.filter(_A).map(function(A){switch(A.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(A){return 0!==A})}},jt={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(A,e){var t=[],r=[];return e.forEach(function(A){switch(A.type){case 20:case 0:t.push(A.value);break;case 17:t.push(A.number.toString());break;case 4:r.push(t.join(" ")),t.length=0}}),t.length&&r.push(t.join(" ")),r.map(function(A){return-1===A.indexOf(" ")?A:"'"+A+"'"})}},zt={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},$t={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(A,e){return ZA(e)?e.number:!_A(e)||"bold"!==e.value?400:700}},Ar={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(A,e){return e.filter(_A).map(function(A){return A.value})}},er={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(A,e){switch(e){case"oblique":return"oblique";case"italic":return"italic";default:return"normal"}}},tr={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(A,e){if(0===e.length)return[];var t=e[0];return 20===t.type&&"none"===t.value?[]:e}},rr={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(A,e){if(0===e.length)return null;var t=e[0];if(20===t.type&&"none"===t.value)return null;for(var r=[],B=e.filter(zA),n=0;n<B.length;n++){var s=B[n],o=B[n+1];20===s.type&&(o=o&&ZA(o)?o.number:1,r.push({counter:s.value,increment:o}))}return r}},Br={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(A,e){if(0===e.length)return[];for(var t=[],r=e.filter(zA),B=0;B<r.length;B++){var n=r[B],s=r[B+1];_A(n)&&"none"!==n.value&&(s=s&&ZA(s)?s.number:0,t.push({counter:n.value,reset:s}))}return t}},nr={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(e,A){return A.filter(WA).map(function(A){return Wt(e,A)})}},sr={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(A,e){if(0===e.length)return null;var t=e[0];if(20===t.type&&"none"===t.value)return null;var r=[],B=e.filter(qA);if(B.length%2!=0)return null;for(var n=0;n<B.length;n+=2){var s=B[n].value,o=B[n+1].value;r.push({open:s,close:o})}return r}},or={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(n,A){return 1===A.length&&jA(A[0],"none")?[]:Ae(A).map(function(A){for(var e={color:255,offsetX:ae,offsetY:ae,blur:ae,spread:ae,inset:!1},t=0,r=0;r<A.length;r++){var B=A[r];jA(B,"inset")?e.inset=!0:ee(B)?(0===t?e.offsetX=B:1===t?e.offsetY=B:2===t?e.blur=B:e.spread=B,t++):e.color=ue(n,B)}return e})}},ir={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(A,e){var t=[];return e.filter(_A).forEach(function(A){switch(A.value){case"stroke":t.push(1);break;case"fill":t.push(0);break;case"markers":t.push(2)}}),[0,1,2].forEach(function(A){-1===t.indexOf(A)&&t.push(A)}),t}},Qr={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},cr={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(A,e){return WA(e)?e.number:0}},ar=(gr.prototype.isVisible=function(){return 0<this.display&&0<this.opacity&&0===this.visibility},gr.prototype.isTransparent=function(){return oe(this.backgroundColor)},gr.prototype.isTransformed=function(){return null!==this.transform},gr.prototype.isPositioned=function(){return 0!==this.position},gr.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},gr.prototype.isFloating=function(){return 0!==this.float},gr.prototype.isInlineLevel=function(){return Pt(this.display,4)||Pt(this.display,33554432)||Pt(this.display,268435456)||Pt(this.display,536870912)||Pt(this.display,67108864)||Pt(this.display,134217728)},gr);function gr(A,e){this.animationDuration=lr(A,nr,e.animationDuration),this.backgroundClip=lr(A,be,e.backgroundClip),this.backgroundColor=lr(A,De,e.backgroundColor),this.backgroundImage=lr(A,Re,e.backgroundImage),this.backgroundOrigin=lr(A,Ne,e.backgroundOrigin),this.backgroundPosition=lr(A,Pe,e.backgroundPosition),this.backgroundRepeat=lr(A,Xe,e.backgroundRepeat),this.backgroundSize=lr(A,_e,e.backgroundSize),this.borderTopColor=lr(A,je,e.borderTopColor),this.borderRightColor=lr(A,ze,e.borderRightColor),this.borderBottomColor=lr(A,$e,e.borderBottomColor),this.borderLeftColor=lr(A,At,e.borderLeftColor),this.borderTopLeftRadius=lr(A,et,e.borderTopLeftRadius),this.borderTopRightRadius=lr(A,tt,e.borderTopRightRadius),this.borderBottomRightRadius=lr(A,rt,e.borderBottomRightRadius),this.borderBottomLeftRadius=lr(A,Bt,e.borderBottomLeftRadius),this.borderTopStyle=lr(A,nt,e.borderTopStyle),this.borderRightStyle=lr(A,st,e.borderRightStyle),this.borderBottomStyle=lr(A,ot,e.borderBottomStyle),this.borderLeftStyle=lr(A,it,e.borderLeftStyle),this.borderTopWidth=lr(A,Qt,e.borderTopWidth),this.borderRightWidth=lr(A,ct,e.borderRightWidth),this.borderBottomWidth=lr(A,at,e.borderBottomWidth),this.borderLeftWidth=lr(A,gt,e.borderLeftWidth),this.boxShadow=lr(A,or,e.boxShadow),this.color=lr(A,wt,e.color),this.direction=lr(A,Ut,e.direction),this.display=lr(A,lt,e.display),this.float=lr(A,ut,e.cssFloat),this.fontFamily=lr(A,jt,e.fontFamily),this.fontSize=lr(A,zt,e.fontSize),this.fontStyle=lr(A,er,e.fontStyle),this.fontVariant=lr(A,Ar,e.fontVariant),this.fontWeight=lr(A,$t,e.fontWeight),this.letterSpacing=lr(A,Ft,e.letterSpacing),this.lineBreak=lr(A,ht,e.lineBreak),this.lineHeight=lr(A,dt,e.lineHeight),this.listStyleImage=lr(A,ft,e.listStyleImage),this.listStylePosition=lr(A,Ht,e.listStylePosition),this.listStyleType=lr(A,pt,e.listStyleType),this.marginTop=lr(A,Et,e.marginTop),this.marginRight=lr(A,It,e.marginRight),this.marginBottom=lr(A,yt,e.marginBottom),this.marginLeft=lr(A,Kt,e.marginLeft),this.opacity=lr(A,Zt,e.opacity);var t=lr(A,mt,e.overflow);this.overflowX=t[0],this.overflowY=t[1<t.length?1:0],this.overflowWrap=lr(A,Lt,e.overflowWrap),this.paddingTop=lr(A,bt,e.paddingTop),this.paddingRight=lr(A,Dt,e.paddingRight),this.paddingBottom=lr(A,vt,e.paddingBottom),this.paddingLeft=lr(A,xt,e.paddingLeft),this.paintOrder=lr(A,ir,e.paintOrder),this.position=lr(A,St,e.position),this.textAlign=lr(A,Mt,e.textAlign),this.textDecorationColor=lr(A,_t,null!==(t=e.textDecorationColor)&&void 0!==t?t:e.color),this.textDecorationLine=lr(A,qt,null!==(t=e.textDecorationLine)&&void 0!==t?t:e.textDecoration),this.textShadow=lr(A,Tt,e.textShadow),this.textTransform=lr(A,Gt,e.textTransform),this.transform=lr(A,Ot,e.transform),this.transformOrigin=lr(A,Rt,e.transformOrigin),this.visibility=lr(A,Nt,e.visibility),this.webkitTextStrokeColor=lr(A,Qr,e.webkitTextStrokeColor),this.webkitTextStrokeWidth=lr(A,cr,e.webkitTextStrokeWidth),this.wordBreak=lr(A,Jt,e.wordBreak),this.zIndex=lr(A,Yt,e.zIndex)}for(var wr=function(A,e){this.content=lr(A,tr,e.content),this.quotes=lr(A,sr,e.quotes)},Ur=function(A,e){this.counterIncrement=lr(A,rr,e.counterIncrement),this.counterReset=lr(A,Br,e.counterReset)},lr=function(A,e,t){var r=new PA,t=null!=t?t.toString():e.initialValue;r.write(t);var B=new JA(r.read());switch(e.type){case 2:var n=B.parseComponentValue();return e.parse(A,_A(n)?n.value:e.initialValue);case 0:return e.parse(A,B.parseComponentValue());case 1:return e.parse(A,B.parseComponentValues());case 4:return B.parseComponentValue();case 3:switch(e.format){case"angle":return le(A,B.parseComponentValue());case"color":return ue(A,B.parseComponentValue());case"image":return Oe(A,B.parseComponentValue());case"length":var s=B.parseComponentValue();return ee(s)?s:ae;case"length-percentage":s=B.parseComponentValue();return te(s)?s:ae;case"time":return Wt(A,B.parseComponentValue())}}},Cr=function(A,e){A=function(A){switch(A.getAttribute("data-html2canvas-debug")){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}}(A);return 1===A||e===A},ur=function(A,e){this.context=A,this.textNodes=[],this.elements=[],this.flags=0,Cr(e,3),this.styles=new ar(A,window.getComputedStyle(e,null)),JB(e)&&(this.styles.animationDuration.some(function(A){return 0<A})&&(e.style.animationDuration="0s"),null!==this.styles.transform&&(e.style.transform="none")),this.bounds=f(this.context,e),Cr(e,4)&&(this.flags|=16)},Fr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",hr="undefined"==typeof Uint8Array?[]:new Uint8Array(256),dr=0;dr<Fr.length;dr++)hr[Fr.charCodeAt(dr)]=dr;function fr(A,e,t){return A.slice?A.slice(e,t):new Uint16Array(Array.prototype.slice.call(A,e,t))}var Hr=(pr.prototype.get=function(A){var e;if(0<=A){if(A<55296||56319<A&&A<=65535)return e=this.index[A>>5],this.data[e=(e<<2)+(31&A)];if(A<=65535)return e=this.index[2048+(A-55296>>5)],this.data[e=(e<<2)+(31&A)];if(A<this.highStart)return e=this.index[e=2080+(A>>11)],e=this.index[e+=A>>5&63],this.data[e=(e<<2)+(31&A)];if(A<=1114111)return this.data[this.highValueIndex]}return this.errorValue},pr);function pr(A,e,t,r,B,n){this.initialValue=A,this.errorValue=e,this.highStart=t,this.highValueIndex=r,this.index=B,this.data=n}for(var Er="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ir="undefined"==typeof Uint8Array?[]:new Uint8Array(256),yr=0;yr<Er.length;yr++)Ir[Er.charCodeAt(yr)]=yr;function Kr(A){return kr.get(A)}function mr(A){var t=function(A){for(var e=[],t=0,r=A.length;t<r;){var B,n=A.charCodeAt(t++);55296<=n&&n<=56319&&t<r?56320==(64512&(B=A.charCodeAt(t++)))?e.push(((1023&n)<<10)+(1023&B)+65536):(e.push(n),t--):e.push(n)}return e}(A),r=t.length,B=0,n=0,s=t.map(Kr);return{next:function(){if(r<=B)return{done:!0,value:null};for(var A=Rr;B<r&&(A=function(A,e){var t=e-2,r=A[t],B=A[e-1],e=A[e];if(2===B&&3===e)return Rr;if(2===B||3===B||4===B)return"÷";if(2===e||3===e||4===e)return"÷";if(B===Tr&&-1!==[Tr,Gr,Or,Vr].indexOf(e))return Rr;if(!(B!==Or&&B!==Gr||e!==Gr&&10!==e))return Rr;if((B===Vr||10===B)&&10===e)return Rr;if(13===e||5===e)return Rr;if(7===e)return Rr;if(1===B)return Rr;if(13===B&&14===e){for(;5===r;)r=A[--t];if(14===r)return Rr}if(15===B&&15===e){for(var n=0;15===r;)n++,r=A[--t];if(n%2==0)return Rr}return"÷"}(s,++B))===Rr;);if(A===Rr&&B!==r)return{done:!0,value:null};var e=function(){for(var A=[],e=0;e<arguments.length;e++)A[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,A);var t=A.length;if(!t)return"";for(var r=[],B=-1,n="";++B<t;){var s=A[B];s<=65535?r.push(s):(s-=65536,r.push(55296+(s>>10),s%1024+56320)),(B+1===t||16384<r.length)&&(n+=String.fromCharCode.apply(String,r),r.length=0)}return n}.apply(null,t.slice(n,B));return n=B,{value:e,done:!1}}}}function Lr(A){return 0===A[0]&&255===A[1]&&0===A[2]&&255===A[3]}var br,Dr,vr,xr,Mr,Sr,Tr=8,Gr=9,Or=11,Vr=12,kr=(vr=function(A){var e,t,r,B,n=.75*A.length,s=A.length,o=0;"="===A[A.length-1]&&(n--,"="===A[A.length-2]&&n--);for(var n=new("undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?ArrayBuffer:Array)(n),i=Array.isArray(n)?n:new Uint8Array(n),Q=0;Q<s;Q+=4)e=hr[A.charCodeAt(Q)],t=hr[A.charCodeAt(Q+1)],r=hr[A.charCodeAt(Q+2)],B=hr[A.charCodeAt(Q+3)],i[o++]=e<<2|t>>4,i[o++]=(15&t)<<4|r>>2,i[o++]=(3&r)<<6|63&B;return n}(br="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA="),xr=Array.isArray(vr)?function(A){for(var e=A.length,t=[],r=0;r<e;r+=4)t.push(A[r+3]<<24|A[r+2]<<16|A[r+1]<<8|A[r]);return t}(vr):new Uint32Array(vr),Mr=Array.isArray(vr)?function(A){for(var e=A.length,t=[],r=0;r<e;r+=2)t.push(A[r+1]<<8|A[r]);return t}(vr):new Uint16Array(vr),br=fr(Mr,12,xr[4]/2),Dr=2===xr[5]?fr(Mr,(24+xr[4])/2):(vr=xr,Mr=Math.ceil((24+xr[4])/4),vr.slice?vr.slice(Mr,Dr):new Uint32Array(Array.prototype.slice.call(vr,Mr,Dr))),new Hr(xr[0],xr[1],xr[2],xr[3],br,Dr)),Rr="×",Nr=function(A,e,t,r,B){var n="http://www.w3.org/2000/svg",s=document.createElementNS(n,"svg"),n=document.createElementNS(n,"foreignObject");return s.setAttributeNS(null,"width",A.toString()),s.setAttributeNS(null,"height",e.toString()),n.setAttributeNS(null,"width","100%"),n.setAttributeNS(null,"height","100%"),n.setAttributeNS(null,"x",t.toString()),n.setAttributeNS(null,"y",r.toString()),n.setAttributeNS(null,"externalResourcesRequired","true"),s.appendChild(n),n.appendChild(B),s},Pr=function(r){return new Promise(function(A,e){var t=new Image;t.onload=function(){return A(t)},t.onerror=e,t.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(r))})},Xr={get SUPPORT_RANGE_BOUNDS(){var A=function(A){if(A.createRange){var e=A.createRange();if(e.getBoundingClientRect){var t=A.createElement("boundtest");t.style.height="123px",t.style.display="block",A.body.appendChild(t),e.selectNode(t);e=e.getBoundingClientRect(),e=Math.round(e.height);if(A.body.removeChild(t),123===e)return!0}}return!1}(document);return Object.defineProperty(Xr,"SUPPORT_RANGE_BOUNDS",{value:A}),A},get SUPPORT_WORD_BREAKING(){var A=Xr.SUPPORT_RANGE_BOUNDS&&function(A){var e=A.createElement("boundtest");e.style.width="50px",e.style.display="block",e.style.fontSize="12px",e.style.letterSpacing="0px",e.style.wordSpacing="0px",A.body.appendChild(e);var r=A.createRange();e.innerHTML="function"==typeof"".repeat?"&#128104;".repeat(10):"";var B=e.firstChild,t=Q(B.data).map(function(A){return g(A)}),n=0,s={},t=t.every(function(A,e){r.setStart(B,n),r.setEnd(B,n+A.length);var t=r.getBoundingClientRect();n+=A.length;A=t.x>s.x||t.y>s.y;return s=t,0===e||A});return A.body.removeChild(e),t}(document);return Object.defineProperty(Xr,"SUPPORT_WORD_BREAKING",{value:A}),A},get SUPPORT_SVG_DRAWING(){var A=function(A){var e=new Image,t=A.createElement("canvas"),A=t.getContext("2d");if(!A)return!1;e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{A.drawImage(e,0,0),t.toDataURL()}catch(A){return!1}return!0}(document);return Object.defineProperty(Xr,"SUPPORT_SVG_DRAWING",{value:A}),A},get SUPPORT_FOREIGNOBJECT_DRAWING(){var A="function"==typeof Array.from&&"function"==typeof window.fetch?function(t){var A=t.createElement("canvas"),r=100;A.width=r,A.height=r;var B=A.getContext("2d");if(!B)return Promise.reject(!1);B.fillStyle="rgb(0, 255, 0)",B.fillRect(0,0,r,r);var e=new Image,n=A.toDataURL();e.src=n;e=Nr(r,r,0,0,e);return B.fillStyle="red",B.fillRect(0,0,r,r),Pr(e).then(function(A){B.drawImage(A,0,0);var e=B.getImageData(0,0,r,r).data;B.fillStyle="red",B.fillRect(0,0,r,r);A=t.createElement("div");return A.style.backgroundImage="url("+n+")",A.style.height="100px",Lr(e)?Pr(Nr(r,r,0,0,A)):Promise.reject(!1)}).then(function(A){return B.drawImage(A,0,0),Lr(B.getImageData(0,0,r,r).data)}).catch(function(){return!1})}(document):Promise.resolve(!1);return Object.defineProperty(Xr,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:A}),A},get SUPPORT_CORS_IMAGES(){var A=void 0!==(new Image).crossOrigin;return Object.defineProperty(Xr,"SUPPORT_CORS_IMAGES",{value:A}),A},get SUPPORT_RESPONSE_TYPE(){var A="string"==typeof(new XMLHttpRequest).responseType;return Object.defineProperty(Xr,"SUPPORT_RESPONSE_TYPE",{value:A}),A},get SUPPORT_CORS_XHR(){var A="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Xr,"SUPPORT_CORS_XHR",{value:A}),A},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var A=!("undefined"==typeof Intl||!Intl.Segmenter);return Object.defineProperty(Xr,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:A}),A}},Jr=function(A,e){this.text=A,this.bounds=e},Yr=function(A,e){var t=e.ownerDocument;if(t){var r=t.createElement("html2canvaswrapper");r.appendChild(e.cloneNode(!0));t=e.parentNode;if(t){t.replaceChild(r,e);A=f(A,r);return r.firstChild&&t.replaceChild(r.firstChild,r),A}}return d.EMPTY},Wr=function(A,e,t){var r=A.ownerDocument;if(!r)throw new Error("Node has no owner document");r=r.createRange();return r.setStart(A,e),r.setEnd(A,e+t),r},Zr=function(A){if(Xr.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(e.segment(A)).map(function(A){return A.segment})}return function(A){for(var e,t=mr(A),r=[];!(e=t.next()).done;)e.value&&r.push(e.value.slice());return r}(A)},_r=function(A,e){return 0!==e.letterSpacing?Zr(A):function(A,e){if(Xr.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(t.segment(A)).map(function(A){return A.segment})}return jr(A,e)}(A,e)},qr=[32,160,4961,65792,65793,4153,4241],jr=function(A,e){for(var t,r=wA(A,{lineBreak:e.lineBreak,wordBreak:"break-word"===e.overflowWrap?"break-word":e.wordBreak}),B=[];!(t=r.next()).done;)!function(){var A,e;t.value&&(A=t.value.slice(),A=Q(A),e="",A.forEach(function(A){-1===qr.indexOf(A)?e+=g(A):(e.length&&B.push(e),B.push(g(A)),e="")}),e.length&&B.push(e))}();return B},zr=function(A,e,t){var B,n,s,o,i;this.text=$r(e.data,t.textTransform),this.textBounds=(B=A,A=this.text,s=e,A=_r(A,n=t),o=[],i=0,A.forEach(function(A){var e,t,r;n.textDecorationLine.length||0<A.trim().length?Xr.SUPPORT_RANGE_BOUNDS?1<(r=Wr(s,i,A.length).getClientRects()).length?(e=Zr(A),t=0,e.forEach(function(A){o.push(new Jr(A,d.fromDOMRectList(B,Wr(s,t+i,A.length).getClientRects()))),t+=A.length})):o.push(new Jr(A,d.fromDOMRectList(B,r))):(r=s.splitText(A.length),o.push(new Jr(A,Yr(B,s))),s=r):Xr.SUPPORT_RANGE_BOUNDS||(s=s.splitText(A.length)),i+=A.length}),o)},$r=function(A,e){switch(e){case 1:return A.toLowerCase();case 3:return A.replace(AB,eB);case 2:return A.toUpperCase();default:return A}},AB=/(^|\s|:|-|\(|\))([a-z])/g,eB=function(A,e,t){return 0<A.length?e+t.toUpperCase():A},tB=(A(rB,Sr=ur),rB);function rB(A,e){A=Sr.call(this,A,e)||this;return A.src=e.currentSrc||e.src,A.intrinsicWidth=e.naturalWidth,A.intrinsicHeight=e.naturalHeight,A.context.cache.addImage(A.src),A}var BB,nB=(A(sB,BB=ur),sB);function sB(A,e){A=BB.call(this,A,e)||this;return A.canvas=e,A.intrinsicWidth=e.width,A.intrinsicHeight=e.height,A}var oB,iB=(A(QB,oB=ur),QB);function QB(A,e){var t=oB.call(this,A,e)||this,r=new XMLSerializer,A=f(A,e);return e.setAttribute("width",A.width+"px"),e.setAttribute("height",A.height+"px"),t.svg="data:image/svg+xml,"+encodeURIComponent(r.serializeToString(e)),t.intrinsicWidth=e.width.baseVal.value,t.intrinsicHeight=e.height.baseVal.value,t.context.cache.addImage(t.svg),t}var cB,aB=(A(gB,cB=ur),gB);function gB(A,e){A=cB.call(this,A,e)||this;return A.value=e.value,A}var wB,UB=(A(lB,wB=ur),lB);function lB(A,e){A=wB.call(this,A,e)||this;return A.start=e.start,A.reversed="boolean"==typeof e.reversed&&!0===e.reversed,A}var CB,uB=[{type:15,flags:0,unit:"px",number:3}],FB=[{type:16,flags:0,number:50}],hB="checkbox",dB="radio",fB="password",HB=707406591,pB=(A(EB,CB=ur),EB);function EB(A,e){var t=CB.call(this,A,e)||this;switch(t.type=e.type.toLowerCase(),t.checked=e.checked,t.value=0===(e=(A=e).type===fB?new Array(A.value.length+1).join("•"):A.value).length?A.placeholder||"":e,t.type!==hB&&t.type!==dB||(t.styles.backgroundColor=3739148031,t.styles.borderTopColor=t.styles.borderRightColor=t.styles.borderBottomColor=t.styles.borderLeftColor=2779096575,t.styles.borderTopWidth=t.styles.borderRightWidth=t.styles.borderBottomWidth=t.styles.borderLeftWidth=1,t.styles.borderTopStyle=t.styles.borderRightStyle=t.styles.borderBottomStyle=t.styles.borderLeftStyle=1,t.styles.backgroundClip=[0],t.styles.backgroundOrigin=[0],t.bounds=(e=t.bounds).width>e.height?new d(e.left+(e.width-e.height)/2,e.top,e.height,e.height):e.width<e.height?new d(e.left,e.top+(e.height-e.width)/2,e.width,e.width):e),t.type){case hB:t.styles.borderTopRightRadius=t.styles.borderTopLeftRadius=t.styles.borderBottomRightRadius=t.styles.borderBottomLeftRadius=uB;break;case dB:t.styles.borderTopRightRadius=t.styles.borderTopLeftRadius=t.styles.borderBottomRightRadius=t.styles.borderBottomLeftRadius=FB}return t}var IB,yB=(A(KB,IB=ur),KB);function KB(A,e){A=IB.call(this,A,e)||this,e=e.options[e.selectedIndex||0];return A.value=e&&e.text||"",A}var mB,LB=(A(bB,mB=ur),bB);function bB(A,e){A=mB.call(this,A,e)||this;return A.value=e.value,A}var DB,vB=(A(xB,DB=ur),xB);function xB(A,e){var t,r,B=DB.call(this,A,e)||this;B.src=e.src,B.width=parseInt(e.width,10)||0,B.height=parseInt(e.height,10)||0,B.backgroundColor=B.styles.backgroundColor;try{e.contentWindow&&e.contentWindow.document&&e.contentWindow.document.documentElement&&(B.tree=kB(A,e.contentWindow.document.documentElement),t=e.contentWindow.document.documentElement?fe(A,getComputedStyle(e.contentWindow.document.documentElement).backgroundColor):Le.TRANSPARENT,r=e.contentWindow.document.body?fe(A,getComputedStyle(e.contentWindow.document.body).backgroundColor):Le.TRANSPARENT,B.backgroundColor=oe(t)?oe(r)?B.styles.backgroundColor:r:t)}catch(A){}return B}function MB(A){return"VIDEO"===A.tagName}function SB(A){return"STYLE"===A.tagName}function TB(A){return 0<A.tagName.indexOf("-")}var GB=["OL","UL","MENU"],OB=function(e,A,t,r){for(var B=A.firstChild;B;B=s){var n,s=B.nextSibling;PB(B)&&0<B.data.trim().length?t.textNodes.push(new zr(e,B,t.styles)):XB(B)&&(rn(B)&&B.assignedNodes?B.assignedNodes().forEach(function(A){return OB(e,A,t,r)}):(n=VB(e,B)).styles.isVisible()&&(RB(B,n,r)?n.flags|=4:NB(n.styles)&&(n.flags|=2),-1!==GB.indexOf(B.tagName)&&(n.flags|=8),t.elements.push(n),B.slot,B.shadowRoot?OB(e,B.shadowRoot,n,r):en(B)||qB(B)||tn(B)||OB(e,B,n,r)))}},VB=function(A,e){return new($B(e)?tB:zB(e)?nB:qB(e)?iB:WB(e)?aB:ZB(e)?UB:_B(e)?pB:tn(e)?yB:en(e)?LB:An(e)?vB:ur)(A,e)},kB=function(A,e){var t=VB(A,e);return t.flags|=4,OB(A,e,t,t),t},RB=function(A,e,t){return e.styles.isPositionedWithZIndex()||e.styles.opacity<1||e.styles.isTransformed()||jB(A)&&t.styles.isTransparent()},NB=function(A){return A.isPositioned()||A.isFloating()},PB=function(A){return A.nodeType===Node.TEXT_NODE},XB=function(A){return A.nodeType===Node.ELEMENT_NODE},JB=function(A){return XB(A)&&void 0!==A.style&&!YB(A)},YB=function(A){return"object"==typeof A.className},WB=function(A){return"LI"===A.tagName},ZB=function(A){return"OL"===A.tagName},_B=function(A){return"INPUT"===A.tagName},qB=function(A){return"svg"===A.tagName},jB=function(A){return"BODY"===A.tagName},zB=function(A){return"CANVAS"===A.tagName},$B=function(A){return"IMG"===A.tagName},An=function(A){return"IFRAME"===A.tagName},en=function(A){return"TEXTAREA"===A.tagName},tn=function(A){return"SELECT"===A.tagName},rn=function(A){return"SLOT"===A.tagName},Bn=(nn.prototype.getCounterValue=function(A){A=this.counters[A];return A&&A.length?A[A.length-1]:1},nn.prototype.getCounterValues=function(A){A=this.counters[A];return A||[]},nn.prototype.pop=function(A){var e=this;A.forEach(function(A){return e.counters[A].pop()})},nn.prototype.parse=function(A){var t=this,e=A.counterIncrement,A=A.counterReset,r=!0;null!==e&&e.forEach(function(A){var e=t.counters[A.counter];e&&0!==A.increment&&(r=!1,e.length||e.push(1),e[Math.max(0,e.length-1)]+=A.increment)});var B=[];return r&&A.forEach(function(A){var e=t.counters[A.counter];B.push(A.counter),(e=e||(t.counters[A.counter]=[])).push(A.reset)}),B},nn);function nn(){this.counters={}}function sn(r,A,e,B,t,n){return r<A||e<r?Fn(r,t,0<n.length):B.integers.reduce(function(A,e,t){for(;e<=r;)r-=e,A+=B.values[t];return A},"")+n}function on(A,e,t,r){for(var B="";t||A--,B=r(A)+B,e<=(A/=e)*e;);return B}function Qn(A,e,t,r,B){var n=t-e+1;return(A<0?"-":"")+(on(Math.abs(A),n,r,function(A){return g(Math.floor(A%n)+e)})+B)}function cn(A,e,t){void 0===t&&(t=". ");var r=e.length;return on(Math.abs(A),r,!1,function(A){return e[Math.floor(A%r)]})+t}function an(A,e,t,r,B,n){if(A<-9999||9999<A)return Fn(A,4,0<B.length);var s=Math.abs(A),o=B;if(0===s)return e[0]+o;for(var i=0;0<s&&i<=4;i++){var Q=s%10;0==Q&&Pt(n,1)&&""!==o?o=e[Q]+o:1<Q||1==Q&&0===i||1==Q&&1===i&&Pt(n,2)||1==Q&&1===i&&Pt(n,4)&&100<A||1==Q&&1<i&&Pt(n,8)?o=e[Q]+(0<i?t[i-1]:"")+o:1==Q&&0<i&&(o=t[i-1]+o),s=Math.floor(s/10)}return(A<0?r:"")+o}var gn,wn={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},Un={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["Ք","Փ","Ւ","Ց","Ր","Տ","Վ","Ս","Ռ","Ջ","Պ","Չ","Ո","Շ","Ն","Յ","Մ","Ճ","Ղ","Ձ","Հ","Կ","Ծ","Խ","Լ","Ի","Ժ","Թ","Ը","Է","Զ","Ե","Դ","Գ","Բ","Ա"]},ln={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["י׳","ט׳","ח׳","ז׳","ו׳","ה׳","ד׳","ג׳","ב׳","א׳","ת","ש","ר","ק","צ","פ","ע","ס","נ","מ","ל","כ","יט","יח","יז","טז","טו","י","ט","ח","ז","ו","ה","ד","ג","ב","א"]},Cn={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["ჵ","ჰ","ჯ","ჴ","ხ","ჭ","წ","ძ","ც","ჩ","შ","ყ","ღ","ქ","ფ","ჳ","ტ","ს","რ","ჟ","პ","ო","ჲ","ნ","მ","ლ","კ","ი","თ","ჱ","ზ","ვ","ე","დ","გ","ბ","ა"]},un="마이너스",Fn=function(A,e,t){var r=t?". ":"",B=t?"、":"",n=t?", ":"",s=t?" ":"";switch(e){case 0:return"•"+s;case 1:return"◦"+s;case 2:return"◾"+s;case 5:var o=Qn(A,48,57,!0,r);return o.length<4?"0"+o:o;case 4:return cn(A,"〇一二三四五六七八九",B);case 6:return sn(A,1,3999,wn,3,r).toLowerCase();case 7:return sn(A,1,3999,wn,3,r);case 8:return Qn(A,945,969,!1,r);case 9:return Qn(A,97,122,!1,r);case 10:return Qn(A,65,90,!1,r);case 11:return Qn(A,1632,1641,!0,r);case 12:case 49:return sn(A,1,9999,Un,3,r);case 35:return sn(A,1,9999,Un,3,r).toLowerCase();case 13:return Qn(A,2534,2543,!0,r);case 14:case 30:return Qn(A,6112,6121,!0,r);case 15:return cn(A,"子丑寅卯辰巳午未申酉戌亥",B);case 16:return cn(A,"甲乙丙丁戊己庚辛壬癸",B);case 17:case 48:return an(A,"零一二三四五六七八九","十百千萬","負",B,14);case 47:return an(A,"零壹貳參肆伍陸柒捌玖","拾佰仟萬","負",B,15);case 42:return an(A,"零一二三四五六七八九","十百千萬","负",B,14);case 41:return an(A,"零壹贰叁肆伍陆柒捌玖","拾佰仟萬","负",B,15);case 26:return an(A,"〇一二三四五六七八九","十百千万","マイナス",B,0);case 25:return an(A,"零壱弐参四伍六七八九","拾百千万","マイナス",B,7);case 31:return an(A,"영일이삼사오육칠팔구","십백천만",un,n,7);case 33:return an(A,"零一二三四五六七八九","十百千萬",un,n,0);case 32:return an(A,"零壹貳參四五六七八九","拾百千",un,n,7);case 18:return Qn(A,2406,2415,!0,r);case 20:return sn(A,1,19999,Cn,3,r);case 21:return Qn(A,2790,2799,!0,r);case 22:return Qn(A,2662,2671,!0,r);case 22:return sn(A,1,10999,ln,3,r);case 23:return cn(A,"あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわゐゑをん");case 24:return cn(A,"いろはにほへとちりぬるをわかよたれそつねならむうゐのおくやまけふこえてあさきゆめみしゑひもせす");case 27:return Qn(A,3302,3311,!0,r);case 28:return cn(A,"アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヰヱヲン",B);case 29:return cn(A,"イロハニホヘトチリヌルヲワカヨタレソツネナラムウヰノオクヤマケフコエテアサキユメミシヱヒモセス",B);case 34:return Qn(A,3792,3801,!0,r);case 37:return Qn(A,6160,6169,!0,r);case 38:return Qn(A,4160,4169,!0,r);case 39:return Qn(A,2918,2927,!0,r);case 40:return Qn(A,1776,1785,!0,r);case 43:return Qn(A,3046,3055,!0,r);case 44:return Qn(A,3174,3183,!0,r);case 45:return Qn(A,3664,3673,!0,r);case 46:return Qn(A,3872,3881,!0,r);default:return Qn(A,48,57,!0,r)}},hn="data-html2canvas-ignore",dn=(fn.prototype.toIFrame=function(A,r){var e=this,B=pn(A,r);if(!B.contentWindow)return Promise.reject("Unable to find iframe window");var t=A.defaultView.pageXOffset,n=A.defaultView.pageYOffset,s=B.contentWindow,o=s.document,A=In(B).then(function(){return a(e,void 0,void 0,function(){var e,t;return H(this,function(A){switch(A.label){case 0:return this.scrolledElements.forEach(bn),s&&(s.scrollTo(r.left,r.top),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||s.scrollY===r.top&&s.scrollX===r.left||(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(s.scrollX-r.left,s.scrollY-r.top,0,0))),e=this.options.onclone,void 0===(t=this.clonedReferenceElement)?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:o.fonts&&o.fonts.ready?[4,o.fonts.ready]:[3,2];case 1:A.sent(),A.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,En(o)]:[3,4];case 3:A.sent(),A.label=4;case 4:return"function"==typeof e?[2,Promise.resolve().then(function(){return e(o,t)}).then(function(){return B})]:[2,B]}})})});return o.open(),o.write(mn(document.doctype)+"<html></html>"),Ln(this.referenceElement.ownerDocument,t,n),o.replaceChild(o.adoptNode(this.documentElement),o.documentElement),o.close(),A},fn.prototype.createElementClone=function(A){if(Cr(A,2),zB(A))return this.createCanvasClone(A);if(MB(A))return this.createVideoClone(A);if(SB(A))return this.createStyleClone(A);var e=A.cloneNode(!1);return $B(e)&&($B(A)&&A.currentSrc&&A.currentSrc!==A.src&&(e.src=A.currentSrc,e.srcset=""),"lazy"===e.loading&&(e.loading="eager")),TB(e)?this.createCustomElementClone(e):e},fn.prototype.createCustomElementClone=function(A){var e=document.createElement("html2canvascustomelement");return Kn(A.style,e),e},fn.prototype.createStyleClone=function(A){try{var e=A.sheet;if(e&&e.cssRules){var t=[].slice.call(e.cssRules,0).reduce(function(A,e){return e&&"string"==typeof e.cssText?A+e.cssText:A},""),r=A.cloneNode(!1);return r.textContent=t,r}}catch(A){if(this.context.logger.error("Unable to access cssRules property",A),"SecurityError"!==A.name)throw A}return A.cloneNode(!1)},fn.prototype.createCanvasClone=function(e){var A;if(this.options.inlineImages&&e.ownerDocument){var t=e.ownerDocument.createElement("img");try{return t.src=e.toDataURL(),t}catch(A){this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}t=e.cloneNode(!1);try{t.width=e.width,t.height=e.height;var r,B,n=e.getContext("2d"),s=t.getContext("2d");return s&&(!this.options.allowTaint&&n?s.putImageData(n.getImageData(0,0,e.width,e.height),0,0):(!(r=null!==(A=e.getContext("webgl2"))&&void 0!==A?A:e.getContext("webgl"))||!1===(null==(B=r.getContextAttributes())?void 0:B.preserveDrawingBuffer)&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e),s.drawImage(e,0,0))),t}catch(A){this.context.logger.info("Unable to clone canvas as it is tainted",e)}return t},fn.prototype.createVideoClone=function(e){var A=e.ownerDocument.createElement("canvas");A.width=e.offsetWidth,A.height=e.offsetHeight;var t=A.getContext("2d");try{return t&&(t.drawImage(e,0,0,A.width,A.height),this.options.allowTaint||t.getImageData(0,0,A.width,A.height)),A}catch(A){this.context.logger.info("Unable to clone video as it is tainted",e)}A=e.ownerDocument.createElement("canvas");return A.width=e.offsetWidth,A.height=e.offsetHeight,A},fn.prototype.appendChildNode=function(A,e,t){XB(e)&&("SCRIPT"===e.tagName||e.hasAttribute(hn)||"function"==typeof this.options.ignoreElements&&this.options.ignoreElements(e))||this.options.copyStyles&&XB(e)&&SB(e)||A.appendChild(this.cloneNode(e,t))},fn.prototype.cloneChildNodes=function(A,e,t){for(var r,B=this,n=(A.shadowRoot||A).firstChild;n;n=n.nextSibling)XB(n)&&rn(n)&&"function"==typeof n.assignedNodes?(r=n.assignedNodes()).length&&r.forEach(function(A){return B.appendChildNode(e,A,t)}):this.appendChildNode(e,n,t)},fn.prototype.cloneNode=function(A,e){if(PB(A))return document.createTextNode(A.data);if(!A.ownerDocument)return A.cloneNode(!1);var t=A.ownerDocument.defaultView;if(t&&XB(A)&&(JB(A)||YB(A))){var r=this.createElementClone(A);r.style.transitionProperty="none";var B=t.getComputedStyle(A),n=t.getComputedStyle(A,":before"),s=t.getComputedStyle(A,":after");this.referenceElement===A&&JB(r)&&(this.clonedReferenceElement=r),jB(r)&&Mn(r);t=this.counters.parse(new Ur(this.context,B)),n=this.resolvePseudoContent(A,r,n,gn.BEFORE);TB(A)&&(e=!0),MB(A)||this.cloneChildNodes(A,r,e),n&&r.insertBefore(n,r.firstChild);s=this.resolvePseudoContent(A,r,s,gn.AFTER);return s&&r.appendChild(s),this.counters.pop(t),(B&&(this.options.copyStyles||YB(A))&&!An(A)||e)&&Kn(B,r),0===A.scrollTop&&0===A.scrollLeft||this.scrolledElements.push([r,A.scrollLeft,A.scrollTop]),(en(A)||tn(A))&&(en(r)||tn(r))&&(r.value=A.value),r}return A.cloneNode(!1)},fn.prototype.resolvePseudoContent=function(o,A,e,t){var i=this;if(e){var r=e.content,Q=A.ownerDocument;if(Q&&r&&"none"!==r&&"-moz-alt-content"!==r&&"none"!==e.display){this.counters.parse(new Ur(this.context,e));var c=new wr(this.context,e),a=Q.createElement("html2canvaspseudoelement");Kn(e,a),c.content.forEach(function(A){if(0===A.type)a.appendChild(Q.createTextNode(A.value));else if(22===A.type){var e=Q.createElement("img");e.src=A.value,e.style.opacity="1",a.appendChild(e)}else if(18===A.type){var t,r,B,n,s;"attr"===A.name?(e=A.values.filter(_A)).length&&a.appendChild(Q.createTextNode(o.getAttribute(e[0].value)||"")):"counter"===A.name?(B=(r=A.values.filter($A))[0],r=r[1],B&&_A(B)&&(t=i.counters.getCounterValue(B.value),s=r&&_A(r)?pt.parse(i.context,r.value):3,a.appendChild(Q.createTextNode(Fn(t,s,!1))))):"counters"===A.name&&(B=(t=A.values.filter($A))[0],s=t[1],r=t[2],B&&_A(B)&&(B=i.counters.getCounterValues(B.value),n=r&&_A(r)?pt.parse(i.context,r.value):3,s=s&&0===s.type?s.value:"",s=B.map(function(A){return Fn(A,n,!1)}).join(s),a.appendChild(Q.createTextNode(s))))}else if(20===A.type)switch(A.value){case"open-quote":a.appendChild(Q.createTextNode(Xt(c.quotes,i.quoteDepth++,!0)));break;case"close-quote":a.appendChild(Q.createTextNode(Xt(c.quotes,--i.quoteDepth,!1)));break;default:a.appendChild(Q.createTextNode(A.value))}}),a.className=Dn+" "+vn;t=t===gn.BEFORE?" "+Dn:" "+vn;return YB(A)?A.className.baseValue+=t:A.className+=t,a}}},fn.destroy=function(A){return!!A.parentNode&&(A.parentNode.removeChild(A),!0)},fn);function fn(A,e,t){if(this.context=A,this.options=t,this.scrolledElements=[],this.referenceElement=e,this.counters=new Bn,this.quoteDepth=0,!e.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(e.ownerDocument.documentElement,!1)}(he=gn=gn||{})[he.BEFORE=0]="BEFORE",he[he.AFTER=1]="AFTER";function Hn(e){return new Promise(function(A){!e.complete&&e.src?(e.onload=A,e.onerror=A):A()})}var pn=function(A,e){var t=A.createElement("iframe");return t.className="html2canvas-container",t.style.visibility="hidden",t.style.position="fixed",t.style.left="-10000px",t.style.top="0px",t.style.border="0",t.width=e.width.toString(),t.height=e.height.toString(),t.scrolling="no",t.setAttribute(hn,"true"),A.body.appendChild(t),t},En=function(A){return Promise.all([].slice.call(A.images,0).map(Hn))},In=function(B){return new Promise(function(e,A){var t=B.contentWindow;if(!t)return A("No window assigned for iframe");var r=t.document;t.onload=B.onload=function(){t.onload=B.onload=null;var A=setInterval(function(){0<r.body.childNodes.length&&"complete"===r.readyState&&(clearInterval(A),e(B))},50)}})},yn=["all","d","content"],Kn=function(A,e){for(var t=A.length-1;0<=t;t--){var r=A.item(t);-1===yn.indexOf(r)&&e.style.setProperty(r,A.getPropertyValue(r))}return e},mn=function(A){var e="";return A&&(e+="<!DOCTYPE ",A.name&&(e+=A.name),A.internalSubset&&(e+=A.internalSubset),A.publicId&&(e+='"'+A.publicId+'"'),A.systemId&&(e+='"'+A.systemId+'"'),e+=">"),e},Ln=function(A,e,t){A&&A.defaultView&&(e!==A.defaultView.pageXOffset||t!==A.defaultView.pageYOffset)&&A.defaultView.scrollTo(e,t)},bn=function(A){var e=A[0],t=A[1],A=A[2];e.scrollLeft=t,e.scrollTop=A},Dn="___html2canvas___pseudoelement_before",vn="___html2canvas___pseudoelement_after",xn='{\n    content: "" !important;\n    display: none !important;\n}',Mn=function(A){Sn(A,"."+Dn+":before"+xn+"\n         ."+vn+":after"+xn)},Sn=function(A,e){var t=A.ownerDocument;t&&((t=t.createElement("style")).textContent=e,A.appendChild(t))},Tn=(Gn.getOrigin=function(A){var e=Gn._link;return e?(e.href=A,e.href=e.href,e.protocol+e.hostname+e.port):"about:blank"},Gn.isSameOrigin=function(A){return Gn.getOrigin(A)===Gn._origin},Gn.setContext=function(A){Gn._link=A.document.createElement("a"),Gn._origin=Gn.getOrigin(A.location.href)},Gn._origin="about:blank",Gn);function Gn(){}var On=(Vn.prototype.addImage=function(A){var e=Promise.resolve();return this.has(A)||(Yn(A)||Pn(A))&&(this._cache[A]=this.loadImage(A)).catch(function(){}),e},Vn.prototype.match=function(A){return this._cache[A]},Vn.prototype.loadImage=function(s){return a(this,void 0,void 0,function(){var e,r,t,B,n=this;return H(this,function(A){switch(A.label){case 0:return(e=Tn.isSameOrigin(s),r=!Xn(s)&&!0===this._options.useCORS&&Xr.SUPPORT_CORS_IMAGES&&!e,t=!Xn(s)&&!e&&!Yn(s)&&"string"==typeof this._options.proxy&&Xr.SUPPORT_CORS_XHR&&!r,e||!1!==this._options.allowTaint||Xn(s)||Yn(s)||t||r)?(B=s,t?[4,this.proxy(B)]:[3,2]):[2];case 1:B=A.sent(),A.label=2;case 2:return this.context.logger.debug("Added image "+s.substring(0,256)),[4,new Promise(function(A,e){var t=new Image;t.onload=function(){return A(t)},t.onerror=e,(Jn(B)||r)&&(t.crossOrigin="anonymous"),t.src=B,!0===t.complete&&setTimeout(function(){return A(t)},500),0<n._options.imageTimeout&&setTimeout(function(){return e("Timed out ("+n._options.imageTimeout+"ms) loading image")},n._options.imageTimeout)})];case 3:return[2,A.sent()]}})})},Vn.prototype.has=function(A){return void 0!==this._cache[A]},Vn.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},Vn.prototype.proxy=function(s){var o=this,i=this._options.proxy;if(!i)throw new Error("No proxy defined");var Q=s.substring(0,256);return new Promise(function(e,t){var r=Xr.SUPPORT_RESPONSE_TYPE?"blob":"text",B=new XMLHttpRequest;B.onload=function(){var A;200===B.status?"text"==r?e(B.response):((A=new FileReader).addEventListener("load",function(){return e(A.result)},!1),A.addEventListener("error",function(A){return t(A)},!1),A.readAsDataURL(B.response)):t("Failed to proxy resource "+Q+" with status code "+B.status)},B.onerror=t;var A,n=-1<i.indexOf("?")?"&":"?";B.open("GET",i+n+"url="+encodeURIComponent(s)+"&responseType="+r),"text"!=r&&B instanceof XMLHttpRequest&&(B.responseType=r),o._options.imageTimeout&&(A=o._options.imageTimeout,B.timeout=A,B.ontimeout=function(){return t("Timed out ("+A+"ms) proxying "+Q)}),B.send()})},Vn);function Vn(A,e){this.context=A,this._options=e,this._cache={}}var kn=/^data:image\/svg\+xml/i,Rn=/^data:image\/.*;base64,/i,Nn=/^data:image\/.*/i,Pn=function(A){return Xr.SUPPORT_SVG_DRAWING||!Wn(A)},Xn=function(A){return Nn.test(A)},Jn=function(A){return Rn.test(A)},Yn=function(A){return"blob"===A.substr(0,4)},Wn=function(A){return"svg"===A.substr(-3).toLowerCase()||kn.test(A)},Zn=(_n.prototype.add=function(A,e){return new _n(this.x+A,this.y+e)},_n);function _n(A,e){this.type=0,this.x=A,this.y=e}function qn(A,e,t){return new Zn(A.x+(e.x-A.x)*t,A.y+(e.y-A.y)*t)}var jn=(zn.prototype.subdivide=function(A,e){var t=qn(this.start,this.startControl,A),r=qn(this.startControl,this.endControl,A),B=qn(this.endControl,this.end,A),n=qn(t,r,A),r=qn(r,B,A),A=qn(n,r,A);return e?new zn(this.start,t,n,A):new zn(A,r,B,this.end)},zn.prototype.add=function(A,e){return new zn(this.start.add(A,e),this.startControl.add(A,e),this.endControl.add(A,e),this.end.add(A,e))},zn.prototype.reverse=function(){return new zn(this.end,this.endControl,this.startControl,this.start)},zn);function zn(A,e,t,r){this.type=1,this.start=A,this.startControl=e,this.endControl=t,this.end=r}function $n(A){return 1===A.type}var As,es=function(A){var e=A.styles,t=A.bounds,r=(C=Be(e.borderTopLeftRadius,t.width,t.height))[0],B=C[1],n=(u=Be(e.borderTopRightRadius,t.width,t.height))[0],s=u[1],o=(F=Be(e.borderBottomRightRadius,t.width,t.height))[0],i=F[1],Q=(h=Be(e.borderBottomLeftRadius,t.width,t.height))[0],c=h[1];(d=[]).push((r+n)/t.width),d.push((Q+o)/t.width),d.push((B+c)/t.height),d.push((s+i)/t.height),1<(f=Math.max.apply(Math,d))&&(r/=f,B/=f,n/=f,s/=f,o/=f,i/=f,Q/=f,c/=f);var a=t.width-n,g=t.height-i,w=t.width-o,U=t.height-c,l=e.borderTopWidth,C=e.borderRightWidth,u=e.borderBottomWidth,F=e.borderLeftWidth,h=Ue(e.paddingTop,A.bounds.width),d=Ue(e.paddingRight,A.bounds.width),f=Ue(e.paddingBottom,A.bounds.width),A=Ue(e.paddingLeft,A.bounds.width);this.topLeftBorderDoubleOuterBox=0<r||0<B?ss(t.left+F/3,t.top+l/3,r-F/3,B-l/3,As.TOP_LEFT):new Zn(t.left+F/3,t.top+l/3),this.topRightBorderDoubleOuterBox=0<r||0<B?ss(t.left+a,t.top+l/3,n-C/3,s-l/3,As.TOP_RIGHT):new Zn(t.left+t.width-C/3,t.top+l/3),this.bottomRightBorderDoubleOuterBox=0<o||0<i?ss(t.left+w,t.top+g,o-C/3,i-u/3,As.BOTTOM_RIGHT):new Zn(t.left+t.width-C/3,t.top+t.height-u/3),this.bottomLeftBorderDoubleOuterBox=0<Q||0<c?ss(t.left+F/3,t.top+U,Q-F/3,c-u/3,As.BOTTOM_LEFT):new Zn(t.left+F/3,t.top+t.height-u/3),this.topLeftBorderDoubleInnerBox=0<r||0<B?ss(t.left+2*F/3,t.top+2*l/3,r-2*F/3,B-2*l/3,As.TOP_LEFT):new Zn(t.left+2*F/3,t.top+2*l/3),this.topRightBorderDoubleInnerBox=0<r||0<B?ss(t.left+a,t.top+2*l/3,n-2*C/3,s-2*l/3,As.TOP_RIGHT):new Zn(t.left+t.width-2*C/3,t.top+2*l/3),this.bottomRightBorderDoubleInnerBox=0<o||0<i?ss(t.left+w,t.top+g,o-2*C/3,i-2*u/3,As.BOTTOM_RIGHT):new Zn(t.left+t.width-2*C/3,t.top+t.height-2*u/3),this.bottomLeftBorderDoubleInnerBox=0<Q||0<c?ss(t.left+2*F/3,t.top+U,Q-2*F/3,c-2*u/3,As.BOTTOM_LEFT):new Zn(t.left+2*F/3,t.top+t.height-2*u/3),this.topLeftBorderStroke=0<r||0<B?ss(t.left+F/2,t.top+l/2,r-F/2,B-l/2,As.TOP_LEFT):new Zn(t.left+F/2,t.top+l/2),this.topRightBorderStroke=0<r||0<B?ss(t.left+a,t.top+l/2,n-C/2,s-l/2,As.TOP_RIGHT):new Zn(t.left+t.width-C/2,t.top+l/2),this.bottomRightBorderStroke=0<o||0<i?ss(t.left+w,t.top+g,o-C/2,i-u/2,As.BOTTOM_RIGHT):new Zn(t.left+t.width-C/2,t.top+t.height-u/2),this.bottomLeftBorderStroke=0<Q||0<c?ss(t.left+F/2,t.top+U,Q-F/2,c-u/2,As.BOTTOM_LEFT):new Zn(t.left+F/2,t.top+t.height-u/2),this.topLeftBorderBox=0<r||0<B?ss(t.left,t.top,r,B,As.TOP_LEFT):new Zn(t.left,t.top),this.topRightBorderBox=0<n||0<s?ss(t.left+a,t.top,n,s,As.TOP_RIGHT):new Zn(t.left+t.width,t.top),this.bottomRightBorderBox=0<o||0<i?ss(t.left+w,t.top+g,o,i,As.BOTTOM_RIGHT):new Zn(t.left+t.width,t.top+t.height),this.bottomLeftBorderBox=0<Q||0<c?ss(t.left,t.top+U,Q,c,As.BOTTOM_LEFT):new Zn(t.left,t.top+t.height),this.topLeftPaddingBox=0<r||0<B?ss(t.left+F,t.top+l,Math.max(0,r-F),Math.max(0,B-l),As.TOP_LEFT):new Zn(t.left+F,t.top+l),this.topRightPaddingBox=0<n||0<s?ss(t.left+Math.min(a,t.width-C),t.top+l,a>t.width+C?0:Math.max(0,n-C),Math.max(0,s-l),As.TOP_RIGHT):new Zn(t.left+t.width-C,t.top+l),this.bottomRightPaddingBox=0<o||0<i?ss(t.left+Math.min(w,t.width-F),t.top+Math.min(g,t.height-u),Math.max(0,o-C),Math.max(0,i-u),As.BOTTOM_RIGHT):new Zn(t.left+t.width-C,t.top+t.height-u),this.bottomLeftPaddingBox=0<Q||0<c?ss(t.left+F,t.top+Math.min(U,t.height-u),Math.max(0,Q-F),Math.max(0,c-u),As.BOTTOM_LEFT):new Zn(t.left+F,t.top+t.height-u),this.topLeftContentBox=0<r||0<B?ss(t.left+F+A,t.top+l+h,Math.max(0,r-(F+A)),Math.max(0,B-(l+h)),As.TOP_LEFT):new Zn(t.left+F+A,t.top+l+h),this.topRightContentBox=0<n||0<s?ss(t.left+Math.min(a,t.width+F+A),t.top+l+h,a>t.width+F+A?0:n-F+A,s-(l+h),As.TOP_RIGHT):new Zn(t.left+t.width-(C+d),t.top+l+h),this.bottomRightContentBox=0<o||0<i?ss(t.left+Math.min(w,t.width-(F+A)),t.top+Math.min(g,t.height+l+h),Math.max(0,o-(C+d)),i-(u+f),As.BOTTOM_RIGHT):new Zn(t.left+t.width-(C+d),t.top+t.height-(u+f)),this.bottomLeftContentBox=0<Q||0<c?ss(t.left+F+A,t.top+U,Math.max(0,Q-(F+A)),c-(u+f),As.BOTTOM_LEFT):new Zn(t.left+F+A,t.top+t.height-(u+f))};(he=As=As||{})[he.TOP_LEFT=0]="TOP_LEFT",he[he.TOP_RIGHT=1]="TOP_RIGHT",he[he.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",he[he.BOTTOM_LEFT=3]="BOTTOM_LEFT";function ts(A){return[A.topLeftBorderBox,A.topRightBorderBox,A.bottomRightBorderBox,A.bottomLeftBorderBox]}function rs(A){return[A.topLeftPaddingBox,A.topRightPaddingBox,A.bottomRightPaddingBox,A.bottomLeftPaddingBox]}function Bs(A){return 1===A.type}function ns(A,t){return A.length===t.length&&A.some(function(A,e){return A===t[e]})}var ss=function(A,e,t,r,B){var n=(Math.sqrt(2)-1)/3*4,s=t*n,o=r*n,i=A+t,Q=e+r;switch(B){case As.TOP_LEFT:return new jn(new Zn(A,Q),new Zn(A,Q-o),new Zn(i-s,e),new Zn(i,e));case As.TOP_RIGHT:return new jn(new Zn(A,e),new Zn(A+s,e),new Zn(i,Q-o),new Zn(i,Q));case As.BOTTOM_RIGHT:return new jn(new Zn(i,e),new Zn(i,e+o),new Zn(A+s,Q),new Zn(A,Q));default:As.BOTTOM_LEFT;return new jn(new Zn(i,Q),new Zn(i-s,Q),new Zn(A,e+o),new Zn(A,e))}},os=function(A,e,t){this.offsetX=A,this.offsetY=e,this.matrix=t,this.type=0,this.target=6},is=function(A,e){this.path=A,this.target=e,this.type=1},Qs=function(A){this.opacity=A,this.type=2,this.target=6},cs=function(A){this.element=A,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]},as=(gs.prototype.getEffects=function(e){for(var A=-1===[2,3].indexOf(this.container.styles.position),t=this.parent,r=this.effects.slice(0);t;){var B,n,s=t.effects.filter(function(A){return!Bs(A)});A||0!==t.container.styles.position||!t.parent?(r.unshift.apply(r,s),A=-1===[2,3].indexOf(t.container.styles.position),0!==t.container.styles.overflowX&&(B=ts(t.curves),n=rs(t.curves),ns(B,n)||r.unshift(new is(n,6)))):r.unshift.apply(r,s),t=t.parent}return r.filter(function(A){return Pt(A.target,e)})},gs);function gs(A,e){var t,r;this.container=A,this.parent=e,this.effects=[],this.curves=new es(this.container),this.container.styles.opacity<1&&this.effects.push(new Qs(this.container.styles.opacity)),null!==this.container.styles.transform&&(e=this.container.bounds.left+this.container.styles.transformOrigin[0].number,t=this.container.bounds.top+this.container.styles.transformOrigin[1].number,r=this.container.styles.transform,this.effects.push(new os(e,t,r))),0!==this.container.styles.overflowX&&(t=ts(this.curves),r=rs(this.curves),ns(t,r)?this.effects.push(new is(t,6)):(this.effects.push(new is(t,2)),this.effects.push(new is(r,4))))}function ws(A,e){switch(e){case 0:return Hs(A.topLeftBorderBox,A.topLeftPaddingBox,A.topRightBorderBox,A.topRightPaddingBox);case 1:return Hs(A.topRightBorderBox,A.topRightPaddingBox,A.bottomRightBorderBox,A.bottomRightPaddingBox);case 2:return Hs(A.bottomRightBorderBox,A.bottomRightPaddingBox,A.bottomLeftBorderBox,A.bottomLeftPaddingBox);default:return Hs(A.bottomLeftBorderBox,A.bottomLeftPaddingBox,A.topLeftBorderBox,A.topLeftPaddingBox)}}function Us(A){var e=A.bounds,A=A.styles;return e.add(A.borderLeftWidth,A.borderTopWidth,-(A.borderRightWidth+A.borderLeftWidth),-(A.borderTopWidth+A.borderBottomWidth))}function ls(A){var e=A.styles,t=A.bounds,r=Ue(e.paddingLeft,t.width),B=Ue(e.paddingRight,t.width),n=Ue(e.paddingTop,t.width),A=Ue(e.paddingBottom,t.width);return t.add(r+e.borderLeftWidth,n+e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth+r+B),-(e.borderTopWidth+e.borderBottomWidth+n+A))}function Cs(A,e,t){var r=(B=Es(A.styles.backgroundOrigin,e),n=A,0===B?n.bounds:(2===B?ls:Us)(n)),B=(s=Es(A.styles.backgroundClip,e),o=A,0===s?o.bounds:(2===s?ls:Us)(o)),n=ps(Es(A.styles.backgroundSize,e),t,r),s=n[0],o=n[1],t=Be(Es(A.styles.backgroundPosition,e),r.width-s,r.height-o);return[Is(Es(A.styles.backgroundRepeat,e),t,n,r,B),Math.round(r.left+t[0]),Math.round(r.top+t[1]),s,o]}function us(A){return _A(A)&&A.value===Ve.AUTO}function Fs(A){return"number"==typeof A}var hs=function(Q,c,a,g){Q.container.elements.forEach(function(A){var e=Pt(A.flags,4),t=Pt(A.flags,2),r=new as(A,Q);Pt(A.styles.display,2048)&&g.push(r);var B,n,s,o,i=Pt(A.flags,8)?[]:g;e||t?(B=e||A.styles.isPositioned()?a:c,t=new cs(r),A.styles.isPositioned()||A.styles.opacity<1||A.styles.isTransformed()?(n=A.styles.zIndex.order)<0?(s=0,B.negativeZIndex.some(function(A,e){return n>A.element.container.styles.zIndex.order?(s=e,!1):0<s}),B.negativeZIndex.splice(s,0,t)):0<n?(o=0,B.positiveZIndex.some(function(A,e){return n>=A.element.container.styles.zIndex.order?(o=e+1,!1):0<o}),B.positiveZIndex.splice(o,0,t)):B.zeroOrAutoZIndexOrTransformedOrOpacity.push(t):(A.styles.isFloating()?B.nonPositionedFloats:B.nonPositionedInlineLevel).push(t),hs(r,t,e?t:a,i)):((A.styles.isInlineLevel()?c.inlineLevel:c.nonInlineLevel).push(r),hs(r,c,a,i)),Pt(A.flags,8)&&ds(A,i)})},ds=function(A,e){for(var t=A instanceof UB?A.start:1,r=A instanceof UB&&A.reversed,B=0;B<e.length;B++){var n=e[B];n.container instanceof aB&&"number"==typeof n.container.value&&0!==n.container.value&&(t=n.container.value),n.listValue=Fn(t,n.container.styles.listStyleType,!0),t+=r?-1:1}},fs=function(A,e){var t=[];return $n(A)?t.push(A.subdivide(.5,!1)):t.push(A),$n(e)?t.push(e.subdivide(.5,!0)):t.push(e),t},Hs=function(A,e,t,r){var B=[];return $n(A)?B.push(A.subdivide(.5,!1)):B.push(A),$n(t)?B.push(t.subdivide(.5,!0)):B.push(t),$n(r)?B.push(r.subdivide(.5,!0).reverse()):B.push(r),$n(e)?B.push(e.subdivide(.5,!1).reverse()):B.push(e),B},ps=function(A,e,t){var r=e[0],B=e[1],n=e[2],s=A[0],o=A[1];if(!s)return[0,0];if(te(s)&&o&&te(o))return[Ue(s,t.width),Ue(o,t.height)];var i=Fs(n);if(_A(s)&&(s.value===Ve.CONTAIN||s.value===Ve.COVER))return Fs(n)?t.width/t.height<n!=(s.value===Ve.COVER)?[t.width,t.width/n]:[t.height*n,t.height]:[t.width,t.height];var Q=Fs(r),e=Fs(B),A=Q||e;if(us(s)&&(!o||us(o)))return Q&&e?[r,B]:i||A?A&&i?[Q?r:B*n,e?B:r/n]:[Q?r:t.width,e?B:t.height]:[t.width,t.height];if(i){var c=0,a=0;return te(s)?c=Ue(s,t.width):te(o)&&(a=Ue(o,t.height)),us(s)?c=a*n:o&&!us(o)||(a=c/n),[c,a]}c=null,a=null;if(te(s)?c=Ue(s,t.width):o&&te(o)&&(a=Ue(o,t.height)),null!==(c=null!==(a=null!==c&&(!o||us(o))?Q&&e?c/r*B:t.height:a)&&us(s)?Q&&e?a/B*r:t.width:c)&&null!==a)return[c,a];throw new Error("Unable to calculate background-size for element")},Es=function(A,e){e=A[e];return void 0===e?A[0]:e},Is=function(A,e,t,r,B){var n=e[0],s=e[1],o=t[0],i=t[1];switch(A){case 2:return[new Zn(Math.round(r.left),Math.round(r.top+s)),new Zn(Math.round(r.left+r.width),Math.round(r.top+s)),new Zn(Math.round(r.left+r.width),Math.round(i+r.top+s)),new Zn(Math.round(r.left),Math.round(i+r.top+s))];case 3:return[new Zn(Math.round(r.left+n),Math.round(r.top)),new Zn(Math.round(r.left+n+o),Math.round(r.top)),new Zn(Math.round(r.left+n+o),Math.round(r.height+r.top)),new Zn(Math.round(r.left+n),Math.round(r.height+r.top))];case 1:return[new Zn(Math.round(r.left+n),Math.round(r.top+s)),new Zn(Math.round(r.left+n+o),Math.round(r.top+s)),new Zn(Math.round(r.left+n+o),Math.round(r.top+s+i)),new Zn(Math.round(r.left+n),Math.round(r.top+s+i))];default:return[new Zn(Math.round(B.left),Math.round(B.top)),new Zn(Math.round(B.left+B.width),Math.round(B.top)),new Zn(Math.round(B.left+B.width),Math.round(B.height+B.top)),new Zn(Math.round(B.left),Math.round(B.height+B.top))]}},ys="Hidden Text",Ks=(ms.prototype.parseMetrics=function(A,e){var t=this._document.createElement("div"),r=this._document.createElement("img"),B=this._document.createElement("span"),n=this._document.body;t.style.visibility="hidden",t.style.fontFamily=A,t.style.fontSize=e,t.style.margin="0",t.style.padding="0",t.style.whiteSpace="nowrap",n.appendChild(t),r.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",r.width=1,r.height=1,r.style.margin="0",r.style.padding="0",r.style.verticalAlign="baseline",B.style.fontFamily=A,B.style.fontSize=e,B.style.margin="0",B.style.padding="0",B.appendChild(this._document.createTextNode(ys)),t.appendChild(B),t.appendChild(r);e=r.offsetTop-B.offsetTop+2;t.removeChild(B),t.appendChild(this._document.createTextNode(ys)),t.style.lineHeight="normal",r.style.verticalAlign="super";r=r.offsetTop-t.offsetTop+2;return n.removeChild(t),{baseline:e,middle:r}},ms.prototype.getMetrics=function(A,e){var t=A+" "+e;return void 0===this._data[t]&&(this._data[t]=this.parseMetrics(A,e)),this._data[t]},ms);function ms(A){this._data={},this._document=A}var Ls,he=function(A,e){this.context=A,this.options=e},bs=(A(Ds,Ls=he),Ds.prototype.applyEffects=function(A){for(var e=this;this._activeEffects.length;)this.popEffect();A.forEach(function(A){return e.applyEffect(A)})},Ds.prototype.applyEffect=function(A){this.ctx.save(),2===A.type&&(this.ctx.globalAlpha=A.opacity),0===A.type&&(this.ctx.translate(A.offsetX,A.offsetY),this.ctx.transform(A.matrix[0],A.matrix[1],A.matrix[2],A.matrix[3],A.matrix[4],A.matrix[5]),this.ctx.translate(-A.offsetX,-A.offsetY)),Bs(A)&&(this.path(A.path),this.ctx.clip()),this._activeEffects.push(A)},Ds.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},Ds.prototype.renderStack=function(e){return a(this,void 0,void 0,function(){return H(this,function(A){switch(A.label){case 0:return e.element.container.styles.isVisible()?[4,this.renderStackContent(e)]:[3,2];case 1:A.sent(),A.label=2;case 2:return[2]}})})},Ds.prototype.renderNode=function(e){return a(this,void 0,void 0,function(){return H(this,function(A){switch(A.label){case 0:return Pt(e.container.flags,16),e.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(e)]:[3,3];case 1:return A.sent(),[4,this.renderNodeContent(e)];case 2:A.sent(),A.label=3;case 3:return[2]}})})},Ds.prototype.renderTextWithLetterSpacing=function(t,A,r){var B=this;0===A?this.ctx.fillText(t.text,t.bounds.left,t.bounds.top+r):Zr(t.text).reduce(function(A,e){return B.ctx.fillText(e,A,t.bounds.top+r),A+B.ctx.measureText(e).width},t.bounds.left)},Ds.prototype.createFontStyle=function(A){var e=A.fontVariant.filter(function(A){return"normal"===A||"small-caps"===A}).join(""),t=Gs(A.fontFamily).join(", "),r=WA(A.fontSize)?""+A.fontSize.number+A.fontSize.unit:A.fontSize.number+"px";return[[A.fontStyle,e,A.fontWeight,r,t].join(" "),t,r]},Ds.prototype.renderTextNode=function(i,Q){return a(this,void 0,void 0,function(){var e,t,r,B,n,s,o=this;return H(this,function(A){return r=this.createFontStyle(Q),e=r[0],t=r[1],r=r[2],this.ctx.font=e,this.ctx.direction=1===Q.direction?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",r=this.fontMetrics.getMetrics(t,r),B=r.baseline,n=r.middle,s=Q.paintOrder,i.textBounds.forEach(function(t){s.forEach(function(A){switch(A){case 0:o.ctx.fillStyle=ie(Q.color),o.renderTextWithLetterSpacing(t,Q.letterSpacing,B);var e=Q.textShadow;e.length&&t.text.trim().length&&(e.slice(0).reverse().forEach(function(A){o.ctx.shadowColor=ie(A.color),o.ctx.shadowOffsetX=A.offsetX.number*o.options.scale,o.ctx.shadowOffsetY=A.offsetY.number*o.options.scale,o.ctx.shadowBlur=A.blur.number,o.renderTextWithLetterSpacing(t,Q.letterSpacing,B)}),o.ctx.shadowColor="",o.ctx.shadowOffsetX=0,o.ctx.shadowOffsetY=0,o.ctx.shadowBlur=0),Q.textDecorationLine.length&&(o.ctx.fillStyle=ie(Q.textDecorationColor||Q.color),Q.textDecorationLine.forEach(function(A){switch(A){case 1:o.ctx.fillRect(t.bounds.left,Math.round(t.bounds.top+B),t.bounds.width,1);break;case 2:o.ctx.fillRect(t.bounds.left,Math.round(t.bounds.top),t.bounds.width,1);break;case 3:o.ctx.fillRect(t.bounds.left,Math.ceil(t.bounds.top+n),t.bounds.width,1)}}));break;case 1:Q.webkitTextStrokeWidth&&t.text.trim().length&&(o.ctx.strokeStyle=ie(Q.webkitTextStrokeColor),o.ctx.lineWidth=Q.webkitTextStrokeWidth,o.ctx.lineJoin=window.chrome?"miter":"round",o.ctx.strokeText(t.text,t.bounds.left,t.bounds.top+B)),o.ctx.strokeStyle="",o.ctx.lineWidth=0,o.ctx.lineJoin="miter"}})}),[2]})})},Ds.prototype.renderReplacedElement=function(A,e,t){var r;t&&0<A.intrinsicWidth&&0<A.intrinsicHeight&&(r=ls(A),e=rs(e),this.path(e),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(t,0,0,A.intrinsicWidth,A.intrinsicHeight,r.left,r.top,r.width,r.height),this.ctx.restore())},Ds.prototype.renderNodeContent=function(w){return a(this,void 0,void 0,function(){var e,t,r,B,n,s,o,i,Q,c,a,g;return H(this,function(A){switch(A.label){case 0:this.applyEffects(w.getEffects(4)),e=w.container,t=w.curves,r=e.styles,B=0,n=e.textNodes,A.label=1;case 1:return B<n.length?(s=n[B],[4,this.renderTextNode(s,r)]):[3,4];case 2:A.sent(),A.label=3;case 3:return B++,[3,1];case 4:if(!(e instanceof tB))return[3,8];A.label=5;case 5:return A.trys.push([5,7,,8]),[4,this.context.cache.match(e.src)];case 6:return Q=A.sent(),this.renderReplacedElement(e,t,Q),[3,8];case 7:return A.sent(),this.context.logger.error("Error loading image "+e.src),[3,8];case 8:if(e instanceof nB&&this.renderReplacedElement(e,t,e.canvas),!(e instanceof iB))return[3,12];A.label=9;case 9:return A.trys.push([9,11,,12]),[4,this.context.cache.match(e.svg)];case 10:return Q=A.sent(),this.renderReplacedElement(e,t,Q),[3,12];case 11:return A.sent(),this.context.logger.error("Error loading svg "+e.svg.substring(0,255)),[3,12];case 12:return e instanceof vB&&e.tree?[4,new Ds(this.context,{scale:this.options.scale,backgroundColor:e.backgroundColor,x:0,y:0,width:e.width,height:e.height}).render(e.tree)]:[3,14];case 13:s=A.sent(),e.width&&e.height&&this.ctx.drawImage(s,0,0,e.width,e.height,e.bounds.left,e.bounds.top,e.bounds.width,e.bounds.height),A.label=14;case 14:if(e instanceof pB&&(i=Math.min(e.bounds.width,e.bounds.height),e.type===hB?e.checked&&(this.ctx.save(),this.path([new Zn(e.bounds.left+.39363*i,e.bounds.top+.79*i),new Zn(e.bounds.left+.16*i,e.bounds.top+.5549*i),new Zn(e.bounds.left+.27347*i,e.bounds.top+.44071*i),new Zn(e.bounds.left+.39694*i,e.bounds.top+.5649*i),new Zn(e.bounds.left+.72983*i,e.bounds.top+.23*i),new Zn(e.bounds.left+.84*i,e.bounds.top+.34085*i),new Zn(e.bounds.left+.39363*i,e.bounds.top+.79*i)]),this.ctx.fillStyle=ie(HB),this.ctx.fill(),this.ctx.restore()):e.type===dB&&e.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(e.bounds.left+i/2,e.bounds.top+i/2,i/4,0,2*Math.PI,!0),this.ctx.fillStyle=ie(HB),this.ctx.fill(),this.ctx.restore())),xs(e)&&e.value.length){switch(c=this.createFontStyle(r),a=c[0],i=c[1],c=this.fontMetrics.getMetrics(a,i).baseline,this.ctx.font=a,this.ctx.fillStyle=ie(r.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=Ss(e.styles.textAlign),g=ls(e),o=0,e.styles.textAlign){case 1:o+=g.width/2;break;case 2:o+=g.width}i=g.add(o,0,0,-g.height/2+1),this.ctx.save(),this.path([new Zn(g.left,g.top),new Zn(g.left+g.width,g.top),new Zn(g.left+g.width,g.top+g.height),new Zn(g.left,g.top+g.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Jr(e.value,i),r.letterSpacing,c),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!Pt(e.styles.display,2048))return[3,20];if(null===e.styles.listStyleImage)return[3,19];if(0!==(c=e.styles.listStyleImage).type)return[3,18];Q=void 0,c=c.url,A.label=15;case 15:return A.trys.push([15,17,,18]),[4,this.context.cache.match(c)];case 16:return Q=A.sent(),this.ctx.drawImage(Q,e.bounds.left-(Q.width+10),e.bounds.top),[3,18];case 17:return A.sent(),this.context.logger.error("Error loading list-style-image "+c),[3,18];case 18:return[3,20];case 19:w.listValue&&-1!==e.styles.listStyleType&&(a=this.createFontStyle(r)[0],this.ctx.font=a,this.ctx.fillStyle=ie(r.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",g=new d(e.bounds.left,e.bounds.top+Ue(e.styles.paddingTop,e.bounds.width),e.bounds.width,Ye(r.lineHeight,r.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Jr(w.listValue,g),r.letterSpacing,Ye(r.lineHeight,r.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),A.label=20;case 20:return[2]}})})},Ds.prototype.renderStackContent=function(C){return a(this,void 0,void 0,function(){var e,t,r,B,n,s,o,i,Q,c,a,g,w,U,l;return H(this,function(A){switch(A.label){case 0:return Pt(C.element.container.flags,16),[4,this.renderNodeBackgroundAndBorders(C.element)];case 1:A.sent(),e=0,t=C.negativeZIndex,A.label=2;case 2:return e<t.length?(l=t[e],[4,this.renderStack(l)]):[3,5];case 3:A.sent(),A.label=4;case 4:return e++,[3,2];case 5:return[4,this.renderNodeContent(C.element)];case 6:A.sent(),r=0,B=C.nonInlineLevel,A.label=7;case 7:return r<B.length?(l=B[r],[4,this.renderNode(l)]):[3,10];case 8:A.sent(),A.label=9;case 9:return r++,[3,7];case 10:n=0,s=C.nonPositionedFloats,A.label=11;case 11:return n<s.length?(l=s[n],[4,this.renderStack(l)]):[3,14];case 12:A.sent(),A.label=13;case 13:return n++,[3,11];case 14:o=0,i=C.nonPositionedInlineLevel,A.label=15;case 15:return o<i.length?(l=i[o],[4,this.renderStack(l)]):[3,18];case 16:A.sent(),A.label=17;case 17:return o++,[3,15];case 18:Q=0,c=C.inlineLevel,A.label=19;case 19:return Q<c.length?(l=c[Q],[4,this.renderNode(l)]):[3,22];case 20:A.sent(),A.label=21;case 21:return Q++,[3,19];case 22:a=0,g=C.zeroOrAutoZIndexOrTransformedOrOpacity,A.label=23;case 23:return a<g.length?(l=g[a],[4,this.renderStack(l)]):[3,26];case 24:A.sent(),A.label=25;case 25:return a++,[3,23];case 26:w=0,U=C.positiveZIndex,A.label=27;case 27:return w<U.length?(l=U[w],[4,this.renderStack(l)]):[3,30];case 28:A.sent(),A.label=29;case 29:return w++,[3,27];case 30:return[2]}})})},Ds.prototype.mask=function(A){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(A.slice(0).reverse()),this.ctx.closePath()},Ds.prototype.path=function(A){this.ctx.beginPath(),this.formatPath(A),this.ctx.closePath()},Ds.prototype.formatPath=function(A){var r=this;A.forEach(function(A,e){var t=$n(A)?A.start:A;0===e?r.ctx.moveTo(t.x,t.y):r.ctx.lineTo(t.x,t.y),$n(A)&&r.ctx.bezierCurveTo(A.startControl.x,A.startControl.y,A.endControl.x,A.endControl.y,A.end.x,A.end.y)})},Ds.prototype.renderRepeat=function(A,e,t,r){this.path(A),this.ctx.fillStyle=e,this.ctx.translate(t,r),this.ctx.fill(),this.ctx.translate(-t,-r)},Ds.prototype.resizeImage=function(A,e,t){if(A.width===e&&A.height===t)return A;var r=(null!==(r=this.canvas.ownerDocument)&&void 0!==r?r:document).createElement("canvas");return r.width=Math.max(1,e),r.height=Math.max(1,t),r.getContext("2d").drawImage(A,0,0,A.width,A.height,0,0,e,t),r},Ds.prototype.renderBackgroundImage=function(f){return a(this,void 0,void 0,function(){var h,e,d,t,r,B;return H(this,function(A){switch(A.label){case 0:h=f.styles.backgroundImage.length-1,e=function(e){var t,r,B,n,s,o,i,Q,c,a,g,w,U,l,C,u,F;return H(this,function(A){switch(A.label){case 0:if(0!==e.type)return[3,5];t=void 0,r=e.url,A.label=1;case 1:return A.trys.push([1,3,,4]),[4,d.context.cache.match(r)];case 2:return t=A.sent(),[3,4];case 3:return A.sent(),d.context.logger.error("Error loading background-image "+r),[3,4];case 4:return t&&(B=Cs(f,h,[t.width,t.height,t.width/t.height]),o=B[0],g=B[1],w=B[2],c=B[3],a=B[4],s=d.ctx.createPattern(d.resizeImage(t,c,a),"repeat"),d.renderRepeat(o,s,g,w)),[3,6];case 5:1===e.type?(F=Cs(f,h,[null,null,null]),o=F[0],g=F[1],w=F[2],c=F[3],a=F[4],C=Ee(e.angle,c,a),l=C[0],B=C[1],i=C[2],u=C[3],Q=C[4],(F=document.createElement("canvas")).width=c,F.height=a,C=F.getContext("2d"),n=C.createLinearGradient(B,u,i,Q),pe(e.stops,l).forEach(function(A){return n.addColorStop(A.stop,ie(A.color))}),C.fillStyle=n,C.fillRect(0,0,c,a),0<c&&0<a&&(s=d.ctx.createPattern(F,"repeat"),d.renderRepeat(o,s,g,w))):2===e.type&&(u=Cs(f,h,[null,null,null]),o=u[0],i=u[1],Q=u[2],c=u[3],a=u[4],l=0===e.position.length?[ge]:e.position,g=Ue(l[0],c),w=Ue(l[l.length-1],a),C=function(A,e,t,r,B){var n,s,o,i,Q=0,c=0;switch(A.size){case 0:0===A.shape?Q=c=Math.min(Math.abs(e),Math.abs(e-r),Math.abs(t),Math.abs(t-B)):1===A.shape&&(Q=Math.min(Math.abs(e),Math.abs(e-r)),c=Math.min(Math.abs(t),Math.abs(t-B)));break;case 2:0===A.shape?Q=c=Math.min(Ie(e,t),Ie(e,t-B),Ie(e-r,t),Ie(e-r,t-B)):1===A.shape&&(n=Math.min(Math.abs(t),Math.abs(t-B))/Math.min(Math.abs(e),Math.abs(e-r)),o=(s=ye(r,B,e,t,!0))[0],i=s[1],c=n*(Q=Ie(o-e,(i-t)/n)));break;case 1:0===A.shape?Q=c=Math.max(Math.abs(e),Math.abs(e-r),Math.abs(t),Math.abs(t-B)):1===A.shape&&(Q=Math.max(Math.abs(e),Math.abs(e-r)),c=Math.max(Math.abs(t),Math.abs(t-B)));break;case 3:0===A.shape?Q=c=Math.max(Ie(e,t),Ie(e,t-B),Ie(e-r,t),Ie(e-r,t-B)):1===A.shape&&(n=Math.max(Math.abs(t),Math.abs(t-B))/Math.max(Math.abs(e),Math.abs(e-r)),o=(s=ye(r,B,e,t,!1))[0],i=s[1],c=n*(Q=Ie(o-e,(i-t)/n)))}return Array.isArray(A.size)&&(Q=Ue(A.size[0],r),c=2===A.size.length?Ue(A.size[1],B):Q),[Q,c]}(e,g,w,c,a),F=C[0],u=C[1],0<F&&0<u&&(U=d.ctx.createRadialGradient(i+g,Q+w,0,i+g,Q+w,F),pe(e.stops,2*F).forEach(function(A){return U.addColorStop(A.stop,ie(A.color))}),d.path(o),d.ctx.fillStyle=U,F!==u?(l=f.bounds.left+.5*f.bounds.width,C=f.bounds.top+.5*f.bounds.height,F=1/(u=u/F),d.ctx.save(),d.ctx.translate(l,C),d.ctx.transform(1,0,0,u,0,0),d.ctx.translate(-l,-C),d.ctx.fillRect(i,F*(Q-C)+C,c,a*F),d.ctx.restore()):d.ctx.fill())),A.label=6;case 6:return h--,[2]}})},d=this,t=0,r=f.styles.backgroundImage.slice(0).reverse(),A.label=1;case 1:return t<r.length?(B=r[t],[5,e(B)]):[3,4];case 2:A.sent(),A.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},Ds.prototype.renderSolidBorder=function(e,t,r){return a(this,void 0,void 0,function(){return H(this,function(A){return this.path(ws(r,t)),this.ctx.fillStyle=ie(e),this.ctx.fill(),[2]})})},Ds.prototype.renderDoubleBorder=function(t,r,B,n){return a(this,void 0,void 0,function(){var e;return H(this,function(A){switch(A.label){case 0:return r<3?[4,this.renderSolidBorder(t,B,n)]:[3,2];case 1:return A.sent(),[2];case 2:return e=function(A,e){switch(e){case 0:return Hs(A.topLeftBorderBox,A.topLeftBorderDoubleOuterBox,A.topRightBorderBox,A.topRightBorderDoubleOuterBox);case 1:return Hs(A.topRightBorderBox,A.topRightBorderDoubleOuterBox,A.bottomRightBorderBox,A.bottomRightBorderDoubleOuterBox);case 2:return Hs(A.bottomRightBorderBox,A.bottomRightBorderDoubleOuterBox,A.bottomLeftBorderBox,A.bottomLeftBorderDoubleOuterBox);default:return Hs(A.bottomLeftBorderBox,A.bottomLeftBorderDoubleOuterBox,A.topLeftBorderBox,A.topLeftBorderDoubleOuterBox)}}(n,B),this.path(e),this.ctx.fillStyle=ie(t),this.ctx.fill(),e=function(A,e){switch(e){case 0:return Hs(A.topLeftBorderDoubleInnerBox,A.topLeftPaddingBox,A.topRightBorderDoubleInnerBox,A.topRightPaddingBox);case 1:return Hs(A.topRightBorderDoubleInnerBox,A.topRightPaddingBox,A.bottomRightBorderDoubleInnerBox,A.bottomRightPaddingBox);case 2:return Hs(A.bottomRightBorderDoubleInnerBox,A.bottomRightPaddingBox,A.bottomLeftBorderDoubleInnerBox,A.bottomLeftPaddingBox);default:return Hs(A.bottomLeftBorderDoubleInnerBox,A.bottomLeftPaddingBox,A.topLeftBorderDoubleInnerBox,A.topLeftPaddingBox)}}(n,B),this.path(e),this.ctx.fill(),[2]}})})},Ds.prototype.renderNodeBackgroundAndBorders=function(c){return a(this,void 0,void 0,function(){var e,t,r,B,n,s,o,i,Q=this;return H(this,function(A){switch(A.label){case 0:return(this.applyEffects(c.getEffects(2)),e=c.container.styles,t=!oe(e.backgroundColor)||e.backgroundImage.length,r=[{style:e.borderTopStyle,color:e.borderTopColor,width:e.borderTopWidth},{style:e.borderRightStyle,color:e.borderRightColor,width:e.borderRightWidth},{style:e.borderBottomStyle,color:e.borderBottomColor,width:e.borderBottomWidth},{style:e.borderLeftStyle,color:e.borderLeftColor,width:e.borderLeftWidth}],B=Ms(Es(e.backgroundClip,0),c.curves),t||e.boxShadow.length)?(this.ctx.save(),this.path(B),this.ctx.clip(),oe(e.backgroundColor)||(this.ctx.fillStyle=ie(e.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(c.container)]):[3,2];case 1:A.sent(),this.ctx.restore(),e.boxShadow.slice(0).reverse().forEach(function(A){Q.ctx.save();var t,r,B,n,e=ts(c.curves),s=A.inset?0:1e4,o=(t=-s+(A.inset?1:-1)*A.spread.number,r=(A.inset?1:-1)*A.spread.number,B=A.spread.number*(A.inset?-2:2),n=A.spread.number*(A.inset?-2:2),e.map(function(A,e){switch(e){case 0:return A.add(t,r);case 1:return A.add(t+B,r);case 2:return A.add(t+B,r+n);case 3:return A.add(t,r+n)}return A}));A.inset?(Q.path(e),Q.ctx.clip(),Q.mask(o)):(Q.mask(e),Q.ctx.clip(),Q.path(o)),Q.ctx.shadowOffsetX=A.offsetX.number+s,Q.ctx.shadowOffsetY=A.offsetY.number,Q.ctx.shadowColor=ie(A.color),Q.ctx.shadowBlur=A.blur.number,Q.ctx.fillStyle=A.inset?ie(A.color):"rgba(0,0,0,1)",Q.ctx.fill(),Q.ctx.restore()}),A.label=2;case 2:s=n=0,o=r,A.label=3;case 3:return s<o.length?0!==(i=o[s]).style&&!oe(i.color)&&0<i.width?2!==i.style?[3,5]:[4,this.renderDashedDottedBorder(i.color,i.width,n,c.curves,2)]:[3,11]:[3,13];case 4:return A.sent(),[3,11];case 5:return 3!==i.style?[3,7]:[4,this.renderDashedDottedBorder(i.color,i.width,n,c.curves,3)];case 6:return A.sent(),[3,11];case 7:return 4!==i.style?[3,9]:[4,this.renderDoubleBorder(i.color,i.width,n,c.curves)];case 8:return A.sent(),[3,11];case 9:return[4,this.renderSolidBorder(i.color,n,c.curves)];case 10:A.sent(),A.label=11;case 11:n++,A.label=12;case 12:return s++,[3,3];case 13:return[2]}})})},Ds.prototype.renderDashedDottedBorder=function(g,w,U,l,C){return a(this,void 0,void 0,function(){var e,t,r,B,n,s,o,i,Q,c,a;return H(this,function(A){return this.ctx.save(),Q=function(A,e){switch(e){case 0:return fs(A.topLeftBorderStroke,A.topRightBorderStroke);case 1:return fs(A.topRightBorderStroke,A.bottomRightBorderStroke);case 2:return fs(A.bottomRightBorderStroke,A.bottomLeftBorderStroke);default:return fs(A.bottomLeftBorderStroke,A.topLeftBorderStroke)}}(l,U),e=ws(l,U),2===C&&(this.path(e),this.ctx.clip()),s=$n(e[0])?(t=e[0].start.x,e[0].start.y):(t=e[0].x,e[0].y),o=$n(e[1])?(r=e[1].end.x,e[1].end.y):(r=e[1].x,e[1].y),B=0===U||2===U?Math.abs(t-r):Math.abs(s-o),this.ctx.beginPath(),3===C?this.formatPath(Q):this.formatPath(e.slice(0,2)),n=w<3?3*w:2*w,s=w<3?2*w:w,3===C&&(s=n=w),o=!0,B<=2*n?o=!1:B<=2*n+s?(n*=i=B/(2*n+s),s*=i):(Q=Math.floor((B+s)/(n+s)),i=(B-Q*n)/(Q-1),s=(Q=(B-(Q+1)*n)/Q)<=0||Math.abs(s-i)<Math.abs(s-Q)?i:Q),o&&(3===C?this.ctx.setLineDash([0,n+s]):this.ctx.setLineDash([n,s])),3===C?(this.ctx.lineCap="round",this.ctx.lineWidth=w):this.ctx.lineWidth=2*w+1.1,this.ctx.strokeStyle=ie(g),this.ctx.stroke(),this.ctx.setLineDash([]),2===C&&($n(e[0])&&(c=e[3],a=e[0],this.ctx.beginPath(),this.formatPath([new Zn(c.end.x,c.end.y),new Zn(a.start.x,a.start.y)]),this.ctx.stroke()),$n(e[1])&&(c=e[1],a=e[2],this.ctx.beginPath(),this.formatPath([new Zn(c.end.x,c.end.y),new Zn(a.start.x,a.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},Ds.prototype.render=function(B){return a(this,void 0,void 0,function(){return H(this,function(A){switch(A.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=ie(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),t=new as(e=B,null),r=new cs(t),hs(t,r,r,e=[]),ds(t.container,e),[4,this.renderStack(r)];case 1:return A.sent(),this.applyEffects([]),[2,this.canvas]}var e,t,r})})},Ds);function Ds(A,e){A=Ls.call(this,A,e)||this;return A._activeEffects=[],A.canvas=e.canvas||document.createElement("canvas"),A.ctx=A.canvas.getContext("2d"),e.canvas||(A.canvas.width=Math.floor(e.width*e.scale),A.canvas.height=Math.floor(e.height*e.scale),A.canvas.style.width=e.width+"px",A.canvas.style.height=e.height+"px"),A.fontMetrics=new Ks(document),A.ctx.scale(A.options.scale,A.options.scale),A.ctx.translate(-e.x,-e.y),A.ctx.textBaseline="bottom",A._activeEffects=[],A.context.logger.debug("Canvas renderer initialized ("+e.width+"x"+e.height+") with scale "+e.scale),A}var vs,xs=function(A){return A instanceof LB||(A instanceof yB||A instanceof pB&&A.type!==dB&&A.type!==hB)},Ms=function(A,e){switch(A){case 0:return ts(e);case 2:return[e.topLeftContentBox,e.topRightContentBox,e.bottomRightContentBox,e.bottomLeftContentBox];default:return rs(e)}},Ss=function(A){switch(A){case 1:return"center";case 2:return"right";default:return"left"}},Ts=["-apple-system","system-ui"],Gs=function(A){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?A.filter(function(A){return-1===Ts.indexOf(A)}):A},Os=(A(Vs,vs=he),Vs.prototype.render=function(t){return a(this,void 0,void 0,function(){var e;return H(this,function(A){switch(A.label){case 0:return e=Nr(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,t),[4,ks(e)];case 1:return e=A.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=ie(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(e,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},Vs);function Vs(A,e){A=vs.call(this,A,e)||this;return A.canvas=e.canvas||document.createElement("canvas"),A.ctx=A.canvas.getContext("2d"),A.options=e,A.canvas.width=Math.floor(e.width*e.scale),A.canvas.height=Math.floor(e.height*e.scale),A.canvas.style.width=e.width+"px",A.canvas.style.height=e.height+"px",A.ctx.scale(A.options.scale,A.options.scale),A.ctx.translate(-e.x,-e.y),A.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+e.width+"x"+e.height+" at "+e.x+","+e.y+") with scale "+e.scale),A}var ks=function(r){return new Promise(function(A,e){var t=new Image;t.onload=function(){A(t)},t.onerror=e,t.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(r))})},Rs=(Ns.prototype.debug=function(){for(var A=[],e=0;e<arguments.length;e++)A[e]=arguments[e];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.debug?console.debug.apply(console,t([this.id,this.getTime()+"ms"],A)):this.info.apply(this,A))},Ns.prototype.getTime=function(){return Date.now()-this.start},Ns.prototype.info=function(){for(var A=[],e=0;e<arguments.length;e++)A[e]=arguments[e];this.enabled&&"undefined"!=typeof window&&window.console&&"function"==typeof console.info&&console.info.apply(console,t([this.id,this.getTime()+"ms"],A))},Ns.prototype.warn=function(){for(var A=[],e=0;e<arguments.length;e++)A[e]=arguments[e];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.warn?console.warn.apply(console,t([this.id,this.getTime()+"ms"],A)):this.info.apply(this,A))},Ns.prototype.error=function(){for(var A=[],e=0;e<arguments.length;e++)A[e]=arguments[e];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.error?console.error.apply(console,t([this.id,this.getTime()+"ms"],A)):this.info.apply(this,A))},Ns.instances={},Ns);function Ns(A){var e=A.id,A=A.enabled;this.id=e,this.enabled=A,this.start=Date.now()}var Ps=(Xs.instanceCount=1,Xs);function Xs(A,e){this.windowBounds=e,this.instanceName="#"+Xs.instanceCount++,this.logger=new Rs({id:this.instanceName,enabled:A.logging}),this.cache=null!==(e=A.cache)&&void 0!==e?e:new On(this,A)}"undefined"!=typeof window&&Tn.setContext(window);var Js=function(u,F){return a(void 0,void 0,void 0,function(){var e,t,r,B,n,s,o,i,Q,c,a,g,w,U,l,C;return H(this,function(A){switch(A.label){case 0:if(!u||"object"!=typeof u)return[2,Promise.reject("Invalid element provided as first argument")];if(!(e=u.ownerDocument))throw new Error("Element is not attached to a Document");if(!(t=e.defaultView))throw new Error("Document is not attached to a Window");return w={allowTaint:null!==(U=F.allowTaint)&&void 0!==U&&U,imageTimeout:null!==(c=F.imageTimeout)&&void 0!==c?c:15e3,proxy:F.proxy,useCORS:null!==(a=F.useCORS)&&void 0!==a&&a},U=h({logging:null===(g=F.logging)||void 0===g||g,cache:F.cache},w),c={windowWidth:null!==(c=F.windowWidth)&&void 0!==c?c:t.innerWidth,windowHeight:null!==(a=F.windowHeight)&&void 0!==a?a:t.innerHeight,scrollX:null!==(g=F.scrollX)&&void 0!==g?g:t.pageXOffset,scrollY:null!==(w=F.scrollY)&&void 0!==w?w:t.pageYOffset},a=new d(c.scrollX,c.scrollY,c.windowWidth,c.windowHeight),g=new Ps(U,a),c=null!==(w=F.foreignObjectRendering)&&void 0!==w&&w,w={allowTaint:null!==(U=F.allowTaint)&&void 0!==U&&U,onclone:F.onclone,ignoreElements:F.ignoreElements,inlineImages:c,copyStyles:c},g.logger.debug("Starting document clone with size "+a.width+"x"+a.height+" scrolled to "+-a.left+","+-a.top),U=new dn(g,u,w),(w=U.clonedReferenceElement)?[4,U.toIFrame(e,a)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return(r=A.sent(),l=jB(w)||"HTML"===w.tagName?function(A){var e=A.body,t=A.documentElement;if(!e||!t)throw new Error("Unable to get document size");A=Math.max(Math.max(e.scrollWidth,t.scrollWidth),Math.max(e.offsetWidth,t.offsetWidth),Math.max(e.clientWidth,t.clientWidth)),t=Math.max(Math.max(e.scrollHeight,t.scrollHeight),Math.max(e.offsetHeight,t.offsetHeight),Math.max(e.clientHeight,t.clientHeight));return new d(0,0,A,t)}(w.ownerDocument):f(g,w),B=l.width,n=l.height,s=l.left,o=l.top,i=Ys(g,w,F.backgroundColor),l={canvas:F.canvas,backgroundColor:i,scale:null!==(l=null!==(l=F.scale)&&void 0!==l?l:t.devicePixelRatio)&&void 0!==l?l:1,x:(null!==(l=F.x)&&void 0!==l?l:0)+s,y:(null!==(l=F.y)&&void 0!==l?l:0)+o,width:null!==(l=F.width)&&void 0!==l?l:Math.ceil(B),height:null!==(l=F.height)&&void 0!==l?l:Math.ceil(n)},c)?(g.logger.debug("Document cloned, using foreign object rendering"),[4,new Os(g,l).render(w)]):[3,3];case 2:return Q=A.sent(),[3,5];case 3:return g.logger.debug("Document cloned, element located at "+s+","+o+" with size "+B+"x"+n+" using computed rendering"),g.logger.debug("Starting DOM parsing"),C=kB(g,w),i===C.styles.backgroundColor&&(C.styles.backgroundColor=Le.TRANSPARENT),g.logger.debug("Starting renderer for element at "+l.x+","+l.y+" with size "+l.width+"x"+l.height),[4,new bs(g,l).render(C)];case 4:Q=A.sent(),A.label=5;case 5:return null!==(C=F.removeContainer)&&void 0!==C&&!C||dn.destroy(r)||g.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore"),g.logger.debug("Finished rendering"),[2,Q]}})})},Ys=function(A,e,t){var r=e.ownerDocument,B=r.documentElement?fe(A,getComputedStyle(r.documentElement).backgroundColor):Le.TRANSPARENT,n=r.body?fe(A,getComputedStyle(r.body).backgroundColor):Le.TRANSPARENT,t="string"==typeof t?fe(A,t):null===t?Le.TRANSPARENT:4294967295;return e===r.documentElement?oe(B)?oe(n)?t:n:B:t};return function(A,e){return Js(A,e=void 0===e?{}:e)}});/*! For license information please see html2pdf.bundle.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("html2pdf",[],t):"object"==typeof exports?exports.html2pdf=t():e.html2pdf=t()}(self,(function(){return function(){var e,t,r={"./node_modules/@babel/runtime-corejs3/core-js-stable/array/from.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/array/from.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/array/is-array.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/array/is-array.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/date/now.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/date/now.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/instance/bind.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/instance/bind.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/instance/concat.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/instance/concat.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/instance/every.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/instance/every.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/instance/fill.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/instance/fill.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/instance/filter.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/instance/filter.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/instance/for-each.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/instance/for-each.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/instance/includes.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/instance/includes.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/instance/index-of.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/instance/index-of.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/instance/map.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/instance/map.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/instance/reduce.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/instance/reduce.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/instance/reverse.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/instance/reverse.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/instance/slice.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/instance/slice.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/instance/some.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/instance/some.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/instance/starts-with.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/instance/starts-with.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/instance/trim.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/instance/trim.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/instance/values.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/instance/values.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/map.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/map/index.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/object/define-properties.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/object/define-properties.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/object/define-property.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/object/define-property.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptor.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/object/get-own-property-descriptor.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptors.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/object/get-own-property-descriptors.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/object/get-own-property-symbols.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/object/get-own-property-symbols.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/object/keys.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/object/keys.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/parse-float.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/parse-float.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/parse-int.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/parse-int.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/promise.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/promise/index.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/reflect/apply.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/reflect/apply.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/reflect/construct.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/reflect/construct.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/reflect/delete-property.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/reflect/delete-property.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/reflect/get-prototype-of.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/reflect/get-prototype-of.js")},"./node_modules/@babel/runtime-corejs3/core-js-stable/symbol.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/stable/symbol/index.js")},"./node_modules/@babel/runtime-corejs3/core-js/array/from.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/features/array/from.js")},"./node_modules/@babel/runtime-corejs3/core-js/array/is-array.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/features/array/is-array.js")},"./node_modules/@babel/runtime-corejs3/core-js/get-iterator-method.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/features/get-iterator-method.js")},"./node_modules/@babel/runtime-corejs3/core-js/get-iterator.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/features/get-iterator.js")},"./node_modules/@babel/runtime-corejs3/core-js/instance/slice.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/features/instance/slice.js")},"./node_modules/@babel/runtime-corejs3/core-js/object/create.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/features/object/create.js")},"./node_modules/@babel/runtime-corejs3/core-js/object/define-property.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/features/object/define-property.js")},"./node_modules/@babel/runtime-corejs3/core-js/object/get-own-property-descriptor.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/features/object/get-own-property-descriptor.js")},"./node_modules/@babel/runtime-corejs3/core-js/object/get-prototype-of.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/features/object/get-prototype-of.js")},"./node_modules/@babel/runtime-corejs3/core-js/object/set-prototype-of.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/features/object/set-prototype-of.js")},"./node_modules/@babel/runtime-corejs3/core-js/promise.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/features/promise/index.js")},"./node_modules/@babel/runtime-corejs3/core-js/reflect/get.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/features/reflect/get.js")},"./node_modules/@babel/runtime-corejs3/core-js/symbol.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/features/symbol/index.js")},"./node_modules/@babel/runtime-corejs3/core-js/symbol/iterator.js":function(e,t,r){e.exports=r("./node_modules/core-js-pure/features/symbol/iterator.js")},"./node_modules/@babel/runtime-corejs3/helpers/esm/arrayLikeToArray.js":function(e,t,r){"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}r.r(t),r.d(t,{default:function(){return n}})},"./node_modules/@babel/runtime-corejs3/helpers/esm/arrayWithHoles.js":function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return o}});var n=r("./node_modules/@babel/runtime-corejs3/core-js/array/is-array.js");function o(e){if(n(e))return e}},"./node_modules/@babel/runtime-corejs3/helpers/esm/arrayWithoutHoles.js":function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return s}});var n=r("./node_modules/@babel/runtime-corejs3/core-js/array/is-array.js"),o=r("./node_modules/@babel/runtime-corejs3/helpers/esm/arrayLikeToArray.js");function s(e){if(n(e))return(0,o.default)(e)}},"./node_modules/@babel/runtime-corejs3/helpers/esm/assertThisInitialized.js":function(e,t,r){"use strict";function n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}r.r(t),r.d(t,{default:function(){return n}})},"./node_modules/@babel/runtime-corejs3/helpers/esm/asyncToGenerator.js":function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return s}});var n=r("./node_modules/@babel/runtime-corejs3/core-js/promise.js");function o(e,t,r,o,s,i,a){try{var A=e[i](a),u=A.value}catch(e){return void r(e)}A.done?t(u):n.resolve(u).then(o,s)}function s(e){return function(){var t=this,r=arguments;return new n((function(n,s){var i=e.apply(t,r);function a(e){o(i,n,s,a,A,"next",e)}function A(e){o(i,n,s,a,A,"throw",e)}a(void 0)}))}}},"./node_modules/@babel/runtime-corejs3/helpers/esm/classCallCheck.js":function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}r.r(t),r.d(t,{default:function(){return n}})},"./node_modules/@babel/runtime-corejs3/helpers/esm/createClass.js":function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return s}});var n=r("./node_modules/@babel/runtime-corejs3/core-js/object/define-property.js");function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),n(e,o.key,o)}}function s(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}},"./node_modules/@babel/runtime-corejs3/helpers/esm/defineProperty.js":function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return o}});var n=r("./node_modules/@babel/runtime-corejs3/core-js/object/define-property.js");function o(e,t,r){return t in e?n(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},"./node_modules/@babel/runtime-corejs3/helpers/esm/get.js":function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return i}});var n=r("./node_modules/@babel/runtime-corejs3/core-js/reflect/get.js"),o=r("./node_modules/@babel/runtime-corejs3/core-js/object/get-own-property-descriptor.js"),s=r("./node_modules/@babel/runtime-corejs3/helpers/esm/superPropBase.js");function i(e,t,r){return(i="undefined"!=typeof Reflect&&n?n:function(e,t,r){var n=(0,s.default)(e,t);if(n){var i=o(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}},"./node_modules/@babel/runtime-corejs3/helpers/esm/getPrototypeOf.js":function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return s}});var n=r("./node_modules/@babel/runtime-corejs3/core-js/object/set-prototype-of.js"),o=r("./node_modules/@babel/runtime-corejs3/core-js/object/get-prototype-of.js");function s(e){return(s=n?o:function(e){return e.__proto__||o(e)})(e)}},"./node_modules/@babel/runtime-corejs3/helpers/esm/inherits.js":function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return s}});var n=r("./node_modules/@babel/runtime-corejs3/core-js/object/create.js"),o=r("./node_modules/@babel/runtime-corejs3/helpers/esm/setPrototypeOf.js");function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=n(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&(0,o.default)(e,t)}},"./node_modules/@babel/runtime-corejs3/helpers/esm/iterableToArray.js":function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return i}});var n=r("./node_modules/@babel/runtime-corejs3/core-js/symbol.js"),o=r("./node_modules/@babel/runtime-corejs3/core-js/get-iterator-method.js"),s=r("./node_modules/@babel/runtime-corejs3/core-js/array/from.js");function i(e){if(void 0!==n&&null!=o(e)||null!=e["@@iterator"])return s(e)}},"./node_modules/@babel/runtime-corejs3/helpers/esm/iterableToArrayLimit.js":function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return s}});var n=r("./node_modules/@babel/runtime-corejs3/core-js/symbol.js"),o=r("./node_modules/@babel/runtime-corejs3/core-js/get-iterator-method.js");function s(e,t){var r=null==e?null:void 0!==n&&o(e)||e["@@iterator"];if(null!=r){var s,i,a=[],A=!0,u=!1;try{for(r=r.call(e);!(A=(s=r.next()).done)&&(a.push(s.value),!t||a.length!==t);A=!0);}catch(e){u=!0,i=e}finally{try{A||null==r.return||r.return()}finally{if(u)throw i}}return a}}},"./node_modules/@babel/runtime-corejs3/helpers/esm/nonIterableRest.js":function(e,t,r){"use strict";function n(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}r.r(t),r.d(t,{default:function(){return n}})},"./node_modules/@babel/runtime-corejs3/helpers/esm/nonIterableSpread.js":function(e,t,r){"use strict";function n(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}r.r(t),r.d(t,{default:function(){return n}})},"./node_modules/@babel/runtime-corejs3/helpers/esm/possibleConstructorReturn.js":function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return s}});var n=r("./node_modules/@babel/runtime-corejs3/helpers/esm/typeof.js"),o=r("./node_modules/@babel/runtime-corejs3/helpers/esm/assertThisInitialized.js");function s(e,t){return!t||"object"!==(0,n.default)(t)&&"function"!=typeof t?(0,o.default)(e):t}},"./node_modules/@babel/runtime-corejs3/helpers/esm/setPrototypeOf.js":function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return o}});var n=r("./node_modules/@babel/runtime-corejs3/core-js/object/set-prototype-of.js");function o(e,t){return(o=n||function(e,t){return e.__proto__=t,e})(e,t)}},"./node_modules/@babel/runtime-corejs3/helpers/esm/slicedToArray.js":function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return a}});var n=r("./node_modules/@babel/runtime-corejs3/helpers/esm/arrayWithHoles.js"),o=r("./node_modules/@babel/runtime-corejs3/helpers/esm/iterableToArrayLimit.js"),s=r("./node_modules/@babel/runtime-corejs3/helpers/esm/unsupportedIterableToArray.js"),i=r("./node_modules/@babel/runtime-corejs3/helpers/esm/nonIterableRest.js");function a(e,t){return(0,n.default)(e)||(0,o.default)(e,t)||(0,s.default)(e,t)||(0,i.default)()}},"./node_modules/@babel/runtime-corejs3/helpers/esm/superPropBase.js":function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return o}});var n=r("./node_modules/@babel/runtime-corejs3/helpers/esm/getPrototypeOf.js");function o(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=(0,n.default)(e)););return e}},"./node_modules/@babel/runtime-corejs3/helpers/esm/toConsumableArray.js":function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return a}});var n=r("./node_modules/@babel/runtime-corejs3/helpers/esm/arrayWithoutHoles.js"),o=r("./node_modules/@babel/runtime-corejs3/helpers/esm/iterableToArray.js"),s=r("./node_modules/@babel/runtime-corejs3/helpers/esm/unsupportedIterableToArray.js"),i=r("./node_modules/@babel/runtime-corejs3/helpers/esm/nonIterableSpread.js");function a(e){return(0,n.default)(e)||(0,o.default)(e)||(0,s.default)(e)||(0,i.default)()}},"./node_modules/@babel/runtime-corejs3/helpers/esm/typeof.js":function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return s}});var n=r("./node_modules/@babel/runtime-corejs3/core-js/symbol.js"),o=r("./node_modules/@babel/runtime-corejs3/core-js/symbol/iterator.js");function s(e){return(s="function"==typeof n&&"symbol"==typeof o?function(e){return typeof e}:function(e){return e&&"function"==typeof n&&e.constructor===n&&e!==n.prototype?"symbol":typeof e})(e)}},"./node_modules/@babel/runtime-corejs3/helpers/esm/unsupportedIterableToArray.js":function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return i}});var n=r("./node_modules/@babel/runtime-corejs3/core-js/instance/slice.js"),o=r("./node_modules/@babel/runtime-corejs3/core-js/array/from.js"),s=r("./node_modules/@babel/runtime-corejs3/helpers/esm/arrayLikeToArray.js");function i(e,t){var r;if(e){if("string"==typeof e)return(0,s.default)(e,t);var i=n(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?o(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?(0,s.default)(e,t):void 0}}},"./node_modules/@babel/runtime-corejs3/regenerator/index.js":function(e,t,r){e.exports=r("./node_modules/regenerator-runtime/runtime.js")},"./src/plugin/hyperlinks.js":function(e,t,r){"use strict";r.r(t),r("./node_modules/core-js/modules/web.dom-collections.for-each.js"),r("./node_modules/core-js/modules/es.string.link.js");var n=r("./src/worker.js"),o=r("./src/utils.js"),s=[],i={toContainer:n.default.prototype.toContainer,toPdf:n.default.prototype.toPdf};n.default.prototype.toContainer=function(){return i.toContainer.call(this).then((function(){if(this.opt.enableLinks){var e=this.prop.container,t=e.querySelectorAll("a"),r=(0,o.unitConvert)(e.getBoundingClientRect(),this.prop.pageSize.k);s=[],Array.prototype.forEach.call(t,(function(e){for(var t=e.getClientRects(),n=0;n<t.length;n++){var i=(0,o.unitConvert)(t[n],this.prop.pageSize.k);i.left-=r.left,i.top-=r.top;var a=Math.floor(i.top/this.prop.pageSize.inner.height)+1,A=this.opt.margin[0]+i.top%this.prop.pageSize.inner.height,u=this.opt.margin[1]+i.left;s.push({page:a,top:A,left:u,clientRect:i,link:e})}}),this)}}))},n.default.prototype.toPdf=function(){return i.toPdf.call(this).then((function(){if(this.opt.enableLinks){s.forEach((function(e){this.prop.pdf.setPage(e.page),this.prop.pdf.link(e.left,e.top,e.clientRect.width,e.clientRect.height,{url:e.link.href})}),this);var e=this.prop.pdf.internal.getNumberOfPages();this.prop.pdf.setPage(e)}}))}},"./src/plugin/jspdf-plugin.js":function(e,t,r){"use strict";r.r(t),r("./node_modules/core-js/modules/es.symbol.js"),r("./node_modules/core-js/modules/es.symbol.description.js"),r("./node_modules/core-js/modules/es.object.to-string.js"),r("./node_modules/core-js/modules/es.symbol.iterator.js"),r("./node_modules/core-js/modules/es.array.iterator.js"),r("./node_modules/core-js/modules/es.string.iterator.js"),r("./node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("./node_modules/jspdf/dist/jspdf.es.min.js");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.jsPDF.getPageSize=function(e,t,r){if("object"===o(e)){var n=e;e=n.orientation,t=n.unit||t,r=n.format||r}t=t||"mm",r=r||"a4",e=(""+(e||"P")).toLowerCase();var s=(""+r).toLowerCase(),i={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(t){case"pt":var a=1;break;case"mm":a=72/25.4;break;case"cm":a=72/2.54;break;case"in":a=72;break;case"px":a=.75;break;case"pc":case"em":a=12;break;case"ex":a=6;break;default:throw"Invalid unit: "+t}if(i.hasOwnProperty(s))var A=i[s][1]/a,u=i[s][0]/a;else try{A=r[1],u=r[0]}catch(e){throw new Error("Invalid format: "+r)}if("p"===e||"portrait"===e){if(e="p",u>A){var c=u;u=A,A=c}}else{if("l"!==e&&"landscape"!==e)throw"Invalid orientation: "+e;e="l",A>u&&(c=u,u=A,A=c)}return{width:u,height:A,unit:t,k:a}},t.default=n.jsPDF},"./src/plugin/pagebreaks.js":function(e,t,r){"use strict";r.r(t),r("./node_modules/core-js/modules/es.array.concat.js"),r("./node_modules/core-js/modules/es.array.slice.js"),r("./node_modules/core-js/modules/es.array.join.js"),r("./node_modules/core-js/modules/web.dom-collections.for-each.js"),r("./node_modules/core-js/modules/es.object.keys.js");var n=r("./src/worker.js"),o=r("./src/utils.js"),s={toContainer:n.default.prototype.toContainer};n.default.template.opt.pagebreak={mode:["css","legacy"],before:[],after:[],avoid:[]},n.default.prototype.toContainer=function(){return s.toContainer.call(this).then((function(){var e=this.prop.container,t=this.prop.pageSize.inner.px.height,r=[].concat(this.opt.pagebreak.mode),n={avoidAll:-1!==r.indexOf("avoid-all"),css:-1!==r.indexOf("css"),legacy:-1!==r.indexOf("legacy")},s={},i=this;["before","after","avoid"].forEach((function(t){var r=n.avoidAll&&"avoid"===t;s[t]=r?[]:[].concat(i.opt.pagebreak[t]||[]),s[t].length>0&&(s[t]=Array.prototype.slice.call(e.querySelectorAll(s[t].join(", "))))}));var a=e.querySelectorAll(".html2pdf__page-break");a=Array.prototype.slice.call(a);var A=e.querySelectorAll("*");Array.prototype.forEach.call(A,(function(e){var r={before:!1,after:n.legacy&&-1!==a.indexOf(e),avoid:n.avoidAll};if(n.css){var i=window.getComputedStyle(e),A=["always","page","left","right"];r={before:r.before||-1!==A.indexOf(i.breakBefore||i.pageBreakBefore),after:r.after||-1!==A.indexOf(i.breakAfter||i.pageBreakAfter),avoid:r.avoid||-1!==["avoid","avoid-page"].indexOf(i.breakInside||i.pageBreakInside)}}Object.keys(r).forEach((function(t){r[t]=r[t]||-1!==s[t].indexOf(e)}));var u=e.getBoundingClientRect();if(r.avoid&&!r.before){var c=Math.floor(u.top/t),l=Math.floor(u.bottom/t),d=Math.abs(u.bottom-u.top)/t;l!==c&&d<=1&&(r.before=!0)}if(r.before){var f=(0,o.createElement)("div",{style:{display:"block",height:t-u.top%t+"px"}});e.parentNode.insertBefore(f,e)}r.after&&(f=(0,o.createElement)("div",{style:{display:"block",height:t-u.bottom%t+"px"}}),e.parentNode.insertBefore(f,e.nextSibling))}))}))}},"./src/utils.js":function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}r.r(t),r.d(t,{objType:function(){return o},createElement:function(){return s},cloneNode:function(){return i},unitConvert:function(){return a},toPx:function(){return A}}),r("./node_modules/core-js/modules/es.number.constructor.js"),r("./node_modules/core-js/modules/es.symbol.js"),r("./node_modules/core-js/modules/es.symbol.description.js"),r("./node_modules/core-js/modules/es.object.to-string.js"),r("./node_modules/core-js/modules/es.symbol.iterator.js"),r("./node_modules/core-js/modules/es.array.iterator.js"),r("./node_modules/core-js/modules/es.string.iterator.js"),r("./node_modules/core-js/modules/web.dom-collections.iterator.js");var o=function(e){var t=n(e);return"undefined"===t?"undefined":"string"===t||e instanceof String?"string":"number"===t||e instanceof Number?"number":"function"===t||e instanceof Function?"function":e&&e.constructor===Array?"array":e&&1===e.nodeType?"element":"object"===t?"object":"unknown"},s=function(e,t){var r=document.createElement(e);if(t.className&&(r.className=t.className),t.innerHTML){r.innerHTML=t.innerHTML;for(var n=r.getElementsByTagName("script"),o=n.length;o-- >0;null)n[o].parentNode.removeChild(n[o])}for(var s in t.style)r.style[s]=t.style[s];return r},i=function e(t,r){for(var n=3===t.nodeType?document.createTextNode(t.nodeValue):t.cloneNode(!1),o=t.firstChild;o;o=o.nextSibling)!0!==r&&1===o.nodeType&&"SCRIPT"===o.nodeName||n.appendChild(e(o,r));return 1===t.nodeType&&("CANVAS"===t.nodeName?(n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(t,0,0)):"TEXTAREA"!==t.nodeName&&"SELECT"!==t.nodeName||(n.value=t.value),n.addEventListener("load",(function(){n.scrollTop=t.scrollTop,n.scrollLeft=t.scrollLeft}),!0)),n},a=function(e,t){if("number"===o(e))return 72*e/96/t;var r={};for(var n in e)r[n]=72*e[n]/96/t;return r},A=function(e,t){return Math.floor(e*t/72*96)}},"./src/worker.js":function(e,t,r){"use strict";r.r(t),r("./node_modules/core-js/modules/es.object.assign.js"),r("./node_modules/core-js/modules/es.array.map.js"),r("./node_modules/core-js/modules/es.object.keys.js"),r("./node_modules/core-js/modules/es.array.concat.js"),r("./node_modules/core-js/modules/es.object.to-string.js"),r("./node_modules/core-js/modules/es.regexp.to-string.js"),r("./node_modules/core-js/modules/es.function.name.js"),r("./node_modules/core-js/modules/web.dom-collections.for-each.js");var n=r("./node_modules/jspdf/dist/jspdf.es.min.js"),o=r("./node_modules/html2canvas/dist/html2canvas.js"),s=r("./src/utils.js"),i=r("./node_modules/es6-promise/dist/es6-promise.js"),a=r.n(i)().Promise,A=function e(t){var r=Object.assign(e.convert(a.resolve()),JSON.parse(JSON.stringify(e.template))),n=e.convert(a.resolve(),r);return(n=n.setProgress(1,e,1,[e])).set(t)};(A.prototype=Object.create(a.prototype)).constructor=A,A.convert=function(e,t){return e.__proto__=t||A.prototype,e},A.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],image:{type:"jpeg",quality:.95},enableLinks:!0,html2canvas:{},jsPDF:{}}},A.prototype.from=function(e,t){return this.then((function(){switch(t=t||function(e){switch((0,s.objType)(e)){case"string":return"string";case"element":return"canvas"===e.nodeName.toLowerCase?"canvas":"element";default:return"unknown"}}(e)){case"string":return this.set({src:(0,s.createElement)("div",{innerHTML:e})});case"element":return this.set({src:e});case"canvas":return this.set({canvas:e});case"img":return this.set({img:e});default:return this.error("Unknown source type.")}}))},A.prototype.to=function(e){switch(e){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},A.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then((function(){var e={position:"fixed",overflow:"hidden",zIndex:1e3,left:0,right:0,bottom:0,top:0,backgroundColor:"rgba(0,0,0,0.8)"},t={position:"absolute",width:this.prop.pageSize.inner.width+this.prop.pageSize.unit,left:0,right:0,top:0,height:"auto",margin:"auto",backgroundColor:"white"};e.opacity=0;var r=(0,s.cloneNode)(this.prop.src,this.opt.html2canvas.javascriptEnabled);this.prop.overlay=(0,s.createElement)("div",{className:"html2pdf__overlay",style:e}),this.prop.container=(0,s.createElement)("div",{className:"html2pdf__container",style:t}),this.prop.container.appendChild(r),this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay)}))},A.prototype.toCanvas=function(){var e=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(e).then((function(){var e=Object.assign({},this.opt.html2canvas);return delete e.onrendered,o(this.prop.container,e)})).then((function(e){(this.opt.html2canvas.onrendered||function(){})(e),this.prop.canvas=e,document.body.removeChild(this.prop.overlay)}))},A.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then((function(){var e=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=e}))},A.prototype.toPdf=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then((function(){var e=this.prop.canvas,t=this.opt,r=e.height,o=Math.floor(e.width*this.prop.pageSize.inner.ratio),s=Math.ceil(r/o),i=this.prop.pageSize.inner.height,a=document.createElement("canvas"),A=a.getContext("2d");a.width=e.width,a.height=o,this.prop.pdf=this.prop.pdf||new n.jsPDF(t.jsPDF);for(var u=0;u<s;u++){u===s-1&&r%o!=0&&(a.height=r%o,i=a.height*this.prop.pageSize.inner.width/a.width);var c=a.width,l=a.height;A.fillStyle="white",A.fillRect(0,0,c,l),A.drawImage(e,0,u*o,c,l,0,0,c,l),u&&this.prop.pdf.addPage();var d=a.toDataURL("image/"+t.image.type,t.image.quality);this.prop.pdf.addImage(d,t.image.type,t.margin[1],t.margin[0],this.prop.pageSize.inner.width,i)}}))},A.prototype.output=function(e,t,r){return"img"===(r=r||"pdf").toLowerCase()||"image"===r.toLowerCase()?this.outputImg(e,t):this.outputPdf(e,t)},A.prototype.outputPdf=function(e,t){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then((function(){return this.prop.pdf.output(e,t)}))},A.prototype.outputImg=function(e,t){return this.thenList([function(){return this.prop.img||this.toImg()}]).then((function(){switch(e){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+e+'" is not supported.'}}))},A.prototype.save=function(e){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(e?{filename:e}:null).then((function(){this.prop.pdf.save(this.opt.filename)}))},A.prototype.set=function(e){if("object"!==(0,s.objType)(e))return this;var t=Object.keys(e||{}).map((function(t){switch(t){case"margin":return this.setMargin.bind(this,e.margin);case"jsPDF":return function(){return this.opt.jsPDF=e.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,e.pageSize);default:return t in A.template.prop?function(){this.prop[t]=e[t]}:function(){this.opt[t]=e[t]}}}),this);return this.then((function(){return this.thenList(t)}))},A.prototype.get=function(e,t){return this.then((function(){var r=e in A.template.prop?this.prop[e]:this.opt[e];return t?t(r):r}))},A.prototype.setMargin=function(e){return this.then((function(){switch((0,s.objType)(e)){case"number":e=[e,e,e,e];case"array":if(2===e.length&&(e=[e[0],e[1],e[0],e[1]]),4===e.length)break;default:return this.error("Invalid margin array.")}this.opt.margin=e})).then(this.setPageSize)},A.prototype.setPageSize=function(e){return this.then((function(){(e=e||n.jsPDF.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(e.inner={width:e.width-this.opt.margin[1]-this.opt.margin[3],height:e.height-this.opt.margin[0]-this.opt.margin[2]},e.inner.px={width:(0,s.toPx)(e.inner.width,e.k),height:(0,s.toPx)(e.inner.height,e.k)},e.inner.ratio=e.inner.height/e.inner.width),this.prop.pageSize=e}))},A.prototype.setProgress=function(e,t,r,n){return null!=e&&(this.progress.val=e),null!=t&&(this.progress.state=t),null!=r&&(this.progress.n=r),null!=n&&(this.progress.stack=n),this.progress.ratio=this.progress.val/this.progress.state,this},A.prototype.updateProgress=function(e,t,r,n){return this.setProgress(e?this.progress.val+e:null,t||null,r?this.progress.n+r:null,n?this.progress.stack.concat(n):null)},A.prototype.then=function(e,t){var r=this;return this.thenCore(e,t,(function(e,t){return r.updateProgress(null,null,1,[e]),a.prototype.then.call(this,(function(t){return r.updateProgress(null,e),t})).then(e,t).then((function(e){return r.updateProgress(1),e}))}))},A.prototype.thenCore=function(e,t,r){r=r||a.prototype.then;var n=this;e&&(e=e.bind(n)),t&&(t=t.bind(n));var o=-1!==a.toString().indexOf("[native code]")&&"Promise"===a.name?n:A.convert(Object.assign({},n),a.prototype),s=r.call(o,e,t);return A.convert(s,n.__proto__)},A.prototype.thenExternal=function(e,t){return a.prototype.then.call(this,e,t)},A.prototype.thenList=function(e){var t=this;return e.forEach((function(e){t=t.thenCore(e)})),t},A.prototype.catch=function(e){e&&(e=e.bind(this));var t=a.prototype.catch.call(this,e);return A.convert(t,this)},A.prototype.catchExternal=function(e){return a.prototype.catch.call(this,e)},A.prototype.error=function(e){return this.then((function(){throw new Error(e)}))},A.prototype.using=A.prototype.set,A.prototype.saveAs=A.prototype.save,A.prototype.export=A.prototype.output,A.prototype.run=A.prototype.then,t.default=A},"./node_modules/canvg/lib/index.es.js":function(e,t,r){"use strict";r.r(t),r.d(t,{AElement:function(){return pr},AnimateColorElement:function(){return ar},AnimateElement:function(){return ir},AnimateTransformElement:function(){return Ar},BoundingBox:function(){return Ot},CB1:function(){return at},CB2:function(){return At},CB3:function(){return ut},CB4:function(){return ct},Canvg:function(){return qr},CircleElement:function(){return Gt},ClipPathElement:function(){return Sr},DefsElement:function(){return er},DescElement:function(){return kr},Document:function(){return Kr},Element:function(){return St},EllipseElement:function(){return Xt},FeColorMatrixElement:function(){return Qr},FeCompositeElement:function(){return Ir},FeDropShadowElement:function(){return Tr},FeGaussianBlurElement:function(){return Pr},FeMorphologyElement:function(){return Hr},FilterElement:function(){return Lr},Font:function(){return Pt},FontElement:function(){return cr},FontFaceElement:function(){return lr},GElement:function(){return tr},GlyphElement:function(){return fr},GradientElement:function(){return rr},ImageElement:function(){return wr},LineElement:function(){return Wt},LinearGradientElement:function(){return nr},MarkerElement:function(){return $t},MaskElement:function(){return Fr},Matrix:function(){return Et},MissingGlyphElement:function(){return dr},Mouse:function(){return gt},PSEUDO_ZERO:function(){return nt},Parser:function(){return jt},PathElement:function(){return zt},PathParser:function(){return Kt},PatternElement:function(){return Zt},Point:function(){return mt},PolygonElement:function(){return Yt},PolylineElement:function(){return Jt},Property:function(){return ht},QB1:function(){return lt},QB2:function(){return dt},QB3:function(){return ft},RadialGradientElement:function(){return or},RectElement:function(){return qt},RenderedElement:function(){return kt},Rotate:function(){return Ct},SVGElement:function(){return Vt},SVGFontLoader:function(){return Br},Scale:function(){return xt},Screen:function(){return wt},Skew:function(){return Nt},SkewX:function(){return Qt},SkewY:function(){return Ft},StopElement:function(){return sr},StyleElement:function(){return jr},SymbolElement:function(){return br},TRefElement:function(){return hr},TSpanElement:function(){return Mt},TextElement:function(){return Rt},TextPathElement:function(){return vr},TitleElement:function(){return Or},Transform:function(){return Ut},Translate:function(){return _t},UnknownElement:function(){return Lt},UseElement:function(){return _r},ViewPort:function(){return pt},compressSpaces:function(){return Re},getSelectorSpecificity:function(){return rt},normalizeAttributeName:function(){return Ve},normalizeColor:function(){return Ge},parseExternalUrl:function(){return qe},presets:function(){return Gr},toNumbers:function(){return Ke},trimLeft:function(){return Me},trimRight:function(){return De},vectorMagnitude:function(){return ot},vectorsAngle:function(){return it},vectorsRatio:function(){return st}});var n=r("./node_modules/@babel/runtime-corejs3/core-js-stable/instance/starts-with.js"),o=r.n(n),s=r("./node_modules/@babel/runtime-corejs3/core-js-stable/parse-float.js"),i=r.n(s),a=r("./node_modules/@babel/runtime-corejs3/core-js-stable/instance/map.js"),A=r.n(a),u=r("./node_modules/@babel/runtime-corejs3/helpers/esm/slicedToArray.js"),c=r("./node_modules/@babel/runtime-corejs3/core-js-stable/object/define-property.js"),l=r.n(c),d=r("./node_modules/@babel/runtime-corejs3/core-js-stable/object/define-properties.js"),f=r.n(d),h=r("./node_modules/@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptors.js"),p=r.n(h),m=r("./node_modules/@babel/runtime-corejs3/core-js-stable/instance/for-each.js"),g=r.n(m),y=r("./node_modules/@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptor.js"),v=r.n(y),w=r("./node_modules/@babel/runtime-corejs3/core-js-stable/instance/filter.js"),b=r.n(w),B=r("./node_modules/@babel/runtime-corejs3/core-js-stable/object/get-own-property-symbols.js"),j=r.n(B),_=r("./node_modules/@babel/runtime-corejs3/core-js-stable/object/keys.js"),C=r.n(_),x=r("./node_modules/@babel/runtime-corejs3/regenerator/index.js"),E=r.n(x),N=r("./node_modules/@babel/runtime-corejs3/helpers/esm/asyncToGenerator.js"),Q=r("./node_modules/@babel/runtime-corejs3/helpers/esm/defineProperty.js"),F=r("./node_modules/@babel/runtime-corejs3/helpers/esm/classCallCheck.js"),U=r("./node_modules/@babel/runtime-corejs3/helpers/esm/createClass.js"),S=r("./node_modules/@babel/runtime-corejs3/core-js-stable/instance/concat.js"),L=r.n(S),T=r("./node_modules/@babel/runtime-corejs3/core-js-stable/instance/reduce.js"),H=r.n(T),I=r("./node_modules/@babel/runtime-corejs3/core-js-stable/date/now.js"),P=r.n(I),O=r("./node_modules/@babel/runtime-corejs3/core-js-stable/instance/every.js"),k=r.n(O),R=r("./node_modules/@babel/runtime-corejs3/core-js-stable/promise.js"),M=r.n(R),D=r("./node_modules/@babel/runtime-corejs3/core-js-stable/instance/bind.js"),K=r.n(D),z=r("./node_modules/raf/index.js"),V=r.n(z),q=r("./node_modules/@babel/runtime-corejs3/core-js-stable/instance/trim.js"),G=r.n(q),X=r("./node_modules/rgbcolor/index.js"),W=r.n(X),J=r("./node_modules/@babel/runtime-corejs3/core-js-stable/reflect/construct.js"),Y=r.n(J),Z=r("./node_modules/@babel/runtime-corejs3/helpers/esm/inherits.js"),$=r("./node_modules/@babel/runtime-corejs3/helpers/esm/possibleConstructorReturn.js"),ee=r("./node_modules/@babel/runtime-corejs3/helpers/esm/getPrototypeOf.js"),te=r("./node_modules/@babel/runtime-corejs3/helpers/esm/toConsumableArray.js"),re=r("./node_modules/@babel/runtime-corejs3/core-js-stable/instance/some.js"),ne=r.n(re),oe=r("./node_modules/@babel/runtime-corejs3/core-js-stable/instance/includes.js"),se=r.n(oe),ie=r("./node_modules/@babel/runtime-corejs3/core-js-stable/array/from.js"),ae=r.n(ie),Ae=r("./node_modules/@babel/runtime-corejs3/core-js-stable/instance/reverse.js"),ue=r.n(Ae),ce=r("./node_modules/@babel/runtime-corejs3/core-js-stable/instance/index-of.js"),le=r.n(ce),de=r("./node_modules/@babel/runtime-corejs3/helpers/esm/get.js"),fe=r("./node_modules/@babel/runtime-corejs3/core-js-stable/instance/fill.js"),he=r.n(fe),pe=r("./node_modules/svg-pathdata/lib/SVGPathData.module.js"),me=r("./node_modules/@babel/runtime-corejs3/core-js-stable/reflect/delete-property.js"),ge=r.n(me),ye=r("./node_modules/@babel/runtime-corejs3/helpers/esm/assertThisInitialized.js"),ve=r("./node_modules/@babel/runtime-corejs3/core-js-stable/instance/values.js"),we=r.n(ve),be=r("./node_modules/@babel/runtime-corejs3/core-js-stable/parse-int.js"),Be=r.n(be),je=r("./node_modules/@babel/runtime-corejs3/core-js/get-iterator.js"),_e=r.n(je),Ce=r("./node_modules/@babel/runtime-corejs3/core-js-stable/array/is-array.js"),xe=r.n(Ce),Ee=r("./node_modules/@babel/runtime-corejs3/core-js/get-iterator-method.js"),Ne=r.n(Ee),Qe=r("./node_modules/@babel/runtime-corejs3/core-js-stable/symbol.js"),Fe=r.n(Qe),Ue=r("./node_modules/@babel/runtime-corejs3/core-js-stable/instance/slice.js"),Se=r.n(Ue),Le=r("./node_modules/@babel/runtime-corejs3/core-js-stable/map.js"),Te=r.n(Le),He=r("./node_modules/@babel/runtime-corejs3/core-js-stable/reflect/apply.js"),Ie=r.n(He),Pe=r("./node_modules/@babel/runtime-corejs3/core-js-stable/reflect/get-prototype-of.js"),Oe=r.n(Pe),ke=r("./node_modules/stackblur-canvas/dist/stackblur-es.js");function Re(e){return e.replace(/(?!\u3000)\s+/gm," ")}function Me(e){return e.replace(/^[\n \t]+/,"")}function De(e){return e.replace(/[\n \t]+$/,"")}function Ke(e){var t=(e||"").match(/-?(\d+(?:\.\d*(?:[eE][+-]?\d+)?)?|\.\d+)(?=\D|$)/gm)||[];return A()(t).call(t,i())}var ze=/^[A-Z-]+$/;function Ve(e){return ze.test(e)?e.toLowerCase():e}function qe(e){var t=e.match(/url\(('([^']+)'|"([^"]+)"|([^'"\)]+))\)/)||[];return t[2]||t[3]||t[4]}function Ge(e){if(!o()(e).call(e,"rgb"))return e;var t=3;return e.replace(/\d+(\.\d+)?/g,(function(e,r){return t--&&r?String(Math.round(i()(e))):e}))}var Xe=/(\[[^\]]+\])/g,We=/(#[^\s\+>~\.\[:]+)/g,Je=/(\.[^\s\+>~\.\[:]+)/g,Ye=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,Ze=/(:[\w-]+\([^\)]*\))/gi,$e=/(:[^\s\+>~\.\[:]+)/g,et=/([^\s\+>~\.\[:]+)/g;function tt(e,t){var r=e.match(t);return r?[e.replace(t," "),r.length]:[e,0]}function rt(e){var t=[0,0,0],r=e.replace(/:not\(([^\)]*)\)/g,"     $1 ").replace(/{[\s\S]*/gm," "),n=0,o=tt(r,Xe),s=(0,u.default)(o,2);r=s[0],n=s[1],t[1]+=n;var i=tt(r,We),a=(0,u.default)(i,2);r=a[0],n=a[1],t[0]+=n;var A=tt(r,Je),c=(0,u.default)(A,2);r=c[0],n=c[1],t[1]+=n;var l=tt(r,Ye),d=(0,u.default)(l,2);r=d[0],n=d[1],t[2]+=n;var f=tt(r,Ze),h=(0,u.default)(f,2);r=h[0],n=h[1],t[1]+=n;var p=tt(r,$e),m=(0,u.default)(p,2);r=m[0],n=m[1],t[1]+=n;var g=tt(r=r.replace(/[\*\s\+>~]/g," ").replace(/[#\.]/g," "),et),y=(0,u.default)(g,2);return r=y[0],n=y[1],t[2]+=n,t.join("")}var nt=1e-8;function ot(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))}function st(e,t){return(e[0]*t[0]+e[1]*t[1])/(ot(e)*ot(t))}function it(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(st(e,t))}function at(e){return e*e*e}function At(e){return 3*e*e*(1-e)}function ut(e){return 3*e*(1-e)*(1-e)}function ct(e){return(1-e)*(1-e)*(1-e)}function lt(e){return e*e}function dt(e){return 2*e*(1-e)}function ft(e){return(1-e)*(1-e)}var ht=function(){function e(t,r,n){(0,F.default)(this,e),this.document=t,this.name=r,this.value=n,this.isNormalizedColor=!1}return(0,U.default)(e,[{key:"split",value:function(){var t,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:" ",o=this.document,s=this.name;return A()(t=G()(r=Re(this.getString())).call(r).split(n)).call(t,(function(t){return new e(o,s,t)}))}},{key:"hasValue",value:function(e){var t=this.value;return null!==t&&""!==t&&(e||0!==t)&&void 0!==t}},{key:"isString",value:function(e){var t=this.value,r="string"==typeof t;return r&&e?e.test(t):r}},{key:"isUrlDefinition",value:function(){return this.isString(/^url\(/)}},{key:"isPixels",value:function(){if(!this.hasValue())return!1;var e=this.getString();switch(!0){case/px$/.test(e):case/^[0-9]+$/.test(e):return!0;default:return!1}}},{key:"setValue",value:function(e){return this.value=e,this}},{key:"getValue",value:function(e){return void 0===e||this.hasValue()?this.value:e}},{key:"getNumber",value:function(e){if(!this.hasValue())return void 0===e?0:i()(e);var t=this.value,r=i()(t);return this.isString(/%$/)&&(r/=100),r}},{key:"getString",value:function(e){return void 0===e||this.hasValue()?void 0===this.value?"":String(this.value):String(e)}},{key:"getColor",value:function(e){var t=this.getString(e);return this.isNormalizedColor||(this.isNormalizedColor=!0,t=Ge(t),this.value=t),t}},{key:"getDpi",value:function(){return 96}},{key:"getRem",value:function(){return this.document.rootEmSize}},{key:"getEm",value:function(){return this.document.emSize}},{key:"getUnits",value:function(){return this.getString().replace(/[0-9\.\-]/g,"")}},{key:"getPixels",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.hasValue())return 0;var r="boolean"==typeof e?[void 0,e]:[e],n=(0,u.default)(r,2),o=n[0],s=n[1],i=this.document.screen.viewPort;switch(!0){case this.isString(/vmin$/):return this.getNumber()/100*Math.min(i.computeSize("x"),i.computeSize("y"));case this.isString(/vmax$/):return this.getNumber()/100*Math.max(i.computeSize("x"),i.computeSize("y"));case this.isString(/vw$/):return this.getNumber()/100*i.computeSize("x");case this.isString(/vh$/):return this.getNumber()/100*i.computeSize("y");case this.isString(/rem$/):return this.getNumber()*this.getRem();case this.isString(/em$/):return this.getNumber()*this.getEm();case this.isString(/ex$/):return this.getNumber()*this.getEm()/2;case this.isString(/px$/):return this.getNumber();case this.isString(/pt$/):return this.getNumber()*this.getDpi()*(1/72);case this.isString(/pc$/):return 15*this.getNumber();case this.isString(/cm$/):return this.getNumber()*this.getDpi()/2.54;case this.isString(/mm$/):return this.getNumber()*this.getDpi()/25.4;case this.isString(/in$/):return this.getNumber()*this.getDpi();case this.isString(/%$/)&&s:return this.getNumber()*this.getEm();case this.isString(/%$/):return this.getNumber()*i.computeSize(o);default:var a=this.getNumber();return t&&a<1?a*i.computeSize(o):a}}},{key:"getMilliseconds",value:function(){return this.hasValue()?this.isString(/ms$/)?this.getNumber():1e3*this.getNumber():0}},{key:"getRadians",value:function(){if(!this.hasValue())return 0;switch(!0){case this.isString(/deg$/):return this.getNumber()*(Math.PI/180);case this.isString(/grad$/):return this.getNumber()*(Math.PI/200);case this.isString(/rad$/):return this.getNumber();default:return this.getNumber()*(Math.PI/180)}}},{key:"getDefinition",value:function(){var e=this.getString(),t=e.match(/#([^\)'"]+)/);return t&&(t=t[1]),t||(t=e),this.document.definitions[t]}},{key:"getFillStyleDefinition",value:function(e,t){var r=this.getDefinition();if(!r)return null;if("function"==typeof r.createGradient)return r.createGradient(this.document.ctx,e,t);if("function"==typeof r.createPattern){if(r.getHrefAttribute().hasValue()){var n=r.getAttribute("patternTransform");r=r.getHrefAttribute().getDefinition(),n.hasValue()&&r.getAttribute("patternTransform",!0).setValue(n.value)}return r.createPattern(this.document.ctx,e,t)}return null}},{key:"getTextBaseline",value:function(){return this.hasValue()?e.textBaselineMapping[this.getString()]:null}},{key:"addOpacity",value:function(t){for(var r=this.getColor(),n=r.length,o=0,s=0;s<n&&(","===r[s]&&o++,3!==o);s++);if(t.hasValue()&&this.isString()&&3!==o){var i=new(W())(r);i.ok&&(i.alpha=t.getNumber(),r=i.toRGBA())}return new e(this.document,this.name,r)}}],[{key:"empty",value:function(t){return new e(t,"EMPTY","")}}]),e}();ht.textBaselineMapping={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};var pt=function(){function e(){(0,F.default)(this,e),this.viewPorts=[]}return(0,U.default)(e,[{key:"clear",value:function(){this.viewPorts=[]}},{key:"setCurrent",value:function(e,t){this.viewPorts.push({width:e,height:t})}},{key:"removeCurrent",value:function(){this.viewPorts.pop()}},{key:"getCurrent",value:function(){var e=this.viewPorts;return e[e.length-1]}},{key:"computeSize",value:function(e){return"number"==typeof e?e:"x"===e?this.width:"y"===e?this.height:Math.sqrt(Math.pow(this.width,2)+Math.pow(this.height,2))/Math.sqrt(2)}},{key:"width",get:function(){return this.getCurrent().width}},{key:"height",get:function(){return this.getCurrent().height}}]),e}(),mt=function(){function e(t,r){(0,F.default)(this,e),this.x=t,this.y=r}return(0,U.default)(e,[{key:"angleTo",value:function(e){return Math.atan2(e.y-this.y,e.x-this.x)}},{key:"applyTransform",value:function(e){var t=this.x,r=this.y,n=t*e[0]+r*e[2]+e[4],o=t*e[1]+r*e[3]+e[5];this.x=n,this.y=o}}],[{key:"parse",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Ke(t),o=(0,u.default)(n,2),s=o[0],i=void 0===s?r:s,a=o[1],A=void 0===a?r:a;return new e(i,A)}},{key:"parseScale",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=Ke(t),o=(0,u.default)(n,2),s=o[0],i=void 0===s?r:s,a=o[1],A=void 0===a?i:a;return new e(i,A)}},{key:"parsePath",value:function(t){for(var r=Ke(t),n=r.length,o=[],s=0;s<n;s+=2)o.push(new e(r[s],r[s+1]));return o}}]),e}(),gt=function(){function e(t){var r,n;(0,F.default)(this,e),this.screen=t,this.working=!1,this.events=[],this.eventElements=[],this.onClick=K()(r=this.onClick).call(r,this),this.onMouseMove=K()(n=this.onMouseMove).call(n,this)}return(0,U.default)(e,[{key:"isWorking",value:function(){return this.working}},{key:"start",value:function(){if(!this.working){var e=this.screen,t=this.onClick,r=this.onMouseMove,n=e.ctx.canvas;n.onclick=t,n.onmousemove=r,this.working=!0}}},{key:"stop",value:function(){if(this.working){var e=this.screen.ctx.canvas;this.working=!1,e.onclick=null,e.onmousemove=null}}},{key:"hasEvents",value:function(){return this.working&&this.events.length>0}},{key:"runEvents",value:function(){if(this.working){var e=this.screen,t=this.events,r=this.eventElements,n=e.ctx.canvas.style;n&&(n.cursor=""),g()(t).call(t,(function(e,t){for(var n=e.run,o=r[t];o;)n(o),o=o.parent})),this.events=[],this.eventElements=[]}}},{key:"checkPath",value:function(e,t){if(this.working&&t){var r=this.events,n=this.eventElements;g()(r).call(r,(function(r,o){var s=r.x,i=r.y;!n[o]&&t.isPointInPath&&t.isPointInPath(s,i)&&(n[o]=e)}))}}},{key:"checkBoundingBox",value:function(e,t){if(this.working&&t){var r=this.events,n=this.eventElements;g()(r).call(r,(function(r,o){var s=r.x,i=r.y;!n[o]&&t.isPointInBox(s,i)&&(n[o]=e)}))}}},{key:"mapXY",value:function(e,t){for(var r=this.screen,n=r.window,o=r.ctx,s=new mt(e,t),i=o.canvas;i;)s.x-=i.offsetLeft,s.y-=i.offsetTop,i=i.offsetParent;return n.scrollX&&(s.x+=n.scrollX),n.scrollY&&(s.y+=n.scrollY),s}},{key:"onClick",value:function(e){var t=this.mapXY((e||event).clientX,(e||event).clientY),r=t.x,n=t.y;this.events.push({type:"onclick",x:r,y:n,run:function(e){e.onClick&&e.onClick()}})}},{key:"onMouseMove",value:function(e){var t=this.mapXY((e||event).clientX,(e||event).clientY),r=t.x,n=t.y;this.events.push({type:"onmousemove",x:r,y:n,run:function(e){e.onMouseMove&&e.onMouseMove()}})}}]),e}(),yt="undefined"!=typeof window?window:null,vt="undefined"!=typeof fetch?K()(fetch).call(fetch,void 0):null,wt=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.fetch,o=void 0===n?vt:n,s=r.window,i=void 0===s?yt:s;(0,F.default)(this,e),this.ctx=t,this.FRAMERATE=30,this.MAX_VIRTUAL_PIXELS=3e4,this.CLIENT_WIDTH=800,this.CLIENT_HEIGHT=600,this.viewPort=new pt,this.mouse=new gt(this),this.animations=[],this.waits=[],this.frameDuration=0,this.isReadyLock=!1,this.isFirstRender=!0,this.intervalId=null,this.window=i,this.fetch=o}return(0,U.default)(e,[{key:"wait",value:function(e){this.waits.push(e)}},{key:"ready",value:function(){return this.readyPromise?this.readyPromise:M().resolve()}},{key:"isReady",value:function(){var e;if(this.isReadyLock)return!0;var t=k()(e=this.waits).call(e,(function(e){return e()}));return t&&(this.waits=[],this.resolveReady&&this.resolveReady()),this.isReadyLock=t,t}},{key:"setDefaults",value:function(e){e.strokeStyle="rgba(0,0,0,0)",e.lineCap="butt",e.lineJoin="miter",e.miterLimit=4}},{key:"setViewBox",value:function(e){var t=e.document,r=e.ctx,n=e.aspectRatio,o=e.width,s=e.desiredWidth,i=e.height,a=e.desiredHeight,A=e.minX,c=void 0===A?0:A,l=e.minY,d=void 0===l?0:l,f=e.refX,h=e.refY,p=e.clip,m=void 0!==p&&p,g=e.clipX,y=void 0===g?0:g,v=e.clipY,w=void 0===v?0:v,b=Re(n).replace(/^defer\s/,"").split(" "),B=(0,u.default)(b,2),j=B[0]||"xMidYMid",_=B[1]||"meet",C=o/s,x=i/a,E=Math.min(C,x),N=Math.max(C,x),Q=s,F=a;"meet"===_&&(Q*=E,F*=E),"slice"===_&&(Q*=N,F*=N);var U=new ht(t,"refX",f),S=new ht(t,"refY",h),L=U.hasValue()&&S.hasValue();if(L&&r.translate(-E*U.getPixels("x"),-E*S.getPixels("y")),m){var T=E*y,H=E*w;r.beginPath(),r.moveTo(T,H),r.lineTo(o,H),r.lineTo(o,i),r.lineTo(T,i),r.closePath(),r.clip()}if(!L){var I="meet"===_&&E===x,P="slice"===_&&N===x,O="meet"===_&&E===C,k="slice"===_&&N===C;/^xMid/.test(j)&&(I||P)&&r.translate(o/2-Q/2,0),/YMid$/.test(j)&&(O||k)&&r.translate(0,i/2-F/2),/^xMax/.test(j)&&(I||P)&&r.translate(o-Q,0),/YMax$/.test(j)&&(O||k)&&r.translate(0,i-F)}switch(!0){case"none"===j:r.scale(C,x);break;case"meet"===_:r.scale(E,E);break;case"slice"===_:r.scale(N,N)}r.translate(-c,-d)}},{key:"start",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.enableRedraw,o=void 0!==n&&n,s=r.ignoreMouse,i=void 0!==s&&s,a=r.ignoreAnimation,A=void 0!==a&&a,u=r.ignoreDimensions,c=void 0!==u&&u,l=r.ignoreClear,d=void 0!==l&&l,f=r.forceRedraw,h=r.scaleWidth,p=r.scaleHeight,m=r.offsetX,g=r.offsetY,y=this.FRAMERATE,v=this.mouse,w=1e3/y;if(this.frameDuration=w,this.readyPromise=new(M())((function(e){t.resolveReady=e})),this.isReady()&&this.render(e,c,d,h,p,m,g),o){var b=P()(),B=b,j=0,_=function r(){b=P()(),(j=b-B)>=w&&(B=b-j%w,t.shouldUpdate(A,f)&&(t.render(e,c,d,h,p,m,g),v.runEvents())),t.intervalId=V()(r)};i||v.start(),this.intervalId=V()(_)}}},{key:"stop",value:function(){this.intervalId&&(V().cancel(this.intervalId),this.intervalId=null),this.mouse.stop()}},{key:"shouldUpdate",value:function(e,t){if(!e){var r,n=this.frameDuration;if(H()(r=this.animations).call(r,(function(e,t){return t.update(n)||e}),!1))return!0}return!("function"!=typeof t||!t())||!(this.isReadyLock||!this.isReady())||!!this.mouse.hasEvents()}},{key:"render",value:function(e,t,r,n,o,s,i){var a=this.CLIENT_WIDTH,A=this.CLIENT_HEIGHT,u=this.viewPort,c=this.ctx,l=this.isFirstRender,d=c.canvas;u.clear(),d.width&&d.height?u.setCurrent(d.width,d.height):u.setCurrent(a,A);var f=e.getStyle("width"),h=e.getStyle("height");!t&&(l||"number"!=typeof n&&"number"!=typeof o)&&(f.hasValue()&&(d.width=f.getPixels("x"),d.style&&(d.style.width="".concat(d.width,"px"))),h.hasValue()&&(d.height=h.getPixels("y"),d.style&&(d.style.height="".concat(d.height,"px"))));var p=d.clientWidth||d.width,m=d.clientHeight||d.height;if(t&&f.hasValue()&&h.hasValue()&&(p=f.getPixels("x"),m=h.getPixels("y")),u.setCurrent(p,m),"number"==typeof s&&e.getAttribute("x",!0).setValue(s),"number"==typeof i&&e.getAttribute("y",!0).setValue(i),"number"==typeof n||"number"==typeof o){var g,y,v=Ke(e.getAttribute("viewBox").getString()),w=0,b=0;if("number"==typeof n){var B=e.getStyle("width");B.hasValue()?w=B.getPixels("x")/n:isNaN(v[2])||(w=v[2]/n)}if("number"==typeof o){var j=e.getStyle("height");j.hasValue()?b=j.getPixels("y")/o:isNaN(v[3])||(b=v[3]/o)}w||(w=b),b||(b=w),e.getAttribute("width",!0).setValue(n),e.getAttribute("height",!0).setValue(o);var _=e.getStyle("transform",!0,!0);_.setValue(L()(g=L()(y="".concat(_.getString()," scale(")).call(y,1/w,", ")).call(g,1/b,")"))}r||c.clearRect(0,0,p,m),e.render(c),l&&(this.isFirstRender=!1)}}]),e}();wt.defaultWindow=yt,wt.defaultFetch=vt;var bt=wt.defaultFetch,Bt="undefined"!=typeof DOMParser?DOMParser:null,jt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.fetch,n=void 0===r?bt:r,o=t.DOMParser,s=void 0===o?Bt:o;(0,F.default)(this,e),this.fetch=n,this.DOMParser=s}var t,r;return(0,U.default)(e,[{key:"parse",value:(r=(0,N.default)(E().mark((function e(t){return E().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!/^</.test(t)){e.next=2;break}return e.abrupt("return",this.parseFromString(t));case 2:return e.abrupt("return",this.load(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"parseFromString",value:function(e){var t=new this.DOMParser;try{return this.checkDocument(t.parseFromString(e,"image/svg+xml"))}catch(r){return this.checkDocument(t.parseFromString(e,"text/xml"))}}},{key:"checkDocument",value:function(e){var t=e.getElementsByTagName("parsererror")[0];if(t)throw new Error(t.textContent);return e}},{key:"load",value:(t=(0,N.default)(E().mark((function e(t){var r,n;return E().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(t);case 2:return r=e.sent,e.next=5,r.text();case 5:return n=e.sent,e.abrupt("return",this.parseFromString(n));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),_t=function(){function e(t,r){(0,F.default)(this,e),this.type="translate",this.point=null,this.point=mt.parse(r)}return(0,U.default)(e,[{key:"apply",value:function(e){var t=this.point,r=t.x,n=t.y;e.translate(r||0,n||0)}},{key:"unapply",value:function(e){var t=this.point,r=t.x,n=t.y;e.translate(-1*r||0,-1*n||0)}},{key:"applyToPoint",value:function(e){var t=this.point,r=t.x,n=t.y;e.applyTransform([1,0,0,1,r||0,n||0])}}]),e}(),Ct=function(){function e(t,r,n){(0,F.default)(this,e),this.type="rotate",this.angle=null,this.originX=null,this.originY=null,this.cx=0,this.cy=0;var o=Ke(r);this.angle=new ht(t,"angle",o[0]),this.originX=n[0],this.originY=n[1],this.cx=o[1]||0,this.cy=o[2]||0}return(0,U.default)(e,[{key:"apply",value:function(e){var t=this.cx,r=this.cy,n=this.originX,o=this.originY,s=this.angle,i=t+n.getPixels("x"),a=r+o.getPixels("y");e.translate(i,a),e.rotate(s.getRadians()),e.translate(-i,-a)}},{key:"unapply",value:function(e){var t=this.cx,r=this.cy,n=this.angle;e.translate(t,r),e.rotate(-1*n.getRadians()),e.translate(-t,-r)}},{key:"applyToPoint",value:function(e){var t=this.cx,r=this.cy,n=this.angle.getRadians();e.applyTransform([1,0,0,1,t||0,r||0]),e.applyTransform([Math.cos(n),Math.sin(n),-Math.sin(n),Math.cos(n),0,0]),e.applyTransform([1,0,0,1,-t||0,-r||0])}}]),e}(),xt=function(){function e(t,r){(0,F.default)(this,e),this.type="scale",this.scale=null;var n=mt.parseScale(r);0!==n.x&&0!==n.y||(n.x=nt,n.y=nt),this.scale=n}return(0,U.default)(e,[{key:"apply",value:function(e){var t=this.scale,r=t.x,n=t.y;e.scale(r,n||r)}},{key:"unapply",value:function(e){var t=this.scale,r=t.x,n=t.y;e.scale(1/r,1/n||r)}},{key:"applyToPoint",value:function(e){var t=this.scale,r=t.x,n=t.y;e.applyTransform([r||0,0,0,n||0,0,0])}}]),e}(),Et=function(){function e(t,r){(0,F.default)(this,e),this.type="matrix",this.matrix=[],this.matrix=Ke(r)}return(0,U.default)(e,[{key:"apply",value:function(e){var t=this.matrix;e.transform(t[0],t[1],t[2],t[3],t[4],t[5])}},{key:"unapply",value:function(e){var t=this.matrix,r=t[0],n=t[2],o=t[4],s=t[1],i=t[3],a=t[5],A=1/(r*(1*i-0*a)-n*(1*s-0*a)+o*(0*s-0*i));e.transform(A*(1*i-0*a),A*(0*a-1*s),A*(0*o-1*n),A*(1*r-0*o),A*(n*a-o*i),A*(o*s-r*a))}},{key:"applyToPoint",value:function(e){e.applyTransform(this.matrix)}}]),e}();var Nt=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(e,t){var r;return(0,F.default)(this,o),(r=n.call(this,e,t)).type="skew",r.angle=null,r.angle=new ht(e,"angle",t),r}return o}(Et);var Qt=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(e,t){var r;return(0,F.default)(this,o),(r=n.call(this,e,t)).type="skewX",r.matrix=[1,0,Math.tan(r.angle.getRadians()),1,0,0],r}return o}(Nt);var Ft=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(e,t){var r;return(0,F.default)(this,o),(r=n.call(this,e,t)).type="skewY",r.matrix=[1,Math.tan(r.angle.getRadians()),0,1,0,0],r}return o}(Nt),Ut=function(){function e(t,r,n){var o=this;(0,F.default)(this,e),this.document=t,this.transforms=[];var s=function(e){var t;return G()(t=Re(e)).call(t).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/)}(r);g()(s).call(s,(function(t){if("none"!==t){var r=function(e){var t=e.split("("),r=(0,u.default)(t,2),n=r[0],o=r[1];return[G()(n).call(n),G()(o).call(o).replace(")","")]}(t),s=(0,u.default)(r,2),i=s[0],a=s[1],A=e.transformTypes[i];void 0!==A&&o.transforms.push(new A(o.document,a,n))}}))}return(0,U.default)(e,[{key:"apply",value:function(e){for(var t=this.transforms,r=t.length,n=0;n<r;n++)t[n].apply(e)}},{key:"unapply",value:function(e){for(var t=this.transforms,r=t.length-1;r>=0;r--)t[r].unapply(e)}},{key:"applyToPoint",value:function(e){for(var t=this.transforms,r=t.length,n=0;n<r;n++)t[n].applyToPoint(e)}}],[{key:"fromElement",value:function(t,r){var n=r.getStyle("transform",!1,!0),o=r.getStyle("transform-origin",!1,!0).split(),s=(0,u.default)(o,2),i=s[0],a=s[1],A=[i,void 0===a?i:a];return n.hasValue()?new e(t,n.getString(),A):null}}]),e}();Ut.transformTypes={translate:_t,rotate:Ct,scale:xt,matrix:Et,skewX:Qt,skewY:Ft};var St=function(){function e(t,r){var n,o,s=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((0,F.default)(this,e),this.document=t,this.node=r,this.captureTextNodes=i,this.attributes={},this.styles={},this.stylesSpecificity={},this.animationFrozen=!1,this.animationFrozenValue="",this.parent=null,this.children=[],r&&1===r.nodeType){if(g()(n=ae()(r.attributes)).call(n,(function(e){var r=Ve(e.nodeName);s.attributes[r]=new ht(t,r,e.value)})),this.addStylesFromStyleDefinition(),this.getAttribute("style").hasValue()){var a,c=A()(a=this.getAttribute("style").getString().split(";")).call(a,(function(e){return G()(e).call(e)}));g()(c).call(c,(function(e){var r;if(e){var n=A()(r=e.split(":")).call(r,(function(e){return G()(e).call(e)})),o=(0,u.default)(n,2),i=o[0],a=o[1];s.styles[i]=new ht(t,i,a)}}))}var l=t.definitions,d=this.getAttribute("id");d.hasValue()&&(l[d.getValue()]||(l[d.getValue()]=this)),g()(o=ae()(r.childNodes)).call(o,(function(e){if(1===e.nodeType)s.addChild(e);else if(i&&(3===e.nodeType||4===e.nodeType)){var r=t.createTextNode(e);r.getText().length>0&&s.addChild(r)}}))}}return(0,U.default)(e,[{key:"getAttribute",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.attributes[e];if(!r&&t){var n=new ht(this.document,e,"");return this.attributes[e]=n,n}return r||ht.empty(this.document)}},{key:"getHrefAttribute",value:function(){for(var e in this.attributes)if("href"===e||/:href$/.test(e))return this.attributes[e];return ht.empty(this.document)}},{key:"getStyle",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.styles[e];if(n)return n;var o=this.getAttribute(e);if(o&&o.hasValue())return this.styles[e]=o,o;if(!r){var s=this.parent;if(s){var i=s.getStyle(e);if(i&&i.hasValue())return i}}if(t){var a=new ht(this.document,e,"");return this.styles[e]=a,a}return n||ht.empty(this.document)}},{key:"render",value:function(e){if("none"!==this.getStyle("display").getString()&&"hidden"!==this.getStyle("visibility").getString()){if(e.save(),this.getStyle("mask").hasValue()){var t=this.getStyle("mask").getDefinition();t&&(this.applyEffects(e),t.apply(e,this))}else if("none"!==this.getStyle("filter").getValue("none")){var r=this.getStyle("filter").getDefinition();r&&(this.applyEffects(e),r.apply(e,this))}else this.setContext(e),this.renderChildren(e),this.clearContext(e);e.restore()}}},{key:"setContext",value:function(e){}},{key:"applyEffects",value:function(e){var t=Ut.fromElement(this.document,this);t&&t.apply(e);var r=this.getStyle("clip-path",!1,!0);if(r.hasValue()){var n=r.getDefinition();n&&n.apply(e)}}},{key:"clearContext",value:function(e){}},{key:"renderChildren",value:function(e){var t;g()(t=this.children).call(t,(function(t){t.render(e)}))}},{key:"addChild",value:function(t){var r,n=t instanceof e?t:this.document.createElement(t);n.parent=this,se()(r=e.ignoreChildTypes).call(r,n.type)||this.children.push(n)}},{key:"matchesSelector",value:function(e){var t,r=this.node;if("function"==typeof r.matches)return r.matches(e);var n=r.getAttribute("class");return!(!n||""===n)&&ne()(t=n.split(" ")).call(t,(function(t){if(".".concat(t)===e)return!0}))}},{key:"addStylesFromStyleDefinition",value:function(){var e=this.document,t=e.styles,r=e.stylesSpecificity;for(var n in t)if("@"!==n[0]&&this.matchesSelector(n)){var o=t[n],s=r[n];if(o)for(var i in o){var a=this.stylesSpecificity[i];void 0===a&&(a="000"),s>=a&&(this.styles[i]=o[i],this.stylesSpecificity[i]=s)}}}},{key:"removeStyles",value:function(e,t){return H()(t).call(t,(function(t,r){var n,o=e.getStyle(r);if(!o.hasValue())return t;var s=o.getString();return o.setValue(""),L()(n=[]).call(n,(0,te.default)(t),[[r,s]])}),[])}},{key:"restoreStyles",value:function(e,t){g()(t).call(t,(function(t){var r=(0,u.default)(t,2),n=r[0],o=r[1];e.getStyle(n,!0).setValue(o)}))}}]),e}();St.ignoreChildTypes=["title"];var Lt=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(e,t,r){return(0,F.default)(this,o),n.call(this,e,t,r)}return o}(St);function Tt(e){var t=G()(e).call(e);return/^('|")/.test(t)?t:'"'.concat(t,'"')}function Ht(e){if(!e)return"";var t=G()(e).call(e).toLowerCase();switch(t){case"normal":case"italic":case"oblique":case"inherit":case"initial":case"unset":return t;default:return/^oblique\s+(-|)\d+deg$/.test(t)?t:""}}function It(e){if(!e)return"";var t=G()(e).call(e).toLowerCase();switch(t){case"normal":case"bold":case"lighter":case"bolder":case"inherit":case"initial":case"unset":return t;default:return/^[\d.]+$/.test(t)?t:""}}var Pt=function(){function e(t,r,n,o,s,i){(0,F.default)(this,e);var a=i?"string"==typeof i?e.parse(i):i:{};this.fontFamily=s||a.fontFamily,this.fontSize=o||a.fontSize,this.fontStyle=t||a.fontStyle,this.fontWeight=n||a.fontWeight,this.fontVariant=r||a.fontVariant}return(0,U.default)(e,[{key:"toString",value:function(){var e,t,r;return G()(e=[Ht(this.fontStyle),this.fontVariant,It(this.fontWeight),this.fontSize,(t=this.fontFamily,"undefined"==typeof process?t:A()(r=G()(t).call(t).split(",")).call(r,Tt).join(","))].join(" ")).call(e)}}],[{key:"parse",value:function(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1?arguments[1]:void 0,o="",s="",i="",a="",A="",c=G()(t=Re(r)).call(t).split(" "),l={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1};return g()(c).call(c,(function(t){var r,n,c;switch(!0){case!l.fontStyle&&se()(r=e.styles).call(r,t):"inherit"!==t&&(o=t),l.fontStyle=!0;break;case!l.fontVariant&&se()(n=e.variants).call(n,t):"inherit"!==t&&(s=t),l.fontStyle=!0,l.fontVariant=!0;break;case!l.fontWeight&&se()(c=e.weights).call(c,t):"inherit"!==t&&(i=t),l.fontStyle=!0,l.fontVariant=!0,l.fontWeight=!0;break;case!l.fontSize:if("inherit"!==t){var d=t.split("/"),f=(0,u.default)(d,1);a=f[0]}l.fontStyle=!0,l.fontVariant=!0,l.fontWeight=!0,l.fontSize=!0;break;default:"inherit"!==t&&(A+=t)}})),new e(o,s,i,a,A,n)}}]),e}();Pt.styles="normal|italic|oblique|inherit",Pt.variants="normal|small-caps|inherit",Pt.weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";var Ot=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.NaN,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.NaN,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.NaN,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.NaN;(0,F.default)(this,e),this.x1=t,this.y1=r,this.x2=n,this.y2=o,this.addPoint(t,r),this.addPoint(n,o)}return(0,U.default)(e,[{key:"addPoint",value:function(e,t){void 0!==e&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),void 0!==t&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))}},{key:"addX",value:function(e){this.addPoint(e,null)}},{key:"addY",value:function(e){this.addPoint(null,e)}},{key:"addBoundingBox",value:function(e){if(e){var t=e.x1,r=e.y1,n=e.x2,o=e.y2;this.addPoint(t,r),this.addPoint(n,o)}}},{key:"sumCubic",value:function(e,t,r,n,o){return Math.pow(1-e,3)*t+3*Math.pow(1-e,2)*e*r+3*(1-e)*Math.pow(e,2)*n+Math.pow(e,3)*o}},{key:"bezierCurveAdd",value:function(e,t,r,n,o){var s=6*t-12*r+6*n,i=-3*t+9*r-9*n+3*o,a=3*r-3*t;if(0!==i){var A=Math.pow(s,2)-4*a*i;if(!(A<0)){var u=(-s+Math.sqrt(A))/(2*i);0<u&&u<1&&(e?this.addX(this.sumCubic(u,t,r,n,o)):this.addY(this.sumCubic(u,t,r,n,o)));var c=(-s-Math.sqrt(A))/(2*i);0<c&&c<1&&(e?this.addX(this.sumCubic(c,t,r,n,o)):this.addY(this.sumCubic(c,t,r,n,o)))}}else{if(0===s)return;var l=-a/s;0<l&&l<1&&(e?this.addX(this.sumCubic(l,t,r,n,o)):this.addY(this.sumCubic(l,t,r,n,o)))}}},{key:"addBezierCurve",value:function(e,t,r,n,o,s,i,a){this.addPoint(e,t),this.addPoint(i,a),this.bezierCurveAdd(!0,e,r,o,i),this.bezierCurveAdd(!1,t,n,s,a)}},{key:"addQuadraticCurve",value:function(e,t,r,n,o,s){var i=e+2/3*(r-e),a=t+2/3*(n-t),A=i+1/3*(o-e),u=a+1/3*(s-t);this.addBezierCurve(e,t,i,A,a,u,o,s)}},{key:"isPointInBox",value:function(e,t){var r=this.x1,n=this.y1,o=this.x2,s=this.y2;return r<=e&&e<=o&&n<=t&&t<=s}},{key:"x",get:function(){return this.x1}},{key:"y",get:function(){return this.y1}},{key:"width",get:function(){return this.x2-this.x1}},{key:"height",get:function(){return this.y2-this.y1}}]),e}();var kt=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(){var e;return(0,F.default)(this,o),(e=n.apply(this,arguments)).modifiedEmSizeStack=!1,e}return(0,U.default)(o,[{key:"calculateOpacity",value:function(){for(var e=1,t=this;t;){var r=t.getStyle("opacity",!1,!0);r.hasValue(!0)&&(e*=r.getNumber()),t=t.parent}return e}},{key:"setContext",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t){var r=this.getStyle("fill"),n=this.getStyle("fill-opacity"),o=this.getStyle("stroke"),s=this.getStyle("stroke-opacity");if(r.isUrlDefinition()){var i=r.getFillStyleDefinition(this,n);i&&(e.fillStyle=i)}else if(r.hasValue()){"currentColor"===r.getString()&&r.setValue(this.getStyle("color").getColor());var a=r.getColor();"inherit"!==a&&(e.fillStyle="none"===a?"rgba(0,0,0,0)":a)}if(n.hasValue()){var A=new ht(this.document,"fill",e.fillStyle).addOpacity(n).getColor();e.fillStyle=A}if(o.isUrlDefinition()){var u=o.getFillStyleDefinition(this,s);u&&(e.strokeStyle=u)}else if(o.hasValue()){"currentColor"===o.getString()&&o.setValue(this.getStyle("color").getColor());var c=o.getString();"inherit"!==c&&(e.strokeStyle="none"===c?"rgba(0,0,0,0)":c)}if(s.hasValue()){var l=new ht(this.document,"stroke",e.strokeStyle).addOpacity(s).getString();e.strokeStyle=l}var d=this.getStyle("stroke-width");if(d.hasValue()){var f=d.getPixels();e.lineWidth=f||nt}var h=this.getStyle("stroke-linecap"),p=this.getStyle("stroke-linejoin"),m=this.getStyle("stroke-miterlimit"),g=this.getStyle("paint-order"),y=this.getStyle("stroke-dasharray"),v=this.getStyle("stroke-dashoffset");if(h.hasValue()&&(e.lineCap=h.getString()),p.hasValue()&&(e.lineJoin=p.getString()),m.hasValue()&&(e.miterLimit=m.getNumber()),g.hasValue()&&(e.paintOrder=g.getValue()),y.hasValue()&&"none"!==y.getString()){var w=Ke(y.getString());void 0!==e.setLineDash?e.setLineDash(w):void 0!==e.webkitLineDash?e.webkitLineDash=w:void 0===e.mozDash||1===w.length&&0===w[0]||(e.mozDash=w);var b=v.getPixels();void 0!==e.lineDashOffset?e.lineDashOffset=b:void 0!==e.webkitLineDashOffset?e.webkitLineDashOffset=b:void 0!==e.mozDashOffset&&(e.mozDashOffset=b)}}if(this.modifiedEmSizeStack=!1,void 0!==e.font){var B=this.getStyle("font"),j=this.getStyle("font-style"),_=this.getStyle("font-variant"),C=this.getStyle("font-weight"),x=this.getStyle("font-size"),E=this.getStyle("font-family"),N=new Pt(j.getString(),_.getString(),C.getString(),x.hasValue()?"".concat(x.getPixels(!0),"px"):"",E.getString(),Pt.parse(B.getString(),e.font));j.setValue(N.fontStyle),_.setValue(N.fontVariant),C.setValue(N.fontWeight),x.setValue(N.fontSize),E.setValue(N.fontFamily),e.font=N.toString(),x.isPixels()&&(this.document.emSize=x.getPixels(),this.modifiedEmSizeStack=!0)}t||(this.applyEffects(e),e.globalAlpha=this.calculateOpacity())}},{key:"clearContext",value:function(e){(0,de.default)((0,ee.default)(o.prototype),"clearContext",this).call(this,e),this.modifiedEmSizeStack&&this.document.popEmSize()}}]),o}(St);var Rt=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(e,t,r){var s;return(0,F.default)(this,o),(s=n.call(this,e,t,(this instanceof o?this.constructor:void 0)===o||r)).type="text",s.x=0,s.y=0,s.measureCache=-1,s}return(0,U.default)(o,[{key:"setContext",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,de.default)((0,ee.default)(o.prototype),"setContext",this).call(this,e,t);var r=this.getStyle("dominant-baseline").getTextBaseline()||this.getStyle("alignment-baseline").getTextBaseline();r&&(e.textBaseline=r)}},{key:"initializeCoordinates",value:function(e){this.x=this.getAttribute("x").getPixels("x"),this.y=this.getAttribute("y").getPixels("y");var t=this.getAttribute("dx"),r=this.getAttribute("dy");t.hasValue()&&(this.x+=t.getPixels("x")),r.hasValue()&&(this.y+=r.getPixels("y")),this.x+=this.getAnchorDelta(e,this,0)}},{key:"getBoundingBox",value:function(e){var t,r=this;if("text"!==this.type)return this.getTElementBoundingBox(e);this.initializeCoordinates(e);var n=null;return g()(t=this.children).call(t,(function(t,o){var s=r.getChildBoundingBox(e,r,r,o);n?n.addBoundingBox(s):n=s})),n}},{key:"getFontSize",value:function(){var e=this.document,t=this.parent,r=Pt.parse(e.ctx.font).fontSize;return t.getStyle("font-size").getNumber(r)}},{key:"getTElementBoundingBox",value:function(e){var t=this.getFontSize();return new Ot(this.x,this.y-t,this.x+this.measureText(e),this.y)}},{key:"getGlyph",value:function(e,t,r){var n=t[r],o=null;if(e.isArabic){var s=t.length,i=t[r-1],a=t[r+1],A="isolated";(0===r||" "===i)&&r<s-2&&" "!==a&&(A="terminal"),r>0&&" "!==i&&r<s-2&&" "!==a&&(A="medial"),r>0&&" "!==i&&(r===s-1||" "===a)&&(A="initial"),void 0!==e.glyphs[n]&&((o=e.glyphs[n][A])||"glyph"!==e.glyphs[n].type||(o=e.glyphs[n]))}else o=e.glyphs[n];return o||(o=e.missingGlyph),o}},{key:"getText",value:function(){return""}},{key:"getTextFromNode",value:function(e){var t=e||this.node,r=ae()(t.parentNode.childNodes),n=le()(r).call(r,t),o=r.length-1,s=Re(t.value||t.text||t.textContent||"");return 0===n&&(s=Me(s)),n===o&&(s=De(s)),s}},{key:"renderChildren",value:function(e){var t,r=this;if("text"===this.type){this.initializeCoordinates(e),g()(t=this.children).call(t,(function(t,n){r.renderChild(e,r,r,n)}));var n=this.document.screen.mouse;n.isWorking()&&n.checkBoundingBox(this,this.getBoundingBox(e))}else this.renderTElementChildren(e)}},{key:"renderTElementChildren",value:function(e){var t=this.document,r=this.parent,n=this.getText(),o=r.getStyle("font-family").getDefinition();if(o)for(var s,i=o.fontFace.unitsPerEm,a=Pt.parse(t.ctx.font),A=r.getStyle("font-size").getNumber(a.fontSize),u=r.getStyle("font-style").getString(a.fontStyle),c=A/i,l=o.isRTL?ue()(s=n.split("")).call(s).join(""):n,d=Ke(r.getAttribute("dx").getString()),f=l.length,h=0;h<f;h++){var p=this.getGlyph(o,l,h);e.translate(this.x,this.y),e.scale(c,-c);var m=e.lineWidth;e.lineWidth=e.lineWidth*i/A,"italic"===u&&e.transform(1,0,.4,1,0,0),p.render(e),"italic"===u&&e.transform(1,0,-.4,1,0,0),e.lineWidth=m,e.scale(1/c,-1/c),e.translate(-this.x,-this.y),this.x+=A*(p.horizAdvX||o.horizAdvX)/i,void 0===d[h]||isNaN(d[h])||(this.x+=d[h])}else{var g=this.x,y=this.y;"stroke"===e.paintOrder?(e.strokeStyle&&e.strokeText(n,g,y),e.fillStyle&&e.fillText(n,g,y)):(e.fillStyle&&e.fillText(n,g,y),e.strokeStyle&&e.strokeText(n,g,y))}}},{key:"getAnchorDelta",value:function(e,t,r){var n=this.getStyle("text-anchor").getString("start");if("start"!==n){for(var o=t.children,s=o.length,i=null,a=0,A=r;A<s&&(i=o[A],!(A>r&&i.getAttribute("x").hasValue()||i.getAttribute("text-anchor").hasValue()));A++)a+=i.measureTextRecursive(e);return-1*("end"===n?a:a/2)}return 0}},{key:"adjustChildCoordinates",value:function(e,t,r,n){var o=r.children[n];if("function"!=typeof o.measureText)return o;e.save(),o.setContext(e,!0);var s=o.getAttribute("x"),i=o.getAttribute("y"),a=o.getAttribute("dx"),A=o.getAttribute("dy"),u=o.getAttribute("text-anchor").getString("start");if(0===n&&"textNode"!==o.type&&(s.hasValue()||s.setValue(t.getAttribute("x").getValue("0")),i.hasValue()||i.setValue(t.getAttribute("y").getValue("0")),a.hasValue()||a.setValue(t.getAttribute("dx").getValue("0")),A.hasValue()||A.setValue(t.getAttribute("dy").getValue("0"))),s.hasValue()){if(o.x=s.getPixels("x")+t.getAnchorDelta(e,r,n),"start"!==u){var c=o.measureTextRecursive(e);o.x+=-1*("end"===u?c:c/2)}a.hasValue()&&(o.x+=a.getPixels("x"))}else{if("start"!==u){var l=o.measureTextRecursive(e);t.x+=-1*("end"===u?l:l/2)}a.hasValue()&&(t.x+=a.getPixels("x")),o.x=t.x}return t.x=o.x+o.measureText(e),i.hasValue()?(o.y=i.getPixels("y"),A.hasValue()&&(o.y+=A.getPixels("y"))):(A.hasValue()&&(t.y+=A.getPixels("y")),o.y=t.y),t.y=o.y,o.clearContext(e),e.restore(),o}},{key:"getChildBoundingBox",value:function(e,t,r,n){var o,s=this.adjustChildCoordinates(e,t,r,n);if("function"!=typeof s.getBoundingBox)return null;var i=s.getBoundingBox(e);return i?(g()(o=s.children).call(o,(function(r,n){var o=t.getChildBoundingBox(e,t,s,n);i.addBoundingBox(o)})),i):null}},{key:"renderChild",value:function(e,t,r,n){var o,s=this.adjustChildCoordinates(e,t,r,n);s.render(e),g()(o=s.children).call(o,(function(r,n){t.renderChild(e,t,s,n)}))}},{key:"measureTextRecursive",value:function(e){var t;return H()(t=this.children).call(t,(function(t,r){return t+r.measureTextRecursive(e)}),this.measureText(e))}},{key:"measureText",value:function(e){var t=this.measureCache;if(~t)return t;var r=this.getText(),n=this.measureTargetText(e,r);return this.measureCache=n,n}},{key:"measureTargetText",value:function(e,t){if(!t.length)return 0;var r=this.parent,n=r.getStyle("font-family").getDefinition();if(n){for(var o,s=this.getFontSize(),i=n.isRTL?ue()(o=t.split("")).call(o).join(""):t,a=Ke(r.getAttribute("dx").getString()),A=i.length,u=0,c=0;c<A;c++)u+=(this.getGlyph(n,i,c).horizAdvX||n.horizAdvX)*s/n.fontFace.unitsPerEm,void 0===a[c]||isNaN(a[c])||(u+=a[c]);return u}if(!e.measureText)return 10*t.length;e.save(),this.setContext(e,!0);var l=e.measureText(t).width;return this.clearContext(e),e.restore(),l}}]),o}(kt);var Mt=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(e,t,r){var s;return(0,F.default)(this,o),(s=n.call(this,e,t,(this instanceof o?this.constructor:void 0)===o||r)).type="tspan",s.text=s.children.length>0?"":s.getTextFromNode(),s}return(0,U.default)(o,[{key:"getText",value:function(){return this.text}}]),o}(Rt);var Dt=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(){var e;return(0,F.default)(this,o),(e=n.apply(this,arguments)).type="textNode",e}return o}(Mt);var Kt=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(e){var t;return(0,F.default)(this,o),(t=n.call(this,e.replace(/[+-.]\s+/g,"-").replace(/[^MmZzLlHhVvCcSsQqTtAae\d\s.,+-].*/g,""))).control=null,t.start=null,t.current=null,t.command=null,t.commands=t.commands,t.i=-1,t.previousCommand=null,t.points=[],t.angles=[],t}return(0,U.default)(o,[{key:"reset",value:function(){this.i=-1,this.command=null,this.previousCommand=null,this.start=new mt(0,0),this.control=new mt(0,0),this.current=new mt(0,0),this.points=[],this.angles=[]}},{key:"isEnd",value:function(){return this.i>=this.commands.length-1}},{key:"next",value:function(){var e=this.commands[++this.i];return this.previousCommand=this.command,this.command=e,e}},{key:"getPoint",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"x",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"y",r=new mt(this.command[e],this.command[t]);return this.makeAbsolute(r)}},{key:"getAsControlPoint",value:function(e,t){var r=this.getPoint(e,t);return this.control=r,r}},{key:"getAsCurrentPoint",value:function(e,t){var r=this.getPoint(e,t);return this.current=r,r}},{key:"getReflectedControlPoint",value:function(){var e=this.previousCommand.type;if(e!==pe.SVGPathData.CURVE_TO&&e!==pe.SVGPathData.SMOOTH_CURVE_TO&&e!==pe.SVGPathData.QUAD_TO&&e!==pe.SVGPathData.SMOOTH_QUAD_TO)return this.current;var t=this.current,r=t.x,n=t.y,o=this.control,s=o.x,i=o.y;return new mt(2*r-s,2*n-i)}},{key:"makeAbsolute",value:function(e){if(this.command.relative){var t=this.current,r=t.x,n=t.y;e.x+=r,e.y+=n}return e}},{key:"addMarker",value:function(e,t,r){var n=this.points,o=this.angles;r&&o.length>0&&!o[o.length-1]&&(o[o.length-1]=n[n.length-1].angleTo(r)),this.addMarkerAngle(e,t?t.angleTo(e):null)}},{key:"addMarkerAngle",value:function(e,t){this.points.push(e),this.angles.push(t)}},{key:"getMarkerPoints",value:function(){return this.points}},{key:"getMarkerAngles",value:function(){for(var e=this.angles,t=e.length,r=0;r<t;r++)if(!e[r])for(var n=r+1;n<t;n++)if(e[n]){e[r]=e[n];break}return e}}]),o}(pe.SVGPathData);var zt=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(e,t,r){var s;return(0,F.default)(this,o),(s=n.call(this,e,t,r)).type="path",s.pathParser=null,s.pathParser=new Kt(s.getAttribute("d").getString()),s}return(0,U.default)(o,[{key:"path",value:function(e){var t=this.pathParser,r=new Ot;for(t.reset(),e&&e.beginPath();!t.isEnd();)switch(t.next().type){case Kt.MOVE_TO:this.pathM(e,r);break;case Kt.LINE_TO:this.pathL(e,r);break;case Kt.HORIZ_LINE_TO:this.pathH(e,r);break;case Kt.VERT_LINE_TO:this.pathV(e,r);break;case Kt.CURVE_TO:this.pathC(e,r);break;case Kt.SMOOTH_CURVE_TO:this.pathS(e,r);break;case Kt.QUAD_TO:this.pathQ(e,r);break;case Kt.SMOOTH_QUAD_TO:this.pathT(e,r);break;case Kt.ARC:this.pathA(e,r);break;case Kt.CLOSE_PATH:this.pathZ(e,r)}return r}},{key:"getBoundingBox",value:function(e){return this.path()}},{key:"getMarkers",value:function(){var e=this.pathParser,t=e.getMarkerPoints(),r=e.getMarkerAngles();return A()(t).call(t,(function(e,t){return[e,r[t]]}))}},{key:"renderChildren",value:function(e){this.path(e),this.document.screen.mouse.checkPath(this,e);var t=this.getStyle("fill-rule");""!==e.fillStyle&&("inherit"!==t.getString("inherit")?he()(e).call(e,t.getString()):he()(e).call(e)),""!==e.strokeStyle&&e.stroke();var r=this.getMarkers();if(r){var n=r.length-1,o=this.getStyle("marker-start"),s=this.getStyle("marker-mid"),i=this.getStyle("marker-end");if(o.isUrlDefinition()){var a=o.getDefinition(),A=(0,u.default)(r[0],2),c=A[0],l=A[1];a.render(e,c,l)}if(s.isUrlDefinition())for(var d=s.getDefinition(),f=1;f<n;f++){var h=(0,u.default)(r[f],2),p=h[0],m=h[1];d.render(e,p,m)}if(i.isUrlDefinition()){var g=i.getDefinition(),y=(0,u.default)(r[n],2),v=y[0],w=y[1];g.render(e,v,w)}}}},{key:"pathM",value:function(e,t){var r=this.pathParser,n=o.pathM(r).point,s=n.x,i=n.y;r.addMarker(n),t.addPoint(s,i),e&&e.moveTo(s,i)}},{key:"pathL",value:function(e,t){var r=this.pathParser,n=o.pathL(r),s=n.current,i=n.point,a=i.x,A=i.y;r.addMarker(i,s),t.addPoint(a,A),e&&e.lineTo(a,A)}},{key:"pathH",value:function(e,t){var r=this.pathParser,n=o.pathH(r),s=n.current,i=n.point,a=i.x,A=i.y;r.addMarker(i,s),t.addPoint(a,A),e&&e.lineTo(a,A)}},{key:"pathV",value:function(e,t){var r=this.pathParser,n=o.pathV(r),s=n.current,i=n.point,a=i.x,A=i.y;r.addMarker(i,s),t.addPoint(a,A),e&&e.lineTo(a,A)}},{key:"pathC",value:function(e,t){var r=this.pathParser,n=o.pathC(r),s=n.current,i=n.point,a=n.controlPoint,A=n.currentPoint;r.addMarker(A,a,i),t.addBezierCurve(s.x,s.y,i.x,i.y,a.x,a.y,A.x,A.y),e&&e.bezierCurveTo(i.x,i.y,a.x,a.y,A.x,A.y)}},{key:"pathS",value:function(e,t){var r=this.pathParser,n=o.pathS(r),s=n.current,i=n.point,a=n.controlPoint,A=n.currentPoint;r.addMarker(A,a,i),t.addBezierCurve(s.x,s.y,i.x,i.y,a.x,a.y,A.x,A.y),e&&e.bezierCurveTo(i.x,i.y,a.x,a.y,A.x,A.y)}},{key:"pathQ",value:function(e,t){var r=this.pathParser,n=o.pathQ(r),s=n.current,i=n.controlPoint,a=n.currentPoint;r.addMarker(a,i,i),t.addQuadraticCurve(s.x,s.y,i.x,i.y,a.x,a.y),e&&e.quadraticCurveTo(i.x,i.y,a.x,a.y)}},{key:"pathT",value:function(e,t){var r=this.pathParser,n=o.pathT(r),s=n.current,i=n.controlPoint,a=n.currentPoint;r.addMarker(a,i,i),t.addQuadraticCurve(s.x,s.y,i.x,i.y,a.x,a.y),e&&e.quadraticCurveTo(i.x,i.y,a.x,a.y)}},{key:"pathA",value:function(e,t){var r=this.pathParser,n=o.pathA(r),s=n.currentPoint,i=n.rX,a=n.rY,A=n.sweepFlag,u=n.xAxisRotation,c=n.centp,l=n.a1,d=n.ad,f=1-A?1:-1,h=l+f*(d/2),p=new mt(c.x+i*Math.cos(h),c.y+a*Math.sin(h));if(r.addMarkerAngle(p,h-f*Math.PI/2),r.addMarkerAngle(s,h-f*Math.PI),t.addPoint(s.x,s.y),e&&!isNaN(l)&&!isNaN(d)){var m=i>a?i:a,g=i>a?1:i/a,y=i>a?a/i:1;e.translate(c.x,c.y),e.rotate(u),e.scale(g,y),e.arc(0,0,m,l,l+d,Boolean(1-A)),e.scale(1/g,1/y),e.rotate(-u),e.translate(-c.x,-c.y)}}},{key:"pathZ",value:function(e,t){o.pathZ(this.pathParser),e&&t.x1!==t.x2&&t.y1!==t.y2&&e.closePath()}}],[{key:"pathM",value:function(e){var t=e.getAsCurrentPoint();return e.start=e.current,{point:t}}},{key:"pathL",value:function(e){return{current:e.current,point:e.getAsCurrentPoint()}}},{key:"pathH",value:function(e){var t=e.current,r=e.command,n=new mt((r.relative?t.x:0)+r.x,t.y);return e.current=n,{current:t,point:n}}},{key:"pathV",value:function(e){var t=e.current,r=e.command,n=new mt(t.x,(r.relative?t.y:0)+r.y);return e.current=n,{current:t,point:n}}},{key:"pathC",value:function(e){return{current:e.current,point:e.getPoint("x1","y1"),controlPoint:e.getAsControlPoint("x2","y2"),currentPoint:e.getAsCurrentPoint()}}},{key:"pathS",value:function(e){return{current:e.current,point:e.getReflectedControlPoint(),controlPoint:e.getAsControlPoint("x2","y2"),currentPoint:e.getAsCurrentPoint()}}},{key:"pathQ",value:function(e){return{current:e.current,controlPoint:e.getAsControlPoint("x1","y1"),currentPoint:e.getAsCurrentPoint()}}},{key:"pathT",value:function(e){var t=e.current,r=e.getReflectedControlPoint();return e.control=r,{current:t,controlPoint:r,currentPoint:e.getAsCurrentPoint()}}},{key:"pathA",value:function(e){var t=e.current,r=e.command,n=r.rX,o=r.rY,s=r.xRot,i=r.lArcFlag,a=r.sweepFlag,A=s*(Math.PI/180),u=e.getAsCurrentPoint(),c=new mt(Math.cos(A)*(t.x-u.x)/2+Math.sin(A)*(t.y-u.y)/2,-Math.sin(A)*(t.x-u.x)/2+Math.cos(A)*(t.y-u.y)/2),l=Math.pow(c.x,2)/Math.pow(n,2)+Math.pow(c.y,2)/Math.pow(o,2);l>1&&(n*=Math.sqrt(l),o*=Math.sqrt(l));var d=(i===a?-1:1)*Math.sqrt((Math.pow(n,2)*Math.pow(o,2)-Math.pow(n,2)*Math.pow(c.y,2)-Math.pow(o,2)*Math.pow(c.x,2))/(Math.pow(n,2)*Math.pow(c.y,2)+Math.pow(o,2)*Math.pow(c.x,2)));isNaN(d)&&(d=0);var f=new mt(d*n*c.y/o,d*-o*c.x/n),h=new mt((t.x+u.x)/2+Math.cos(A)*f.x-Math.sin(A)*f.y,(t.y+u.y)/2+Math.sin(A)*f.x+Math.cos(A)*f.y),p=it([1,0],[(c.x-f.x)/n,(c.y-f.y)/o]),m=[(c.x-f.x)/n,(c.y-f.y)/o],g=[(-c.x-f.x)/n,(-c.y-f.y)/o],y=it(m,g);return st(m,g)<=-1&&(y=Math.PI),st(m,g)>=1&&(y=0),{currentPoint:u,rX:n,rY:o,sweepFlag:a,xAxisRotation:A,centp:h,a1:p,ad:y}}},{key:"pathZ",value:function(e){e.current=e.start}}]),o}(kt);var Vt=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(){var e;return(0,F.default)(this,o),(e=n.apply(this,arguments)).type="svg",e.root=!1,e}return(0,U.default)(o,[{key:"setContext",value:function(e){var t=this.document,r=t.screen,n=t.window,s=e.canvas;if(r.setDefaults(e),s.style&&void 0!==e.font&&n&&void 0!==n.getComputedStyle){e.font=n.getComputedStyle(s).getPropertyValue("font");var i=new ht(t,"fontSize",Pt.parse(e.font).fontSize);i.hasValue()&&(t.rootEmSize=i.getPixels("y"),t.emSize=t.rootEmSize)}this.getAttribute("x").hasValue()||this.getAttribute("x",!0).setValue(0),this.getAttribute("y").hasValue()||this.getAttribute("y",!0).setValue(0);var a=r.viewPort,A=a.width,u=a.height;this.getStyle("width").hasValue()||this.getStyle("width",!0).setValue("100%"),this.getStyle("height").hasValue()||this.getStyle("height",!0).setValue("100%"),this.getStyle("color").hasValue()||this.getStyle("color",!0).setValue("black");var c=this.getAttribute("refX"),l=this.getAttribute("refY"),d=this.getAttribute("viewBox"),f=d.hasValue()?Ke(d.getString()):null,h=!this.root&&"visible"!==this.getStyle("overflow").getValue("hidden"),p=0,m=0,g=0,y=0;f&&(p=f[0],m=f[1]),this.root||(A=this.getStyle("width").getPixels("x"),u=this.getStyle("height").getPixels("y"),"marker"===this.type&&(g=p,y=m,p=0,m=0)),r.viewPort.setCurrent(A,u),this.node&&this.getStyle("transform",!1,!0).hasValue()&&!this.getStyle("transform-origin",!1,!0).hasValue()&&this.getStyle("transform-origin",!0,!0).setValue("50% 50%"),(0,de.default)((0,ee.default)(o.prototype),"setContext",this).call(this,e),e.translate(this.getAttribute("x").getPixels("x"),this.getAttribute("y").getPixels("y")),f&&(A=f[2],u=f[3]),t.setViewBox({ctx:e,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:r.viewPort.width,desiredWidth:A,height:r.viewPort.height,desiredHeight:u,minX:p,minY:m,refX:c.getValue(),refY:l.getValue(),clip:h,clipX:g,clipY:y}),f&&(r.viewPort.removeCurrent(),r.viewPort.setCurrent(A,u))}},{key:"clearContext",value:function(e){(0,de.default)((0,ee.default)(o.prototype),"clearContext",this).call(this,e),this.document.screen.viewPort.removeCurrent()}},{key:"resize",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=this.getAttribute("width",!0),s=this.getAttribute("height",!0),i=this.getAttribute("viewBox"),a=this.getAttribute("style"),A=o.getNumber(0),u=s.getNumber(0);if(n)if("string"==typeof n)this.getAttribute("preserveAspectRatio",!0).setValue(n);else{var c=this.getAttribute("preserveAspectRatio");c.hasValue()&&c.setValue(c.getString().replace(/^\s*(\S.*\S)\s*$/,"$1"))}if(o.setValue(e),s.setValue(r),i.hasValue()||i.setValue(L()(t="0 0 ".concat(A||e," ")).call(t,u||r)),a.hasValue()){var l=this.getStyle("width"),d=this.getStyle("height");l.hasValue()&&l.setValue("".concat(e,"px")),d.hasValue()&&d.setValue("".concat(r,"px"))}}}]),o}(kt);var qt=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(){var e;return(0,F.default)(this,o),(e=n.apply(this,arguments)).type="rect",e}return(0,U.default)(o,[{key:"path",value:function(e){var t=this.getAttribute("x").getPixels("x"),r=this.getAttribute("y").getPixels("y"),n=this.getStyle("width",!1,!0).getPixels("x"),o=this.getStyle("height",!1,!0).getPixels("y"),s=this.getAttribute("rx"),i=this.getAttribute("ry"),a=s.getPixels("x"),A=i.getPixels("y");if(s.hasValue()&&!i.hasValue()&&(A=a),i.hasValue()&&!s.hasValue()&&(a=A),a=Math.min(a,n/2),A=Math.min(A,o/2),e){var u=(Math.sqrt(2)-1)/3*4;e.beginPath(),o>0&&n>0&&(e.moveTo(t+a,r),e.lineTo(t+n-a,r),e.bezierCurveTo(t+n-a+u*a,r,t+n,r+A-u*A,t+n,r+A),e.lineTo(t+n,r+o-A),e.bezierCurveTo(t+n,r+o-A+u*A,t+n-a+u*a,r+o,t+n-a,r+o),e.lineTo(t+a,r+o),e.bezierCurveTo(t+a-u*a,r+o,t,r+o-A+u*A,t,r+o-A),e.lineTo(t,r+A),e.bezierCurveTo(t,r+A-u*A,t+a-u*a,r,t+a,r),e.closePath())}return new Ot(t,r,t+n,r+o)}},{key:"getMarkers",value:function(){return null}}]),o}(zt);var Gt=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(){var e;return(0,F.default)(this,o),(e=n.apply(this,arguments)).type="circle",e}return(0,U.default)(o,[{key:"path",value:function(e){var t=this.getAttribute("cx").getPixels("x"),r=this.getAttribute("cy").getPixels("y"),n=this.getAttribute("r").getPixels();return e&&n>0&&(e.beginPath(),e.arc(t,r,n,0,2*Math.PI,!1),e.closePath()),new Ot(t-n,r-n,t+n,r+n)}},{key:"getMarkers",value:function(){return null}}]),o}(zt);var Xt=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(){var e;return(0,F.default)(this,o),(e=n.apply(this,arguments)).type="ellipse",e}return(0,U.default)(o,[{key:"path",value:function(e){var t=(Math.sqrt(2)-1)/3*4,r=this.getAttribute("rx").getPixels("x"),n=this.getAttribute("ry").getPixels("y"),o=this.getAttribute("cx").getPixels("x"),s=this.getAttribute("cy").getPixels("y");return e&&r>0&&n>0&&(e.beginPath(),e.moveTo(o+r,s),e.bezierCurveTo(o+r,s+t*n,o+t*r,s+n,o,s+n),e.bezierCurveTo(o-t*r,s+n,o-r,s+t*n,o-r,s),e.bezierCurveTo(o-r,s-t*n,o-t*r,s-n,o,s-n),e.bezierCurveTo(o+t*r,s-n,o+r,s-t*n,o+r,s),e.closePath()),new Ot(o-r,s-n,o+r,s+n)}},{key:"getMarkers",value:function(){return null}}]),o}(zt);var Wt=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(){var e;return(0,F.default)(this,o),(e=n.apply(this,arguments)).type="line",e}return(0,U.default)(o,[{key:"getPoints",value:function(){return[new mt(this.getAttribute("x1").getPixels("x"),this.getAttribute("y1").getPixels("y")),new mt(this.getAttribute("x2").getPixels("x"),this.getAttribute("y2").getPixels("y"))]}},{key:"path",value:function(e){var t=this.getPoints(),r=(0,u.default)(t,2),n=r[0],o=n.x,s=n.y,i=r[1],a=i.x,A=i.y;return e&&(e.beginPath(),e.moveTo(o,s),e.lineTo(a,A)),new Ot(o,s,a,A)}},{key:"getMarkers",value:function(){var e=this.getPoints(),t=(0,u.default)(e,2),r=t[0],n=t[1],o=r.angleTo(n);return[[r,o],[n,o]]}}]),o}(zt);var Jt=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(e,t,r){var s;return(0,F.default)(this,o),(s=n.call(this,e,t,r)).type="polyline",s.points=[],s.points=mt.parsePath(s.getAttribute("points").getString()),s}return(0,U.default)(o,[{key:"path",value:function(e){var t=this.points,r=(0,u.default)(t,1)[0],n=r.x,o=r.y,s=new Ot(n,o);return e&&(e.beginPath(),e.moveTo(n,o)),g()(t).call(t,(function(t){var r=t.x,n=t.y;s.addPoint(r,n),e&&e.lineTo(r,n)})),s}},{key:"getMarkers",value:function(){var e=this.points,t=e.length-1,r=[];return g()(e).call(e,(function(n,o){o!==t&&r.push([n,n.angleTo(e[o+1])])})),r.length>0&&r.push([e[e.length-1],r[r.length-1][1]]),r}}]),o}(zt);var Yt=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(){var e;return(0,F.default)(this,o),(e=n.apply(this,arguments)).type="polygon",e}return(0,U.default)(o,[{key:"path",value:function(e){var t=(0,de.default)((0,ee.default)(o.prototype),"path",this).call(this,e),r=(0,u.default)(this.points,1)[0],n=r.x,s=r.y;return e&&(e.lineTo(n,s),e.closePath()),t}}]),o}(Jt);var Zt=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(){var e;return(0,F.default)(this,o),(e=n.apply(this,arguments)).type="pattern",e}return(0,U.default)(o,[{key:"createPattern",value:function(e,t,r){var n=this.getStyle("width").getPixels("x",!0),o=this.getStyle("height").getPixels("y",!0),s=new Vt(this.document,null);s.attributes.viewBox=new ht(this.document,"viewBox",this.getAttribute("viewBox").getValue()),s.attributes.width=new ht(this.document,"width","".concat(n,"px")),s.attributes.height=new ht(this.document,"height","".concat(o,"px")),s.attributes.transform=new ht(this.document,"transform",this.getAttribute("patternTransform").getValue()),s.children=this.children;var i=this.document.createCanvas(n,o),a=i.getContext("2d"),A=this.getAttribute("x"),u=this.getAttribute("y");A.hasValue()&&u.hasValue()&&a.translate(A.getPixels("x",!0),u.getPixels("y",!0)),r.hasValue()?this.styles["fill-opacity"]=r:ge()(this.styles,"fill-opacity");for(var c=-1;c<=1;c++)for(var l=-1;l<=1;l++)a.save(),s.attributes.x=new ht(this.document,"x",c*i.width),s.attributes.y=new ht(this.document,"y",l*i.height),s.render(a),a.restore();return e.createPattern(i,"repeat")}}]),o}(St);var $t=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(){var e;return(0,F.default)(this,o),(e=n.apply(this,arguments)).type="marker",e}return(0,U.default)(o,[{key:"render",value:function(e,t,r){if(t){var n=t.x,o=t.y,s=this.getAttribute("orient").getValue("auto"),i=this.getAttribute("markerUnits").getValue("strokeWidth");e.translate(n,o),"auto"===s&&e.rotate(r),"strokeWidth"===i&&e.scale(e.lineWidth,e.lineWidth),e.save();var a=new Vt(this.document,null);a.type=this.type,a.attributes.viewBox=new ht(this.document,"viewBox",this.getAttribute("viewBox").getValue()),a.attributes.refX=new ht(this.document,"refX",this.getAttribute("refX").getValue()),a.attributes.refY=new ht(this.document,"refY",this.getAttribute("refY").getValue()),a.attributes.width=new ht(this.document,"width",this.getAttribute("markerWidth").getValue()),a.attributes.height=new ht(this.document,"height",this.getAttribute("markerHeight").getValue()),a.attributes.overflow=new ht(this.document,"overflow",this.getAttribute("overflow").getValue()),a.attributes.fill=new ht(this.document,"fill",this.getAttribute("fill").getColor("black")),a.attributes.stroke=new ht(this.document,"stroke",this.getAttribute("stroke").getValue("none")),a.children=this.children,a.render(e),e.restore(),"strokeWidth"===i&&e.scale(1/e.lineWidth,1/e.lineWidth),"auto"===s&&e.rotate(-r),e.translate(-n,-o)}}}]),o}(St);var er=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(){var e;return(0,F.default)(this,o),(e=n.apply(this,arguments)).type="defs",e}return(0,U.default)(o,[{key:"render",value:function(){}}]),o}(St);var tr=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(){var e;return(0,F.default)(this,o),(e=n.apply(this,arguments)).type="g",e}return(0,U.default)(o,[{key:"getBoundingBox",value:function(e){var t,r=new Ot;return g()(t=this.children).call(t,(function(t){r.addBoundingBox(t.getBoundingBox(e))})),r}}]),o}(kt);var rr=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(e,t,r){var s;(0,F.default)(this,o),(s=n.call(this,e,t,r)).attributesToInherit=["gradientUnits"],s.stops=[];var i=(0,ye.default)(s),a=i.stops,A=i.children;return g()(A).call(A,(function(e){"stop"===e.type&&a.push(e)})),s}return(0,U.default)(o,[{key:"getGradientUnits",value:function(){return this.getAttribute("gradientUnits").getString("objectBoundingBox")}},{key:"createGradient",value:function(e,t,r){var n=this,o=this;this.getHrefAttribute().hasValue()&&(o=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(o));var s=o.stops,i=this.getGradient(e,t);if(!i)return this.addParentOpacity(r,s[s.length-1].color);if(g()(s).call(s,(function(e){i.addColorStop(e.offset,n.addParentOpacity(r,e.color))})),this.getAttribute("gradientTransform").hasValue()){var a=this.document,A=a.screen,c=A.MAX_VIRTUAL_PIXELS,l=A.viewPort,d=(0,u.default)(l.viewPorts,1)[0],f=new qt(a,null);f.attributes.x=new ht(a,"x",-c/3),f.attributes.y=new ht(a,"y",-c/3),f.attributes.width=new ht(a,"width",c),f.attributes.height=new ht(a,"height",c);var h=new tr(a,null);h.attributes.transform=new ht(a,"transform",this.getAttribute("gradientTransform").getValue()),h.children=[f];var p=new Vt(a,null);p.attributes.x=new ht(a,"x",0),p.attributes.y=new ht(a,"y",0),p.attributes.width=new ht(a,"width",d.width),p.attributes.height=new ht(a,"height",d.height),p.children=[h];var m=a.createCanvas(d.width,d.height),y=m.getContext("2d");return y.fillStyle=i,p.render(y),y.createPattern(m,"no-repeat")}return i}},{key:"inheritStopContainer",value:function(e){var t,r=this;g()(t=this.attributesToInherit).call(t,(function(t){!r.getAttribute(t).hasValue()&&e.getAttribute(t).hasValue()&&r.getAttribute(t,!0).setValue(e.getAttribute(t).getValue())}))}},{key:"addParentOpacity",value:function(e,t){return e.hasValue()?new ht(this.document,"color",t).addOpacity(e).getColor():t}}]),o}(St);var nr=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(e,t,r){var s;return(0,F.default)(this,o),(s=n.call(this,e,t,r)).type="linearGradient",s.attributesToInherit.push("x1","y1","x2","y2"),s}return(0,U.default)(o,[{key:"getGradient",value:function(e,t){var r="objectBoundingBox"===this.getGradientUnits(),n=r?t.getBoundingBox(e):null;if(r&&!n)return null;this.getAttribute("x1").hasValue()||this.getAttribute("y1").hasValue()||this.getAttribute("x2").hasValue()||this.getAttribute("y2").hasValue()||(this.getAttribute("x1",!0).setValue(0),this.getAttribute("y1",!0).setValue(0),this.getAttribute("x2",!0).setValue(1),this.getAttribute("y2",!0).setValue(0));var o=r?n.x+n.width*this.getAttribute("x1").getNumber():this.getAttribute("x1").getPixels("x"),s=r?n.y+n.height*this.getAttribute("y1").getNumber():this.getAttribute("y1").getPixels("y"),i=r?n.x+n.width*this.getAttribute("x2").getNumber():this.getAttribute("x2").getPixels("x"),a=r?n.y+n.height*this.getAttribute("y2").getNumber():this.getAttribute("y2").getPixels("y");return o===i&&s===a?null:e.createLinearGradient(o,s,i,a)}}]),o}(rr);var or=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(e,t,r){var s;return(0,F.default)(this,o),(s=n.call(this,e,t,r)).type="radialGradient",s.attributesToInherit.push("cx","cy","r","fx","fy","fr"),s}return(0,U.default)(o,[{key:"getGradient",value:function(e,t){var r="objectBoundingBox"===this.getGradientUnits(),n=t.getBoundingBox(e);if(r&&!n)return null;this.getAttribute("cx").hasValue()||this.getAttribute("cx",!0).setValue("50%"),this.getAttribute("cy").hasValue()||this.getAttribute("cy",!0).setValue("50%"),this.getAttribute("r").hasValue()||this.getAttribute("r",!0).setValue("50%");var o=r?n.x+n.width*this.getAttribute("cx").getNumber():this.getAttribute("cx").getPixels("x"),s=r?n.y+n.height*this.getAttribute("cy").getNumber():this.getAttribute("cy").getPixels("y"),i=o,a=s;this.getAttribute("fx").hasValue()&&(i=r?n.x+n.width*this.getAttribute("fx").getNumber():this.getAttribute("fx").getPixels("x")),this.getAttribute("fy").hasValue()&&(a=r?n.y+n.height*this.getAttribute("fy").getNumber():this.getAttribute("fy").getPixels("y"));var A=r?(n.width+n.height)/2*this.getAttribute("r").getNumber():this.getAttribute("r").getPixels(),u=this.getAttribute("fr").getPixels();return e.createRadialGradient(i,a,u,o,s,A)}}]),o}(rr);var sr=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(e,t,r){var s;(0,F.default)(this,o),(s=n.call(this,e,t,r)).type="stop";var i=Math.max(0,Math.min(1,s.getAttribute("offset").getNumber())),a=s.getStyle("stop-opacity"),A=s.getStyle("stop-color",!0);return""===A.getString()&&A.setValue("#000"),a.hasValue()&&(A=A.addOpacity(a)),s.offset=i,s.color=A.getColor(),s}return o}(St);var ir=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(e,t,r){var s;return(0,F.default)(this,o),(s=n.call(this,e,t,r)).type="animate",s.duration=0,s.initialValue=null,s.initialUnits="",s.removed=!1,s.frozen=!1,e.screen.animations.push((0,ye.default)(s)),s.begin=s.getAttribute("begin").getMilliseconds(),s.maxDuration=s.begin+s.getAttribute("dur").getMilliseconds(),s.from=s.getAttribute("from"),s.to=s.getAttribute("to"),s.values=s.getAttribute("values"),we()(s).hasValue()&&we()(s).setValue(we()(s).getString().split(";")),s}return(0,U.default)(o,[{key:"getProperty",value:function(){var e=this.getAttribute("attributeType").getString(),t=this.getAttribute("attributeName").getString();return"CSS"===e?this.parent.getStyle(t,!0):this.parent.getAttribute(t,!0)}},{key:"calcValue",value:function(){var e,t=this.initialUnits,r=this.getProgress(),n=r.progress,o=r.from,s=r.to,i=o.getNumber()+(s.getNumber()-o.getNumber())*n;return"%"===t&&(i*=100),L()(e="".concat(i)).call(e,t)}},{key:"update",value:function(e){var t=this.parent,r=this.getProperty();if(this.initialValue||(this.initialValue=r.getString(),this.initialUnits=r.getUnits()),this.duration>this.maxDuration){var n=this.getAttribute("fill").getString("remove");if("indefinite"===this.getAttribute("repeatCount").getString()||"indefinite"===this.getAttribute("repeatDur").getString())this.duration=0;else if("freeze"!==n||this.frozen){if("remove"===n&&!this.removed)return this.removed=!0,r.setValue(t.animationFrozen?t.animationFrozenValue:this.initialValue),!0}else this.frozen=!0,t.animationFrozen=!0,t.animationFrozenValue=r.getString();return!1}this.duration+=e;var o=!1;if(this.begin<this.duration){var s=this.calcValue(),i=this.getAttribute("type");if(i.hasValue()){var a,A=i.getString();s=L()(a="".concat(A,"(")).call(a,s,")")}r.setValue(s),o=!0}return o}},{key:"getProgress",value:function(){var e=this.document,t=we()(this),r={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(t.hasValue()){var n=r.progress*(t.getValue().length-1),o=Math.floor(n),s=Math.ceil(n);r.from=new ht(e,"from",i()(t.getValue()[o])),r.to=new ht(e,"to",i()(t.getValue()[s])),r.progress=(n-o)/(s-o)}else r.from=this.from,r.to=this.to;return r}}]),o}(St);var ar=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(){var e;return(0,F.default)(this,o),(e=n.apply(this,arguments)).type="animateColor",e}return(0,U.default)(o,[{key:"calcValue",value:function(){var e=this.getProgress(),t=e.progress,r=e.from,n=e.to,o=new(W())(r.getColor()),s=new(W())(n.getColor());if(o.ok&&s.ok){var i,a,A=o.r+(s.r-o.r)*t,u=o.g+(s.g-o.g)*t,c=o.b+(s.b-o.b)*t;return L()(i=L()(a="rgb(".concat(Be()(A,10),", ")).call(a,Be()(u,10),", ")).call(i,Be()(c,10),")")}return this.getAttribute("from").getColor()}}]),o}(ir);var Ar=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(){var e;return(0,F.default)(this,o),(e=n.apply(this,arguments)).type="animateTransform",e}return(0,U.default)(o,[{key:"calcValue",value:function(){var e=this.getProgress(),t=e.progress,r=e.from,n=e.to,o=Ke(r.getString()),s=Ke(n.getString());return A()(o).call(o,(function(e,r){return e+(s[r]-e)*t})).join(" ")}}]),o}(ir);function ur(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var cr=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(e,t,r){var s;(0,F.default)(this,o),(s=n.call(this,e,t,r)).type="font",s.glyphs={},s.horizAdvX=s.getAttribute("horiz-adv-x").getNumber();var i,a=e.definitions,A=function(e,t){var r;if(void 0===Fe()||null==Ne()(e)){if(xe()(e)||(r=function(e,t){var r;if(e){if("string"==typeof e)return ur(e,t);var n=Se()(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?ae()(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ur(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,a=!1;return{s:function(){r=_e()(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){a=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(a)throw s}}}}((0,ye.default)(s).children);try{for(A.s();!(i=A.n()).done;){var u=i.value;switch(u.type){case"font-face":s.fontFace=u;var c=u.getStyle("font-family");c.hasValue()&&(a[c.getString()]=(0,ye.default)(s));break;case"missing-glyph":s.missingGlyph=u;break;case"glyph":var l=u;l.arabicForm?(s.isRTL=!0,s.isArabic=!0,void 0===s.glyphs[l.unicode]&&(s.glyphs[l.unicode]={}),s.glyphs[l.unicode][l.arabicForm]=l):s.glyphs[l.unicode]=l}}}catch(e){A.e(e)}finally{A.f()}return s}return(0,U.default)(o,[{key:"render",value:function(){}}]),o}(St);var lr=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(e,t,r){var s;return(0,F.default)(this,o),(s=n.call(this,e,t,r)).type="font-face",s.ascent=s.getAttribute("ascent").getNumber(),s.descent=s.getAttribute("descent").getNumber(),s.unitsPerEm=s.getAttribute("units-per-em").getNumber(),s}return o}(St);var dr=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(){var e;return(0,F.default)(this,o),(e=n.apply(this,arguments)).type="missing-glyph",e.horizAdvX=0,e}return o}(zt);var fr=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(e,t,r){var s;return(0,F.default)(this,o),(s=n.call(this,e,t,r)).type="glyph",s.horizAdvX=s.getAttribute("horiz-adv-x").getNumber(),s.unicode=s.getAttribute("unicode").getString(),s.arabicForm=s.getAttribute("arabic-form").getString(),s}return o}(zt);var hr=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(){var e;return(0,F.default)(this,o),(e=n.apply(this,arguments)).type="tref",e}return(0,U.default)(o,[{key:"getText",value:function(){var e=this.getHrefAttribute().getDefinition();if(e){var t=e.children[0];if(t)return t.getText()}return""}}]),o}(Rt);var pr=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(e,t,r){var s,i;(0,F.default)(this,o),(i=n.call(this,e,t,r)).type="a";var a=t.childNodes,A=a[0],u=a.length>0&&k()(s=ae()(a)).call(s,(function(e){return 3===e.nodeType}));return i.hasText=u,i.text=u?i.getTextFromNode(A):"",i}return(0,U.default)(o,[{key:"getText",value:function(){return this.text}},{key:"renderChildren",value:function(e){if(this.hasText){(0,de.default)((0,ee.default)(o.prototype),"renderChildren",this).call(this,e);var t=this.document,r=this.x,n=this.y,s=t.screen.mouse,i=new ht(t,"fontSize",Pt.parse(t.ctx.font).fontSize);s.isWorking()&&s.checkBoundingBox(this,new Ot(r,n-i.getPixels("y"),r+this.measureText(e),n))}else if(this.children.length>0){var a=new tr(this.document,null);a.children=this.children,a.parent=this,a.render(e)}}},{key:"onClick",value:function(){var e=this.document.window;e&&e.open(this.getHrefAttribute().getString())}},{key:"onMouseMove",value:function(){this.document.ctx.canvas.style.cursor="pointer"}}]),o}(Rt);function mr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function gr(e,t){var r=C()(e);if(j()){var n=j()(e);t&&(n=b()(n).call(n,(function(t){return v()(e,t).enumerable}))),r.push.apply(r,n)}return r}function yr(e){for(var t=1;t<arguments.length;t++){var r,n=null!=arguments[t]?arguments[t]:{};if(t%2)g()(r=gr(Object(n),!0)).call(r,(function(t){(0,Q.default)(e,t,n[t])}));else if(p())f()(e,p()(n));else{var o;g()(o=gr(Object(n))).call(o,(function(t){l()(e,t,v()(n,t))}))}}return e}var vr=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(e,t,r){var s;(0,F.default)(this,o),(s=n.call(this,e,t,r)).type="textPath",s.textWidth=0,s.textHeight=0,s.pathLength=-1,s.glyphInfo=null,s.letterSpacingCache=[],s.measuresCache=new(Te())([["",0]]);var i=s.getHrefAttribute().getDefinition();return s.text=s.getTextFromNode(),s.dataArray=s.parsePathData(i),s}return(0,U.default)(o,[{key:"getText",value:function(){return this.text}},{key:"path",value:function(e){var t=this.dataArray;e&&e.beginPath(),g()(t).call(t,(function(t){var r=t.type,n=t.points;switch(r){case Kt.LINE_TO:e&&e.lineTo(n[0],n[1]);break;case Kt.MOVE_TO:e&&e.moveTo(n[0],n[1]);break;case Kt.CURVE_TO:e&&e.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5]);break;case Kt.QUAD_TO:e&&e.quadraticCurveTo(n[0],n[1],n[2],n[3]);break;case Kt.ARC:var o=(0,u.default)(n,8),s=o[0],i=o[1],a=o[2],A=o[3],c=o[4],l=o[5],d=o[6],f=o[7],h=a>A?a:A,p=a>A?1:a/A,m=a>A?A/a:1;e&&(e.translate(s,i),e.rotate(d),e.scale(p,m),e.arc(0,0,h,c,c+l,Boolean(1-f)),e.scale(1/p,1/m),e.rotate(-d),e.translate(-s,-i));break;case Kt.CLOSE_PATH:e&&e.closePath()}}))}},{key:"renderChildren",value:function(e){this.setTextData(e),e.save();var t=this.parent.getStyle("text-decoration").getString(),r=this.getFontSize(),n=this.glyphInfo,o=e.fillStyle;"underline"===t&&e.beginPath(),g()(n).call(n,(function(n,o){var s=n.p0,i=n.p1,a=n.rotation,A=n.text;e.save(),e.translate(s.x,s.y),e.rotate(a),e.fillStyle&&e.fillText(A,0,0),e.strokeStyle&&e.strokeText(A,0,0),e.restore(),"underline"===t&&(0===o&&e.moveTo(s.x,s.y+r/8),e.lineTo(i.x,i.y+r/5))})),"underline"===t&&(e.lineWidth=r/20,e.strokeStyle=o,e.stroke(),e.closePath()),e.restore()}},{key:"getLetterSpacingAt",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.letterSpacingCache[e]||0}},{key:"findSegmentToFitChar",value:function(e,t,r,n,o,s,i,a,A){var u=s,c=this.measureText(e,a);" "===a&&"justify"===t&&r<n&&(c+=(n-r)/o),A>-1&&(u+=this.getLetterSpacingAt(A));var l=this.textHeight/20,d=this.getEquidistantPointOnPath(u,l,0),f=this.getEquidistantPointOnPath(u+c,l,0),h={p0:d,p1:f},p=d&&f?Math.atan2(f.y-d.y,f.x-d.x):0;if(i){var m=Math.cos(Math.PI/2+p)*i,g=Math.cos(-p)*i;h.p0=yr(yr({},d),{},{x:d.x+m,y:d.y+g}),h.p1=yr(yr({},f),{},{x:f.x+m,y:f.y+g})}return{offset:u+=c,segment:h,rotation:p}}},{key:"measureText",value:function(e,t){var r=this.measuresCache,n=t||this.getText();if(r.has(n))return r.get(n);var o=this.measureTargetText(e,n);return r.set(n,o),o}},{key:"setTextData",value:function(e){var t,r=this;if(!this.glyphInfo){var n=this.getText(),o=n.split(""),s=n.split(" ").length-1,i=A()(t=this.parent.getAttribute("dx").split()).call(t,(function(e){return e.getPixels("x")})),a=this.parent.getAttribute("dy").getPixels("y"),u=this.parent.getStyle("text-anchor").getString("start"),c=this.getStyle("letter-spacing"),l=this.parent.getStyle("letter-spacing"),d=0;c.hasValue()&&"inherit"!==c.getValue()?c.hasValue()&&"initial"!==c.getValue()&&"unset"!==c.getValue()&&(d=c.getPixels()):d=l.getPixels();var f=[],h=n.length;this.letterSpacingCache=f;for(var p=0;p<h;p++)f.push(void 0!==i[p]?i[p]:d);var m=H()(f).call(f,(function(e,t,r){return 0===r?0:e+t||0}),0),y=this.measureText(e),v=Math.max(y+m,0);this.textWidth=y,this.textHeight=this.getFontSize(),this.glyphInfo=[];var w=this.getPathLength(),b=this.getStyle("startOffset").getNumber(0)*w,B=0;"middle"!==u&&"center"!==u||(B=-v/2),"end"!==u&&"right"!==u||(B=-v),B+=b,g()(o).call(o,(function(t,n){var i=r.findSegmentToFitChar(e,u,v,w,s,B,a,t,n),A=i.offset,c=i.segment,l=i.rotation;B=A,c.p0&&c.p1&&r.glyphInfo.push({text:o[n],p0:c.p0,p1:c.p1,rotation:l})}))}}},{key:"parsePathData",value:function(e){if(this.pathLength=-1,!e)return[];var t=[],r=e.pathParser;for(r.reset();!r.isEnd();){var n=r.current,o=n?n.x:0,s=n?n.y:0,i=r.next(),a=i.type,A=[];switch(i.type){case Kt.MOVE_TO:this.pathM(r,A);break;case Kt.LINE_TO:a=this.pathL(r,A);break;case Kt.HORIZ_LINE_TO:a=this.pathH(r,A);break;case Kt.VERT_LINE_TO:a=this.pathV(r,A);break;case Kt.CURVE_TO:this.pathC(r,A);break;case Kt.SMOOTH_CURVE_TO:a=this.pathS(r,A);break;case Kt.QUAD_TO:this.pathQ(r,A);break;case Kt.SMOOTH_QUAD_TO:a=this.pathT(r,A);break;case Kt.ARC:A=this.pathA(r);break;case Kt.CLOSE_PATH:zt.pathZ(r)}i.type!==Kt.CLOSE_PATH?t.push({type:a,points:A,start:{x:o,y:s},pathLength:this.calcLength(o,s,a,A)}):t.push({type:Kt.CLOSE_PATH,points:[],pathLength:0})}return t}},{key:"pathM",value:function(e,t){var r=zt.pathM(e).point,n=r.x,o=r.y;t.push(n,o)}},{key:"pathL",value:function(e,t){var r=zt.pathL(e).point,n=r.x,o=r.y;return t.push(n,o),Kt.LINE_TO}},{key:"pathH",value:function(e,t){var r=zt.pathH(e).point,n=r.x,o=r.y;return t.push(n,o),Kt.LINE_TO}},{key:"pathV",value:function(e,t){var r=zt.pathV(e).point,n=r.x,o=r.y;return t.push(n,o),Kt.LINE_TO}},{key:"pathC",value:function(e,t){var r=zt.pathC(e),n=r.point,o=r.controlPoint,s=r.currentPoint;t.push(n.x,n.y,o.x,o.y,s.x,s.y)}},{key:"pathS",value:function(e,t){var r=zt.pathS(e),n=r.point,o=r.controlPoint,s=r.currentPoint;return t.push(n.x,n.y,o.x,o.y,s.x,s.y),Kt.CURVE_TO}},{key:"pathQ",value:function(e,t){var r=zt.pathQ(e),n=r.controlPoint,o=r.currentPoint;t.push(n.x,n.y,o.x,o.y)}},{key:"pathT",value:function(e,t){var r=zt.pathT(e),n=r.controlPoint,o=r.currentPoint;return t.push(n.x,n.y,o.x,o.y),Kt.QUAD_TO}},{key:"pathA",value:function(e){var t=zt.pathA(e),r=t.rX,n=t.rY,o=t.sweepFlag,s=t.xAxisRotation,i=t.centp,a=t.a1,A=t.ad;return 0===o&&A>0&&(A-=2*Math.PI),1===o&&A<0&&(A+=2*Math.PI),[i.x,i.y,r,n,a,A,s,o]}},{key:"calcLength",value:function(e,t,r,n){var o=0,s=null,i=null,a=0;switch(r){case Kt.LINE_TO:return this.getLineLength(e,t,n[0],n[1]);case Kt.CURVE_TO:for(o=0,s=this.getPointOnCubicBezier(0,e,t,n[0],n[1],n[2],n[3],n[4],n[5]),a=.01;a<=1;a+=.01)i=this.getPointOnCubicBezier(a,e,t,n[0],n[1],n[2],n[3],n[4],n[5]),o+=this.getLineLength(s.x,s.y,i.x,i.y),s=i;return o;case Kt.QUAD_TO:for(o=0,s=this.getPointOnQuadraticBezier(0,e,t,n[0],n[1],n[2],n[3]),a=.01;a<=1;a+=.01)i=this.getPointOnQuadraticBezier(a,e,t,n[0],n[1],n[2],n[3]),o+=this.getLineLength(s.x,s.y,i.x,i.y),s=i;return o;case Kt.ARC:o=0;var A=n[4],u=n[5],c=n[4]+u,l=Math.PI/180;if(Math.abs(A-c)<l&&(l=Math.abs(A-c)),s=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],A,0),u<0)for(a=A-l;a>c;a-=l)i=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],a,0),o+=this.getLineLength(s.x,s.y,i.x,i.y),s=i;else for(a=A+l;a<c;a+=l)i=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],a,0),o+=this.getLineLength(s.x,s.y,i.x,i.y),s=i;return i=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],c,0),o+this.getLineLength(s.x,s.y,i.x,i.y)}return 0}},{key:"getPointOnLine",value:function(e,t,r,n,o){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:r,a=(o-r)/(n-t+nt),A=Math.sqrt(e*e/(1+a*a));n<t&&(A*=-1);var u=a*A,c=null;if(n===t)c={x:s,y:i+u};else if((i-r)/(s-t+nt)===a)c={x:s+A,y:i+u};else{var l=0,d=0,f=this.getLineLength(t,r,n,o);if(f<nt)return null;var h=(s-t)*(n-t)+(i-r)*(o-r);l=t+(h/=f*f)*(n-t),d=r+h*(o-r);var p=this.getLineLength(s,i,l,d),m=Math.sqrt(e*e-p*p);A=Math.sqrt(m*m/(1+a*a)),n<t&&(A*=-1),c={x:l+A,y:d+(u=a*A)}}return c}},{key:"getPointOnPath",value:function(e){var t=this.getPathLength(),r=0,n=null;if(e<-5e-5||e-5e-5>t)return null;var o,s=function(e,t){var r;if(void 0===Fe()||null==Ne()(e)){if(xe()(e)||(r=function(e,t){var r;if(e){if("string"==typeof e)return mr(e,t);var n=Se()(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?ae()(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?mr(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,a=!1;return{s:function(){r=_e()(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){a=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(a)throw s}}}}(this.dataArray);try{for(s.s();!(o=s.n()).done;){var i=o.value;if(!i||!(i.pathLength<5e-5||r+i.pathLength+5e-5<e)){var a=e-r,A=0;switch(i.type){case Kt.LINE_TO:n=this.getPointOnLine(a,i.start.x,i.start.y,i.points[0],i.points[1],i.start.x,i.start.y);break;case Kt.ARC:var u=i.points[4],c=i.points[5],l=i.points[4]+c;if(A=u+a/i.pathLength*c,c<0&&A<l||c>=0&&A>l)break;n=this.getPointOnEllipticalArc(i.points[0],i.points[1],i.points[2],i.points[3],A,i.points[6]);break;case Kt.CURVE_TO:(A=a/i.pathLength)>1&&(A=1),n=this.getPointOnCubicBezier(A,i.start.x,i.start.y,i.points[0],i.points[1],i.points[2],i.points[3],i.points[4],i.points[5]);break;case Kt.QUAD_TO:(A=a/i.pathLength)>1&&(A=1),n=this.getPointOnQuadraticBezier(A,i.start.x,i.start.y,i.points[0],i.points[1],i.points[2],i.points[3])}if(n)return n;break}r+=i.pathLength}}catch(e){s.e(e)}finally{s.f()}return null}},{key:"getLineLength",value:function(e,t,r,n){return Math.sqrt((r-e)*(r-e)+(n-t)*(n-t))}},{key:"getPathLength",value:function(){var e;return-1===this.pathLength&&(this.pathLength=H()(e=this.dataArray).call(e,(function(e,t){return t.pathLength>0?e+t.pathLength:e}),0)),this.pathLength}},{key:"getPointOnCubicBezier",value:function(e,t,r,n,o,s,i,a,A){return{x:a*at(e)+s*At(e)+n*ut(e)+t*ct(e),y:A*at(e)+i*At(e)+o*ut(e)+r*ct(e)}}},{key:"getPointOnQuadraticBezier",value:function(e,t,r,n,o,s,i){return{x:s*lt(e)+n*dt(e)+t*ft(e),y:i*lt(e)+o*dt(e)+r*ft(e)}}},{key:"getPointOnEllipticalArc",value:function(e,t,r,n,o,s){var i=Math.cos(s),a=Math.sin(s),A=r*Math.cos(o),u=n*Math.sin(o);return{x:e+(A*i-u*a),y:t+(A*a+u*i)}}},{key:"buildEquidistantCache",value:function(e,t){var r=this.getPathLength(),n=t||.25,o=e||r/100;if(!this.equidistantCache||this.equidistantCache.step!==o||this.equidistantCache.precision!==n){this.equidistantCache={step:o,precision:n,points:[]};for(var s=0,i=0;i<=r;i+=n){var a=this.getPointOnPath(i),A=this.getPointOnPath(i+n);a&&A&&(s+=this.getLineLength(a.x,a.y,A.x,A.y))>=o&&(this.equidistantCache.points.push({x:a.x,y:a.y,distance:i}),s-=o)}}}},{key:"getEquidistantPointOnPath",value:function(e,t,r){if(this.buildEquidistantCache(t,r),e<0||e-this.getPathLength()>5e-5)return null;var n=Math.round(e/this.getPathLength()*(this.equidistantCache.points.length-1));return this.equidistantCache.points[n]||null}}]),o}(Rt);var wr=function(e){(0,Z.default)(i,e);var t,r,n,o,s=(n=i,o=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,ee.default)(n);if(o){var r=(0,ee.default)(this).constructor;e=Y()(t,arguments,r)}else e=t.apply(this,arguments);return(0,$.default)(this,e)});function i(e,t,r){var n;(0,F.default)(this,i),(n=s.call(this,e,t,r)).type="image",n.loaded=!1;var o=n.getHrefAttribute().getString();if(!o)return(0,$.default)(n);var a=/\.svg$/.test(o);return e.images.push((0,ye.default)(n)),a?n.loadSvg(o):n.loadImage(o),n.isSvg=a,n}return(0,U.default)(i,[{key:"loadImage",value:(r=(0,N.default)(E().mark((function e(t){var r;return E().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.document.createImage(t);case 3:r=e.sent,this.image=r,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error('Error while loading image "'.concat(t,'":'),e.t0);case 10:this.loaded=!0;case 11:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(e){return r.apply(this,arguments)})},{key:"loadSvg",value:(t=(0,N.default)(E().mark((function e(t){var r,n;return E().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.document.fetch(t);case 3:return r=e.sent,e.next=6,r.text();case 6:n=e.sent,this.image=n,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error('Error while loading image "'.concat(t,'":'),e.t0);case 13:this.loaded=!0;case 14:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(e){return t.apply(this,arguments)})},{key:"renderChildren",value:function(e){var t=this.document,r=this.image,n=this.loaded,o=this.getAttribute("x").getPixels("x"),s=this.getAttribute("y").getPixels("y"),i=this.getStyle("width").getPixels("x"),a=this.getStyle("height").getPixels("y");if(n&&r&&i&&a){if(e.save(),this.isSvg)t.canvg.forkString(e,this.image,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:o,offsetY:s,scaleWidth:i,scaleHeight:a}).render();else{var A=this.image;e.translate(o,s),t.setViewBox({ctx:e,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:i,desiredWidth:A.width,height:a,desiredHeight:A.height}),this.loaded&&(void 0===A.complete||A.complete)&&e.drawImage(A,0,0)}e.restore()}}},{key:"getBoundingBox",value:function(){var e=this.getAttribute("x").getPixels("x"),t=this.getAttribute("y").getPixels("y"),r=this.getStyle("width").getPixels("x"),n=this.getStyle("height").getPixels("y");return new Ot(e,t,e+r,t+n)}}]),i}(kt);var br=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(){var e;return(0,F.default)(this,o),(e=n.apply(this,arguments)).type="symbol",e}return(0,U.default)(o,[{key:"render",value:function(e){}}]),o}(kt),Br=function(){function e(t){(0,F.default)(this,e),this.document=t,this.loaded=!1,t.fonts.push(this)}var t;return(0,U.default)(e,[{key:"load",value:(t=(0,N.default)(E().mark((function e(t,r){var n,o,s,i;return E().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=this.document,e.next=4,o.canvg.parser.load(r);case 4:s=e.sent,i=s.getElementsByTagName("font"),g()(n=ae()(i)).call(n,(function(e){var r=o.createElement(e);o.definitions[t]=r})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error('Error while loading font "'.concat(r,'":'),e.t0);case 12:this.loaded=!0;case 13:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(e,r){return t.apply(this,arguments)})}]),e}();var jr=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(e,t,r){var s,i;(0,F.default)(this,o),(i=n.call(this,e,t,r)).type="style";var a=Re(A()(s=ae()(t.childNodes)).call(s,(function(e){return e.data})).join("").replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"").replace(/@import.*;/g,"")).split("}");return g()(a).call(a,(function(t){var r=G()(t).call(t);if(r){var n=r.split("{"),o=n[0].split(","),s=n[1].split(";");g()(o).call(o,(function(t){var r=G()(t).call(t);if(r){var n=e.styles[r]||{};if(g()(s).call(s,(function(t){var r,o,s=le()(t).call(t,":"),i=G()(r=t.substr(0,s)).call(r),a=G()(o=t.substr(s+1,t.length-s)).call(o);i&&a&&(n[i]=new ht(e,i,a))})),e.styles[r]=n,e.stylesSpecificity[r]=rt(r),"@font-face"===r){var o=n["font-family"].getString().replace(/"|'/g,""),i=n.src.getString().split(",");g()(i).call(i,(function(t){if(le()(t).call(t,'format("svg")')>0){var r=qe(t);r&&new Br(e).load(o,r)}}))}}}))}})),i}return o}(St);jr.parseExternalUrl=qe;var _r=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(){var e;return(0,F.default)(this,o),(e=n.apply(this,arguments)).type="use",e}return(0,U.default)(o,[{key:"setContext",value:function(e){(0,de.default)((0,ee.default)(o.prototype),"setContext",this).call(this,e);var t=this.getAttribute("x"),r=this.getAttribute("y");t.hasValue()&&e.translate(t.getPixels("x"),0),r.hasValue()&&e.translate(0,r.getPixels("y"))}},{key:"path",value:function(e){var t=this.element;t&&t.path(e)}},{key:"renderChildren",value:function(e){var t=this.document,r=this.element;if(r){var n=r;if("symbol"===r.type&&((n=new Vt(t,null)).attributes.viewBox=new ht(t,"viewBox",r.getAttribute("viewBox").getString()),n.attributes.preserveAspectRatio=new ht(t,"preserveAspectRatio",r.getAttribute("preserveAspectRatio").getString()),n.attributes.overflow=new ht(t,"overflow",r.getAttribute("overflow").getString()),n.children=r.children,r.styles.opacity=new ht(t,"opacity",this.calculateOpacity())),"svg"===n.type){var o=this.getStyle("width",!1,!0),s=this.getStyle("height",!1,!0);o.hasValue()&&(n.attributes.width=new ht(t,"width",o.getString())),s.hasValue()&&(n.attributes.height=new ht(t,"height",s.getString()))}var i=n.parent;n.parent=this,n.render(e),n.parent=i}}},{key:"getBoundingBox",value:function(e){var t=this.element;return t?t.getBoundingBox(e):null}},{key:"elementTransform",value:function(){var e=this.document,t=this.element;return Ut.fromElement(e,t)}},{key:"element",get:function(){return this._element||(this._element=this.getHrefAttribute().getDefinition()),this._element}}]),o}(kt);function Cr(e,t,r,n,o,s){return e[r*n*4+4*t+s]}function xr(e,t,r,n,o,s,i){e[r*n*4+4*t+s]=i}function Er(e,t,r){return e[t]*r}function Nr(e,t,r,n){return t+Math.cos(e)*r+Math.sin(e)*n}var Qr=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(e,t,r){var s;(0,F.default)(this,o),(s=n.call(this,e,t,r)).type="feColorMatrix";var i=Ke(s.getAttribute("values").getString());switch(s.getAttribute("type").getString("matrix")){case"saturate":var a=i[0];i=[.213+.787*a,.715-.715*a,.072-.072*a,0,0,.213-.213*a,.715+.285*a,.072-.072*a,0,0,.213-.213*a,.715-.715*a,.072+.928*a,0,0,0,0,0,1,0,0,0,0,0,1];break;case"hueRotate":var A=i[0]*Math.PI/180;i=[Nr(A,.213,.787,-.213),Nr(A,.715,-.715,-.715),Nr(A,.072,-.072,.928),0,0,Nr(A,.213,-.213,.143),Nr(A,.715,.285,.14),Nr(A,.072,-.072,-.283),0,0,Nr(A,.213,-.213,-.787),Nr(A,.715,-.715,.715),Nr(A,.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case"luminanceToAlpha":i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1]}return s.matrix=i,s.includeOpacity=s.getAttribute("includeOpacity").hasValue(),s}return(0,U.default)(o,[{key:"apply",value:function(e,t,r,n,o){for(var s=this.includeOpacity,i=this.matrix,a=e.getImageData(0,0,n,o),A=0;A<o;A++)for(var u=0;u<n;u++){var c=Cr(a.data,u,A,n,0,0),l=Cr(a.data,u,A,n,0,1),d=Cr(a.data,u,A,n,0,2),f=Cr(a.data,u,A,n,0,3),h=Er(i,0,c)+Er(i,1,l)+Er(i,2,d)+Er(i,3,f)+Er(i,4,1),p=Er(i,5,c)+Er(i,6,l)+Er(i,7,d)+Er(i,8,f)+Er(i,9,1),m=Er(i,10,c)+Er(i,11,l)+Er(i,12,d)+Er(i,13,f)+Er(i,14,1),g=Er(i,15,c)+Er(i,16,l)+Er(i,17,d)+Er(i,18,f)+Er(i,19,1);s&&(h=p=m=0,g*=f/255),xr(a.data,u,A,n,0,0,h),xr(a.data,u,A,n,0,1,p),xr(a.data,u,A,n,0,2,m),xr(a.data,u,A,n,0,3,g)}e.clearRect(0,0,n,o),e.putImageData(a,0,0)}}]),o}(St);var Fr=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(){var e;return(0,F.default)(this,o),(e=n.apply(this,arguments)).type="mask",e}return(0,U.default)(o,[{key:"apply",value:function(e,t){var r=this.document,n=this.getAttribute("x").getPixels("x"),s=this.getAttribute("y").getPixels("y"),i=this.getStyle("width").getPixels("x"),a=this.getStyle("height").getPixels("y");if(!i&&!a){var A,u=new Ot;g()(A=this.children).call(A,(function(t){u.addBoundingBox(t.getBoundingBox(e))})),n=Math.floor(u.x1),s=Math.floor(u.y1),i=Math.floor(u.width),a=Math.floor(u.height)}var c=this.removeStyles(t,o.ignoreStyles),l=r.createCanvas(n+i,s+a),d=l.getContext("2d");r.screen.setDefaults(d),this.renderChildren(d),new Qr(r,{nodeType:1,childNodes:[],attributes:[{nodeName:"type",value:"luminanceToAlpha"},{nodeName:"includeOpacity",value:"true"}]}).apply(d,0,0,n+i,s+a);var f=r.createCanvas(n+i,s+a),h=f.getContext("2d");r.screen.setDefaults(h),t.render(h),h.globalCompositeOperation="destination-in",h.fillStyle=d.createPattern(l,"no-repeat"),h.fillRect(0,0,n+i,s+a),e.fillStyle=h.createPattern(f,"no-repeat"),e.fillRect(0,0,n+i,s+a),this.restoreStyles(t,c)}},{key:"render",value:function(e){}}]),o}(St);Fr.ignoreStyles=["mask","transform","clip-path"];var Ur=function(){},Sr=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(){var e;return(0,F.default)(this,o),(e=n.apply(this,arguments)).type="clipPath",e}return(0,U.default)(o,[{key:"apply",value:function(e){var t,r=this.document,n=Oe()(e),o=e.beginPath,s=e.closePath;n&&(n.beginPath=Ur,n.closePath=Ur),Ie()(o,e,[]),g()(t=this.children).call(t,(function(t){if(void 0!==t.path){var o=void 0!==t.elementTransform?t.elementTransform():null;o||(o=Ut.fromElement(r,t)),o&&o.apply(e),t.path(e),n&&(n.closePath=s),o&&o.unapply(e)}})),Ie()(s,e,[]),e.clip(),n&&(n.beginPath=o,n.closePath=s)}},{key:"render",value:function(e){}}]),o}(St);var Lr=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(){var e;return(0,F.default)(this,o),(e=n.apply(this,arguments)).type="filter",e}return(0,U.default)(o,[{key:"apply",value:function(e,t){var r=this.document,n=this.children,s=t.getBoundingBox(e);if(s){var i=0,a=0;g()(n).call(n,(function(e){var t=e.extraFilterDistance||0;i=Math.max(i,t),a=Math.max(a,t)}));var A=Math.floor(s.width),u=Math.floor(s.height),c=A+2*i,l=u+2*a;if(!(c<1||l<1)){var d=Math.floor(s.x),f=Math.floor(s.y),h=this.removeStyles(t,o.ignoreStyles),p=r.createCanvas(c,l),m=p.getContext("2d");r.screen.setDefaults(m),m.translate(-d+i,-f+a),t.render(m),g()(n).call(n,(function(e){"function"==typeof e.apply&&e.apply(m,0,0,c,l)})),e.drawImage(p,0,0,c,l,d-i,f-a,c,l),this.restoreStyles(t,h)}}}},{key:"render",value:function(e){}}]),o}(St);Lr.ignoreStyles=["filter","transform","clip-path"];var Tr=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(e,t,r){var s;return(0,F.default)(this,o),(s=n.call(this,e,t,r)).type="feDropShadow",s.addStylesFromStyleDefinition(),s}return(0,U.default)(o,[{key:"apply",value:function(e,t,r,n,o){}}]),o}(St);var Hr=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(){var e;return(0,F.default)(this,o),(e=n.apply(this,arguments)).type="feMorphology",e}return(0,U.default)(o,[{key:"apply",value:function(e,t,r,n,o){}}]),o}(St);var Ir=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(){var e;return(0,F.default)(this,o),(e=n.apply(this,arguments)).type="feComposite",e}return(0,U.default)(o,[{key:"apply",value:function(e,t,r,n,o){}}]),o}(St);var Pr=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(e,t,r){var s;return(0,F.default)(this,o),(s=n.call(this,e,t,r)).type="feGaussianBlur",s.blurRadius=Math.floor(s.getAttribute("stdDeviation").getNumber()),s.extraFilterDistance=s.blurRadius,s}return(0,U.default)(o,[{key:"apply",value:function(e,t,r,n,o){var s=this.document,i=this.blurRadius,a=s.window?s.window.document.body:null,A=e.canvas;A.id=s.getUniqueId(),a&&(A.style.display="none",a.appendChild(A)),(0,ke.canvasRGBA)(A,t,r,n,o,i),a&&a.removeChild(A)}}]),o}(St);var Or=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(){var e;return(0,F.default)(this,o),(e=n.apply(this,arguments)).type="title",e}return o}(St);var kr=function(e){(0,Z.default)(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Y())return!1;if(Y().sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Y()(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,ee.default)(t);if(r){var o=(0,ee.default)(this).constructor;e=Y()(n,arguments,o)}else e=n.apply(this,arguments);return(0,$.default)(this,e)});function o(){var e;return(0,F.default)(this,o),(e=n.apply(this,arguments)).type="desc",e}return o}(St),Rr={svg:Vt,rect:qt,circle:Gt,ellipse:Xt,line:Wt,polyline:Jt,polygon:Yt,path:zt,pattern:Zt,marker:$t,defs:er,linearGradient:nr,radialGradient:or,stop:sr,animate:ir,animateColor:ar,animateTransform:Ar,font:cr,"font-face":lr,"missing-glyph":dr,glyph:fr,text:Rt,tspan:Mt,tref:hr,a:pr,textPath:vr,image:wr,g:tr,symbol:br,style:jr,use:_r,mask:Fr,clipPath:Sr,filter:Lr,feDropShadow:Tr,feMorphology:Hr,feComposite:Ir,feColorMatrix:Qr,feGaussianBlur:Pr,title:Or,desc:kr};function Mr(e,t){var r=C()(e);if(j()){var n=j()(e);t&&(n=b()(n).call(n,(function(t){return v()(e,t).enumerable}))),r.push.apply(r,n)}return r}function Dr(){return(Dr=(0,N.default)(E().mark((function e(t){var r,n,o=arguments;return E().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>1&&void 0!==o[1]&&o[1],n=document.createElement("img"),r&&(n.crossOrigin="Anonymous"),e.abrupt("return",new(M())((function(e,r){n.onload=function(){e(n)},n.onerror=function(){r()},n.src=t})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Kr=function(){function e(t){var r,n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=o.rootEmSize,i=void 0===s?12:s,a=o.emSize,A=void 0===a?12:a,u=o.createCanvas,c=void 0===u?e.createCanvas:u,l=o.createImage,d=void 0===l?e.createImage:l,f=o.anonymousCrossOrigin;(0,F.default)(this,e),this.canvg=t,this.definitions={},this.styles={},this.stylesSpecificity={},this.images=[],this.fonts=[],this.emSizeStack=[],this.uniqueId=0,this.screen=t.screen,this.rootEmSize=i,this.emSize=A,this.createCanvas=c,this.createImage=this.bindCreateImage(d,f),this.screen.wait(K()(r=this.isImagesLoaded).call(r,this)),this.screen.wait(K()(n=this.isFontsLoaded).call(n,this))}return(0,U.default)(e,[{key:"bindCreateImage",value:function(e,t){return"boolean"==typeof t?function(r,n){return e(r,"boolean"==typeof n?n:t)}:e}},{key:"popEmSize",value:function(){this.emSizeStack.pop()}},{key:"getUniqueId",value:function(){return"canvg".concat(++this.uniqueId)}},{key:"isImagesLoaded",value:function(){var e;return k()(e=this.images).call(e,(function(e){return e.loaded}))}},{key:"isFontsLoaded",value:function(){var e;return k()(e=this.fonts).call(e,(function(e){return e.loaded}))}},{key:"createDocumentElement",value:function(e){var t=this.createElement(e.documentElement);return t.root=!0,t.addStylesFromStyleDefinition(),this.documentElement=t,t}},{key:"createElement",value:function(t){var r=t.nodeName.replace(/^[^:]+:/,""),n=e.elementTypes[r];return void 0!==n?new n(this,t):new Lt(this,t)}},{key:"createTextNode",value:function(e){return new Dt(this,e)}},{key:"setViewBox",value:function(e){this.screen.setViewBox(function(e){for(var t=1;t<arguments.length;t++){var r,n=null!=arguments[t]?arguments[t]:{};if(t%2)g()(r=Mr(Object(n),!0)).call(r,(function(t){(0,Q.default)(e,t,n[t])}));else if(p())f()(e,p()(n));else{var o;g()(o=Mr(Object(n))).call(o,(function(t){l()(e,t,v()(n,t))}))}}return e}({document:this},e))}},{key:"window",get:function(){return this.screen.window}},{key:"fetch",get:function(){return this.screen.fetch}},{key:"ctx",get:function(){return this.screen.ctx}},{key:"emSize",get:function(){var e=this.emSizeStack;return e[e.length-1]},set:function(e){this.emSizeStack.push(e)}}]),e}();function zr(e,t){var r=C()(e);if(j()){var n=j()(e);t&&(n=b()(n).call(n,(function(t){return v()(e,t).enumerable}))),r.push.apply(r,n)}return r}function Vr(e){for(var t=1;t<arguments.length;t++){var r,n=null!=arguments[t]?arguments[t]:{};if(t%2)g()(r=zr(Object(n),!0)).call(r,(function(t){(0,Q.default)(e,t,n[t])}));else if(p())f()(e,p()(n));else{var o;g()(o=zr(Object(n))).call(o,(function(t){l()(e,t,v()(n,t))}))}}return e}Kr.createCanvas=function(e,t){var r=document.createElement("canvas");return r.width=e,r.height=t,r},Kr.createImage=function(e){return Dr.apply(this,arguments)},Kr.elementTypes=Rr;var qr=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,F.default)(this,e),this.parser=new jt(n),this.screen=new wt(t,n),this.options=n;var o=new Kr(this,n),s=o.createDocumentElement(r);this.document=o,this.documentElement=s}var t,r;return(0,U.default)(e,[{key:"fork",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e.from(t,r,Vr(Vr({},this.options),n))}},{key:"forkString",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e.fromString(t,r,Vr(Vr({},this.options),n))}},{key:"ready",value:function(){return this.screen.ready()}},{key:"isReady",value:function(){return this.screen.isReady()}},{key:"render",value:(r=(0,N.default)(E().mark((function e(){var t,r=arguments;return E().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},this.start(Vr({enableRedraw:!0,ignoreAnimation:!0,ignoreMouse:!0},t)),e.next=4,this.ready();case 4:this.stop();case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.documentElement,r=this.screen,n=this.options;r.start(t,Vr(Vr({enableRedraw:!0},n),e))}},{key:"stop",value:function(){this.screen.stop()}},{key:"resize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.documentElement.resize(e,t,r)}}],[{key:"from",value:(t=(0,N.default)(E().mark((function t(r,n){var o,s,i,a=arguments;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=a.length>2&&void 0!==a[2]?a[2]:{},s=new jt(o),t.next=4,s.parse(n);case 4:return i=t.sent,t.abrupt("return",new e(r,i,o));case 6:case"end":return t.stop()}}),t)}))),function(e,r){return t.apply(this,arguments)})},{key:"fromString",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=new jt(n),s=o.parseFromString(r);return new e(t,s,n)}}]),e}(),Gr=Object.freeze({__proto__:null,offscreen:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.DOMParser,r={window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:t,createCanvas:function(e,t){return new OffscreenCanvas(e,t)},createImage:function(e){return(0,N.default)(E().mark((function t(){var r,n,o;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e);case 2:return r=t.sent,t.next=5,r.blob();case 5:return n=t.sent,t.next=8,createImageBitmap(n);case 8:return o=t.sent,t.abrupt("return",o);case 10:case"end":return t.stop()}}),t)})))()}};return"undefined"==typeof DOMParser&&void 0!==t||ge()(r,"DOMParser"),r},node:function(e){var t=e.DOMParser,r=e.canvas;return{window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:t,fetch:e.fetch,createCanvas:r.createCanvas,createImage:r.loadImage}}});t.default=qr},"./node_modules/core-js-pure/es/array/from.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.string.iterator.js"),r("./node_modules/core-js-pure/modules/es.array.from.js");var n=r("./node_modules/core-js-pure/internals/path.js");e.exports=n.Array.from},"./node_modules/core-js-pure/es/array/is-array.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.array.is-array.js");var n=r("./node_modules/core-js-pure/internals/path.js");e.exports=n.Array.isArray},"./node_modules/core-js-pure/es/array/virtual/concat.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.array.concat.js");var n=r("./node_modules/core-js-pure/internals/entry-virtual.js");e.exports=n("Array").concat},"./node_modules/core-js-pure/es/array/virtual/every.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.array.every.js");var n=r("./node_modules/core-js-pure/internals/entry-virtual.js");e.exports=n("Array").every},"./node_modules/core-js-pure/es/array/virtual/fill.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.array.fill.js");var n=r("./node_modules/core-js-pure/internals/entry-virtual.js");e.exports=n("Array").fill},"./node_modules/core-js-pure/es/array/virtual/filter.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.array.filter.js");var n=r("./node_modules/core-js-pure/internals/entry-virtual.js");e.exports=n("Array").filter},"./node_modules/core-js-pure/es/array/virtual/for-each.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.array.for-each.js");var n=r("./node_modules/core-js-pure/internals/entry-virtual.js");e.exports=n("Array").forEach},"./node_modules/core-js-pure/es/array/virtual/includes.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.array.includes.js");var n=r("./node_modules/core-js-pure/internals/entry-virtual.js");e.exports=n("Array").includes},"./node_modules/core-js-pure/es/array/virtual/index-of.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.array.index-of.js");var n=r("./node_modules/core-js-pure/internals/entry-virtual.js");e.exports=n("Array").indexOf},"./node_modules/core-js-pure/es/array/virtual/map.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.array.map.js");var n=r("./node_modules/core-js-pure/internals/entry-virtual.js");e.exports=n("Array").map},"./node_modules/core-js-pure/es/array/virtual/reduce.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.array.reduce.js");var n=r("./node_modules/core-js-pure/internals/entry-virtual.js");e.exports=n("Array").reduce},"./node_modules/core-js-pure/es/array/virtual/reverse.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.array.reverse.js");var n=r("./node_modules/core-js-pure/internals/entry-virtual.js");e.exports=n("Array").reverse},"./node_modules/core-js-pure/es/array/virtual/slice.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.array.slice.js");var n=r("./node_modules/core-js-pure/internals/entry-virtual.js");e.exports=n("Array").slice},"./node_modules/core-js-pure/es/array/virtual/some.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.array.some.js");var n=r("./node_modules/core-js-pure/internals/entry-virtual.js");e.exports=n("Array").some},"./node_modules/core-js-pure/es/array/virtual/values.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.array.iterator.js");var n=r("./node_modules/core-js-pure/internals/entry-virtual.js");e.exports=n("Array").values},"./node_modules/core-js-pure/es/date/now.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.date.now.js");var n=r("./node_modules/core-js-pure/internals/path.js");e.exports=n.Date.now},"./node_modules/core-js-pure/es/function/virtual/bind.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.function.bind.js");var n=r("./node_modules/core-js-pure/internals/entry-virtual.js");e.exports=n("Function").bind},"./node_modules/core-js-pure/es/instance/bind.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/function/virtual/bind.js"),o=Function.prototype;e.exports=function(e){var t=e.bind;return e===o||e instanceof Function&&t===o.bind?n:t}},"./node_modules/core-js-pure/es/instance/concat.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/array/virtual/concat.js"),o=Array.prototype;e.exports=function(e){var t=e.concat;return e===o||e instanceof Array&&t===o.concat?n:t}},"./node_modules/core-js-pure/es/instance/every.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/array/virtual/every.js"),o=Array.prototype;e.exports=function(e){var t=e.every;return e===o||e instanceof Array&&t===o.every?n:t}},"./node_modules/core-js-pure/es/instance/fill.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/array/virtual/fill.js"),o=Array.prototype;e.exports=function(e){var t=e.fill;return e===o||e instanceof Array&&t===o.fill?n:t}},"./node_modules/core-js-pure/es/instance/filter.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/array/virtual/filter.js"),o=Array.prototype;e.exports=function(e){var t=e.filter;return e===o||e instanceof Array&&t===o.filter?n:t}},"./node_modules/core-js-pure/es/instance/includes.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/array/virtual/includes.js"),o=r("./node_modules/core-js-pure/es/string/virtual/includes.js"),s=Array.prototype,i=String.prototype;e.exports=function(e){var t=e.includes;return e===s||e instanceof Array&&t===s.includes?n:"string"==typeof e||e===i||e instanceof String&&t===i.includes?o:t}},"./node_modules/core-js-pure/es/instance/index-of.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/array/virtual/index-of.js"),o=Array.prototype;e.exports=function(e){var t=e.indexOf;return e===o||e instanceof Array&&t===o.indexOf?n:t}},"./node_modules/core-js-pure/es/instance/map.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/array/virtual/map.js"),o=Array.prototype;e.exports=function(e){var t=e.map;return e===o||e instanceof Array&&t===o.map?n:t}},"./node_modules/core-js-pure/es/instance/reduce.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/array/virtual/reduce.js"),o=Array.prototype;e.exports=function(e){var t=e.reduce;return e===o||e instanceof Array&&t===o.reduce?n:t}},"./node_modules/core-js-pure/es/instance/reverse.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/array/virtual/reverse.js"),o=Array.prototype;e.exports=function(e){var t=e.reverse;return e===o||e instanceof Array&&t===o.reverse?n:t}},"./node_modules/core-js-pure/es/instance/slice.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/array/virtual/slice.js"),o=Array.prototype;e.exports=function(e){var t=e.slice;return e===o||e instanceof Array&&t===o.slice?n:t}},"./node_modules/core-js-pure/es/instance/some.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/array/virtual/some.js"),o=Array.prototype;e.exports=function(e){var t=e.some;return e===o||e instanceof Array&&t===o.some?n:t}},"./node_modules/core-js-pure/es/instance/starts-with.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/string/virtual/starts-with.js"),o=String.prototype;e.exports=function(e){var t=e.startsWith;return"string"==typeof e||e===o||e instanceof String&&t===o.startsWith?n:t}},"./node_modules/core-js-pure/es/instance/trim.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/string/virtual/trim.js"),o=String.prototype;e.exports=function(e){var t=e.trim;return"string"==typeof e||e===o||e instanceof String&&t===o.trim?n:t}},"./node_modules/core-js-pure/es/map/index.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.map.js"),r("./node_modules/core-js-pure/modules/es.object.to-string.js"),r("./node_modules/core-js-pure/modules/es.string.iterator.js"),r("./node_modules/core-js-pure/modules/web.dom-collections.iterator.js");var n=r("./node_modules/core-js-pure/internals/path.js");e.exports=n.Map},"./node_modules/core-js-pure/es/object/create.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.object.create.js");var n=r("./node_modules/core-js-pure/internals/path.js").Object;e.exports=function(e,t){return n.create(e,t)}},"./node_modules/core-js-pure/es/object/define-properties.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.object.define-properties.js");var n=r("./node_modules/core-js-pure/internals/path.js").Object,o=e.exports=function(e,t){return n.defineProperties(e,t)};n.defineProperties.sham&&(o.sham=!0)},"./node_modules/core-js-pure/es/object/define-property.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.object.define-property.js");var n=r("./node_modules/core-js-pure/internals/path.js").Object,o=e.exports=function(e,t,r){return n.defineProperty(e,t,r)};n.defineProperty.sham&&(o.sham=!0)},"./node_modules/core-js-pure/es/object/get-own-property-descriptor.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.object.get-own-property-descriptor.js");var n=r("./node_modules/core-js-pure/internals/path.js").Object,o=e.exports=function(e,t){return n.getOwnPropertyDescriptor(e,t)};n.getOwnPropertyDescriptor.sham&&(o.sham=!0)},"./node_modules/core-js-pure/es/object/get-own-property-descriptors.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.object.get-own-property-descriptors.js");var n=r("./node_modules/core-js-pure/internals/path.js");e.exports=n.Object.getOwnPropertyDescriptors},"./node_modules/core-js-pure/es/object/get-own-property-symbols.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.symbol.js");var n=r("./node_modules/core-js-pure/internals/path.js");e.exports=n.Object.getOwnPropertySymbols},"./node_modules/core-js-pure/es/object/get-prototype-of.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.object.get-prototype-of.js");var n=r("./node_modules/core-js-pure/internals/path.js");e.exports=n.Object.getPrototypeOf},"./node_modules/core-js-pure/es/object/keys.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.object.keys.js");var n=r("./node_modules/core-js-pure/internals/path.js");e.exports=n.Object.keys},"./node_modules/core-js-pure/es/object/set-prototype-of.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.object.set-prototype-of.js");var n=r("./node_modules/core-js-pure/internals/path.js");e.exports=n.Object.setPrototypeOf},"./node_modules/core-js-pure/es/parse-float.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.parse-float.js");var n=r("./node_modules/core-js-pure/internals/path.js");e.exports=n.parseFloat},"./node_modules/core-js-pure/es/parse-int.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.parse-int.js");var n=r("./node_modules/core-js-pure/internals/path.js");e.exports=n.parseInt},"./node_modules/core-js-pure/es/promise/index.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.aggregate-error.js"),r("./node_modules/core-js-pure/modules/es.object.to-string.js"),r("./node_modules/core-js-pure/modules/es.promise.js"),r("./node_modules/core-js-pure/modules/es.promise.all-settled.js"),r("./node_modules/core-js-pure/modules/es.promise.any.js"),r("./node_modules/core-js-pure/modules/es.promise.finally.js"),r("./node_modules/core-js-pure/modules/es.string.iterator.js"),r("./node_modules/core-js-pure/modules/web.dom-collections.iterator.js");var n=r("./node_modules/core-js-pure/internals/path.js");e.exports=n.Promise},"./node_modules/core-js-pure/es/reflect/apply.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.reflect.apply.js");var n=r("./node_modules/core-js-pure/internals/path.js");e.exports=n.Reflect.apply},"./node_modules/core-js-pure/es/reflect/construct.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.reflect.construct.js");var n=r("./node_modules/core-js-pure/internals/path.js");e.exports=n.Reflect.construct},"./node_modules/core-js-pure/es/reflect/delete-property.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.reflect.delete-property.js");var n=r("./node_modules/core-js-pure/internals/path.js");e.exports=n.Reflect.deleteProperty},"./node_modules/core-js-pure/es/reflect/get-prototype-of.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.reflect.get-prototype-of.js");var n=r("./node_modules/core-js-pure/internals/path.js");e.exports=n.Reflect.getPrototypeOf},"./node_modules/core-js-pure/es/reflect/get.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.reflect.get.js");var n=r("./node_modules/core-js-pure/internals/path.js");e.exports=n.Reflect.get},"./node_modules/core-js-pure/es/string/virtual/includes.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.string.includes.js");var n=r("./node_modules/core-js-pure/internals/entry-virtual.js");e.exports=n("String").includes},"./node_modules/core-js-pure/es/string/virtual/starts-with.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.string.starts-with.js");var n=r("./node_modules/core-js-pure/internals/entry-virtual.js");e.exports=n("String").startsWith},"./node_modules/core-js-pure/es/string/virtual/trim.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.string.trim.js");var n=r("./node_modules/core-js-pure/internals/entry-virtual.js");e.exports=n("String").trim},"./node_modules/core-js-pure/es/symbol/index.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.array.concat.js"),r("./node_modules/core-js-pure/modules/es.object.to-string.js"),r("./node_modules/core-js-pure/modules/es.symbol.js"),r("./node_modules/core-js-pure/modules/es.symbol.async-iterator.js"),r("./node_modules/core-js-pure/modules/es.symbol.description.js"),r("./node_modules/core-js-pure/modules/es.symbol.has-instance.js"),r("./node_modules/core-js-pure/modules/es.symbol.is-concat-spreadable.js"),r("./node_modules/core-js-pure/modules/es.symbol.iterator.js"),r("./node_modules/core-js-pure/modules/es.symbol.match.js"),r("./node_modules/core-js-pure/modules/es.symbol.match-all.js"),r("./node_modules/core-js-pure/modules/es.symbol.replace.js"),r("./node_modules/core-js-pure/modules/es.symbol.search.js"),r("./node_modules/core-js-pure/modules/es.symbol.species.js"),r("./node_modules/core-js-pure/modules/es.symbol.split.js"),r("./node_modules/core-js-pure/modules/es.symbol.to-primitive.js"),r("./node_modules/core-js-pure/modules/es.symbol.to-string-tag.js"),r("./node_modules/core-js-pure/modules/es.symbol.unscopables.js"),r("./node_modules/core-js-pure/modules/es.json.to-string-tag.js"),r("./node_modules/core-js-pure/modules/es.math.to-string-tag.js"),r("./node_modules/core-js-pure/modules/es.reflect.to-string-tag.js");var n=r("./node_modules/core-js-pure/internals/path.js");e.exports=n.Symbol},"./node_modules/core-js-pure/es/symbol/iterator.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.symbol.iterator.js"),r("./node_modules/core-js-pure/modules/es.string.iterator.js"),r("./node_modules/core-js-pure/modules/web.dom-collections.iterator.js");var n=r("./node_modules/core-js-pure/internals/well-known-symbol-wrapped.js");e.exports=n.f("iterator")},"./node_modules/core-js-pure/features/array/from.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/array/from.js");e.exports=n},"./node_modules/core-js-pure/features/array/is-array.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/array/is-array.js");e.exports=n},"./node_modules/core-js-pure/features/get-iterator-method.js":function(e,t,r){r("./node_modules/core-js-pure/modules/web.dom-collections.iterator.js"),r("./node_modules/core-js-pure/modules/es.string.iterator.js");var n=r("./node_modules/core-js-pure/internals/get-iterator-method.js");e.exports=n},"./node_modules/core-js-pure/features/get-iterator.js":function(e,t,r){r("./node_modules/core-js-pure/modules/web.dom-collections.iterator.js"),r("./node_modules/core-js-pure/modules/es.string.iterator.js");var n=r("./node_modules/core-js-pure/internals/get-iterator.js");e.exports=n},"./node_modules/core-js-pure/features/instance/slice.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/instance/slice.js");e.exports=n},"./node_modules/core-js-pure/features/object/create.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/object/create.js");e.exports=n},"./node_modules/core-js-pure/features/object/define-property.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/object/define-property.js");e.exports=n},"./node_modules/core-js-pure/features/object/get-own-property-descriptor.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/object/get-own-property-descriptor.js");e.exports=n},"./node_modules/core-js-pure/features/object/get-prototype-of.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/object/get-prototype-of.js");e.exports=n},"./node_modules/core-js-pure/features/object/set-prototype-of.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/object/set-prototype-of.js");e.exports=n},"./node_modules/core-js-pure/features/promise/index.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/promise/index.js");r("./node_modules/core-js-pure/modules/esnext.aggregate-error.js"),r("./node_modules/core-js-pure/modules/esnext.promise.all-settled.js"),r("./node_modules/core-js-pure/modules/esnext.promise.try.js"),r("./node_modules/core-js-pure/modules/esnext.promise.any.js"),e.exports=n},"./node_modules/core-js-pure/features/reflect/get.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/reflect/get.js");e.exports=n},"./node_modules/core-js-pure/features/symbol/index.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/symbol/index.js");r("./node_modules/core-js-pure/modules/esnext.symbol.async-dispose.js"),r("./node_modules/core-js-pure/modules/esnext.symbol.dispose.js"),r("./node_modules/core-js-pure/modules/esnext.symbol.matcher.js"),r("./node_modules/core-js-pure/modules/esnext.symbol.metadata.js"),r("./node_modules/core-js-pure/modules/esnext.symbol.observable.js"),r("./node_modules/core-js-pure/modules/esnext.symbol.pattern-match.js"),r("./node_modules/core-js-pure/modules/esnext.symbol.replace-all.js"),e.exports=n},"./node_modules/core-js-pure/features/symbol/iterator.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/symbol/iterator.js");e.exports=n},"./node_modules/core-js-pure/internals/a-function.js":function(e){e.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}},"./node_modules/core-js-pure/internals/a-possible-prototype.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/is-object.js");e.exports=function(e){if(!n(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e}},"./node_modules/core-js-pure/internals/add-to-unscopables.js":function(e){e.exports=function(){}},"./node_modules/core-js-pure/internals/an-instance.js":function(e){e.exports=function(e,t,r){if(!(e instanceof t))throw TypeError("Incorrect "+(r?r+" ":"")+"invocation");return e}},"./node_modules/core-js-pure/internals/an-object.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/is-object.js");e.exports=function(e){if(!n(e))throw TypeError(String(e)+" is not an object");return e}},"./node_modules/core-js-pure/internals/array-fill.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/to-object.js"),o=r("./node_modules/core-js-pure/internals/to-absolute-index.js"),s=r("./node_modules/core-js-pure/internals/to-length.js");e.exports=function(e){for(var t=n(this),r=s(t.length),i=arguments.length,a=o(i>1?arguments[1]:void 0,r),A=i>2?arguments[2]:void 0,u=void 0===A?r:o(A,r);u>a;)t[a++]=e;return t}},"./node_modules/core-js-pure/internals/array-for-each.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/array-iteration.js").forEach,o=r("./node_modules/core-js-pure/internals/array-method-is-strict.js")("forEach");e.exports=o?[].forEach:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}},"./node_modules/core-js-pure/internals/array-from.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/function-bind-context.js"),o=r("./node_modules/core-js-pure/internals/to-object.js"),s=r("./node_modules/core-js-pure/internals/call-with-safe-iteration-closing.js"),i=r("./node_modules/core-js-pure/internals/is-array-iterator-method.js"),a=r("./node_modules/core-js-pure/internals/to-length.js"),A=r("./node_modules/core-js-pure/internals/create-property.js"),u=r("./node_modules/core-js-pure/internals/get-iterator-method.js");e.exports=function(e){var t,r,c,l,d,f,h=o(e),p="function"==typeof this?this:Array,m=arguments.length,g=m>1?arguments[1]:void 0,y=void 0!==g,v=u(h),w=0;if(y&&(g=n(g,m>2?arguments[2]:void 0,2)),null==v||p==Array&&i(v))for(r=new p(t=a(h.length));t>w;w++)f=y?g(h[w],w):h[w],A(r,w,f);else for(d=(l=v.call(h)).next,r=new p;!(c=d.call(l)).done;w++)f=y?s(l,g,[c.value,w],!0):c.value,A(r,w,f);return r.length=w,r}},"./node_modules/core-js-pure/internals/array-includes.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/to-indexed-object.js"),o=r("./node_modules/core-js-pure/internals/to-length.js"),s=r("./node_modules/core-js-pure/internals/to-absolute-index.js"),i=function(e){return function(t,r,i){var a,A=n(t),u=o(A.length),c=s(i,u);if(e&&r!=r){for(;u>c;)if((a=A[c++])!=a)return!0}else for(;u>c;c++)if((e||c in A)&&A[c]===r)return e||c||0;return!e&&-1}};e.exports={includes:i(!0),indexOf:i(!1)}},"./node_modules/core-js-pure/internals/array-iteration.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/function-bind-context.js"),o=r("./node_modules/core-js-pure/internals/indexed-object.js"),s=r("./node_modules/core-js-pure/internals/to-object.js"),i=r("./node_modules/core-js-pure/internals/to-length.js"),a=r("./node_modules/core-js-pure/internals/array-species-create.js"),A=[].push,u=function(e){var t=1==e,r=2==e,u=3==e,c=4==e,l=6==e,d=7==e,f=5==e||l;return function(h,p,m,g){for(var y,v,w=s(h),b=o(w),B=n(p,m,3),j=i(b.length),_=0,C=g||a,x=t?C(h,j):r||d?C(h,0):void 0;j>_;_++)if((f||_ in b)&&(v=B(y=b[_],_,w),e))if(t)x[_]=v;else if(v)switch(e){case 3:return!0;case 5:return y;case 6:return _;case 2:A.call(x,y)}else switch(e){case 4:return!1;case 7:A.call(x,y)}return l?-1:u||c?c:x}};e.exports={forEach:u(0),map:u(1),filter:u(2),some:u(3),every:u(4),find:u(5),findIndex:u(6),filterOut:u(7)}},"./node_modules/core-js-pure/internals/array-method-has-species-support.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/fails.js"),o=r("./node_modules/core-js-pure/internals/well-known-symbol.js"),s=r("./node_modules/core-js-pure/internals/engine-v8-version.js"),i=o("species");e.exports=function(e){return s>=51||!n((function(){var t=[];return(t.constructor={})[i]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},"./node_modules/core-js-pure/internals/array-method-is-strict.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/fails.js");e.exports=function(e,t){var r=[][e];return!!r&&n((function(){r.call(null,t||function(){throw 1},1)}))}},"./node_modules/core-js-pure/internals/array-reduce.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/a-function.js"),o=r("./node_modules/core-js-pure/internals/to-object.js"),s=r("./node_modules/core-js-pure/internals/indexed-object.js"),i=r("./node_modules/core-js-pure/internals/to-length.js"),a=function(e){return function(t,r,a,A){n(r);var u=o(t),c=s(u),l=i(u.length),d=e?l-1:0,f=e?-1:1;if(a<2)for(;;){if(d in c){A=c[d],d+=f;break}if(d+=f,e?d<0:l<=d)throw TypeError("Reduce of empty array with no initial value")}for(;e?d>=0:l>d;d+=f)d in c&&(A=r(A,c[d],d,u));return A}};e.exports={left:a(!1),right:a(!0)}},"./node_modules/core-js-pure/internals/array-species-create.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/is-object.js"),o=r("./node_modules/core-js-pure/internals/is-array.js"),s=r("./node_modules/core-js-pure/internals/well-known-symbol.js")("species");e.exports=function(e,t){var r;return o(e)&&("function"!=typeof(r=e.constructor)||r!==Array&&!o(r.prototype)?n(r)&&null===(r=r[s])&&(r=void 0):r=void 0),new(void 0===r?Array:r)(0===t?0:t)}},"./node_modules/core-js-pure/internals/call-with-safe-iteration-closing.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/an-object.js"),o=r("./node_modules/core-js-pure/internals/iterator-close.js");e.exports=function(e,t,r,s){try{return s?t(n(r)[0],r[1]):t(r)}catch(t){throw o(e),t}}},"./node_modules/core-js-pure/internals/check-correctness-of-iteration.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/well-known-symbol.js")("iterator"),o=!1;try{var s=0,i={next:function(){return{done:!!s++}},return:function(){o=!0}};i[n]=function(){return this},Array.from(i,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!o)return!1;var r=!1;try{var s={};s[n]=function(){return{next:function(){return{done:r=!0}}}},e(s)}catch(e){}return r}},"./node_modules/core-js-pure/internals/classof-raw.js":function(e){var t={}.toString;e.exports=function(e){return t.call(e).slice(8,-1)}},"./node_modules/core-js-pure/internals/classof.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/to-string-tag-support.js"),o=r("./node_modules/core-js-pure/internals/classof-raw.js"),s=r("./node_modules/core-js-pure/internals/well-known-symbol.js")("toStringTag"),i="Arguments"==o(function(){return arguments}());e.exports=n?o:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),s))?r:i?o(t):"Object"==(n=o(t))&&"function"==typeof t.callee?"Arguments":n}},"./node_modules/core-js-pure/internals/collection-strong.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/object-define-property.js").f,o=r("./node_modules/core-js-pure/internals/object-create.js"),s=r("./node_modules/core-js-pure/internals/redefine-all.js"),i=r("./node_modules/core-js-pure/internals/function-bind-context.js"),a=r("./node_modules/core-js-pure/internals/an-instance.js"),A=r("./node_modules/core-js-pure/internals/iterate.js"),u=r("./node_modules/core-js-pure/internals/define-iterator.js"),c=r("./node_modules/core-js-pure/internals/set-species.js"),l=r("./node_modules/core-js-pure/internals/descriptors.js"),d=r("./node_modules/core-js-pure/internals/internal-metadata.js").fastKey,f=r("./node_modules/core-js-pure/internals/internal-state.js"),h=f.set,p=f.getterFor;e.exports={getConstructor:function(e,t,r,u){var c=e((function(e,n){a(e,c,t),h(e,{type:t,index:o(null),first:void 0,last:void 0,size:0}),l||(e.size=0),null!=n&&A(n,e[u],{that:e,AS_ENTRIES:r})})),f=p(t),m=function(e,t,r){var n,o,s=f(e),i=g(e,t);return i?i.value=r:(s.last=i={index:o=d(t,!0),key:t,value:r,previous:n=s.last,next:void 0,removed:!1},s.first||(s.first=i),n&&(n.next=i),l?s.size++:e.size++,"F"!==o&&(s.index[o]=i)),e},g=function(e,t){var r,n=f(e),o=d(t);if("F"!==o)return n.index[o];for(r=n.first;r;r=r.next)if(r.key==t)return r};return s(c.prototype,{clear:function(){for(var e=f(this),t=e.index,r=e.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete t[r.index],r=r.next;e.first=e.last=void 0,l?e.size=0:this.size=0},delete:function(e){var t=this,r=f(t),n=g(t,e);if(n){var o=n.next,s=n.previous;delete r.index[n.index],n.removed=!0,s&&(s.next=o),o&&(o.previous=s),r.first==n&&(r.first=o),r.last==n&&(r.last=s),l?r.size--:t.size--}return!!n},forEach:function(e){for(var t,r=f(this),n=i(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:r.first;)for(n(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!g(this,e)}}),s(c.prototype,r?{get:function(e){var t=g(this,e);return t&&t.value},set:function(e,t){return m(this,0===e?0:e,t)}}:{add:function(e){return m(this,e=0===e?0:e,e)}}),l&&n(c.prototype,"size",{get:function(){return f(this).size}}),c},setStrong:function(e,t,r){var n=t+" Iterator",o=p(t),s=p(n);u(e,t,(function(e,t){h(this,{type:n,target:e,state:o(e),kind:t,last:void 0})}),(function(){for(var e=s(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?"keys"==t?{value:r.key,done:!1}:"values"==t?{value:r.value,done:!1}:{value:[r.key,r.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),r?"entries":"values",!r,!0),c(t)}}},"./node_modules/core-js-pure/internals/collection.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/global.js"),s=r("./node_modules/core-js-pure/internals/internal-metadata.js"),i=r("./node_modules/core-js-pure/internals/fails.js"),a=r("./node_modules/core-js-pure/internals/create-non-enumerable-property.js"),A=r("./node_modules/core-js-pure/internals/iterate.js"),u=r("./node_modules/core-js-pure/internals/an-instance.js"),c=r("./node_modules/core-js-pure/internals/is-object.js"),l=r("./node_modules/core-js-pure/internals/set-to-string-tag.js"),d=r("./node_modules/core-js-pure/internals/object-define-property.js").f,f=r("./node_modules/core-js-pure/internals/array-iteration.js").forEach,h=r("./node_modules/core-js-pure/internals/descriptors.js"),p=r("./node_modules/core-js-pure/internals/internal-state.js"),m=p.set,g=p.getterFor;e.exports=function(e,t,r){var p,y=-1!==e.indexOf("Map"),v=-1!==e.indexOf("Weak"),w=y?"set":"add",b=o[e],B=b&&b.prototype,j={};if(h&&"function"==typeof b&&(v||B.forEach&&!i((function(){(new b).entries().next()})))){p=t((function(t,r){m(u(t,p,e),{type:e,collection:new b}),null!=r&&A(r,t[w],{that:t,AS_ENTRIES:y})}));var _=g(e);f(["add","clear","delete","forEach","get","has","set","keys","values","entries"],(function(e){var t="add"==e||"set"==e;!(e in B)||v&&"clear"==e||a(p.prototype,e,(function(r,n){var o=_(this).collection;if(!t&&v&&!c(r))return"get"==e&&void 0;var s=o[e](0===r?0:r,n);return t?this:s}))})),v||d(p.prototype,"size",{configurable:!0,get:function(){return _(this).collection.size}})}else p=r.getConstructor(t,e,y,w),s.REQUIRED=!0;return l(p,e,!1,!0),j[e]=p,n({global:!0,forced:!0},j),v||r.setStrong(p,e,y),p}},"./node_modules/core-js-pure/internals/correct-is-regexp-logic.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/well-known-symbol.js")("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[n]=!1,"/./"[e](t)}catch(e){}}return!1}},"./node_modules/core-js-pure/internals/correct-prototype-getter.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/fails.js");e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},"./node_modules/core-js-pure/internals/create-iterator-constructor.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/iterators-core.js").IteratorPrototype,o=r("./node_modules/core-js-pure/internals/object-create.js"),s=r("./node_modules/core-js-pure/internals/create-property-descriptor.js"),i=r("./node_modules/core-js-pure/internals/set-to-string-tag.js"),a=r("./node_modules/core-js-pure/internals/iterators.js"),A=function(){return this};e.exports=function(e,t,r){var u=t+" Iterator";return e.prototype=o(n,{next:s(1,r)}),i(e,u,!1,!0),a[u]=A,e}},"./node_modules/core-js-pure/internals/create-non-enumerable-property.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/descriptors.js"),o=r("./node_modules/core-js-pure/internals/object-define-property.js"),s=r("./node_modules/core-js-pure/internals/create-property-descriptor.js");e.exports=n?function(e,t,r){return o.f(e,t,s(1,r))}:function(e,t,r){return e[t]=r,e}},"./node_modules/core-js-pure/internals/create-property-descriptor.js":function(e){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},"./node_modules/core-js-pure/internals/create-property.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/to-primitive.js"),o=r("./node_modules/core-js-pure/internals/object-define-property.js"),s=r("./node_modules/core-js-pure/internals/create-property-descriptor.js");e.exports=function(e,t,r){var i=n(t);i in e?o.f(e,i,s(0,r)):e[i]=r}},"./node_modules/core-js-pure/internals/define-iterator.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/create-iterator-constructor.js"),s=r("./node_modules/core-js-pure/internals/object-get-prototype-of.js"),i=r("./node_modules/core-js-pure/internals/object-set-prototype-of.js"),a=r("./node_modules/core-js-pure/internals/set-to-string-tag.js"),A=r("./node_modules/core-js-pure/internals/create-non-enumerable-property.js"),u=r("./node_modules/core-js-pure/internals/redefine.js"),c=r("./node_modules/core-js-pure/internals/well-known-symbol.js"),l=r("./node_modules/core-js-pure/internals/is-pure.js"),d=r("./node_modules/core-js-pure/internals/iterators.js"),f=r("./node_modules/core-js-pure/internals/iterators-core.js"),h=f.IteratorPrototype,p=f.BUGGY_SAFARI_ITERATORS,m=c("iterator"),g="keys",y="values",v="entries",w=function(){return this};e.exports=function(e,t,r,c,f,b,B){o(r,t,c);var j,_,C,x=function(e){if(e===f&&U)return U;if(!p&&e in Q)return Q[e];switch(e){case g:case y:case v:return function(){return new r(this,e)}}return function(){return new r(this)}},E=t+" Iterator",N=!1,Q=e.prototype,F=Q[m]||Q["@@iterator"]||f&&Q[f],U=!p&&F||x(f),S="Array"==t&&Q.entries||F;if(S&&(j=s(S.call(new e)),h!==Object.prototype&&j.next&&(l||s(j)===h||(i?i(j,h):"function"!=typeof j[m]&&A(j,m,w)),a(j,E,!0,!0),l&&(d[E]=w))),f==y&&F&&F.name!==y&&(N=!0,U=function(){return F.call(this)}),l&&!B||Q[m]===U||A(Q,m,U),d[t]=U,f)if(_={values:x(y),keys:b?U:x(g),entries:x(v)},B)for(C in _)(p||N||!(C in Q))&&u(Q,C,_[C]);else n({target:t,proto:!0,forced:p||N},_);return _}},"./node_modules/core-js-pure/internals/define-well-known-symbol.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/path.js"),o=r("./node_modules/core-js-pure/internals/has.js"),s=r("./node_modules/core-js-pure/internals/well-known-symbol-wrapped.js"),i=r("./node_modules/core-js-pure/internals/object-define-property.js").f;e.exports=function(e){var t=n.Symbol||(n.Symbol={});o(t,e)||i(t,e,{value:s.f(e)})}},"./node_modules/core-js-pure/internals/descriptors.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/fails.js");e.exports=!n((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},"./node_modules/core-js-pure/internals/document-create-element.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/global.js"),o=r("./node_modules/core-js-pure/internals/is-object.js"),s=n.document,i=o(s)&&o(s.createElement);e.exports=function(e){return i?s.createElement(e):{}}},"./node_modules/core-js-pure/internals/dom-iterables.js":function(e){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},"./node_modules/core-js-pure/internals/engine-is-browser.js":function(e){e.exports="object"==typeof window},"./node_modules/core-js-pure/internals/engine-is-ios.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/engine-user-agent.js");e.exports=/(?:iphone|ipod|ipad).*applewebkit/i.test(n)},"./node_modules/core-js-pure/internals/engine-is-node.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/classof-raw.js"),o=r("./node_modules/core-js-pure/internals/global.js");e.exports="process"==n(o.process)},"./node_modules/core-js-pure/internals/engine-is-webos-webkit.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/engine-user-agent.js");e.exports=/web0s(?!.*chrome)/i.test(n)},"./node_modules/core-js-pure/internals/engine-user-agent.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/get-built-in.js");e.exports=n("navigator","userAgent")||""},"./node_modules/core-js-pure/internals/engine-v8-version.js":function(e,t,r){var n,o,s=r("./node_modules/core-js-pure/internals/global.js"),i=r("./node_modules/core-js-pure/internals/engine-user-agent.js"),a=s.process,A=a&&a.versions,u=A&&A.v8;u?o=(n=u.split("."))[0]<4?1:n[0]+n[1]:i&&(!(n=i.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=i.match(/Chrome\/(\d+)/))&&(o=n[1]),e.exports=o&&+o},"./node_modules/core-js-pure/internals/entry-virtual.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/path.js");e.exports=function(e){return n[e+"Prototype"]}},"./node_modules/core-js-pure/internals/enum-bug-keys.js":function(e){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},"./node_modules/core-js-pure/internals/export.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/global.js"),o=r("./node_modules/core-js-pure/internals/object-get-own-property-descriptor.js").f,s=r("./node_modules/core-js-pure/internals/is-forced.js"),i=r("./node_modules/core-js-pure/internals/path.js"),a=r("./node_modules/core-js-pure/internals/function-bind-context.js"),A=r("./node_modules/core-js-pure/internals/create-non-enumerable-property.js"),u=r("./node_modules/core-js-pure/internals/has.js"),c=function(e){var t=function(t,r,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,r)}return new e(t,r,n)}return e.apply(this,arguments)};return t.prototype=e.prototype,t};e.exports=function(e,t){var r,l,d,f,h,p,m,g,y=e.target,v=e.global,w=e.stat,b=e.proto,B=v?n:w?n[y]:(n[y]||{}).prototype,j=v?i:i[y]||(i[y]={}),_=j.prototype;for(d in t)r=!s(v?d:y+(w?".":"#")+d,e.forced)&&B&&u(B,d),h=j[d],r&&(p=e.noTargetGet?(g=o(B,d))&&g.value:B[d]),f=r&&p?p:t[d],r&&typeof h==typeof f||(m=e.bind&&r?a(f,n):e.wrap&&r?c(f):b&&"function"==typeof f?a(Function.call,f):f,(e.sham||f&&f.sham||h&&h.sham)&&A(m,"sham",!0),j[d]=m,b&&(u(i,l=y+"Prototype")||A(i,l,{}),i[l][d]=f,e.real&&_&&!_[d]&&A(_,d,f)))}},"./node_modules/core-js-pure/internals/fails.js":function(e){e.exports=function(e){try{return!!e()}catch(e){return!0}}},"./node_modules/core-js-pure/internals/freezing.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/fails.js");e.exports=!n((function(){return Object.isExtensible(Object.preventExtensions({}))}))},"./node_modules/core-js-pure/internals/function-bind-context.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/a-function.js");e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 0:return function(){return e.call(t)};case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,o){return e.call(t,r,n,o)}}return function(){return e.apply(t,arguments)}}},"./node_modules/core-js-pure/internals/function-bind.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/a-function.js"),o=r("./node_modules/core-js-pure/internals/is-object.js"),s=[].slice,i={},a=function(e,t,r){if(!(t in i)){for(var n=[],o=0;o<t;o++)n[o]="a["+o+"]";i[t]=Function("C,a","return new C("+n.join(",")+")")}return i[t](e,r)};e.exports=Function.bind||function(e){var t=n(this),r=s.call(arguments,1),i=function(){var n=r.concat(s.call(arguments));return this instanceof i?a(t,n.length,n):t.apply(e,n)};return o(t.prototype)&&(i.prototype=t.prototype),i}},"./node_modules/core-js-pure/internals/get-built-in.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/path.js"),o=r("./node_modules/core-js-pure/internals/global.js"),s=function(e){return"function"==typeof e?e:void 0};e.exports=function(e,t){return arguments.length<2?s(n[e])||s(o[e]):n[e]&&n[e][t]||o[e]&&o[e][t]}},"./node_modules/core-js-pure/internals/get-iterator-method.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/classof.js"),o=r("./node_modules/core-js-pure/internals/iterators.js"),s=r("./node_modules/core-js-pure/internals/well-known-symbol.js")("iterator");e.exports=function(e){if(null!=e)return e[s]||e["@@iterator"]||o[n(e)]}},"./node_modules/core-js-pure/internals/get-iterator.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/an-object.js"),o=r("./node_modules/core-js-pure/internals/get-iterator-method.js");e.exports=function(e){var t=o(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return n(t.call(e))}},"./node_modules/core-js-pure/internals/global.js":function(e){var t=function(e){return e&&e.Math==Math&&e};e.exports=t("object"==typeof globalThis&&globalThis)||t("object"==typeof window&&window)||t("object"==typeof self&&self)||t("object"==typeof global&&global)||function(){return this}()||Function("return this")()},"./node_modules/core-js-pure/internals/has.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/to-object.js"),o={}.hasOwnProperty;e.exports=Object.hasOwn||function(e,t){return o.call(n(e),t)}},"./node_modules/core-js-pure/internals/hidden-keys.js":function(e){e.exports={}},"./node_modules/core-js-pure/internals/host-report-errors.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/global.js");e.exports=function(e,t){var r=n.console;r&&r.error&&(1===arguments.length?r.error(e):r.error(e,t))}},"./node_modules/core-js-pure/internals/html.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/get-built-in.js");e.exports=n("document","documentElement")},"./node_modules/core-js-pure/internals/ie8-dom-define.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/descriptors.js"),o=r("./node_modules/core-js-pure/internals/fails.js"),s=r("./node_modules/core-js-pure/internals/document-create-element.js");e.exports=!n&&!o((function(){return 7!=Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a}))},"./node_modules/core-js-pure/internals/indexed-object.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/fails.js"),o=r("./node_modules/core-js-pure/internals/classof-raw.js"),s="".split;e.exports=n((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==o(e)?s.call(e,""):Object(e)}:Object},"./node_modules/core-js-pure/internals/inspect-source.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/shared-store.js"),o=Function.toString;"function"!=typeof n.inspectSource&&(n.inspectSource=function(e){return o.call(e)}),e.exports=n.inspectSource},"./node_modules/core-js-pure/internals/internal-metadata.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/hidden-keys.js"),o=r("./node_modules/core-js-pure/internals/is-object.js"),s=r("./node_modules/core-js-pure/internals/has.js"),i=r("./node_modules/core-js-pure/internals/object-define-property.js").f,a=r("./node_modules/core-js-pure/internals/uid.js"),A=r("./node_modules/core-js-pure/internals/freezing.js"),u=a("meta"),c=0,l=Object.isExtensible||function(){return!0},d=function(e){i(e,u,{value:{objectID:"O"+c++,weakData:{}}})},f=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!o(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!s(e,u)){if(!l(e))return"F";if(!t)return"E";d(e)}return e[u].objectID},getWeakData:function(e,t){if(!s(e,u)){if(!l(e))return!0;if(!t)return!1;d(e)}return e[u].weakData},onFreeze:function(e){return A&&f.REQUIRED&&l(e)&&!s(e,u)&&d(e),e}};n[u]=!0},"./node_modules/core-js-pure/internals/internal-state.js":function(e,t,r){var n,o,s,i=r("./node_modules/core-js-pure/internals/native-weak-map.js"),a=r("./node_modules/core-js-pure/internals/global.js"),A=r("./node_modules/core-js-pure/internals/is-object.js"),u=r("./node_modules/core-js-pure/internals/create-non-enumerable-property.js"),c=r("./node_modules/core-js-pure/internals/has.js"),l=r("./node_modules/core-js-pure/internals/shared-store.js"),d=r("./node_modules/core-js-pure/internals/shared-key.js"),f=r("./node_modules/core-js-pure/internals/hidden-keys.js"),h="Object already initialized",p=a.WeakMap;if(i||l.state){var m=l.state||(l.state=new p),g=m.get,y=m.has,v=m.set;n=function(e,t){if(y.call(m,e))throw new TypeError(h);return t.facade=e,v.call(m,e,t),t},o=function(e){return g.call(m,e)||{}},s=function(e){return y.call(m,e)}}else{var w=d("state");f[w]=!0,n=function(e,t){if(c(e,w))throw new TypeError(h);return t.facade=e,u(e,w,t),t},o=function(e){return c(e,w)?e[w]:{}},s=function(e){return c(e,w)}}e.exports={set:n,get:o,has:s,enforce:function(e){return s(e)?o(e):n(e,{})},getterFor:function(e){return function(t){var r;if(!A(t)||(r=o(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return r}}}},"./node_modules/core-js-pure/internals/is-array-iterator-method.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/well-known-symbol.js"),o=r("./node_modules/core-js-pure/internals/iterators.js"),s=n("iterator"),i=Array.prototype;e.exports=function(e){return void 0!==e&&(o.Array===e||i[s]===e)}},"./node_modules/core-js-pure/internals/is-array.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/classof-raw.js");e.exports=Array.isArray||function(e){return"Array"==n(e)}},"./node_modules/core-js-pure/internals/is-forced.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/fails.js"),o=/#|\.prototype\./,s=function(e,t){var r=a[i(e)];return r==u||r!=A&&("function"==typeof t?n(t):!!t)},i=s.normalize=function(e){return String(e).replace(o,".").toLowerCase()},a=s.data={},A=s.NATIVE="N",u=s.POLYFILL="P";e.exports=s},"./node_modules/core-js-pure/internals/is-object.js":function(e){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},"./node_modules/core-js-pure/internals/is-pure.js":function(e){e.exports=!0},"./node_modules/core-js-pure/internals/is-regexp.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/is-object.js"),o=r("./node_modules/core-js-pure/internals/classof-raw.js"),s=r("./node_modules/core-js-pure/internals/well-known-symbol.js")("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[s])?!!t:"RegExp"==o(e))}},"./node_modules/core-js-pure/internals/iterate.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/an-object.js"),o=r("./node_modules/core-js-pure/internals/is-array-iterator-method.js"),s=r("./node_modules/core-js-pure/internals/to-length.js"),i=r("./node_modules/core-js-pure/internals/function-bind-context.js"),a=r("./node_modules/core-js-pure/internals/get-iterator-method.js"),A=r("./node_modules/core-js-pure/internals/iterator-close.js"),u=function(e,t){this.stopped=e,this.result=t};e.exports=function(e,t,r){var c,l,d,f,h,p,m,g=r&&r.that,y=!(!r||!r.AS_ENTRIES),v=!(!r||!r.IS_ITERATOR),w=!(!r||!r.INTERRUPTED),b=i(t,g,1+y+w),B=function(e){return c&&A(c),new u(!0,e)},j=function(e){return y?(n(e),w?b(e[0],e[1],B):b(e[0],e[1])):w?b(e,B):b(e)};if(v)c=e;else{if("function"!=typeof(l=a(e)))throw TypeError("Target is not iterable");if(o(l)){for(d=0,f=s(e.length);f>d;d++)if((h=j(e[d]))&&h instanceof u)return h;return new u(!1)}c=l.call(e)}for(p=c.next;!(m=p.call(c)).done;){try{h=j(m.value)}catch(e){throw A(c),e}if("object"==typeof h&&h&&h instanceof u)return h}return new u(!1)}},"./node_modules/core-js-pure/internals/iterator-close.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/an-object.js");e.exports=function(e){var t=e.return;if(void 0!==t)return n(t.call(e)).value}},"./node_modules/core-js-pure/internals/iterators-core.js":function(e,t,r){"use strict";var n,o,s,i=r("./node_modules/core-js-pure/internals/fails.js"),a=r("./node_modules/core-js-pure/internals/object-get-prototype-of.js"),A=r("./node_modules/core-js-pure/internals/create-non-enumerable-property.js"),u=r("./node_modules/core-js-pure/internals/has.js"),c=r("./node_modules/core-js-pure/internals/well-known-symbol.js"),l=r("./node_modules/core-js-pure/internals/is-pure.js"),d=c("iterator"),f=!1;[].keys&&("next"in(s=[].keys())?(o=a(a(s)))!==Object.prototype&&(n=o):f=!0);var h=null==n||i((function(){var e={};return n[d].call(e)!==e}));h&&(n={}),l&&!h||u(n,d)||A(n,d,(function(){return this})),e.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:f}},"./node_modules/core-js-pure/internals/iterators.js":function(e){e.exports={}},"./node_modules/core-js-pure/internals/microtask.js":function(e,t,r){var n,o,s,i,a,A,u,c,l=r("./node_modules/core-js-pure/internals/global.js"),d=r("./node_modules/core-js-pure/internals/object-get-own-property-descriptor.js").f,f=r("./node_modules/core-js-pure/internals/task.js").set,h=r("./node_modules/core-js-pure/internals/engine-is-ios.js"),p=r("./node_modules/core-js-pure/internals/engine-is-webos-webkit.js"),m=r("./node_modules/core-js-pure/internals/engine-is-node.js"),g=l.MutationObserver||l.WebKitMutationObserver,y=l.document,v=l.process,w=l.Promise,b=d(l,"queueMicrotask"),B=b&&b.value;B||(n=function(){var e,t;for(m&&(e=v.domain)&&e.exit();o;){t=o.fn,o=o.next;try{t()}catch(e){throw o?i():s=void 0,e}}s=void 0,e&&e.enter()},h||m||p||!g||!y?w&&w.resolve?((u=w.resolve(void 0)).constructor=w,c=u.then,i=function(){c.call(u,n)}):i=m?function(){v.nextTick(n)}:function(){f.call(l,n)}:(a=!0,A=y.createTextNode(""),new g(n).observe(A,{characterData:!0}),i=function(){A.data=a=!a})),e.exports=B||function(e){var t={fn:e,next:void 0};s&&(s.next=t),o||(o=t,i()),s=t}},"./node_modules/core-js-pure/internals/native-promise-constructor.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/global.js");e.exports=n.Promise},"./node_modules/core-js-pure/internals/native-symbol.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/engine-v8-version.js"),o=r("./node_modules/core-js-pure/internals/fails.js");e.exports=!!Object.getOwnPropertySymbols&&!o((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},"./node_modules/core-js-pure/internals/native-weak-map.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/global.js"),o=r("./node_modules/core-js-pure/internals/inspect-source.js"),s=n.WeakMap;e.exports="function"==typeof s&&/native code/.test(o(s))},"./node_modules/core-js-pure/internals/new-promise-capability.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/a-function.js"),o=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=n(t),this.reject=n(r)};e.exports.f=function(e){return new o(e)}},"./node_modules/core-js-pure/internals/not-a-regexp.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/is-regexp.js");e.exports=function(e){if(n(e))throw TypeError("The method doesn't accept regular expressions");return e}},"./node_modules/core-js-pure/internals/number-parse-float.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/global.js"),o=r("./node_modules/core-js-pure/internals/string-trim.js").trim,s=r("./node_modules/core-js-pure/internals/whitespaces.js"),i=n.parseFloat,a=1/i(s+"-0")!=-1/0;e.exports=a?function(e){var t=o(String(e)),r=i(t);return 0===r&&"-"==t.charAt(0)?-0:r}:i},"./node_modules/core-js-pure/internals/number-parse-int.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/global.js"),o=r("./node_modules/core-js-pure/internals/string-trim.js").trim,s=r("./node_modules/core-js-pure/internals/whitespaces.js"),i=n.parseInt,a=/^[+-]?0[Xx]/,A=8!==i(s+"08")||22!==i(s+"0x16");e.exports=A?function(e,t){var r=o(String(e));return i(r,t>>>0||(a.test(r)?16:10))}:i},"./node_modules/core-js-pure/internals/object-create.js":function(e,t,r){var n,o=r("./node_modules/core-js-pure/internals/an-object.js"),s=r("./node_modules/core-js-pure/internals/object-define-properties.js"),i=r("./node_modules/core-js-pure/internals/enum-bug-keys.js"),a=r("./node_modules/core-js-pure/internals/hidden-keys.js"),A=r("./node_modules/core-js-pure/internals/html.js"),u=r("./node_modules/core-js-pure/internals/document-create-element.js"),c=r("./node_modules/core-js-pure/internals/shared-key.js")("IE_PROTO"),l=function(){},d=function(e){return"<script>"+e+"<\/script>"},f=function(){try{n=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;f=n?function(e){e.write(d("")),e.close();var t=e.parentWindow.Object;return e=null,t}(n):((t=u("iframe")).style.display="none",A.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(d("document.F=Object")),e.close(),e.F);for(var r=i.length;r--;)delete f.prototype[i[r]];return f()};a[c]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(l.prototype=o(e),r=new l,l.prototype=null,r[c]=e):r=f(),void 0===t?r:s(r,t)}},"./node_modules/core-js-pure/internals/object-define-properties.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/descriptors.js"),o=r("./node_modules/core-js-pure/internals/object-define-property.js"),s=r("./node_modules/core-js-pure/internals/an-object.js"),i=r("./node_modules/core-js-pure/internals/object-keys.js");e.exports=n?Object.defineProperties:function(e,t){s(e);for(var r,n=i(t),a=n.length,A=0;a>A;)o.f(e,r=n[A++],t[r]);return e}},"./node_modules/core-js-pure/internals/object-define-property.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/descriptors.js"),o=r("./node_modules/core-js-pure/internals/ie8-dom-define.js"),s=r("./node_modules/core-js-pure/internals/an-object.js"),i=r("./node_modules/core-js-pure/internals/to-primitive.js"),a=Object.defineProperty;t.f=n?a:function(e,t,r){if(s(e),t=i(t,!0),s(r),o)try{return a(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},"./node_modules/core-js-pure/internals/object-get-own-property-descriptor.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/descriptors.js"),o=r("./node_modules/core-js-pure/internals/object-property-is-enumerable.js"),s=r("./node_modules/core-js-pure/internals/create-property-descriptor.js"),i=r("./node_modules/core-js-pure/internals/to-indexed-object.js"),a=r("./node_modules/core-js-pure/internals/to-primitive.js"),A=r("./node_modules/core-js-pure/internals/has.js"),u=r("./node_modules/core-js-pure/internals/ie8-dom-define.js"),c=Object.getOwnPropertyDescriptor;t.f=n?c:function(e,t){if(e=i(e),t=a(t,!0),u)try{return c(e,t)}catch(e){}if(A(e,t))return s(!o.f.call(e,t),e[t])}},"./node_modules/core-js-pure/internals/object-get-own-property-names-external.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/to-indexed-object.js"),o=r("./node_modules/core-js-pure/internals/object-get-own-property-names.js").f,s={}.toString,i="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return i&&"[object Window]"==s.call(e)?function(e){try{return o(e)}catch(e){return i.slice()}}(e):o(n(e))}},"./node_modules/core-js-pure/internals/object-get-own-property-names.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/object-keys-internal.js"),o=r("./node_modules/core-js-pure/internals/enum-bug-keys.js").concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,o)}},"./node_modules/core-js-pure/internals/object-get-own-property-symbols.js":function(e,t){t.f=Object.getOwnPropertySymbols},"./node_modules/core-js-pure/internals/object-get-prototype-of.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/has.js"),o=r("./node_modules/core-js-pure/internals/to-object.js"),s=r("./node_modules/core-js-pure/internals/shared-key.js"),i=r("./node_modules/core-js-pure/internals/correct-prototype-getter.js"),a=s("IE_PROTO"),A=Object.prototype;e.exports=i?Object.getPrototypeOf:function(e){return e=o(e),n(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?A:null}},"./node_modules/core-js-pure/internals/object-keys-internal.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/has.js"),o=r("./node_modules/core-js-pure/internals/to-indexed-object.js"),s=r("./node_modules/core-js-pure/internals/array-includes.js").indexOf,i=r("./node_modules/core-js-pure/internals/hidden-keys.js");e.exports=function(e,t){var r,a=o(e),A=0,u=[];for(r in a)!n(i,r)&&n(a,r)&&u.push(r);for(;t.length>A;)n(a,r=t[A++])&&(~s(u,r)||u.push(r));return u}},"./node_modules/core-js-pure/internals/object-keys.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/object-keys-internal.js"),o=r("./node_modules/core-js-pure/internals/enum-bug-keys.js");e.exports=Object.keys||function(e){return n(e,o)}},"./node_modules/core-js-pure/internals/object-property-is-enumerable.js":function(e,t){"use strict";var r={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,o=n&&!r.call({1:2},1);t.f=o?function(e){var t=n(this,e);return!!t&&t.enumerable}:r},"./node_modules/core-js-pure/internals/object-set-prototype-of.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/an-object.js"),o=r("./node_modules/core-js-pure/internals/a-possible-prototype.js");e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(r,[]),t=r instanceof Array}catch(e){}return function(r,s){return n(r),o(s),t?e.call(r,s):r.__proto__=s,r}}():void 0)},"./node_modules/core-js-pure/internals/object-to-string.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/to-string-tag-support.js"),o=r("./node_modules/core-js-pure/internals/classof.js");e.exports=n?{}.toString:function(){return"[object "+o(this)+"]"}},"./node_modules/core-js-pure/internals/own-keys.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/get-built-in.js"),o=r("./node_modules/core-js-pure/internals/object-get-own-property-names.js"),s=r("./node_modules/core-js-pure/internals/object-get-own-property-symbols.js"),i=r("./node_modules/core-js-pure/internals/an-object.js");e.exports=n("Reflect","ownKeys")||function(e){var t=o.f(i(e)),r=s.f;return r?t.concat(r(e)):t}},"./node_modules/core-js-pure/internals/path.js":function(e){e.exports={}},"./node_modules/core-js-pure/internals/perform.js":function(e){e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},"./node_modules/core-js-pure/internals/promise-resolve.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/an-object.js"),o=r("./node_modules/core-js-pure/internals/is-object.js"),s=r("./node_modules/core-js-pure/internals/new-promise-capability.js");e.exports=function(e,t){if(n(e),o(t)&&t.constructor===e)return t;var r=s.f(e);return(0,r.resolve)(t),r.promise}},"./node_modules/core-js-pure/internals/redefine-all.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/redefine.js");e.exports=function(e,t,r){for(var o in t)r&&r.unsafe&&e[o]?e[o]=t[o]:n(e,o,t[o],r);return e}},"./node_modules/core-js-pure/internals/redefine.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/create-non-enumerable-property.js");e.exports=function(e,t,r,o){o&&o.enumerable?e[t]=r:n(e,t,r)}},"./node_modules/core-js-pure/internals/require-object-coercible.js":function(e){e.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},"./node_modules/core-js-pure/internals/set-global.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/global.js"),o=r("./node_modules/core-js-pure/internals/create-non-enumerable-property.js");e.exports=function(e,t){try{o(n,e,t)}catch(r){n[e]=t}return t}},"./node_modules/core-js-pure/internals/set-species.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/get-built-in.js"),o=r("./node_modules/core-js-pure/internals/object-define-property.js"),s=r("./node_modules/core-js-pure/internals/well-known-symbol.js"),i=r("./node_modules/core-js-pure/internals/descriptors.js"),a=s("species");e.exports=function(e){var t=n(e),r=o.f;i&&t&&!t[a]&&r(t,a,{configurable:!0,get:function(){return this}})}},"./node_modules/core-js-pure/internals/set-to-string-tag.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/to-string-tag-support.js"),o=r("./node_modules/core-js-pure/internals/object-define-property.js").f,s=r("./node_modules/core-js-pure/internals/create-non-enumerable-property.js"),i=r("./node_modules/core-js-pure/internals/has.js"),a=r("./node_modules/core-js-pure/internals/object-to-string.js"),A=r("./node_modules/core-js-pure/internals/well-known-symbol.js")("toStringTag");e.exports=function(e,t,r,u){if(e){var c=r?e:e.prototype;i(c,A)||o(c,A,{configurable:!0,value:t}),u&&!n&&s(c,"toString",a)}}},"./node_modules/core-js-pure/internals/shared-key.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/shared.js"),o=r("./node_modules/core-js-pure/internals/uid.js"),s=n("keys");e.exports=function(e){return s[e]||(s[e]=o(e))}},"./node_modules/core-js-pure/internals/shared-store.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/global.js"),o=r("./node_modules/core-js-pure/internals/set-global.js"),s="__core-js_shared__",i=n[s]||o(s,{});e.exports=i},"./node_modules/core-js-pure/internals/shared.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/is-pure.js"),o=r("./node_modules/core-js-pure/internals/shared-store.js");(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.15.2",mode:n?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})},"./node_modules/core-js-pure/internals/species-constructor.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/an-object.js"),o=r("./node_modules/core-js-pure/internals/a-function.js"),s=r("./node_modules/core-js-pure/internals/well-known-symbol.js")("species");e.exports=function(e,t){var r,i=n(e).constructor;return void 0===i||null==(r=n(i)[s])?t:o(r)}},"./node_modules/core-js-pure/internals/string-multibyte.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/to-integer.js"),o=r("./node_modules/core-js-pure/internals/require-object-coercible.js"),s=function(e){return function(t,r){var s,i,a=String(o(t)),A=n(r),u=a.length;return A<0||A>=u?e?"":void 0:(s=a.charCodeAt(A))<55296||s>56319||A+1===u||(i=a.charCodeAt(A+1))<56320||i>57343?e?a.charAt(A):s:e?a.slice(A,A+2):i-56320+(s-55296<<10)+65536}};e.exports={codeAt:s(!1),charAt:s(!0)}},"./node_modules/core-js-pure/internals/string-trim-forced.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/fails.js"),o=r("./node_modules/core-js-pure/internals/whitespaces.js");e.exports=function(e){return n((function(){return!!o[e]()||"​᠎"!="​᠎"[e]()||o[e].name!==e}))}},"./node_modules/core-js-pure/internals/string-trim.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/require-object-coercible.js"),o="["+r("./node_modules/core-js-pure/internals/whitespaces.js")+"]",s=RegExp("^"+o+o+"*"),i=RegExp(o+o+"*$"),a=function(e){return function(t){var r=String(n(t));return 1&e&&(r=r.replace(s,"")),2&e&&(r=r.replace(i,"")),r}};e.exports={start:a(1),end:a(2),trim:a(3)}},"./node_modules/core-js-pure/internals/task.js":function(e,t,r){var n,o,s,i=r("./node_modules/core-js-pure/internals/global.js"),a=r("./node_modules/core-js-pure/internals/fails.js"),A=r("./node_modules/core-js-pure/internals/function-bind-context.js"),u=r("./node_modules/core-js-pure/internals/html.js"),c=r("./node_modules/core-js-pure/internals/document-create-element.js"),l=r("./node_modules/core-js-pure/internals/engine-is-ios.js"),d=r("./node_modules/core-js-pure/internals/engine-is-node.js"),f=i.location,h=i.setImmediate,p=i.clearImmediate,m=i.process,g=i.MessageChannel,y=i.Dispatch,v=0,w={},b=function(e){if(w.hasOwnProperty(e)){var t=w[e];delete w[e],t()}},B=function(e){return function(){b(e)}},j=function(e){b(e.data)},_=function(e){i.postMessage(e+"",f.protocol+"//"+f.host)};h&&p||(h=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return w[++v]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},n(v),v},p=function(e){delete w[e]},d?n=function(e){m.nextTick(B(e))}:y&&y.now?n=function(e){y.now(B(e))}:g&&!l?(s=(o=new g).port2,o.port1.onmessage=j,n=A(s.postMessage,s,1)):i.addEventListener&&"function"==typeof postMessage&&!i.importScripts&&f&&"file:"!==f.protocol&&!a(_)?(n=_,i.addEventListener("message",j,!1)):n="onreadystatechange"in c("script")?function(e){u.appendChild(c("script")).onreadystatechange=function(){u.removeChild(this),b(e)}}:function(e){setTimeout(B(e),0)}),e.exports={set:h,clear:p}},"./node_modules/core-js-pure/internals/to-absolute-index.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/to-integer.js"),o=Math.max,s=Math.min;e.exports=function(e,t){var r=n(e);return r<0?o(r+t,0):s(r,t)}},"./node_modules/core-js-pure/internals/to-indexed-object.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/indexed-object.js"),o=r("./node_modules/core-js-pure/internals/require-object-coercible.js");e.exports=function(e){return n(o(e))}},"./node_modules/core-js-pure/internals/to-integer.js":function(e){var t=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:t)(e)}},"./node_modules/core-js-pure/internals/to-length.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/to-integer.js"),o=Math.min;e.exports=function(e){return e>0?o(n(e),9007199254740991):0}},"./node_modules/core-js-pure/internals/to-object.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/require-object-coercible.js");e.exports=function(e){return Object(n(e))}},"./node_modules/core-js-pure/internals/to-primitive.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/is-object.js");e.exports=function(e,t){if(!n(e))return e;var r,o;if(t&&"function"==typeof(r=e.toString)&&!n(o=r.call(e)))return o;if("function"==typeof(r=e.valueOf)&&!n(o=r.call(e)))return o;if(!t&&"function"==typeof(r=e.toString)&&!n(o=r.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},"./node_modules/core-js-pure/internals/to-string-tag-support.js":function(e,t,r){var n={};n[r("./node_modules/core-js-pure/internals/well-known-symbol.js")("toStringTag")]="z",e.exports="[object z]"===String(n)},"./node_modules/core-js-pure/internals/uid.js":function(e){var t=0,r=Math.random();e.exports=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++t+r).toString(36)}},"./node_modules/core-js-pure/internals/use-symbol-as-uid.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/native-symbol.js");e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},"./node_modules/core-js-pure/internals/well-known-symbol-wrapped.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/well-known-symbol.js");t.f=n},"./node_modules/core-js-pure/internals/well-known-symbol.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/global.js"),o=r("./node_modules/core-js-pure/internals/shared.js"),s=r("./node_modules/core-js-pure/internals/has.js"),i=r("./node_modules/core-js-pure/internals/uid.js"),a=r("./node_modules/core-js-pure/internals/native-symbol.js"),A=r("./node_modules/core-js-pure/internals/use-symbol-as-uid.js"),u=o("wks"),c=n.Symbol,l=A?c:c&&c.withoutSetter||i;e.exports=function(e){return s(u,e)&&(a||"string"==typeof u[e])||(a&&s(c,e)?u[e]=c[e]:u[e]=l("Symbol."+e)),u[e]}},"./node_modules/core-js-pure/internals/whitespaces.js":function(e){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"./node_modules/core-js-pure/modules/es.aggregate-error.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/object-get-prototype-of.js"),s=r("./node_modules/core-js-pure/internals/object-set-prototype-of.js"),i=r("./node_modules/core-js-pure/internals/object-create.js"),a=r("./node_modules/core-js-pure/internals/create-non-enumerable-property.js"),A=r("./node_modules/core-js-pure/internals/create-property-descriptor.js"),u=r("./node_modules/core-js-pure/internals/iterate.js"),c=function(e,t){var r=this;if(!(r instanceof c))return new c(e,t);s&&(r=s(new Error(void 0),o(r))),void 0!==t&&a(r,"message",String(t));var n=[];return u(e,n.push,{that:n}),a(r,"errors",n),r};c.prototype=i(Error.prototype,{constructor:A(5,c),message:A(5,""),name:A(5,"AggregateError")}),n({global:!0},{AggregateError:c})},"./node_modules/core-js-pure/modules/es.array.concat.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/fails.js"),s=r("./node_modules/core-js-pure/internals/is-array.js"),i=r("./node_modules/core-js-pure/internals/is-object.js"),a=r("./node_modules/core-js-pure/internals/to-object.js"),A=r("./node_modules/core-js-pure/internals/to-length.js"),u=r("./node_modules/core-js-pure/internals/create-property.js"),c=r("./node_modules/core-js-pure/internals/array-species-create.js"),l=r("./node_modules/core-js-pure/internals/array-method-has-species-support.js"),d=r("./node_modules/core-js-pure/internals/well-known-symbol.js"),f=r("./node_modules/core-js-pure/internals/engine-v8-version.js"),h=d("isConcatSpreadable"),p=9007199254740991,m="Maximum allowed index exceeded",g=f>=51||!o((function(){var e=[];return e[h]=!1,e.concat()[0]!==e})),y=l("concat"),v=function(e){if(!i(e))return!1;var t=e[h];return void 0!==t?!!t:s(e)};n({target:"Array",proto:!0,forced:!g||!y},{concat:function(e){var t,r,n,o,s,i=a(this),l=c(i,0),d=0;for(t=-1,n=arguments.length;t<n;t++)if(v(s=-1===t?i:arguments[t])){if(d+(o=A(s.length))>p)throw TypeError(m);for(r=0;r<o;r++,d++)r in s&&u(l,d,s[r])}else{if(d>=p)throw TypeError(m);u(l,d++,s)}return l.length=d,l}})},"./node_modules/core-js-pure/modules/es.array.every.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/array-iteration.js").every;n({target:"Array",proto:!0,forced:!r("./node_modules/core-js-pure/internals/array-method-is-strict.js")("every")},{every:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},"./node_modules/core-js-pure/modules/es.array.fill.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/array-fill.js"),s=r("./node_modules/core-js-pure/internals/add-to-unscopables.js");n({target:"Array",proto:!0},{fill:o}),s("fill")},"./node_modules/core-js-pure/modules/es.array.filter.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/array-iteration.js").filter;n({target:"Array",proto:!0,forced:!r("./node_modules/core-js-pure/internals/array-method-has-species-support.js")("filter")},{filter:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},"./node_modules/core-js-pure/modules/es.array.for-each.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/array-for-each.js");n({target:"Array",proto:!0,forced:[].forEach!=o},{forEach:o})},"./node_modules/core-js-pure/modules/es.array.from.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/array-from.js");n({target:"Array",stat:!0,forced:!r("./node_modules/core-js-pure/internals/check-correctness-of-iteration.js")((function(e){Array.from(e)}))},{from:o})},"./node_modules/core-js-pure/modules/es.array.includes.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/array-includes.js").includes,s=r("./node_modules/core-js-pure/internals/add-to-unscopables.js");n({target:"Array",proto:!0},{includes:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),s("includes")},"./node_modules/core-js-pure/modules/es.array.index-of.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/array-includes.js").indexOf,s=r("./node_modules/core-js-pure/internals/array-method-is-strict.js"),i=[].indexOf,a=!!i&&1/[1].indexOf(1,-0)<0,A=s("indexOf");n({target:"Array",proto:!0,forced:a||!A},{indexOf:function(e){return a?i.apply(this,arguments)||0:o(this,e,arguments.length>1?arguments[1]:void 0)}})},"./node_modules/core-js-pure/modules/es.array.is-array.js":function(e,t,r){r("./node_modules/core-js-pure/internals/export.js")({target:"Array",stat:!0},{isArray:r("./node_modules/core-js-pure/internals/is-array.js")})},"./node_modules/core-js-pure/modules/es.array.iterator.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/to-indexed-object.js"),o=r("./node_modules/core-js-pure/internals/add-to-unscopables.js"),s=r("./node_modules/core-js-pure/internals/iterators.js"),i=r("./node_modules/core-js-pure/internals/internal-state.js"),a=r("./node_modules/core-js-pure/internals/define-iterator.js"),A="Array Iterator",u=i.set,c=i.getterFor(A);e.exports=a(Array,"Array",(function(e,t){u(this,{type:A,target:n(e),index:0,kind:t})}),(function(){var e=c(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:t[n],done:!1}:{value:[n,t[n]],done:!1}}),"values"),s.Arguments=s.Array,o("keys"),o("values"),o("entries")},"./node_modules/core-js-pure/modules/es.array.map.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/array-iteration.js").map;n({target:"Array",proto:!0,forced:!r("./node_modules/core-js-pure/internals/array-method-has-species-support.js")("map")},{map:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},"./node_modules/core-js-pure/modules/es.array.reduce.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/array-reduce.js").left,s=r("./node_modules/core-js-pure/internals/array-method-is-strict.js"),i=r("./node_modules/core-js-pure/internals/engine-v8-version.js"),a=r("./node_modules/core-js-pure/internals/engine-is-node.js");n({target:"Array",proto:!0,forced:!s("reduce")||!a&&i>79&&i<83},{reduce:function(e){return o(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}})},"./node_modules/core-js-pure/modules/es.array.reverse.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/is-array.js"),s=[].reverse,i=[1,2];n({target:"Array",proto:!0,forced:String(i)===String(i.reverse())},{reverse:function(){return o(this)&&(this.length=this.length),s.call(this)}})},"./node_modules/core-js-pure/modules/es.array.slice.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/is-object.js"),s=r("./node_modules/core-js-pure/internals/is-array.js"),i=r("./node_modules/core-js-pure/internals/to-absolute-index.js"),a=r("./node_modules/core-js-pure/internals/to-length.js"),A=r("./node_modules/core-js-pure/internals/to-indexed-object.js"),u=r("./node_modules/core-js-pure/internals/create-property.js"),c=r("./node_modules/core-js-pure/internals/well-known-symbol.js"),l=r("./node_modules/core-js-pure/internals/array-method-has-species-support.js")("slice"),d=c("species"),f=[].slice,h=Math.max;n({target:"Array",proto:!0,forced:!l},{slice:function(e,t){var r,n,c,l=A(this),p=a(l.length),m=i(e,p),g=i(void 0===t?p:t,p);if(s(l)&&("function"!=typeof(r=l.constructor)||r!==Array&&!s(r.prototype)?o(r)&&null===(r=r[d])&&(r=void 0):r=void 0,r===Array||void 0===r))return f.call(l,m,g);for(n=new(void 0===r?Array:r)(h(g-m,0)),c=0;m<g;m++,c++)m in l&&u(n,c,l[m]);return n.length=c,n}})},"./node_modules/core-js-pure/modules/es.array.some.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/array-iteration.js").some;n({target:"Array",proto:!0,forced:!r("./node_modules/core-js-pure/internals/array-method-is-strict.js")("some")},{some:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},"./node_modules/core-js-pure/modules/es.date.now.js":function(e,t,r){r("./node_modules/core-js-pure/internals/export.js")({target:"Date",stat:!0},{now:function(){return(new Date).getTime()}})},"./node_modules/core-js-pure/modules/es.function.bind.js":function(e,t,r){r("./node_modules/core-js-pure/internals/export.js")({target:"Function",proto:!0},{bind:r("./node_modules/core-js-pure/internals/function-bind.js")})},"./node_modules/core-js-pure/modules/es.json.to-string-tag.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/global.js");r("./node_modules/core-js-pure/internals/set-to-string-tag.js")(n.JSON,"JSON",!0)},"./node_modules/core-js-pure/modules/es.map.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/collection.js"),o=r("./node_modules/core-js-pure/internals/collection-strong.js");e.exports=n("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),o)},"./node_modules/core-js-pure/modules/es.math.to-string-tag.js":function(){},"./node_modules/core-js-pure/modules/es.object.create.js":function(e,t,r){r("./node_modules/core-js-pure/internals/export.js")({target:"Object",stat:!0,sham:!r("./node_modules/core-js-pure/internals/descriptors.js")},{create:r("./node_modules/core-js-pure/internals/object-create.js")})},"./node_modules/core-js-pure/modules/es.object.define-properties.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/descriptors.js");n({target:"Object",stat:!0,forced:!o,sham:!o},{defineProperties:r("./node_modules/core-js-pure/internals/object-define-properties.js")})},"./node_modules/core-js-pure/modules/es.object.define-property.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/descriptors.js");n({target:"Object",stat:!0,forced:!o,sham:!o},{defineProperty:r("./node_modules/core-js-pure/internals/object-define-property.js").f})},"./node_modules/core-js-pure/modules/es.object.get-own-property-descriptor.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/fails.js"),s=r("./node_modules/core-js-pure/internals/to-indexed-object.js"),i=r("./node_modules/core-js-pure/internals/object-get-own-property-descriptor.js").f,a=r("./node_modules/core-js-pure/internals/descriptors.js"),A=o((function(){i(1)}));n({target:"Object",stat:!0,forced:!a||A,sham:!a},{getOwnPropertyDescriptor:function(e,t){return i(s(e),t)}})},"./node_modules/core-js-pure/modules/es.object.get-own-property-descriptors.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/descriptors.js"),s=r("./node_modules/core-js-pure/internals/own-keys.js"),i=r("./node_modules/core-js-pure/internals/to-indexed-object.js"),a=r("./node_modules/core-js-pure/internals/object-get-own-property-descriptor.js"),A=r("./node_modules/core-js-pure/internals/create-property.js");n({target:"Object",stat:!0,sham:!o},{getOwnPropertyDescriptors:function(e){for(var t,r,n=i(e),o=a.f,u=s(n),c={},l=0;u.length>l;)void 0!==(r=o(n,t=u[l++]))&&A(c,t,r);return c}})},"./node_modules/core-js-pure/modules/es.object.get-prototype-of.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/fails.js"),s=r("./node_modules/core-js-pure/internals/to-object.js"),i=r("./node_modules/core-js-pure/internals/object-get-prototype-of.js"),a=r("./node_modules/core-js-pure/internals/correct-prototype-getter.js");n({target:"Object",stat:!0,forced:o((function(){i(1)})),sham:!a},{getPrototypeOf:function(e){return i(s(e))}})},"./node_modules/core-js-pure/modules/es.object.keys.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/to-object.js"),s=r("./node_modules/core-js-pure/internals/object-keys.js");n({target:"Object",stat:!0,forced:r("./node_modules/core-js-pure/internals/fails.js")((function(){s(1)}))},{keys:function(e){return s(o(e))}})},"./node_modules/core-js-pure/modules/es.object.set-prototype-of.js":function(e,t,r){r("./node_modules/core-js-pure/internals/export.js")({target:"Object",stat:!0},{setPrototypeOf:r("./node_modules/core-js-pure/internals/object-set-prototype-of.js")})},"./node_modules/core-js-pure/modules/es.object.to-string.js":function(){},"./node_modules/core-js-pure/modules/es.parse-float.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/number-parse-float.js");n({global:!0,forced:parseFloat!=o},{parseFloat:o})},"./node_modules/core-js-pure/modules/es.parse-int.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/number-parse-int.js");n({global:!0,forced:parseInt!=o},{parseInt:o})},"./node_modules/core-js-pure/modules/es.promise.all-settled.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/a-function.js"),s=r("./node_modules/core-js-pure/internals/new-promise-capability.js"),i=r("./node_modules/core-js-pure/internals/perform.js"),a=r("./node_modules/core-js-pure/internals/iterate.js");n({target:"Promise",stat:!0},{allSettled:function(e){var t=this,r=s.f(t),n=r.resolve,A=r.reject,u=i((function(){var r=o(t.resolve),s=[],i=0,A=1;a(e,(function(e){var o=i++,a=!1;s.push(void 0),A++,r.call(t,e).then((function(e){a||(a=!0,s[o]={status:"fulfilled",value:e},--A||n(s))}),(function(e){a||(a=!0,s[o]={status:"rejected",reason:e},--A||n(s))}))})),--A||n(s)}));return u.error&&A(u.value),r.promise}})},"./node_modules/core-js-pure/modules/es.promise.any.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/a-function.js"),s=r("./node_modules/core-js-pure/internals/get-built-in.js"),i=r("./node_modules/core-js-pure/internals/new-promise-capability.js"),a=r("./node_modules/core-js-pure/internals/perform.js"),A=r("./node_modules/core-js-pure/internals/iterate.js"),u="No one promise resolved";n({target:"Promise",stat:!0},{any:function(e){var t=this,r=i.f(t),n=r.resolve,c=r.reject,l=a((function(){var r=o(t.resolve),i=[],a=0,l=1,d=!1;A(e,(function(e){var o=a++,A=!1;i.push(void 0),l++,r.call(t,e).then((function(e){A||d||(d=!0,n(e))}),(function(e){A||d||(A=!0,i[o]=e,--l||c(new(s("AggregateError"))(i,u)))}))})),--l||c(new(s("AggregateError"))(i,u))}));return l.error&&c(l.value),r.promise}})},"./node_modules/core-js-pure/modules/es.promise.finally.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/is-pure.js"),s=r("./node_modules/core-js-pure/internals/native-promise-constructor.js"),i=r("./node_modules/core-js-pure/internals/fails.js"),a=r("./node_modules/core-js-pure/internals/get-built-in.js"),A=r("./node_modules/core-js-pure/internals/species-constructor.js"),u=r("./node_modules/core-js-pure/internals/promise-resolve.js"),c=r("./node_modules/core-js-pure/internals/redefine.js");if(n({target:"Promise",proto:!0,real:!0,forced:!!s&&i((function(){s.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=A(this,a("Promise")),r="function"==typeof e;return this.then(r?function(r){return u(t,e()).then((function(){return r}))}:e,r?function(r){return u(t,e()).then((function(){throw r}))}:e)}}),!o&&"function"==typeof s){var l=a("Promise").prototype.finally;s.prototype.finally!==l&&c(s.prototype,"finally",l,{unsafe:!0})}},"./node_modules/core-js-pure/modules/es.promise.js":function(e,t,r){"use strict";var n,o,s,i,a=r("./node_modules/core-js-pure/internals/export.js"),A=r("./node_modules/core-js-pure/internals/is-pure.js"),u=r("./node_modules/core-js-pure/internals/global.js"),c=r("./node_modules/core-js-pure/internals/get-built-in.js"),l=r("./node_modules/core-js-pure/internals/native-promise-constructor.js"),d=r("./node_modules/core-js-pure/internals/redefine.js"),f=r("./node_modules/core-js-pure/internals/redefine-all.js"),h=r("./node_modules/core-js-pure/internals/object-set-prototype-of.js"),p=r("./node_modules/core-js-pure/internals/set-to-string-tag.js"),m=r("./node_modules/core-js-pure/internals/set-species.js"),g=r("./node_modules/core-js-pure/internals/is-object.js"),y=r("./node_modules/core-js-pure/internals/a-function.js"),v=r("./node_modules/core-js-pure/internals/an-instance.js"),w=r("./node_modules/core-js-pure/internals/inspect-source.js"),b=r("./node_modules/core-js-pure/internals/iterate.js"),B=r("./node_modules/core-js-pure/internals/check-correctness-of-iteration.js"),j=r("./node_modules/core-js-pure/internals/species-constructor.js"),_=r("./node_modules/core-js-pure/internals/task.js").set,C=r("./node_modules/core-js-pure/internals/microtask.js"),x=r("./node_modules/core-js-pure/internals/promise-resolve.js"),E=r("./node_modules/core-js-pure/internals/host-report-errors.js"),N=r("./node_modules/core-js-pure/internals/new-promise-capability.js"),Q=r("./node_modules/core-js-pure/internals/perform.js"),F=r("./node_modules/core-js-pure/internals/internal-state.js"),U=r("./node_modules/core-js-pure/internals/is-forced.js"),S=r("./node_modules/core-js-pure/internals/well-known-symbol.js"),L=r("./node_modules/core-js-pure/internals/engine-is-browser.js"),T=r("./node_modules/core-js-pure/internals/engine-is-node.js"),H=r("./node_modules/core-js-pure/internals/engine-v8-version.js"),I=S("species"),P="Promise",O=F.get,k=F.set,R=F.getterFor(P),M=l&&l.prototype,D=l,K=M,z=u.TypeError,V=u.document,q=u.process,G=N.f,X=G,W=!!(V&&V.createEvent&&u.dispatchEvent),J="function"==typeof PromiseRejectionEvent,Y="unhandledrejection",Z=!1,$=U(P,(function(){var e=w(D),t=e!==String(D);if(!t&&66===H)return!0;if(A&&!K.finally)return!0;if(H>=51&&/native code/.test(e))return!1;var r=new D((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};return(r.constructor={})[I]=n,!(Z=r.then((function(){}))instanceof n)||!t&&L&&!J})),ee=$||!B((function(e){D.all(e).catch((function(){}))})),te=function(e){var t;return!(!g(e)||"function"!=typeof(t=e.then))&&t},re=function(e,t){if(!e.notified){e.notified=!0;var r=e.reactions;C((function(){for(var n=e.value,o=1==e.state,s=0;r.length>s;){var i,a,A,u=r[s++],c=o?u.ok:u.fail,l=u.resolve,d=u.reject,f=u.domain;try{c?(o||(2===e.rejection&&ie(e),e.rejection=1),!0===c?i=n:(f&&f.enter(),i=c(n),f&&(f.exit(),A=!0)),i===u.promise?d(z("Promise-chain cycle")):(a=te(i))?a.call(i,l,d):l(i)):d(n)}catch(e){f&&!A&&f.exit(),d(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&oe(e)}))}},ne=function(e,t,r){var n,o;W?((n=V.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),u.dispatchEvent(n)):n={promise:t,reason:r},!J&&(o=u["on"+e])?o(n):e===Y&&E("Unhandled promise rejection",r)},oe=function(e){_.call(u,(function(){var t,r=e.facade,n=e.value;if(se(e)&&(t=Q((function(){T?q.emit("unhandledRejection",n,r):ne(Y,r,n)})),e.rejection=T||se(e)?2:1,t.error))throw t.value}))},se=function(e){return 1!==e.rejection&&!e.parent},ie=function(e){_.call(u,(function(){var t=e.facade;T?q.emit("rejectionHandled",t):ne("rejectionhandled",t,e.value)}))},ae=function(e,t,r){return function(n){e(t,n,r)}},Ae=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,re(e,!0))},ue=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw z("Promise can't be resolved itself");var n=te(t);n?C((function(){var r={done:!1};try{n.call(t,ae(ue,r,e),ae(Ae,r,e))}catch(t){Ae(r,t,e)}})):(e.value=t,e.state=1,re(e,!1))}catch(t){Ae({done:!1},t,e)}}};if($&&(K=(D=function(e){v(this,D,P),y(e),n.call(this);var t=O(this);try{e(ae(ue,t),ae(Ae,t))}catch(e){Ae(t,e)}}).prototype,(n=function(e){k(this,{type:P,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=f(K,{then:function(e,t){var r=R(this),n=G(j(this,D));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=T?q.domain:void 0,r.parent=!0,r.reactions.push(n),0!=r.state&&re(r,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new n,t=O(e);this.promise=e,this.resolve=ae(ue,t),this.reject=ae(Ae,t)},N.f=G=function(e){return e===D||e===s?new o(e):X(e)},!A&&"function"==typeof l&&M!==Object.prototype)){i=M.then,Z||(d(M,"then",(function(e,t){var r=this;return new D((function(e,t){i.call(r,e,t)})).then(e,t)}),{unsafe:!0}),d(M,"catch",K.catch,{unsafe:!0}));try{delete M.constructor}catch(e){}h&&h(M,K)}a({global:!0,wrap:!0,forced:$},{Promise:D}),p(D,P,!1,!0),m(P),s=c(P),a({target:P,stat:!0,forced:$},{reject:function(e){var t=G(this);return t.reject.call(void 0,e),t.promise}}),a({target:P,stat:!0,forced:A||$},{resolve:function(e){return x(A&&this===s?D:this,e)}}),a({target:P,stat:!0,forced:ee},{all:function(e){var t=this,r=G(t),n=r.resolve,o=r.reject,s=Q((function(){var r=y(t.resolve),s=[],i=0,a=1;b(e,(function(e){var A=i++,u=!1;s.push(void 0),a++,r.call(t,e).then((function(e){u||(u=!0,s[A]=e,--a||n(s))}),o)})),--a||n(s)}));return s.error&&o(s.value),r.promise},race:function(e){var t=this,r=G(t),n=r.reject,o=Q((function(){var o=y(t.resolve);b(e,(function(e){o.call(t,e).then(r.resolve,n)}))}));return o.error&&n(o.value),r.promise}})},"./node_modules/core-js-pure/modules/es.reflect.apply.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/get-built-in.js"),s=r("./node_modules/core-js-pure/internals/a-function.js"),i=r("./node_modules/core-js-pure/internals/an-object.js"),a=r("./node_modules/core-js-pure/internals/fails.js"),A=o("Reflect","apply"),u=Function.apply;n({target:"Reflect",stat:!0,forced:!a((function(){A((function(){}))}))},{apply:function(e,t,r){return s(e),i(r),A?A(e,t,r):u.call(e,t,r)}})},"./node_modules/core-js-pure/modules/es.reflect.construct.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/get-built-in.js"),s=r("./node_modules/core-js-pure/internals/a-function.js"),i=r("./node_modules/core-js-pure/internals/an-object.js"),a=r("./node_modules/core-js-pure/internals/is-object.js"),A=r("./node_modules/core-js-pure/internals/object-create.js"),u=r("./node_modules/core-js-pure/internals/function-bind.js"),c=r("./node_modules/core-js-pure/internals/fails.js"),l=o("Reflect","construct"),d=c((function(){function e(){}return!(l((function(){}),[],e)instanceof e)})),f=!c((function(){l((function(){}))})),h=d||f;n({target:"Reflect",stat:!0,forced:h,sham:h},{construct:function(e,t){s(e),i(t);var r=arguments.length<3?e:s(arguments[2]);if(f&&!d)return l(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return n.push.apply(n,t),new(u.apply(e,n))}var o=r.prototype,c=A(a(o)?o:Object.prototype),h=Function.apply.call(e,c,t);return a(h)?h:c}})},"./node_modules/core-js-pure/modules/es.reflect.delete-property.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/an-object.js"),s=r("./node_modules/core-js-pure/internals/object-get-own-property-descriptor.js").f;n({target:"Reflect",stat:!0},{deleteProperty:function(e,t){var r=s(o(e),t);return!(r&&!r.configurable)&&delete e[t]}})},"./node_modules/core-js-pure/modules/es.reflect.get-prototype-of.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/an-object.js"),s=r("./node_modules/core-js-pure/internals/object-get-prototype-of.js");n({target:"Reflect",stat:!0,sham:!r("./node_modules/core-js-pure/internals/correct-prototype-getter.js")},{getPrototypeOf:function(e){return s(o(e))}})},"./node_modules/core-js-pure/modules/es.reflect.get.js":function(e,t,r){var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/is-object.js"),s=r("./node_modules/core-js-pure/internals/an-object.js"),i=r("./node_modules/core-js-pure/internals/has.js"),a=r("./node_modules/core-js-pure/internals/object-get-own-property-descriptor.js"),A=r("./node_modules/core-js-pure/internals/object-get-prototype-of.js");n({target:"Reflect",stat:!0},{get:function e(t,r){var n,u,c=arguments.length<3?t:arguments[2];return s(t)===c?t[r]:(n=a.f(t,r))?i(n,"value")?n.value:void 0===n.get?void 0:n.get.call(c):o(u=A(t))?e(u,r,c):void 0}})},"./node_modules/core-js-pure/modules/es.reflect.to-string-tag.js":function(){},"./node_modules/core-js-pure/modules/es.string.includes.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/not-a-regexp.js"),s=r("./node_modules/core-js-pure/internals/require-object-coercible.js");n({target:"String",proto:!0,forced:!r("./node_modules/core-js-pure/internals/correct-is-regexp-logic.js")("includes")},{includes:function(e){return!!~String(s(this)).indexOf(o(e),arguments.length>1?arguments[1]:void 0)}})},"./node_modules/core-js-pure/modules/es.string.iterator.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/string-multibyte.js").charAt,o=r("./node_modules/core-js-pure/internals/internal-state.js"),s=r("./node_modules/core-js-pure/internals/define-iterator.js"),i="String Iterator",a=o.set,A=o.getterFor(i);s(String,"String",(function(e){a(this,{type:i,string:String(e),index:0})}),(function(){var e,t=A(this),r=t.string,o=t.index;return o>=r.length?{value:void 0,done:!0}:(e=n(r,o),t.index+=e.length,{value:e,done:!1})}))},"./node_modules/core-js-pure/modules/es.string.starts-with.js":function(e,t,r){"use strict";var n,o=r("./node_modules/core-js-pure/internals/export.js"),s=r("./node_modules/core-js-pure/internals/object-get-own-property-descriptor.js").f,i=r("./node_modules/core-js-pure/internals/to-length.js"),a=r("./node_modules/core-js-pure/internals/not-a-regexp.js"),A=r("./node_modules/core-js-pure/internals/require-object-coercible.js"),u=r("./node_modules/core-js-pure/internals/correct-is-regexp-logic.js"),c=r("./node_modules/core-js-pure/internals/is-pure.js"),l="".startsWith,d=Math.min,f=u("startsWith");o({target:"String",proto:!0,forced:!(!c&&!f&&(n=s(String.prototype,"startsWith"),n&&!n.writable)||f)},{startsWith:function(e){var t=String(A(this));a(e);var r=i(d(arguments.length>1?arguments[1]:void 0,t.length)),n=String(e);return l?l.call(t,n,r):t.slice(r,r+n.length)===n}})},"./node_modules/core-js-pure/modules/es.string.trim.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/string-trim.js").trim;n({target:"String",proto:!0,forced:r("./node_modules/core-js-pure/internals/string-trim-forced.js")("trim")},{trim:function(){return o(this)}})},"./node_modules/core-js-pure/modules/es.symbol.async-iterator.js":function(e,t,r){r("./node_modules/core-js-pure/internals/define-well-known-symbol.js")("asyncIterator")},"./node_modules/core-js-pure/modules/es.symbol.description.js":function(){},"./node_modules/core-js-pure/modules/es.symbol.has-instance.js":function(e,t,r){r("./node_modules/core-js-pure/internals/define-well-known-symbol.js")("hasInstance")},"./node_modules/core-js-pure/modules/es.symbol.is-concat-spreadable.js":function(e,t,r){r("./node_modules/core-js-pure/internals/define-well-known-symbol.js")("isConcatSpreadable")},"./node_modules/core-js-pure/modules/es.symbol.iterator.js":function(e,t,r){r("./node_modules/core-js-pure/internals/define-well-known-symbol.js")("iterator")},"./node_modules/core-js-pure/modules/es.symbol.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/global.js"),s=r("./node_modules/core-js-pure/internals/get-built-in.js"),i=r("./node_modules/core-js-pure/internals/is-pure.js"),a=r("./node_modules/core-js-pure/internals/descriptors.js"),A=r("./node_modules/core-js-pure/internals/native-symbol.js"),u=r("./node_modules/core-js-pure/internals/use-symbol-as-uid.js"),c=r("./node_modules/core-js-pure/internals/fails.js"),l=r("./node_modules/core-js-pure/internals/has.js"),d=r("./node_modules/core-js-pure/internals/is-array.js"),f=r("./node_modules/core-js-pure/internals/is-object.js"),h=r("./node_modules/core-js-pure/internals/an-object.js"),p=r("./node_modules/core-js-pure/internals/to-object.js"),m=r("./node_modules/core-js-pure/internals/to-indexed-object.js"),g=r("./node_modules/core-js-pure/internals/to-primitive.js"),y=r("./node_modules/core-js-pure/internals/create-property-descriptor.js"),v=r("./node_modules/core-js-pure/internals/object-create.js"),w=r("./node_modules/core-js-pure/internals/object-keys.js"),b=r("./node_modules/core-js-pure/internals/object-get-own-property-names.js"),B=r("./node_modules/core-js-pure/internals/object-get-own-property-names-external.js"),j=r("./node_modules/core-js-pure/internals/object-get-own-property-symbols.js"),_=r("./node_modules/core-js-pure/internals/object-get-own-property-descriptor.js"),C=r("./node_modules/core-js-pure/internals/object-define-property.js"),x=r("./node_modules/core-js-pure/internals/object-property-is-enumerable.js"),E=r("./node_modules/core-js-pure/internals/create-non-enumerable-property.js"),N=r("./node_modules/core-js-pure/internals/redefine.js"),Q=r("./node_modules/core-js-pure/internals/shared.js"),F=r("./node_modules/core-js-pure/internals/shared-key.js"),U=r("./node_modules/core-js-pure/internals/hidden-keys.js"),S=r("./node_modules/core-js-pure/internals/uid.js"),L=r("./node_modules/core-js-pure/internals/well-known-symbol.js"),T=r("./node_modules/core-js-pure/internals/well-known-symbol-wrapped.js"),H=r("./node_modules/core-js-pure/internals/define-well-known-symbol.js"),I=r("./node_modules/core-js-pure/internals/set-to-string-tag.js"),P=r("./node_modules/core-js-pure/internals/internal-state.js"),O=r("./node_modules/core-js-pure/internals/array-iteration.js").forEach,k=F("hidden"),R="Symbol",M=L("toPrimitive"),D=P.set,K=P.getterFor(R),z=Object.prototype,V=o.Symbol,q=s("JSON","stringify"),G=_.f,X=C.f,W=B.f,J=x.f,Y=Q("symbols"),Z=Q("op-symbols"),$=Q("string-to-symbol-registry"),ee=Q("symbol-to-string-registry"),te=Q("wks"),re=o.QObject,ne=!re||!re.prototype||!re.prototype.findChild,oe=a&&c((function(){return 7!=v(X({},"a",{get:function(){return X(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=G(z,t);n&&delete z[t],X(e,t,r),n&&e!==z&&X(z,t,n)}:X,se=function(e,t){var r=Y[e]=v(V.prototype);return D(r,{type:R,tag:e,description:t}),a||(r.description=t),r},ie=u?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof V},ae=function(e,t,r){e===z&&ae(Z,t,r),h(e);var n=g(t,!0);return h(r),l(Y,n)?(r.enumerable?(l(e,k)&&e[k][n]&&(e[k][n]=!1),r=v(r,{enumerable:y(0,!1)})):(l(e,k)||X(e,k,y(1,{})),e[k][n]=!0),oe(e,n,r)):X(e,n,r)},Ae=function(e,t){h(e);var r=m(t),n=w(r).concat(de(r));return O(n,(function(t){a&&!ue.call(r,t)||ae(e,t,r[t])})),e},ue=function(e){var t=g(e,!0),r=J.call(this,t);return!(this===z&&l(Y,t)&&!l(Z,t))&&(!(r||!l(this,t)||!l(Y,t)||l(this,k)&&this[k][t])||r)},ce=function(e,t){var r=m(e),n=g(t,!0);if(r!==z||!l(Y,n)||l(Z,n)){var o=G(r,n);return!o||!l(Y,n)||l(r,k)&&r[k][n]||(o.enumerable=!0),o}},le=function(e){var t=W(m(e)),r=[];return O(t,(function(e){l(Y,e)||l(U,e)||r.push(e)})),r},de=function(e){var t=e===z,r=W(t?Z:m(e)),n=[];return O(r,(function(e){!l(Y,e)||t&&!l(z,e)||n.push(Y[e])})),n};A||(N((V=function(){if(this instanceof V)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=S(e),r=function(e){this===z&&r.call(Z,e),l(this,k)&&l(this[k],t)&&(this[k][t]=!1),oe(this,t,y(1,e))};return a&&ne&&oe(z,t,{configurable:!0,set:r}),se(t,e)}).prototype,"toString",(function(){return K(this).tag})),N(V,"withoutSetter",(function(e){return se(S(e),e)})),x.f=ue,C.f=ae,_.f=ce,b.f=B.f=le,j.f=de,T.f=function(e){return se(L(e),e)},a&&(X(V.prototype,"description",{configurable:!0,get:function(){return K(this).description}}),i||N(z,"propertyIsEnumerable",ue,{unsafe:!0}))),n({global:!0,wrap:!0,forced:!A,sham:!A},{Symbol:V}),O(w(te),(function(e){H(e)})),n({target:R,stat:!0,forced:!A},{for:function(e){var t=String(e);if(l($,t))return $[t];var r=V(t);return $[t]=r,ee[r]=t,r},keyFor:function(e){if(!ie(e))throw TypeError(e+" is not a symbol");if(l(ee,e))return ee[e]},useSetter:function(){ne=!0},useSimple:function(){ne=!1}}),n({target:"Object",stat:!0,forced:!A,sham:!a},{create:function(e,t){return void 0===t?v(e):Ae(v(e),t)},defineProperty:ae,defineProperties:Ae,getOwnPropertyDescriptor:ce}),n({target:"Object",stat:!0,forced:!A},{getOwnPropertyNames:le,getOwnPropertySymbols:de}),n({target:"Object",stat:!0,forced:c((function(){j.f(1)}))},{getOwnPropertySymbols:function(e){return j.f(p(e))}}),q&&n({target:"JSON",stat:!0,forced:!A||c((function(){var e=V();return"[null]"!=q([e])||"{}"!=q({a:e})||"{}"!=q(Object(e))}))},{stringify:function(e,t,r){for(var n,o=[e],s=1;arguments.length>s;)o.push(arguments[s++]);if(n=t,(f(t)||void 0!==e)&&!ie(e))return d(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!ie(t))return t}),o[1]=t,q.apply(null,o)}}),V.prototype[M]||E(V.prototype,M,V.prototype.valueOf),I(V,R),U[k]=!0},"./node_modules/core-js-pure/modules/es.symbol.match-all.js":function(e,t,r){r("./node_modules/core-js-pure/internals/define-well-known-symbol.js")("matchAll")},"./node_modules/core-js-pure/modules/es.symbol.match.js":function(e,t,r){r("./node_modules/core-js-pure/internals/define-well-known-symbol.js")("match")},"./node_modules/core-js-pure/modules/es.symbol.replace.js":function(e,t,r){r("./node_modules/core-js-pure/internals/define-well-known-symbol.js")("replace")},"./node_modules/core-js-pure/modules/es.symbol.search.js":function(e,t,r){r("./node_modules/core-js-pure/internals/define-well-known-symbol.js")("search")},"./node_modules/core-js-pure/modules/es.symbol.species.js":function(e,t,r){r("./node_modules/core-js-pure/internals/define-well-known-symbol.js")("species")},"./node_modules/core-js-pure/modules/es.symbol.split.js":function(e,t,r){r("./node_modules/core-js-pure/internals/define-well-known-symbol.js")("split")},"./node_modules/core-js-pure/modules/es.symbol.to-primitive.js":function(e,t,r){r("./node_modules/core-js-pure/internals/define-well-known-symbol.js")("toPrimitive")},"./node_modules/core-js-pure/modules/es.symbol.to-string-tag.js":function(e,t,r){r("./node_modules/core-js-pure/internals/define-well-known-symbol.js")("toStringTag")},"./node_modules/core-js-pure/modules/es.symbol.unscopables.js":function(e,t,r){r("./node_modules/core-js-pure/internals/define-well-known-symbol.js")("unscopables")},"./node_modules/core-js-pure/modules/esnext.aggregate-error.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.aggregate-error.js")},"./node_modules/core-js-pure/modules/esnext.promise.all-settled.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.promise.all-settled.js")},"./node_modules/core-js-pure/modules/esnext.promise.any.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.promise.any.js")},"./node_modules/core-js-pure/modules/esnext.promise.try.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js-pure/internals/export.js"),o=r("./node_modules/core-js-pure/internals/new-promise-capability.js"),s=r("./node_modules/core-js-pure/internals/perform.js");n({target:"Promise",stat:!0},{try:function(e){var t=o.f(this),r=s(e);return(r.error?t.reject:t.resolve)(r.value),t.promise}})},"./node_modules/core-js-pure/modules/esnext.symbol.async-dispose.js":function(e,t,r){r("./node_modules/core-js-pure/internals/define-well-known-symbol.js")("asyncDispose")},"./node_modules/core-js-pure/modules/esnext.symbol.dispose.js":function(e,t,r){r("./node_modules/core-js-pure/internals/define-well-known-symbol.js")("dispose")},"./node_modules/core-js-pure/modules/esnext.symbol.matcher.js":function(e,t,r){r("./node_modules/core-js-pure/internals/define-well-known-symbol.js")("matcher")},"./node_modules/core-js-pure/modules/esnext.symbol.metadata.js":function(e,t,r){r("./node_modules/core-js-pure/internals/define-well-known-symbol.js")("metadata")},"./node_modules/core-js-pure/modules/esnext.symbol.observable.js":function(e,t,r){r("./node_modules/core-js-pure/internals/define-well-known-symbol.js")("observable")},"./node_modules/core-js-pure/modules/esnext.symbol.pattern-match.js":function(e,t,r){r("./node_modules/core-js-pure/internals/define-well-known-symbol.js")("patternMatch")},"./node_modules/core-js-pure/modules/esnext.symbol.replace-all.js":function(e,t,r){r("./node_modules/core-js-pure/internals/define-well-known-symbol.js")("replaceAll")},"./node_modules/core-js-pure/modules/web.dom-collections.iterator.js":function(e,t,r){r("./node_modules/core-js-pure/modules/es.array.iterator.js");var n=r("./node_modules/core-js-pure/internals/dom-iterables.js"),o=r("./node_modules/core-js-pure/internals/global.js"),s=r("./node_modules/core-js-pure/internals/classof.js"),i=r("./node_modules/core-js-pure/internals/create-non-enumerable-property.js"),a=r("./node_modules/core-js-pure/internals/iterators.js"),A=r("./node_modules/core-js-pure/internals/well-known-symbol.js")("toStringTag");for(var u in n){var c=o[u],l=c&&c.prototype;l&&s(l)!==A&&i(l,A,u),a[u]=a.Array}},"./node_modules/core-js-pure/stable/array/from.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/array/from.js");e.exports=n},"./node_modules/core-js-pure/stable/array/is-array.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/array/is-array.js");e.exports=n},"./node_modules/core-js-pure/stable/array/virtual/for-each.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/array/virtual/for-each.js");e.exports=n},"./node_modules/core-js-pure/stable/array/virtual/values.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/array/virtual/values.js");e.exports=n},"./node_modules/core-js-pure/stable/date/now.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/date/now.js");e.exports=n},"./node_modules/core-js-pure/stable/instance/bind.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/instance/bind.js");e.exports=n},"./node_modules/core-js-pure/stable/instance/concat.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/instance/concat.js");e.exports=n},"./node_modules/core-js-pure/stable/instance/every.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/instance/every.js");e.exports=n},"./node_modules/core-js-pure/stable/instance/fill.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/instance/fill.js");e.exports=n},"./node_modules/core-js-pure/stable/instance/filter.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/instance/filter.js");e.exports=n},"./node_modules/core-js-pure/stable/instance/for-each.js":function(e,t,r){r("./node_modules/core-js-pure/modules/web.dom-collections.iterator.js");var n=r("./node_modules/core-js-pure/stable/array/virtual/for-each.js"),o=r("./node_modules/core-js-pure/internals/classof.js"),s=Array.prototype,i={DOMTokenList:!0,NodeList:!0};e.exports=function(e){var t=e.forEach;return e===s||e instanceof Array&&t===s.forEach||i.hasOwnProperty(o(e))?n:t}},"./node_modules/core-js-pure/stable/instance/includes.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/instance/includes.js");e.exports=n},"./node_modules/core-js-pure/stable/instance/index-of.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/instance/index-of.js");e.exports=n},"./node_modules/core-js-pure/stable/instance/map.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/instance/map.js");e.exports=n},"./node_modules/core-js-pure/stable/instance/reduce.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/instance/reduce.js");e.exports=n},"./node_modules/core-js-pure/stable/instance/reverse.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/instance/reverse.js");e.exports=n},"./node_modules/core-js-pure/stable/instance/slice.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/instance/slice.js");e.exports=n},"./node_modules/core-js-pure/stable/instance/some.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/instance/some.js");e.exports=n},"./node_modules/core-js-pure/stable/instance/starts-with.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/instance/starts-with.js");e.exports=n},"./node_modules/core-js-pure/stable/instance/trim.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/instance/trim.js");e.exports=n},"./node_modules/core-js-pure/stable/instance/values.js":function(e,t,r){r("./node_modules/core-js-pure/modules/web.dom-collections.iterator.js");var n=r("./node_modules/core-js-pure/stable/array/virtual/values.js"),o=r("./node_modules/core-js-pure/internals/classof.js"),s=Array.prototype,i={DOMTokenList:!0,NodeList:!0};e.exports=function(e){var t=e.values;return e===s||e instanceof Array&&t===s.values||i.hasOwnProperty(o(e))?n:t}},"./node_modules/core-js-pure/stable/map/index.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/map/index.js");e.exports=n},"./node_modules/core-js-pure/stable/object/define-properties.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/object/define-properties.js");e.exports=n},"./node_modules/core-js-pure/stable/object/define-property.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/object/define-property.js");e.exports=n},"./node_modules/core-js-pure/stable/object/get-own-property-descriptor.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/object/get-own-property-descriptor.js");e.exports=n},"./node_modules/core-js-pure/stable/object/get-own-property-descriptors.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/object/get-own-property-descriptors.js");e.exports=n},"./node_modules/core-js-pure/stable/object/get-own-property-symbols.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/object/get-own-property-symbols.js");e.exports=n},"./node_modules/core-js-pure/stable/object/keys.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/object/keys.js");e.exports=n},"./node_modules/core-js-pure/stable/parse-float.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/parse-float.js");e.exports=n},"./node_modules/core-js-pure/stable/parse-int.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/parse-int.js");e.exports=n},"./node_modules/core-js-pure/stable/promise/index.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/promise/index.js");e.exports=n},"./node_modules/core-js-pure/stable/reflect/apply.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/reflect/apply.js");e.exports=n},"./node_modules/core-js-pure/stable/reflect/construct.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/reflect/construct.js");e.exports=n},"./node_modules/core-js-pure/stable/reflect/delete-property.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/reflect/delete-property.js");e.exports=n},"./node_modules/core-js-pure/stable/reflect/get-prototype-of.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/reflect/get-prototype-of.js");e.exports=n},"./node_modules/core-js-pure/stable/symbol/index.js":function(e,t,r){var n=r("./node_modules/core-js-pure/es/symbol/index.js");e.exports=n},"./node_modules/core-js/internals/a-function.js":function(e){e.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}},"./node_modules/core-js/internals/a-possible-prototype.js":function(e,t,r){var n=r("./node_modules/core-js/internals/is-object.js");e.exports=function(e){if(!n(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e}},"./node_modules/core-js/internals/add-to-unscopables.js":function(e,t,r){var n=r("./node_modules/core-js/internals/well-known-symbol.js"),o=r("./node_modules/core-js/internals/object-create.js"),s=r("./node_modules/core-js/internals/object-define-property.js"),i=n("unscopables"),a=Array.prototype;null==a[i]&&s.f(a,i,{configurable:!0,value:o(null)}),e.exports=function(e){a[i][e]=!0}},"./node_modules/core-js/internals/an-object.js":function(e,t,r){var n=r("./node_modules/core-js/internals/is-object.js");e.exports=function(e){if(!n(e))throw TypeError(String(e)+" is not an object");return e}},"./node_modules/core-js/internals/array-for-each.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/internals/array-iteration.js").forEach,o=r("./node_modules/core-js/internals/array-method-is-strict.js")("forEach");e.exports=o?[].forEach:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}},"./node_modules/core-js/internals/array-includes.js":function(e,t,r){var n=r("./node_modules/core-js/internals/to-indexed-object.js"),o=r("./node_modules/core-js/internals/to-length.js"),s=r("./node_modules/core-js/internals/to-absolute-index.js"),i=function(e){return function(t,r,i){var a,A=n(t),u=o(A.length),c=s(i,u);if(e&&r!=r){for(;u>c;)if((a=A[c++])!=a)return!0}else for(;u>c;c++)if((e||c in A)&&A[c]===r)return e||c||0;return!e&&-1}};e.exports={includes:i(!0),indexOf:i(!1)}},"./node_modules/core-js/internals/array-iteration.js":function(e,t,r){var n=r("./node_modules/core-js/internals/function-bind-context.js"),o=r("./node_modules/core-js/internals/indexed-object.js"),s=r("./node_modules/core-js/internals/to-object.js"),i=r("./node_modules/core-js/internals/to-length.js"),a=r("./node_modules/core-js/internals/array-species-create.js"),A=[].push,u=function(e){var t=1==e,r=2==e,u=3==e,c=4==e,l=6==e,d=7==e,f=5==e||l;return function(h,p,m,g){for(var y,v,w=s(h),b=o(w),B=n(p,m,3),j=i(b.length),_=0,C=g||a,x=t?C(h,j):r||d?C(h,0):void 0;j>_;_++)if((f||_ in b)&&(v=B(y=b[_],_,w),e))if(t)x[_]=v;else if(v)switch(e){case 3:return!0;case 5:return y;case 6:return _;case 2:A.call(x,y)}else switch(e){case 4:return!1;case 7:A.call(x,y)}return l?-1:u||c?c:x}};e.exports={forEach:u(0),map:u(1),filter:u(2),some:u(3),every:u(4),find:u(5),findIndex:u(6),filterReject:u(7)}},"./node_modules/core-js/internals/array-method-has-species-support.js":function(e,t,r){var n=r("./node_modules/core-js/internals/fails.js"),o=r("./node_modules/core-js/internals/well-known-symbol.js"),s=r("./node_modules/core-js/internals/engine-v8-version.js"),i=o("species");e.exports=function(e){return s>=51||!n((function(){var t=[];return(t.constructor={})[i]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},"./node_modules/core-js/internals/array-method-is-strict.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/internals/fails.js");e.exports=function(e,t){var r=[][e];return!!r&&n((function(){r.call(null,t||function(){throw 1},1)}))}},"./node_modules/core-js/internals/array-species-constructor.js":function(e,t,r){var n=r("./node_modules/core-js/internals/is-object.js"),o=r("./node_modules/core-js/internals/is-array.js"),s=r("./node_modules/core-js/internals/well-known-symbol.js")("species");e.exports=function(e){var t;return o(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!o(t.prototype)?n(t)&&null===(t=t[s])&&(t=void 0):t=void 0),void 0===t?Array:t}},"./node_modules/core-js/internals/array-species-create.js":function(e,t,r){var n=r("./node_modules/core-js/internals/array-species-constructor.js");e.exports=function(e,t){return new(n(e))(0===t?0:t)}},"./node_modules/core-js/internals/classof-raw.js":function(e){var t={}.toString;e.exports=function(e){return t.call(e).slice(8,-1)}},"./node_modules/core-js/internals/classof.js":function(e,t,r){var n=r("./node_modules/core-js/internals/to-string-tag-support.js"),o=r("./node_modules/core-js/internals/classof-raw.js"),s=r("./node_modules/core-js/internals/well-known-symbol.js")("toStringTag"),i="Arguments"==o(function(){return arguments}());e.exports=n?o:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),s))?r:i?o(t):"Object"==(n=o(t))&&"function"==typeof t.callee?"Arguments":n}},"./node_modules/core-js/internals/copy-constructor-properties.js":function(e,t,r){var n=r("./node_modules/core-js/internals/has.js"),o=r("./node_modules/core-js/internals/own-keys.js"),s=r("./node_modules/core-js/internals/object-get-own-property-descriptor.js"),i=r("./node_modules/core-js/internals/object-define-property.js");e.exports=function(e,t){for(var r=o(t),a=i.f,A=s.f,u=0;u<r.length;u++){var c=r[u];n(e,c)||a(e,c,A(t,c))}}},"./node_modules/core-js/internals/correct-prototype-getter.js":function(e,t,r){var n=r("./node_modules/core-js/internals/fails.js");e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},"./node_modules/core-js/internals/create-html.js":function(e,t,r){var n=r("./node_modules/core-js/internals/require-object-coercible.js"),o=r("./node_modules/core-js/internals/to-string.js"),s=/"/g;e.exports=function(e,t,r,i){var a=o(n(e)),A="<"+t;return""!==r&&(A+=" "+r+'="'+o(i).replace(s,"&quot;")+'"'),A+">"+a+"</"+t+">"}},"./node_modules/core-js/internals/create-iterator-constructor.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/internals/iterators-core.js").IteratorPrototype,o=r("./node_modules/core-js/internals/object-create.js"),s=r("./node_modules/core-js/internals/create-property-descriptor.js"),i=r("./node_modules/core-js/internals/set-to-string-tag.js"),a=r("./node_modules/core-js/internals/iterators.js"),A=function(){return this};e.exports=function(e,t,r){var u=t+" Iterator";return e.prototype=o(n,{next:s(1,r)}),i(e,u,!1,!0),a[u]=A,e}},"./node_modules/core-js/internals/create-non-enumerable-property.js":function(e,t,r){var n=r("./node_modules/core-js/internals/descriptors.js"),o=r("./node_modules/core-js/internals/object-define-property.js"),s=r("./node_modules/core-js/internals/create-property-descriptor.js");e.exports=n?function(e,t,r){return o.f(e,t,s(1,r))}:function(e,t,r){return e[t]=r,e}},"./node_modules/core-js/internals/create-property-descriptor.js":function(e){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},"./node_modules/core-js/internals/create-property.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/internals/to-property-key.js"),o=r("./node_modules/core-js/internals/object-define-property.js"),s=r("./node_modules/core-js/internals/create-property-descriptor.js");e.exports=function(e,t,r){var i=n(t);i in e?o.f(e,i,s(0,r)):e[i]=r}},"./node_modules/core-js/internals/define-iterator.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/internals/export.js"),o=r("./node_modules/core-js/internals/create-iterator-constructor.js"),s=r("./node_modules/core-js/internals/object-get-prototype-of.js"),i=r("./node_modules/core-js/internals/object-set-prototype-of.js"),a=r("./node_modules/core-js/internals/set-to-string-tag.js"),A=r("./node_modules/core-js/internals/create-non-enumerable-property.js"),u=r("./node_modules/core-js/internals/redefine.js"),c=r("./node_modules/core-js/internals/well-known-symbol.js"),l=r("./node_modules/core-js/internals/is-pure.js"),d=r("./node_modules/core-js/internals/iterators.js"),f=r("./node_modules/core-js/internals/iterators-core.js"),h=f.IteratorPrototype,p=f.BUGGY_SAFARI_ITERATORS,m=c("iterator"),g="keys",y="values",v="entries",w=function(){return this};e.exports=function(e,t,r,c,f,b,B){o(r,t,c);var j,_,C,x=function(e){if(e===f&&U)return U;if(!p&&e in Q)return Q[e];switch(e){case g:case y:case v:return function(){return new r(this,e)}}return function(){return new r(this)}},E=t+" Iterator",N=!1,Q=e.prototype,F=Q[m]||Q["@@iterator"]||f&&Q[f],U=!p&&F||x(f),S="Array"==t&&Q.entries||F;if(S&&(j=s(S.call(new e)),h!==Object.prototype&&j.next&&(l||s(j)===h||(i?i(j,h):"function"!=typeof j[m]&&A(j,m,w)),a(j,E,!0,!0),l&&(d[E]=w))),f==y&&F&&F.name!==y&&(N=!0,U=function(){return F.call(this)}),l&&!B||Q[m]===U||A(Q,m,U),d[t]=U,f)if(_={values:x(y),keys:b?U:x(g),entries:x(v)},B)for(C in _)(p||N||!(C in Q))&&u(Q,C,_[C]);else n({target:t,proto:!0,forced:p||N},_);return _}},"./node_modules/core-js/internals/define-well-known-symbol.js":function(e,t,r){var n=r("./node_modules/core-js/internals/path.js"),o=r("./node_modules/core-js/internals/has.js"),s=r("./node_modules/core-js/internals/well-known-symbol-wrapped.js"),i=r("./node_modules/core-js/internals/object-define-property.js").f;e.exports=function(e){var t=n.Symbol||(n.Symbol={});o(t,e)||i(t,e,{value:s.f(e)})}},"./node_modules/core-js/internals/descriptors.js":function(e,t,r){var n=r("./node_modules/core-js/internals/fails.js");e.exports=!n((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},"./node_modules/core-js/internals/document-create-element.js":function(e,t,r){var n=r("./node_modules/core-js/internals/global.js"),o=r("./node_modules/core-js/internals/is-object.js"),s=n.document,i=o(s)&&o(s.createElement);e.exports=function(e){return i?s.createElement(e):{}}},"./node_modules/core-js/internals/dom-iterables.js":function(e){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},"./node_modules/core-js/internals/engine-user-agent.js":function(e,t,r){var n=r("./node_modules/core-js/internals/get-built-in.js");e.exports=n("navigator","userAgent")||""},"./node_modules/core-js/internals/engine-v8-version.js":function(e,t,r){var n,o,s=r("./node_modules/core-js/internals/global.js"),i=r("./node_modules/core-js/internals/engine-user-agent.js"),a=s.process,A=s.Deno,u=a&&a.versions||A&&A.version,c=u&&u.v8;c?o=(n=c.split("."))[0]<4?1:n[0]+n[1]:i&&(!(n=i.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=i.match(/Chrome\/(\d+)/))&&(o=n[1]),e.exports=o&&+o},"./node_modules/core-js/internals/enum-bug-keys.js":function(e){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},"./node_modules/core-js/internals/export.js":function(e,t,r){var n=r("./node_modules/core-js/internals/global.js"),o=r("./node_modules/core-js/internals/object-get-own-property-descriptor.js").f,s=r("./node_modules/core-js/internals/create-non-enumerable-property.js"),i=r("./node_modules/core-js/internals/redefine.js"),a=r("./node_modules/core-js/internals/set-global.js"),A=r("./node_modules/core-js/internals/copy-constructor-properties.js"),u=r("./node_modules/core-js/internals/is-forced.js");e.exports=function(e,t){var r,c,l,d,f,h=e.target,p=e.global,m=e.stat;if(r=p?n:m?n[h]||a(h,{}):(n[h]||{}).prototype)for(c in t){if(d=t[c],l=e.noTargetGet?(f=o(r,c))&&f.value:r[c],!u(p?c:h+(m?".":"#")+c,e.forced)&&void 0!==l){if(typeof d==typeof l)continue;A(d,l)}(e.sham||l&&l.sham)&&s(d,"sham",!0),i(r,c,d,e)}}},"./node_modules/core-js/internals/fails.js":function(e){e.exports=function(e){try{return!!e()}catch(e){return!0}}},"./node_modules/core-js/internals/function-bind-context.js":function(e,t,r){var n=r("./node_modules/core-js/internals/a-function.js");e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 0:return function(){return e.call(t)};case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,o){return e.call(t,r,n,o)}}return function(){return e.apply(t,arguments)}}},"./node_modules/core-js/internals/get-built-in.js":function(e,t,r){var n=r("./node_modules/core-js/internals/global.js"),o=function(e){return"function"==typeof e?e:void 0};e.exports=function(e,t){return arguments.length<2?o(n[e]):n[e]&&n[e][t]}},"./node_modules/core-js/internals/global.js":function(e){var t=function(e){return e&&e.Math==Math&&e};e.exports=t("object"==typeof globalThis&&globalThis)||t("object"==typeof window&&window)||t("object"==typeof self&&self)||t("object"==typeof global&&global)||function(){return this}()||Function("return this")()},"./node_modules/core-js/internals/has.js":function(e,t,r){var n=r("./node_modules/core-js/internals/to-object.js"),o={}.hasOwnProperty;e.exports=Object.hasOwn||function(e,t){return o.call(n(e),t)}},"./node_modules/core-js/internals/hidden-keys.js":function(e){e.exports={}},"./node_modules/core-js/internals/html.js":function(e,t,r){var n=r("./node_modules/core-js/internals/get-built-in.js");e.exports=n("document","documentElement")},"./node_modules/core-js/internals/ie8-dom-define.js":function(e,t,r){var n=r("./node_modules/core-js/internals/descriptors.js"),o=r("./node_modules/core-js/internals/fails.js"),s=r("./node_modules/core-js/internals/document-create-element.js");e.exports=!n&&!o((function(){return 7!=Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a}))},"./node_modules/core-js/internals/indexed-object.js":function(e,t,r){var n=r("./node_modules/core-js/internals/fails.js"),o=r("./node_modules/core-js/internals/classof-raw.js"),s="".split;e.exports=n((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==o(e)?s.call(e,""):Object(e)}:Object},"./node_modules/core-js/internals/inherit-if-required.js":function(e,t,r){var n=r("./node_modules/core-js/internals/is-object.js"),o=r("./node_modules/core-js/internals/object-set-prototype-of.js");e.exports=function(e,t,r){var s,i;return o&&"function"==typeof(s=t.constructor)&&s!==r&&n(i=s.prototype)&&i!==r.prototype&&o(e,i),e}},"./node_modules/core-js/internals/inspect-source.js":function(e,t,r){var n=r("./node_modules/core-js/internals/shared-store.js"),o=Function.toString;"function"!=typeof n.inspectSource&&(n.inspectSource=function(e){return o.call(e)}),e.exports=n.inspectSource},"./node_modules/core-js/internals/internal-state.js":function(e,t,r){var n,o,s,i=r("./node_modules/core-js/internals/native-weak-map.js"),a=r("./node_modules/core-js/internals/global.js"),A=r("./node_modules/core-js/internals/is-object.js"),u=r("./node_modules/core-js/internals/create-non-enumerable-property.js"),c=r("./node_modules/core-js/internals/has.js"),l=r("./node_modules/core-js/internals/shared-store.js"),d=r("./node_modules/core-js/internals/shared-key.js"),f=r("./node_modules/core-js/internals/hidden-keys.js"),h="Object already initialized",p=a.WeakMap;if(i||l.state){var m=l.state||(l.state=new p),g=m.get,y=m.has,v=m.set;n=function(e,t){if(y.call(m,e))throw new TypeError(h);return t.facade=e,v.call(m,e,t),t},o=function(e){return g.call(m,e)||{}},s=function(e){return y.call(m,e)}}else{var w=d("state");f[w]=!0,n=function(e,t){if(c(e,w))throw new TypeError(h);return t.facade=e,u(e,w,t),t},o=function(e){return c(e,w)?e[w]:{}},s=function(e){return c(e,w)}}e.exports={set:n,get:o,has:s,enforce:function(e){return s(e)?o(e):n(e,{})},getterFor:function(e){return function(t){var r;if(!A(t)||(r=o(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return r}}}},"./node_modules/core-js/internals/is-array.js":function(e,t,r){var n=r("./node_modules/core-js/internals/classof-raw.js");e.exports=Array.isArray||function(e){return"Array"==n(e)}},"./node_modules/core-js/internals/is-forced.js":function(e,t,r){var n=r("./node_modules/core-js/internals/fails.js"),o=/#|\.prototype\./,s=function(e,t){var r=a[i(e)];return r==u||r!=A&&("function"==typeof t?n(t):!!t)},i=s.normalize=function(e){return String(e).replace(o,".").toLowerCase()},a=s.data={},A=s.NATIVE="N",u=s.POLYFILL="P";e.exports=s},"./node_modules/core-js/internals/is-object.js":function(e){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},"./node_modules/core-js/internals/is-pure.js":function(e){e.exports=!1},"./node_modules/core-js/internals/is-symbol.js":function(e,t,r){var n=r("./node_modules/core-js/internals/get-built-in.js"),o=r("./node_modules/core-js/internals/use-symbol-as-uid.js");e.exports=o?function(e){return"symbol"==typeof e}:function(e){var t=n("Symbol");return"function"==typeof t&&Object(e)instanceof t}},"./node_modules/core-js/internals/iterators-core.js":function(e,t,r){"use strict";var n,o,s,i=r("./node_modules/core-js/internals/fails.js"),a=r("./node_modules/core-js/internals/object-get-prototype-of.js"),A=r("./node_modules/core-js/internals/create-non-enumerable-property.js"),u=r("./node_modules/core-js/internals/has.js"),c=r("./node_modules/core-js/internals/well-known-symbol.js"),l=r("./node_modules/core-js/internals/is-pure.js"),d=c("iterator"),f=!1;[].keys&&("next"in(s=[].keys())?(o=a(a(s)))!==Object.prototype&&(n=o):f=!0);var h=null==n||i((function(){var e={};return n[d].call(e)!==e}));h&&(n={}),l&&!h||u(n,d)||A(n,d,(function(){return this})),e.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:f}},"./node_modules/core-js/internals/iterators.js":function(e){e.exports={}},"./node_modules/core-js/internals/native-symbol.js":function(e,t,r){var n=r("./node_modules/core-js/internals/engine-v8-version.js"),o=r("./node_modules/core-js/internals/fails.js");e.exports=!!Object.getOwnPropertySymbols&&!o((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},"./node_modules/core-js/internals/native-weak-map.js":function(e,t,r){var n=r("./node_modules/core-js/internals/global.js"),o=r("./node_modules/core-js/internals/inspect-source.js"),s=n.WeakMap;e.exports="function"==typeof s&&/native code/.test(o(s))},"./node_modules/core-js/internals/object-assign.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/internals/descriptors.js"),o=r("./node_modules/core-js/internals/fails.js"),s=r("./node_modules/core-js/internals/object-keys.js"),i=r("./node_modules/core-js/internals/object-get-own-property-symbols.js"),a=r("./node_modules/core-js/internals/object-property-is-enumerable.js"),A=r("./node_modules/core-js/internals/to-object.js"),u=r("./node_modules/core-js/internals/indexed-object.js"),c=Object.assign,l=Object.defineProperty;e.exports=!c||o((function(){if(n&&1!==c({b:1},c(l({},"a",{enumerable:!0,get:function(){l(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol(),o="abcdefghijklmnopqrst";return e[r]=7,o.split("").forEach((function(e){t[e]=e})),7!=c({},e)[r]||s(c({},t)).join("")!=o}))?function(e,t){for(var r=A(e),o=arguments.length,c=1,l=i.f,d=a.f;o>c;)for(var f,h=u(arguments[c++]),p=l?s(h).concat(l(h)):s(h),m=p.length,g=0;m>g;)f=p[g++],n&&!d.call(h,f)||(r[f]=h[f]);return r}:c},"./node_modules/core-js/internals/object-create.js":function(e,t,r){var n,o=r("./node_modules/core-js/internals/an-object.js"),s=r("./node_modules/core-js/internals/object-define-properties.js"),i=r("./node_modules/core-js/internals/enum-bug-keys.js"),a=r("./node_modules/core-js/internals/hidden-keys.js"),A=r("./node_modules/core-js/internals/html.js"),u=r("./node_modules/core-js/internals/document-create-element.js"),c=r("./node_modules/core-js/internals/shared-key.js")("IE_PROTO"),l=function(){},d=function(e){return"<script>"+e+"<\/script>"},f=function(e){e.write(d("")),e.close();var t=e.parentWindow.Object;return e=null,t},h=function(){try{n=new ActiveXObject("htmlfile")}catch(e){}h=document.domain&&n?f(n):function(){var e,t=u("iframe");if(t.style)return t.style.display="none",A.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(d("document.F=Object")),e.close(),e.F}()||f(n);for(var e=i.length;e--;)delete h.prototype[i[e]];return h()};a[c]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(l.prototype=o(e),r=new l,l.prototype=null,r[c]=e):r=h(),void 0===t?r:s(r,t)}},"./node_modules/core-js/internals/object-define-properties.js":function(e,t,r){var n=r("./node_modules/core-js/internals/descriptors.js"),o=r("./node_modules/core-js/internals/object-define-property.js"),s=r("./node_modules/core-js/internals/an-object.js"),i=r("./node_modules/core-js/internals/object-keys.js");e.exports=n?Object.defineProperties:function(e,t){s(e);for(var r,n=i(t),a=n.length,A=0;a>A;)o.f(e,r=n[A++],t[r]);return e}},"./node_modules/core-js/internals/object-define-property.js":function(e,t,r){var n=r("./node_modules/core-js/internals/descriptors.js"),o=r("./node_modules/core-js/internals/ie8-dom-define.js"),s=r("./node_modules/core-js/internals/an-object.js"),i=r("./node_modules/core-js/internals/to-property-key.js"),a=Object.defineProperty;t.f=n?a:function(e,t,r){if(s(e),t=i(t),s(r),o)try{return a(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},"./node_modules/core-js/internals/object-get-own-property-descriptor.js":function(e,t,r){var n=r("./node_modules/core-js/internals/descriptors.js"),o=r("./node_modules/core-js/internals/object-property-is-enumerable.js"),s=r("./node_modules/core-js/internals/create-property-descriptor.js"),i=r("./node_modules/core-js/internals/to-indexed-object.js"),a=r("./node_modules/core-js/internals/to-property-key.js"),A=r("./node_modules/core-js/internals/has.js"),u=r("./node_modules/core-js/internals/ie8-dom-define.js"),c=Object.getOwnPropertyDescriptor;t.f=n?c:function(e,t){if(e=i(e),t=a(t),u)try{return c(e,t)}catch(e){}if(A(e,t))return s(!o.f.call(e,t),e[t])}},"./node_modules/core-js/internals/object-get-own-property-names-external.js":function(e,t,r){var n=r("./node_modules/core-js/internals/to-indexed-object.js"),o=r("./node_modules/core-js/internals/object-get-own-property-names.js").f,s={}.toString,i="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return i&&"[object Window]"==s.call(e)?function(e){try{return o(e)}catch(e){return i.slice()}}(e):o(n(e))}},"./node_modules/core-js/internals/object-get-own-property-names.js":function(e,t,r){var n=r("./node_modules/core-js/internals/object-keys-internal.js"),o=r("./node_modules/core-js/internals/enum-bug-keys.js").concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,o)}},"./node_modules/core-js/internals/object-get-own-property-symbols.js":function(e,t){t.f=Object.getOwnPropertySymbols},"./node_modules/core-js/internals/object-get-prototype-of.js":function(e,t,r){var n=r("./node_modules/core-js/internals/has.js"),o=r("./node_modules/core-js/internals/to-object.js"),s=r("./node_modules/core-js/internals/shared-key.js"),i=r("./node_modules/core-js/internals/correct-prototype-getter.js"),a=s("IE_PROTO"),A=Object.prototype;e.exports=i?Object.getPrototypeOf:function(e){return e=o(e),n(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?A:null}},"./node_modules/core-js/internals/object-keys-internal.js":function(e,t,r){var n=r("./node_modules/core-js/internals/has.js"),o=r("./node_modules/core-js/internals/to-indexed-object.js"),s=r("./node_modules/core-js/internals/array-includes.js").indexOf,i=r("./node_modules/core-js/internals/hidden-keys.js");e.exports=function(e,t){var r,a=o(e),A=0,u=[];for(r in a)!n(i,r)&&n(a,r)&&u.push(r);for(;t.length>A;)n(a,r=t[A++])&&(~s(u,r)||u.push(r));return u}},"./node_modules/core-js/internals/object-keys.js":function(e,t,r){var n=r("./node_modules/core-js/internals/object-keys-internal.js"),o=r("./node_modules/core-js/internals/enum-bug-keys.js");e.exports=Object.keys||function(e){return n(e,o)}},"./node_modules/core-js/internals/object-property-is-enumerable.js":function(e,t){"use strict";var r={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,o=n&&!r.call({1:2},1);t.f=o?function(e){var t=n(this,e);return!!t&&t.enumerable}:r},"./node_modules/core-js/internals/object-set-prototype-of.js":function(e,t,r){var n=r("./node_modules/core-js/internals/an-object.js"),o=r("./node_modules/core-js/internals/a-possible-prototype.js");e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(r,[]),t=r instanceof Array}catch(e){}return function(r,s){return n(r),o(s),t?e.call(r,s):r.__proto__=s,r}}():void 0)},"./node_modules/core-js/internals/object-to-string.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/internals/to-string-tag-support.js"),o=r("./node_modules/core-js/internals/classof.js");e.exports=n?{}.toString:function(){return"[object "+o(this)+"]"}},"./node_modules/core-js/internals/ordinary-to-primitive.js":function(e,t,r){var n=r("./node_modules/core-js/internals/is-object.js");e.exports=function(e,t){var r,o;if("string"===t&&"function"==typeof(r=e.toString)&&!n(o=r.call(e)))return o;if("function"==typeof(r=e.valueOf)&&!n(o=r.call(e)))return o;if("string"!==t&&"function"==typeof(r=e.toString)&&!n(o=r.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},"./node_modules/core-js/internals/own-keys.js":function(e,t,r){var n=r("./node_modules/core-js/internals/get-built-in.js"),o=r("./node_modules/core-js/internals/object-get-own-property-names.js"),s=r("./node_modules/core-js/internals/object-get-own-property-symbols.js"),i=r("./node_modules/core-js/internals/an-object.js");e.exports=n("Reflect","ownKeys")||function(e){var t=o.f(i(e)),r=s.f;return r?t.concat(r(e)):t}},"./node_modules/core-js/internals/path.js":function(e,t,r){var n=r("./node_modules/core-js/internals/global.js");e.exports=n},"./node_modules/core-js/internals/redefine.js":function(e,t,r){var n=r("./node_modules/core-js/internals/global.js"),o=r("./node_modules/core-js/internals/create-non-enumerable-property.js"),s=r("./node_modules/core-js/internals/has.js"),i=r("./node_modules/core-js/internals/set-global.js"),a=r("./node_modules/core-js/internals/inspect-source.js"),A=r("./node_modules/core-js/internals/internal-state.js"),u=A.get,c=A.enforce,l=String(String).split("String");(e.exports=function(e,t,r,a){var A,u=!!a&&!!a.unsafe,d=!!a&&!!a.enumerable,f=!!a&&!!a.noTargetGet;"function"==typeof r&&("string"!=typeof t||s(r,"name")||o(r,"name",t),(A=c(r)).source||(A.source=l.join("string"==typeof t?t:""))),e!==n?(u?!f&&e[t]&&(d=!0):delete e[t],d?e[t]=r:o(e,t,r)):d?e[t]=r:i(t,r)})(Function.prototype,"toString",(function(){return"function"==typeof this&&u(this).source||a(this)}))},"./node_modules/core-js/internals/regexp-flags.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/internals/an-object.js");e.exports=function(){var e=n(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},"./node_modules/core-js/internals/require-object-coercible.js":function(e){e.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},"./node_modules/core-js/internals/set-global.js":function(e,t,r){var n=r("./node_modules/core-js/internals/global.js");e.exports=function(e,t){try{Object.defineProperty(n,e,{value:t,configurable:!0,writable:!0})}catch(r){n[e]=t}return t}},"./node_modules/core-js/internals/set-to-string-tag.js":function(e,t,r){var n=r("./node_modules/core-js/internals/object-define-property.js").f,o=r("./node_modules/core-js/internals/has.js"),s=r("./node_modules/core-js/internals/well-known-symbol.js")("toStringTag");e.exports=function(e,t,r){e&&!o(e=r?e:e.prototype,s)&&n(e,s,{configurable:!0,value:t})}},"./node_modules/core-js/internals/shared-key.js":function(e,t,r){var n=r("./node_modules/core-js/internals/shared.js"),o=r("./node_modules/core-js/internals/uid.js"),s=n("keys");e.exports=function(e){return s[e]||(s[e]=o(e))}},"./node_modules/core-js/internals/shared-store.js":function(e,t,r){var n=r("./node_modules/core-js/internals/global.js"),o=r("./node_modules/core-js/internals/set-global.js"),s="__core-js_shared__",i=n[s]||o(s,{});e.exports=i},"./node_modules/core-js/internals/shared.js":function(e,t,r){var n=r("./node_modules/core-js/internals/is-pure.js"),o=r("./node_modules/core-js/internals/shared-store.js");(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.16.0",mode:n?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})},"./node_modules/core-js/internals/string-html-forced.js":function(e,t,r){var n=r("./node_modules/core-js/internals/fails.js");e.exports=function(e){return n((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))}},"./node_modules/core-js/internals/string-multibyte.js":function(e,t,r){var n=r("./node_modules/core-js/internals/to-integer.js"),o=r("./node_modules/core-js/internals/to-string.js"),s=r("./node_modules/core-js/internals/require-object-coercible.js"),i=function(e){return function(t,r){var i,a,A=o(s(t)),u=n(r),c=A.length;return u<0||u>=c?e?"":void 0:(i=A.charCodeAt(u))<55296||i>56319||u+1===c||(a=A.charCodeAt(u+1))<56320||a>57343?e?A.charAt(u):i:e?A.slice(u,u+2):a-56320+(i-55296<<10)+65536}};e.exports={codeAt:i(!1),charAt:i(!0)}},"./node_modules/core-js/internals/string-trim.js":function(e,t,r){var n=r("./node_modules/core-js/internals/require-object-coercible.js"),o=r("./node_modules/core-js/internals/to-string.js"),s="["+r("./node_modules/core-js/internals/whitespaces.js")+"]",i=RegExp("^"+s+s+"*"),a=RegExp(s+s+"*$"),A=function(e){return function(t){var r=o(n(t));return 1&e&&(r=r.replace(i,"")),2&e&&(r=r.replace(a,"")),r}};e.exports={start:A(1),end:A(2),trim:A(3)}},"./node_modules/core-js/internals/to-absolute-index.js":function(e,t,r){var n=r("./node_modules/core-js/internals/to-integer.js"),o=Math.max,s=Math.min;e.exports=function(e,t){var r=n(e);return r<0?o(r+t,0):s(r,t)}},"./node_modules/core-js/internals/to-indexed-object.js":function(e,t,r){var n=r("./node_modules/core-js/internals/indexed-object.js"),o=r("./node_modules/core-js/internals/require-object-coercible.js");e.exports=function(e){return n(o(e))}},"./node_modules/core-js/internals/to-integer.js":function(e){var t=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:t)(e)}},"./node_modules/core-js/internals/to-length.js":function(e,t,r){var n=r("./node_modules/core-js/internals/to-integer.js"),o=Math.min;e.exports=function(e){return e>0?o(n(e),9007199254740991):0}},"./node_modules/core-js/internals/to-object.js":function(e,t,r){var n=r("./node_modules/core-js/internals/require-object-coercible.js");e.exports=function(e){return Object(n(e))}},"./node_modules/core-js/internals/to-primitive.js":function(e,t,r){var n=r("./node_modules/core-js/internals/is-object.js"),o=r("./node_modules/core-js/internals/is-symbol.js"),s=r("./node_modules/core-js/internals/ordinary-to-primitive.js"),i=r("./node_modules/core-js/internals/well-known-symbol.js")("toPrimitive");e.exports=function(e,t){if(!n(e)||o(e))return e;var r,a=e[i];if(void 0!==a){if(void 0===t&&(t="default"),r=a.call(e,t),!n(r)||o(r))return r;throw TypeError("Can't convert object to primitive value")}return void 0===t&&(t="number"),s(e,t)}},"./node_modules/core-js/internals/to-property-key.js":function(e,t,r){var n=r("./node_modules/core-js/internals/to-primitive.js"),o=r("./node_modules/core-js/internals/is-symbol.js");e.exports=function(e){var t=n(e,"string");return o(t)?t:String(t)}},"./node_modules/core-js/internals/to-string-tag-support.js":function(e,t,r){var n={};n[r("./node_modules/core-js/internals/well-known-symbol.js")("toStringTag")]="z",e.exports="[object z]"===String(n)},"./node_modules/core-js/internals/to-string.js":function(e,t,r){var n=r("./node_modules/core-js/internals/is-symbol.js");e.exports=function(e){if(n(e))throw TypeError("Cannot convert a Symbol value to a string");return String(e)}},"./node_modules/core-js/internals/uid.js":function(e){var t=0,r=Math.random();e.exports=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++t+r).toString(36)}},"./node_modules/core-js/internals/use-symbol-as-uid.js":function(e,t,r){var n=r("./node_modules/core-js/internals/native-symbol.js");e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},"./node_modules/core-js/internals/well-known-symbol-wrapped.js":function(e,t,r){var n=r("./node_modules/core-js/internals/well-known-symbol.js");t.f=n},"./node_modules/core-js/internals/well-known-symbol.js":function(e,t,r){var n=r("./node_modules/core-js/internals/global.js"),o=r("./node_modules/core-js/internals/shared.js"),s=r("./node_modules/core-js/internals/has.js"),i=r("./node_modules/core-js/internals/uid.js"),a=r("./node_modules/core-js/internals/native-symbol.js"),A=r("./node_modules/core-js/internals/use-symbol-as-uid.js"),u=o("wks"),c=n.Symbol,l=A?c:c&&c.withoutSetter||i;e.exports=function(e){return s(u,e)&&(a||"string"==typeof u[e])||(a&&s(c,e)?u[e]=c[e]:u[e]=l("Symbol."+e)),u[e]}},"./node_modules/core-js/internals/whitespaces.js":function(e){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"./node_modules/core-js/modules/es.array.concat.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/internals/export.js"),o=r("./node_modules/core-js/internals/fails.js"),s=r("./node_modules/core-js/internals/is-array.js"),i=r("./node_modules/core-js/internals/is-object.js"),a=r("./node_modules/core-js/internals/to-object.js"),A=r("./node_modules/core-js/internals/to-length.js"),u=r("./node_modules/core-js/internals/create-property.js"),c=r("./node_modules/core-js/internals/array-species-create.js"),l=r("./node_modules/core-js/internals/array-method-has-species-support.js"),d=r("./node_modules/core-js/internals/well-known-symbol.js"),f=r("./node_modules/core-js/internals/engine-v8-version.js"),h=d("isConcatSpreadable"),p=9007199254740991,m="Maximum allowed index exceeded",g=f>=51||!o((function(){var e=[];return e[h]=!1,e.concat()[0]!==e})),y=l("concat"),v=function(e){if(!i(e))return!1;var t=e[h];return void 0!==t?!!t:s(e)};n({target:"Array",proto:!0,forced:!g||!y},{concat:function(e){var t,r,n,o,s,i=a(this),l=c(i,0),d=0;for(t=-1,n=arguments.length;t<n;t++)if(v(s=-1===t?i:arguments[t])){if(d+(o=A(s.length))>p)throw TypeError(m);for(r=0;r<o;r++,d++)r in s&&u(l,d,s[r])}else{if(d>=p)throw TypeError(m);u(l,d++,s)}return l.length=d,l}})},"./node_modules/core-js/modules/es.array.iterator.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/internals/to-indexed-object.js"),o=r("./node_modules/core-js/internals/add-to-unscopables.js"),s=r("./node_modules/core-js/internals/iterators.js"),i=r("./node_modules/core-js/internals/internal-state.js"),a=r("./node_modules/core-js/internals/define-iterator.js"),A="Array Iterator",u=i.set,c=i.getterFor(A);e.exports=a(Array,"Array",(function(e,t){u(this,{type:A,target:n(e),index:0,kind:t})}),(function(){var e=c(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:t[n],done:!1}:{value:[n,t[n]],done:!1}}),"values"),s.Arguments=s.Array,o("keys"),o("values"),o("entries")},"./node_modules/core-js/modules/es.array.join.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/internals/export.js"),o=r("./node_modules/core-js/internals/indexed-object.js"),s=r("./node_modules/core-js/internals/to-indexed-object.js"),i=r("./node_modules/core-js/internals/array-method-is-strict.js"),a=[].join,A=o!=Object,u=i("join",",");n({target:"Array",proto:!0,forced:A||!u},{join:function(e){return a.call(s(this),void 0===e?",":e)}})},"./node_modules/core-js/modules/es.array.map.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/internals/export.js"),o=r("./node_modules/core-js/internals/array-iteration.js").map;n({target:"Array",proto:!0,forced:!r("./node_modules/core-js/internals/array-method-has-species-support.js")("map")},{map:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},"./node_modules/core-js/modules/es.array.slice.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/internals/export.js"),o=r("./node_modules/core-js/internals/is-object.js"),s=r("./node_modules/core-js/internals/is-array.js"),i=r("./node_modules/core-js/internals/to-absolute-index.js"),a=r("./node_modules/core-js/internals/to-length.js"),A=r("./node_modules/core-js/internals/to-indexed-object.js"),u=r("./node_modules/core-js/internals/create-property.js"),c=r("./node_modules/core-js/internals/well-known-symbol.js"),l=r("./node_modules/core-js/internals/array-method-has-species-support.js")("slice"),d=c("species"),f=[].slice,h=Math.max;n({target:"Array",proto:!0,forced:!l},{slice:function(e,t){var r,n,c,l=A(this),p=a(l.length),m=i(e,p),g=i(void 0===t?p:t,p);if(s(l)&&("function"!=typeof(r=l.constructor)||r!==Array&&!s(r.prototype)?o(r)&&null===(r=r[d])&&(r=void 0):r=void 0,r===Array||void 0===r))return f.call(l,m,g);for(n=new(void 0===r?Array:r)(h(g-m,0)),c=0;m<g;m++,c++)m in l&&u(n,c,l[m]);return n.length=c,n}})},"./node_modules/core-js/modules/es.function.name.js":function(e,t,r){var n=r("./node_modules/core-js/internals/descriptors.js"),o=r("./node_modules/core-js/internals/object-define-property.js").f,s=Function.prototype,i=s.toString,a=/^\s*function ([^ (]*)/,A="name";n&&!(A in s)&&o(s,A,{configurable:!0,get:function(){try{return i.call(this).match(a)[1]}catch(e){return""}}})},"./node_modules/core-js/modules/es.number.constructor.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/internals/descriptors.js"),o=r("./node_modules/core-js/internals/global.js"),s=r("./node_modules/core-js/internals/is-forced.js"),i=r("./node_modules/core-js/internals/redefine.js"),a=r("./node_modules/core-js/internals/has.js"),A=r("./node_modules/core-js/internals/classof-raw.js"),u=r("./node_modules/core-js/internals/inherit-if-required.js"),c=r("./node_modules/core-js/internals/is-symbol.js"),l=r("./node_modules/core-js/internals/to-primitive.js"),d=r("./node_modules/core-js/internals/fails.js"),f=r("./node_modules/core-js/internals/object-create.js"),h=r("./node_modules/core-js/internals/object-get-own-property-names.js").f,p=r("./node_modules/core-js/internals/object-get-own-property-descriptor.js").f,m=r("./node_modules/core-js/internals/object-define-property.js").f,g=r("./node_modules/core-js/internals/string-trim.js").trim,y="Number",v=o.Number,w=v.prototype,b=A(f(w))==y,B=function(e){if(c(e))throw TypeError("Cannot convert a Symbol value to a number");var t,r,n,o,s,i,a,A,u=l(e,"number");if("string"==typeof u&&u.length>2)if(43===(t=(u=g(u)).charCodeAt(0))||45===t){if(88===(r=u.charCodeAt(2))||120===r)return NaN}else if(48===t){switch(u.charCodeAt(1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+u}for(i=(s=u.slice(2)).length,a=0;a<i;a++)if((A=s.charCodeAt(a))<48||A>o)return NaN;return parseInt(s,n)}return+u};if(s(y,!v(" 0o1")||!v("0b1")||v("+0x1"))){for(var j,_=function(e){var t=arguments.length<1?0:e,r=this;return r instanceof _&&(b?d((function(){w.valueOf.call(r)})):A(r)!=y)?u(new v(B(t)),r,_):B(t)},C=n?h(v):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger,fromString,range".split(","),x=0;C.length>x;x++)a(v,j=C[x])&&!a(_,j)&&m(_,j,p(v,j));_.prototype=w,w.constructor=_,i(o,y,_)}},"./node_modules/core-js/modules/es.object.assign.js":function(e,t,r){var n=r("./node_modules/core-js/internals/export.js"),o=r("./node_modules/core-js/internals/object-assign.js");n({target:"Object",stat:!0,forced:Object.assign!==o},{assign:o})},"./node_modules/core-js/modules/es.object.keys.js":function(e,t,r){var n=r("./node_modules/core-js/internals/export.js"),o=r("./node_modules/core-js/internals/to-object.js"),s=r("./node_modules/core-js/internals/object-keys.js");n({target:"Object",stat:!0,forced:r("./node_modules/core-js/internals/fails.js")((function(){s(1)}))},{keys:function(e){return s(o(e))}})},"./node_modules/core-js/modules/es.object.to-string.js":function(e,t,r){var n=r("./node_modules/core-js/internals/to-string-tag-support.js"),o=r("./node_modules/core-js/internals/redefine.js"),s=r("./node_modules/core-js/internals/object-to-string.js");n||o(Object.prototype,"toString",s,{unsafe:!0})},"./node_modules/core-js/modules/es.regexp.to-string.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/internals/redefine.js"),o=r("./node_modules/core-js/internals/an-object.js"),s=r("./node_modules/core-js/internals/to-string.js"),i=r("./node_modules/core-js/internals/fails.js"),a=r("./node_modules/core-js/internals/regexp-flags.js"),A="toString",u=RegExp.prototype,c=u.toString,l=i((function(){return"/a/b"!=c.call({source:"a",flags:"b"})})),d=c.name!=A;(l||d)&&n(RegExp.prototype,A,(function(){var e=o(this),t=s(e.source),r=e.flags;return"/"+t+"/"+s(void 0===r&&e instanceof RegExp&&!("flags"in u)?a.call(e):r)}),{unsafe:!0})},"./node_modules/core-js/modules/es.string.iterator.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/internals/string-multibyte.js").charAt,o=r("./node_modules/core-js/internals/to-string.js"),s=r("./node_modules/core-js/internals/internal-state.js"),i=r("./node_modules/core-js/internals/define-iterator.js"),a="String Iterator",A=s.set,u=s.getterFor(a);i(String,"String",(function(e){A(this,{type:a,string:o(e),index:0})}),(function(){var e,t=u(this),r=t.string,o=t.index;return o>=r.length?{value:void 0,done:!0}:(e=n(r,o),t.index+=e.length,{value:e,done:!1})}))},"./node_modules/core-js/modules/es.string.link.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/internals/export.js"),o=r("./node_modules/core-js/internals/create-html.js");n({target:"String",proto:!0,forced:r("./node_modules/core-js/internals/string-html-forced.js")("link")},{link:function(e){return o(this,"a","href",e)}})},"./node_modules/core-js/modules/es.symbol.description.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/internals/export.js"),o=r("./node_modules/core-js/internals/descriptors.js"),s=r("./node_modules/core-js/internals/global.js"),i=r("./node_modules/core-js/internals/has.js"),a=r("./node_modules/core-js/internals/is-object.js"),A=r("./node_modules/core-js/internals/object-define-property.js").f,u=r("./node_modules/core-js/internals/copy-constructor-properties.js"),c=s.Symbol;if(o&&"function"==typeof c&&(!("description"in c.prototype)||void 0!==c().description)){var l={},d=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof d?new c(e):void 0===e?c():c(e);return""===e&&(l[t]=!0),t};u(d,c);var f=d.prototype=c.prototype;f.constructor=d;var h=f.toString,p="Symbol(test)"==String(c("test")),m=/^Symbol\((.*)\)[^)]+$/;A(f,"description",{configurable:!0,get:function(){var e=a(this)?this.valueOf():this,t=h.call(e);if(i(l,e))return"";var r=p?t.slice(7,-1):t.replace(m,"$1");return""===r?void 0:r}}),n({global:!0,forced:!0},{Symbol:d})}},"./node_modules/core-js/modules/es.symbol.iterator.js":function(e,t,r){r("./node_modules/core-js/internals/define-well-known-symbol.js")("iterator")},"./node_modules/core-js/modules/es.symbol.js":function(e,t,r){"use strict";var n=r("./node_modules/core-js/internals/export.js"),o=r("./node_modules/core-js/internals/global.js"),s=r("./node_modules/core-js/internals/get-built-in.js"),i=r("./node_modules/core-js/internals/is-pure.js"),a=r("./node_modules/core-js/internals/descriptors.js"),A=r("./node_modules/core-js/internals/native-symbol.js"),u=r("./node_modules/core-js/internals/fails.js"),c=r("./node_modules/core-js/internals/has.js"),l=r("./node_modules/core-js/internals/is-array.js"),d=r("./node_modules/core-js/internals/is-object.js"),f=r("./node_modules/core-js/internals/is-symbol.js"),h=r("./node_modules/core-js/internals/an-object.js"),p=r("./node_modules/core-js/internals/to-object.js"),m=r("./node_modules/core-js/internals/to-indexed-object.js"),g=r("./node_modules/core-js/internals/to-property-key.js"),y=r("./node_modules/core-js/internals/to-string.js"),v=r("./node_modules/core-js/internals/create-property-descriptor.js"),w=r("./node_modules/core-js/internals/object-create.js"),b=r("./node_modules/core-js/internals/object-keys.js"),B=r("./node_modules/core-js/internals/object-get-own-property-names.js"),j=r("./node_modules/core-js/internals/object-get-own-property-names-external.js"),_=r("./node_modules/core-js/internals/object-get-own-property-symbols.js"),C=r("./node_modules/core-js/internals/object-get-own-property-descriptor.js"),x=r("./node_modules/core-js/internals/object-define-property.js"),E=r("./node_modules/core-js/internals/object-property-is-enumerable.js"),N=r("./node_modules/core-js/internals/create-non-enumerable-property.js"),Q=r("./node_modules/core-js/internals/redefine.js"),F=r("./node_modules/core-js/internals/shared.js"),U=r("./node_modules/core-js/internals/shared-key.js"),S=r("./node_modules/core-js/internals/hidden-keys.js"),L=r("./node_modules/core-js/internals/uid.js"),T=r("./node_modules/core-js/internals/well-known-symbol.js"),H=r("./node_modules/core-js/internals/well-known-symbol-wrapped.js"),I=r("./node_modules/core-js/internals/define-well-known-symbol.js"),P=r("./node_modules/core-js/internals/set-to-string-tag.js"),O=r("./node_modules/core-js/internals/internal-state.js"),k=r("./node_modules/core-js/internals/array-iteration.js").forEach,R=U("hidden"),M="Symbol",D=T("toPrimitive"),K=O.set,z=O.getterFor(M),V=Object.prototype,q=o.Symbol,G=s("JSON","stringify"),X=C.f,W=x.f,J=j.f,Y=E.f,Z=F("symbols"),$=F("op-symbols"),ee=F("string-to-symbol-registry"),te=F("symbol-to-string-registry"),re=F("wks"),ne=o.QObject,oe=!ne||!ne.prototype||!ne.prototype.findChild,se=a&&u((function(){return 7!=w(W({},"a",{get:function(){return W(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=X(V,t);n&&delete V[t],W(e,t,r),n&&e!==V&&W(V,t,n)}:W,ie=function(e,t){var r=Z[e]=w(q.prototype);return K(r,{type:M,tag:e,description:t}),a||(r.description=t),r},ae=function(e,t,r){e===V&&ae($,t,r),h(e);var n=g(t);return h(r),c(Z,n)?(r.enumerable?(c(e,R)&&e[R][n]&&(e[R][n]=!1),r=w(r,{enumerable:v(0,!1)})):(c(e,R)||W(e,R,v(1,{})),e[R][n]=!0),se(e,n,r)):W(e,n,r)},Ae=function(e,t){h(e);var r=m(t),n=b(r).concat(de(r));return k(n,(function(t){a&&!ue.call(r,t)||ae(e,t,r[t])})),e},ue=function(e){var t=g(e),r=Y.call(this,t);return!(this===V&&c(Z,t)&&!c($,t))&&(!(r||!c(this,t)||!c(Z,t)||c(this,R)&&this[R][t])||r)},ce=function(e,t){var r=m(e),n=g(t);if(r!==V||!c(Z,n)||c($,n)){var o=X(r,n);return!o||!c(Z,n)||c(r,R)&&r[R][n]||(o.enumerable=!0),o}},le=function(e){var t=J(m(e)),r=[];return k(t,(function(e){c(Z,e)||c(S,e)||r.push(e)})),r},de=function(e){var t=e===V,r=J(t?$:m(e)),n=[];return k(r,(function(e){!c(Z,e)||t&&!c(V,e)||n.push(Z[e])})),n};A||(Q((q=function(){if(this instanceof q)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?y(arguments[0]):void 0,t=L(e),r=function(e){this===V&&r.call($,e),c(this,R)&&c(this[R],t)&&(this[R][t]=!1),se(this,t,v(1,e))};return a&&oe&&se(V,t,{configurable:!0,set:r}),ie(t,e)}).prototype,"toString",(function(){return z(this).tag})),Q(q,"withoutSetter",(function(e){return ie(L(e),e)})),E.f=ue,x.f=ae,C.f=ce,B.f=j.f=le,_.f=de,H.f=function(e){return ie(T(e),e)},a&&(W(q.prototype,"description",{configurable:!0,get:function(){return z(this).description}}),i||Q(V,"propertyIsEnumerable",ue,{unsafe:!0}))),n({global:!0,wrap:!0,forced:!A,sham:!A},{Symbol:q}),k(b(re),(function(e){I(e)})),n({target:M,stat:!0,forced:!A},{for:function(e){var t=y(e);if(c(ee,t))return ee[t];var r=q(t);return ee[t]=r,te[r]=t,r},keyFor:function(e){if(!f(e))throw TypeError(e+" is not a symbol");if(c(te,e))return te[e]},useSetter:function(){oe=!0},useSimple:function(){oe=!1}}),n({target:"Object",stat:!0,forced:!A,sham:!a},{create:function(e,t){return void 0===t?w(e):Ae(w(e),t)},defineProperty:ae,defineProperties:Ae,getOwnPropertyDescriptor:ce}),n({target:"Object",stat:!0,forced:!A},{getOwnPropertyNames:le,getOwnPropertySymbols:de}),n({target:"Object",stat:!0,forced:u((function(){_.f(1)}))},{getOwnPropertySymbols:function(e){return _.f(p(e))}}),G&&n({target:"JSON",stat:!0,forced:!A||u((function(){var e=q();return"[null]"!=G([e])||"{}"!=G({a:e})||"{}"!=G(Object(e))}))},{stringify:function(e,t,r){for(var n,o=[e],s=1;arguments.length>s;)o.push(arguments[s++]);if(n=t,(d(t)||void 0!==e)&&!f(e))return l(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!f(t))return t}),o[1]=t,G.apply(null,o)}}),q.prototype[D]||N(q.prototype,D,q.prototype.valueOf),P(q,M),S[R]=!0},"./node_modules/core-js/modules/web.dom-collections.for-each.js":function(e,t,r){var n=r("./node_modules/core-js/internals/global.js"),o=r("./node_modules/core-js/internals/dom-iterables.js"),s=r("./node_modules/core-js/internals/array-for-each.js"),i=r("./node_modules/core-js/internals/create-non-enumerable-property.js");for(var a in o){var A=n[a],u=A&&A.prototype;if(u&&u.forEach!==s)try{i(u,"forEach",s)}catch(e){u.forEach=s}}},"./node_modules/core-js/modules/web.dom-collections.iterator.js":function(e,t,r){var n=r("./node_modules/core-js/internals/global.js"),o=r("./node_modules/core-js/internals/dom-iterables.js"),s=r("./node_modules/core-js/modules/es.array.iterator.js"),i=r("./node_modules/core-js/internals/create-non-enumerable-property.js"),a=r("./node_modules/core-js/internals/well-known-symbol.js"),A=a("iterator"),u=a("toStringTag"),c=s.values;for(var l in o){var d=n[l],f=d&&d.prototype;if(f){if(f[A]!==c)try{i(f,A,c)}catch(e){f[A]=c}if(f[u]||i(f,u,l),o[l])for(var h in s)if(f[h]!==s[h])try{i(f,h,s[h])}catch(e){f[h]=s[h]}}}},"./node_modules/dompurify/dist/purify.js":function(e){e.exports=function(){"use strict";var e=Object.hasOwnProperty,t=Object.setPrototypeOf,r=Object.isFrozen,n=Object.getPrototypeOf,o=Object.getOwnPropertyDescriptor,s=Object.freeze,i=Object.seal,a=Object.create,A="undefined"!=typeof Reflect&&Reflect,u=A.apply,c=A.construct;u||(u=function(e,t,r){return e.apply(t,r)}),s||(s=function(e){return e}),i||(i=function(e){return e}),c||(c=function(e,t){return new(Function.prototype.bind.apply(e,[null].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(t))))});var l,d=B(Array.prototype.forEach),f=B(Array.prototype.pop),h=B(Array.prototype.push),p=B(String.prototype.toLowerCase),m=B(String.prototype.match),g=B(String.prototype.replace),y=B(String.prototype.indexOf),v=B(String.prototype.trim),w=B(RegExp.prototype.test),b=(l=TypeError,function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return c(l,t)});function B(e){return function(t){for(var r=arguments.length,n=Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return u(e,t,n)}}function j(e,n){t&&t(e,null);for(var o=n.length;o--;){var s=n[o];if("string"==typeof s){var i=p(s);i!==s&&(r(n)||(n[o]=i),s=i)}e[s]=!0}return e}function _(t){var r=a(null),n=void 0;for(n in t)u(e,t,[n])&&(r[n]=t[n]);return r}function C(e,t){for(;null!==e;){var r=o(e,t);if(r){if(r.get)return B(r.get);if("function"==typeof r.value)return B(r.value)}e=n(e)}return function(e){return console.warn("fallback value for",e),null}}var x=s(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),E=s(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),N=s(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Q=s(["animate","color-profile","cursor","discard","fedropshadow","feimage","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),F=s(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),U=s(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),S=s(["#text"]),L=s(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),T=s(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),H=s(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),I=s(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),P=i(/\{\{[\s\S]*|[\s\S]*\}\}/gm),O=i(/<%[\s\S]*|[\s\S]*%>/gm),k=i(/^data-[\-\w.\u00B7-\uFFFF]/),R=i(/^aria-[\-\w]+$/),M=i(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),D=i(/^(?:\w+script|data):/i),K=i(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function V(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var q=function(){return"undefined"==typeof window?null:window},G=function(e,t){if("object"!==(void 0===e?"undefined":z(e))||"function"!=typeof e.createPolicy)return null;var r=null,n="data-tt-policy-suffix";t.currentScript&&t.currentScript.hasAttribute(n)&&(r=t.currentScript.getAttribute(n));var o="dompurify"+(r?"#"+r:"");try{return e.createPolicy(o,{createHTML:function(e){return e}})}catch(e){return console.warn("TrustedTypes policy "+o+" could not be created."),null}};return function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q(),r=function(t){return e(t)};if(r.version="2.3.0",r.removed=[],!t||!t.document||9!==t.document.nodeType)return r.isSupported=!1,r;var n=t.document,o=t.document,i=t.DocumentFragment,a=t.HTMLTemplateElement,A=t.Node,u=t.Element,c=t.NodeFilter,l=t.NamedNodeMap,B=void 0===l?t.NamedNodeMap||t.MozNamedAttrMap:l,X=t.Text,W=t.Comment,J=t.DOMParser,Y=t.trustedTypes,Z=u.prototype,$=C(Z,"cloneNode"),ee=C(Z,"nextSibling"),te=C(Z,"childNodes"),re=C(Z,"parentNode");if("function"==typeof a){var ne=o.createElement("template");ne.content&&ne.content.ownerDocument&&(o=ne.content.ownerDocument)}var oe=G(Y,n),se=oe&&Pe?oe.createHTML(""):"",ie=o,ae=ie.implementation,Ae=ie.createNodeIterator,ue=ie.createDocumentFragment,ce=ie.getElementsByTagName,le=n.importNode,de={};try{de=_(o).documentMode?o.documentMode:{}}catch(e){}var fe={};r.isSupported="function"==typeof re&&ae&&void 0!==ae.createHTMLDocument&&9!==de;var he=P,pe=O,me=k,ge=R,ye=D,ve=K,we=M,be=null,Be=j({},[].concat(V(x),V(E),V(N),V(F),V(S))),je=null,_e=j({},[].concat(V(L),V(T),V(H),V(I))),Ce=null,xe=null,Ee=!0,Ne=!0,Qe=!1,Fe=!1,Ue=!1,Se=!1,Le=!1,Te=!1,He=!1,Ie=!0,Pe=!1,Oe=!0,ke=!0,Re=!1,Me={},De=j({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),Ke=null,ze=j({},["audio","video","img","source","image","track"]),Ve=null,qe=j({},["alt","class","for","id","label","name","pattern","placeholder","summary","title","value","style","xmlns"]),Ge="http://www.w3.org/1998/Math/MathML",Xe="http://www.w3.org/2000/svg",We="http://www.w3.org/1999/xhtml",Je=We,Ye=!1,Ze=null,$e=o.createElement("form"),et=function(e){Ze&&Ze===e||(e&&"object"===(void 0===e?"undefined":z(e))||(e={}),e=_(e),be="ALLOWED_TAGS"in e?j({},e.ALLOWED_TAGS):Be,je="ALLOWED_ATTR"in e?j({},e.ALLOWED_ATTR):_e,Ve="ADD_URI_SAFE_ATTR"in e?j(_(qe),e.ADD_URI_SAFE_ATTR):qe,Ke="ADD_DATA_URI_TAGS"in e?j(_(ze),e.ADD_DATA_URI_TAGS):ze,Ce="FORBID_TAGS"in e?j({},e.FORBID_TAGS):{},xe="FORBID_ATTR"in e?j({},e.FORBID_ATTR):{},Me="USE_PROFILES"in e&&e.USE_PROFILES,Ee=!1!==e.ALLOW_ARIA_ATTR,Ne=!1!==e.ALLOW_DATA_ATTR,Qe=e.ALLOW_UNKNOWN_PROTOCOLS||!1,Fe=e.SAFE_FOR_TEMPLATES||!1,Ue=e.WHOLE_DOCUMENT||!1,Te=e.RETURN_DOM||!1,He=e.RETURN_DOM_FRAGMENT||!1,Ie=!1!==e.RETURN_DOM_IMPORT,Pe=e.RETURN_TRUSTED_TYPE||!1,Le=e.FORCE_BODY||!1,Oe=!1!==e.SANITIZE_DOM,ke=!1!==e.KEEP_CONTENT,Re=e.IN_PLACE||!1,we=e.ALLOWED_URI_REGEXP||we,Je=e.NAMESPACE||We,Fe&&(Ne=!1),He&&(Te=!0),Me&&(be=j({},[].concat(V(S))),je=[],!0===Me.html&&(j(be,x),j(je,L)),!0===Me.svg&&(j(be,E),j(je,T),j(je,I)),!0===Me.svgFilters&&(j(be,N),j(je,T),j(je,I)),!0===Me.mathMl&&(j(be,F),j(je,H),j(je,I))),e.ADD_TAGS&&(be===Be&&(be=_(be)),j(be,e.ADD_TAGS)),e.ADD_ATTR&&(je===_e&&(je=_(je)),j(je,e.ADD_ATTR)),e.ADD_URI_SAFE_ATTR&&j(Ve,e.ADD_URI_SAFE_ATTR),ke&&(be["#text"]=!0),Ue&&j(be,["html","head","body"]),be.table&&(j(be,["tbody"]),delete Ce.tbody),s&&s(e),Ze=e)},tt=j({},["mi","mo","mn","ms","mtext"]),rt=j({},["foreignobject","desc","title","annotation-xml"]),nt=j({},E);j(nt,N),j(nt,Q);var ot=j({},F);j(ot,U);var st=function(e){var t=re(e);t&&t.tagName||(t={namespaceURI:We,tagName:"template"});var r=p(e.tagName),n=p(t.tagName);if(e.namespaceURI===Xe)return t.namespaceURI===We?"svg"===r:t.namespaceURI===Ge?"svg"===r&&("annotation-xml"===n||tt[n]):Boolean(nt[r]);if(e.namespaceURI===Ge)return t.namespaceURI===We?"math"===r:t.namespaceURI===Xe?"math"===r&&rt[n]:Boolean(ot[r]);if(e.namespaceURI===We){if(t.namespaceURI===Xe&&!rt[n])return!1;if(t.namespaceURI===Ge&&!tt[n])return!1;var o=j({},["title","style","font","a","script"]);return!ot[r]&&(o[r]||!nt[r])}return!1},it=function(e){h(r.removed,{element:e});try{e.parentNode.removeChild(e)}catch(t){try{e.outerHTML=se}catch(t){e.remove()}}},at=function(e,t){try{h(r.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){h(r.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e&&!je[e])if(Te||He)try{it(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}},At=function(e){var t=void 0,r=void 0;if(Le)e="<remove></remove>"+e;else{var n=m(e,/^[\r\n\t ]+/);r=n&&n[0]}var s=oe?oe.createHTML(e):e;if(Je===We)try{t=(new J).parseFromString(s,"text/html")}catch(e){}if(!t||!t.documentElement){t=ae.createDocument(Je,"template",null);try{t.documentElement.innerHTML=Ye?"":s}catch(e){}}var i=t.body||t.documentElement;return e&&r&&i.insertBefore(o.createTextNode(r),i.childNodes[0]||null),Je===We?ce.call(t,Ue?"html":"body")[0]:Ue?t.documentElement:i},ut=function(e){return Ae.call(e.ownerDocument||e,e,c.SHOW_ELEMENT|c.SHOW_COMMENT|c.SHOW_TEXT,null,!1)},ct=function(e){return!(e instanceof X||e instanceof W||"string"==typeof e.nodeName&&"string"==typeof e.textContent&&"function"==typeof e.removeChild&&e.attributes instanceof B&&"function"==typeof e.removeAttribute&&"function"==typeof e.setAttribute&&"string"==typeof e.namespaceURI&&"function"==typeof e.insertBefore)},lt=function(e){return"object"===(void 0===A?"undefined":z(A))?e instanceof A:e&&"object"===(void 0===e?"undefined":z(e))&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName},dt=function(e,t,n){fe[e]&&d(fe[e],(function(e){e.call(r,t,n,Ze)}))},ft=function(e){var t=void 0;if(dt("beforeSanitizeElements",e,null),ct(e))return it(e),!0;if(m(e.nodeName,/[\u0080-\uFFFF]/))return it(e),!0;var n=p(e.nodeName);if(dt("uponSanitizeElement",e,{tagName:n,allowedTags:be}),!lt(e.firstElementChild)&&(!lt(e.content)||!lt(e.content.firstElementChild))&&w(/<[/\w]/g,e.innerHTML)&&w(/<[/\w]/g,e.textContent))return it(e),!0;if(!be[n]||Ce[n]){if(ke&&!De[n]){var o=re(e)||e.parentNode,s=te(e)||e.childNodes;if(s&&o)for(var i=s.length-1;i>=0;--i)o.insertBefore($(s[i],!0),ee(e))}return it(e),!0}return e instanceof u&&!st(e)?(it(e),!0):"noscript"!==n&&"noembed"!==n||!w(/<\/no(script|embed)/i,e.innerHTML)?(Fe&&3===e.nodeType&&(t=e.textContent,t=g(t,he," "),t=g(t,pe," "),e.textContent!==t&&(h(r.removed,{element:e.cloneNode()}),e.textContent=t)),dt("afterSanitizeElements",e,null),!1):(it(e),!0)},ht=function(e,t,r){if(Oe&&("id"===t||"name"===t)&&(r in o||r in $e))return!1;if(Ne&&!xe[t]&&w(me,t));else if(Ee&&w(ge,t));else{if(!je[t]||xe[t])return!1;if(Ve[t]);else if(w(we,g(r,ve,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==y(r,"data:")||!Ke[e])if(Qe&&!w(ye,g(r,ve,"")));else if(r)return!1}return!0},pt=function(e){var t=void 0,n=void 0,o=void 0,s=void 0;dt("beforeSanitizeAttributes",e,null);var i=e.attributes;if(i){var a={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:je};for(s=i.length;s--;){var A=t=i[s],u=A.name,c=A.namespaceURI;if(n=v(t.value),o=p(u),a.attrName=o,a.attrValue=n,a.keepAttr=!0,a.forceKeepAttr=void 0,dt("uponSanitizeAttribute",e,a),n=a.attrValue,!a.forceKeepAttr&&(at(u,e),a.keepAttr))if(w(/\/>/i,n))at(u,e);else{Fe&&(n=g(n,he," "),n=g(n,pe," "));var l=e.nodeName.toLowerCase();if(ht(l,o,n))try{c?e.setAttributeNS(c,u,n):e.setAttribute(u,n),f(r.removed)}catch(e){}}}dt("afterSanitizeAttributes",e,null)}},mt=function e(t){var r=void 0,n=ut(t);for(dt("beforeSanitizeShadowDOM",t,null);r=n.nextNode();)dt("uponSanitizeShadowNode",r,null),ft(r)||(r.content instanceof i&&e(r.content),pt(r));dt("afterSanitizeShadowDOM",t,null)};return r.sanitize=function(e,o){var s=void 0,a=void 0,u=void 0,c=void 0,l=void 0;if((Ye=!e)&&(e="\x3c!--\x3e"),"string"!=typeof e&&!lt(e)){if("function"!=typeof e.toString)throw b("toString is not a function");if("string"!=typeof(e=e.toString()))throw b("dirty is not a string, aborting")}if(!r.isSupported){if("object"===z(t.toStaticHTML)||"function"==typeof t.toStaticHTML){if("string"==typeof e)return t.toStaticHTML(e);if(lt(e))return t.toStaticHTML(e.outerHTML)}return e}if(Se||et(o),r.removed=[],"string"==typeof e&&(Re=!1),Re);else if(e instanceof A)1===(a=(s=At("\x3c!----\x3e")).ownerDocument.importNode(e,!0)).nodeType&&"BODY"===a.nodeName||"HTML"===a.nodeName?s=a:s.appendChild(a);else{if(!Te&&!Fe&&!Ue&&-1===e.indexOf("<"))return oe&&Pe?oe.createHTML(e):e;if(!(s=At(e)))return Te?null:se}s&&Le&&it(s.firstChild);for(var d=ut(Re?e:s);u=d.nextNode();)3===u.nodeType&&u===c||ft(u)||(u.content instanceof i&&mt(u.content),pt(u),c=u);if(c=null,Re)return e;if(Te){if(He)for(l=ue.call(s.ownerDocument);s.firstChild;)l.appendChild(s.firstChild);else l=s;return Ie&&(l=le.call(n,l,!0)),l}var f=Ue?s.outerHTML:s.innerHTML;return Fe&&(f=g(f,he," "),f=g(f,pe," ")),oe&&Pe?oe.createHTML(f):f},r.setConfig=function(e){et(e),Se=!0},r.clearConfig=function(){Ze=null,Se=!1},r.isValidAttribute=function(e,t,r){Ze||et({});var n=p(e),o=p(t);return ht(n,o,r)},r.addHook=function(e,t){"function"==typeof t&&(fe[e]=fe[e]||[],h(fe[e],t))},r.removeHook=function(e){fe[e]&&f(fe[e])},r.removeHooks=function(e){fe[e]&&(fe[e]=[])},r.removeAllHooks=function(){fe={}},r}()}()},"./node_modules/es6-promise/dist/es6-promise.js":function(e){var t;t=function(){"use strict";function e(e){return"function"==typeof e}var t=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},r=0,n=void 0,o=void 0,s=function(e,t){d[r]=e,d[r+1]=t,2===(r+=2)&&(o?o(f):y())},i="undefined"!=typeof window?window:void 0,a=i||{},A=a.MutationObserver||a.WebKitMutationObserver,u="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),c="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function l(){var e=setTimeout;return function(){return e(f,1)}}var d=new Array(1e3);function f(){for(var e=0;e<r;e+=2)(0,d[e])(d[e+1]),d[e]=void 0,d[e+1]=void 0;r=0}var h,p,m,g,y=void 0;function v(e,t){var r=this,n=new this.constructor(B);void 0===n[b]&&L(n);var o=r._state;if(o){var i=arguments[o-1];s((function(){return U(o,n,i,r._result)}))}else Q(r,n,e,t);return n}function w(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(B);return C(t,e),t}u?y=function(){return process.nextTick(f)}:A?(p=0,m=new A(f),g=document.createTextNode(""),m.observe(g,{characterData:!0}),y=function(){g.data=p=++p%2}):c?((h=new MessageChannel).port1.onmessage=f,y=function(){return h.port2.postMessage(0)}):y=void 0===i?function(){try{var e=Function("return this")().require("vertx");return void 0!==(n=e.runOnLoop||e.runOnContext)?function(){n(f)}:l()}catch(e){return l()}}():l();var b=Math.random().toString(36).substring(2);function B(){}var j=void 0;function _(t,r,n){r.constructor===t.constructor&&n===v&&r.constructor.resolve===w?function(e,t){1===t._state?E(e,t._result):2===t._state?N(e,t._result):Q(t,void 0,(function(t){return C(e,t)}),(function(t){return N(e,t)}))}(t,r):void 0===n?E(t,r):e(n)?function(e,t,r){s((function(e){var n=!1,o=function(r,o,s,i){try{r.call(o,(function(r){n||(n=!0,t!==r?C(e,r):E(e,r))}),(function(t){n||(n=!0,N(e,t))}))}catch(e){return e}}(r,t,0,0,e._label);!n&&o&&(n=!0,N(e,o))}),e)}(t,r,n):E(t,r)}function C(e,t){if(e===t)N(e,new TypeError("You cannot resolve a promise with itself"));else if(o=typeof(n=t),null===n||"object"!==o&&"function"!==o)E(e,t);else{var r=void 0;try{r=t.then}catch(t){return void N(e,t)}_(e,t,r)}var n,o}function x(e){e._onerror&&e._onerror(e._result),F(e)}function E(e,t){e._state===j&&(e._result=t,e._state=1,0!==e._subscribers.length&&s(F,e))}function N(e,t){e._state===j&&(e._state=2,e._result=t,s(x,e))}function Q(e,t,r,n){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+1]=r,o[i+2]=n,0===i&&e._state&&s(F,e)}function F(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n=void 0,o=void 0,s=e._result,i=0;i<t.length;i+=3)n=t[i],o=t[i+r],n?U(r,n,o,s):o(s);e._subscribers.length=0}}function U(t,r,n,o){var s=e(n),i=void 0,a=void 0,A=!0;if(s){try{i=n(o)}catch(e){A=!1,a=e}if(r===i)return void N(r,new TypeError("A promises callback cannot return that same promise."))}else i=o;r._state!==j||(s&&A?C(r,i):!1===A?N(r,a):1===t?E(r,i):2===t&&N(r,i))}var S=0;function L(e){e[b]=S++,e._state=void 0,e._result=void 0,e._subscribers=[]}var T=function(){function e(e,r){this._instanceConstructor=e,this.promise=new e(B),this.promise[b]||L(this.promise),t(r)?(this.length=r.length,this._remaining=r.length,this._result=new Array(this.length),0===this.length?E(this.promise,this._result):(this.length=this.length||0,this._enumerate(r),0===this._remaining&&E(this.promise,this._result))):N(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===j&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,n=r.resolve;if(n===w){var o=void 0,s=void 0,i=!1;try{o=e.then}catch(e){i=!0,s=e}if(o===v&&e._state!==j)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(r===H){var a=new r(B);i?N(a,s):_(a,e,o),this._willSettleAt(a,t)}else this._willSettleAt(new r((function(t){return t(e)})),t)}else this._willSettleAt(n(e),t)},e.prototype._settledAt=function(e,t,r){var n=this.promise;n._state===j&&(this._remaining--,2===e?N(n,r):this._result[t]=r),0===this._remaining&&E(n,this._result)},e.prototype._willSettleAt=function(e,t){var r=this;Q(e,void 0,(function(e){return r._settledAt(1,t,e)}),(function(e){return r._settledAt(2,t,e)}))},e}(),H=function(){function t(e){this[b]=S++,this._result=this._state=void 0,this._subscribers=[],B!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t((function(t){C(e,t)}),(function(t){N(e,t)}))}catch(t){N(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var r=this,n=r.constructor;return e(t)?r.then((function(e){return n.resolve(t()).then((function(){return e}))}),(function(e){return n.resolve(t()).then((function(){throw e}))})):r.then(t,t)},t}();return H.prototype.then=v,H.all=function(e){return new T(this,e).promise},H.race=function(e){var r=this;return t(e)?new r((function(t,n){for(var o=e.length,s=0;s<o;s++)r.resolve(e[s]).then(t,n)})):new r((function(e,t){return t(new TypeError("You must pass an array to race."))}))},H.resolve=w,H.reject=function(e){var t=new this(B);return N(t,e),t},H._setScheduler=function(e){o=e},H._setAsap=function(e){s=e},H._asap=s,H.polyfill=function(){var e=void 0;if("undefined"!=typeof global)e=global;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var r=null;try{r=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===r&&!t.cast)return}e.Promise=H},H.Promise=H,H},e.exports=t()},"./node_modules/fflate/esm/browser.js":function(e,t,r){"use strict";r.r(t),r.d(t,{Deflate:function(){return ve},AsyncDeflate:function(){return we},deflate:function(){return be},deflateSync:function(){return Be},Inflate:function(){return je},AsyncInflate:function(){return _e},inflate:function(){return Ce},inflateSync:function(){return xe},Gzip:function(){return Ee},AsyncGzip:function(){return Ne},gzip:function(){return Qe},gzipSync:function(){return Fe},Gunzip:function(){return Ue},AsyncGunzip:function(){return Se},gunzip:function(){return Le},gunzipSync:function(){return Te},Zlib:function(){return He},AsyncZlib:function(){return Ie},zlib:function(){return Pe},zlibSync:function(){return Oe},Unzlib:function(){return ke},AsyncUnzlib:function(){return Re},unzlib:function(){return Me},unzlibSync:function(){return De},compress:function(){return Qe},AsyncCompress:function(){return Ne},compressSync:function(){return Fe},Compress:function(){return Ee},Decompress:function(){return Ke},AsyncDecompress:function(){return ze},decompress:function(){return Ve},decompressSync:function(){return qe},strToU8:function(){return Xe},strFromU8:function(){return We},zip:function(){return tt},zipSync:function(){return rt},unzip:function(){return nt},unzipSync:function(){return ot}});var n={},o=Uint8Array,s=Uint16Array,i=Uint32Array,a=new o([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),A=new o([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),u=new o([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),c=function(e,t){for(var r=new s(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];var o=new i(r[30]);for(n=1;n<30;++n)for(var a=r[n];a<r[n+1];++a)o[a]=a-r[n]<<5|n;return[r,o]},l=c(a,2),d=l[0],f=l[1];d[28]=258,f[258]=28;for(var h=c(A,0),p=h[0],m=h[1],g=new s(32768),y=0;y<32768;++y){var v=(43690&y)>>>1|(21845&y)<<1;v=(61680&(v=(52428&v)>>>2|(13107&v)<<2))>>>4|(3855&v)<<4,g[y]=((65280&v)>>>8|(255&v)<<8)>>>1}var w=function(e,t,r){for(var n=e.length,o=0,i=new s(t);o<n;++o)++i[e[o]-1];var a,A=new s(t);for(o=0;o<t;++o)A[o]=A[o-1]+i[o-1]<<1;if(r){a=new s(1<<t);var u=15-t;for(o=0;o<n;++o)if(e[o])for(var c=o<<4|e[o],l=t-e[o],d=A[e[o]-1]++<<l,f=d|(1<<l)-1;d<=f;++d)a[g[d]>>>u]=c}else for(a=new s(n),o=0;o<n;++o)a[o]=g[A[e[o]-1]++]>>>15-e[o];return a},b=new o(288);for(y=0;y<144;++y)b[y]=8;for(y=144;y<256;++y)b[y]=9;for(y=256;y<280;++y)b[y]=7;for(y=280;y<288;++y)b[y]=8;var B=new o(32);for(y=0;y<32;++y)B[y]=5;var j=w(b,9,0),_=w(b,9,1),C=w(B,5,0),x=w(B,5,1),E=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},N=function(e,t,r){var n=t/8>>0;return(e[n]|e[n+1]<<8)>>>(7&t)&r},Q=function(e,t){var r=t/8>>0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>>(7&t)},F=function(e){return(e/8>>0)+(7&e&&1)},U=function(e,t,r){(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length);var n=new(e instanceof s?s:e instanceof i?i:o)(r-t);return n.set(e.subarray(t,r)),n},S=function(e,t,r){var n=e.length,s=!t||r,i=!r||r.i;r||(r={}),t||(t=new o(3*n));var c=function(e){var r=t.length;if(e>r){var n=new o(Math.max(2*r,e));n.set(t),t=n}},l=r.f||0,f=r.p||0,h=r.b||0,m=r.l,g=r.d,y=r.m,v=r.n,b=8*n;do{if(!m){r.f=l=N(e,f,1);var B=N(e,f+1,3);if(f+=3,!B){var j=e[(M=F(f)+4)-4]|e[M-3]<<8,C=M+j;if(C>n){if(i)throw"unexpected EOF";break}s&&c(h+j),t.set(e.subarray(M,C),h),r.b=h+=j,r.p=f=8*C;continue}if(1==B)m=_,g=x,y=9,v=5;else{if(2!=B)throw"invalid block type";var S=N(e,f,31)+257,L=N(e,f+10,15)+4,T=S+N(e,f+5,31)+1;f+=14;for(var H=new o(T),I=new o(19),P=0;P<L;++P)I[u[P]]=N(e,f+3*P,7);f+=3*L;var O=E(I),k=(1<<O)-1;if(!i&&f+T*(O+7)>b)break;var R=w(I,O,1);for(P=0;P<T;){var M,D=R[N(e,f,k)];if(f+=15&D,(M=D>>>4)<16)H[P++]=M;else{var K=0,z=0;for(16==M?(z=3+N(e,f,3),f+=2,K=H[P-1]):17==M?(z=3+N(e,f,7),f+=3):18==M&&(z=11+N(e,f,127),f+=7);z--;)H[P++]=K}}var V=H.subarray(0,S),q=H.subarray(S);y=E(V),v=E(q),m=w(V,y,1),g=w(q,v,1)}if(f>b)throw"unexpected EOF"}s&&c(h+131072);for(var G=(1<<y)-1,X=(1<<v)-1,W=y+v+18;i||f+W<b;){var J=(K=m[Q(e,f)&G])>>>4;if((f+=15&K)>b)throw"unexpected EOF";if(!K)throw"invalid length/literal";if(J<256)t[h++]=J;else{if(256==J){m=null;break}var Y=J-254;if(J>264){var Z=a[P=J-257];Y=N(e,f,(1<<Z)-1)+d[P],f+=Z}var $=g[Q(e,f)&X],ee=$>>>4;if(!$)throw"invalid distance";if(f+=15&$,q=p[ee],ee>3&&(Z=A[ee],q+=Q(e,f)&(1<<Z)-1,f+=Z),f>b)throw"unexpected EOF";s&&c(h+131072);for(var te=h+Y;h<te;h+=4)t[h]=t[h-q],t[h+1]=t[h+1-q],t[h+2]=t[h+2-q],t[h+3]=t[h+3-q];h=te}}r.l=m,r.p=f,r.b=h,m&&(l=1,r.m=y,r.d=g,r.n=v)}while(!l);return h==t.length?t:U(t,0,h)},L=function(e,t,r){r<<=7&t;var n=t/8>>0;e[n]|=r,e[n+1]|=r>>>8},T=function(e,t,r){r<<=7&t;var n=t/8>>0;e[n]|=r,e[n+1]|=r>>>8,e[n+2]|=r>>>16},H=function(e,t){for(var r=[],n=0;n<e.length;++n)e[n]&&r.push({s:n,f:e[n]});var i=r.length,a=r.slice();if(!i)return[new o(0),0];if(1==i){var A=new o(r[0].s+1);return A[r[0].s]=1,[A,1]}r.sort((function(e,t){return e.f-t.f})),r.push({s:-1,f:25001});var u=r[0],c=r[1],l=0,d=1,f=2;for(r[0]={s:-1,f:u.f+c.f,l:u,r:c};d!=i-1;)u=r[r[l].f<r[f].f?l++:f++],c=r[l!=d&&r[l].f<r[f].f?l++:f++],r[d++]={s:-1,f:u.f+c.f,l:u,r:c};var h=a[0].s;for(n=1;n<i;++n)a[n].s>h&&(h=a[n].s);var p=new s(h+1),m=I(r[d-1],p,0);if(m>t){n=0;var g=0,y=m-t,v=1<<y;for(a.sort((function(e,t){return p[t.s]-p[e.s]||e.f-t.f}));n<i;++n){var w=a[n].s;if(!(p[w]>t))break;g+=v-(1<<m-p[w]),p[w]=t}for(g>>>=y;g>0;){var b=a[n].s;p[b]<t?g-=1<<t-p[b]++-1:++n}for(;n>=0&&g;--n){var B=a[n].s;p[B]==t&&(--p[B],++g)}m=t}return[new o(p),m]},I=function(e,t,r){return-1==e.s?Math.max(I(e.l,t,r+1),I(e.r,t,r+1)):t[e.s]=r},P=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new s(++t),n=0,o=e[0],i=1,a=function(e){r[n++]=e},A=1;A<=t;++A)if(e[A]==o&&A!=t)++i;else{if(!o&&i>2){for(;i>138;i-=138)a(32754);i>2&&(a(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(a(o),--i;i>6;i-=6)a(8304);i>2&&(a(i-3<<5|8208),i=0)}for(;i--;)a(o);i=1,o=e[A]}return[r.subarray(0,n),t]},O=function(e,t){for(var r=0,n=0;n<t.length;++n)r+=e[n]*t[n];return r},k=function(e,t,r){var n=r.length,o=F(t+2);e[o]=255&n,e[o+1]=n>>>8,e[o+2]=255^e[o],e[o+3]=255^e[o+1];for(var s=0;s<n;++s)e[o+s+4]=r[s];return 8*(o+4+n)},R=function(e,t,r,n,o,i,c,l,d,f,h){L(t,h++,r),++o[256];for(var p=H(o,15),m=p[0],g=p[1],y=H(i,15),v=y[0],_=y[1],x=P(m),E=x[0],N=x[1],Q=P(v),F=Q[0],U=Q[1],S=new s(19),I=0;I<E.length;++I)S[31&E[I]]++;for(I=0;I<F.length;++I)S[31&F[I]]++;for(var R=H(S,7),M=R[0],D=R[1],K=19;K>4&&!M[u[K-1]];--K);var z,V,q,G,X=f+5<<3,W=O(o,b)+O(i,B)+c,J=O(o,m)+O(i,v)+c+14+3*K+O(S,M)+(2*S[16]+3*S[17]+7*S[18]);if(X<=W&&X<=J)return k(t,h,e.subarray(d,d+f));if(L(t,h,1+(J<W)),h+=2,J<W){z=w(m,g,0),V=m,q=w(v,_,0),G=v;var Y=w(M,D,0);for(L(t,h,N-257),L(t,h+5,U-1),L(t,h+10,K-4),h+=14,I=0;I<K;++I)L(t,h+3*I,M[u[I]]);h+=3*K;for(var Z=[E,F],$=0;$<2;++$){var ee=Z[$];for(I=0;I<ee.length;++I){var te=31&ee[I];L(t,h,Y[te]),h+=M[te],te>15&&(L(t,h,ee[I]>>>5&127),h+=ee[I]>>>12)}}}else z=j,V=b,q=C,G=B;for(I=0;I<l;++I)if(n[I]>255){te=n[I]>>>18&31,T(t,h,z[te+257]),h+=V[te+257],te>7&&(L(t,h,n[I]>>>23&31),h+=a[te]);var re=31&n[I];T(t,h,q[re]),h+=G[re],re>3&&(T(t,h,n[I]>>>5&8191),h+=A[re])}else T(t,h,z[n[I]]),h+=V[n[I]];return T(t,h,z[256]),h+V[256]},M=new i([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),D=new o(0),K=function(e,t,r,n,u,c){var l=e.length,d=new o(n+l+5*(1+Math.floor(l/7e3))+u),h=d.subarray(n,d.length-u),p=0;if(!t||l<8)for(var g=0;g<=l;g+=65535){var y=g+65535;y<l?p=k(h,p,e.subarray(g,y)):(h[g]=c,p=k(h,p,e.subarray(g,l)))}else{for(var v=M[t-1],w=v>>>13,b=8191&v,B=(1<<r)-1,j=new s(32768),_=new s(B+1),C=Math.ceil(r/3),x=2*C,E=function(t){return(e[t]^e[t+1]<<C^e[t+2]<<x)&B},N=new i(25e3),Q=new s(288),S=new s(32),L=0,T=0,H=(g=0,0),I=0,P=0;g<l;++g){var O=E(g),K=32767&g,z=_[O];if(j[K]=z,_[O]=K,I<=g){var V=l-g;if((L>7e3||H>24576)&&V>423){p=R(e,h,0,N,Q,S,T,H,P,g-P,p),H=L=T=0,P=g;for(var q=0;q<286;++q)Q[q]=0;for(q=0;q<30;++q)S[q]=0}var G=2,X=0,W=b,J=K-z&32767;if(V>2&&O==E(g-J))for(var Y=Math.min(w,V)-1,Z=Math.min(32767,g),$=Math.min(258,V);J<=Z&&--W&&K!=z;){if(e[g+G]==e[g+G-J]){for(var ee=0;ee<$&&e[g+ee]==e[g+ee-J];++ee);if(ee>G){if(G=ee,X=J,ee>Y)break;var te=Math.min(J,ee-2),re=0;for(q=0;q<te;++q){var ne=g-J+q+32768&32767,oe=ne-j[ne]+32768&32767;oe>re&&(re=oe,z=ne)}}}J+=(K=z)-(z=j[K])+32768&32767}if(X){N[H++]=268435456|f[G]<<18|m[X];var se=31&f[G],ie=31&m[X];T+=a[se]+A[ie],++Q[257+se],++S[ie],I=g+G,++L}else N[H++]=e[g],++Q[e[g]]}}p=R(e,h,c,N,Q,S,T,H,P,g-P,p),c||(p=k(h,p,D))}return U(d,0,n+F(p)+u)},z=function(){for(var e=new i(256),t=0;t<256;++t){for(var r=t,n=9;--n;)r=(1&r&&3988292384)^r>>>1;e[t]=r}return e}(),V=function(){var e=4294967295;return{p:function(t){for(var r=e,n=0;n<t.length;++n)r=z[255&r^t[n]]^r>>>8;e=r},d:function(){return 4294967295^e}}},q=function(){var e=1,t=0;return{p:function(r){for(var n=e,o=t,s=r.length,i=0;i!=s;){for(var a=Math.min(i+5552,s);i<a;++i)o+=n+=r[i];n%=65521,o%=65521}e=n,t=o},d:function(){return(e>>>8<<16|(255&t)<<8|t>>>8)+2*((255&e)<<23)}}},G=function(e,t,r,n,o){return K(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,r,n,!o)},X=function(e,t){var r={};for(var n in e)r[n]=e[n];for(var n in t)r[n]=t[n];return r},W=function(e,t,r){for(var n=e(),o=e.toString(),s=o.slice(o.indexOf("[")+1,o.lastIndexOf("]")).replace(/ /g,"").split(","),i=0;i<n.length;++i){var a=n[i],A=s[i];if("function"==typeof a){t+=";"+A+"=";var u=a.toString();if(a.prototype)if(-1!=u.indexOf("[native code]")){var c=u.indexOf(" ",8)+1;t+=u.slice(c,u.indexOf("(",c))}else for(var l in t+=u,a.prototype)t+=";"+A+".prototype."+l+"="+a.prototype[l].toString();else t+=u}else r[A]=a}return[t,r]},J=[],Y=function(e,t,r,a){var A;if(!J[r]){for(var u="",c={},l=e.length-1,d=0;d<l;++d)u=(A=W(e[d],u,c))[0],c=A[1];J[r]=W(e[l],u,c)}var f=X({},J[r][1]);return function(e,t,r,o,s){var i=n[t]||(n[t]=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))),a=new Worker(i);return a.onerror=function(e){return s(e.error,null)},a.onmessage=function(e){return s(null,e.data)},a.postMessage(r,o),a}(J[r][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",r,f,function(e){var t=[];for(var r in e)(e[r]instanceof o||e[r]instanceof s||e[r]instanceof i)&&t.push((e[r]=new e[r].constructor(e[r])).buffer);return t}(f),a)},Z=function(){return[o,s,i,a,A,u,d,p,_,x,g,w,E,N,Q,F,U,S,xe,oe,se]},$=function(){return[o,s,i,a,A,u,f,m,j,b,C,B,g,M,D,w,L,T,H,I,P,O,k,R,F,U,K,G,Be,oe]},ee=function(){return[de,pe,le,V,z]},te=function(){return[fe,he]},re=function(){return[me,le,q]},ne=function(){return[ge]},oe=function(e){return postMessage(e,[e.buffer])},se=function(e){return e&&e.size&&new o(e.size)},ie=function(e,t,r,n,s,i){var a=Y(r,n,s,(function(e,t){a.terminate(),i(e,t)}));return t.consume||(e=new o(e)),a.postMessage([e,t],[e.buffer]),function(){a.terminate()}},ae=function(e){return e.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(t){return e.push(t.data[0],t.data[1])}},Ae=function(e,t,r,n,o){var s,i=Y(e,n,o,(function(e,r){e?(i.terminate(),t.ondata.call(t,e)):(r[1]&&i.terminate(),t.ondata.call(t,e,r[0],r[1]))}));i.postMessage(r),t.push=function(e,r){if(s)throw"stream finished";if(!t.ondata)throw"no stream handler";i.postMessage([e,s=r],[e.buffer])},t.terminate=function(){i.terminate()}},ue=function(e,t){return e[t]|e[t+1]<<8},ce=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+2*(e[t+3]<<23)},le=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},de=function(e,t){var r=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&le(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),r){e[3]=8;for(var n=0;n<=r.length;++n)e[n+10]=r.charCodeAt(n)}},fe=function(e){if(31!=e[0]||139!=e[1]||8!=e[2])throw"invalid gzip data";var t=e[3],r=10;4&t&&(r+=e[10]|2+(e[11]<<8));for(var n=(t>>3&1)+(t>>4&1);n>0;n-=!e[r++]);return r+(2&t)},he=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16)+2*(e[t-1]<<23)},pe=function(e){return 10+(e.filename&&e.filename.length+1||0)},me=function(e,t){var r=t.level,n=0==r?0:r<6?1:9==r?3:2;e[0]=120,e[1]=n<<6|(n?32-2*n:1)},ge=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function ye(e,t){return t||"function"!=typeof e||(t=e,e={}),this.ondata=t,e}var ve=function(){function e(e,t){t||"function"!=typeof e||(t=e,e={}),this.ondata=t,this.o=e||{}}return e.prototype.p=function(e,t){this.ondata(G(e,this.o,0,0,!t),t)},e.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},e}(),we=function(){return function(e,t){Ae([$,function(){return[ae,ve]}],this,ye.call(this,e,t),(function(e){var t=new ve(e.data);onmessage=ae(t)}),6)}}();function be(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return ie(e,t,[$],(function(e){return oe(Be(e.data[0],e.data[1]))}),0,r)}function Be(e,t){return void 0===t&&(t={}),G(e,t,0,0)}var je=function(){function e(e){this.s={},this.p=new o(0),this.ondata=e}return e.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,r=new o(t+e.length);r.set(this.p),r.set(e,t),this.p=r},e.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,r=S(this.p,this.o,this.s);this.ondata(U(r,t,this.s.b),this.d),this.o=U(r,this.s.b-32768),this.s.b=this.o.length,this.p=U(this.p,this.s.p/8>>0),this.s.p&=7},e.prototype.push=function(e,t){this.e(e),this.c(t)},e}(),_e=function(){return function(e){this.ondata=e,Ae([Z,function(){return[ae,je]}],this,0,(function(){var e=new je;onmessage=ae(e)}),7)}}();function Ce(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return ie(e,t,[Z],(function(e){return oe(xe(e.data[0],se(e.data[1])))}),1,r)}function xe(e,t){return S(e,t)}var Ee=function(){function e(e,t){this.c=V(),this.l=0,this.v=1,ve.call(this,e,t)}return e.prototype.push=function(e,t){ve.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var r=G(e,this.o,this.v&&pe(this.o),t&&8,!t);this.v&&(de(r,this.o),this.v=0),t&&(le(r,r.length-8,this.c.d()),le(r,r.length-4,this.l)),this.ondata(r,t)},e}(),Ne=function(){return function(e,t){Ae([$,ee,function(){return[ae,ve,Ee]}],this,ye.call(this,e,t),(function(e){var t=new Ee(e.data);onmessage=ae(t)}),8)}}();function Qe(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return ie(e,t,[$,ee,function(){return[Fe]}],(function(e){return oe(Fe(e.data[0],e.data[1]))}),2,r)}function Fe(e,t){void 0===t&&(t={});var r=V(),n=e.length;r.p(e);var o=G(e,t,pe(t),8),s=o.length;return de(o,t),le(o,s-8,r.d()),le(o,s-4,n),o}var Ue=function(){function e(e){this.v=1,je.call(this,e)}return e.prototype.push=function(e,t){if(je.prototype.e.call(this,e),this.v){var r=fe(this.p);if(r>=this.p.length&&!t)return;this.p=this.p.subarray(r),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}je.prototype.c.call(this,t)},e}(),Se=function(){return function(e){this.ondata=e,Ae([Z,te,function(){return[ae,je,Ue]}],this,0,(function(){var e=new Ue;onmessage=ae(e)}),9)}}();function Le(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return ie(e,t,[Z,te,function(){return[Te]}],(function(e){return oe(Te(e.data[0]))}),3,r)}function Te(e,t){return S(e.subarray(fe(e),-8),t||new o(he(e)))}var He=function(){function e(e,t){this.c=q(),this.v=1,ve.call(this,e,t)}return e.prototype.push=function(e,t){ve.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e);var r=G(e,this.o,this.v&&2,t&&4,!t);this.v&&(me(r,this.o),this.v=0),t&&le(r,r.length-4,this.c.d()),this.ondata(r,t)},e}(),Ie=function(){return function(e,t){Ae([$,re,function(){return[ae,ve,He]}],this,ye.call(this,e,t),(function(e){var t=new He(e.data);onmessage=ae(t)}),10)}}();function Pe(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return ie(e,t,[$,re,function(){return[Oe]}],(function(e){return oe(Oe(e.data[0],e.data[1]))}),4,r)}function Oe(e,t){void 0===t&&(t={});var r=q();r.p(e);var n=G(e,t,2,4);return me(n,t),le(n,n.length-4,r.d()),n}var ke=function(){function e(e){this.v=1,je.call(this,e)}return e.prototype.push=function(e,t){if(je.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}je.prototype.c.call(this,t)},e}(),Re=function(){return function(e){this.ondata=e,Ae([Z,ne,function(){return[ae,je,ke]}],this,0,(function(){var e=new ke;onmessage=ae(e)}),11)}}();function Me(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return ie(e,t,[Z,ne,function(){return[De]}],(function(e){return oe(De(e.data[0],se(e.data[1])))}),5,r)}function De(e,t){return S((ge(e),e.subarray(2,-4)),t)}var Ke=function(){function e(e){this.G=Ue,this.I=je,this.Z=ke,this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var r=new o(this.p.length+e.length);r.set(this.p),r.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var n=this,s=function(){n.ondata.apply(n,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(s):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(s):new this.Z(s),this.s.push(this.p,t),this.p=null}}},e}(),ze=function(){function e(e){this.G=Se,this.I=_e,this.Z=Re,this.ondata=e}return e.prototype.push=function(e,t){Ke.prototype.push.call(this,e,t)},e}();function Ve(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return 31==e[0]&&139==e[1]&&8==e[2]?Le(e,t,r):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Ce(e,t,r):Me(e,t,r)}function qe(e,t){return 31==e[0]&&139==e[1]&&8==e[2]?Te(e,t):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?xe(e,t):De(e,t)}var Ge=function(e,t,r,n){for(var s in e){var i=e[s],a=t+s;i instanceof o?r[a]=[i,n]:Array.isArray(i)?r[a]=[i[0],X(n,i[1])]:Ge(i,a+"/",r,n)}};function Xe(e,t){var r=e.length;if(!t&&"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);for(var n=new o(e.length+(e.length>>>1)),s=0,i=function(e){n[s++]=e},a=0;a<r;++a){if(s+5>n.length){var A=new o(s+8+(r-a<<1));A.set(n),n=A}var u=e.charCodeAt(a);u<128||t?i(u):u<2048?(i(192|u>>>6),i(128|63&u)):u>55295&&u<57344?(i(240|(u=65536+(1047552&u)|1023&e.charCodeAt(++a))>>>18),i(128|u>>>12&63),i(128|u>>>6&63),i(128|63&u)):(i(224|u>>>12),i(128|u>>>6&63),i(128|63&u))}return U(n,0,s)}function We(e,t){var r="";if(!t&&"undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var n=0;n<e.length;){var o=e[n++];o<128||t?r+=String.fromCharCode(o):o<224?r+=String.fromCharCode((31&o)<<6|63&e[n++]):o<240?r+=String.fromCharCode((15&o)<<12|(63&e[n++])<<6|63&e[n++]):(o=((15&o)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,r+=String.fromCharCode(55296|o>>10,56320|1023&o))}return r}var Je=function(e,t){return t+30+ue(e,t+26)+ue(e,t+28)},Ye=function(e,t,r){var n=ue(e,t+28),o=We(e.subarray(t+46,t+46+n),!(2048&ue(e,t+8))),s=t+46+n,i=r?Ze(e,s):[ce(e,t+20),ce(e,t+24),ce(e,t+42)],a=i[0],A=i[1],u=i[2];return[ue(e,t+10),a,A,o,s+ue(e,t+30)+ue(e,t+32),u]},Ze=function(e,t){for(;1!=ue(e,t);t+=4+ue(e,t+2));return[ce(e,t+12),ce(e,t+4),ce(e,t+20)]},$e=function(e,t,r,n,o,s,i,a,A,u){var c=s.length,l=n.length;le(e,t,null!=A?33639248:67324752),t+=4,null!=A&&(e[t]=20,t+=2),e[t]=20,t+=2,e[t++]=8==u&&(1==a.level?6:a.level<6?4:9==a.level?2:0),e[t++]=i&&8,e[t]=u,t+=2;var d=new Date(a.mtime||Date.now()),f=d.getFullYear()-1980;if(f<0||f>119)throw"date not in range 1980-2099";le(e,t,2*(f<<24)|d.getMonth()+1<<21|d.getDate()<<16|d.getHours()<<11|d.getMinutes()<<5|d.getSeconds()>>>1),le(e,t+=4,r),le(e,t+4,l),le(e,t+8,o),le(e,t+12,c),t+=16,null!=A&&(le(e,t+=10,A),t+=4),e.set(s,t),t+=c,null==A&&e.set(n,t)},et=function(e,t,r,n,o){le(e,t,101010256),le(e,t+8,r),le(e,t+10,r),le(e,t+12,n),le(e,t+16,o)};function tt(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";var n={};Ge(e,"",n,t);var s=Object.keys(n),i=s.length,a=0,A=0,u=i,c=new Array(i),l=[],d=function(){for(var e=0;e<l.length;++e)l[e]()},f=function(){var e=new o(A+22),t=a,n=A-a;A=0;for(var s=0;s<u;++s){var i=c[s];try{$e(e,A,i.c,i.d,i.m,i.n,i.u,i.p,null,i.t),$e(e,a,i.c,i.d,i.m,i.n,i.u,i.p,A,i.t),a+=46+i.n.length,A+=30+i.n.length+i.d.length}catch(e){return r(e,null)}}et(e,a,c.length,n,t),r(null,e)};i||f();for(var h=function(e){var t=s[e],o=n[t],u=o[0],h=o[1],p=V(),m=u.length;p.p(u);var g=Xe(t),y=g.length,v=0==h.level?0:8,w=function(n,o){if(n)d(),r(n,null);else{var s=o.length;c[e]={t:v,d:o,m:m,c:p.d(),u:t.length!=s,n:g,p:h},a+=30+y+s,A+=76+2*y+s,--i||f()}};if(g.length>65535&&w("filename too long",null),v)if(m<16e4)try{w(null,Be(u,h))}catch(e){w(e,null)}else l.push(be(u,h,w));else w(null,u)},p=0;p<u;++p)h(p);return d}function rt(e,t){void 0===t&&(t={});var r={},n=[];Ge(e,"",r,t);var s=0,i=0;for(var a in r){var A=r[a],u=A[0],c=A[1],l=0==c.level?0:8,d=Xe(a),f=d.length;if(d.length>65535)throw"filename too long";var h=l?Be(u,c):u,p=h.length,m=V();m.p(u),n.push({t:l,d:h,m:u.length,c:m.d(),u:a.length!=f,n:d,o:s,p:c}),s+=30+f+p,i+=76+2*f+p}for(var g=new o(i+22),y=s,v=i-s,w=0;w<n.length;++w){var b=n[w];$e(g,b.o,b.c,b.d,b.m,b.n,b.u,b.p,null,b.t),$e(g,s,b.c,b.d,b.m,b.n,b.u,b.p,b.o,b.t),s+=46+b.n.length}return et(g,s,n.length,v,y),g}function nt(e,t){if("function"!=typeof t)throw"no callback";for(var r=[],n=function(){for(var e=0;e<r.length;++e)r[e]()},s={},i=e.length-22;101010256!=ce(e,i);--i)if(!i||e.length-i>65558)return void t("invalid zip file",null);var a=ue(e,i+8);a||t(null,{});var A=a,u=ce(e,i+16),c=4294967295==u;if(c){if(i=ce(e,i-12),101075792!=ce(e,i))throw"invalid zip file";A=a=ce(e,i+32),u=ce(e,i+48)}for(var l=function(i){var A=Ye(e,u,c),l=A[0],d=A[1],f=A[2],h=A[3],p=A[4],m=A[5],g=Je(e,m);u=p;var y=function(e,r){e?(n(),t(e,null)):(s[h]=r,--a||t(null,s))};if(l)if(8==l){var v=e.subarray(g,g+d);if(d<32e4)try{y(null,xe(v,new o(f)))}catch(e){y(e,null)}else r.push(Ce(v,{size:f},y))}else y("unknown compression type "+l,null);else y(null,U(e,g,g+d))},d=0;d<A;++d)l();return n}function ot(e){for(var t={},r=e.length-22;101010256!=ce(e,r);--r)if(!r||e.length-r>65558)throw"invalid zip file";var n=ue(e,r+8);if(!n)return{};var s=ce(e,r+16),i=4294967295==s;if(i){if(r=ce(e,r-12),101075792!=ce(e,r))throw"invalid zip file";n=ce(e,r+32),s=ce(e,r+48)}for(var a=0;a<n;++a){var A=Ye(e,s,i),u=A[0],c=A[1],l=A[2],d=A[3],f=A[4],h=A[5],p=Je(e,h);if(s=f,u){if(8!=u)throw"unknown compression type "+u;t[d]=xe(e.subarray(p,p+c),new o(l))}else t[d]=U(e,p,p+c)}return t}},"./node_modules/html2canvas/dist/html2canvas.js":function(e){e.exports=function(){"use strict";var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};function t(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}var r=function(){return(r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function n(e,t,r,n){return new(r||(r=Promise))((function(o,s){function i(e){try{A(n.next(e))}catch(e){s(e)}}function a(e){try{A(n.throw(e))}catch(e){s(e)}}function A(e){e.done?o(e.value):new r((function(t){t(e.value)})).then(i,a)}A((n=n.apply(e,t||[])).next())}))}function o(e,t){var r,n,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}for(var s=function(){function e(e,t,r,n){this.left=e,this.top=t,this.width=r,this.height=n}return e.prototype.add=function(t,r,n,o){return new e(this.left+t,this.top+r,this.width+n,this.height+o)},e.fromClientRect=function(t){return new e(t.left,t.top,t.width,t.height)},e}(),i=function(e){return s.fromClientRect(e.getBoundingClientRect())},a=function(e){for(var t=[],r=0,n=e.length;r<n;){var o=e.charCodeAt(r++);if(o>=55296&&o<=56319&&r<n){var s=e.charCodeAt(r++);56320==(64512&s)?t.push(((1023&o)<<10)+(1023&s)+65536):(t.push(o),r--)}else t.push(o)}return t},A=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var r=e.length;if(!r)return"";for(var n=[],o=-1,s="";++o<r;){var i=e[o];i<=65535?n.push(i):(i-=65536,n.push(55296+(i>>10),i%1024+56320)),(o+1===r||n.length>16384)&&(s+=String.fromCharCode.apply(String,n),n.length=0)}return s},u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c="undefined"==typeof Uint8Array?[]:new Uint8Array(256),l=0;l<u.length;l++)c[u.charCodeAt(l)]=l;var d,f,h,p,m,g,y,v,w,b=function(e,t,r){return e.slice?e.slice(t,r):new Uint16Array(Array.prototype.slice.call(e,t,r))},B=function(){function e(e,t,r,n,o,s){this.initialValue=e,this.errorValue=t,this.highStart=r,this.highValueIndex=n,this.index=o,this.data=s}return e.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=((t=this.index[e>>5])<<2)+(31&e),this.data[t];if(e<=65535)return t=((t=this.index[2048+(e-55296>>5)])<<2)+(31&e),this.data[t];if(e<this.highStart)return t=2080+(e>>11),t=this.index[t],t+=e>>5&63,t=((t=this.index[t])<<2)+(31&e),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e}(),j=10,_=13,C=15,x=17,E=18,N=19,Q=20,F=21,U=22,S=24,L=25,T=26,H=27,I=28,P=30,O=32,k=33,R=34,M=35,D=37,K=38,z=39,V=40,q=42,G="×",X="÷",W=(m=function(e){var t,r,n,o,s,i=.75*e.length,a=e.length,A=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--);var u="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?new ArrayBuffer(i):new Array(i),l=Array.isArray(u)?u:new Uint8Array(u);for(t=0;t<a;t+=4)r=c[e.charCodeAt(t)],n=c[e.charCodeAt(t+1)],o=c[e.charCodeAt(t+2)],s=c[e.charCodeAt(t+3)],l[A++]=r<<2|n>>4,l[A++]=(15&n)<<4|o>>2,l[A++]=(3&o)<<6|63&s;return u}("KwAAAAAAAAAACA4AIDoAAPAfAAACAAAAAAAIABAAGABAAEgAUABYAF4AZgBeAGYAYABoAHAAeABeAGYAfACEAIAAiACQAJgAoACoAK0AtQC9AMUAXgBmAF4AZgBeAGYAzQDVAF4AZgDRANkA3gDmAOwA9AD8AAQBDAEUARoBIgGAAIgAJwEvATcBPwFFAU0BTAFUAVwBZAFsAXMBewGDATAAiwGTAZsBogGkAawBtAG8AcIBygHSAdoB4AHoAfAB+AH+AQYCDgIWAv4BHgImAi4CNgI+AkUCTQJTAlsCYwJrAnECeQKBAk0CiQKRApkCoQKoArACuALAAsQCzAIwANQC3ALkAjAA7AL0AvwCAQMJAxADGAMwACADJgMuAzYDPgOAAEYDSgNSA1IDUgNaA1oDYANiA2IDgACAAGoDgAByA3YDfgOAAIQDgACKA5IDmgOAAIAAogOqA4AAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAK8DtwOAAIAAvwPHA88D1wPfAyAD5wPsA/QD/AOAAIAABAQMBBIEgAAWBB4EJgQuBDMEIAM7BEEEXgBJBCADUQRZBGEEaQQwADAAcQQ+AXkEgQSJBJEEgACYBIAAoASoBK8EtwQwAL8ExQSAAIAAgACAAIAAgACgAM0EXgBeAF4AXgBeAF4AXgBeANUEXgDZBOEEXgDpBPEE+QQBBQkFEQUZBSEFKQUxBTUFPQVFBUwFVAVcBV4AYwVeAGsFcwV7BYMFiwWSBV4AmgWgBacFXgBeAF4AXgBeAKsFXgCyBbEFugW7BcIFwgXIBcIFwgXQBdQF3AXkBesF8wX7BQMGCwYTBhsGIwYrBjMGOwZeAD8GRwZNBl4AVAZbBl4AXgBeAF4AXgBeAF4AXgBeAF4AXgBeAGMGXgBqBnEGXgBeAF4AXgBeAF4AXgBeAF4AXgB5BoAG4wSGBo4GkwaAAIADHgR5AF4AXgBeAJsGgABGA4AAowarBrMGswagALsGwwbLBjAA0wbaBtoG3QbaBtoG2gbaBtoG2gblBusG8wb7BgMHCwcTBxsHCwcjBysHMAc1BzUHOgdCB9oGSgdSB1oHYAfaBloHaAfaBlIH2gbaBtoG2gbaBtoG2gbaBjUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHbQdeAF4ANQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQd1B30HNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1B4MH2gaKB68EgACAAIAAgACAAIAAgACAAI8HlwdeAJ8HpweAAIAArwe3B14AXgC/B8UHygcwANAH2AfgB4AA6AfwBz4B+AcACFwBCAgPCBcIogEYAR8IJwiAAC8INwg/CCADRwhPCFcIXwhnCEoDGgSAAIAAgABvCHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIhAiLCI4IMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAANQc1BzUHNQc1BzUHNQc1BzUHNQc1B54INQc1B6II2gaqCLIIugiAAIAAvgjGCIAAgACAAIAAgACAAIAAgACAAIAAywiHAYAA0wiAANkI3QjlCO0I9Aj8CIAAgACAAAIJCgkSCRoJIgknCTYHLwk3CZYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiAAIAAAAFAAXgBeAGAAcABeAHwAQACQAKAArQC9AJ4AXgBeAE0A3gBRAN4A7AD8AMwBGgEAAKcBNwEFAUwBXAF4QkhCmEKnArcCgAHHAsABz4LAAcABwAHAAd+C6ABoAG+C/4LAAcABwAHAAc+DF4MAAcAB54M3gweDV4Nng3eDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEeDqABVg6WDqABoQ6gAaABoAHXDvcONw/3DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DncPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB7cPPwlGCU4JMACAAIAAgABWCV4JYQmAAGkJcAl4CXwJgAkwADAAMAAwAIgJgACLCZMJgACZCZ8JowmrCYAAswkwAF4AXgB8AIAAuwkABMMJyQmAAM4JgADVCTAAMAAwADAAgACAAIAAgACAAIAAgACAAIAAqwYWBNkIMAAwADAAMADdCeAJ6AnuCR4E9gkwAP4JBQoNCjAAMACAABUK0wiAAB0KJAosCjQKgAAwADwKQwqAAEsKvQmdCVMKWwowADAAgACAALcEMACAAGMKgABrCjAAMAAwADAAMAAwADAAMAAwADAAMAAeBDAAMAAwADAAMAAwADAAMAAwADAAMAAwAIkEPQFzCnoKiQSCCooKkAqJBJgKoAqkCokEGAGsCrQKvArBCjAAMADJCtEKFQHZCuEK/gHpCvEKMAAwADAAMACAAIwE+QowAIAAPwEBCzAAMAAwADAAMACAAAkLEQswAIAAPwEZCyELgAAOCCkLMAAxCzkLMAAwADAAMAAwADAAXgBeAEELMAAwADAAMAAwADAAMAAwAEkLTQtVC4AAXAtkC4AAiQkwADAAMAAwADAAMAAwADAAbAtxC3kLgAuFC4sLMAAwAJMLlwufCzAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAApwswADAAMACAAIAAgACvC4AAgACAAIAAgACAALcLMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAvwuAAMcLgACAAIAAgACAAIAAyguAAIAAgACAAIAA0QswADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAANkLgACAAIAA4AswADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACJCR4E6AswADAAhwHwC4AA+AsADAgMEAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMACAAIAAGAwdDCUMMAAwAC0MNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQw1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHPQwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADUHNQc1BzUHNQc1BzUHNQc2BzAAMAA5DDUHNQc1BzUHNQc1BzUHNQc1BzUHNQdFDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAgACAAIAATQxSDFoMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAF4AXgBeAF4AXgBeAF4AYgxeAGoMXgBxDHkMfwxeAIUMXgBeAI0MMAAwADAAMAAwAF4AXgCVDJ0MMAAwADAAMABeAF4ApQxeAKsMswy7DF4Awgy9DMoMXgBeAF4AXgBeAF4AXgBeAF4AXgDRDNkMeQBqCeAM3Ax8AOYM7Az0DPgMXgBeAF4AXgBeAF4AXgBeAF4AXgBeAF4AXgBeAF4AXgCgAAANoAAHDQ4NFg0wADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAeDSYNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIAAgACAAIAAgACAAC4NMABeAF4ANg0wADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAD4NRg1ODVYNXg1mDTAAbQ0wADAAMAAwADAAMAAwADAA2gbaBtoG2gbaBtoG2gbaBnUNeg3CBYANwgWFDdoGjA3aBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gaUDZwNpA2oDdoG2gawDbcNvw3HDdoG2gbPDdYN3A3fDeYN2gbsDfMN2gbaBvoN/g3aBgYODg7aBl4AXgBeABYOXgBeACUG2gYeDl4AJA5eACwO2w3aBtoGMQ45DtoG2gbaBtoGQQ7aBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gZJDjUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1B1EO2gY1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQdZDjUHNQc1BzUHNQc1B2EONQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHaA41BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1B3AO2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gY1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1B2EO2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gZJDtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBkkOeA6gAKAAoAAwADAAMAAwAKAAoACgAKAAoACgAKAAgA4wADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAD//wQABAAEAAQABAAEAAQABAAEAA0AAwABAAEAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAKABMAFwAeABsAGgAeABcAFgASAB4AGwAYAA8AGAAcAEsASwBLAEsASwBLAEsASwBLAEsAGAAYAB4AHgAeABMAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAFgAbABIAHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYADQARAB4ABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkAFgAaABsAGwAbAB4AHQAdAB4ATwAXAB4ADQAeAB4AGgAbAE8ATwAOAFAAHQAdAB0ATwBPABcATwBPAE8AFgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwArAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAAQABAANAA0ASwBLAEsASwBLAEsASwBLAEsASwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUAArACsABABQAAQABAAEAAQABAAEAAQAKwArAAQABAArACsABAAEAAQAUAArACsAKwArACsAKwArACsABAArACsAKwArAFAAUAArAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAGgAaAFAAUABQAFAAUABMAB4AGwBQAB4AKwArACsABAAEAAQAKwBQAFAAUABQAFAAUAArACsAKwArAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUAArAFAAUAArACsABAArAAQABAAEAAQABAArACsAKwArAAQABAArACsABAAEAAQAKwArACsABAArACsAKwArACsAKwArAFAAUABQAFAAKwBQACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwAEAAQAUABQAFAABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUAArACsABABQAAQABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQAKwArAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwAeABsAKwArACsAKwArACsAKwBQAAQABAAEAAQABAAEACsABAAEAAQAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwArAAQABAArACsABAAEAAQAKwArACsAKwArACsAKwArAAQABAArACsAKwArAFAAUAArAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwAeAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwAEAFAAKwBQAFAAUABQAFAAUAArACsAKwBQAFAAUAArAFAAUABQAFAAKwArACsAUABQACsAUAArAFAAUAArACsAKwBQAFAAKwArACsAUABQAFAAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQAKwArACsABAAEAAQAKwAEAAQABAAEACsAKwBQACsAKwArACsAKwArAAQAKwArACsAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAB4AHgAeAB4AHgAeABsAHgArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABAArACsAKwArACsAKwArAAQABAArAFAAUABQACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAB4AUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABAArACsAKwArACsAKwArAAQABAArACsAKwArACsAKwArAFAAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwArAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAKwBcAFwAKwBcACsAKwBcACsAKwArACsAKwArAFwAXABcAFwAKwBcAFwAXABcAFwAXABcACsAXABcAFwAKwBcACsAXAArACsAXABcACsAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgArACoAKgBcACsAKwBcAFwAXABcAFwAKwBcACsAKgAqACoAKgAqACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAFwAXABcAFwAUAAOAA4ADgAOAB4ADgAOAAkADgAOAA0ACQATABMAEwATABMACQAeABMAHgAeAB4ABAAEAB4AHgAeAB4AHgAeAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUAANAAQAHgAEAB4ABAAWABEAFgARAAQABABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAAQABAAEAAQABAANAAQABABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsADQANAB4AHgAeAB4AHgAeAAQAHgAeAB4AHgAeAB4AKwAeAB4ADgAOAA0ADgAeAB4AHgAeAB4ACQAJACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgAeAB4AHgBcAFwAXABcAFwAXAAqACoAKgAqAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAKgAqACoAKgAqACoAKgBcAFwAXAAqACoAKgAqAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAXAAqAEsASwBLAEsASwBLAEsASwBLAEsAKgAqACoAKgAqACoAUABQAFAAUABQAFAAKwBQACsAKwArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQACsAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwAEAAQABAAeAA0AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAEQArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAADQANAA0AUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAA0ADQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQACsABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoADQANABUAXAANAB4ADQAbAFwAKgArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAB4AHgATABMADQANAA4AHgATABMAHgAEAAQABAAJACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAUABQAFAAUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwAeACsAKwArABMAEwBLAEsASwBLAEsASwBLAEsASwBLAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwBcAFwAXABcAFwAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcACsAKwArACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwAeAB4AXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgArACsABABLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKgAqACoAKgAqACoAKgBcACoAKgAqACoAKgAqACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAUABQAFAAUABQAFAAUAArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4ADQANAA0ADQAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAHgAeAB4AHgBQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwANAA0ADQANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwBQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsABAAEAAQAHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAABABQAFAAUABQAAQABAAEAFAAUAAEAAQABAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAKwBQACsAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAKwArAB4AHgAeAB4AHgAeACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAUABQAFAAKwAeAB4AHgAeAB4AHgAeAA4AHgArAA0ADQANAA0ADQANAA0ACQANAA0ADQAIAAQACwAEAAQADQAJAA0ADQAMAB0AHQAeABcAFwAWABcAFwAXABYAFwAdAB0AHgAeABQAFAAUAA0AAQABAAQABAAEAAQABAAJABoAGgAaABoAGgAaABoAGgAeABcAFwAdABUAFQAeAB4AHgAeAB4AHgAYABYAEQAVABUAFQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgANAB4ADQANAA0ADQAeAA0ADQANAAcAHgAeAB4AHgArAAQABAAEAAQABAAEAAQABAAEAAQAUABQACsAKwBPAFAAUABQAFAAUAAeAB4AHgAWABEATwBQAE8ATwBPAE8AUABQAFAAUABQAB4AHgAeABYAEQArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAGwAbABsAGwAbABsAGwAaABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAaABsAGwAbABsAGgAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgBQABoAHgAdAB4AUAAeABoAHgAeAB4AHgAeAB4AHgAeAB4ATwAeAFAAGwAeAB4AUABQAFAAUABQAB4AHgAeAB0AHQAeAFAAHgBQAB4AUAAeAFAATwBQAFAAHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AUABQAFAAUABPAE8AUABQAFAAUABQAE8AUABQAE8AUABPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAE8ATwBPAE8ATwBPAE8ATwBPAE8AUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAATwAeAB4AKwArACsAKwAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB0AHQAeAB4AHgAdAB0AHgAeAB0AHgAeAB4AHQAeAB0AGwAbAB4AHQAeAB4AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB0AHgAdAB4AHQAdAB0AHQAdAB0AHgAdAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAdAB0AHQAdAB4AHgAdAB0AHgAeAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABQAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAlACUAHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBQAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAeAB4AHgAeAB0AHQAeAB4AHgAeAB0AHQAdAB4AHgAdAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB0AHQAeAB4AHQAeAB4AHgAeAB0AHQAeAB4AHgAeACUAJQAdAB0AJQAeACUAJQAlACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAHgAeAB4AHgAdAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHQAdAB0AHgAdACUAHQAdAB4AHQAdAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHQAdAB0AHQAlAB4AJQAlACUAHQAlACUAHQAdAB0AJQAlAB0AHQAlAB0AHQAlACUAJQAeAB0AHgAeAB4AHgAdAB0AJQAdAB0AHQAdAB0AHQAlACUAJQAlACUAHQAlACUAIAAlAB0AHQAlACUAJQAlACUAJQAlACUAHgAeAB4AJQAlACAAIAAgACAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeABcAFwAXABcAFwAXAB4AEwATACUAHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwArACUAJQBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAKwArACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAE8ATwBPAE8ATwBPAE8ATwAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeACsAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUAArACsAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQBQAFAAUABQACsAKwArACsAUABQAFAAUABQAFAAUABQAA0AUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQACsAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgBQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAABAAEAAQAKwAEAAQAKwArACsAKwArAAQABAAEAAQAUABQAFAAUAArAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsABAAEAAQAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsADQANAA0ADQANAA0ADQANAB4AKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AUABQAFAAUABQAFAAUABQAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAUABQAFAAUABQAA0ADQANAA0ADQANABQAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwANAA0ADQANAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAeAAQABAAEAB4AKwArAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLACsADQArAB4AKwArAAQABAAEAAQAUABQAB4AUAArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwAEAAQABAAEAAQABAAEAAQABAAOAA0ADQATABMAHgAeAB4ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0AUABQAFAAUAAEAAQAKwArAAQADQANAB4AUAArACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXABcAA0ADQANACoASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUAArACsAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANACsADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEcARwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQACsAKwAeAAQABAANAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAEAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUAArACsAUAArACsAUABQACsAKwBQAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AKwArAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAeAB4ADQANAA0ADQAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAArAAQABAArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAEAAQABAAEAAQABAAEACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAFgAWAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAKwBQACsAKwArACsAKwArAFAAKwArACsAKwBQACsAUAArAFAAKwBQAFAAUAArAFAAUAArAFAAKwArAFAAKwBQACsAUAArAFAAKwBQACsAUABQACsAUAArACsAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAUABQAFAAUAArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUAArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAlACUAJQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeACUAJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeACUAJQAlACUAJQAeACUAJQAlACUAJQAgACAAIAAlACUAIAAlACUAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIQAhACEAIQAhACUAJQAgACAAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIAAgACAAIAAlACUAJQAlACAAJQAgACAAIAAgACAAIAAgACAAIAAlACUAJQAgACUAJQAlACUAIAAgACAAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeACUAHgAlAB4AJQAlACUAJQAlACAAJQAlACUAJQAeACUAHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIAAgACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIAAlACUAJQAlACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAIAAgACAAJQAlACUAIAAgACAAIAAgAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFwAXABcAFQAVABUAHgAeAB4AHgAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIAAgACAAJQAlACUAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAlACAAIAAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsA"),g=Array.isArray(m)?function(e){for(var t=e.length,r=[],n=0;n<t;n+=4)r.push(e[n+3]<<24|e[n+2]<<16|e[n+1]<<8|e[n]);return r}(m):new Uint32Array(m),y=Array.isArray(m)?function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r.push(e[n+1]<<8|e[n]);return r}(m):new Uint16Array(m),v=b(y,12,g[4]/2),w=2===g[5]?b(y,(24+g[4])/2):(f=g,h=Math.ceil((24+g[4])/4),f.slice?f.slice(h,p):new Uint32Array(Array.prototype.slice.call(f,h,p))),new B(g[0],g[1],g[2],g[3],v,w)),J=[P,36],Y=[1,2,3,5],Z=[j,8],$=[H,T],ee=Y.concat(Z),te=[K,z,V,R,M],re=[C,_],ne=function(e,t,r,n){var o=n[r];if(Array.isArray(e)?-1!==e.indexOf(o):e===o)for(var s=r;s<=n.length;){if((A=n[++s])===t)return!0;if(A!==j)break}if(o===j)for(s=r;s>0;){var i=n[--s];if(Array.isArray(e)?-1!==e.indexOf(i):e===i)for(var a=r;a<=n.length;){var A;if((A=n[++a])===t)return!0;if(A!==j)break}if(i!==j)break}return!1},oe=function(e,t){for(var r=e;r>=0;){var n=t[r];if(n!==j)return n;r--}return 0},se=function(e,t,r,n,o){if(0===r[n])return G;var s=n-1;if(Array.isArray(o)&&!0===o[s])return G;var i=s-1,a=s+1,A=t[s],u=i>=0?t[i]:0,c=t[a];if(2===A&&3===c)return G;if(-1!==Y.indexOf(A))return"!";if(-1!==Y.indexOf(c))return G;if(-1!==Z.indexOf(c))return G;if(8===oe(s,t))return X;if(11===W.get(e[s])&&(c===D||c===O||c===k))return G;if(7===A||7===c)return G;if(9===A)return G;if(-1===[j,_,C].indexOf(A)&&9===c)return G;if(-1!==[x,E,N,S,I].indexOf(c))return G;if(oe(s,t)===U)return G;if(ne(23,U,s,t))return G;if(ne([x,E],F,s,t))return G;if(ne(12,12,s,t))return G;if(A===j)return X;if(23===A||23===c)return G;if(16===c||16===A)return X;if(-1!==[_,C,F].indexOf(c)||14===A)return G;if(36===u&&-1!==re.indexOf(A))return G;if(A===I&&36===c)return G;if(c===Q&&-1!==J.concat(Q,N,L,D,O,k).indexOf(A))return G;if(-1!==J.indexOf(c)&&A===L||-1!==J.indexOf(A)&&c===L)return G;if(A===H&&-1!==[D,O,k].indexOf(c)||-1!==[D,O,k].indexOf(A)&&c===T)return G;if(-1!==J.indexOf(A)&&-1!==$.indexOf(c)||-1!==$.indexOf(A)&&-1!==J.indexOf(c))return G;if(-1!==[H,T].indexOf(A)&&(c===L||-1!==[U,C].indexOf(c)&&t[a+1]===L)||-1!==[U,C].indexOf(A)&&c===L||A===L&&-1!==[L,I,S].indexOf(c))return G;if(-1!==[L,I,S,x,E].indexOf(c))for(var l=s;l>=0;){if((d=t[l])===L)return G;if(-1===[I,S].indexOf(d))break;l--}if(-1!==[H,T].indexOf(c))for(l=-1!==[x,E].indexOf(A)?i:s;l>=0;){var d;if((d=t[l])===L)return G;if(-1===[I,S].indexOf(d))break;l--}if(K===A&&-1!==[K,z,R,M].indexOf(c)||-1!==[z,R].indexOf(A)&&-1!==[z,V].indexOf(c)||-1!==[V,M].indexOf(A)&&c===V)return G;if(-1!==te.indexOf(A)&&-1!==[Q,T].indexOf(c)||-1!==te.indexOf(c)&&A===H)return G;if(-1!==J.indexOf(A)&&-1!==J.indexOf(c))return G;if(A===S&&-1!==J.indexOf(c))return G;if(-1!==J.concat(L).indexOf(A)&&c===U||-1!==J.concat(L).indexOf(c)&&A===E)return G;if(41===A&&41===c){for(var f=r[s],h=1;f>0&&41===t[--f];)h++;if(h%2!=0)return G}return A===O&&c===k?G:X},ie=function(e,t){t||(t={lineBreak:"normal",wordBreak:"normal"});var r=function(e,t){void 0===t&&(t="strict");var r=[],n=[],o=[];return e.forEach((function(e,s){var i=W.get(e);if(i>50?(o.push(!0),i-=50):o.push(!1),-1!==["normal","auto","loose"].indexOf(t)&&-1!==[8208,8211,12316,12448].indexOf(e))return n.push(s),r.push(16);if(4===i||11===i){if(0===s)return n.push(s),r.push(P);var a=r[s-1];return-1===ee.indexOf(a)?(n.push(n[s-1]),r.push(a)):(n.push(s),r.push(P))}return n.push(s),31===i?r.push("strict"===t?F:D):i===q||29===i?r.push(P):43===i?e>=131072&&e<=196605||e>=196608&&e<=262141?r.push(D):r.push(P):void r.push(i)})),[n,r,o]}(e,t.lineBreak),n=r[0],o=r[1],s=r[2];return"break-all"!==t.wordBreak&&"break-word"!==t.wordBreak||(o=o.map((function(e){return-1!==[L,P,q].indexOf(e)?D:e}))),[n,o,"keep-all"===t.wordBreak?s.map((function(t,r){return t&&e[r]>=19968&&e[r]<=40959})):void 0]},ae=function(){function e(e,t,r,n){this.codePoints=e,this.required="!"===t,this.start=r,this.end=n}return e.prototype.slice=function(){return A.apply(void 0,this.codePoints.slice(this.start,this.end))},e}();!function(e){e[e.STRING_TOKEN=0]="STRING_TOKEN",e[e.BAD_STRING_TOKEN=1]="BAD_STRING_TOKEN",e[e.LEFT_PARENTHESIS_TOKEN=2]="LEFT_PARENTHESIS_TOKEN",e[e.RIGHT_PARENTHESIS_TOKEN=3]="RIGHT_PARENTHESIS_TOKEN",e[e.COMMA_TOKEN=4]="COMMA_TOKEN",e[e.HASH_TOKEN=5]="HASH_TOKEN",e[e.DELIM_TOKEN=6]="DELIM_TOKEN",e[e.AT_KEYWORD_TOKEN=7]="AT_KEYWORD_TOKEN",e[e.PREFIX_MATCH_TOKEN=8]="PREFIX_MATCH_TOKEN",e[e.DASH_MATCH_TOKEN=9]="DASH_MATCH_TOKEN",e[e.INCLUDE_MATCH_TOKEN=10]="INCLUDE_MATCH_TOKEN",e[e.LEFT_CURLY_BRACKET_TOKEN=11]="LEFT_CURLY_BRACKET_TOKEN",e[e.RIGHT_CURLY_BRACKET_TOKEN=12]="RIGHT_CURLY_BRACKET_TOKEN",e[e.SUFFIX_MATCH_TOKEN=13]="SUFFIX_MATCH_TOKEN",e[e.SUBSTRING_MATCH_TOKEN=14]="SUBSTRING_MATCH_TOKEN",e[e.DIMENSION_TOKEN=15]="DIMENSION_TOKEN",e[e.PERCENTAGE_TOKEN=16]="PERCENTAGE_TOKEN",e[e.NUMBER_TOKEN=17]="NUMBER_TOKEN",e[e.FUNCTION=18]="FUNCTION",e[e.FUNCTION_TOKEN=19]="FUNCTION_TOKEN",e[e.IDENT_TOKEN=20]="IDENT_TOKEN",e[e.COLUMN_TOKEN=21]="COLUMN_TOKEN",e[e.URL_TOKEN=22]="URL_TOKEN",e[e.BAD_URL_TOKEN=23]="BAD_URL_TOKEN",e[e.CDC_TOKEN=24]="CDC_TOKEN",e[e.CDO_TOKEN=25]="CDO_TOKEN",e[e.COLON_TOKEN=26]="COLON_TOKEN",e[e.SEMICOLON_TOKEN=27]="SEMICOLON_TOKEN",e[e.LEFT_SQUARE_BRACKET_TOKEN=28]="LEFT_SQUARE_BRACKET_TOKEN",e[e.RIGHT_SQUARE_BRACKET_TOKEN=29]="RIGHT_SQUARE_BRACKET_TOKEN",e[e.UNICODE_RANGE_TOKEN=30]="UNICODE_RANGE_TOKEN",e[e.WHITESPACE_TOKEN=31]="WHITESPACE_TOKEN",e[e.EOF_TOKEN=32]="EOF_TOKEN"}(d||(d={}));var Ae=45,ue=43,ce=-1,le=function(e){return e>=48&&e<=57},de=function(e){return le(e)||e>=65&&e<=70||e>=97&&e<=102},fe=function(e){return 10===e||9===e||32===e},he=function(e){return function(e){return function(e){return e>=97&&e<=122}(e)||function(e){return e>=65&&e<=90}(e)}(e)||function(e){return e>=128}(e)||95===e},pe=function(e){return he(e)||le(e)||e===Ae},me=function(e){return e>=0&&e<=8||11===e||e>=14&&e<=31||127===e},ge=function(e,t){return 92===e&&10!==t},ye=function(e,t,r){return e===Ae?he(t)||ge(t,r):!!he(e)||!(92!==e||!ge(e,t))},ve=function(e,t,r){return e===ue||e===Ae?!!le(t)||46===t&&le(r):le(46===e?t:e)},we=function(e){var t=0,r=1;e[t]!==ue&&e[t]!==Ae||(e[t]===Ae&&(r=-1),t++);for(var n=[];le(e[t]);)n.push(e[t++]);var o=n.length?parseInt(A.apply(void 0,n),10):0;46===e[t]&&t++;for(var s=[];le(e[t]);)s.push(e[t++]);var i=s.length,a=i?parseInt(A.apply(void 0,s),10):0;69!==e[t]&&101!==e[t]||t++;var u=1;e[t]!==ue&&e[t]!==Ae||(e[t]===Ae&&(u=-1),t++);for(var c=[];le(e[t]);)c.push(e[t++]);var l=c.length?parseInt(A.apply(void 0,c),10):0;return r*(o+a*Math.pow(10,-i))*Math.pow(10,u*l)},be={type:d.LEFT_PARENTHESIS_TOKEN},Be={type:d.RIGHT_PARENTHESIS_TOKEN},je={type:d.COMMA_TOKEN},_e={type:d.SUFFIX_MATCH_TOKEN},Ce={type:d.PREFIX_MATCH_TOKEN},xe={type:d.COLUMN_TOKEN},Ee={type:d.DASH_MATCH_TOKEN},Ne={type:d.INCLUDE_MATCH_TOKEN},Qe={type:d.LEFT_CURLY_BRACKET_TOKEN},Fe={type:d.RIGHT_CURLY_BRACKET_TOKEN},Ue={type:d.SUBSTRING_MATCH_TOKEN},Se={type:d.BAD_URL_TOKEN},Le={type:d.BAD_STRING_TOKEN},Te={type:d.CDO_TOKEN},He={type:d.CDC_TOKEN},Ie={type:d.COLON_TOKEN},Pe={type:d.SEMICOLON_TOKEN},Oe={type:d.LEFT_SQUARE_BRACKET_TOKEN},ke={type:d.RIGHT_SQUARE_BRACKET_TOKEN},Re={type:d.WHITESPACE_TOKEN},Me={type:d.EOF_TOKEN},De=function(){function e(){this._value=[]}return e.prototype.write=function(e){this._value=this._value.concat(a(e))},e.prototype.read=function(){for(var e=[],t=this.consumeToken();t!==Me;)e.push(t),t=this.consumeToken();return e},e.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case 34:return this.consumeStringToken(34);case 35:var t=this.peekCodePoint(0),r=this.peekCodePoint(1),n=this.peekCodePoint(2);if(pe(t)||ge(r,n)){var o=ye(t,r,n)?2:1,s=this.consumeName();return{type:d.HASH_TOKEN,value:s,flags:o}}break;case 36:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),_e;break;case 39:return this.consumeStringToken(39);case 40:return be;case 41:return Be;case 42:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Ue;break;case ue:if(ve(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case 44:return je;case Ae:var i=e,a=this.peekCodePoint(0),u=this.peekCodePoint(1);if(ve(i,a,u))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(ye(i,a,u))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(a===Ae&&62===u)return this.consumeCodePoint(),this.consumeCodePoint(),He;break;case 46:if(ve(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case 47:if(42===this.peekCodePoint(0))for(this.consumeCodePoint();;){var c=this.consumeCodePoint();if(42===c&&47===(c=this.consumeCodePoint()))return this.consumeToken();if(c===ce)return this.consumeToken()}break;case 58:return Ie;case 59:return Pe;case 60:if(33===this.peekCodePoint(0)&&this.peekCodePoint(1)===Ae&&this.peekCodePoint(2)===Ae)return this.consumeCodePoint(),this.consumeCodePoint(),Te;break;case 64:var l=this.peekCodePoint(0),f=this.peekCodePoint(1),h=this.peekCodePoint(2);if(ye(l,f,h))return s=this.consumeName(),{type:d.AT_KEYWORD_TOKEN,value:s};break;case 91:return Oe;case 92:if(ge(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case 93:return ke;case 61:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Ce;break;case 123:return Qe;case 125:return Fe;case 117:case 85:var p=this.peekCodePoint(0),m=this.peekCodePoint(1);return p!==ue||!de(m)&&63!==m||(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case 124:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Ee;if(124===this.peekCodePoint(0))return this.consumeCodePoint(),xe;break;case 126:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Ne;break;case ce:return Me}return fe(e)?(this.consumeWhiteSpace(),Re):le(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):he(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:d.DELIM_TOKEN,value:A(e)}},e.prototype.consumeCodePoint=function(){var e=this._value.shift();return void 0===e?-1:e},e.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},e.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},e.prototype.consumeUnicodeRangeToken=function(){for(var e=[],t=this.consumeCodePoint();de(t)&&e.length<6;)e.push(t),t=this.consumeCodePoint();for(var r=!1;63===t&&e.length<6;)e.push(t),t=this.consumeCodePoint(),r=!0;if(r){var n=parseInt(A.apply(void 0,e.map((function(e){return 63===e?48:e}))),16),o=parseInt(A.apply(void 0,e.map((function(e){return 63===e?70:e}))),16);return{type:d.UNICODE_RANGE_TOKEN,start:n,end:o}}var s=parseInt(A.apply(void 0,e),16);if(this.peekCodePoint(0)===Ae&&de(this.peekCodePoint(1))){this.consumeCodePoint(),t=this.consumeCodePoint();for(var i=[];de(t)&&i.length<6;)i.push(t),t=this.consumeCodePoint();return o=parseInt(A.apply(void 0,i),16),{type:d.UNICODE_RANGE_TOKEN,start:s,end:o}}return{type:d.UNICODE_RANGE_TOKEN,start:s,end:s}},e.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return"url"===e.toLowerCase()&&40===this.peekCodePoint(0)?(this.consumeCodePoint(),this.consumeUrlToken()):40===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:d.FUNCTION_TOKEN,value:e}):{type:d.IDENT_TOKEN,value:e}},e.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===ce)return{type:d.URL_TOKEN,value:""};var t=this.peekCodePoint(0);if(39===t||34===t){var r=this.consumeStringToken(this.consumeCodePoint());return r.type===d.STRING_TOKEN&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===ce||41===this.peekCodePoint(0))?(this.consumeCodePoint(),{type:d.URL_TOKEN,value:r.value}):(this.consumeBadUrlRemnants(),Se)}for(;;){var n=this.consumeCodePoint();if(n===ce||41===n)return{type:d.URL_TOKEN,value:A.apply(void 0,e)};if(fe(n))return this.consumeWhiteSpace(),this.peekCodePoint(0)===ce||41===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:d.URL_TOKEN,value:A.apply(void 0,e)}):(this.consumeBadUrlRemnants(),Se);if(34===n||39===n||40===n||me(n))return this.consumeBadUrlRemnants(),Se;if(92===n){if(!ge(n,this.peekCodePoint(0)))return this.consumeBadUrlRemnants(),Se;e.push(this.consumeEscapedCodePoint())}else e.push(n)}},e.prototype.consumeWhiteSpace=function(){for(;fe(this.peekCodePoint(0));)this.consumeCodePoint()},e.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(41===e||e===ce)return;ge(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},e.prototype.consumeStringSlice=function(e){for(var t="";e>0;){var r=Math.min(6e4,e);t+=A.apply(void 0,this._value.splice(0,r)),e-=r}return this._value.shift(),t},e.prototype.consumeStringToken=function(e){for(var t="",r=0;;){var n=this._value[r];if(n===ce||void 0===n||n===e)return t+=this.consumeStringSlice(r),{type:d.STRING_TOKEN,value:t};if(10===n)return this._value.splice(0,r),Le;if(92===n){var o=this._value[r+1];o!==ce&&void 0!==o&&(10===o?(t+=this.consumeStringSlice(r),r=-1,this._value.shift()):ge(n,o)&&(t+=this.consumeStringSlice(r),t+=A(this.consumeEscapedCodePoint()),r=-1))}r++}},e.prototype.consumeNumber=function(){var e=[],t=4,r=this.peekCodePoint(0);for(r!==ue&&r!==Ae||e.push(this.consumeCodePoint());le(this.peekCodePoint(0));)e.push(this.consumeCodePoint());r=this.peekCodePoint(0);var n=this.peekCodePoint(1);if(46===r&&le(n))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=8;le(this.peekCodePoint(0));)e.push(this.consumeCodePoint());r=this.peekCodePoint(0),n=this.peekCodePoint(1);var o=this.peekCodePoint(2);if((69===r||101===r)&&((n===ue||n===Ae)&&le(o)||le(n)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=8;le(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[we(e),t]},e.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),t=e[0],r=e[1],n=this.peekCodePoint(0),o=this.peekCodePoint(1),s=this.peekCodePoint(2);if(ye(n,o,s)){var i=this.consumeName();return{type:d.DIMENSION_TOKEN,number:t,flags:r,unit:i}}return 37===n?(this.consumeCodePoint(),{type:d.PERCENTAGE_TOKEN,number:t,flags:r}):{type:d.NUMBER_TOKEN,number:t,flags:r}},e.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(de(e)){for(var t=A(e);de(this.peekCodePoint(0))&&t.length<6;)t+=A(this.consumeCodePoint());fe(this.peekCodePoint(0))&&this.consumeCodePoint();var r=parseInt(t,16);return 0===r||function(e){return e>=55296&&e<=57343}(r)||r>1114111?65533:r}return e===ce?65533:e},e.prototype.consumeName=function(){for(var e="";;){var t=this.consumeCodePoint();if(pe(t))e+=A(t);else{if(!ge(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),e;e+=A(this.consumeEscapedCodePoint())}}},e}(),Ke=function(){function e(e){this._tokens=e}return e.create=function(t){var r=new De;return r.write(t),new e(r.read())},e.parseValue=function(t){return e.create(t).parseComponentValue()},e.parseValues=function(t){return e.create(t).parseComponentValues()},e.prototype.parseComponentValue=function(){for(var e=this.consumeToken();e.type===d.WHITESPACE_TOKEN;)e=this.consumeToken();if(e.type===d.EOF_TOKEN)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var t=this.consumeComponentValue();do{e=this.consumeToken()}while(e.type===d.WHITESPACE_TOKEN);if(e.type===d.EOF_TOKEN)return t;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},e.prototype.parseComponentValues=function(){for(var e=[];;){var t=this.consumeComponentValue();if(t.type===d.EOF_TOKEN)return e;e.push(t),e.push()}},e.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case d.LEFT_CURLY_BRACKET_TOKEN:case d.LEFT_SQUARE_BRACKET_TOKEN:case d.LEFT_PARENTHESIS_TOKEN:return this.consumeSimpleBlock(e.type);case d.FUNCTION_TOKEN:return this.consumeFunction(e)}return e},e.prototype.consumeSimpleBlock=function(e){for(var t={type:e,values:[]},r=this.consumeToken();;){if(r.type===d.EOF_TOKEN||Ze(r,e))return t;this.reconsumeToken(r),t.values.push(this.consumeComponentValue()),r=this.consumeToken()}},e.prototype.consumeFunction=function(e){for(var t={name:e.value,values:[],type:d.FUNCTION};;){var r=this.consumeToken();if(r.type===d.EOF_TOKEN||r.type===d.RIGHT_PARENTHESIS_TOKEN)return t;this.reconsumeToken(r),t.values.push(this.consumeComponentValue())}},e.prototype.consumeToken=function(){var e=this._tokens.shift();return void 0===e?Me:e},e.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},e}(),ze=function(e){return e.type===d.DIMENSION_TOKEN},Ve=function(e){return e.type===d.NUMBER_TOKEN},qe=function(e){return e.type===d.IDENT_TOKEN},Ge=function(e){return e.type===d.STRING_TOKEN},Xe=function(e,t){return qe(e)&&e.value===t},We=function(e){return e.type!==d.WHITESPACE_TOKEN},Je=function(e){return e.type!==d.WHITESPACE_TOKEN&&e.type!==d.COMMA_TOKEN},Ye=function(e){var t=[],r=[];return e.forEach((function(e){if(e.type===d.COMMA_TOKEN){if(0===r.length)throw new Error("Error parsing function args, zero tokens for arg");return t.push(r),void(r=[])}e.type!==d.WHITESPACE_TOKEN&&r.push(e)})),r.length&&t.push(r),t},Ze=function(e,t){return t===d.LEFT_CURLY_BRACKET_TOKEN&&e.type===d.RIGHT_CURLY_BRACKET_TOKEN||t===d.LEFT_SQUARE_BRACKET_TOKEN&&e.type===d.RIGHT_SQUARE_BRACKET_TOKEN||t===d.LEFT_PARENTHESIS_TOKEN&&e.type===d.RIGHT_PARENTHESIS_TOKEN},$e=function(e){return e.type===d.NUMBER_TOKEN||e.type===d.DIMENSION_TOKEN},et=function(e){return e.type===d.PERCENTAGE_TOKEN||$e(e)},tt=function(e){return e.length>1?[e[0],e[1]]:[e[0]]},rt={type:d.NUMBER_TOKEN,number:0,flags:4},nt={type:d.PERCENTAGE_TOKEN,number:50,flags:4},ot={type:d.PERCENTAGE_TOKEN,number:100,flags:4},st=function(e,t,r){var n=e[0],o=e[1];return[it(n,t),it(void 0!==o?o:n,r)]},it=function(e,t){if(e.type===d.PERCENTAGE_TOKEN)return e.number/100*t;if(ze(e))switch(e.unit){case"rem":case"em":return 16*e.number;case"px":default:return e.number}return e.number},at="grad",At="turn",ut=function(e){if(e.type===d.DIMENSION_TOKEN)switch(e.unit){case"deg":return Math.PI*e.number/180;case at:return Math.PI/200*e.number;case"rad":return e.number;case At:return 2*Math.PI*e.number}throw new Error("Unsupported angle type")},ct=function(e){return e.type===d.DIMENSION_TOKEN&&("deg"===e.unit||e.unit===at||"rad"===e.unit||e.unit===At)},lt=function(e){switch(e.filter(qe).map((function(e){return e.value})).join(" ")){case"to bottom right":case"to right bottom":case"left top":case"top left":return[rt,rt];case"to top":case"bottom":return dt(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[rt,ot];case"to right":case"left":return dt(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[ot,ot];case"to bottom":case"top":return dt(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[ot,rt];case"to left":case"right":return dt(270)}return 0},dt=function(e){return Math.PI*e/180},ft=function(e){if(e.type===d.FUNCTION){var t=jt[e.name];if(void 0===t)throw new Error('Attempting to parse an unsupported color function "'+e.name+'"');return t(e.values)}if(e.type===d.HASH_TOKEN){if(3===e.value.length){var r=e.value.substring(0,1),n=e.value.substring(1,2),o=e.value.substring(2,3);return mt(parseInt(r+r,16),parseInt(n+n,16),parseInt(o+o,16),1)}if(4===e.value.length){r=e.value.substring(0,1),n=e.value.substring(1,2),o=e.value.substring(2,3);var s=e.value.substring(3,4);return mt(parseInt(r+r,16),parseInt(n+n,16),parseInt(o+o,16),parseInt(s+s,16)/255)}if(6===e.value.length)return r=e.value.substring(0,2),n=e.value.substring(2,4),o=e.value.substring(4,6),mt(parseInt(r,16),parseInt(n,16),parseInt(o,16),1);if(8===e.value.length)return r=e.value.substring(0,2),n=e.value.substring(2,4),o=e.value.substring(4,6),s=e.value.substring(6,8),mt(parseInt(r,16),parseInt(n,16),parseInt(o,16),parseInt(s,16)/255)}if(e.type===d.IDENT_TOKEN){var i=_t[e.value.toUpperCase()];if(void 0!==i)return i}return _t.TRANSPARENT},ht=function(e){return 0==(255&e)},pt=function(e){var t=255&e,r=255&e>>8,n=255&e>>16,o=255&e>>24;return t<255?"rgba("+o+","+n+","+r+","+t/255+")":"rgb("+o+","+n+","+r+")"},mt=function(e,t,r,n){return(e<<24|t<<16|r<<8|Math.round(255*n)<<0)>>>0},gt=function(e,t){if(e.type===d.NUMBER_TOKEN)return e.number;if(e.type===d.PERCENTAGE_TOKEN){var r=3===t?1:255;return 3===t?e.number/100*r:Math.round(e.number/100*r)}return 0},yt=function(e){var t=e.filter(Je);if(3===t.length){var r=t.map(gt),n=r[0],o=r[1],s=r[2];return mt(n,o,s,1)}if(4===t.length){var i=t.map(gt),a=(n=i[0],o=i[1],s=i[2],i[3]);return mt(n,o,s,a)}return 0};function vt(e,t,r){return r<0&&(r+=1),r>=1&&(r-=1),r<1/6?(t-e)*r*6+e:r<.5?t:r<2/3?6*(t-e)*(2/3-r)+e:e}var wt,bt,Bt=function(e){var t=e.filter(Je),r=t[0],n=t[1],o=t[2],s=t[3],i=(r.type===d.NUMBER_TOKEN?dt(r.number):ut(r))/(2*Math.PI),a=et(n)?n.number/100:0,A=et(o)?o.number/100:0,u=void 0!==s&&et(s)?it(s,1):1;if(0===a)return mt(255*A,255*A,255*A,1);var c=A<=.5?A*(a+1):A+a-A*a,l=2*A-c,f=vt(l,c,i+1/3),h=vt(l,c,i),p=vt(l,c,i-1/3);return mt(255*f,255*h,255*p,u)},jt={hsl:Bt,hsla:Bt,rgb:yt,rgba:yt},_t={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199};(function(e){e[e.VALUE=0]="VALUE",e[e.LIST=1]="LIST",e[e.IDENT_VALUE=2]="IDENT_VALUE",e[e.TYPE_VALUE=3]="TYPE_VALUE",e[e.TOKEN_VALUE=4]="TOKEN_VALUE"})(wt||(wt={})),function(e){e[e.BORDER_BOX=0]="BORDER_BOX",e[e.PADDING_BOX=1]="PADDING_BOX",e[e.CONTENT_BOX=2]="CONTENT_BOX"}(bt||(bt={}));var Ct,xt={name:"background-clip",initialValue:"border-box",prefix:!1,type:wt.LIST,parse:function(e){return e.map((function(e){if(qe(e))switch(e.value){case"padding-box":return bt.PADDING_BOX;case"content-box":return bt.CONTENT_BOX}return bt.BORDER_BOX}))}},Et={name:"background-color",initialValue:"transparent",prefix:!1,type:wt.TYPE_VALUE,format:"color"},Nt=function(e){var t=ft(e[0]),r=e[1];return r&&et(r)?{color:t,stop:r}:{color:t,stop:null}},Qt=function(e,t){var r=e[0],n=e[e.length-1];null===r.stop&&(r.stop=rt),null===n.stop&&(n.stop=ot);for(var o=[],s=0,i=0;i<e.length;i++){var a=e[i].stop;if(null!==a){var A=it(a,t);A>s?o.push(A):o.push(s),s=A}else o.push(null)}var u=null;for(i=0;i<o.length;i++){var c=o[i];if(null===c)null===u&&(u=i);else if(null!==u){for(var l=i-u,d=(c-o[u-1])/(l+1),f=1;f<=l;f++)o[u+f-1]=d*f;u=null}}return e.map((function(e,r){return{color:e.color,stop:Math.max(Math.min(1,o[r]/t),0)}}))},Ft=function(e,t,r){var n="number"==typeof e?e:function(e,t,r){var n=t/2,o=r/2,s=it(e[0],t)-n,i=o-it(e[1],r);return(Math.atan2(i,s)+2*Math.PI)%(2*Math.PI)}(e,t,r),o=Math.abs(t*Math.sin(n))+Math.abs(r*Math.cos(n)),s=t/2,i=r/2,a=o/2,A=Math.sin(n-Math.PI/2)*a,u=Math.cos(n-Math.PI/2)*a;return[o,s-u,s+u,i-A,i+A]},Ut=function(e,t){return Math.sqrt(e*e+t*t)},St=function(e,t,r,n,o){return[[0,0],[0,t],[e,0],[e,t]].reduce((function(e,t){var s=t[0],i=t[1],a=Ut(r-s,n-i);return(o?a<e.optimumDistance:a>e.optimumDistance)?{optimumCorner:t,optimumDistance:a}:e}),{optimumDistance:o?1/0:-1/0,optimumCorner:null}).optimumCorner},Lt=function(e){var t=dt(180),r=[];return Ye(e).forEach((function(e,n){if(0===n){var o=e[0];if(o.type===d.IDENT_TOKEN&&-1!==["top","left","right","bottom"].indexOf(o.value))return void(t=lt(e));if(ct(o))return void(t=(ut(o)+dt(270))%dt(360))}var s=Nt(e);r.push(s)})),{angle:t,stops:r,type:Ct.LINEAR_GRADIENT}},Tt=function(e){return 0===e[0]&&255===e[1]&&0===e[2]&&255===e[3]},Ht=function(e,t,r,n,o){var s="http://www.w3.org/2000/svg",i=document.createElementNS(s,"svg"),a=document.createElementNS(s,"foreignObject");return i.setAttributeNS(null,"width",e.toString()),i.setAttributeNS(null,"height",t.toString()),a.setAttributeNS(null,"width","100%"),a.setAttributeNS(null,"height","100%"),a.setAttributeNS(null,"x",r.toString()),a.setAttributeNS(null,"y",n.toString()),a.setAttributeNS(null,"externalResourcesRequired","true"),i.appendChild(a),a.appendChild(o),i},It=function(e){return new Promise((function(t,r){var n=new Image;n.onload=function(){return t(n)},n.onerror=r,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))}))},Pt={get SUPPORT_RANGE_BOUNDS(){var e=function(e){if(e.createRange){var t=e.createRange();if(t.getBoundingClientRect){var r=e.createElement("boundtest");r.style.height="123px",r.style.display="block",e.body.appendChild(r),t.selectNode(r);var n=t.getBoundingClientRect(),o=Math.round(n.height);if(e.body.removeChild(r),123===o)return!0}}return!1}(document);return Object.defineProperty(Pt,"SUPPORT_RANGE_BOUNDS",{value:e}),e},get SUPPORT_SVG_DRAWING(){var e=function(e){var t=new Image,r=e.createElement("canvas"),n=r.getContext("2d");if(!n)return!1;t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{n.drawImage(t,0,0),r.toDataURL()}catch(e){return!1}return!0}(document);return Object.defineProperty(Pt,"SUPPORT_SVG_DRAWING",{value:e}),e},get SUPPORT_FOREIGNOBJECT_DRAWING(){var e="function"==typeof Array.from&&"function"==typeof window.fetch?function(e){var t=e.createElement("canvas"),r=100;t.width=r,t.height=r;var n=t.getContext("2d");if(!n)return Promise.reject(!1);n.fillStyle="rgb(0, 255, 0)",n.fillRect(0,0,r,r);var o=new Image,s=t.toDataURL();o.src=s;var i=Ht(r,r,0,0,o);return n.fillStyle="red",n.fillRect(0,0,r,r),It(i).then((function(t){n.drawImage(t,0,0);var o=n.getImageData(0,0,r,r).data;n.fillStyle="red",n.fillRect(0,0,r,r);var i=e.createElement("div");return i.style.backgroundImage="url("+s+")",i.style.height="100px",Tt(o)?It(Ht(r,r,0,0,i)):Promise.reject(!1)})).then((function(e){return n.drawImage(e,0,0),Tt(n.getImageData(0,0,r,r).data)})).catch((function(){return!1}))}(document):Promise.resolve(!1);return Object.defineProperty(Pt,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:e}),e},get SUPPORT_CORS_IMAGES(){var e=void 0!==(new Image).crossOrigin;return Object.defineProperty(Pt,"SUPPORT_CORS_IMAGES",{value:e}),e},get SUPPORT_RESPONSE_TYPE(){var e="string"==typeof(new XMLHttpRequest).responseType;return Object.defineProperty(Pt,"SUPPORT_RESPONSE_TYPE",{value:e}),e},get SUPPORT_CORS_XHR(){var e="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Pt,"SUPPORT_CORS_XHR",{value:e}),e}},Ot=function(){function e(e){var t=e.id,r=e.enabled;this.id=t,this.enabled=r,this.start=Date.now()}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.debug?console.debug.apply(console,[this.id,this.getTime()+"ms"].concat(e)):this.info.apply(this,e))},e.prototype.getTime=function(){return Date.now()-this.start},e.create=function(t){e.instances[t.id]=new e(t)},e.destroy=function(t){delete e.instances[t]},e.getInstance=function(t){var r=e.instances[t];if(void 0===r)throw new Error("No logger instance found with id "+t);return r},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&"undefined"!=typeof window&&window.console&&"function"==typeof console.info&&console.info.apply(console,[this.id,this.getTime()+"ms"].concat(e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.error?console.error.apply(console,[this.id,this.getTime()+"ms"].concat(e)):this.info.apply(this,e))},e.instances={},e}(),kt=function(){function e(){}return e.create=function(t,r){return e._caches[t]=new Rt(t,r)},e.destroy=function(t){delete e._caches[t]},e.open=function(t){var r=e._caches[t];if(void 0!==r)return r;throw new Error('Cache with key "'+t+'" not found')},e.getOrigin=function(t){var r=e._link;return r?(r.href=t,r.href=r.href,r.protocol+r.hostname+r.port):"about:blank"},e.isSameOrigin=function(t){return e.getOrigin(t)===e._origin},e.setContext=function(t){e._link=t.document.createElement("a"),e._origin=e.getOrigin(t.location.href)},e.getInstance=function(){var t=e._current;if(null===t)throw new Error("No cache instance attached");return t},e.attachInstance=function(t){e._current=t},e.detachInstance=function(){e._current=null},e._caches={},e._origin="about:blank",e._current=null,e}(),Rt=function(){function e(e,t){this.id=e,this._options=t,this._cache={}}return e.prototype.addImage=function(e){var t=Promise.resolve();return this.has(e)?t:Gt(e)||zt(e)?(this._cache[e]=this.loadImage(e),t):t},e.prototype.match=function(e){return this._cache[e]},e.prototype.loadImage=function(e){return n(this,void 0,void 0,(function(){var t,r,n,s,i=this;return o(this,(function(o){switch(o.label){case 0:return t=kt.isSameOrigin(e),r=!Vt(e)&&!0===this._options.useCORS&&Pt.SUPPORT_CORS_IMAGES&&!t,n=!Vt(e)&&!t&&"string"==typeof this._options.proxy&&Pt.SUPPORT_CORS_XHR&&!r,t||!1!==this._options.allowTaint||Vt(e)||n||r?(s=e,n?[4,this.proxy(s)]:[3,2]):[2];case 1:s=o.sent(),o.label=2;case 2:return Ot.getInstance(this.id).debug("Added image "+e.substring(0,256)),[4,new Promise((function(e,t){var n=new Image;n.onload=function(){return e(n)},n.onerror=t,(qt(s)||r)&&(n.crossOrigin="anonymous"),n.src=s,!0===n.complete&&setTimeout((function(){return e(n)}),500),i._options.imageTimeout>0&&setTimeout((function(){return t("Timed out ("+i._options.imageTimeout+"ms) loading image")}),i._options.imageTimeout)}))];case 3:return[2,o.sent()]}}))}))},e.prototype.has=function(e){return void 0!==this._cache[e]},e.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},e.prototype.proxy=function(e){var t=this,r=this._options.proxy;if(!r)throw new Error("No proxy defined");var n=e.substring(0,256);return new Promise((function(o,s){var i=Pt.SUPPORT_RESPONSE_TYPE?"blob":"text",a=new XMLHttpRequest;if(a.onload=function(){if(200===a.status)if("text"===i)o(a.response);else{var e=new FileReader;e.addEventListener("load",(function(){return o(e.result)}),!1),e.addEventListener("error",(function(e){return s(e)}),!1),e.readAsDataURL(a.response)}else s("Failed to proxy resource "+n+" with status code "+a.status)},a.onerror=s,a.open("GET",r+"?url="+encodeURIComponent(e)+"&responseType="+i),"text"!==i&&a instanceof XMLHttpRequest&&(a.responseType=i),t._options.imageTimeout){var A=t._options.imageTimeout;a.timeout=A,a.ontimeout=function(){return s("Timed out ("+A+"ms) proxying "+n)}}a.send()}))},e}(),Mt=/^data:image\/svg\+xml/i,Dt=/^data:image\/.*;base64,/i,Kt=/^data:image\/.*/i,zt=function(e){return Pt.SUPPORT_SVG_DRAWING||!Xt(e)},Vt=function(e){return Kt.test(e)},qt=function(e){return Dt.test(e)},Gt=function(e){return"blob"===e.substr(0,4)},Xt=function(e){return"svg"===e.substr(-3).toLowerCase()||Mt.test(e)},Wt="closest-side",Jt="farthest-side",Yt="closest-corner",Zt="farthest-corner",$t="circle",er="ellipse",tr="cover",rr="contain",nr=function(e){var t=or.CIRCLE,r=sr.FARTHEST_CORNER,n=[],o=[];return Ye(e).forEach((function(e,s){var i=!0;if(0===s?i=e.reduce((function(e,t){if(qe(t))switch(t.value){case"center":return o.push(nt),!1;case"top":case"left":return o.push(rt),!1;case"right":case"bottom":return o.push(ot),!1}else if(et(t)||$e(t))return o.push(t),!1;return e}),i):1===s&&(i=e.reduce((function(e,n){if(qe(n))switch(n.value){case $t:return t=or.CIRCLE,!1;case er:return t=or.ELLIPSE,!1;case rr:case Wt:return r=sr.CLOSEST_SIDE,!1;case Jt:return r=sr.FARTHEST_SIDE,!1;case Yt:return r=sr.CLOSEST_CORNER,!1;case tr:case Zt:return r=sr.FARTHEST_CORNER,!1}else if($e(n)||et(n))return Array.isArray(r)||(r=[]),r.push(n),!1;return e}),i)),i){var a=Nt(e);n.push(a)}})),{size:r,shape:t,stops:n,position:o,type:Ct.RADIAL_GRADIENT}};!function(e){e[e.URL=0]="URL",e[e.LINEAR_GRADIENT=1]="LINEAR_GRADIENT",e[e.RADIAL_GRADIENT=2]="RADIAL_GRADIENT"}(Ct||(Ct={}));var or,sr;(function(e){e[e.CIRCLE=0]="CIRCLE",e[e.ELLIPSE=1]="ELLIPSE"})(or||(or={})),function(e){e[e.CLOSEST_SIDE=0]="CLOSEST_SIDE",e[e.FARTHEST_SIDE=1]="FARTHEST_SIDE",e[e.CLOSEST_CORNER=2]="CLOSEST_CORNER",e[e.FARTHEST_CORNER=3]="FARTHEST_CORNER"}(sr||(sr={}));var ir=function(e){if(e.type===d.URL_TOKEN){var t={url:e.value,type:Ct.URL};return kt.getInstance().addImage(e.value),t}if(e.type===d.FUNCTION){var r=Ar[e.name];if(void 0===r)throw new Error('Attempting to parse an unsupported image function "'+e.name+'"');return r(e.values)}throw new Error("Unsupported image type")};var ar,Ar={"linear-gradient":function(e){var t=dt(180),r=[];return Ye(e).forEach((function(e,n){if(0===n){var o=e[0];if(o.type===d.IDENT_TOKEN&&"to"===o.value)return void(t=lt(e));if(ct(o))return void(t=ut(o))}var s=Nt(e);r.push(s)})),{angle:t,stops:r,type:Ct.LINEAR_GRADIENT}},"-moz-linear-gradient":Lt,"-ms-linear-gradient":Lt,"-o-linear-gradient":Lt,"-webkit-linear-gradient":Lt,"radial-gradient":function(e){var t=or.CIRCLE,r=sr.FARTHEST_CORNER,n=[],o=[];return Ye(e).forEach((function(e,s){var i=!0;if(0===s){var a=!1;i=e.reduce((function(e,n){if(a)if(qe(n))switch(n.value){case"center":return o.push(nt),e;case"top":case"left":return o.push(rt),e;case"right":case"bottom":return o.push(ot),e}else(et(n)||$e(n))&&o.push(n);else if(qe(n))switch(n.value){case $t:return t=or.CIRCLE,!1;case er:return t=or.ELLIPSE,!1;case"at":return a=!0,!1;case Wt:return r=sr.CLOSEST_SIDE,!1;case tr:case Jt:return r=sr.FARTHEST_SIDE,!1;case rr:case Yt:return r=sr.CLOSEST_CORNER,!1;case Zt:return r=sr.FARTHEST_CORNER,!1}else if($e(n)||et(n))return Array.isArray(r)||(r=[]),r.push(n),!1;return e}),i)}if(i){var A=Nt(e);n.push(A)}})),{size:r,shape:t,stops:n,position:o,type:Ct.RADIAL_GRADIENT}},"-moz-radial-gradient":nr,"-ms-radial-gradient":nr,"-o-radial-gradient":nr,"-webkit-radial-gradient":nr,"-webkit-gradient":function(e){var t=dt(180),r=[],n=Ct.LINEAR_GRADIENT,o=or.CIRCLE,s=sr.FARTHEST_CORNER;return Ye(e).forEach((function(e,t){var o=e[0];if(0===t){if(qe(o)&&"linear"===o.value)return void(n=Ct.LINEAR_GRADIENT);if(qe(o)&&"radial"===o.value)return void(n=Ct.RADIAL_GRADIENT)}if(o.type===d.FUNCTION)if("from"===o.name){var s=ft(o.values[0]);r.push({stop:rt,color:s})}else if("to"===o.name)s=ft(o.values[0]),r.push({stop:ot,color:s});else if("color-stop"===o.name){var i=o.values.filter(Je);if(2===i.length){s=ft(i[1]);var a=i[0];Ve(a)&&r.push({stop:{type:d.PERCENTAGE_TOKEN,number:100*a.number,flags:a.flags},color:s})}}})),n===Ct.LINEAR_GRADIENT?{angle:(t+dt(180))%dt(360),stops:r,type:n}:{size:s,shape:o,stops:r,position:[],type:n}}},ur={name:"background-image",initialValue:"none",type:wt.LIST,prefix:!1,parse:function(e){if(0===e.length)return[];var t=e[0];return t.type===d.IDENT_TOKEN&&"none"===t.value?[]:e.filter((function(e){return Je(e)&&function(e){return e.type!==d.FUNCTION||Ar[e.name]}(e)})).map(ir)}},cr={name:"background-origin",initialValue:"border-box",prefix:!1,type:wt.LIST,parse:function(e){return e.map((function(e){if(qe(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0}))}},lr={name:"background-position",initialValue:"0% 0%",type:wt.LIST,prefix:!1,parse:function(e){return Ye(e).map((function(e){return e.filter(et)})).map(tt)}};!function(e){e[e.REPEAT=0]="REPEAT",e[e.NO_REPEAT=1]="NO_REPEAT",e[e.REPEAT_X=2]="REPEAT_X",e[e.REPEAT_Y=3]="REPEAT_Y"}(ar||(ar={}));var dr,fr={name:"background-repeat",initialValue:"repeat",prefix:!1,type:wt.LIST,parse:function(e){return Ye(e).map((function(e){return e.filter(qe).map((function(e){return e.value})).join(" ")})).map(hr)}},hr=function(e){switch(e){case"no-repeat":return ar.NO_REPEAT;case"repeat-x":case"repeat no-repeat":return ar.REPEAT_X;case"repeat-y":case"no-repeat repeat":return ar.REPEAT_Y;case"repeat":default:return ar.REPEAT}};!function(e){e.AUTO="auto",e.CONTAIN="contain",e.COVER="cover"}(dr||(dr={}));var pr,mr={name:"background-size",initialValue:"0",prefix:!1,type:wt.LIST,parse:function(e){return Ye(e).map((function(e){return e.filter(gr)}))}},gr=function(e){return qe(e)||et(e)},yr=function(e){return{name:"border-"+e+"-color",initialValue:"transparent",prefix:!1,type:wt.TYPE_VALUE,format:"color"}},vr=yr("top"),wr=yr("right"),br=yr("bottom"),Br=yr("left"),jr=function(e){return{name:"border-radius-"+e,initialValue:"0 0",prefix:!1,type:wt.LIST,parse:function(e){return tt(e.filter(et))}}},_r=jr("top-left"),Cr=jr("top-right"),xr=jr("bottom-right"),Er=jr("bottom-left");!function(e){e[e.NONE=0]="NONE",e[e.SOLID=1]="SOLID",e[e.DASHED=2]="DASHED",e[e.DOTTED=3]="DOTTED",e[e.DOUBLE=4]="DOUBLE"}(pr||(pr={}));var Nr,Qr=function(e){return{name:"border-"+e+"-style",initialValue:"solid",prefix:!1,type:wt.IDENT_VALUE,parse:function(e){switch(e){case"none":return pr.NONE;case"dashed":return pr.DASHED;case"dotted":return pr.DOTTED;case"double":return pr.DOUBLE}return pr.SOLID}}},Fr=Qr("top"),Ur=Qr("right"),Sr=Qr("bottom"),Lr=Qr("left"),Tr=function(e){return{name:"border-"+e+"-width",initialValue:"0",type:wt.VALUE,prefix:!1,parse:function(e){return ze(e)?e.number:0}}},Hr=Tr("top"),Ir=Tr("right"),Pr=Tr("bottom"),Or=Tr("left"),kr={name:"color",initialValue:"transparent",prefix:!1,type:wt.TYPE_VALUE,format:"color"},Rr={name:"display",initialValue:"inline-block",prefix:!1,type:wt.LIST,parse:function(e){return e.filter(qe).reduce((function(e,t){return e|Mr(t.value)}),0)}},Mr=function(e){switch(e){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0};!function(e){e[e.NONE=0]="NONE",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.INLINE_START=3]="INLINE_START",e[e.INLINE_END=4]="INLINE_END"}(Nr||(Nr={}));var Dr,Kr={name:"float",initialValue:"none",prefix:!1,type:wt.IDENT_VALUE,parse:function(e){switch(e){case"left":return Nr.LEFT;case"right":return Nr.RIGHT;case"inline-start":return Nr.INLINE_START;case"inline-end":return Nr.INLINE_END}return Nr.NONE}},zr={name:"letter-spacing",initialValue:"0",prefix:!1,type:wt.VALUE,parse:function(e){return e.type===d.IDENT_TOKEN&&"normal"===e.value?0:e.type===d.NUMBER_TOKEN||e.type===d.DIMENSION_TOKEN?e.number:0}};!function(e){e.NORMAL="normal",e.STRICT="strict"}(Dr||(Dr={}));var Vr,qr={name:"line-break",initialValue:"normal",prefix:!1,type:wt.IDENT_VALUE,parse:function(e){switch(e){case"strict":return Dr.STRICT;case"normal":default:return Dr.NORMAL}}},Gr={name:"line-height",initialValue:"normal",prefix:!1,type:wt.TOKEN_VALUE},Xr={name:"list-style-image",initialValue:"none",type:wt.VALUE,prefix:!1,parse:function(e){return e.type===d.IDENT_TOKEN&&"none"===e.value?null:ir(e)}};!function(e){e[e.INSIDE=0]="INSIDE",e[e.OUTSIDE=1]="OUTSIDE"}(Vr||(Vr={}));var Wr,Jr={name:"list-style-position",initialValue:"outside",prefix:!1,type:wt.IDENT_VALUE,parse:function(e){switch(e){case"inside":return Vr.INSIDE;case"outside":default:return Vr.OUTSIDE}}};!function(e){e[e.NONE=-1]="NONE",e[e.DISC=0]="DISC",e[e.CIRCLE=1]="CIRCLE",e[e.SQUARE=2]="SQUARE",e[e.DECIMAL=3]="DECIMAL",e[e.CJK_DECIMAL=4]="CJK_DECIMAL",e[e.DECIMAL_LEADING_ZERO=5]="DECIMAL_LEADING_ZERO",e[e.LOWER_ROMAN=6]="LOWER_ROMAN",e[e.UPPER_ROMAN=7]="UPPER_ROMAN",e[e.LOWER_GREEK=8]="LOWER_GREEK",e[e.LOWER_ALPHA=9]="LOWER_ALPHA",e[e.UPPER_ALPHA=10]="UPPER_ALPHA",e[e.ARABIC_INDIC=11]="ARABIC_INDIC",e[e.ARMENIAN=12]="ARMENIAN",e[e.BENGALI=13]="BENGALI",e[e.CAMBODIAN=14]="CAMBODIAN",e[e.CJK_EARTHLY_BRANCH=15]="CJK_EARTHLY_BRANCH",e[e.CJK_HEAVENLY_STEM=16]="CJK_HEAVENLY_STEM",e[e.CJK_IDEOGRAPHIC=17]="CJK_IDEOGRAPHIC",e[e.DEVANAGARI=18]="DEVANAGARI",e[e.ETHIOPIC_NUMERIC=19]="ETHIOPIC_NUMERIC",e[e.GEORGIAN=20]="GEORGIAN",e[e.GUJARATI=21]="GUJARATI",e[e.GURMUKHI=22]="GURMUKHI",e[e.HEBREW=22]="HEBREW",e[e.HIRAGANA=23]="HIRAGANA",e[e.HIRAGANA_IROHA=24]="HIRAGANA_IROHA",e[e.JAPANESE_FORMAL=25]="JAPANESE_FORMAL",e[e.JAPANESE_INFORMAL=26]="JAPANESE_INFORMAL",e[e.KANNADA=27]="KANNADA",e[e.KATAKANA=28]="KATAKANA",e[e.KATAKANA_IROHA=29]="KATAKANA_IROHA",e[e.KHMER=30]="KHMER",e[e.KOREAN_HANGUL_FORMAL=31]="KOREAN_HANGUL_FORMAL",e[e.KOREAN_HANJA_FORMAL=32]="KOREAN_HANJA_FORMAL",e[e.KOREAN_HANJA_INFORMAL=33]="KOREAN_HANJA_INFORMAL",e[e.LAO=34]="LAO",e[e.LOWER_ARMENIAN=35]="LOWER_ARMENIAN",e[e.MALAYALAM=36]="MALAYALAM",e[e.MONGOLIAN=37]="MONGOLIAN",e[e.MYANMAR=38]="MYANMAR",e[e.ORIYA=39]="ORIYA",e[e.PERSIAN=40]="PERSIAN",e[e.SIMP_CHINESE_FORMAL=41]="SIMP_CHINESE_FORMAL",e[e.SIMP_CHINESE_INFORMAL=42]="SIMP_CHINESE_INFORMAL",e[e.TAMIL=43]="TAMIL",e[e.TELUGU=44]="TELUGU",e[e.THAI=45]="THAI",e[e.TIBETAN=46]="TIBETAN",e[e.TRAD_CHINESE_FORMAL=47]="TRAD_CHINESE_FORMAL",e[e.TRAD_CHINESE_INFORMAL=48]="TRAD_CHINESE_INFORMAL",e[e.UPPER_ARMENIAN=49]="UPPER_ARMENIAN",e[e.DISCLOSURE_OPEN=50]="DISCLOSURE_OPEN",e[e.DISCLOSURE_CLOSED=51]="DISCLOSURE_CLOSED"}(Wr||(Wr={}));var Yr,Zr={name:"list-style-type",initialValue:"none",prefix:!1,type:wt.IDENT_VALUE,parse:function(e){switch(e){case"disc":return Wr.DISC;case"circle":return Wr.CIRCLE;case"square":return Wr.SQUARE;case"decimal":return Wr.DECIMAL;case"cjk-decimal":return Wr.CJK_DECIMAL;case"decimal-leading-zero":return Wr.DECIMAL_LEADING_ZERO;case"lower-roman":return Wr.LOWER_ROMAN;case"upper-roman":return Wr.UPPER_ROMAN;case"lower-greek":return Wr.LOWER_GREEK;case"lower-alpha":return Wr.LOWER_ALPHA;case"upper-alpha":return Wr.UPPER_ALPHA;case"arabic-indic":return Wr.ARABIC_INDIC;case"armenian":return Wr.ARMENIAN;case"bengali":return Wr.BENGALI;case"cambodian":return Wr.CAMBODIAN;case"cjk-earthly-branch":return Wr.CJK_EARTHLY_BRANCH;case"cjk-heavenly-stem":return Wr.CJK_HEAVENLY_STEM;case"cjk-ideographic":return Wr.CJK_IDEOGRAPHIC;case"devanagari":return Wr.DEVANAGARI;case"ethiopic-numeric":return Wr.ETHIOPIC_NUMERIC;case"georgian":return Wr.GEORGIAN;case"gujarati":return Wr.GUJARATI;case"gurmukhi":return Wr.GURMUKHI;case"hebrew":return Wr.HEBREW;case"hiragana":return Wr.HIRAGANA;case"hiragana-iroha":return Wr.HIRAGANA_IROHA;case"japanese-formal":return Wr.JAPANESE_FORMAL;case"japanese-informal":return Wr.JAPANESE_INFORMAL;case"kannada":return Wr.KANNADA;case"katakana":return Wr.KATAKANA;case"katakana-iroha":return Wr.KATAKANA_IROHA;case"khmer":return Wr.KHMER;case"korean-hangul-formal":return Wr.KOREAN_HANGUL_FORMAL;case"korean-hanja-formal":return Wr.KOREAN_HANJA_FORMAL;case"korean-hanja-informal":return Wr.KOREAN_HANJA_INFORMAL;case"lao":return Wr.LAO;case"lower-armenian":return Wr.LOWER_ARMENIAN;case"malayalam":return Wr.MALAYALAM;case"mongolian":return Wr.MONGOLIAN;case"myanmar":return Wr.MYANMAR;case"oriya":return Wr.ORIYA;case"persian":return Wr.PERSIAN;case"simp-chinese-formal":return Wr.SIMP_CHINESE_FORMAL;case"simp-chinese-informal":return Wr.SIMP_CHINESE_INFORMAL;case"tamil":return Wr.TAMIL;case"telugu":return Wr.TELUGU;case"thai":return Wr.THAI;case"tibetan":return Wr.TIBETAN;case"trad-chinese-formal":return Wr.TRAD_CHINESE_FORMAL;case"trad-chinese-informal":return Wr.TRAD_CHINESE_INFORMAL;case"upper-armenian":return Wr.UPPER_ARMENIAN;case"disclosure-open":return Wr.DISCLOSURE_OPEN;case"disclosure-closed":return Wr.DISCLOSURE_CLOSED;case"none":default:return Wr.NONE}}},$r=function(e){return{name:"margin-"+e,initialValue:"0",prefix:!1,type:wt.TOKEN_VALUE}},en=$r("top"),tn=$r("right"),rn=$r("bottom"),nn=$r("left");!function(e){e[e.VISIBLE=0]="VISIBLE",e[e.HIDDEN=1]="HIDDEN",e[e.SCROLL=2]="SCROLL",e[e.AUTO=3]="AUTO"}(Yr||(Yr={}));var on,sn={name:"overflow",initialValue:"visible",prefix:!1,type:wt.LIST,parse:function(e){return e.filter(qe).map((function(e){switch(e.value){case"hidden":return Yr.HIDDEN;case"scroll":return Yr.SCROLL;case"auto":return Yr.AUTO;case"visible":default:return Yr.VISIBLE}}))}};!function(e){e.NORMAL="normal",e.BREAK_WORD="break-word"}(on||(on={}));var an,An={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:wt.IDENT_VALUE,parse:function(e){switch(e){case"break-word":return on.BREAK_WORD;case"normal":default:return on.NORMAL}}},un=function(e){return{name:"padding-"+e,initialValue:"0",prefix:!1,type:wt.TYPE_VALUE,format:"length-percentage"}},cn=un("top"),ln=un("right"),dn=un("bottom"),fn=un("left");!function(e){e[e.LEFT=0]="LEFT",e[e.CENTER=1]="CENTER",e[e.RIGHT=2]="RIGHT"}(an||(an={}));var hn,pn={name:"text-align",initialValue:"left",prefix:!1,type:wt.IDENT_VALUE,parse:function(e){switch(e){case"right":return an.RIGHT;case"center":case"justify":return an.CENTER;case"left":default:return an.LEFT}}};!function(e){e[e.STATIC=0]="STATIC",e[e.RELATIVE=1]="RELATIVE",e[e.ABSOLUTE=2]="ABSOLUTE",e[e.FIXED=3]="FIXED",e[e.STICKY=4]="STICKY"}(hn||(hn={}));var mn,gn={name:"position",initialValue:"static",prefix:!1,type:wt.IDENT_VALUE,parse:function(e){switch(e){case"relative":return hn.RELATIVE;case"absolute":return hn.ABSOLUTE;case"fixed":return hn.FIXED;case"sticky":return hn.STICKY}return hn.STATIC}},yn={name:"text-shadow",initialValue:"none",type:wt.LIST,prefix:!1,parse:function(e){return 1===e.length&&Xe(e[0],"none")?[]:Ye(e).map((function(e){for(var t={color:_t.TRANSPARENT,offsetX:rt,offsetY:rt,blur:rt},r=0,n=0;n<e.length;n++){var o=e[n];$e(o)?(0===r?t.offsetX=o:1===r?t.offsetY=o:t.blur=o,r++):t.color=ft(o)}return t}))}};!function(e){e[e.NONE=0]="NONE",e[e.LOWERCASE=1]="LOWERCASE",e[e.UPPERCASE=2]="UPPERCASE",e[e.CAPITALIZE=3]="CAPITALIZE"}(mn||(mn={}));var vn,wn={name:"text-transform",initialValue:"none",prefix:!1,type:wt.IDENT_VALUE,parse:function(e){switch(e){case"uppercase":return mn.UPPERCASE;case"lowercase":return mn.LOWERCASE;case"capitalize":return mn.CAPITALIZE}return mn.NONE}},bn={name:"transform",initialValue:"none",prefix:!0,type:wt.VALUE,parse:function(e){if(e.type===d.IDENT_TOKEN&&"none"===e.value)return null;if(e.type===d.FUNCTION){var t=Bn[e.name];if(void 0===t)throw new Error('Attempting to parse an unsupported transform function "'+e.name+'"');return t(e.values)}return null}},Bn={matrix:function(e){var t=e.filter((function(e){return e.type===d.NUMBER_TOKEN})).map((function(e){return e.number}));return 6===t.length?t:null},matrix3d:function(e){var t=e.filter((function(e){return e.type===d.NUMBER_TOKEN})).map((function(e){return e.number})),r=t[0],n=t[1],o=(t[2],t[3],t[4]),s=t[5],i=(t[6],t[7],t[8],t[9],t[10],t[11],t[12]),a=t[13];return t[14],t[15],16===t.length?[r,n,o,s,i,a]:null}},jn={type:d.PERCENTAGE_TOKEN,number:50,flags:4},_n=[jn,jn],Cn={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:wt.LIST,parse:function(e){var t=e.filter(et);return 2!==t.length?_n:[t[0],t[1]]}};!function(e){e[e.VISIBLE=0]="VISIBLE",e[e.HIDDEN=1]="HIDDEN",e[e.COLLAPSE=2]="COLLAPSE"}(vn||(vn={}));var xn,En={name:"visible",initialValue:"none",prefix:!1,type:wt.IDENT_VALUE,parse:function(e){switch(e){case"hidden":return vn.HIDDEN;case"collapse":return vn.COLLAPSE;case"visible":default:return vn.VISIBLE}}};!function(e){e.NORMAL="normal",e.BREAK_ALL="break-all",e.KEEP_ALL="keep-all"}(xn||(xn={}));var Nn,Qn={name:"word-break",initialValue:"normal",prefix:!1,type:wt.IDENT_VALUE,parse:function(e){switch(e){case"break-all":return xn.BREAK_ALL;case"keep-all":return xn.KEEP_ALL;case"normal":default:return xn.NORMAL}}},Fn={name:"z-index",initialValue:"auto",prefix:!1,type:wt.VALUE,parse:function(e){if(e.type===d.IDENT_TOKEN)return{auto:!0,order:0};if(Ve(e))return{auto:!1,order:e.number};throw new Error("Invalid z-index number parsed")}},Un={name:"opacity",initialValue:"1",type:wt.VALUE,prefix:!1,parse:function(e){return Ve(e)?e.number:1}},Sn={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:wt.TYPE_VALUE,format:"color"},Ln={name:"text-decoration-line",initialValue:"none",prefix:!1,type:wt.LIST,parse:function(e){return e.filter(qe).map((function(e){switch(e.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0})).filter((function(e){return 0!==e}))}},Tn={name:"font-family",initialValue:"",prefix:!1,type:wt.LIST,parse:function(e){var t=[],r=[];return e.forEach((function(e){switch(e.type){case d.IDENT_TOKEN:case d.STRING_TOKEN:t.push(e.value);break;case d.NUMBER_TOKEN:t.push(e.number.toString());break;case d.COMMA_TOKEN:r.push(t.join(" ")),t.length=0}})),t.length&&r.push(t.join(" ")),r.map((function(e){return-1===e.indexOf(" ")?e:"'"+e+"'"}))}},Hn={name:"font-size",initialValue:"0",prefix:!1,type:wt.TYPE_VALUE,format:"length"},In={name:"font-weight",initialValue:"normal",type:wt.VALUE,prefix:!1,parse:function(e){if(Ve(e))return e.number;if(qe(e))switch(e.value){case"bold":return 700;case"normal":default:return 400}return 400}},Pn={name:"font-variant",initialValue:"none",type:wt.LIST,prefix:!1,parse:function(e){return e.filter(qe).map((function(e){return e.value}))}};!function(e){e.NORMAL="normal",e.ITALIC="italic",e.OBLIQUE="oblique"}(Nn||(Nn={}));var On,kn={name:"font-style",initialValue:"normal",prefix:!1,type:wt.IDENT_VALUE,parse:function(e){switch(e){case"oblique":return Nn.OBLIQUE;case"italic":return Nn.ITALIC;case"normal":default:return Nn.NORMAL}}},Rn=function(e,t){return 0!=(e&t)},Mn={name:"content",initialValue:"none",type:wt.LIST,prefix:!1,parse:function(e){if(0===e.length)return[];var t=e[0];return t.type===d.IDENT_TOKEN&&"none"===t.value?[]:e}},Dn={name:"counter-increment",initialValue:"none",prefix:!0,type:wt.LIST,parse:function(e){if(0===e.length)return null;var t=e[0];if(t.type===d.IDENT_TOKEN&&"none"===t.value)return null;for(var r=[],n=e.filter(We),o=0;o<n.length;o++){var s=n[o],i=n[o+1];if(s.type===d.IDENT_TOKEN){var a=i&&Ve(i)?i.number:1;r.push({counter:s.value,increment:a})}}return r}},Kn={name:"counter-reset",initialValue:"none",prefix:!0,type:wt.LIST,parse:function(e){if(0===e.length)return[];for(var t=[],r=e.filter(We),n=0;n<r.length;n++){var o=r[n],s=r[n+1];if(qe(o)&&"none"!==o.value){var i=s&&Ve(s)?s.number:0;t.push({counter:o.value,reset:i})}}return t}},zn={name:"quotes",initialValue:"none",prefix:!0,type:wt.LIST,parse:function(e){if(0===e.length)return null;var t=e[0];if(t.type===d.IDENT_TOKEN&&"none"===t.value)return null;var r=[],n=e.filter(Ge);if(n.length%2!=0)return null;for(var o=0;o<n.length;o+=2){var s=n[o].value,i=n[o+1].value;r.push({open:s,close:i})}return r}},Vn=function(e,t,r){if(!e)return"";var n=e[Math.min(t,e.length-1)];return n?r?n.open:n.close:""},qn={name:"box-shadow",initialValue:"none",type:wt.LIST,prefix:!1,parse:function(e){return 1===e.length&&Xe(e[0],"none")?[]:Ye(e).map((function(e){for(var t={color:255,offsetX:rt,offsetY:rt,blur:rt,spread:rt,inset:!1},r=0,n=0;n<e.length;n++){var o=e[n];Xe(o,"inset")?t.inset=!0:$e(o)?(0===r?t.offsetX=o:1===r?t.offsetY=o:2===r?t.blur=o:t.spread=o,r++):t.color=ft(o)}return t}))}},Gn=function(){function e(e){this.backgroundClip=Jn(xt,e.backgroundClip),this.backgroundColor=Jn(Et,e.backgroundColor),this.backgroundImage=Jn(ur,e.backgroundImage),this.backgroundOrigin=Jn(cr,e.backgroundOrigin),this.backgroundPosition=Jn(lr,e.backgroundPosition),this.backgroundRepeat=Jn(fr,e.backgroundRepeat),this.backgroundSize=Jn(mr,e.backgroundSize),this.borderTopColor=Jn(vr,e.borderTopColor),this.borderRightColor=Jn(wr,e.borderRightColor),this.borderBottomColor=Jn(br,e.borderBottomColor),this.borderLeftColor=Jn(Br,e.borderLeftColor),this.borderTopLeftRadius=Jn(_r,e.borderTopLeftRadius),this.borderTopRightRadius=Jn(Cr,e.borderTopRightRadius),this.borderBottomRightRadius=Jn(xr,e.borderBottomRightRadius),this.borderBottomLeftRadius=Jn(Er,e.borderBottomLeftRadius),this.borderTopStyle=Jn(Fr,e.borderTopStyle),this.borderRightStyle=Jn(Ur,e.borderRightStyle),this.borderBottomStyle=Jn(Sr,e.borderBottomStyle),this.borderLeftStyle=Jn(Lr,e.borderLeftStyle),this.borderTopWidth=Jn(Hr,e.borderTopWidth),this.borderRightWidth=Jn(Ir,e.borderRightWidth),this.borderBottomWidth=Jn(Pr,e.borderBottomWidth),this.borderLeftWidth=Jn(Or,e.borderLeftWidth),this.boxShadow=Jn(qn,e.boxShadow),this.color=Jn(kr,e.color),this.display=Jn(Rr,e.display),this.float=Jn(Kr,e.cssFloat),this.fontFamily=Jn(Tn,e.fontFamily),this.fontSize=Jn(Hn,e.fontSize),this.fontStyle=Jn(kn,e.fontStyle),this.fontVariant=Jn(Pn,e.fontVariant),this.fontWeight=Jn(In,e.fontWeight),this.letterSpacing=Jn(zr,e.letterSpacing),this.lineBreak=Jn(qr,e.lineBreak),this.lineHeight=Jn(Gr,e.lineHeight),this.listStyleImage=Jn(Xr,e.listStyleImage),this.listStylePosition=Jn(Jr,e.listStylePosition),this.listStyleType=Jn(Zr,e.listStyleType),this.marginTop=Jn(en,e.marginTop),this.marginRight=Jn(tn,e.marginRight),this.marginBottom=Jn(rn,e.marginBottom),this.marginLeft=Jn(nn,e.marginLeft),this.opacity=Jn(Un,e.opacity);var t=Jn(sn,e.overflow);this.overflowX=t[0],this.overflowY=t[t.length>1?1:0],this.overflowWrap=Jn(An,e.overflowWrap),this.paddingTop=Jn(cn,e.paddingTop),this.paddingRight=Jn(ln,e.paddingRight),this.paddingBottom=Jn(dn,e.paddingBottom),this.paddingLeft=Jn(fn,e.paddingLeft),this.position=Jn(gn,e.position),this.textAlign=Jn(pn,e.textAlign),this.textDecorationColor=Jn(Sn,e.textDecorationColor||e.color),this.textDecorationLine=Jn(Ln,e.textDecorationLine),this.textShadow=Jn(yn,e.textShadow),this.textTransform=Jn(wn,e.textTransform),this.transform=Jn(bn,e.transform),this.transformOrigin=Jn(Cn,e.transformOrigin),this.visibility=Jn(En,e.visibility),this.wordBreak=Jn(Qn,e.wordBreak),this.zIndex=Jn(Fn,e.zIndex)}return e.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===vn.VISIBLE},e.prototype.isTransparent=function(){return ht(this.backgroundColor)},e.prototype.isTransformed=function(){return null!==this.transform},e.prototype.isPositioned=function(){return this.position!==hn.STATIC},e.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},e.prototype.isFloating=function(){return this.float!==Nr.NONE},e.prototype.isInlineLevel=function(){return Rn(this.display,4)||Rn(this.display,33554432)||Rn(this.display,268435456)||Rn(this.display,536870912)||Rn(this.display,67108864)||Rn(this.display,134217728)},e}(),Xn=function(e){this.content=Jn(Mn,e.content),this.quotes=Jn(zn,e.quotes)},Wn=function(e){this.counterIncrement=Jn(Dn,e.counterIncrement),this.counterReset=Jn(Kn,e.counterReset)},Jn=function(e,t){var r=new De,n=null!=t?t.toString():e.initialValue;r.write(n);var o=new Ke(r.read());switch(e.type){case wt.IDENT_VALUE:var s=o.parseComponentValue();return e.parse(qe(s)?s.value:e.initialValue);case wt.VALUE:return e.parse(o.parseComponentValue());case wt.LIST:return e.parse(o.parseComponentValues());case wt.TOKEN_VALUE:return o.parseComponentValue();case wt.TYPE_VALUE:switch(e.format){case"angle":return ut(o.parseComponentValue());case"color":return ft(o.parseComponentValue());case"image":return ir(o.parseComponentValue());case"length":var i=o.parseComponentValue();return $e(i)?i:rt;case"length-percentage":var a=o.parseComponentValue();return et(a)?a:rt}}throw new Error("Attempting to parse unsupported css format type "+e.format)},Yn=function(e){this.styles=new Gn(window.getComputedStyle(e,null)),this.textNodes=[],this.elements=[],null!==this.styles.transform&&So(e)&&(e.style.transform="none"),this.bounds=i(e),this.flags=0},Zn=function(e,t){this.text=e,this.bounds=t},$n=function(e){var t=e.ownerDocument;if(t){var r=t.createElement("html2canvaswrapper");r.appendChild(e.cloneNode(!0));var n=e.parentNode;if(n){n.replaceChild(r,e);var o=i(r);return r.firstChild&&n.replaceChild(r.firstChild,r),o}}return new s(0,0,0,0)},eo=function(e,t,r){var n=e.ownerDocument;if(!n)throw new Error("Node has no owner document");var o=n.createRange();return o.setStart(e,t),o.setEnd(e,t+r),s.fromClientRect(o.getBoundingClientRect())},to=function(e,t){return 0!==t.letterSpacing?a(e).map((function(e){return A(e)})):ro(e,t)},ro=function(e,t){for(var r,n=function(e,t){var r=a(e),n=ie(r,t),o=n[0],s=n[1],i=n[2],A=r.length,u=0,c=0;return{next:function(){if(c>=A)return{done:!0,value:null};for(var e=G;c<A&&(e=se(r,s,o,++c,i))===G;);if(e!==G||c===A){var t=new ae(r,e,u,c);return u=c,{value:t,done:!1}}return{done:!0,value:null}}}}(e,{lineBreak:t.lineBreak,wordBreak:t.overflowWrap===on.BREAK_WORD?"break-word":t.wordBreak}),o=[];!(r=n.next()).done;)r.value&&o.push(r.value.slice());return o},no=function(e,t){this.text=oo(e.data,t.textTransform),this.textBounds=function(e,t,r){var n=to(e,t),o=[],s=0;return n.forEach((function(e){if(t.textDecorationLine.length||e.trim().length>0)if(Pt.SUPPORT_RANGE_BOUNDS)o.push(new Zn(e,eo(r,s,e.length)));else{var n=r.splitText(e.length);o.push(new Zn(e,$n(r))),r=n}else Pt.SUPPORT_RANGE_BOUNDS||(r=r.splitText(e.length));s+=e.length})),o}(this.text,t,e)},oo=function(e,t){switch(t){case mn.LOWERCASE:return e.toLowerCase();case mn.CAPITALIZE:return e.replace(so,io);case mn.UPPERCASE:return e.toUpperCase();default:return e}},so=/(^|\s|:|-|\(|\))([a-z])/g,io=function(e,t,r){return e.length>0?t+r.toUpperCase():e},ao=function(e){function r(t){var r=e.call(this,t)||this;return r.src=t.currentSrc||t.src,r.intrinsicWidth=t.naturalWidth,r.intrinsicHeight=t.naturalHeight,kt.getInstance().addImage(r.src),r}return t(r,e),r}(Yn),Ao=function(e){function r(t){var r=e.call(this,t)||this;return r.canvas=t,r.intrinsicWidth=t.width,r.intrinsicHeight=t.height,r}return t(r,e),r}(Yn),uo=function(e){function r(t){var r=e.call(this,t)||this,n=new XMLSerializer;return r.svg="data:image/svg+xml,"+encodeURIComponent(n.serializeToString(t)),r.intrinsicWidth=t.width.baseVal.value,r.intrinsicHeight=t.height.baseVal.value,kt.getInstance().addImage(r.svg),r}return t(r,e),r}(Yn),co=function(e){function r(t){var r=e.call(this,t)||this;return r.value=t.value,r}return t(r,e),r}(Yn),lo=function(e){function r(t){var r=e.call(this,t)||this;return r.start=t.start,r.reversed="boolean"==typeof t.reversed&&!0===t.reversed,r}return t(r,e),r}(Yn),fo=[{type:d.DIMENSION_TOKEN,flags:0,unit:"px",number:3}],ho=[{type:d.PERCENTAGE_TOKEN,flags:0,number:50}],po="checkbox",mo="radio",go="password",yo=707406591,vo=function(e){function r(t){var r,n,o,i=e.call(this,t)||this;switch(i.type=t.type.toLowerCase(),i.checked=t.checked,i.value=0===(o=(n=t).type===go?new Array(n.value.length+1).join("•"):n.value).length?n.placeholder||"":o,i.type!==po&&i.type!==mo||(i.styles.backgroundColor=3739148031,i.styles.borderTopColor=i.styles.borderRightColor=i.styles.borderBottomColor=i.styles.borderLeftColor=2779096575,i.styles.borderTopWidth=i.styles.borderRightWidth=i.styles.borderBottomWidth=i.styles.borderLeftWidth=1,i.styles.borderTopStyle=i.styles.borderRightStyle=i.styles.borderBottomStyle=i.styles.borderLeftStyle=pr.SOLID,i.styles.backgroundClip=[bt.BORDER_BOX],i.styles.backgroundOrigin=[0],i.bounds=(r=i.bounds).width>r.height?new s(r.left+(r.width-r.height)/2,r.top,r.height,r.height):r.width<r.height?new s(r.left,r.top+(r.height-r.width)/2,r.width,r.width):r),i.type){case po:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=fo;break;case mo:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=ho}return i}return t(r,e),r}(Yn),wo=function(e){function r(t){var r=e.call(this,t)||this,n=t.options[t.selectedIndex||0];return r.value=n&&n.text||"",r}return t(r,e),r}(Yn),bo=function(e){function r(t){var r=e.call(this,t)||this;return r.value=t.value,r}return t(r,e),r}(Yn),Bo=function(e){return ft(Ke.create(e).parseComponentValue())},jo=function(e){function r(t){var r=e.call(this,t)||this;r.src=t.src,r.width=parseInt(t.width,10)||0,r.height=parseInt(t.height,10)||0,r.backgroundColor=r.styles.backgroundColor;try{if(t.contentWindow&&t.contentWindow.document&&t.contentWindow.document.documentElement){r.tree=Eo(t.contentWindow.document.documentElement);var n=t.contentWindow.document.documentElement?Bo(getComputedStyle(t.contentWindow.document.documentElement).backgroundColor):_t.TRANSPARENT,o=t.contentWindow.document.body?Bo(getComputedStyle(t.contentWindow.document.body).backgroundColor):_t.TRANSPARENT;r.backgroundColor=ht(n)?ht(o)?r.styles.backgroundColor:o:n}}catch(e){}return r}return t(r,e),r}(Yn),_o=["OL","UL","MENU"],Co=function(e,t,r){for(var n=e.firstChild,o=void 0;n;n=o)if(o=n.nextSibling,Fo(n)&&n.data.trim().length>0)t.textNodes.push(new no(n,t.styles));else if(Uo(n)){var s=xo(n);s.styles.isVisible()&&(No(n,s,r)?s.flags|=4:Qo(s.styles)&&(s.flags|=2),-1!==_o.indexOf(n.tagName)&&(s.flags|=8),t.elements.push(s),zo(n)||Po(n)||Vo(n)||Co(n,s,r))}},xo=function(e){return Ro(e)?new ao(e):ko(e)?new Ao(e):Po(e)?new uo(e):To(e)?new co(e):Ho(e)?new lo(e):Io(e)?new vo(e):Vo(e)?new wo(e):zo(e)?new bo(e):Mo(e)?new jo(e):new Yn(e)},Eo=function(e){var t=xo(e);return t.flags|=4,Co(e,t,t),t},No=function(e,t,r){return t.styles.isPositionedWithZIndex()||t.styles.opacity<1||t.styles.isTransformed()||Oo(e)&&r.styles.isTransparent()},Qo=function(e){return e.isPositioned()||e.isFloating()},Fo=function(e){return e.nodeType===Node.TEXT_NODE},Uo=function(e){return e.nodeType===Node.ELEMENT_NODE},So=function(e){return Uo(e)&&void 0!==e.style&&!Lo(e)},Lo=function(e){return"object"==typeof e.className},To=function(e){return"LI"===e.tagName},Ho=function(e){return"OL"===e.tagName},Io=function(e){return"INPUT"===e.tagName},Po=function(e){return"svg"===e.tagName},Oo=function(e){return"BODY"===e.tagName},ko=function(e){return"CANVAS"===e.tagName},Ro=function(e){return"IMG"===e.tagName},Mo=function(e){return"IFRAME"===e.tagName},Do=function(e){return"STYLE"===e.tagName},Ko=function(e){return"SCRIPT"===e.tagName},zo=function(e){return"TEXTAREA"===e.tagName},Vo=function(e){return"SELECT"===e.tagName},qo=function(){function e(){this.counters={}}return e.prototype.getCounterValue=function(e){var t=this.counters[e];return t&&t.length?t[t.length-1]:1},e.prototype.getCounterValues=function(e){return this.counters[e]||[]},e.prototype.pop=function(e){var t=this;e.forEach((function(e){return t.counters[e].pop()}))},e.prototype.parse=function(e){var t=this,r=e.counterIncrement,n=e.counterReset,o=!0;null!==r&&r.forEach((function(e){var r=t.counters[e.counter];r&&0!==e.increment&&(o=!1,r[Math.max(0,r.length-1)]+=e.increment)}));var s=[];return o&&n.forEach((function(e){var r=t.counters[e.counter];s.push(e.counter),r||(r=t.counters[e.counter]=[]),r.push(e.reset)})),s},e}(),Go={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},Xo={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["Ք","Փ","Ւ","Ց","Ր","Տ","Վ","Ս","Ռ","Ջ","Պ","Չ","Ո","Շ","Ն","Յ","Մ","Ճ","Ղ","Ձ","Հ","Կ","Ծ","Խ","Լ","Ի","Ժ","Թ","Ը","Է","Զ","Ե","Դ","Գ","Բ","Ա"]},Wo={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["י׳","ט׳","ח׳","ז׳","ו׳","ה׳","ד׳","ג׳","ב׳","א׳","ת","ש","ר","ק","צ","פ","ע","ס","נ","מ","ל","כ","יט","יח","יז","טז","טו","י","ט","ח","ז","ו","ה","ד","ג","ב","א"]},Jo={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["ჵ","ჰ","ჯ","ჴ","ხ","ჭ","წ","ძ","ც","ჩ","შ","ყ","ღ","ქ","ფ","ჳ","ტ","ს","რ","ჟ","პ","ო","ჲ","ნ","მ","ლ","კ","ი","თ","ჱ","ზ","ვ","ე","დ","გ","ბ","ა"]},Yo=function(e,t,r,n,o,s){return e<t||e>r?is(e,o,s.length>0):n.integers.reduce((function(t,r,o){for(;e>=r;)e-=r,t+=n.values[o];return t}),"")+s},Zo=function(e,t,r,n){var o="";do{r||e--,o=n(e)+o,e/=t}while(e*t>=t);return o},$o=function(e,t,r,n,o){var s=r-t+1;return(e<0?"-":"")+(Zo(Math.abs(e),s,n,(function(e){return A(Math.floor(e%s)+t)}))+o)},es=function(e,t,r){void 0===r&&(r=". ");var n=t.length;return Zo(Math.abs(e),n,!1,(function(e){return t[Math.floor(e%n)]}))+r},ts=function(e,t,r,n,o,s){if(e<-9999||e>9999)return is(e,Wr.CJK_DECIMAL,o.length>0);var i=Math.abs(e),a=o;if(0===i)return t[0]+a;for(var A=0;i>0&&A<=4;A++){var u=i%10;0===u&&Rn(s,1)&&""!==a?a=t[u]+a:u>1||1===u&&0===A||1===u&&1===A&&Rn(s,2)||1===u&&1===A&&Rn(s,4)&&e>100||1===u&&A>1&&Rn(s,8)?a=t[u]+(A>0?r[A-1]:"")+a:1===u&&A>0&&(a=r[A-1]+a),i=Math.floor(i/10)}return(e<0?n:"")+a},rs="十百千萬",ns="拾佰仟萬",os="マイナス",ss="마이너스",is=function(e,t,r){var n=r?". ":"",o=r?"、":"",s=r?", ":"",i=r?" ":"";switch(t){case Wr.DISC:return"•"+i;case Wr.CIRCLE:return"◦"+i;case Wr.SQUARE:return"◾"+i;case Wr.DECIMAL_LEADING_ZERO:var a=$o(e,48,57,!0,n);return a.length<4?"0"+a:a;case Wr.CJK_DECIMAL:return es(e,"〇一二三四五六七八九",o);case Wr.LOWER_ROMAN:return Yo(e,1,3999,Go,Wr.DECIMAL,n).toLowerCase();case Wr.UPPER_ROMAN:return Yo(e,1,3999,Go,Wr.DECIMAL,n);case Wr.LOWER_GREEK:return $o(e,945,969,!1,n);case Wr.LOWER_ALPHA:return $o(e,97,122,!1,n);case Wr.UPPER_ALPHA:return $o(e,65,90,!1,n);case Wr.ARABIC_INDIC:return $o(e,1632,1641,!0,n);case Wr.ARMENIAN:case Wr.UPPER_ARMENIAN:return Yo(e,1,9999,Xo,Wr.DECIMAL,n);case Wr.LOWER_ARMENIAN:return Yo(e,1,9999,Xo,Wr.DECIMAL,n).toLowerCase();case Wr.BENGALI:return $o(e,2534,2543,!0,n);case Wr.CAMBODIAN:case Wr.KHMER:return $o(e,6112,6121,!0,n);case Wr.CJK_EARTHLY_BRANCH:return es(e,"子丑寅卯辰巳午未申酉戌亥",o);case Wr.CJK_HEAVENLY_STEM:return es(e,"甲乙丙丁戊己庚辛壬癸",o);case Wr.CJK_IDEOGRAPHIC:case Wr.TRAD_CHINESE_INFORMAL:return ts(e,"零一二三四五六七八九",rs,"負",o,14);case Wr.TRAD_CHINESE_FORMAL:return ts(e,"零壹貳參肆伍陸柒捌玖",ns,"負",o,15);case Wr.SIMP_CHINESE_INFORMAL:return ts(e,"零一二三四五六七八九",rs,"负",o,14);case Wr.SIMP_CHINESE_FORMAL:return ts(e,"零壹贰叁肆伍陆柒捌玖",ns,"负",o,15);case Wr.JAPANESE_INFORMAL:return ts(e,"〇一二三四五六七八九","十百千万",os,o,0);case Wr.JAPANESE_FORMAL:return ts(e,"零壱弐参四伍六七八九","拾百千万",os,o,7);case Wr.KOREAN_HANGUL_FORMAL:return ts(e,"영일이삼사오육칠팔구","십백천만",ss,s,7);case Wr.KOREAN_HANJA_INFORMAL:return ts(e,"零一二三四五六七八九","十百千萬",ss,s,0);case Wr.KOREAN_HANJA_FORMAL:return ts(e,"零壹貳參四五六七八九","拾百千",ss,s,7);case Wr.DEVANAGARI:return $o(e,2406,2415,!0,n);case Wr.GEORGIAN:return Yo(e,1,19999,Jo,Wr.DECIMAL,n);case Wr.GUJARATI:return $o(e,2790,2799,!0,n);case Wr.GURMUKHI:return $o(e,2662,2671,!0,n);case Wr.HEBREW:return Yo(e,1,10999,Wo,Wr.DECIMAL,n);case Wr.HIRAGANA:return es(e,"あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわゐゑをん");case Wr.HIRAGANA_IROHA:return es(e,"いろはにほへとちりぬるをわかよたれそつねならむうゐのおくやまけふこえてあさきゆめみしゑひもせす");case Wr.KANNADA:return $o(e,3302,3311,!0,n);case Wr.KATAKANA:return es(e,"アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヰヱヲン",o);case Wr.KATAKANA_IROHA:return es(e,"イロハニホヘトチリヌルヲワカヨタレソツネナラムウヰノオクヤマケフコエテアサキユメミシヱヒモセス",o);case Wr.LAO:return $o(e,3792,3801,!0,n);case Wr.MONGOLIAN:return $o(e,6160,6169,!0,n);case Wr.MYANMAR:return $o(e,4160,4169,!0,n);case Wr.ORIYA:return $o(e,2918,2927,!0,n);case Wr.PERSIAN:return $o(e,1776,1785,!0,n);case Wr.TAMIL:return $o(e,3046,3055,!0,n);case Wr.TELUGU:return $o(e,3174,3183,!0,n);case Wr.THAI:return $o(e,3664,3673,!0,n);case Wr.TIBETAN:return $o(e,3872,3881,!0,n);case Wr.DECIMAL:default:return $o(e,48,57,!0,n)}},as="data-html2canvas-ignore",As=function(){function e(e,t){if(this.options=t,this.scrolledElements=[],this.referenceElement=e,this.counters=new qo,this.quoteDepth=0,!e.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(e.ownerDocument.documentElement)}return e.prototype.toIFrame=function(e,t){var r=this,s=cs(e,t);if(!s.contentWindow)return Promise.reject("Unable to find iframe window");var i=e.defaultView.pageXOffset,a=e.defaultView.pageYOffset,A=s.contentWindow,u=A.document,c=ls(s).then((function(){return n(r,void 0,void 0,(function(){var e;return o(this,(function(r){switch(r.label){case 0:return this.scrolledElements.forEach(ps),A&&(A.scrollTo(t.left,t.top),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||A.scrollY===t.top&&A.scrollX===t.left||(u.documentElement.style.top=-t.top+"px",u.documentElement.style.left=-t.left+"px",u.documentElement.style.position="absolute")),e=this.options.onclone,void 0===this.clonedReferenceElement?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:u.fonts&&u.fonts.ready?[4,u.fonts.ready]:[3,2];case 1:r.sent(),r.label=2;case 2:return"function"==typeof e?[2,Promise.resolve().then((function(){return e(u)})).then((function(){return s}))]:[2,s]}}))}))}));return u.open(),u.write(fs(document.doctype)+"<html></html>"),hs(this.referenceElement.ownerDocument,i,a),u.replaceChild(u.adoptNode(this.documentElement),u.documentElement),u.close(),c},e.prototype.createElementClone=function(e){if(ko(e))return this.createCanvasClone(e);if(Do(e))return this.createStyleClone(e);var t=e.cloneNode(!1);return Ro(t)&&"lazy"===t.loading&&(t.loading="eager"),t},e.prototype.createStyleClone=function(e){try{var t=e.sheet;if(t&&t.cssRules){var r=[].slice.call(t.cssRules,0).reduce((function(e,t){return t&&"string"==typeof t.cssText?e+t.cssText:e}),""),n=e.cloneNode(!1);return n.textContent=r,n}}catch(e){if(Ot.getInstance(this.options.id).error("Unable to access cssRules property",e),"SecurityError"!==e.name)throw e}return e.cloneNode(!1)},e.prototype.createCanvasClone=function(e){if(this.options.inlineImages&&e.ownerDocument){var t=e.ownerDocument.createElement("img");try{return t.src=e.toDataURL(),t}catch(e){Ot.getInstance(this.options.id).info("Unable to clone canvas contents, canvas is tainted")}}var r=e.cloneNode(!1);try{r.width=e.width,r.height=e.height;var n=e.getContext("2d"),o=r.getContext("2d");return o&&(n?o.putImageData(n.getImageData(0,0,e.width,e.height),0,0):o.drawImage(e,0,0)),r}catch(e){}return r},e.prototype.cloneNode=function(e){if(Fo(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var t=e.ownerDocument.defaultView;if(t&&Uo(e)&&(So(e)||Lo(e))){var r=this.createElementClone(e),n=t.getComputedStyle(e),o=t.getComputedStyle(e,":before"),s=t.getComputedStyle(e,":after");this.referenceElement===e&&So(r)&&(this.clonedReferenceElement=r),Oo(r)&&vs(r);for(var i=this.counters.parse(new Wn(n)),a=this.resolvePseudoContent(e,r,o,On.BEFORE),A=e.firstChild;A;A=A.nextSibling)Uo(A)&&(Ko(A)||A.hasAttribute(as)||"function"==typeof this.options.ignoreElements&&this.options.ignoreElements(A))||this.options.copyStyles&&Uo(A)&&Do(A)||r.appendChild(this.cloneNode(A));a&&r.insertBefore(a,r.firstChild);var u=this.resolvePseudoContent(e,r,s,On.AFTER);return u&&r.appendChild(u),this.counters.pop(i),n&&(this.options.copyStyles||Lo(e))&&!Mo(e)&&ds(n,r),0===e.scrollTop&&0===e.scrollLeft||this.scrolledElements.push([r,e.scrollLeft,e.scrollTop]),(zo(e)||Vo(e))&&(zo(r)||Vo(r))&&(r.value=e.value),r}return e.cloneNode(!1)},e.prototype.resolvePseudoContent=function(e,t,r,n){var o=this;if(r){var s=r.content,i=t.ownerDocument;if(i&&s&&"none"!==s&&"-moz-alt-content"!==s&&"none"!==r.display){this.counters.parse(new Wn(r));var a=new Xn(r),A=i.createElement("html2canvaspseudoelement");ds(r,A),a.content.forEach((function(t){if(t.type===d.STRING_TOKEN)A.appendChild(i.createTextNode(t.value));else if(t.type===d.URL_TOKEN){var r=i.createElement("img");r.src=t.value,r.style.opacity="1",A.appendChild(r)}else if(t.type===d.FUNCTION){if("attr"===t.name){var n=t.values.filter(qe);n.length&&A.appendChild(i.createTextNode(e.getAttribute(n[0].value)||""))}else if("counter"===t.name){var s=t.values.filter(Je),u=s[0],c=s[1];if(u&&qe(u)){var l=o.counters.getCounterValue(u.value),f=c&&qe(c)?Zr.parse(c.value):Wr.DECIMAL;A.appendChild(i.createTextNode(is(l,f,!1)))}}else if("counters"===t.name){var h=t.values.filter(Je),p=(u=h[0],h[1]);if(c=h[2],u&&qe(u)){var m=o.counters.getCounterValues(u.value),g=c&&qe(c)?Zr.parse(c.value):Wr.DECIMAL,y=p&&p.type===d.STRING_TOKEN?p.value:"",v=m.map((function(e){return is(e,g,!1)})).join(y);A.appendChild(i.createTextNode(v))}}}else if(t.type===d.IDENT_TOKEN)switch(t.value){case"open-quote":A.appendChild(i.createTextNode(Vn(a.quotes,o.quoteDepth++,!0)));break;case"close-quote":A.appendChild(i.createTextNode(Vn(a.quotes,--o.quoteDepth,!1)));break;default:A.appendChild(i.createTextNode(t.value))}})),A.className=ms+" "+gs;var u=n===On.BEFORE?" "+ms:" "+gs;return Lo(t)?t.className.baseValue+=u:t.className+=u,A}}},e.destroy=function(e){return!!e.parentNode&&(e.parentNode.removeChild(e),!0)},e}();!function(e){e[e.BEFORE=0]="BEFORE",e[e.AFTER=1]="AFTER"}(On||(On={}));var us,cs=function(e,t){var r=e.createElement("iframe");return r.className="html2canvas-container",r.style.visibility="hidden",r.style.position="fixed",r.style.left="-10000px",r.style.top="0px",r.style.border="0",r.width=t.width.toString(),r.height=t.height.toString(),r.scrolling="no",r.setAttribute(as,"true"),e.body.appendChild(r),r},ls=function(e){return new Promise((function(t,r){var n=e.contentWindow;if(!n)return r("No window assigned for iframe");var o=n.document;n.onload=e.onload=o.onreadystatechange=function(){n.onload=e.onload=o.onreadystatechange=null;var r=setInterval((function(){o.body.childNodes.length>0&&"complete"===o.readyState&&(clearInterval(r),t(e))}),50)}}))},ds=function(e,t){for(var r=e.length-1;r>=0;r--){var n=e.item(r);"content"!==n&&t.style.setProperty(n,e.getPropertyValue(n))}return t},fs=function(e){var t="";return e&&(t+="<!DOCTYPE ",e.name&&(t+=e.name),e.internalSubset&&(t+=e.internalSubset),e.publicId&&(t+='"'+e.publicId+'"'),e.systemId&&(t+='"'+e.systemId+'"'),t+=">"),t},hs=function(e,t,r){e&&e.defaultView&&(t!==e.defaultView.pageXOffset||r!==e.defaultView.pageYOffset)&&e.defaultView.scrollTo(t,r)},ps=function(e){var t=e[0],r=e[1],n=e[2];t.scrollLeft=r,t.scrollTop=n},ms="___html2canvas___pseudoelement_before",gs="___html2canvas___pseudoelement_after",ys='{\n    content: "" !important;\n    display: none !important;\n}',vs=function(e){ws(e,"."+ms+":before"+ys+"\n         ."+gs+":after"+ys)},ws=function(e,t){var r=e.ownerDocument;if(r){var n=r.createElement("style");n.textContent=t,e.appendChild(n)}};!function(e){e[e.VECTOR=0]="VECTOR",e[e.BEZIER_CURVE=1]="BEZIER_CURVE"}(us||(us={}));var bs,Bs=function(e,t){return e.length===t.length&&e.some((function(e,r){return e===t[r]}))},js=function(){function e(e,t){this.type=us.VECTOR,this.x=e,this.y=t}return e.prototype.add=function(t,r){return new e(this.x+t,this.y+r)},e}(),_s=function(e,t,r){return new js(e.x+(t.x-e.x)*r,e.y+(t.y-e.y)*r)},Cs=function(){function e(e,t,r,n){this.type=us.BEZIER_CURVE,this.start=e,this.startControl=t,this.endControl=r,this.end=n}return e.prototype.subdivide=function(t,r){var n=_s(this.start,this.startControl,t),o=_s(this.startControl,this.endControl,t),s=_s(this.endControl,this.end,t),i=_s(n,o,t),a=_s(o,s,t),A=_s(i,a,t);return r?new e(this.start,n,i,A):new e(A,a,s,this.end)},e.prototype.add=function(t,r){return new e(this.start.add(t,r),this.startControl.add(t,r),this.endControl.add(t,r),this.end.add(t,r))},e.prototype.reverse=function(){return new e(this.end,this.endControl,this.startControl,this.start)},e}(),xs=function(e){return e.type===us.BEZIER_CURVE},Es=function(e){var t=e.styles,r=e.bounds,n=st(t.borderTopLeftRadius,r.width,r.height),o=n[0],s=n[1],i=st(t.borderTopRightRadius,r.width,r.height),a=i[0],A=i[1],u=st(t.borderBottomRightRadius,r.width,r.height),c=u[0],l=u[1],d=st(t.borderBottomLeftRadius,r.width,r.height),f=d[0],h=d[1],p=[];p.push((o+a)/r.width),p.push((f+c)/r.width),p.push((s+h)/r.height),p.push((A+l)/r.height);var m=Math.max.apply(Math,p);m>1&&(o/=m,s/=m,a/=m,A/=m,c/=m,l/=m,f/=m,h/=m);var g=r.width-a,y=r.height-l,v=r.width-c,w=r.height-h,b=t.borderTopWidth,B=t.borderRightWidth,j=t.borderBottomWidth,_=t.borderLeftWidth,C=it(t.paddingTop,e.bounds.width),x=it(t.paddingRight,e.bounds.width),E=it(t.paddingBottom,e.bounds.width),N=it(t.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=o>0||s>0?Ns(r.left+_/3,r.top+b/3,o-_/3,s-b/3,bs.TOP_LEFT):new js(r.left+_/3,r.top+b/3),this.topRightBorderDoubleOuterBox=o>0||s>0?Ns(r.left+g,r.top+b/3,a-B/3,A-b/3,bs.TOP_RIGHT):new js(r.left+r.width-B/3,r.top+b/3),this.bottomRightBorderDoubleOuterBox=c>0||l>0?Ns(r.left+v,r.top+y,c-B/3,l-j/3,bs.BOTTOM_RIGHT):new js(r.left+r.width-B/3,r.top+r.height-j/3),this.bottomLeftBorderDoubleOuterBox=f>0||h>0?Ns(r.left+_/3,r.top+w,f-_/3,h-j/3,bs.BOTTOM_LEFT):new js(r.left+_/3,r.top+r.height-j/3),this.topLeftBorderDoubleInnerBox=o>0||s>0?Ns(r.left+2*_/3,r.top+2*b/3,o-2*_/3,s-2*b/3,bs.TOP_LEFT):new js(r.left+2*_/3,r.top+2*b/3),this.topRightBorderDoubleInnerBox=o>0||s>0?Ns(r.left+g,r.top+2*b/3,a-2*B/3,A-2*b/3,bs.TOP_RIGHT):new js(r.left+r.width-2*B/3,r.top+2*b/3),this.bottomRightBorderDoubleInnerBox=c>0||l>0?Ns(r.left+v,r.top+y,c-2*B/3,l-2*j/3,bs.BOTTOM_RIGHT):new js(r.left+r.width-2*B/3,r.top+r.height-2*j/3),this.bottomLeftBorderDoubleInnerBox=f>0||h>0?Ns(r.left+2*_/3,r.top+w,f-2*_/3,h-2*j/3,bs.BOTTOM_LEFT):new js(r.left+2*_/3,r.top+r.height-2*j/3),this.topLeftBorderStroke=o>0||s>0?Ns(r.left+_/2,r.top+b/2,o-_/2,s-b/2,bs.TOP_LEFT):new js(r.left+_/2,r.top+b/2),this.topRightBorderStroke=o>0||s>0?Ns(r.left+g,r.top+b/2,a-B/2,A-b/2,bs.TOP_RIGHT):new js(r.left+r.width-B/2,r.top+b/2),this.bottomRightBorderStroke=c>0||l>0?Ns(r.left+v,r.top+y,c-B/2,l-j/2,bs.BOTTOM_RIGHT):new js(r.left+r.width-B/2,r.top+r.height-j/2),this.bottomLeftBorderStroke=f>0||h>0?Ns(r.left+_/2,r.top+w,f-_/2,h-j/2,bs.BOTTOM_LEFT):new js(r.left+_/2,r.top+r.height-j/2),this.topLeftBorderBox=o>0||s>0?Ns(r.left,r.top,o,s,bs.TOP_LEFT):new js(r.left,r.top),this.topRightBorderBox=a>0||A>0?Ns(r.left+g,r.top,a,A,bs.TOP_RIGHT):new js(r.left+r.width,r.top),this.bottomRightBorderBox=c>0||l>0?Ns(r.left+v,r.top+y,c,l,bs.BOTTOM_RIGHT):new js(r.left+r.width,r.top+r.height),this.bottomLeftBorderBox=f>0||h>0?Ns(r.left,r.top+w,f,h,bs.BOTTOM_LEFT):new js(r.left,r.top+r.height),this.topLeftPaddingBox=o>0||s>0?Ns(r.left+_,r.top+b,Math.max(0,o-_),Math.max(0,s-b),bs.TOP_LEFT):new js(r.left+_,r.top+b),this.topRightPaddingBox=a>0||A>0?Ns(r.left+Math.min(g,r.width-B),r.top+b,g>r.width+B?0:Math.max(0,a-B),Math.max(0,A-b),bs.TOP_RIGHT):new js(r.left+r.width-B,r.top+b),this.bottomRightPaddingBox=c>0||l>0?Ns(r.left+Math.min(v,r.width-_),r.top+Math.min(y,r.height-j),Math.max(0,c-B),Math.max(0,l-j),bs.BOTTOM_RIGHT):new js(r.left+r.width-B,r.top+r.height-j),this.bottomLeftPaddingBox=f>0||h>0?Ns(r.left+_,r.top+Math.min(w,r.height-j),Math.max(0,f-_),Math.max(0,h-j),bs.BOTTOM_LEFT):new js(r.left+_,r.top+r.height-j),this.topLeftContentBox=o>0||s>0?Ns(r.left+_+N,r.top+b+C,Math.max(0,o-(_+N)),Math.max(0,s-(b+C)),bs.TOP_LEFT):new js(r.left+_+N,r.top+b+C),this.topRightContentBox=a>0||A>0?Ns(r.left+Math.min(g,r.width+_+N),r.top+b+C,g>r.width+_+N?0:a-_+N,A-(b+C),bs.TOP_RIGHT):new js(r.left+r.width-(B+x),r.top+b+C),this.bottomRightContentBox=c>0||l>0?Ns(r.left+Math.min(v,r.width-(_+N)),r.top+Math.min(y,r.height+b+C),Math.max(0,c-(B+x)),l-(j+E),bs.BOTTOM_RIGHT):new js(r.left+r.width-(B+x),r.top+r.height-(j+E)),this.bottomLeftContentBox=f>0||h>0?Ns(r.left+_+N,r.top+w,Math.max(0,f-(_+N)),h-(j+E),bs.BOTTOM_LEFT):new js(r.left+_+N,r.top+r.height-(j+E))};!function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_RIGHT=1]="TOP_RIGHT",e[e.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",e[e.BOTTOM_LEFT=3]="BOTTOM_LEFT"}(bs||(bs={}));var Ns=function(e,t,r,n,o){var s=(Math.sqrt(2)-1)/3*4,i=r*s,a=n*s,A=e+r,u=t+n;switch(o){case bs.TOP_LEFT:return new Cs(new js(e,u),new js(e,u-a),new js(A-i,t),new js(A,t));case bs.TOP_RIGHT:return new Cs(new js(e,t),new js(e+i,t),new js(A,u-a),new js(A,u));case bs.BOTTOM_RIGHT:return new Cs(new js(A,t),new js(A,t+a),new js(e+i,u),new js(e,u));case bs.BOTTOM_LEFT:default:return new Cs(new js(A,u),new js(A-i,u),new js(e,t+a),new js(e,t))}},Qs=function(e){return[e.topLeftBorderBox,e.topRightBorderBox,e.bottomRightBorderBox,e.bottomLeftBorderBox]},Fs=function(e){return[e.topLeftPaddingBox,e.topRightPaddingBox,e.bottomRightPaddingBox,e.bottomLeftPaddingBox]},Us=function(e,t,r){this.type=0,this.target=6,this.offsetX=e,this.offsetY=t,this.matrix=r},Ss=function(e,t){this.type=1,this.target=t,this.path=e},Ls=function(e){this.type=2,this.target=6,this.opacity=e},Ts=function(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]},Hs=function(){function e(e,t){if(this.container=e,this.effects=t.slice(0),this.curves=new Es(e),e.styles.opacity<1&&this.effects.push(new Ls(e.styles.opacity)),null!==e.styles.transform){var r=e.bounds.left+e.styles.transformOrigin[0].number,n=e.bounds.top+e.styles.transformOrigin[1].number,o=e.styles.transform;this.effects.push(new Us(r,n,o))}if(e.styles.overflowX!==Yr.VISIBLE){var s=Qs(this.curves),i=Fs(this.curves);Bs(s,i)?this.effects.push(new Ss(s,6)):(this.effects.push(new Ss(s,2)),this.effects.push(new Ss(i,4)))}}return e.prototype.getParentEffects=function(){var e=this.effects.slice(0);if(this.container.styles.overflowX!==Yr.VISIBLE){var t=Qs(this.curves),r=Fs(this.curves);Bs(t,r)||e.push(new Ss(r,6))}return e},e}(),Is=function(e,t,r,n){e.container.elements.forEach((function(o){var s=Rn(o.flags,4),i=Rn(o.flags,2),a=new Hs(o,e.getParentEffects());Rn(o.styles.display,2048)&&n.push(a);var A=Rn(o.flags,8)?[]:n;if(s||i){var u=s||o.styles.isPositioned()?r:t,c=new Ts(a);if(o.styles.isPositioned()||o.styles.opacity<1||o.styles.isTransformed()){var l=o.styles.zIndex.order;if(l<0){var d=0;u.negativeZIndex.some((function(e,t){return l>e.element.container.styles.zIndex.order?(d=t,!1):d>0})),u.negativeZIndex.splice(d,0,c)}else if(l>0){var f=0;u.positiveZIndex.some((function(e,t){return l>=e.element.container.styles.zIndex.order?(f=t+1,!1):f>0})),u.positiveZIndex.splice(f,0,c)}else u.zeroOrAutoZIndexOrTransformedOrOpacity.push(c)}else o.styles.isFloating()?u.nonPositionedFloats.push(c):u.nonPositionedInlineLevel.push(c);Is(a,c,s?c:r,A)}else o.styles.isInlineLevel()?t.inlineLevel.push(a):t.nonInlineLevel.push(a),Is(a,t,r,A);Rn(o.flags,8)&&Ps(o,A)}))},Ps=function(e,t){for(var r=e instanceof lo?e.start:1,n=e instanceof lo&&e.reversed,o=0;o<t.length;o++){var s=t[o];s.container instanceof co&&"number"==typeof s.container.value&&0!==s.container.value&&(r=s.container.value),s.listValue=is(r,s.container.styles.listStyleType,!0),r+=n?-1:1}},Os=function(e,t){switch(t){case 0:return Rs(e.topLeftBorderBox,e.topLeftPaddingBox,e.topRightBorderBox,e.topRightPaddingBox);case 1:return Rs(e.topRightBorderBox,e.topRightPaddingBox,e.bottomRightBorderBox,e.bottomRightPaddingBox);case 2:return Rs(e.bottomRightBorderBox,e.bottomRightPaddingBox,e.bottomLeftBorderBox,e.bottomLeftPaddingBox);case 3:default:return Rs(e.bottomLeftBorderBox,e.bottomLeftPaddingBox,e.topLeftBorderBox,e.topLeftPaddingBox)}},ks=function(e,t){var r=[];return xs(e)?r.push(e.subdivide(.5,!1)):r.push(e),xs(t)?r.push(t.subdivide(.5,!0)):r.push(t),r},Rs=function(e,t,r,n){var o=[];return xs(e)?o.push(e.subdivide(.5,!1)):o.push(e),xs(r)?o.push(r.subdivide(.5,!0)):o.push(r),xs(n)?o.push(n.subdivide(.5,!0).reverse()):o.push(n),xs(t)?o.push(t.subdivide(.5,!1).reverse()):o.push(t),o},Ms=function(e){var t=e.bounds,r=e.styles;return t.add(r.borderLeftWidth,r.borderTopWidth,-(r.borderRightWidth+r.borderLeftWidth),-(r.borderTopWidth+r.borderBottomWidth))},Ds=function(e){var t=e.styles,r=e.bounds,n=it(t.paddingLeft,r.width),o=it(t.paddingRight,r.width),s=it(t.paddingTop,r.width),i=it(t.paddingBottom,r.width);return r.add(n+t.borderLeftWidth,s+t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth+n+o),-(t.borderTopWidth+t.borderBottomWidth+s+i))},Ks=function(e,t,r){var n=function(e,t){return 0===e?t.bounds:2===e?Ds(t):Ms(t)}(Gs(e.styles.backgroundOrigin,t),e),o=function(e,t){return e===bt.BORDER_BOX?t.bounds:e===bt.CONTENT_BOX?Ds(t):Ms(t)}(Gs(e.styles.backgroundClip,t),e),s=qs(Gs(e.styles.backgroundSize,t),r,n),i=s[0],a=s[1],A=st(Gs(e.styles.backgroundPosition,t),n.width-i,n.height-a);return[Xs(Gs(e.styles.backgroundRepeat,t),A,s,n,o),Math.round(n.left+A[0]),Math.round(n.top+A[1]),i,a]},zs=function(e){return qe(e)&&e.value===dr.AUTO},Vs=function(e){return"number"==typeof e},qs=function(e,t,r){var n=t[0],o=t[1],s=t[2],i=e[0],a=e[1];if(et(i)&&a&&et(a))return[it(i,r.width),it(a,r.height)];var A=Vs(s);if(qe(i)&&(i.value===dr.CONTAIN||i.value===dr.COVER))return Vs(s)?r.width/r.height<s!=(i.value===dr.COVER)?[r.width,r.width/s]:[r.height*s,r.height]:[r.width,r.height];var u=Vs(n),c=Vs(o),l=u||c;if(zs(i)&&(!a||zs(a)))return u&&c?[n,o]:A||l?l&&A?[u?n:o*s,c?o:n/s]:[u?n:r.width,c?o:r.height]:[r.width,r.height];if(A){var d=0,f=0;return et(i)?d=it(i,r.width):et(a)&&(f=it(a,r.height)),zs(i)?d=f*s:a&&!zs(a)||(f=d/s),[d,f]}var h=null,p=null;if(et(i)?h=it(i,r.width):a&&et(a)&&(p=it(a,r.height)),null===h||a&&!zs(a)||(p=u&&c?h/n*o:r.height),null!==p&&zs(i)&&(h=u&&c?p/o*n:r.width),null!==h&&null!==p)return[h,p];throw new Error("Unable to calculate background-size for element")},Gs=function(e,t){var r=e[t];return void 0===r?e[0]:r},Xs=function(e,t,r,n,o){var s=t[0],i=t[1],a=r[0],A=r[1];switch(e){case ar.REPEAT_X:return[new js(Math.round(n.left),Math.round(n.top+i)),new js(Math.round(n.left+n.width),Math.round(n.top+i)),new js(Math.round(n.left+n.width),Math.round(A+n.top+i)),new js(Math.round(n.left),Math.round(A+n.top+i))];case ar.REPEAT_Y:return[new js(Math.round(n.left+s),Math.round(n.top)),new js(Math.round(n.left+s+a),Math.round(n.top)),new js(Math.round(n.left+s+a),Math.round(n.height+n.top)),new js(Math.round(n.left+s),Math.round(n.height+n.top))];case ar.NO_REPEAT:return[new js(Math.round(n.left+s),Math.round(n.top+i)),new js(Math.round(n.left+s+a),Math.round(n.top+i)),new js(Math.round(n.left+s+a),Math.round(n.top+i+A)),new js(Math.round(n.left+s),Math.round(n.top+i+A))];default:return[new js(Math.round(o.left),Math.round(o.top)),new js(Math.round(o.left+o.width),Math.round(o.top)),new js(Math.round(o.left+o.width),Math.round(o.height+o.top)),new js(Math.round(o.left),Math.round(o.height+o.top))]}},Ws="Hidden Text",Js=function(){function e(e){this._data={},this._document=e}return e.prototype.parseMetrics=function(e,t){var r=this._document.createElement("div"),n=this._document.createElement("img"),o=this._document.createElement("span"),s=this._document.body;r.style.visibility="hidden",r.style.fontFamily=e,r.style.fontSize=t,r.style.margin="0",r.style.padding="0",s.appendChild(r),n.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",n.width=1,n.height=1,n.style.margin="0",n.style.padding="0",n.style.verticalAlign="baseline",o.style.fontFamily=e,o.style.fontSize=t,o.style.margin="0",o.style.padding="0",o.appendChild(this._document.createTextNode(Ws)),r.appendChild(o),r.appendChild(n);var i=n.offsetTop-o.offsetTop+2;r.removeChild(o),r.appendChild(this._document.createTextNode(Ws)),r.style.lineHeight="normal",n.style.verticalAlign="super";var a=n.offsetTop-r.offsetTop+2;return s.removeChild(r),{baseline:i,middle:a}},e.prototype.getMetrics=function(e,t){var r=e+" "+t;return void 0===this._data[r]&&(this._data[r]=this.parseMetrics(e,t)),this._data[r]},e}(),Ys=function(){function e(e){this._activeEffects=[],this.canvas=e.canvas?e.canvas:document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.options=e,e.canvas||(this.canvas.width=Math.floor(e.width*e.scale),this.canvas.height=Math.floor(e.height*e.scale),this.canvas.style.width=e.width+"px",this.canvas.style.height=e.height+"px"),this.fontMetrics=new Js(document),this.ctx.scale(this.options.scale,this.options.scale),this.ctx.translate(-e.x+e.scrollX,-e.y+e.scrollY),this.ctx.textBaseline="bottom",this._activeEffects=[],Ot.getInstance(e.id).debug("Canvas renderer initialized ("+e.width+"x"+e.height+" at "+e.x+","+e.y+") with scale "+e.scale)}return e.prototype.applyEffects=function(e,t){for(var r=this;this._activeEffects.length;)this.popEffect();e.filter((function(e){return Rn(e.target,t)})).forEach((function(e){return r.applyEffect(e)}))},e.prototype.applyEffect=function(e){this.ctx.save(),function(e){return 2===e.type}(e)&&(this.ctx.globalAlpha=e.opacity),function(e){return 0===e.type}(e)&&(this.ctx.translate(e.offsetX,e.offsetY),this.ctx.transform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this.ctx.translate(-e.offsetX,-e.offsetY)),function(e){return 1===e.type}(e)&&(this.path(e.path),this.ctx.clip()),this._activeEffects.push(e)},e.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},e.prototype.renderStack=function(e){return n(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return e.element.container.styles.isVisible()?[4,this.renderStackContent(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},e.prototype.renderNode=function(e){return n(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return e.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(e)]:[3,3];case 1:return t.sent(),[4,this.renderNodeContent(e)];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},e.prototype.renderTextWithLetterSpacing=function(e,t){var r=this;0===t?this.ctx.fillText(e.text,e.bounds.left,e.bounds.top+e.bounds.height):a(e.text).map((function(e){return A(e)})).reduce((function(t,n){return r.ctx.fillText(n,t,e.bounds.top+e.bounds.height),t+r.ctx.measureText(n).width}),e.bounds.left)},e.prototype.createFontStyle=function(e){var t=e.fontVariant.filter((function(e){return"normal"===e||"small-caps"===e})).join(""),r=e.fontFamily.join(", "),n=ze(e.fontSize)?""+e.fontSize.number+e.fontSize.unit:e.fontSize.number+"px";return[[e.fontStyle,t,e.fontWeight,n,r].join(" "),r,n]},e.prototype.renderTextNode=function(e,t){return n(this,void 0,void 0,(function(){var r,n,s,i,a=this;return o(this,(function(o){return r=this.createFontStyle(t),n=r[0],s=r[1],i=r[2],this.ctx.font=n,e.textBounds.forEach((function(e){a.ctx.fillStyle=pt(t.color),a.renderTextWithLetterSpacing(e,t.letterSpacing);var r=t.textShadow;r.length&&e.text.trim().length&&(r.slice(0).reverse().forEach((function(t){a.ctx.shadowColor=pt(t.color),a.ctx.shadowOffsetX=t.offsetX.number*a.options.scale,a.ctx.shadowOffsetY=t.offsetY.number*a.options.scale,a.ctx.shadowBlur=t.blur.number,a.ctx.fillText(e.text,e.bounds.left,e.bounds.top+e.bounds.height)})),a.ctx.shadowColor="",a.ctx.shadowOffsetX=0,a.ctx.shadowOffsetY=0,a.ctx.shadowBlur=0),t.textDecorationLine.length&&(a.ctx.fillStyle=pt(t.textDecorationColor||t.color),t.textDecorationLine.forEach((function(t){switch(t){case 1:var r=a.fontMetrics.getMetrics(s,i).baseline;a.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top+r),e.bounds.width,1);break;case 2:a.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top),e.bounds.width,1);break;case 3:var n=a.fontMetrics.getMetrics(s,i).middle;a.ctx.fillRect(e.bounds.left,Math.ceil(e.bounds.top+n),e.bounds.width,1)}})))})),[2]}))}))},e.prototype.renderReplacedElement=function(e,t,r){if(r&&e.intrinsicWidth>0&&e.intrinsicHeight>0){var n=Ds(e),o=Fs(t);this.path(o),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(r,0,0,e.intrinsicWidth,e.intrinsicHeight,n.left,n.top,n.width,n.height),this.ctx.restore()}},e.prototype.renderNodeContent=function(t){return n(this,void 0,void 0,(function(){var r,n,i,a,A,u,c,l,f,h,p,m,g,y;return o(this,(function(o){switch(o.label){case 0:this.applyEffects(t.effects,4),r=t.container,n=t.curves,i=r.styles,a=0,A=r.textNodes,o.label=1;case 1:return a<A.length?(u=A[a],[4,this.renderTextNode(u,i)]):[3,4];case 2:o.sent(),o.label=3;case 3:return a++,[3,1];case 4:if(!(r instanceof ao))return[3,8];o.label=5;case 5:return o.trys.push([5,7,,8]),[4,this.options.cache.match(r.src)];case 6:return m=o.sent(),this.renderReplacedElement(r,n,m),[3,8];case 7:return o.sent(),Ot.getInstance(this.options.id).error("Error loading image "+r.src),[3,8];case 8:if(r instanceof Ao&&this.renderReplacedElement(r,n,r.canvas),!(r instanceof uo))return[3,12];o.label=9;case 9:return o.trys.push([9,11,,12]),[4,this.options.cache.match(r.svg)];case 10:return m=o.sent(),this.renderReplacedElement(r,n,m),[3,12];case 11:return o.sent(),Ot.getInstance(this.options.id).error("Error loading svg "+r.svg.substring(0,255)),[3,12];case 12:return r instanceof jo&&r.tree?[4,new e({id:this.options.id,scale:this.options.scale,backgroundColor:r.backgroundColor,x:0,y:0,scrollX:0,scrollY:0,width:r.width,height:r.height,cache:this.options.cache,windowWidth:r.width,windowHeight:r.height}).render(r.tree)]:[3,14];case 13:c=o.sent(),r.width&&r.height&&this.ctx.drawImage(c,0,0,r.width,r.height,r.bounds.left,r.bounds.top,r.bounds.width,r.bounds.height),o.label=14;case 14:if(r instanceof vo&&(l=Math.min(r.bounds.width,r.bounds.height),r.type===po?r.checked&&(this.ctx.save(),this.path([new js(r.bounds.left+.39363*l,r.bounds.top+.79*l),new js(r.bounds.left+.16*l,r.bounds.top+.5549*l),new js(r.bounds.left+.27347*l,r.bounds.top+.44071*l),new js(r.bounds.left+.39694*l,r.bounds.top+.5649*l),new js(r.bounds.left+.72983*l,r.bounds.top+.23*l),new js(r.bounds.left+.84*l,r.bounds.top+.34085*l),new js(r.bounds.left+.39363*l,r.bounds.top+.79*l)]),this.ctx.fillStyle=pt(yo),this.ctx.fill(),this.ctx.restore()):r.type===mo&&r.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(r.bounds.left+l/2,r.bounds.top+l/2,l/4,0,2*Math.PI,!0),this.ctx.fillStyle=pt(yo),this.ctx.fill(),this.ctx.restore())),Zs(r)&&r.value.length){switch(this.ctx.font=this.createFontStyle(i)[0],this.ctx.fillStyle=pt(i.color),this.ctx.textBaseline="middle",this.ctx.textAlign=ei(r.styles.textAlign),y=Ds(r),f=0,r.styles.textAlign){case an.CENTER:f+=y.width/2;break;case an.RIGHT:f+=y.width}h=y.add(f,0,0,-y.height/2+1),this.ctx.save(),this.path([new js(y.left,y.top),new js(y.left+y.width,y.top),new js(y.left+y.width,y.top+y.height),new js(y.left,y.top+y.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Zn(r.value,h),i.letterSpacing),this.ctx.restore(),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"}if(!Rn(r.styles.display,2048))return[3,20];if(null===r.styles.listStyleImage)return[3,19];if((p=r.styles.listStyleImage).type!==Ct.URL)return[3,18];m=void 0,g=p.url,o.label=15;case 15:return o.trys.push([15,17,,18]),[4,this.options.cache.match(g)];case 16:return m=o.sent(),this.ctx.drawImage(m,r.bounds.left-(m.width+10),r.bounds.top),[3,18];case 17:return o.sent(),Ot.getInstance(this.options.id).error("Error loading list-style-image "+g),[3,18];case 18:return[3,20];case 19:t.listValue&&r.styles.listStyleType!==Wr.NONE&&(this.ctx.font=this.createFontStyle(i)[0],this.ctx.fillStyle=pt(i.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",y=new s(r.bounds.left,r.bounds.top+it(r.styles.paddingTop,r.bounds.width),r.bounds.width,function(e,t){return qe(e)&&"normal"===e.value?1.2*t:e.type===d.NUMBER_TOKEN?t*e.number:et(e)?it(e,t):t}(i.lineHeight,i.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Zn(t.listValue,y),i.letterSpacing),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),o.label=20;case 20:return[2]}}))}))},e.prototype.renderStackContent=function(e){return n(this,void 0,void 0,(function(){var t,r,n,s,i,a,A,u,c,l,d,f,h,p,m;return o(this,(function(o){switch(o.label){case 0:return[4,this.renderNodeBackgroundAndBorders(e.element)];case 1:o.sent(),t=0,r=e.negativeZIndex,o.label=2;case 2:return t<r.length?(m=r[t],[4,this.renderStack(m)]):[3,5];case 3:o.sent(),o.label=4;case 4:return t++,[3,2];case 5:return[4,this.renderNodeContent(e.element)];case 6:o.sent(),n=0,s=e.nonInlineLevel,o.label=7;case 7:return n<s.length?(m=s[n],[4,this.renderNode(m)]):[3,10];case 8:o.sent(),o.label=9;case 9:return n++,[3,7];case 10:i=0,a=e.nonPositionedFloats,o.label=11;case 11:return i<a.length?(m=a[i],[4,this.renderStack(m)]):[3,14];case 12:o.sent(),o.label=13;case 13:return i++,[3,11];case 14:A=0,u=e.nonPositionedInlineLevel,o.label=15;case 15:return A<u.length?(m=u[A],[4,this.renderStack(m)]):[3,18];case 16:o.sent(),o.label=17;case 17:return A++,[3,15];case 18:c=0,l=e.inlineLevel,o.label=19;case 19:return c<l.length?(m=l[c],[4,this.renderNode(m)]):[3,22];case 20:o.sent(),o.label=21;case 21:return c++,[3,19];case 22:d=0,f=e.zeroOrAutoZIndexOrTransformedOrOpacity,o.label=23;case 23:return d<f.length?(m=f[d],[4,this.renderStack(m)]):[3,26];case 24:o.sent(),o.label=25;case 25:return d++,[3,23];case 26:h=0,p=e.positiveZIndex,o.label=27;case 27:return h<p.length?(m=p[h],[4,this.renderStack(m)]):[3,30];case 28:o.sent(),o.label=29;case 29:return h++,[3,27];case 30:return[2]}}))}))},e.prototype.mask=function(e){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(e.slice(0).reverse()),this.ctx.closePath()},e.prototype.path=function(e){this.ctx.beginPath(),this.formatPath(e),this.ctx.closePath()},e.prototype.formatPath=function(e){var t=this;e.forEach((function(e,r){var n=xs(e)?e.start:e;0===r?t.ctx.moveTo(n.x,n.y):t.ctx.lineTo(n.x,n.y),xs(e)&&t.ctx.bezierCurveTo(e.startControl.x,e.startControl.y,e.endControl.x,e.endControl.y,e.end.x,e.end.y)}))},e.prototype.renderRepeat=function(e,t,r,n){this.path(e),this.ctx.fillStyle=t,this.ctx.translate(r,n),this.ctx.fill(),this.ctx.translate(-r,-n)},e.prototype.resizeImage=function(e,t,r){if(e.width===t&&e.height===r)return e;var n=this.canvas.ownerDocument.createElement("canvas");return n.width=t,n.height=r,n.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t,r),n},e.prototype.renderBackgroundImage=function(e){return n(this,void 0,void 0,(function(){var t,r,n,s,i,a;return o(this,(function(A){switch(A.label){case 0:t=e.styles.backgroundImage.length-1,r=function(r){var s,i,a,A,u,c,l,d,f,h,p,m,g,y,v,w,b,B,j,_,C,x,E,N,Q,F,U,S,L,T,H;return o(this,(function(o){switch(o.label){case 0:if(r.type!==Ct.URL)return[3,5];s=void 0,i=r.url,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,n.options.cache.match(i)];case 2:return s=o.sent(),[3,4];case 3:return o.sent(),Ot.getInstance(n.options.id).error("Error loading background-image "+i),[3,4];case 4:return s&&(a=Ks(e,t,[s.width,s.height,s.width/s.height]),w=a[0],x=a[1],E=a[2],j=a[3],_=a[4],y=n.ctx.createPattern(n.resizeImage(s,j,_),"repeat"),n.renderRepeat(w,y,x,E)),[3,6];case 5:r.type===Ct.LINEAR_GRADIENT?(A=Ks(e,t,[null,null,null]),w=A[0],x=A[1],E=A[2],j=A[3],_=A[4],u=Ft(r.angle,j,_),c=u[0],l=u[1],d=u[2],f=u[3],h=u[4],(p=document.createElement("canvas")).width=j,p.height=_,m=p.getContext("2d"),g=m.createLinearGradient(l,f,d,h),Qt(r.stops,c).forEach((function(e){return g.addColorStop(e.stop,pt(e.color))})),m.fillStyle=g,m.fillRect(0,0,j,_),j>0&&_>0&&(y=n.ctx.createPattern(p,"repeat"),n.renderRepeat(w,y,x,E))):function(e){return e.type===Ct.RADIAL_GRADIENT}(r)&&(v=Ks(e,t,[null,null,null]),w=v[0],b=v[1],B=v[2],j=v[3],_=v[4],C=0===r.position.length?[nt]:r.position,x=it(C[0],j),E=it(C[C.length-1],_),N=function(e,t,r,n,o){var s=0,i=0;switch(e.size){case sr.CLOSEST_SIDE:e.shape===or.CIRCLE?s=i=Math.min(Math.abs(t),Math.abs(t-n),Math.abs(r),Math.abs(r-o)):e.shape===or.ELLIPSE&&(s=Math.min(Math.abs(t),Math.abs(t-n)),i=Math.min(Math.abs(r),Math.abs(r-o)));break;case sr.CLOSEST_CORNER:if(e.shape===or.CIRCLE)s=i=Math.min(Ut(t,r),Ut(t,r-o),Ut(t-n,r),Ut(t-n,r-o));else if(e.shape===or.ELLIPSE){var a=Math.min(Math.abs(r),Math.abs(r-o))/Math.min(Math.abs(t),Math.abs(t-n)),A=St(n,o,t,r,!0),u=A[0],c=A[1];i=a*(s=Ut(u-t,(c-r)/a))}break;case sr.FARTHEST_SIDE:e.shape===or.CIRCLE?s=i=Math.max(Math.abs(t),Math.abs(t-n),Math.abs(r),Math.abs(r-o)):e.shape===or.ELLIPSE&&(s=Math.max(Math.abs(t),Math.abs(t-n)),i=Math.max(Math.abs(r),Math.abs(r-o)));break;case sr.FARTHEST_CORNER:if(e.shape===or.CIRCLE)s=i=Math.max(Ut(t,r),Ut(t,r-o),Ut(t-n,r),Ut(t-n,r-o));else if(e.shape===or.ELLIPSE){a=Math.max(Math.abs(r),Math.abs(r-o))/Math.max(Math.abs(t),Math.abs(t-n));var l=St(n,o,t,r,!1);u=l[0],c=l[1],i=a*(s=Ut(u-t,(c-r)/a))}}return Array.isArray(e.size)&&(s=it(e.size[0],n),i=2===e.size.length?it(e.size[1],o):s),[s,i]}(r,x,E,j,_),Q=N[0],F=N[1],Q>0&&Q>0&&(U=n.ctx.createRadialGradient(b+x,B+E,0,b+x,B+E,Q),Qt(r.stops,2*Q).forEach((function(e){return U.addColorStop(e.stop,pt(e.color))})),n.path(w),n.ctx.fillStyle=U,Q!==F?(S=e.bounds.left+.5*e.bounds.width,L=e.bounds.top+.5*e.bounds.height,H=1/(T=F/Q),n.ctx.save(),n.ctx.translate(S,L),n.ctx.transform(1,0,0,T,0,0),n.ctx.translate(-S,-L),n.ctx.fillRect(b,H*(B-L)+L,j,_*H),n.ctx.restore()):n.ctx.fill())),o.label=6;case 6:return t--,[2]}}))},n=this,s=0,i=e.styles.backgroundImage.slice(0).reverse(),A.label=1;case 1:return s<i.length?(a=i[s],[5,r(a)]):[3,4];case 2:A.sent(),A.label=3;case 3:return s++,[3,1];case 4:return[2]}}))}))},e.prototype.renderSolidBorder=function(e,t,r){return n(this,void 0,void 0,(function(){return o(this,(function(n){return this.path(Os(r,t)),this.ctx.fillStyle=pt(e),this.ctx.fill(),[2]}))}))},e.prototype.renderDoubleBorder=function(e,t,r,s){return n(this,void 0,void 0,(function(){var n,i;return o(this,(function(o){switch(o.label){case 0:return t<3?[4,this.renderSolidBorder(e,r,s)]:[3,2];case 1:return o.sent(),[2];case 2:return n=function(e,t){switch(t){case 0:return Rs(e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox,e.topRightBorderBox,e.topRightBorderDoubleOuterBox);case 1:return Rs(e.topRightBorderBox,e.topRightBorderDoubleOuterBox,e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox);case 2:return Rs(e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox,e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox);case 3:default:return Rs(e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox,e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox)}}(s,r),this.path(n),this.ctx.fillStyle=pt(e),this.ctx.fill(),i=function(e,t){switch(t){case 0:return Rs(e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox,e.topRightBorderDoubleInnerBox,e.topRightPaddingBox);case 1:return Rs(e.topRightBorderDoubleInnerBox,e.topRightPaddingBox,e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox);case 2:return Rs(e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox,e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox);case 3:default:return Rs(e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox,e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox)}}(s,r),this.path(i),this.ctx.fill(),[2]}}))}))},e.prototype.renderNodeBackgroundAndBorders=function(e){return n(this,void 0,void 0,(function(){var t,r,n,s,i,a,A,u,c=this;return o(this,(function(o){switch(o.label){case 0:return this.applyEffects(e.effects,2),t=e.container.styles,r=!ht(t.backgroundColor)||t.backgroundImage.length,n=[{style:t.borderTopStyle,color:t.borderTopColor,width:t.borderTopWidth},{style:t.borderRightStyle,color:t.borderRightColor,width:t.borderRightWidth},{style:t.borderBottomStyle,color:t.borderBottomColor,width:t.borderBottomWidth},{style:t.borderLeftStyle,color:t.borderLeftColor,width:t.borderLeftWidth}],s=$s(Gs(t.backgroundClip,0),e.curves),r||t.boxShadow.length?(this.ctx.save(),this.path(s),this.ctx.clip(),ht(t.backgroundColor)||(this.ctx.fillStyle=pt(t.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(e.container)]):[3,2];case 1:o.sent(),this.ctx.restore(),t.boxShadow.slice(0).reverse().forEach((function(t){c.ctx.save();var r,n,o,s,i,a=Qs(e.curves),A=t.inset?0:1e4,u=(r=a,n=-A+(t.inset?1:-1)*t.spread.number,o=(t.inset?1:-1)*t.spread.number,s=t.spread.number*(t.inset?-2:2),i=t.spread.number*(t.inset?-2:2),r.map((function(e,t){switch(t){case 0:return e.add(n,o);case 1:return e.add(n+s,o);case 2:return e.add(n+s,o+i);case 3:return e.add(n,o+i)}return e})));t.inset?(c.path(a),c.ctx.clip(),c.mask(u)):(c.mask(a),c.ctx.clip(),c.path(u)),c.ctx.shadowOffsetX=t.offsetX.number+A,c.ctx.shadowOffsetY=t.offsetY.number,c.ctx.shadowColor=pt(t.color),c.ctx.shadowBlur=t.blur.number,c.ctx.fillStyle=t.inset?pt(t.color):"rgba(0,0,0,1)",c.ctx.fill(),c.ctx.restore()})),o.label=2;case 2:i=0,a=0,A=n,o.label=3;case 3:return a<A.length?(u=A[a]).style!==pr.NONE&&!ht(u.color)&&u.width>0?u.style!==pr.DASHED?[3,5]:[4,this.renderDashedDottedBorder(u.color,u.width,i,e.curves,pr.DASHED)]:[3,11]:[3,13];case 4:return o.sent(),[3,11];case 5:return u.style!==pr.DOTTED?[3,7]:[4,this.renderDashedDottedBorder(u.color,u.width,i,e.curves,pr.DOTTED)];case 6:return o.sent(),[3,11];case 7:return u.style!==pr.DOUBLE?[3,9]:[4,this.renderDoubleBorder(u.color,u.width,i,e.curves)];case 8:return o.sent(),[3,11];case 9:return[4,this.renderSolidBorder(u.color,i,e.curves)];case 10:o.sent(),o.label=11;case 11:i++,o.label=12;case 12:return a++,[3,3];case 13:return[2]}}))}))},e.prototype.renderDashedDottedBorder=function(e,t,r,s,i){return n(this,void 0,void 0,(function(){var n,a,A,u,c,l,d,f,h,p,m,g,y,v,w,b;return o(this,(function(o){return this.ctx.save(),n=function(e,t){switch(t){case 0:return ks(e.topLeftBorderStroke,e.topRightBorderStroke);case 1:return ks(e.topRightBorderStroke,e.bottomRightBorderStroke);case 2:return ks(e.bottomRightBorderStroke,e.bottomLeftBorderStroke);case 3:default:return ks(e.bottomLeftBorderStroke,e.topLeftBorderStroke)}}(s,r),a=Os(s,r),i===pr.DASHED&&(this.path(a),this.ctx.clip()),xs(a[0])?(A=a[0].start.x,u=a[0].start.y):(A=a[0].x,u=a[0].y),xs(a[1])?(c=a[1].end.x,l=a[1].end.y):(c=a[1].x,l=a[1].y),d=0===r||2===r?Math.abs(A-c):Math.abs(u-l),this.ctx.beginPath(),i===pr.DOTTED?this.formatPath(n):this.formatPath(a.slice(0,2)),f=t<3?3*t:2*t,h=t<3?2*t:t,i===pr.DOTTED&&(f=t,h=t),p=!0,d<=2*f?p=!1:d<=2*f+h?(f*=m=d/(2*f+h),h*=m):(g=Math.floor((d+h)/(f+h)),y=(d-g*f)/(g-1),h=(v=(d-(g+1)*f)/g)<=0||Math.abs(h-y)<Math.abs(h-v)?y:v),p&&(i===pr.DOTTED?this.ctx.setLineDash([0,f+h]):this.ctx.setLineDash([f,h])),i===pr.DOTTED?(this.ctx.lineCap="round",this.ctx.lineWidth=t):this.ctx.lineWidth=2*t+1.1,this.ctx.strokeStyle=pt(e),this.ctx.stroke(),this.ctx.setLineDash([]),i===pr.DASHED&&(xs(a[0])&&(w=a[3],b=a[0],this.ctx.beginPath(),this.formatPath([new js(w.end.x,w.end.y),new js(b.start.x,b.start.y)]),this.ctx.stroke()),xs(a[1])&&(w=a[1],b=a[2],this.ctx.beginPath(),this.formatPath([new js(w.end.x,w.end.y),new js(b.start.x,b.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]}))}))},e.prototype.render=function(e){return n(this,void 0,void 0,(function(){var t;return o(this,(function(r){switch(r.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=pt(this.options.backgroundColor),this.ctx.fillRect(this.options.x-this.options.scrollX,this.options.y-this.options.scrollY,this.options.width,this.options.height)),n=new Hs(e,[]),o=new Ts(n),Is(n,o,o,s=[]),Ps(n.container,s),t=o,[4,this.renderStack(t)];case 1:return r.sent(),this.applyEffects([],2),[2,this.canvas]}var n,o,s}))}))},e}(),Zs=function(e){return e instanceof bo||e instanceof wo||e instanceof vo&&e.type!==mo&&e.type!==po},$s=function(e,t){switch(e){case bt.BORDER_BOX:return Qs(t);case bt.CONTENT_BOX:return function(e){return[e.topLeftContentBox,e.topRightContentBox,e.bottomRightContentBox,e.bottomLeftContentBox]}(t);case bt.PADDING_BOX:default:return Fs(t)}},ei=function(e){switch(e){case an.CENTER:return"center";case an.RIGHT:return"right";case an.LEFT:default:return"left"}},ti=function(){function e(e){this.canvas=e.canvas?e.canvas:document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.options=e,this.canvas.width=Math.floor(e.width*e.scale),this.canvas.height=Math.floor(e.height*e.scale),this.canvas.style.width=e.width+"px",this.canvas.style.height=e.height+"px",this.ctx.scale(this.options.scale,this.options.scale),this.ctx.translate(-e.x+e.scrollX,-e.y+e.scrollY),Ot.getInstance(e.id).debug("EXPERIMENTAL ForeignObject renderer initialized ("+e.width+"x"+e.height+" at "+e.x+","+e.y+") with scale "+e.scale)}return e.prototype.render=function(e){return n(this,void 0,void 0,(function(){var t,r;return o(this,(function(n){switch(n.label){case 0:return t=Ht(Math.max(this.options.windowWidth,this.options.width)*this.options.scale,Math.max(this.options.windowHeight,this.options.height)*this.options.scale,this.options.scrollX*this.options.scale,this.options.scrollY*this.options.scale,e),[4,ri(t)];case 1:return r=n.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=pt(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(r,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}}))}))},e}(),ri=function(e){return new Promise((function(t,r){var n=new Image;n.onload=function(){t(n)},n.onerror=r,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))}))},ni=function(e){return ft(Ke.create(e).parseComponentValue())};"undefined"!=typeof window&&kt.setContext(window);var oi=function(e,t){return n(undefined,void 0,void 0,(function(){var n,a,A,u,c,l,d,f,h,p,m,g,y,v,w,b,B,j,_,C,x,E,N;return o(this,(function(o){switch(o.label){case 0:if(!(n=e.ownerDocument))throw new Error("Element is not attached to a Document");if(!(a=n.defaultView))throw new Error("Document is not attached to a Window");return A=(Math.round(1e3*Math.random())+Date.now()).toString(16),u=Oo(e)||"HTML"===e.tagName?function(e){var t=e.body,r=e.documentElement;if(!t||!r)throw new Error("Unable to get document size");var n=Math.max(Math.max(t.scrollWidth,r.scrollWidth),Math.max(t.offsetWidth,r.offsetWidth),Math.max(t.clientWidth,r.clientWidth)),o=Math.max(Math.max(t.scrollHeight,r.scrollHeight),Math.max(t.offsetHeight,r.offsetHeight),Math.max(t.clientHeight,r.clientHeight));return new s(0,0,n,o)}(n):i(e),c=u.width,l=u.height,d=u.left,f=u.top,h=r({},{allowTaint:!1,imageTimeout:15e3,proxy:void 0,useCORS:!1},t),p={backgroundColor:"#ffffff",cache:t.cache?t.cache:kt.create(A,h),logging:!0,removeContainer:!0,foreignObjectRendering:!1,scale:a.devicePixelRatio||1,windowWidth:a.innerWidth,windowHeight:a.innerHeight,scrollX:a.pageXOffset,scrollY:a.pageYOffset,x:d,y:f,width:Math.ceil(c),height:Math.ceil(l),id:A},m=r({},p,h,t),g=new s(m.scrollX,m.scrollY,m.windowWidth,m.windowHeight),Ot.create({id:A,enabled:m.logging}),Ot.getInstance(A).debug("Starting document clone"),y=new As(e,{id:A,onclone:m.onclone,ignoreElements:m.ignoreElements,inlineImages:m.foreignObjectRendering,copyStyles:m.foreignObjectRendering}),(v=y.clonedReferenceElement)?[4,y.toIFrame(n,g)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return w=o.sent(),b=n.documentElement?ni(getComputedStyle(n.documentElement).backgroundColor):_t.TRANSPARENT,B=n.body?ni(getComputedStyle(n.body).backgroundColor):_t.TRANSPARENT,j=t.backgroundColor,_="string"==typeof j?ni(j):null===j?_t.TRANSPARENT:4294967295,C=e===n.documentElement?ht(b)?ht(B)?_:B:b:_,x={id:A,cache:m.cache,canvas:m.canvas,backgroundColor:C,scale:m.scale,x:m.x,y:m.y,scrollX:m.scrollX,scrollY:m.scrollY,width:m.width,height:m.height,windowWidth:m.windowWidth,windowHeight:m.windowHeight},m.foreignObjectRendering?(Ot.getInstance(A).debug("Document cloned, using foreign object rendering"),[4,new ti(x).render(v)]):[3,3];case 2:return E=o.sent(),[3,5];case 3:return Ot.getInstance(A).debug("Document cloned, using computed rendering"),kt.attachInstance(m.cache),Ot.getInstance(A).debug("Starting DOM parsing"),N=Eo(v),kt.detachInstance(),C===N.styles.backgroundColor&&(N.styles.backgroundColor=_t.TRANSPARENT),Ot.getInstance(A).debug("Starting renderer"),[4,new Ys(x).render(N)];case 4:E=o.sent(),o.label=5;case 5:return!0===m.removeContainer&&(As.destroy(w)||Ot.getInstance(A).error("Cannot detach cloned iframe as it is not in the DOM anymore")),Ot.getInstance(A).debug("Finished rendering"),Ot.destroy(A),kt.destroy(A),[2,E]}}))}))};return function(e,t){return void 0===t&&(t={}),oi(e,t)}}()},"./node_modules/jspdf/dist/jspdf.es.min.js":function(e,t,r){"use strict";r.r(t),r.d(t,{AcroForm:function(){return _e},AcroFormAppearance:function(){return we},AcroFormButton:function(){return fe},AcroFormCheckBox:function(){return ge},AcroFormChoiceField:function(){return ue},AcroFormComboBox:function(){return le},AcroFormEditBox:function(){return de},AcroFormListBox:function(){return ce},AcroFormPasswordField:function(){return ve},AcroFormPushButton:function(){return he},AcroFormRadioButton:function(){return pe},AcroFormTextField:function(){return ye},GState:function(){return U},ShadingPattern:function(){return L},TilingPattern:function(){return T},jsPDF:function(){return H}});var n=r("./node_modules/fflate/esm/browser.js"),o=function(){return"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this}();function s(){o.console&&"function"==typeof o.console.log&&o.console.log.apply(o.console,arguments)}var i={log:s,warn:function(e){o.console&&("function"==typeof o.console.warn?o.console.warn.apply(o.console,arguments):s.call(null,arguments))},error:function(e){o.console&&("function"==typeof o.console.error?o.console.error.apply(o.console,arguments):s(e))}};function a(e,t,r){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){d(n.response,t,r)},n.onerror=function(){i.error("could not download file")},n.send()}function A(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return t.status>=200&&t.status<=299}function u(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(r){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var c,l,d=o.saveAs||("object"!=typeof window||window!==o?function(){}:"undefined"!=typeof HTMLAnchorElement&&"download"in HTMLAnchorElement.prototype?function(e,t,r){var n=o.URL||o.webkitURL,s=document.createElement("a");t=t||e.name||"download",s.download=t,s.rel="noopener","string"==typeof e?(s.href=e,s.origin!==location.origin?A(s.href)?a(e,t,r):u(s,s.target="_blank"):u(s)):(s.href=n.createObjectURL(e),setTimeout((function(){n.revokeObjectURL(s.href)}),4e4),setTimeout((function(){u(s)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,t,r){if(t=t||e.name||"download","string"==typeof e)if(A(e))a(e,t,r);else{var n=document.createElement("a");n.href=e,n.target="_blank",setTimeout((function(){u(n)}))}else navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(i.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e}(e,r),t)}:function(e,t,r,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),"string"==typeof e)return a(e,t,r);var s="application/octet-stream"===e.type,i=/constructor/i.test(o.HTMLElement)||o.safari,A=/CriOS\/[\d]+/.test(navigator.userAgent);if((A||s&&i)&&"object"==typeof FileReader){var u=new FileReader;u.onloadend=function(){var e=u.result;e=A?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=e:location=e,n=null},u.readAsDataURL(e)}else{var c=o.URL||o.webkitURL,l=c.createObjectURL(e);n?n.location=l:location.href=l,n=null,setTimeout((function(){c.revokeObjectURL(l)}),4e4)}});function f(e){var t;e=e||"",this.ok=!1,"#"==e.charAt(0)&&(e=e.substr(1,6)),e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[e=(e=e.replace(/ /g,"")).toLowerCase()]||e;for(var r=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}],n=0;n<r.length;n++){var o=r[n].re,s=r[n].process,i=o.exec(e);i&&(t=s(i),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var e=this.r.toString(16),t=this.g.toString(16),r=this.b.toString(16);return 1==e.length&&(e="0"+e),1==t.length&&(t="0"+t),1==r.length&&(r="0"+r),"#"+e+t+r}}function h(e,t){var r=e[0],n=e[1],o=e[2],s=e[3];r=m(r,n,o,s,t[0],7,-680876936),s=m(s,r,n,o,t[1],12,-389564586),o=m(o,s,r,n,t[2],17,606105819),n=m(n,o,s,r,t[3],22,-1044525330),r=m(r,n,o,s,t[4],7,-176418897),s=m(s,r,n,o,t[5],12,1200080426),o=m(o,s,r,n,t[6],17,-1473231341),n=m(n,o,s,r,t[7],22,-45705983),r=m(r,n,o,s,t[8],7,1770035416),s=m(s,r,n,o,t[9],12,-1958414417),o=m(o,s,r,n,t[10],17,-42063),n=m(n,o,s,r,t[11],22,-1990404162),r=m(r,n,o,s,t[12],7,1804603682),s=m(s,r,n,o,t[13],12,-40341101),o=m(o,s,r,n,t[14],17,-1502002290),r=g(r,n=m(n,o,s,r,t[15],22,1236535329),o,s,t[1],5,-165796510),s=g(s,r,n,o,t[6],9,-1069501632),o=g(o,s,r,n,t[11],14,643717713),n=g(n,o,s,r,t[0],20,-373897302),r=g(r,n,o,s,t[5],5,-701558691),s=g(s,r,n,o,t[10],9,38016083),o=g(o,s,r,n,t[15],14,-660478335),n=g(n,o,s,r,t[4],20,-405537848),r=g(r,n,o,s,t[9],5,568446438),s=g(s,r,n,o,t[14],9,-1019803690),o=g(o,s,r,n,t[3],14,-187363961),n=g(n,o,s,r,t[8],20,1163531501),r=g(r,n,o,s,t[13],5,-1444681467),s=g(s,r,n,o,t[2],9,-51403784),o=g(o,s,r,n,t[7],14,1735328473),r=y(r,n=g(n,o,s,r,t[12],20,-1926607734),o,s,t[5],4,-378558),s=y(s,r,n,o,t[8],11,-2022574463),o=y(o,s,r,n,t[11],16,1839030562),n=y(n,o,s,r,t[14],23,-35309556),r=y(r,n,o,s,t[1],4,-1530992060),s=y(s,r,n,o,t[4],11,1272893353),o=y(o,s,r,n,t[7],16,-155497632),n=y(n,o,s,r,t[10],23,-1094730640),r=y(r,n,o,s,t[13],4,681279174),s=y(s,r,n,o,t[0],11,-358537222),o=y(o,s,r,n,t[3],16,-722521979),n=y(n,o,s,r,t[6],23,76029189),r=y(r,n,o,s,t[9],4,-640364487),s=y(s,r,n,o,t[12],11,-421815835),o=y(o,s,r,n,t[15],16,530742520),r=v(r,n=y(n,o,s,r,t[2],23,-995338651),o,s,t[0],6,-198630844),s=v(s,r,n,o,t[7],10,1126891415),o=v(o,s,r,n,t[14],15,-1416354905),n=v(n,o,s,r,t[5],21,-57434055),r=v(r,n,o,s,t[12],6,1700485571),s=v(s,r,n,o,t[3],10,-1894986606),o=v(o,s,r,n,t[10],15,-1051523),n=v(n,o,s,r,t[1],21,-2054922799),r=v(r,n,o,s,t[8],6,1873313359),s=v(s,r,n,o,t[15],10,-30611744),o=v(o,s,r,n,t[6],15,-1560198380),n=v(n,o,s,r,t[13],21,1309151649),r=v(r,n,o,s,t[4],6,-145523070),s=v(s,r,n,o,t[11],10,-1120210379),o=v(o,s,r,n,t[2],15,718787259),n=v(n,o,s,r,t[9],21,-343485551),e[0]=x(r,e[0]),e[1]=x(n,e[1]),e[2]=x(o,e[2]),e[3]=x(s,e[3])}function p(e,t,r,n,o,s){return t=x(x(t,e),x(n,s)),x(t<<o|t>>>32-o,r)}function m(e,t,r,n,o,s,i){return p(t&r|~t&n,e,t,o,s,i)}function g(e,t,r,n,o,s,i){return p(t&n|r&~n,e,t,o,s,i)}function y(e,t,r,n,o,s,i){return p(t^r^n,e,t,o,s,i)}function v(e,t,r,n,o,s,i){return p(r^(t|~n),e,t,o,s,i)}function w(e){var t,r=e.length,n=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)h(n,b(e.substring(t-64,t)));e=e.substring(t-64);var o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)o[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(h(n,o),t=0;t<16;t++)o[t]=0;return o[14]=8*r,h(n,o),n}function b(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}c=o.atob.bind(o),l=o.btoa.bind(o);var B="0123456789abcdef".split("");function j(e){for(var t="",r=0;r<4;r++)t+=B[e>>8*r+4&15]+B[e>>8*r&15];return t}function _(e){return String.fromCharCode((255&e)>>0,(65280&e)>>8,(16711680&e)>>16,(4278190080&e)>>24)}function C(e){return w(e).map(_).join("")}function x(e,t){return e+t&4294967295}function E(e,t){var r,n,o,s;if(e!==r){for(var i=(o=e,s=1+(256/e.length>>0),new Array(s+1).join(o)),a=[],A=0;A<256;A++)a[A]=A;var u=0;for(A=0;A<256;A++){var c=a[A];u=(u+c+i.charCodeAt(A))%256,a[A]=a[u],a[u]=c}r=e,n=a}else a=n;var l=t.length,d=0,f=0,h="";for(A=0;A<l;A++)f=(f+(c=a[d=(d+1)%256]))%256,a[d]=a[f],a[f]=c,i=a[(a[d]+a[f])%256],h+=String.fromCharCode(t.charCodeAt(A)^i);return h}!function(e){for(var t=0;t<e.length;t++)e[t]=j(e[t]);e.join("")}(w("hello"));var N={print:4,modify:8,copy:16,"annot-forms":32};function Q(e,t,r,n){this.v=1,this.r=2;let o=192;e.forEach((function(e){if(void 0!==N.perm)throw new Error("Invalid permission: "+e);o+=N[e]})),this.padding="(¿N^NuAd\0NVÿú\b..\0¶Ðh>/\f©þdSiz";let s=(t+this.padding).substr(0,32),i=(r+this.padding).substr(0,32);this.O=this.processOwnerPassword(s,i),this.P=-(1+(255^o)),this.encryptionKey=C(s+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(n)).substr(0,5),this.U=E(this.encryptionKey,this.padding)}function F(e){if("object"!=typeof e)throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(e,r,n){if(n=n||!1,"string"!=typeof e||"function"!=typeof r||"boolean"!=typeof n)throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(e)||(t[e]={});var o=Math.random().toString(35);return t[e][o]=[r,!!n],o},this.unsubscribe=function(e){for(var r in t)if(t[r][e])return delete t[r][e],0===Object.keys(t[r]).length&&delete t[r],!0;return!1},this.publish=function(r){if(t.hasOwnProperty(r)){var n=Array.prototype.slice.call(arguments,1),s=[];for(var a in t[r]){var A=t[r][a];try{A[0].apply(e,n)}catch(e){o.console&&i.error("jsPDF PubSub Error",e.message,e)}A[1]&&s.push(a)}s.length&&s.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function U(e){if(!(this instanceof U))return new U(e);var t="opacity,stroke-opacity".split(",");for(var r in e)e.hasOwnProperty(r)&&t.indexOf(r)>=0&&(this[r]=e[r]);this.id="",this.objectNumber=-1}function S(e,t){this.gState=e,this.matrix=t,this.id="",this.objectNumber=-1}function L(e,t,r,n,o){if(!(this instanceof L))return new L(e,t,r,n,o);this.type="axial"===e?2:3,this.coords=t,this.colors=r,S.call(this,n,o)}function T(e,t,r,n,o){if(!(this instanceof T))return new T(e,t,r,n,o);this.boundingBox=e,this.xStep=t,this.yStep=r,this.stream="",this.cloneIndex=0,S.call(this,n,o)}function H(e){var t,r="string"==typeof arguments[0]?arguments[0]:"p",n=arguments[1],s=arguments[2],a=arguments[3],A=[],u=1,c=16,h="S",p=null;"object"==typeof(e=e||{})&&(r=e.orientation,n=e.unit||n,s=e.format||s,a=e.compress||e.compressPdf||a,null!==(p=e.encryption||null)&&(p.userPassword=p.userPassword||"",p.ownerPassword=p.ownerPassword||"",p.userPermissions=p.userPermissions||[]),u="number"==typeof e.userUnit?Math.abs(e.userUnit):1,void 0!==e.precision&&(t=e.precision),void 0!==e.floatPrecision&&(c=e.floatPrecision),h=e.defaultPathOperation||"S"),A=e.filters||(!0===a?["FlateEncode"]:A),n=n||"mm",r=(""+(r||"P")).toLowerCase();var m=e.putOnlyUsedFonts||!1,g={},y={internal:{},__private__:{}};y.__private__.PubSub=F;var v="1.3",w=y.__private__.getPdfVersion=function(){return v};y.__private__.setPdfVersion=function(e){v=e};var b={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};y.__private__.getPageFormats=function(){return b};var B=y.__private__.getPageFormat=function(e){return b[e]};s=s||"a4";var j={COMPAT:"compat",ADVANCED:"advanced"},_=j.COMPAT;function C(){this.saveGraphicsState(),ue(new Ke(_e,0,0,-_e,0,Ir()*_e).toString()+" cm"),this.setFontSize(this.getFontSize()/_e),h="n",_=j.ADVANCED}function x(){this.restoreGraphicsState(),h="S",_=j.COMPAT}var E=function(e,t){if("bold"==e&&"normal"==t||"bold"==e&&400==t||"normal"==e&&"italic"==t||"bold"==e&&"italic"==t)throw new Error("Invalid Combination of fontweight and fontstyle");return t&&e!==t&&(e=400==t?"italic"==e?"italic":"normal":700==t&&"italic"!==e?"bold":e+""+t),e};y.advancedAPI=function(e){var t=_===j.COMPAT;return t&&C.call(this),"function"!=typeof e||(e(this),t&&x.call(this)),this},y.compatAPI=function(e){var t=_===j.ADVANCED;return t&&x.call(this),"function"!=typeof e||(e(this),t&&C.call(this)),this},y.isAdvancedAPI=function(){return _===j.ADVANCED};var N,S=function(e){if(_!==j.ADVANCED)throw new Error(e+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},I=y.roundToPrecision=y.__private__.roundToPrecision=function(e,r){var n=t||r;if(isNaN(e)||isNaN(n))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return e.toFixed(n).replace(/0+$/,"")};N=y.hpf=y.__private__.hpf="number"==typeof c?function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.hpf");return I(e,c)}:"smart"===c?function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.hpf");return I(e,e>-1&&e<1?16:5)}:function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.hpf");return I(e,16)};var P=y.f2=y.__private__.f2=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.f2");return I(e,2)},O=y.__private__.f3=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.f3");return I(e,3)},k=y.scale=y.__private__.scale=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.scale");return _===j.COMPAT?e*_e:_===j.ADVANCED?e:void 0},R=function(e){return _===j.COMPAT?Ir()-e:_===j.ADVANCED?e:void 0},M=function(e){return k(R(e))};y.__private__.setPrecision=y.setPrecision=function(e){"number"==typeof parseInt(e,10)&&(t=parseInt(e,10))};var D,K="00000000000000000000000000000000",z=y.__private__.getFileId=function(){return K},V=y.__private__.setFileId=function(e){return K=void 0!==e&&/^[a-fA-F0-9]{32}$/.test(e)?e.toUpperCase():K.split("").map((function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))})).join(""),null!==p&&(Vt=new Q(p.userPermissions,p.userPassword,p.ownerPassword,K)),K};y.setFileId=function(e){return V(e),this},y.getFileId=function(){return z()};var q=y.__private__.convertDateToPDFDate=function(e){var t=e.getTimezoneOffset(),r=t<0?"+":"-",n=Math.floor(Math.abs(t/60)),o=Math.abs(t%60),s=[r,Y(n),"'",Y(o),"'"].join("");return["D:",e.getFullYear(),Y(e.getMonth()+1),Y(e.getDate()),Y(e.getHours()),Y(e.getMinutes()),Y(e.getSeconds()),s].join("")},G=y.__private__.convertPDFDateToDate=function(e){var t=parseInt(e.substr(2,4),10),r=parseInt(e.substr(6,2),10)-1,n=parseInt(e.substr(8,2),10),o=parseInt(e.substr(10,2),10),s=parseInt(e.substr(12,2),10),i=parseInt(e.substr(14,2),10);return new Date(t,r,n,o,s,i,0)},X=y.__private__.setCreationDate=function(e){var t;if(void 0===e&&(e=new Date),e instanceof Date)t=q(e);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(e))throw new Error("Invalid argument passed to jsPDF.setCreationDate");t=e}return D=t},W=y.__private__.getCreationDate=function(e){var t=D;return"jsDate"===e&&(t=G(D)),t};y.setCreationDate=function(e){return X(e),this},y.getCreationDate=function(e){return W(e)};var J,Y=y.__private__.padd2=function(e){return("0"+parseInt(e)).slice(-2)},Z=y.__private__.padd2Hex=function(e){return("00"+(e=e.toString())).substr(e.length)},$=0,ee=[],te=[],re=0,ne=[],oe=[],se=!1,ie=te,ae=function(){$=0,re=0,te=[],ee=[],ne=[],Ye=Xe(),Ze=Xe()};y.__private__.setCustomOutputDestination=function(e){se=!0,ie=e};var Ae=function(e){se||(ie=e)};y.__private__.resetCustomOutputDestination=function(){se=!1,ie=te};var ue=y.__private__.out=function(e){return e=e.toString(),re+=e.length+1,ie.push(e),ie},ce=y.__private__.write=function(e){return ue(1===arguments.length?e.toString():Array.prototype.join.call(arguments," "))},le=y.__private__.getArrayBuffer=function(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r);t--;)n[t]=e.charCodeAt(t);return r},de=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];y.__private__.getStandardFonts=function(){return de};var fe=e.fontSize||16;y.__private__.setFontSize=y.setFontSize=function(e){return fe=_===j.ADVANCED?e/_e:e,this};var he,pe=y.__private__.getFontSize=y.getFontSize=function(){return _===j.COMPAT?fe:fe*_e},me=e.R2L||!1;y.__private__.setR2L=y.setR2L=function(e){return me=e,this},y.__private__.getR2L=y.getR2L=function(){return me};var ge,ye=y.__private__.setZoomMode=function(e){if(/^\d*\.?\d*%$/.test(e))he=e;else if(isNaN(e)){if(-1===[void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(e))throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+e+'" is not recognized.');he=e}else he=parseInt(e,10)};y.__private__.getZoomMode=function(){return he};var ve,we=y.__private__.setPageMode=function(e){if(-1==[void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(e))throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+e+'" is not recognized.');ge=e};y.__private__.getPageMode=function(){return ge};var be=y.__private__.setLayoutMode=function(e){if(-1==[void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(e))throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+e+'" is not recognized.');ve=e};y.__private__.getLayoutMode=function(){return ve},y.__private__.setDisplayMode=y.setDisplayMode=function(e,t,r){return ye(e),be(t),we(r),this};var Be={title:"",subject:"",author:"",keywords:"",creator:""};y.__private__.getDocumentProperty=function(e){if(-1===Object.keys(Be).indexOf(e))throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return Be[e]},y.__private__.getDocumentProperties=function(){return Be},y.__private__.setDocumentProperties=y.setProperties=y.setDocumentProperties=function(e){for(var t in Be)Be.hasOwnProperty(t)&&e[t]&&(Be[t]=e[t]);return this},y.__private__.setDocumentProperty=function(e,t){if(-1===Object.keys(Be).indexOf(e))throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return Be[e]=t};var je,_e,Ce,xe,Ee,Ne={},Qe={},Fe=[],Ue={},Se={},Le={},Te={},He=null,Ie=0,Pe=[],Oe=new F(y),ke=e.hotfixes||[],Re={},Me={},De=[],Ke=function(e,t,r,n,o,s){if(!(this instanceof Ke))return new Ke(e,t,r,n,o,s);isNaN(e)&&(e=1),isNaN(t)&&(t=0),isNaN(r)&&(r=0),isNaN(n)&&(n=1),isNaN(o)&&(o=0),isNaN(s)&&(s=0),this._matrix=[e,t,r,n,o,s]};Object.defineProperty(Ke.prototype,"sx",{get:function(){return this._matrix[0]},set:function(e){this._matrix[0]=e}}),Object.defineProperty(Ke.prototype,"shy",{get:function(){return this._matrix[1]},set:function(e){this._matrix[1]=e}}),Object.defineProperty(Ke.prototype,"shx",{get:function(){return this._matrix[2]},set:function(e){this._matrix[2]=e}}),Object.defineProperty(Ke.prototype,"sy",{get:function(){return this._matrix[3]},set:function(e){this._matrix[3]=e}}),Object.defineProperty(Ke.prototype,"tx",{get:function(){return this._matrix[4]},set:function(e){this._matrix[4]=e}}),Object.defineProperty(Ke.prototype,"ty",{get:function(){return this._matrix[5]},set:function(e){this._matrix[5]=e}}),Object.defineProperty(Ke.prototype,"a",{get:function(){return this._matrix[0]},set:function(e){this._matrix[0]=e}}),Object.defineProperty(Ke.prototype,"b",{get:function(){return this._matrix[1]},set:function(e){this._matrix[1]=e}}),Object.defineProperty(Ke.prototype,"c",{get:function(){return this._matrix[2]},set:function(e){this._matrix[2]=e}}),Object.defineProperty(Ke.prototype,"d",{get:function(){return this._matrix[3]},set:function(e){this._matrix[3]=e}}),Object.defineProperty(Ke.prototype,"e",{get:function(){return this._matrix[4]},set:function(e){this._matrix[4]=e}}),Object.defineProperty(Ke.prototype,"f",{get:function(){return this._matrix[5]},set:function(e){this._matrix[5]=e}}),Object.defineProperty(Ke.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Ke.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Ke.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Ke.prototype,"isIdentity",{get:function(){return 1===this.sx&&0===this.shy&&0===this.shx&&1===this.sy&&0===this.tx&&0===this.ty}}),Ke.prototype.join=function(e){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(N).join(e)},Ke.prototype.multiply=function(e){var t=e.sx*this.sx+e.shy*this.shx,r=e.sx*this.shy+e.shy*this.sy,n=e.shx*this.sx+e.sy*this.shx,o=e.shx*this.shy+e.sy*this.sy,s=e.tx*this.sx+e.ty*this.shx+this.tx,i=e.tx*this.shy+e.ty*this.sy+this.ty;return new Ke(t,r,n,o,s,i)},Ke.prototype.decompose=function(){var e=this.sx,t=this.shy,r=this.shx,n=this.sy,o=this.tx,s=this.ty,i=Math.sqrt(e*e+t*t),a=(e/=i)*r+(t/=i)*n;r-=e*a,n-=t*a;var A=Math.sqrt(r*r+n*n);return a/=A,e*(n/=A)<t*(r/=A)&&(e=-e,t=-t,a=-a,i=-i),{scale:new Ke(i,0,0,A,0,0),translate:new Ke(1,0,0,1,o,s),rotate:new Ke(e,t,-t,e,0,0),skew:new Ke(1,0,a,1,0,0)}},Ke.prototype.toString=function(e){return this.join(" ")},Ke.prototype.inversed=function(){var e=this.sx,t=this.shy,r=this.shx,n=this.sy,o=this.tx,s=this.ty,i=1/(e*n-t*r),a=n*i,A=-t*i,u=-r*i,c=e*i;return new Ke(a,A,u,c,-a*o-u*s,-A*o-c*s)},Ke.prototype.applyToPoint=function(e){var t=e.x*this.sx+e.y*this.shx+this.tx,r=e.x*this.shy+e.y*this.sy+this.ty;return new Nr(t,r)},Ke.prototype.applyToRectangle=function(e){var t=this.applyToPoint(e),r=this.applyToPoint(new Nr(e.x+e.w,e.y+e.h));return new Qr(t.x,t.y,r.x-t.x,r.y-t.y)},Ke.prototype.clone=function(){var e=this.sx,t=this.shy,r=this.shx,n=this.sy,o=this.tx,s=this.ty;return new Ke(e,t,r,n,o,s)},y.Matrix=Ke;var ze=y.matrixMult=function(e,t){return t.multiply(e)},Ve=new Ke(1,0,0,1,0,0);y.unitMatrix=y.identityMatrix=Ve;var qe=function(e,t){if(!Se[e]){var r=(t instanceof L?"Sh":"P")+(Object.keys(Ue).length+1).toString(10);t.id=r,Se[e]=r,Ue[r]=t,Oe.publish("addPattern",t)}};y.ShadingPattern=L,y.TilingPattern=T,y.addShadingPattern=function(e,t){return S("addShadingPattern()"),qe(e,t),this},y.beginTilingPattern=function(e){S("beginTilingPattern()"),Ur(e.boundingBox[0],e.boundingBox[1],e.boundingBox[2]-e.boundingBox[0],e.boundingBox[3]-e.boundingBox[1],e.matrix)},y.endTilingPattern=function(e,t){S("endTilingPattern()"),t.stream=oe[J].join("\n"),qe(e,t),Oe.publish("endTilingPattern",t),De.pop().restore()};var Ge=y.__private__.newObject=function(){var e=Xe();return We(e,!0),e},Xe=y.__private__.newObjectDeferred=function(){return $++,ee[$]=function(){return re},$},We=function(e,t){return t="boolean"==typeof t&&t,ee[e]=re,t&&ue(e+" 0 obj"),e},Je=y.__private__.newAdditionalObject=function(){var e={objId:Xe(),content:""};return ne.push(e),e},Ye=Xe(),Ze=Xe(),$e=y.__private__.decodeColorString=function(e){var t=e.split(" ");if(2!==t.length||"g"!==t[1]&&"G"!==t[1])5!==t.length||"k"!==t[4]&&"K"!==t[4]||(t=[(1-t[0])*(1-t[3]),(1-t[1])*(1-t[3]),(1-t[2])*(1-t[3]),"r"]);else{var r=parseFloat(t[0]);t=[r,r,r,"r"]}for(var n="#",o=0;o<3;o++)n+=("0"+Math.floor(255*parseFloat(t[o])).toString(16)).slice(-2);return n},et=y.__private__.encodeColorString=function(e){var t;"string"==typeof e&&(e={ch1:e});var r=e.ch1,n=e.ch2,o=e.ch3,s=e.ch4,i="draw"===e.pdfColorType?["G","RG","K"]:["g","rg","k"];if("string"==typeof r&&"#"!==r.charAt(0)){var a=new f(r);if(a.ok)r=a.toHex();else if(!/^\d*\.?\d*$/.test(r))throw new Error('Invalid color "'+r+'" passed to jsPDF.encodeColorString.')}if("string"==typeof r&&/^#[0-9A-Fa-f]{3}$/.test(r)&&(r="#"+r[1]+r[1]+r[2]+r[2]+r[3]+r[3]),"string"==typeof r&&/^#[0-9A-Fa-f]{6}$/.test(r)){var A=parseInt(r.substr(1),16);r=A>>16&255,n=A>>8&255,o=255&A}if(void 0===n||void 0===s&&r===n&&n===o)if("string"==typeof r)t=r+" "+i[0];else switch(e.precision){case 2:t=P(r/255)+" "+i[0];break;case 3:default:t=O(r/255)+" "+i[0]}else if(void 0===s||"object"==typeof s){if(s&&!isNaN(s.a)&&0===s.a)return["1.","1.","1.",i[1]].join(" ");if("string"==typeof r)t=[r,n,o,i[1]].join(" ");else switch(e.precision){case 2:t=[P(r/255),P(n/255),P(o/255),i[1]].join(" ");break;default:case 3:t=[O(r/255),O(n/255),O(o/255),i[1]].join(" ")}}else if("string"==typeof r)t=[r,n,o,s,i[2]].join(" ");else switch(e.precision){case 2:t=[P(r),P(n),P(o),P(s),i[2]].join(" ");break;case 3:default:t=[O(r),O(n),O(o),O(s),i[2]].join(" ")}return t},tt=y.__private__.getFilters=function(){return A},rt=y.__private__.putStream=function(e){var t=(e=e||{}).data||"",r=e.filters||tt(),n=e.alreadyAppliedFilters||[],o=e.addLength1||!1,s=t.length,i=e.objectId,a=function(e){return e};if(null!==p&&void 0===i)throw new Error("ObjectId must be passed to putStream for file encryption");null!==p&&(a=Vt.encryptor(i,0));var A={};!0===r&&(r=["FlateEncode"]);var u=e.additionalKeyValues||[],c=(A=void 0!==H.API.processDataByFilters?H.API.processDataByFilters(t,r):{data:t,reverseChain:[]}).reverseChain+(Array.isArray(n)?n.join(" "):n.toString());if(0!==A.data.length&&(u.push({key:"Length",value:A.data.length}),!0===o&&u.push({key:"Length1",value:s})),0!=c.length)if(c.split("/").length-1==1)u.push({key:"Filter",value:c});else{u.push({key:"Filter",value:"["+c+"]"});for(var l=0;l<u.length;l+=1)if("DecodeParms"===u[l].key){for(var d=[],f=0;f<A.reverseChain.split("/").length-1;f+=1)d.push("null");d.push(u[l].value),u[l].value="["+d.join(" ")+"]"}}ue("<<");for(var h=0;h<u.length;h++)ue("/"+u[h].key+" "+u[h].value);ue(">>"),0!==A.data.length&&(ue("stream"),ue(a(A.data)),ue("endstream"))},nt=y.__private__.putPage=function(e){var t=e.number,r=e.data,n=e.objId,o=e.contentsObjId;We(n,!0),ue("<</Type /Page"),ue("/Parent "+e.rootDictionaryObjId+" 0 R"),ue("/Resources "+e.resourceDictionaryObjId+" 0 R"),ue("/MediaBox ["+parseFloat(N(e.mediaBox.bottomLeftX))+" "+parseFloat(N(e.mediaBox.bottomLeftY))+" "+N(e.mediaBox.topRightX)+" "+N(e.mediaBox.topRightY)+"]"),null!==e.cropBox&&ue("/CropBox ["+N(e.cropBox.bottomLeftX)+" "+N(e.cropBox.bottomLeftY)+" "+N(e.cropBox.topRightX)+" "+N(e.cropBox.topRightY)+"]"),null!==e.bleedBox&&ue("/BleedBox ["+N(e.bleedBox.bottomLeftX)+" "+N(e.bleedBox.bottomLeftY)+" "+N(e.bleedBox.topRightX)+" "+N(e.bleedBox.topRightY)+"]"),null!==e.trimBox&&ue("/TrimBox ["+N(e.trimBox.bottomLeftX)+" "+N(e.trimBox.bottomLeftY)+" "+N(e.trimBox.topRightX)+" "+N(e.trimBox.topRightY)+"]"),null!==e.artBox&&ue("/ArtBox ["+N(e.artBox.bottomLeftX)+" "+N(e.artBox.bottomLeftY)+" "+N(e.artBox.topRightX)+" "+N(e.artBox.topRightY)+"]"),"number"==typeof e.userUnit&&1!==e.userUnit&&ue("/UserUnit "+e.userUnit),Oe.publish("putPage",{objId:n,pageContext:Pe[t],pageNumber:t,page:r}),ue("/Contents "+o+" 0 R"),ue(">>"),ue("endobj");var s=r.join("\n");return _===j.ADVANCED&&(s+="\nQ"),We(o,!0),rt({data:s,filters:tt(),objectId:o}),ue("endobj"),n},ot=y.__private__.putPages=function(){var e,t,r=[];for(e=1;e<=Ie;e++)Pe[e].objId=Xe(),Pe[e].contentsObjId=Xe();for(e=1;e<=Ie;e++)r.push(nt({number:e,data:oe[e],objId:Pe[e].objId,contentsObjId:Pe[e].contentsObjId,mediaBox:Pe[e].mediaBox,cropBox:Pe[e].cropBox,bleedBox:Pe[e].bleedBox,trimBox:Pe[e].trimBox,artBox:Pe[e].artBox,userUnit:Pe[e].userUnit,rootDictionaryObjId:Ye,resourceDictionaryObjId:Ze}));We(Ye,!0),ue("<</Type /Pages");var n="/Kids [";for(t=0;t<Ie;t++)n+=r[t]+" 0 R ";ue(n+"]"),ue("/Count "+Ie),ue(">>"),ue("endobj"),Oe.publish("postPutPages")},st=function(e){var t=function(e,t){return-1!==e.indexOf(" ")?"("+Qt(e,t)+")":Qt(e,t)};Oe.publish("putFont",{font:e,out:ue,newObject:Ge,putStream:rt,pdfEscapeWithNeededParanthesis:t}),!0!==e.isAlreadyPutted&&(e.objectNumber=Ge(),ue("<<"),ue("/Type /Font"),ue("/BaseFont /"+t(e.postScriptName)),ue("/Subtype /Type1"),"string"==typeof e.encoding&&ue("/Encoding /"+e.encoding),ue("/FirstChar 32"),ue("/LastChar 255"),ue(">>"),ue("endobj"))},it=function(){for(var e in Ne)Ne.hasOwnProperty(e)&&(!1===m||!0===m&&g.hasOwnProperty(e))&&st(Ne[e])},at=function(e){e.objectNumber=Ge();var t=[];t.push({key:"Type",value:"/XObject"}),t.push({key:"Subtype",value:"/Form"}),t.push({key:"BBox",value:"["+[N(e.x),N(e.y),N(e.x+e.width),N(e.y+e.height)].join(" ")+"]"}),t.push({key:"Matrix",value:"["+e.matrix.toString()+"]"});var r=e.pages[1].join("\n");rt({data:r,additionalKeyValues:t,objectId:e.objectNumber}),ue("endobj")},At=function(){for(var e in Re)Re.hasOwnProperty(e)&&at(Re[e])},ut=function(e,t){var r,n=[],o=1/(t-1);for(r=0;r<1;r+=o)n.push(r);if(n.push(1),0!=e[0].offset){var s={offset:0,color:e[0].color};e.unshift(s)}if(1!=e[e.length-1].offset){var i={offset:1,color:e[e.length-1].color};e.push(i)}for(var a="",A=0,u=0;u<n.length;u++){for(r=n[u];r>e[A+1].offset;)A++;var c=e[A].offset,l=(r-c)/(e[A+1].offset-c),d=e[A].color,f=e[A+1].color;a+=Z(Math.round((1-l)*d[0]+l*f[0]).toString(16))+Z(Math.round((1-l)*d[1]+l*f[1]).toString(16))+Z(Math.round((1-l)*d[2]+l*f[2]).toString(16))}return a.trim()},ct=function(e,t){t||(t=21);var r=Ge(),n=ut(e.colors,t),o=[];o.push({key:"FunctionType",value:"0"}),o.push({key:"Domain",value:"[0.0 1.0]"}),o.push({key:"Size",value:"["+t+"]"}),o.push({key:"BitsPerSample",value:"8"}),o.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),o.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),rt({data:n,additionalKeyValues:o,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:r}),ue("endobj"),e.objectNumber=Ge(),ue("<< /ShadingType "+e.type),ue("/ColorSpace /DeviceRGB");var s="/Coords ["+N(parseFloat(e.coords[0]))+" "+N(parseFloat(e.coords[1]))+" ";2===e.type?s+=N(parseFloat(e.coords[2]))+" "+N(parseFloat(e.coords[3])):s+=N(parseFloat(e.coords[2]))+" "+N(parseFloat(e.coords[3]))+" "+N(parseFloat(e.coords[4]))+" "+N(parseFloat(e.coords[5])),ue(s+="]"),e.matrix&&ue("/Matrix ["+e.matrix.toString()+"]"),ue("/Function "+r+" 0 R"),ue("/Extend [true true]"),ue(">>"),ue("endobj")},lt=function(e,t){var r=Xe(),n=Ge();t.push({resourcesOid:r,objectOid:n}),e.objectNumber=n;var o=[];o.push({key:"Type",value:"/Pattern"}),o.push({key:"PatternType",value:"1"}),o.push({key:"PaintType",value:"1"}),o.push({key:"TilingType",value:"1"}),o.push({key:"BBox",value:"["+e.boundingBox.map(N).join(" ")+"]"}),o.push({key:"XStep",value:N(e.xStep)}),o.push({key:"YStep",value:N(e.yStep)}),o.push({key:"Resources",value:r+" 0 R"}),e.matrix&&o.push({key:"Matrix",value:"["+e.matrix.toString()+"]"}),rt({data:e.stream,additionalKeyValues:o,objectId:e.objectNumber}),ue("endobj")},dt=function(e){var t;for(t in Ue)Ue.hasOwnProperty(t)&&(Ue[t]instanceof L?ct(Ue[t]):Ue[t]instanceof T&&lt(Ue[t],e))},ft=function(e){for(var t in e.objectNumber=Ge(),ue("<<"),e)switch(t){case"opacity":ue("/ca "+P(e[t]));break;case"stroke-opacity":ue("/CA "+P(e[t]))}ue(">>"),ue("endobj")},ht=function(){var e;for(e in Le)Le.hasOwnProperty(e)&&ft(Le[e])},pt=function(){for(var e in ue("/XObject <<"),Re)Re.hasOwnProperty(e)&&Re[e].objectNumber>=0&&ue("/"+e+" "+Re[e].objectNumber+" 0 R");Oe.publish("putXobjectDict"),ue(">>")},mt=function(){Vt.oid=Ge(),ue("<<"),ue("/Filter /Standard"),ue("/V "+Vt.v),ue("/R "+Vt.r),ue("/U <"+Vt.toHexString(Vt.U)+">"),ue("/O <"+Vt.toHexString(Vt.O)+">"),ue("/P "+Vt.P),ue(">>"),ue("endobj")},gt=function(){for(var e in ue("/Font <<"),Ne)Ne.hasOwnProperty(e)&&(!1===m||!0===m&&g.hasOwnProperty(e))&&ue("/"+e+" "+Ne[e].objectNumber+" 0 R");ue(">>")},yt=function(){if(Object.keys(Ue).length>0){for(var e in ue("/Shading <<"),Ue)Ue.hasOwnProperty(e)&&Ue[e]instanceof L&&Ue[e].objectNumber>=0&&ue("/"+e+" "+Ue[e].objectNumber+" 0 R");Oe.publish("putShadingPatternDict"),ue(">>")}},vt=function(e){if(Object.keys(Ue).length>0){for(var t in ue("/Pattern <<"),Ue)Ue.hasOwnProperty(t)&&Ue[t]instanceof y.TilingPattern&&Ue[t].objectNumber>=0&&Ue[t].objectNumber<e&&ue("/"+t+" "+Ue[t].objectNumber+" 0 R");Oe.publish("putTilingPatternDict"),ue(">>")}},wt=function(){if(Object.keys(Le).length>0){var e;for(e in ue("/ExtGState <<"),Le)Le.hasOwnProperty(e)&&Le[e].objectNumber>=0&&ue("/"+e+" "+Le[e].objectNumber+" 0 R");Oe.publish("putGStateDict"),ue(">>")}},bt=function(e){We(e.resourcesOid,!0),ue("<<"),ue("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),gt(),yt(),vt(e.objectOid),wt(),pt(),ue(">>"),ue("endobj")},Bt=function(){var e=[];it(),ht(),At(),dt(e),Oe.publish("putResources"),e.forEach(bt),bt({resourcesOid:Ze,objectOid:Number.MAX_SAFE_INTEGER}),Oe.publish("postPutResources")},jt=function(){Oe.publish("putAdditionalObjects");for(var e=0;e<ne.length;e++){var t=ne[e];We(t.objId,!0),ue(t.content),ue("endobj")}Oe.publish("postPutAdditionalObjects")},_t=function(e){Qe[e.fontName]=Qe[e.fontName]||{},Qe[e.fontName][e.fontStyle]=e.id},Ct=function(e,t,r,n,o){var s={id:"F"+(Object.keys(Ne).length+1).toString(10),postScriptName:e,fontName:t,fontStyle:r,encoding:n,isStandardFont:o||!1,metadata:{}};return Oe.publish("addFont",{font:s,instance:this}),Ne[s.id]=s,_t(s),s.id},xt=function(e){for(var t=0,r=de.length;t<r;t++){var n=Ct.call(this,e[t][0],e[t][1],e[t][2],de[t][3],!0);!1===m&&(g[n]=!0);var o=e[t][0].split("-");_t({id:n,fontName:o[0],fontStyle:o[1]||""})}Oe.publish("addFonts",{fonts:Ne,dictionary:Qe})},Et=function(e){return e.foo=function(){try{return e.apply(this,arguments)}catch(e){var t=e.stack||"";~t.indexOf(" at ")&&(t=t.split(" at ")[1]);var r="Error in function "+t.split("\n")[0].split("<")[0]+": "+e.message;if(!o.console)throw new Error(r);o.console.error(r,e),o.alert&&alert(r)}},e.foo.bar=e,e.foo},Nt=function(e,t){var r,n,o,s,i,a,A,u,c;if(o=(t=t||{}).sourceEncoding||"Unicode",i=t.outputEncoding,(t.autoencode||i)&&Ne[je].metadata&&Ne[je].metadata[o]&&Ne[je].metadata[o].encoding&&(s=Ne[je].metadata[o].encoding,!i&&Ne[je].encoding&&(i=Ne[je].encoding),!i&&s.codePages&&(i=s.codePages[0]),"string"==typeof i&&(i=s[i]),i)){for(A=!1,a=[],r=0,n=e.length;r<n;r++)(u=i[e.charCodeAt(r)])?a.push(String.fromCharCode(u)):a.push(e[r]),a[r].charCodeAt(0)>>8&&(A=!0);e=a.join("")}for(r=e.length;void 0===A&&0!==r;)e.charCodeAt(r-1)>>8&&(A=!0),r--;if(!A)return e;for(a=t.noBOM?[]:[254,255],r=0,n=e.length;r<n;r++){if((c=(u=e.charCodeAt(r))>>8)>>8)throw new Error("Character at position "+r+" of string '"+e+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");a.push(c),a.push(u-(c<<8))}return String.fromCharCode.apply(void 0,a)},Qt=y.__private__.pdfEscape=y.pdfEscape=function(e,t){return Nt(e,t).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Ft=y.__private__.beginPage=function(e){oe[++Ie]=[],Pe[Ie]={objId:0,contentsObjId:0,userUnit:Number(u),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(e[0]),topRightY:Number(e[1])}},Lt(Ie),Ae(oe[J])},Ut=function(e,t){var n,o,a;switch(r=t||r,"string"==typeof e&&(n=B(e.toLowerCase()),Array.isArray(n)&&(o=n[0],a=n[1])),Array.isArray(e)&&(o=e[0]*_e,a=e[1]*_e),isNaN(o)&&(o=s[0],a=s[1]),(o>14400||a>14400)&&(i.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),o=Math.min(14400,o),a=Math.min(14400,a)),s=[o,a],r.substr(0,1)){case"l":a>o&&(s=[a,o]);break;case"p":o>a&&(s=[a,o])}Ft(s),lr(cr),ue(vr),0!==Cr&&ue(Cr+" J"),0!==xr&&ue(xr+" j"),Oe.publish("addPage",{pageNumber:Ie})},St=function(e){e>0&&e<=Ie&&(oe.splice(e,1),Pe.splice(e,1),Ie--,J>Ie&&(J=Ie),this.setPage(J))},Lt=function(e){e>0&&e<=Ie&&(J=e)},Tt=y.__private__.getNumberOfPages=y.getNumberOfPages=function(){return oe.length-1},Ht=function(e,t,r){var n,o=void 0;return r=r||{},e=void 0!==e?e:Ne[je].fontName,t=void 0!==t?t:Ne[je].fontStyle,n=e.toLowerCase(),void 0!==Qe[n]&&void 0!==Qe[n][t]?o=Qe[n][t]:void 0!==Qe[e]&&void 0!==Qe[e][t]?o=Qe[e][t]:!1===r.disableWarning&&i.warn("Unable to look up font label for font '"+e+"', '"+t+"'. Refer to getFontList() for available fonts."),o||r.noFallback||null==(o=Qe.times[t])&&(o=Qe.times.normal),o},It=y.__private__.putInfo=function(){var e=Ge(),t=function(e){return e};for(var r in null!==p&&(t=Vt.encryptor(e,0)),ue("<<"),ue("/Producer ("+Qt(t("jsPDF "+H.version))+")"),Be)Be.hasOwnProperty(r)&&Be[r]&&ue("/"+r.substr(0,1).toUpperCase()+r.substr(1)+" ("+Qt(t(Be[r]))+")");ue("/CreationDate ("+Qt(t(D))+")"),ue(">>"),ue("endobj")},Pt=y.__private__.putCatalog=function(e){var t=(e=e||{}).rootDictionaryObjId||Ye;switch(Ge(),ue("<<"),ue("/Type /Catalog"),ue("/Pages "+t+" 0 R"),he||(he="fullwidth"),he){case"fullwidth":ue("/OpenAction [3 0 R /FitH null]");break;case"fullheight":ue("/OpenAction [3 0 R /FitV null]");break;case"fullpage":ue("/OpenAction [3 0 R /Fit]");break;case"original":ue("/OpenAction [3 0 R /XYZ null null 1]");break;default:var r=""+he;"%"===r.substr(r.length-1)&&(he=parseInt(he)/100),"number"==typeof he&&ue("/OpenAction [3 0 R /XYZ null null "+P(he)+"]")}switch(ve||(ve="continuous"),ve){case"continuous":ue("/PageLayout /OneColumn");break;case"single":ue("/PageLayout /SinglePage");break;case"two":case"twoleft":ue("/PageLayout /TwoColumnLeft");break;case"tworight":ue("/PageLayout /TwoColumnRight")}ge&&ue("/PageMode /"+ge),Oe.publish("putCatalog"),ue(">>"),ue("endobj")},Ot=y.__private__.putTrailer=function(){ue("trailer"),ue("<<"),ue("/Size "+($+1)),ue("/Root "+$+" 0 R"),ue("/Info "+($-1)+" 0 R"),null!==p&&ue("/Encrypt "+Vt.oid+" 0 R"),ue("/ID [ <"+K+"> <"+K+"> ]"),ue(">>")},kt=y.__private__.putHeader=function(){ue("%PDF-"+v),ue("%ºß¬à")},Rt=y.__private__.putXRef=function(){var e="0000000000";ue("xref"),ue("0 "+($+1)),ue("0000000000 65535 f ");for(var t=1;t<=$;t++)"function"==typeof ee[t]?ue((e+ee[t]()).slice(-10)+" 00000 n "):void 0!==ee[t]?ue((e+ee[t]).slice(-10)+" 00000 n "):ue("0000000000 00000 n ")},Mt=y.__private__.buildDocument=function(){ae(),Ae(te),Oe.publish("buildDocument"),kt(),ot(),jt(),Bt(),null!==p&&mt(),It(),Pt();var e=re;return Rt(),Ot(),ue("startxref"),ue(""+e),ue("%%EOF"),Ae(oe[J]),te.join("\n")},Dt=y.__private__.getBlob=function(e){return new Blob([le(e)],{type:"application/pdf"})},Kt=y.output=y.__private__.output=Et((function(e,t){switch("string"==typeof(t=t||{})?t={filename:t}:t.filename=t.filename||"generated.pdf",e){case void 0:return Mt();case"save":y.save(t.filename);break;case"arraybuffer":return le(Mt());case"blob":return Dt(Mt());case"bloburi":case"bloburl":if(void 0!==o.URL&&"function"==typeof o.URL.createObjectURL)return o.URL&&o.URL.createObjectURL(Dt(Mt()))||void 0;i.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var r="",n=Mt();try{r=l(n)}catch(e){r=l(unescape(encodeURIComponent(n)))}return"data:application/pdf;filename="+t.filename+";base64,"+r;case"pdfobjectnewwindow":if("[object Window]"===Object.prototype.toString.call(o)){var s='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+(t.pdfObjectUrl||"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js")+'"><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(t)+");<\/script></body></html>",a=o.open();return null!==a&&a.document.write(s),a}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if("[object Window]"===Object.prototype.toString.call(o)){var A='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(t.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+t.filename+'" width="500px" height="400px" /></body></html>',u=o.open();if(null!==u){u.document.write(A);var c=this;u.document.documentElement.querySelector("#pdfViewer").onload=function(){u.document.title=t.filename,u.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(c.output("bloburl"))}}return u}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if("[object Window]"!==Object.prototype.toString.call(o))throw new Error("The option dataurlnewwindow just works in a browser-environment.");var d='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",t)+'"></iframe></body></html>',f=o.open();if(null!==f&&(f.document.write(d),f.document.title=t.filename),f||"undefined"==typeof safari)return f;break;case"datauri":case"dataurl":return o.document.location.href=this.output("datauristring",t);default:return null}})),zt=function(e){return!0===Array.isArray(ke)&&ke.indexOf(e)>-1};switch(n){case"pt":_e=1;break;case"mm":_e=72/25.4;break;case"cm":_e=72/2.54;break;case"in":_e=72;break;case"px":_e=1==zt("px_scaling")?.75:96/72;break;case"pc":case"em":_e=12;break;case"ex":_e=6;break;default:throw new Error("Invalid unit: "+n)}var Vt=null;X(),V();var qt=function(e){return null!==p?Vt.encryptor(e,0):function(e){return e}},Gt=y.__private__.getPageInfo=y.getPageInfo=function(e){if(isNaN(e)||e%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:Pe[e].objId,pageNumber:e,pageContext:Pe[e]}},Xt=y.__private__.getPageInfoByObjId=function(e){if(isNaN(e)||e%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var t in Pe)if(Pe[t].objId===e)break;return Gt(t)},Wt=y.__private__.getCurrentPageInfo=y.getCurrentPageInfo=function(){return{objId:Pe[J].objId,pageNumber:J,pageContext:Pe[J]}};y.addPage=function(){return Ut.apply(this,arguments),this},y.setPage=function(){return Lt.apply(this,arguments),Ae.call(this,oe[J]),this},y.insertPage=function(e){return this.addPage(),this.movePage(J,e),this},y.movePage=function(e,t){var r,n;if(e>t){r=oe[e],n=Pe[e];for(var o=e;o>t;o--)oe[o]=oe[o-1],Pe[o]=Pe[o-1];oe[t]=r,Pe[t]=n,this.setPage(t)}else if(e<t){r=oe[e],n=Pe[e];for(var s=e;s<t;s++)oe[s]=oe[s+1],Pe[s]=Pe[s+1];oe[t]=r,Pe[t]=n,this.setPage(t)}return this},y.deletePage=function(){return St.apply(this,arguments),this},y.__private__.text=y.text=function(e,t,r,n,o){var s,i,a,A,u,c,l,d,f=(n=n||{}).scope||this;if("number"==typeof e&&"number"==typeof t&&("string"==typeof r||Array.isArray(r))){var h=r;r=t,t=e,e=h}if(arguments[3]instanceof Ke==0?(a=arguments[4],A=arguments[5],"object"==typeof(l=arguments[3])&&null!==l||("string"==typeof a&&(A=a,a=null),"string"==typeof l&&(A=l,l=null),"number"==typeof l&&(a=l,l=null),n={flags:l,angle:a,align:A})):(S("The transform parameter of text() with a Matrix value"),d=o),isNaN(t)||isNaN(r)||null==e)throw new Error("Invalid arguments passed to jsPDF.text");if(0===e.length)return f;var p="",m=!1,y="number"==typeof n.lineHeightFactor?n.lineHeightFactor:ur,v=f.internal.scaleFactor;function w(e){return e=e.split("\t").join(Array(n.TabLen||9).join(" ")),Qt(e,l)}function b(e){for(var t,r=e.concat(),n=[],o=r.length;o--;)"string"==typeof(t=r.shift())?n.push(t):Array.isArray(e)&&(1===t.length||void 0===t[1]&&void 0===t[2])?n.push(t[0]):n.push([t[0],t[1],t[2]]);return n}function B(e,t){var r;if("string"==typeof e)r=t(e)[0];else if(Array.isArray(e)){for(var n,o,s=e.concat(),i=[],a=s.length;a--;)"string"==typeof(n=s.shift())?i.push(t(n)[0]):Array.isArray(n)&&"string"==typeof n[0]&&(o=t(n[0],n[1],n[2]),i.push([o[0],o[1],o[2]]));r=i}return r}var C=!1,x=!0;if("string"==typeof e)C=!0;else if(Array.isArray(e)){var E=e.concat();i=[];for(var Q,F=E.length;F--;)("string"!=typeof(Q=E.shift())||Array.isArray(Q)&&"string"!=typeof Q[0])&&(x=!1);C=x}if(!1===C)throw new Error('Type of text must be string or Array. "'+e+'" is not recognized.');"string"==typeof e&&(e=e.match(/[\r?\n]/)?e.split(/\r\n|\r|\n/g):[e]);var U=fe/f.internal.scaleFactor,L=U*(ur-1);switch(n.baseline){case"bottom":r-=L;break;case"top":r+=U-L;break;case"hanging":r+=U-2*L;break;case"middle":r+=U/2-L}if((c=n.maxWidth||0)>0&&("string"==typeof e?e=f.splitTextToSize(e,c):"[object Array]"===Object.prototype.toString.call(e)&&(e=e.reduce((function(e,t){return e.concat(f.splitTextToSize(t,c))}),[]))),s={text:e,x:t,y:r,options:n,mutex:{pdfEscape:Qt,activeFontKey:je,fonts:Ne,activeFontSize:fe}},Oe.publish("preProcessText",s),e=s.text,a=(n=s.options).angle,d instanceof Ke==0&&a&&"number"==typeof a){a*=Math.PI/180,0===n.rotationDirection&&(a=-a),_===j.ADVANCED&&(a=-a);var T=Math.cos(a),H=Math.sin(a);d=new Ke(T,H,-H,T,0,0)}else a&&a instanceof Ke&&(d=a);_!==j.ADVANCED||d||(d=Ve),void 0!==(u=n.charSpace||jr)&&(p+=N(k(u))+" Tc\n",this.setCharSpace(this.getCharSpace()||0)),n.lang;var I=-1,P=void 0!==n.renderingMode?n.renderingMode:n.stroke,O=f.internal.getCurrentPageInfo().pageContext;switch(P){case 0:case!1:case"fill":I=0;break;case 1:case!0:case"stroke":I=1;break;case 2:case"fillThenStroke":I=2;break;case 3:case"invisible":I=3;break;case 4:case"fillAndAddForClipping":I=4;break;case 5:case"strokeAndAddPathForClipping":I=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":I=6;break;case 7:case"addToPathForClipping":I=7}var R=void 0!==O.usedRenderingMode?O.usedRenderingMode:-1;-1!==I?p+=I+" Tr\n":-1!==R&&(p+="0 Tr\n"),-1!==I&&(O.usedRenderingMode=I),A=n.align||"left";var M,D=fe*y,K=f.internal.pageSize.getWidth(),z=Ne[je];u=n.charSpace||jr,c=n.maxWidth||0,l=Object.assign({autoencode:!0,noBOM:!0},n.flags);var V=[];if("[object Array]"===Object.prototype.toString.call(e)){var q;i=b(e),"left"!==A&&(M=i.map((function(e){return f.getStringUnitWidth(e,{font:z,charSpace:u,fontSize:fe,doKerning:!1})*fe/v})));var G,X=0;if("right"===A){t-=M[0],e=[],F=i.length;for(var W=0;W<F;W++)0===W?(G=pr(t),q=mr(r)):(G=k(X-M[W]),q=-D),e.push([i[W],G,q]),X=M[W]}else if("center"===A){t-=M[0]/2,e=[],F=i.length;for(var J=0;J<F;J++)0===J?(G=pr(t),q=mr(r)):(G=k((X-M[J])/2),q=-D),e.push([i[J],G,q]),X=M[J]}else if("left"===A){e=[],F=i.length;for(var Y=0;Y<F;Y++)e.push(i[Y])}else{if("justify"!==A)throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');e=[],F=i.length,c=0!==c?c:K;for(var Z=0;Z<F;Z++)q=0===Z?mr(r):-D,G=0===Z?pr(t):0,Z<F-1&&V.push(N(k((c-M[Z])/(i[Z].split(" ").length-1)))),e.push([i[Z],G,q])}}var $="boolean"==typeof n.R2L?n.R2L:me;!0===$&&(e=B(e,(function(e,t,r){return[e.split("").reverse().join(""),t,r]}))),s={text:e,x:t,y:r,options:n,mutex:{pdfEscape:Qt,activeFontKey:je,fonts:Ne,activeFontSize:fe}},Oe.publish("postProcessText",s),e=s.text,m=s.mutex.isHex||!1;var ee=Ne[je].encoding;"WinAnsiEncoding"!==ee&&"StandardEncoding"!==ee||(e=B(e,(function(e,t,r){return[w(e),t,r]}))),i=b(e),e=[];for(var te,re,ne,oe=0,se=1,ie=Array.isArray(i[0])?se:oe,ae="",Ae=function(e,t,r){var o="";return r instanceof Ke?(r="number"==typeof n.angle?ze(r,new Ke(1,0,0,1,e,t)):ze(new Ke(1,0,0,1,e,t),r),_===j.ADVANCED&&(r=ze(new Ke(1,0,0,-1,0,0),r)),o=r.join(" ")+" Tm\n"):o=N(e)+" "+N(t)+" Td\n",o},ce=0;ce<i.length;ce++){switch(ae="",ie){case se:ne=(m?"<":"(")+i[ce][0]+(m?">":")"),te=parseFloat(i[ce][1]),re=parseFloat(i[ce][2]);break;case oe:ne=(m?"<":"(")+i[ce]+(m?">":")"),te=pr(t),re=mr(r)}void 0!==V&&void 0!==V[ce]&&(ae=V[ce]+" Tw\n"),0===ce?e.push(ae+Ae(te,re,d)+ne):ie===oe?e.push(ae+ne):ie===se&&e.push(ae+Ae(te,re,d)+ne)}e=ie===oe?e.join(" Tj\nT* "):e.join(" Tj\n"),e+=" Tj\n";var le="BT\n/";return le+=je+" "+fe+" Tf\n",le+=N(fe*y)+" TL\n",le+=br+"\n",le+=p,le+=e,ue(le+="ET"),g[je]=!0,f};var Jt=y.__private__.clip=y.clip=function(e){return ue("evenodd"===e?"W*":"W"),this};y.clipEvenOdd=function(){return Jt("evenodd")},y.__private__.discardPath=y.discardPath=function(){return ue("n"),this};var Yt=y.__private__.isValidStyle=function(e){var t=!1;return-1!==[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(e)&&(t=!0),t};y.__private__.setDefaultPathOperation=y.setDefaultPathOperation=function(e){return Yt(e)&&(h=e),this};var Zt=y.__private__.getStyle=y.getStyle=function(e){var t=h;switch(e){case"D":case"S":t="S";break;case"F":t="f";break;case"FD":case"DF":t="B";break;case"f":case"f*":case"B":case"B*":t=e}return t},$t=y.close=function(){return ue("h"),this};y.stroke=function(){return ue("S"),this},y.fill=function(e){return er("f",e),this},y.fillEvenOdd=function(e){return er("f*",e),this},y.fillStroke=function(e){return er("B",e),this},y.fillStrokeEvenOdd=function(e){return er("B*",e),this};var er=function(e,t){"object"==typeof t?nr(t,e):ue(e)},tr=function(e){null===e||_===j.ADVANCED&&void 0===e||(e=Zt(e),ue(e))};function rr(e,t,r,n,o){var s=new T(t||this.boundingBox,r||this.xStep,n||this.yStep,this.gState,o||this.matrix);s.stream=this.stream;var i=e+"$$"+this.cloneIndex+++"$$";return qe(i,s),s}var nr=function(e,t){var r=Se[e.key],n=Ue[r];if(n instanceof L)ue("q"),ue(or(t)),n.gState&&y.setGState(n.gState),ue(e.matrix.toString()+" cm"),ue("/"+r+" sh"),ue("Q");else if(n instanceof T){var o=new Ke(1,0,0,-1,0,Ir());e.matrix&&(o=o.multiply(e.matrix||Ve),r=rr.call(n,e.key,e.boundingBox,e.xStep,e.yStep,o).id),ue("q"),ue("/Pattern cs"),ue("/"+r+" scn"),n.gState&&y.setGState(n.gState),ue(t),ue("Q")}},or=function(e){switch(e){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},sr=y.moveTo=function(e,t){return ue(N(k(e))+" "+N(M(t))+" m"),this},ir=y.lineTo=function(e,t){return ue(N(k(e))+" "+N(M(t))+" l"),this},ar=y.curveTo=function(e,t,r,n,o,s){return ue([N(k(e)),N(M(t)),N(k(r)),N(M(n)),N(k(o)),N(M(s)),"c"].join(" ")),this};y.__private__.line=y.line=function(e,t,r,n,o){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n)||!Yt(o))throw new Error("Invalid arguments passed to jsPDF.line");return _===j.COMPAT?this.lines([[r-e,n-t]],e,t,[1,1],o||"S"):this.lines([[r-e,n-t]],e,t,[1,1]).stroke()},y.__private__.lines=y.lines=function(e,t,r,n,o,s){var i,a,A,u,c,l,d,f,h,p,m,g;if("number"==typeof e&&(g=r,r=t,t=e,e=g),n=n||[1,1],s=s||!1,isNaN(t)||isNaN(r)||!Array.isArray(e)||!Array.isArray(n)||!Yt(o)||"boolean"!=typeof s)throw new Error("Invalid arguments passed to jsPDF.lines");for(sr(t,r),i=n[0],a=n[1],u=e.length,p=t,m=r,A=0;A<u;A++)2===(c=e[A]).length?(p=c[0]*i+p,m=c[1]*a+m,ir(p,m)):(l=c[0]*i+p,d=c[1]*a+m,f=c[2]*i+p,h=c[3]*a+m,p=c[4]*i+p,m=c[5]*a+m,ar(l,d,f,h,p,m));return s&&$t(),tr(o),this},y.path=function(e){for(var t=0;t<e.length;t++){var r=e[t],n=r.c;switch(r.op){case"m":sr(n[0],n[1]);break;case"l":ir(n[0],n[1]);break;case"c":ar.apply(this,n);break;case"h":$t()}}return this},y.__private__.rect=y.rect=function(e,t,r,n,o){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n)||!Yt(o))throw new Error("Invalid arguments passed to jsPDF.rect");return _===j.COMPAT&&(n=-n),ue([N(k(e)),N(M(t)),N(k(r)),N(k(n)),"re"].join(" ")),tr(o),this},y.__private__.triangle=y.triangle=function(e,t,r,n,o,s,i){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n)||isNaN(o)||isNaN(s)||!Yt(i))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[r-e,n-t],[o-r,s-n],[e-o,t-s]],e,t,[1,1],i,!0),this},y.__private__.roundedRect=y.roundedRect=function(e,t,r,n,o,s,i){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n)||isNaN(o)||isNaN(s)||!Yt(i))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var a=4/3*(Math.SQRT2-1);return o=Math.min(o,.5*r),s=Math.min(s,.5*n),this.lines([[r-2*o,0],[o*a,0,o,s-s*a,o,s],[0,n-2*s],[0,s*a,-o*a,s,-o,s],[2*o-r,0],[-o*a,0,-o,-s*a,-o,-s],[0,2*s-n],[0,-s*a,o*a,-s,o,-s]],e+o,t,[1,1],i,!0),this},y.__private__.ellipse=y.ellipse=function(e,t,r,n,o){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n)||!Yt(o))throw new Error("Invalid arguments passed to jsPDF.ellipse");var s=4/3*(Math.SQRT2-1)*r,i=4/3*(Math.SQRT2-1)*n;return sr(e+r,t),ar(e+r,t-i,e+s,t-n,e,t-n),ar(e-s,t-n,e-r,t-i,e-r,t),ar(e-r,t+i,e-s,t+n,e,t+n),ar(e+s,t+n,e+r,t+i,e+r,t),tr(o),this},y.__private__.circle=y.circle=function(e,t,r,n){if(isNaN(e)||isNaN(t)||isNaN(r)||!Yt(n))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(e,t,r,r,n)},y.setFont=function(e,t,r){return r&&(t=E(t,r)),je=Ht(e,t,{disableWarning:!1}),this};var Ar=y.__private__.getFont=y.getFont=function(){return Ne[Ht.apply(y,arguments)]};y.__private__.getFontList=y.getFontList=function(){var e,t,r={};for(e in Qe)if(Qe.hasOwnProperty(e))for(t in r[e]=[],Qe[e])Qe[e].hasOwnProperty(t)&&r[e].push(t);return r},y.addFont=function(e,t,r,n,o){var s=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&-1!==s.indexOf(arguments[3])?o=arguments[3]:arguments[3]&&-1==s.indexOf(arguments[3])&&(r=E(r,n)),o=o||"Identity-H",Ct.call(this,e,t,r,o)};var ur,cr=e.lineWidth||.200025,lr=y.__private__.setLineWidth=y.setLineWidth=function(e){return ue(N(k(e))+" w"),this};y.__private__.setLineDash=H.API.setLineDash=H.API.setLineDashPattern=function(e,t){if(e=e||[],t=t||0,isNaN(t)||!Array.isArray(e))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return e=e.map((function(e){return N(k(e))})).join(" "),t=N(k(t)),ue("["+e+"] "+t+" d"),this};var dr=y.__private__.getLineHeight=y.getLineHeight=function(){return fe*ur};y.__private__.getLineHeight=y.getLineHeight=function(){return fe*ur};var fr=y.__private__.setLineHeightFactor=y.setLineHeightFactor=function(e){return"number"==typeof(e=e||1.15)&&(ur=e),this},hr=y.__private__.getLineHeightFactor=y.getLineHeightFactor=function(){return ur};fr(e.lineHeight);var pr=y.__private__.getHorizontalCoordinate=function(e){return k(e)},mr=y.__private__.getVerticalCoordinate=function(e){return _===j.ADVANCED?e:Pe[J].mediaBox.topRightY-Pe[J].mediaBox.bottomLeftY-k(e)},gr=y.__private__.getHorizontalCoordinateString=y.getHorizontalCoordinateString=function(e){return N(pr(e))},yr=y.__private__.getVerticalCoordinateString=y.getVerticalCoordinateString=function(e){return N(mr(e))},vr=e.strokeColor||"0 G";y.__private__.getStrokeColor=y.getDrawColor=function(){return $e(vr)},y.__private__.setStrokeColor=y.setDrawColor=function(e,t,r,n){return vr=et({ch1:e,ch2:t,ch3:r,ch4:n,pdfColorType:"draw",precision:2}),ue(vr),this};var wr=e.fillColor||"0 g";y.__private__.getFillColor=y.getFillColor=function(){return $e(wr)},y.__private__.setFillColor=y.setFillColor=function(e,t,r,n){return wr=et({ch1:e,ch2:t,ch3:r,ch4:n,pdfColorType:"fill",precision:2}),ue(wr),this};var br=e.textColor||"0 g",Br=y.__private__.getTextColor=y.getTextColor=function(){return $e(br)};y.__private__.setTextColor=y.setTextColor=function(e,t,r,n){return br=et({ch1:e,ch2:t,ch3:r,ch4:n,pdfColorType:"text",precision:3}),this};var jr=e.charSpace,_r=y.__private__.getCharSpace=y.getCharSpace=function(){return parseFloat(jr||0)};y.__private__.setCharSpace=y.setCharSpace=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return jr=e,this};var Cr=0;y.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},y.__private__.setLineCap=y.setLineCap=function(e){var t=y.CapJoinStyles[e];if(void 0===t)throw new Error("Line cap style of '"+e+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Cr=t,ue(t+" J"),this};var xr=0;y.__private__.setLineJoin=y.setLineJoin=function(e){var t=y.CapJoinStyles[e];if(void 0===t)throw new Error("Line join style of '"+e+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return xr=t,ue(t+" j"),this},y.__private__.setLineMiterLimit=y.__private__.setMiterLimit=y.setLineMiterLimit=y.setMiterLimit=function(e){if(e=e||0,isNaN(e))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return ue(N(k(e))+" M"),this},y.GState=U,y.setGState=function(e){(e="string"==typeof e?Le[Te[e]]:Er(null,e)).equals(He)||(ue("/"+e.id+" gs"),He=e)};var Er=function(e,t){if(!e||!Te[e]){var r=!1;for(var n in Le)if(Le.hasOwnProperty(n)&&Le[n].equals(t)){r=!0;break}if(r)t=Le[n];else{var o="GS"+(Object.keys(Le).length+1).toString(10);Le[o]=t,t.id=o}return e&&(Te[e]=t.id),Oe.publish("addGState",t),t}};y.addGState=function(e,t){return Er(e,t),this},y.saveGraphicsState=function(){return ue("q"),Fe.push({key:je,size:fe,color:br}),this},y.restoreGraphicsState=function(){ue("Q");var e=Fe.pop();return je=e.key,fe=e.size,br=e.color,He=null,this},y.setCurrentTransformationMatrix=function(e){return ue(e.toString()+" cm"),this},y.comment=function(e){return ue("#"+e),this};var Nr=function(e,t){var r=e||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return r},set:function(e){isNaN(e)||(r=parseFloat(e))}});var n=t||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return n},set:function(e){isNaN(e)||(n=parseFloat(e))}});var o="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return o},set:function(e){o=e.toString()}}),this},Qr=function(e,t,r,n){Nr.call(this,e,t),this.type="rect";var o=r||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return o},set:function(e){isNaN(e)||(o=parseFloat(e))}});var s=n||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return s},set:function(e){isNaN(e)||(s=parseFloat(e))}}),this},Fr=function(){this.page=Ie,this.currentPage=J,this.pages=oe.slice(0),this.pagesContext=Pe.slice(0),this.x=Ce,this.y=xe,this.matrix=Ee,this.width=Tr(J),this.height=Ir(J),this.outputDestination=ie,this.id="",this.objectNumber=-1};Fr.prototype.restore=function(){Ie=this.page,J=this.currentPage,Pe=this.pagesContext,oe=this.pages,Ce=this.x,xe=this.y,Ee=this.matrix,Hr(J,this.width),Pr(J,this.height),ie=this.outputDestination};var Ur=function(e,t,r,n,o){De.push(new Fr),Ie=J=0,oe=[],Ce=e,xe=t,Ee=o,Ft([r,n])},Sr=function(e){if(!Me[e]){var t=new Fr,r="Xo"+(Object.keys(Re).length+1).toString(10);t.id=r,Me[e]=r,Re[r]=t,Oe.publish("addFormObject",t),De.pop().restore()}};for(var Lr in y.beginFormObject=function(e,t,r,n,o){return Ur(e,t,r,n,o),this},y.endFormObject=function(e){return Sr(e),this},y.doFormObject=function(e,t){var r=Re[Me[e]];return ue("q"),ue(t.toString()+" cm"),ue("/"+r.id+" Do"),ue("Q"),this},y.getFormObject=function(e){var t=Re[Me[e]];return{x:t.x,y:t.y,width:t.width,height:t.height,matrix:t.matrix}},y.save=function(e,t){return e=e||"generated.pdf",(t=t||{}).returnPromise=t.returnPromise||!1,!1===t.returnPromise?(d(Dt(Mt()),e),"function"==typeof d.unload&&o.setTimeout&&setTimeout(d.unload,911),this):new Promise((function(t,r){try{var n=d(Dt(Mt()),e);"function"==typeof d.unload&&o.setTimeout&&setTimeout(d.unload,911),t(n)}catch(e){r(e.message)}}))},H.API)H.API.hasOwnProperty(Lr)&&("events"===Lr&&H.API.events.length?function(e,t){var r,n,o;for(o=t.length-1;-1!==o;o--)r=t[o][0],n=t[o][1],e.subscribe.apply(e,[r].concat("function"==typeof n?[n]:n))}(Oe,H.API.events):y[Lr]=H.API[Lr]);var Tr=y.getPageWidth=function(e){return(Pe[e=e||J].mediaBox.topRightX-Pe[e].mediaBox.bottomLeftX)/_e},Hr=y.setPageWidth=function(e,t){Pe[e].mediaBox.topRightX=t*_e+Pe[e].mediaBox.bottomLeftX},Ir=y.getPageHeight=function(e){return(Pe[e=e||J].mediaBox.topRightY-Pe[e].mediaBox.bottomLeftY)/_e},Pr=y.setPageHeight=function(e,t){Pe[e].mediaBox.topRightY=t*_e+Pe[e].mediaBox.bottomLeftY};return y.internal={pdfEscape:Qt,getStyle:Zt,getFont:Ar,getFontSize:pe,getCharSpace:_r,getTextColor:Br,getLineHeight:dr,getLineHeightFactor:hr,write:ce,getHorizontalCoordinate:pr,getVerticalCoordinate:mr,getCoordinateString:gr,getVerticalCoordinateString:yr,collections:{},newObject:Ge,newAdditionalObject:Je,newObjectDeferred:Xe,newObjectDeferredBegin:We,getFilters:tt,putStream:rt,events:Oe,scaleFactor:_e,pageSize:{getWidth:function(){return Tr(J)},setWidth:function(e){Hr(J,e)},getHeight:function(){return Ir(J)},setHeight:function(e){Pr(J,e)}},encryptionOptions:p,encryption:Vt,getEncryptor:qt,output:Kt,getNumberOfPages:Tt,pages:oe,out:ue,f2:P,f3:O,getPageInfo:Gt,getPageInfoByObjId:Xt,getCurrentPageInfo:Wt,getPDFVersion:w,Point:Nr,Rectangle:Qr,Matrix:Ke,hasHotfix:zt},Object.defineProperty(y.internal.pageSize,"width",{get:function(){return Tr(J)},set:function(e){Hr(J,e)},enumerable:!0,configurable:!0}),Object.defineProperty(y.internal.pageSize,"height",{get:function(){return Ir(J)},set:function(e){Pr(J,e)},enumerable:!0,configurable:!0}),xt.call(y,de),je="F1",Ut(s,r),Oe.publish("initialized"),y}Q.prototype.lsbFirstWord=function(e){return String.fromCharCode(e>>0&255,e>>8&255,e>>16&255,e>>24&255)},Q.prototype.toHexString=function(e){return e.split("").map((function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)})).join("")},Q.prototype.hexToBytes=function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(String.fromCharCode(parseInt(e.substr(r,2),16)));return t.join("")},Q.prototype.processOwnerPassword=function(e,t){return E(C(t).substr(0,5),e)},Q.prototype.encryptor=function(e,t){let r=C(this.encryptionKey+String.fromCharCode(255&e,e>>8&255,e>>16&255,255&t,t>>8&255)).substr(0,10);return function(e){return E(r,e)}},U.prototype.equals=function(e){var t,r="id,objectNumber,equals";if(!e||typeof e!=typeof this)return!1;var n=0;for(t in this)if(!(r.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!e.hasOwnProperty(t))return!1;if(this[t]!==e[t])return!1;n++}for(t in e)e.hasOwnProperty(t)&&r.indexOf(t)<0&&n--;return 0===n},H.API={events:[]},H.version="2.3.1";var I=H.API,P=1,O=function(e){return e.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},k=function(e){return e.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},R=function(e){return e.toFixed(2)},M=function(e){return e.toFixed(5)};I.__acroform__={};var D=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},K=function(e){return e*P},z=function(e){var t=new ie,r=we.internal.getHeight(e)||0,n=we.internal.getWidth(e)||0;return t.BBox=[0,0,Number(R(n)),Number(R(r))],t},V=I.__acroform__.setBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return e|1<<t},q=I.__acroform__.clearBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return e&~(1<<t)},G=I.__acroform__.getBit=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return 0==(e&1<<t)?0:1},X=I.__acroform__.getBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return G(e,t-1)},W=I.__acroform__.setBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return V(e,t-1)},J=I.__acroform__.clearBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return q(e,t-1)},Y=I.__acroform__.calculateCoordinates=function(e,t){var r=t.internal.getHorizontalCoordinate,n=t.internal.getVerticalCoordinate,o=e[0],s=e[1],i=e[2],a=e[3],A={};return A.lowerLeft_X=r(o)||0,A.lowerLeft_Y=n(s+a)||0,A.upperRight_X=r(o+i)||0,A.upperRight_Y=n(s)||0,[Number(R(A.lowerLeft_X)),Number(R(A.lowerLeft_Y)),Number(R(A.upperRight_X)),Number(R(A.upperRight_Y))]},Z=function(e){if(e.appearanceStreamContent)return e.appearanceStreamContent;if(e.V||e.DV){var t=[],r=e._V||e.DV,n=$(e,r),o=e.scope.internal.getFont(e.fontName,e.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(e.scope.__private__.encodeColorString(e.color)),t.push("/"+o+" "+R(n.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(n.text),t.push("ET"),t.push("Q"),t.push("EMC");var s=z(e);return s.scope=e.scope,s.stream=t.join("\n"),s}},$=function(e,t){var r=0===e.fontSize?e.maxFontSize:e.fontSize,n={text:"",fontSize:""},o=(t=")"==(t="("==t.substr(0,1)?t.substr(1):t).substr(t.length-1)?t.substr(0,t.length-1):t).split(" "),s=r,i=we.internal.getHeight(e)||0;i=i<0?-i:i;var a=we.internal.getWidth(e)||0;a=a<0?-a:a;var A=function(t,r,n){if(t+1<o.length){var s=r+" "+o[t+1];return ee(s,e,n).width<=a-4}return!1};s++;e:for(;s>0;){t="",s--;var u,c,l=ee("3",e,s).height,d=e.multiline?i-s:(i-l)/2,f=d+=2,h=0,p=0;if(s<=0){t="(...) Tj\n",t+="% Width of Text: "+ee(t,e,s=12).width+", FieldWidth:"+a+"\n";break}var m="",g=0;for(var y in o)if(o.hasOwnProperty(y)){m=" "==(m+=o[y]+" ").substr(m.length-1)?m.substr(0,m.length-1):m;var v=parseInt(y),w=A(v,m,s),b=y>=o.length-1;if(w&&!b){m+=" ";continue}if(w||b){if(b)p=v;else if(e.multiline&&(l+2)*(g+2)+2>i)continue e}else{if(!e.multiline)continue e;if((l+2)*(g+2)+2>i)continue e;p=v}for(var B="",j=h;j<=p;j++)B+=o[j]+" ";switch(B=" "==B.substr(B.length-1)?B.substr(0,B.length-1):B,c=ee(B,e,s).width,e.textAlign){case"right":u=a-c-2;break;case"center":u=(a-c)/2;break;case"left":default:u=2}t+=R(u)+" "+R(f)+" Td\n",t+="("+O(B)+") Tj\n",t+=-R(u)+" 0 Td\n",f=-(s+2),c=0,h=p+1,g++,m=""}break}return n.text=t,n.fontSize=s,n},ee=function(e,t,r){var n=t.scope.internal.getFont(t.fontName,t.fontStyle),o=t.scope.getStringUnitWidth(e,{font:n,fontSize:parseFloat(r),charSpace:0})*parseFloat(r);return{height:t.scope.getStringUnitWidth("3",{font:n,fontSize:parseFloat(r),charSpace:0})*parseFloat(r)*1.5,width:o}},te={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},re=function(e,t){var r={type:"reference",object:e};void 0===t.internal.getPageInfo(e.page).pageContext.annotations.find((function(e){return e.type===r.type&&e.object===r.object}))&&t.internal.getPageInfo(e.page).pageContext.annotations.push(r)},ne=I.__acroform__.arrayToPdfArray=function(e,t,r){var n=function(e){return e};if(Array.isArray(e)){for(var o="[",s=0;s<e.length;s++)switch(0!==s&&(o+=" "),typeof e[s]){case"boolean":case"number":case"object":o+=e[s].toString();break;case"string":"/"!==e[s].substr(0,1)?(void 0!==t&&r&&(n=r.internal.getEncryptor(t)),o+="("+O(n(e[s].toString()))+")"):o+=e[s].toString()}return o+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},oe=function(e,t,r){var n=function(e){return e};return void 0!==t&&r&&(n=r.internal.getEncryptor(t)),(e=e||"").toString(),"("+O(n(e))+")"},se=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(void 0===this._objId){if(void 0===this.scope)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(e){this._objId=e}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};se.prototype.toString=function(){return this.objId+" 0 R"},se.prototype.putStream=function(){var e=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:e,objectId:this.objId}),this.scope.internal.out("endobj")},se.prototype.getKeyValueListForStream=function(){var e=[],t=Object.getOwnPropertyNames(this).filter((function(e){return"content"!=e&&"appearanceStreamContent"!=e&&"scope"!=e&&"objId"!=e&&"_"!=e.substring(0,1)}));for(var r in t)if(!1===Object.getOwnPropertyDescriptor(this,t[r]).configurable){var n=t[r],o=this[n];o&&(Array.isArray(o)?e.push({key:n,value:ne(o,this.objId,this.scope)}):o instanceof se?(o.scope=this.scope,e.push({key:n,value:o.objId+" 0 R"})):"function"!=typeof o&&e.push({key:n,value:o}))}return e};var ie=function(){se.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var e,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){e=t.trim()},get:function(){return e||null}})};D(ie,se);var ae=function(){se.call(this);var e,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(e){var t=function(e){return e};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+O(t(e))+")"}},set:function(t){e=t}})};D(ae,se);var Ae=function(){se.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(t){if(isNaN(t))throw new Error('Invalid value "'+t+'" for attribute F supplied.');e=t}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return Boolean(X(e,3))},set:function(t){!0===Boolean(t)?this.F=W(e,3):this.F=J(e,3)}});var t=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return t},set:function(e){if(isNaN(e))throw new Error('Invalid value "'+e+'" for attribute Ff supplied.');t=e}});var r=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(0!==r.length)return r},set:function(e){r=void 0!==e?e:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[0])?0:r[0]},set:function(e){r[0]=e}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[1])?0:r[1]},set:function(e){r[1]=e}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[2])?0:r[2]},set:function(e){r[2]=e}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[3])?0:r[3]},set:function(e){r[3]=e}});var n="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return n},set:function(e){switch(e){case"/Btn":case"/Tx":case"/Ch":case"/Sig":n=e;break;default:throw new Error('Invalid value "'+e+'" for attribute FT supplied.')}}});var o=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!o||o.length<1){if(this instanceof me)return;o="FieldObject"+Ae.FieldNum++}var e=function(e){return e};return this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),"("+O(e(o))+")"},set:function(e){o=e.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return o},set:function(e){o=e}});var s="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return s},set:function(e){s=e}});var i="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return i},set:function(e){i=e}});var a=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return a},set:function(e){a=e}});var A=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return void 0===A?50/P:A},set:function(e){A=e}});var u="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return u},set:function(e){u=e}});var c="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!c||this instanceof me||this instanceof ye))return oe(c,this.objId,this.scope)},set:function(e){e=e.toString(),c=e}});var l=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(l)return this instanceof fe==0?oe(l,this.objId,this.scope):l},set:function(e){e=e.toString(),l=this instanceof fe==0?"("===e.substr(0,1)?k(e.substr(1,e.length-2)):k(e):e}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof fe==1?k(l.substr(1,l.length-1)):l},set:function(e){e=e.toString(),l=this instanceof fe==1?"/"+e:e}});var d=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(d)return d},set:function(e){this.V=e}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(d)return this instanceof fe==0?oe(d,this.objId,this.scope):d},set:function(e){e=e.toString(),d=this instanceof fe==0?"("===e.substr(0,1)?k(e.substr(1,e.length-2)):k(e):e}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof fe==1?k(d.substr(1,d.length-1)):d},set:function(e){e=e.toString(),d=this instanceof fe==1?"/"+e:e}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var f,h=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return h},set:function(e){e=Boolean(e),h=e}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(f)return f},set:function(e){f=e}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return Boolean(X(this.Ff,1))},set:function(e){!0===Boolean(e)?this.Ff=W(this.Ff,1):this.Ff=J(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return Boolean(X(this.Ff,2))},set:function(e){!0===Boolean(e)?this.Ff=W(this.Ff,2):this.Ff=J(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return Boolean(X(this.Ff,3))},set:function(e){!0===Boolean(e)?this.Ff=W(this.Ff,3):this.Ff=J(this.Ff,3)}});var p=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(null!==p)return p},set:function(e){if(-1===[0,1,2].indexOf(e))throw new Error('Invalid value "'+e+'" for attribute Q supplied.');p=e}}),Object.defineProperty(this,"textAlign",{get:function(){var e;switch(p){case 0:default:e="left";break;case 1:e="center";break;case 2:e="right"}return e},configurable:!0,enumerable:!0,set:function(e){switch(e){case"right":case 2:p=2;break;case"center":case 1:p=1;break;case"left":case 0:default:p=0}}})};D(Ae,se);var ue=function(){Ae.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var e=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){e=t}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return ne(t,this.objId,this.scope)},set:function(e){var r,n;n=[],"string"==typeof(r=e)&&(n=function(e,t,r){r||(r=1);for(var n,o=[];n=t.exec(e);)o.push(n[r]);return o}(r,/\((.*?)\)/g)),t=n}}),this.getOptions=function(){return t},this.setOptions=function(e){t=e,this.sort&&t.sort()},this.addOption=function(e){e=(e=e||"").toString(),t.push(e),this.sort&&t.sort()},this.removeOption=function(e,r){for(r=r||!1,e=(e=e||"").toString();-1!==t.indexOf(e)&&(t.splice(t.indexOf(e),1),!1!==r););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return Boolean(X(this.Ff,18))},set:function(e){!0===Boolean(e)?this.Ff=W(this.Ff,18):this.Ff=J(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return Boolean(X(this.Ff,19))},set:function(e){!0===this.combo&&(!0===Boolean(e)?this.Ff=W(this.Ff,19):this.Ff=J(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return Boolean(X(this.Ff,20))},set:function(e){!0===Boolean(e)?(this.Ff=W(this.Ff,20),t.sort()):this.Ff=J(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return Boolean(X(this.Ff,22))},set:function(e){!0===Boolean(e)?this.Ff=W(this.Ff,22):this.Ff=J(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return Boolean(X(this.Ff,23))},set:function(e){!0===Boolean(e)?this.Ff=W(this.Ff,23):this.Ff=J(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return Boolean(X(this.Ff,27))},set:function(e){!0===Boolean(e)?this.Ff=W(this.Ff,27):this.Ff=J(this.Ff,27)}}),this.hasAppearanceStream=!1};D(ue,Ae);var ce=function(){ue.call(this),this.fontName="helvetica",this.combo=!1};D(ce,ue);var le=function(){ce.call(this),this.combo=!0};D(le,ce);var de=function(){le.call(this),this.edit=!0};D(de,le);var fe=function(){Ae.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return Boolean(X(this.Ff,15))},set:function(e){!0===Boolean(e)?this.Ff=W(this.Ff,15):this.Ff=J(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return Boolean(X(this.Ff,16))},set:function(e){!0===Boolean(e)?this.Ff=W(this.Ff,16):this.Ff=J(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return Boolean(X(this.Ff,17))},set:function(e){!0===Boolean(e)?this.Ff=W(this.Ff,17):this.Ff=J(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return Boolean(X(this.Ff,26))},set:function(e){!0===Boolean(e)?this.Ff=W(this.Ff,26):this.Ff=J(this.Ff,26)}});var e,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(e){return e};if(this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),0!==Object.keys(t).length){var r,n=[];for(r in n.push("<<"),t)n.push("/"+r+" ("+O(e(t[r]))+")");return n.push(">>"),n.join("\n")}},set:function(e){"object"==typeof e&&(t=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(e){"string"==typeof e&&(t.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(t){e="/"+t}})};D(fe,Ae);var he=function(){fe.call(this),this.pushButton=!0};D(he,fe);var pe=function(){fe.call(this),this.radio=!0,this.pushButton=!1;var e=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=void 0!==t?t:[]}})};D(pe,fe);var me=function(){var e,t;Ae.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(e){t=e}});var r,n={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(e){return e};this.scope&&(e=this.scope.internal.getEncryptor(this.objId));var t,r=[];for(t in r.push("<<"),n)r.push("/"+t+" ("+O(e(n[t]))+")");return r.push(">>"),r.join("\n")},set:function(e){"object"==typeof e&&(n=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return n.CA||""},set:function(e){"string"==typeof e&&(n.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return r},set:function(e){r=e}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return r.substr(1,r.length-1)},set:function(e){r="/"+e}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=we.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};D(me,Ae),pe.prototype.setAppearance=function(e){if(!("createAppearanceStream"in e)||!("getCA"in e))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var r=this.Kids[t];r.appearanceStreamContent=e.createAppearanceStream(r.optionName),r.caption=e.getCA()}},pe.prototype.createOption=function(e){var t=new me;return t.Parent=this,t.optionName=e,this.Kids.push(t),be.call(this.scope,t),t};var ge=function(){fe.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=we.CheckBox.createAppearanceStream()};D(ge,fe);var ye=function(){Ae.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return Boolean(X(this.Ff,13))},set:function(e){!0===Boolean(e)?this.Ff=W(this.Ff,13):this.Ff=J(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return Boolean(X(this.Ff,21))},set:function(e){!0===Boolean(e)?this.Ff=W(this.Ff,21):this.Ff=J(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return Boolean(X(this.Ff,23))},set:function(e){!0===Boolean(e)?this.Ff=W(this.Ff,23):this.Ff=J(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return Boolean(X(this.Ff,24))},set:function(e){!0===Boolean(e)?this.Ff=W(this.Ff,24):this.Ff=J(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return Boolean(X(this.Ff,25))},set:function(e){!0===Boolean(e)?this.Ff=W(this.Ff,25):this.Ff=J(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return Boolean(X(this.Ff,26))},set:function(e){!0===Boolean(e)?this.Ff=W(this.Ff,26):this.Ff=J(this.Ff,26)}});var e=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){Number.isInteger(t)&&(e=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};D(ye,Ae);var ve=function(){ye.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return Boolean(X(this.Ff,14))},set:function(e){!0===Boolean(e)?this.Ff=W(this.Ff,14):this.Ff=J(this.Ff,14)}}),this.password=!0};D(ve,ye);var we={CheckBox:{createAppearanceStream:function(){return{N:{On:we.CheckBox.YesNormal},D:{On:we.CheckBox.YesPushDown,Off:we.CheckBox.OffPushDown}}},YesPushDown:function(e){var t=z(e);t.scope=e.scope;var r=[],n=e.scope.internal.getFont(e.fontName,e.fontStyle).id,o=e.scope.__private__.encodeColorString(e.color),s=$(e,e.caption);return r.push("0.749023 g"),r.push("0 0 "+R(we.internal.getWidth(e))+" "+R(we.internal.getHeight(e))+" re"),r.push("f"),r.push("BMC"),r.push("q"),r.push("0 0 1 rg"),r.push("/"+n+" "+R(s.fontSize)+" Tf "+o),r.push("BT"),r.push(s.text),r.push("ET"),r.push("Q"),r.push("EMC"),t.stream=r.join("\n"),t},YesNormal:function(e){var t=z(e);t.scope=e.scope;var r=e.scope.internal.getFont(e.fontName,e.fontStyle).id,n=e.scope.__private__.encodeColorString(e.color),o=[],s=we.internal.getHeight(e),i=we.internal.getWidth(e),a=$(e,e.caption);return o.push("1 g"),o.push("0 0 "+R(i)+" "+R(s)+" re"),o.push("f"),o.push("q"),o.push("0 0 1 rg"),o.push("0 0 "+R(i-1)+" "+R(s-1)+" re"),o.push("W"),o.push("n"),o.push("0 g"),o.push("BT"),o.push("/"+r+" "+R(a.fontSize)+" Tf "+n),o.push(a.text),o.push("ET"),o.push("Q"),t.stream=o.join("\n"),t},OffPushDown:function(e){var t=z(e);t.scope=e.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+R(we.internal.getWidth(e))+" "+R(we.internal.getHeight(e))+" re"),r.push("f"),t.stream=r.join("\n"),t}},RadioButton:{Circle:{createAppearanceStream:function(e){var t={D:{Off:we.RadioButton.Circle.OffPushDown},N:{}};return t.N[e]=we.RadioButton.Circle.YesNormal,t.D[e]=we.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(e){var t=z(e);t.scope=e.scope;var r=[],n=we.internal.getWidth(e)<=we.internal.getHeight(e)?we.internal.getWidth(e)/4:we.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var o=we.internal.Bezier_C,s=Number((n*o).toFixed(5));return r.push("q"),r.push("1 0 0 1 "+M(we.internal.getWidth(e)/2)+" "+M(we.internal.getHeight(e)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+s+" "+s+" "+n+" 0 "+n+" c"),r.push("-"+s+" "+n+" -"+n+" "+s+" -"+n+" 0 c"),r.push("-"+n+" -"+s+" -"+s+" -"+n+" 0 -"+n+" c"),r.push(s+" -"+n+" "+n+" -"+s+" "+n+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join("\n"),t},YesPushDown:function(e){var t=z(e);t.scope=e.scope;var r=[],n=we.internal.getWidth(e)<=we.internal.getHeight(e)?we.internal.getWidth(e)/4:we.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var o=Number((2*n).toFixed(5)),s=Number((o*we.internal.Bezier_C).toFixed(5)),i=Number((n*we.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+M(we.internal.getWidth(e)/2)+" "+M(we.internal.getHeight(e)/2)+" cm"),r.push(o+" 0 m"),r.push(o+" "+s+" "+s+" "+o+" 0 "+o+" c"),r.push("-"+s+" "+o+" -"+o+" "+s+" -"+o+" 0 c"),r.push("-"+o+" -"+s+" -"+s+" -"+o+" 0 -"+o+" c"),r.push(s+" -"+o+" "+o+" -"+s+" "+o+" 0 c"),r.push("f"),r.push("Q"),r.push("0 g"),r.push("q"),r.push("1 0 0 1 "+M(we.internal.getWidth(e)/2)+" "+M(we.internal.getHeight(e)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+i+" "+i+" "+n+" 0 "+n+" c"),r.push("-"+i+" "+n+" -"+n+" "+i+" -"+n+" 0 c"),r.push("-"+n+" -"+i+" -"+i+" -"+n+" 0 -"+n+" c"),r.push(i+" -"+n+" "+n+" -"+i+" "+n+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join("\n"),t},OffPushDown:function(e){var t=z(e);t.scope=e.scope;var r=[],n=we.internal.getWidth(e)<=we.internal.getHeight(e)?we.internal.getWidth(e)/4:we.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var o=Number((2*n).toFixed(5)),s=Number((o*we.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+M(we.internal.getWidth(e)/2)+" "+M(we.internal.getHeight(e)/2)+" cm"),r.push(o+" 0 m"),r.push(o+" "+s+" "+s+" "+o+" 0 "+o+" c"),r.push("-"+s+" "+o+" -"+o+" "+s+" -"+o+" 0 c"),r.push("-"+o+" -"+s+" -"+s+" -"+o+" 0 -"+o+" c"),r.push(s+" -"+o+" "+o+" -"+s+" "+o+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join("\n"),t}},Cross:{createAppearanceStream:function(e){var t={D:{Off:we.RadioButton.Cross.OffPushDown},N:{}};return t.N[e]=we.RadioButton.Cross.YesNormal,t.D[e]=we.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(e){var t=z(e);t.scope=e.scope;var r=[],n=we.internal.calculateCross(e);return r.push("q"),r.push("1 1 "+R(we.internal.getWidth(e)-2)+" "+R(we.internal.getHeight(e)-2)+" re"),r.push("W"),r.push("n"),r.push(R(n.x1.x)+" "+R(n.x1.y)+" m"),r.push(R(n.x2.x)+" "+R(n.x2.y)+" l"),r.push(R(n.x4.x)+" "+R(n.x4.y)+" m"),r.push(R(n.x3.x)+" "+R(n.x3.y)+" l"),r.push("s"),r.push("Q"),t.stream=r.join("\n"),t},YesPushDown:function(e){var t=z(e);t.scope=e.scope;var r=we.internal.calculateCross(e),n=[];return n.push("0.749023 g"),n.push("0 0 "+R(we.internal.getWidth(e))+" "+R(we.internal.getHeight(e))+" re"),n.push("f"),n.push("q"),n.push("1 1 "+R(we.internal.getWidth(e)-2)+" "+R(we.internal.getHeight(e)-2)+" re"),n.push("W"),n.push("n"),n.push(R(r.x1.x)+" "+R(r.x1.y)+" m"),n.push(R(r.x2.x)+" "+R(r.x2.y)+" l"),n.push(R(r.x4.x)+" "+R(r.x4.y)+" m"),n.push(R(r.x3.x)+" "+R(r.x3.y)+" l"),n.push("s"),n.push("Q"),t.stream=n.join("\n"),t},OffPushDown:function(e){var t=z(e);t.scope=e.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+R(we.internal.getWidth(e))+" "+R(we.internal.getHeight(e))+" re"),r.push("f"),t.stream=r.join("\n"),t}}},createDefaultAppearanceStream:function(e){var t=e.scope.internal.getFont(e.fontName,e.fontStyle).id,r=e.scope.__private__.encodeColorString(e.color);return"/"+t+" "+e.fontSize+" Tf "+r}};we.internal={Bezier_C:.551915024494,calculateCross:function(e){var t=we.internal.getWidth(e),r=we.internal.getHeight(e),n=Math.min(t,r);return{x1:{x:(t-n)/2,y:(r-n)/2+n},x2:{x:(t-n)/2+n,y:(r-n)/2},x3:{x:(t-n)/2,y:(r-n)/2},x4:{x:(t-n)/2+n,y:(r-n)/2+n}}}},we.internal.getWidth=function(e){var t=0;return"object"==typeof e&&(t=K(e.Rect[2])),t},we.internal.getHeight=function(e){var t=0;return"object"==typeof e&&(t=K(e.Rect[3])),t};var be=I.addField=function(e){if(function(e,t){if(t.scope=e,void 0!==e.internal&&(void 0===e.internal.acroformPlugin||!1===e.internal.acroformPlugin.isInitialized)){if(Ae.FieldNum=0,e.internal.acroformPlugin=JSON.parse(JSON.stringify(te)),e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");P=e.internal.scaleFactor,e.internal.acroformPlugin.acroFormDictionaryRoot=new ae,e.internal.acroformPlugin.acroFormDictionaryRoot.scope=e,e.internal.acroformPlugin.acroFormDictionaryRoot._eventID=e.internal.events.subscribe("postPutResources",(function(){!function(e){e.internal.events.unsubscribe(e.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete e.internal.acroformPlugin.acroFormDictionaryRoot._eventID,e.internal.acroformPlugin.printedOut=!0}(e)})),e.internal.events.subscribe("buildDocument",(function(){!function(e){e.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var t=e.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var r in t)if(t.hasOwnProperty(r)){var n=t[r];n.objId=void 0,n.hasAnnotation&&re(n,e)}}(e)})),e.internal.events.subscribe("putCatalog",(function(){!function(e){if(void 0===e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("putCatalogCallback: Root missing.");e.internal.write("/AcroForm "+e.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")}(e)})),e.internal.events.subscribe("postPutPages",(function(t){!function(e,t){var r=!e;for(var n in e||(t.internal.newObjectDeferredBegin(t.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),t.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),e=e||t.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(e.hasOwnProperty(n)){var o=e[n],s=[],i=o.Rect;if(o.Rect&&(o.Rect=Y(o.Rect,t)),t.internal.newObjectDeferredBegin(o.objId,!0),o.DA=we.createDefaultAppearanceStream(o),"object"==typeof o&&"function"==typeof o.getKeyValueListForStream&&(s=o.getKeyValueListForStream()),o.Rect=i,o.hasAppearanceStream&&!o.appearanceStreamContent){var a=Z(o);s.push({key:"AP",value:"<</N "+a+">>"}),t.internal.acroformPlugin.xForms.push(a)}if(o.appearanceStreamContent){var A="";for(var u in o.appearanceStreamContent)if(o.appearanceStreamContent.hasOwnProperty(u)){var c=o.appearanceStreamContent[u];if(A+="/"+u+" ",A+="<<",Object.keys(c).length>=1||Array.isArray(c)){for(var n in c)if(c.hasOwnProperty(n)){var l=c[n];"function"==typeof l&&(l=l.call(t,o)),A+="/"+n+" "+l+" ",t.internal.acroformPlugin.xForms.indexOf(l)>=0||t.internal.acroformPlugin.xForms.push(l)}}else"function"==typeof(l=c)&&(l=l.call(t,o)),A+="/"+n+" "+l,t.internal.acroformPlugin.xForms.indexOf(l)>=0||t.internal.acroformPlugin.xForms.push(l);A+=">>"}s.push({key:"AP",value:"<<\n"+A+">>"})}t.internal.putStream({additionalKeyValues:s,objectId:o.objId}),t.internal.out("endobj")}r&&function(e,t){for(var r in e)if(e.hasOwnProperty(r)){var n=r,o=e[r];t.internal.newObjectDeferredBegin(o.objId,!0),"object"==typeof o&&"function"==typeof o.putStream&&o.putStream(),delete e[n]}}(t.internal.acroformPlugin.xForms,t)}(t,e)})),e.internal.acroformPlugin.isInitialized=!0}}(this,e),!(e instanceof Ae))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=e).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),e.page=e.scope.internal.getCurrentPageInfo().pageNumber,this};I.AcroFormChoiceField=ue,I.AcroFormListBox=ce,I.AcroFormComboBox=le,I.AcroFormEditBox=de,I.AcroFormButton=fe,I.AcroFormPushButton=he,I.AcroFormRadioButton=pe,I.AcroFormCheckBox=ge,I.AcroFormTextField=ye,I.AcroFormPasswordField=ve,I.AcroFormAppearance=we,I.AcroForm={ChoiceField:ue,ListBox:ce,ComboBox:le,EditBox:de,Button:fe,PushButton:he,RadioButton:pe,CheckBox:ge,TextField:ye,PasswordField:ve,Appearance:we},H.AcroForm={ChoiceField:ue,ListBox:ce,ComboBox:le,EditBox:de,Button:fe,PushButton:he,RadioButton:pe,CheckBox:ge,TextField:ye,PasswordField:ve,Appearance:we};var Be,je,_e=H.AcroForm;function Ce(e){return e.reduce((function(e,t,r){return e[t]=r,e}),{})}!function(e){e.__addimage__={};var t="UNKNOWN",r={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},n=e.__addimage__.getImageFileTypeByImageData=function(e,n){var o,s;n=n||t;var i,a,A,u=t;if(_(e))for(A in r)for(i=r[A],o=0;o<i.length;o+=1){for(a=!0,s=0;s<i[o].length;s+=1)if(void 0!==i[o][s]&&i[o][s]!==e[s]){a=!1;break}if(!0===a){u=A;break}}else for(A in r)for(i=r[A],o=0;o<i.length;o+=1){for(a=!0,s=0;s<i[o].length;s+=1)if(void 0!==i[o][s]&&i[o][s]!==e.charCodeAt(s)){a=!1;break}if(!0===a){u=A;break}}return u===t&&n!==t&&(u=n),u},o=function(e){for(var t=this.internal.write,r=this.internal.putStream,n=(0,this.internal.getFilters)();-1!==n.indexOf("FlateEncode");)n.splice(n.indexOf("FlateEncode"),1);e.objectId=this.internal.newObject();var s=[];if(s.push({key:"Type",value:"/XObject"}),s.push({key:"Subtype",value:"/Image"}),s.push({key:"Width",value:e.width}),s.push({key:"Height",value:e.height}),e.colorSpace===y.INDEXED?s.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(e.palette.length/3-1)+" "+("sMask"in e&&void 0!==e.sMask?e.objectId+2:e.objectId+1)+" 0 R]"}):(s.push({key:"ColorSpace",value:"/"+e.colorSpace}),e.colorSpace===y.DEVICE_CMYK&&s.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),s.push({key:"BitsPerComponent",value:e.bitsPerComponent}),"decodeParameters"in e&&void 0!==e.decodeParameters&&s.push({key:"DecodeParms",value:"<<"+e.decodeParameters+">>"}),"transparency"in e&&Array.isArray(e.transparency)){for(var i="",a=0,A=e.transparency.length;a<A;a++)i+=e.transparency[a]+" "+e.transparency[a]+" ";s.push({key:"Mask",value:"["+i+"]"})}void 0!==e.sMask&&s.push({key:"SMask",value:e.objectId+1+" 0 R"});var u=void 0!==e.filter?["/"+e.filter]:void 0;if(r({data:e.data,additionalKeyValues:s,alreadyAppliedFilters:u,objectId:e.objectId}),t("endobj"),"sMask"in e&&void 0!==e.sMask){var c="/Predictor "+e.predictor+" /Colors 1 /BitsPerComponent "+e.bitsPerComponent+" /Columns "+e.width,l={width:e.width,height:e.height,colorSpace:"DeviceGray",bitsPerComponent:e.bitsPerComponent,decodeParameters:c,data:e.sMask};"filter"in e&&(l.filter=e.filter),o.call(this,l)}if(e.colorSpace===y.INDEXED){var d=this.internal.newObject();r({data:x(new Uint8Array(e.palette)),objectId:d}),t("endobj")}},s=function(){var e=this.internal.collections.addImage_images;for(var t in e)o.call(this,e[t])},i=function(){var e,t=this.internal.collections.addImage_images,r=this.internal.write;for(var n in t)r("/I"+(e=t[n]).index,e.objectId,"0","R")},a=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",s),this.internal.events.subscribe("putXobjectDict",i))},A=function(){var e=this.internal.collections.addImage_images;return a.call(this),e},u=function(){return Object.keys(this.internal.collections.addImage_images).length},d=function(t){return"function"==typeof e["process"+t.toUpperCase()]},f=function(e){return"object"==typeof e&&1===e.nodeType},h=function(t,r){if("IMG"===t.nodeName&&t.hasAttribute("src")){var n=""+t.getAttribute("src");if(0===n.indexOf("data:image/"))return c(unescape(n).split("base64,").pop());var o=e.loadFile(n,!0);if(void 0!==o)return o}if("CANVAS"===t.nodeName){var s;switch(r){case"PNG":s="image/png";break;case"WEBP":s="image/webp";break;case"JPEG":case"JPG":default:s="image/jpeg"}return c(t.toDataURL(s,1).split("base64,").pop())}},p=function(e){var t=this.internal.collections.addImage_images;if(t)for(var r in t)if(e===t[r].alias)return t[r]},m=function(e,t,r){return e||t||(e=-96,t=-96),e<0&&(e=-1*r.width*72/e/this.internal.scaleFactor),t<0&&(t=-1*r.height*72/t/this.internal.scaleFactor),0===e&&(e=t*r.width/r.height),0===t&&(t=e*r.height/r.width),[e,t]},g=function(e,t,r,n,o,s){var i=m.call(this,r,n,o),a=this.internal.getCoordinateString,u=this.internal.getVerticalCoordinateString,c=A.call(this);if(r=i[0],n=i[1],c[o.index]=o,s){s*=Math.PI/180;var l=Math.cos(s),d=Math.sin(s),f=function(e){return e.toFixed(4)},h=[f(l),f(d),f(-1*d),f(l),0,0,"cm"]}this.internal.write("q"),s?(this.internal.write([1,"0","0",1,a(e),u(t+n),"cm"].join(" ")),this.internal.write(h.join(" ")),this.internal.write([a(r),"0","0",a(n),"0","0","cm"].join(" "))):this.internal.write([a(r),"0","0",a(n),a(e),u(t+n),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+o.index+" Do"),this.internal.write("Q")},y=e.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};e.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var v=e.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},w=e.__addimage__.sHashCode=function(e){var t,r,n=0;if("string"==typeof e)for(r=e.length,t=0;t<r;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;else if(_(e))for(r=e.byteLength/2,t=0;t<r;t++)n=(n<<5)-n+e[t],n|=0;return n},b=e.__addimage__.validateStringAsBase64=function(e){(e=e||"").toString().trim();var t=!0;return 0===e.length&&(t=!1),e.length%4!=0&&(t=!1),!1===/^[A-Za-z0-9+/]+$/.test(e.substr(0,e.length-2))&&(t=!1),!1===/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(e.substr(-2))&&(t=!1),t},B=e.__addimage__.extractImageFromDataUrl=function(e){var t=(e=e||"").split("base64,"),r=null;if(2===t.length){var n=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(t[0]);Array.isArray(n)&&(r={mimeType:n[1],charset:n[2],data:t[1]})}return r},j=e.__addimage__.supportsArrayBuffer=function(){return"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array};e.__addimage__.isArrayBuffer=function(e){return j()&&e instanceof ArrayBuffer};var _=e.__addimage__.isArrayBufferView=function(e){return j()&&"undefined"!=typeof Uint32Array&&(e instanceof Int8Array||e instanceof Uint8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)},C=e.__addimage__.binaryStringToUint8Array=function(e){for(var t=e.length,r=new Uint8Array(t),n=0;n<t;n++)r[n]=e.charCodeAt(n);return r},x=e.__addimage__.arrayBufferToBinaryString=function(e){try{return c(l(String.fromCharCode.apply(null,e)))}catch(t){if("undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.reduce)return new Uint8Array(e).reduce((function(e,t){return e.push(String.fromCharCode(t)),e}),[]).join("")}};e.addImage=function(){var e,r,n,o,s,i,A,u,c;if("number"==typeof arguments[1]?(r=t,n=arguments[1],o=arguments[2],s=arguments[3],i=arguments[4],A=arguments[5],u=arguments[6],c=arguments[7]):(r=arguments[1],n=arguments[2],o=arguments[3],s=arguments[4],i=arguments[5],A=arguments[6],u=arguments[7],c=arguments[8]),"object"==typeof(e=arguments[0])&&!f(e)&&"imageData"in e){var l=e;e=l.imageData,r=l.format||r||t,n=l.x||n||0,o=l.y||o||0,s=l.w||l.width||s,i=l.h||l.height||i,A=l.alias||A,u=l.compression||u,c=l.rotation||l.angle||c}var d=this.internal.getFilters();if(void 0===u&&-1!==d.indexOf("FlateEncode")&&(u="SLOW"),isNaN(n)||isNaN(o))throw new Error("Invalid coordinates passed to jsPDF.addImage");a.call(this);var h=E.call(this,e,r,A,u);return g.call(this,n,o,s,i,h,c),this};var E=function(r,o,s,i){var a,A,c;if("string"==typeof r&&n(r)===t){r=unescape(r);var l=N(r,!1);(""!==l||void 0!==(l=e.loadFile(r,!0)))&&(r=l)}if(f(r)&&(r=h(r,o)),o=n(r,o),!d(o))throw new Error("addImage does not support files of type '"+o+"', please ensure that a plugin for '"+o+"' support is added.");if((null==(c=s)||0===c.length)&&(s=function(e){return"string"==typeof e||_(e)?w(e):null}(r)),(a=p.call(this,s))||(j()&&(r instanceof Uint8Array||(A=r,r=C(r))),a=this["process"+o.toUpperCase()](r,u.call(this),s,function(t){return t&&"string"==typeof t&&(t=t.toUpperCase()),t in e.image_compression?t:v.NONE}(i),A)),!a)throw new Error("An unknown error occurred whilst processing the image.");return a},N=e.__addimage__.convertBase64ToBinaryString=function(e,t){var r;t="boolean"!=typeof t||t;var n,o="";if("string"==typeof e){n=null!==(r=B(e))?r.data:e;try{o=c(n)}catch(e){if(t)throw b(n)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+e.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return o};e.getImageProperties=function(r){var o,s,i="";if(f(r)&&(r=h(r)),"string"==typeof r&&n(r)===t&&(""===(i=N(r,!1))&&(i=e.loadFile(r)||""),r=i),s=n(r),!d(s))throw new Error("addImage does not support files of type '"+s+"', please ensure that a plugin for '"+s+"' support is added.");if(!j()||r instanceof Uint8Array||(r=C(r)),!(o=this["process"+s.toUpperCase()](r)))throw new Error("An unknown error occurred whilst processing the image");return o.fileType=s,o}}(H.API),Be=H.API,je=function(e){if(void 0!==e&&""!=e)return!0},H.API.events.push(["addPage",function(e){this.internal.getPageInfo(e.pageNumber).pageContext.annotations=[]}]),Be.events.push(["putPage",function(e){for(var t,r,n,o=this.internal.getCoordinateString,s=this.internal.getVerticalCoordinateString,i=this.internal.getPageInfoByObjId(e.objId),a=e.pageContext.annotations,A=!1,u=0;u<a.length&&!A;u++)switch((t=a[u]).type){case"link":(je(t.options.url)||je(t.options.pageNumber))&&(A=!0);break;case"reference":case"text":case"freetext":A=!0}if(0!=A){this.internal.write("/Annots [");for(var c=0;c<a.length;c++){t=a[c];var l=this.internal.pdfEscape,d=this.internal.getEncryptor(e.objId);switch(t.type){case"reference":this.internal.write(" "+t.object.objId+" 0 R ");break;case"text":var f=this.internal.newAdditionalObject(),h=this.internal.newAdditionalObject(),p=this.internal.getEncryptor(f.objId),m=t.title||"Note";n="<</Type /Annot /Subtype /Text "+(r="/Rect ["+o(t.bounds.x)+" "+s(t.bounds.y+t.bounds.h)+" "+o(t.bounds.x+t.bounds.w)+" "+s(t.bounds.y)+"] ")+"/Contents ("+l(p(t.contents))+")",n+=" /Popup "+h.objId+" 0 R",n+=" /P "+i.objId+" 0 R",n+=" /T ("+l(p(m))+") >>",f.content=n;var g=f.objId+" 0 R";n="<</Type /Annot /Subtype /Popup "+(r="/Rect ["+o(t.bounds.x+30)+" "+s(t.bounds.y+t.bounds.h)+" "+o(t.bounds.x+t.bounds.w+30)+" "+s(t.bounds.y)+"] ")+" /Parent "+g,t.open&&(n+=" /Open true"),n+=" >>",h.content=n,this.internal.write(f.objId,"0 R",h.objId,"0 R");break;case"freetext":r="/Rect ["+o(t.bounds.x)+" "+s(t.bounds.y)+" "+o(t.bounds.x+t.bounds.w)+" "+s(t.bounds.y+t.bounds.h)+"] ";var y=t.color||"#000000";n="<</Type /Annot /Subtype /FreeText "+r+"/Contents ("+l(d(t.contents))+")",n+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+y+")",n+=" /Border [0 0 0]",n+=" >>",this.internal.write(n);break;case"link":if(t.options.name){var v=this.annotations._nameMap[t.options.name];t.options.pageNumber=v.page,t.options.top=v.y}else t.options.top||(t.options.top=0);if(r="/Rect ["+t.finalBounds.x+" "+t.finalBounds.y+" "+t.finalBounds.w+" "+t.finalBounds.h+"] ",n="",t.options.url)n="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /A <</S /URI /URI ("+l(d(t.options.url))+") >>";else if(t.options.pageNumber)switch(n="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(t.options.pageNumber).objId+" 0 R",t.options.magFactor=t.options.magFactor||"XYZ",t.options.magFactor){case"Fit":n+=" /Fit]";break;case"FitH":n+=" /FitH "+t.options.top+"]";break;case"FitV":t.options.left=t.options.left||0,n+=" /FitV "+t.options.left+"]";break;case"XYZ":default:var w=s(t.options.top);t.options.left=t.options.left||0,void 0===t.options.zoom&&(t.options.zoom=0),n+=" /XYZ "+t.options.left+" "+w+" "+t.options.zoom+"]"}""!=n&&(n+=" >>",this.internal.write(n))}}this.internal.write("]")}}]),Be.createAnnotation=function(e){var t=this.internal.getCurrentPageInfo();switch(e.type){case"link":this.link(e.bounds.x,e.bounds.y,e.bounds.w,e.bounds.h,e);break;case"text":case"freetext":t.pageContext.annotations.push(e)}},Be.link=function(e,t,r,n,o){var s=this.internal.getCurrentPageInfo(),i=this.internal.getCoordinateString,a=this.internal.getVerticalCoordinateString;s.pageContext.annotations.push({finalBounds:{x:i(e),y:a(t),w:i(e+r),h:a(t+n)},options:o,type:"link"})},Be.textWithLink=function(e,t,r,n){var o=this.getTextWidth(e),s=this.internal.getLineHeight()/this.internal.scaleFactor;return this.text(e,t,r,n),r+=.2*s,"center"===n.align&&(t-=o/2),"right"===n.align&&(t-=o),this.link(t,r-s,o,s,n),o},Be.getTextWidth=function(e){var t=this.internal.getFontSize();return this.getStringUnitWidth(e)*t/this.internal.scaleFactor},function(e){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},r={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},n={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},o=[1570,1571,1573,1575];e.__arabicParser__={};var s=e.__arabicParser__.isInArabicSubstitutionA=function(e){return void 0!==t[e.charCodeAt(0)]},i=e.__arabicParser__.isArabicLetter=function(e){return"string"==typeof e&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(e)},a=e.__arabicParser__.isArabicEndLetter=function(e){return i(e)&&s(e)&&t[e.charCodeAt(0)].length<=2},A=e.__arabicParser__.isArabicAlfLetter=function(e){return i(e)&&o.indexOf(e.charCodeAt(0))>=0};e.__arabicParser__.arabicLetterHasIsolatedForm=function(e){return i(e)&&s(e)&&t[e.charCodeAt(0)].length>=1};var u=e.__arabicParser__.arabicLetterHasFinalForm=function(e){return i(e)&&s(e)&&t[e.charCodeAt(0)].length>=2};e.__arabicParser__.arabicLetterHasInitialForm=function(e){return i(e)&&s(e)&&t[e.charCodeAt(0)].length>=3};var c=e.__arabicParser__.arabicLetterHasMedialForm=function(e){return i(e)&&s(e)&&4==t[e.charCodeAt(0)].length},l=e.__arabicParser__.resolveLigatures=function(e){var t=0,n=r,o="",s=0;for(t=0;t<e.length;t+=1)void 0!==n[e.charCodeAt(t)]?(s++,"number"==typeof(n=n[e.charCodeAt(t)])&&(o+=String.fromCharCode(n),n=r,s=0),t===e.length-1&&(n=r,o+=e.charAt(t-(s-1)),t-=s-1,s=0)):(n=r,o+=e.charAt(t-s),t-=s,s=0);return o};e.__arabicParser__.isArabicDiacritic=function(e){return void 0!==e&&void 0!==n[e.charCodeAt(0)]};var d=e.__arabicParser__.getCorrectForm=function(e,t,r){return i(e)?!1===s(e)?-1:!u(e)||!i(t)&&!i(r)||!i(r)&&a(t)||a(e)&&!i(t)||a(e)&&A(t)||a(e)&&a(t)?0:c(e)&&i(t)&&!a(t)&&i(r)&&u(r)?3:a(e)||!i(r)?1:2:-1},f=function(e){var r=0,n=0,o=0,s="",a="",A="",u=(e=e||"").split("\\s+"),c=[];for(r=0;r<u.length;r+=1){for(c.push(""),n=0;n<u[r].length;n+=1)s=u[r][n],a=u[r][n-1],A=u[r][n+1],i(s)?(o=d(s,a,A),c[r]+=-1!==o?String.fromCharCode(t[s.charCodeAt(0)][o]):s):c[r]+=s;c[r]=l(c[r])}return c.join(" ")},h=e.__arabicParser__.processArabic=e.processArabic=function(){var e,t="string"==typeof arguments[0]?arguments[0]:arguments[0].text,r=[];if(Array.isArray(t)){var n=0;for(r=[],n=0;n<t.length;n+=1)Array.isArray(t[n])?r.push([f(t[n][0]),t[n][1],t[n][2]]):r.push([f(t[n])]);e=r}else e=f(t);return"string"==typeof arguments[0]?e:(arguments[0].text=e,arguments[0])};e.events.push(["preProcessText",h])}(H.API),H.API.autoPrint=function(e){var t;switch((e=e||{}).variant=e.variant||"non-conform",e.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",(function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")})),this.internal.events.subscribe("putCatalog",(function(){this.internal.out("/OpenAction "+t+" 0 R")}))}return this},function(e){var t=function(){var e=void 0;Object.defineProperty(this,"pdf",{get:function(){return e},set:function(t){e=t}});var t=150;Object.defineProperty(this,"width",{get:function(){return t},set:function(e){t=isNaN(e)||!1===Number.isInteger(e)||e<0?150:e,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=t+1)}});var r=300;Object.defineProperty(this,"height",{get:function(){return r},set:function(e){r=isNaN(e)||!1===Number.isInteger(e)||e<0?300:e,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=r+1)}});var n=[];Object.defineProperty(this,"childNodes",{get:function(){return n},set:function(e){n=e}});var o={};Object.defineProperty(this,"style",{get:function(){return o},set:function(e){o=e}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(e,t){var r;if("2d"!==(e=e||"2d"))return null;for(r in t)this.pdf.context2d.hasOwnProperty(r)&&(this.pdf.context2d[r]=t[r]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},e.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(H.API),function(e){var t={left:0,top:0,bottom:0,right:0},r=!1,n=function(){void 0===this.internal.__cell__&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),o.call(this))},o=function(){this.internal.__cell__.lastCell=new s,this.internal.__cell__.pages=1},s=function(){var e=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return e},set:function(t){e=t}});var t=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return t},set:function(e){t=e}});var r=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return r},set:function(e){r=e}});var n=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return n},set:function(e){n=e}});var o=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return o},set:function(e){o=e}});var s=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return s},set:function(e){s=e}});var i=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return i},set:function(e){i=e}}),this};s.prototype.clone=function(){return new s(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},s.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},e.setHeaderFunction=function(e){return n.call(this),this.internal.__cell__.headerFunction="function"==typeof e?e:void 0,this},e.getTextDimensions=function(e,t){n.call(this);var r=(t=t||{}).fontSize||this.getFontSize(),o=t.font||this.getFont(),s=t.scaleFactor||this.internal.scaleFactor,i=0,a=0,A=0,u=this;if(!Array.isArray(e)&&"string"!=typeof e){if("number"!=typeof e)throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");e=String(e)}const c=t.maxWidth;c>0?"string"==typeof e?e=this.splitTextToSize(e,c):"[object Array]"===Object.prototype.toString.call(e)&&(e=e.reduce((function(e,t){return e.concat(u.splitTextToSize(t,c))}),[])):e=Array.isArray(e)?e:[e];for(var l=0;l<e.length;l++)i<(A=this.getStringUnitWidth(e[l],{font:o})*r)&&(i=A);return 0!==i&&(a=e.length),{w:i/=s,h:Math.max((a*r*this.getLineHeightFactor()-r*(this.getLineHeightFactor()-1))/s,0)}},e.cellAddPage=function(){n.call(this),this.addPage();var e=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new s(e.left,e.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var i=e.cell=function(){var e;e=arguments[0]instanceof s?arguments[0]:new s(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),n.call(this);var o=this.internal.__cell__.lastCell,i=this.internal.__cell__.padding,a=this.internal.__cell__.margins||t,A=this.internal.__cell__.tableHeaderRow,u=this.internal.__cell__.printHeaders;return void 0!==o.lineNumber&&(o.lineNumber===e.lineNumber?(e.x=(o.x||0)+(o.width||0),e.y=o.y||0):o.y+o.height+e.height+a.bottom>this.getPageHeight()?(this.cellAddPage(),e.y=a.top,u&&A&&(this.printHeaderRow(e.lineNumber,!0),e.y+=A[0].height)):e.y=o.y+o.height||e.y),void 0!==e.text[0]&&(this.rect(e.x,e.y,e.width,e.height,!0===r?"FD":void 0),"right"===e.align?this.text(e.text,e.x+e.width-i,e.y+i,{align:"right",baseline:"top"}):"center"===e.align?this.text(e.text,e.x+e.width/2,e.y+i,{align:"center",baseline:"top",maxWidth:e.width-i-i}):this.text(e.text,e.x+i,e.y+i,{align:"left",baseline:"top",maxWidth:e.width-i-i})),this.internal.__cell__.lastCell=e,this};e.table=function(e,r,A,u,c){if(n.call(this),!A)throw new Error("No data for PDF table.");var l,d,f,h,p=[],m=[],g=[],y={},v={},w=[],b=[],B=(c=c||{}).autoSize||!1,j=!1!==c.printHeaders,_=c.css&&void 0!==c.css["font-size"]?16*c.css["font-size"]:c.fontSize||12,C=c.margins||Object.assign({width:this.getPageWidth()},t),x="number"==typeof c.padding?c.padding:3,E=c.headerBackgroundColor||"#c8c8c8";if(o.call(this),this.internal.__cell__.printHeaders=j,this.internal.__cell__.margins=C,this.internal.__cell__.table_font_size=_,this.internal.__cell__.padding=x,this.internal.__cell__.headerBackgroundColor=E,this.setFontSize(_),null==u)m=p=Object.keys(A[0]),g=p.map((function(){return"left"}));else if(Array.isArray(u)&&"object"==typeof u[0])for(p=u.map((function(e){return e.name})),m=u.map((function(e){return e.prompt||e.name||""})),g=u.map((function(e){return e.align||"left"})),l=0;l<u.length;l+=1)v[u[l].name]=u[l].width*(19.049976/25.4);else Array.isArray(u)&&"string"==typeof u[0]&&(m=p=u,g=p.map((function(){return"left"})));if(B||Array.isArray(u)&&"string"==typeof u[0])for(l=0;l<p.length;l+=1){for(y[h=p[l]]=A.map((function(e){return e[h]})),this.setFont(void 0,"bold"),w.push(this.getTextDimensions(m[l],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),d=y[h],this.setFont(void 0,"normal"),f=0;f<d.length;f+=1)w.push(this.getTextDimensions(d[f],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);v[h]=Math.max.apply(null,w)+x+x,w=[]}if(j){var N={};for(l=0;l<p.length;l+=1)N[p[l]]={},N[p[l]].text=m[l],N[p[l]].align=g[l];var Q=a.call(this,N,v);b=p.map((function(t){return new s(e,r,v[t],Q,N[t].text,void 0,N[t].align)})),this.setTableHeaderRow(b),this.printHeaderRow(1,!1)}var F=u.reduce((function(e,t){return e[t.name]=t.align,e}),{});for(l=0;l<A.length;l+=1){var U=a.call(this,A[l],v);for(f=0;f<p.length;f+=1)i.call(this,new s(e,r,v[p[f]],U,A[l][p[f]],l+2,F[p[f]]))}return this.internal.__cell__.table_x=e,this.internal.__cell__.table_y=r,this};var a=function(e,t){var r=this.internal.__cell__.padding,n=this.internal.__cell__.table_font_size,o=this.internal.scaleFactor;return Object.keys(e).map((function(n){var o=e[n];return this.splitTextToSize(o.hasOwnProperty("text")?o.text:o,t[n]-r-r)}),this).map((function(e){return this.getLineHeightFactor()*e.length*n/o+r+r}),this).reduce((function(e,t){return Math.max(e,t)}),0)};e.setTableHeaderRow=function(e){n.call(this),this.internal.__cell__.tableHeaderRow=e},e.printHeaderRow=function(e,t){if(n.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var o;if(r=!0,"function"==typeof this.internal.__cell__.headerFunction){var a=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new s(a[0],a[1],a[2],a[3],void 0,-1)}this.setFont(void 0,"bold");for(var A=[],u=0;u<this.internal.__cell__.tableHeaderRow.length;u+=1)o=this.internal.__cell__.tableHeaderRow[u].clone(),t&&(o.y=this.internal.__cell__.margins.top||0,A.push(o)),o.lineNumber=e,this.setFillColor(this.internal.__cell__.headerBackgroundColor),i.call(this,o);A.length>0&&this.setTableHeaderRow(A),this.setFont(void 0,"normal"),r=!1}}(H.API);var xe={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},Ee=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],Ne=Ce(Ee),Qe=[100,200,300,400,500,600,700,800,900],Fe=Ce(Qe);function Ue(e){var t=e.family.replace(/"|'/g,"").toLowerCase(),r=function(e){return xe[e=e||"normal"]?e:"normal"}(e.style),n=function(e){if(!e)return 400;if("number"==typeof e)return e>=100&&e<=900&&e%100==0?e:400;if(/^\d00$/.test(e))return parseInt(e);switch(e){case"bold":return 700;case"normal":default:return 400}}(e.weight),o=function(e){return"number"==typeof Ne[e=e||"normal"]?e:"normal"}(e.stretch);return{family:t,style:r,weight:n,stretch:o,src:e.src||[],ref:e.ref||{name:t,style:[o,r,n].join(" ")}}}function Se(e,t,r,n){var o;for(o=r;o>=0&&o<t.length;o+=n)if(e[t[o]])return e[t[o]];for(o=r;o>=0&&o<t.length;o-=n)if(e[t[o]])return e[t[o]]}var Le={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},Te={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function He(e){return[e.stretch,e.style,e.weight,e.family].join(" ")}function Ie(e){return e.trimLeft()}function Pe(e,t){for(var r=0;r<e.length;){if(e.charAt(r)===t)return[e.substring(0,r),e.substring(r+1)];r+=1}return null}function Oe(e){var t=e.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return null===t?null:[t[0],e.substring(t[0].length)]}var ke,Re,Me,De=["times"];!function(e){var t,r,n,o,s,a,A,u,c,l=function(e){return e=e||{},this.isStrokeTransparent=e.isStrokeTransparent||!1,this.strokeOpacity=e.strokeOpacity||1,this.strokeStyle=e.strokeStyle||"#000000",this.fillStyle=e.fillStyle||"#000000",this.isFillTransparent=e.isFillTransparent||!1,this.fillOpacity=e.fillOpacity||1,this.font=e.font||"10px sans-serif",this.textBaseline=e.textBaseline||"alphabetic",this.textAlign=e.textAlign||"left",this.lineWidth=e.lineWidth||1,this.lineJoin=e.lineJoin||"miter",this.lineCap=e.lineCap||"butt",this.path=e.path||[],this.transform=void 0!==e.transform?e.transform.clone():new u,this.globalCompositeOperation=e.globalCompositeOperation||"normal",this.globalAlpha=e.globalAlpha||1,this.clip_path=e.clip_path||[],this.currentPoint=e.currentPoint||new a,this.miterLimit=e.miterLimit||10,this.lastPoint=e.lastPoint||new a,this.ignoreClearRect="boolean"!=typeof e.ignoreClearRect||e.ignoreClearRect,this};e.events.push(["initialized",function(){this.context2d=new d(this),t=this.internal.f2,r=this.internal.getCoordinateString,n=this.internal.getVerticalCoordinateString,o=this.internal.getHorizontalCoordinate,s=this.internal.getVerticalCoordinate,a=this.internal.Point,A=this.internal.Rectangle,u=this.internal.Matrix,c=new l}]);var d=function(e){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var t=e;Object.defineProperty(this,"pdf",{get:function(){return t}});var r=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return r},set:function(e){r=Boolean(e)}});var n=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return n},set:function(e){n=Boolean(e)}});var o=0;Object.defineProperty(this,"posX",{get:function(){return o},set:function(e){isNaN(e)||(o=e)}});var s=0;Object.defineProperty(this,"posY",{get:function(){return s},set:function(e){isNaN(e)||(s=e)}});var i=!1;Object.defineProperty(this,"autoPaging",{get:function(){return i},set:function(e){i=Boolean(e)}});var a=0;Object.defineProperty(this,"lastBreak",{get:function(){return a},set:function(e){a=e}});var A=[];Object.defineProperty(this,"pageBreaks",{get:function(){return A},set:function(e){A=e}}),Object.defineProperty(this,"ctx",{get:function(){return c},set:function(e){e instanceof l&&(c=e)}}),Object.defineProperty(this,"path",{get:function(){return c.path},set:function(e){c.path=e}});var u=[];Object.defineProperty(this,"ctxStack",{get:function(){return u},set:function(e){u=e}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(e){var t;t=h(e),this.ctx.fillStyle=t.style,this.ctx.isFillTransparent=0===t.a,this.ctx.fillOpacity=t.a,this.pdf.setFillColor(t.r,t.g,t.b,{a:t.a}),this.pdf.setTextColor(t.r,t.g,t.b,{a:t.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(e){var t=h(e);this.ctx.strokeStyle=t.style,this.ctx.isStrokeTransparent=0===t.a,this.ctx.strokeOpacity=t.a,0===t.a?this.pdf.setDrawColor(255,255,255):(t.a,this.pdf.setDrawColor(t.r,t.g,t.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(e){-1!==["butt","round","square"].indexOf(e)&&(this.ctx.lineCap=e,this.pdf.setLineCap(e))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(e){isNaN(e)||(this.ctx.lineWidth=e,this.pdf.setLineWidth(e))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(e){-1!==["bevel","round","miter"].indexOf(e)&&(this.ctx.lineJoin=e,this.pdf.setLineJoin(e))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(e){isNaN(e)||(this.ctx.miterLimit=e,this.pdf.setMiterLimit(e))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(e){this.ctx.textBaseline=e}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(e){-1!==["right","end","center","left","start"].indexOf(e)&&(this.ctx.textAlign=e)}});var d=null;function f(e,t){if(null===d){var r=function(e){var t=[];return Object.keys(e).forEach((function(r){e[r].forEach((function(e){var n=null;switch(e){case"bold":n={family:r,weight:"bold"};break;case"italic":n={family:r,style:"italic"};break;case"bolditalic":n={family:r,weight:"bold",style:"italic"};break;case"":case"normal":n={family:r}}null!==n&&(n.ref={name:r,style:e},t.push(n))}))})),t}(e.getFontList());d=function(e){for(var t={},r=0;r<e.length;++r){var n=Ue(e[r]),o=n.family,s=n.stretch,i=n.style,a=n.weight;t[o]=t[o]||{},t[o][s]=t[o][s]||{},t[o][s][i]=t[o][s][i]||{},t[o][s][i][a]=n}return t}(r.concat(t))}return d}var p=null;Object.defineProperty(this,"fontFaces",{get:function(){return p},set:function(e){d=null,p=e}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(e){var t;if(this.ctx.font=e,null!==(t=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(e))){var r=t[1],n=(t[2],t[3]),o=t[4],s=(t[5],t[6]),i=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(o)[2];o="px"===i?Math.floor(parseFloat(o)*this.pdf.internal.scaleFactor):"em"===i?Math.floor(parseFloat(o)*this.pdf.getFontSize()):Math.floor(parseFloat(o)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(o);var a=function(e){var t,r,n=[],o=e.trim();if(""===o)return De;if(o in Te)return[Te[o]];for(;""!==o;){switch(r=null,t=(o=Ie(o)).charAt(0)){case'"':case"'":r=Pe(o.substring(1),t);break;default:r=Oe(o)}if(null===r)return De;if(n.push(r[0]),""!==(o=Ie(r[1]))&&","!==o.charAt(0))return De;o=o.replace(/^,/,"")}return n}(s);if(this.fontFaces){var A=function(e,t,r){for(var n=(r=r||{}).defaultFontFamily||"times",o=Object.assign({},Le,r.genericFontFamilies||{}),s=null,i=null,a=0;a<t.length;++a)if(o[(s=Ue(t[a])).family]&&(s.family=o[s.family]),e.hasOwnProperty(s.family)){i=e[s.family];break}if(!(i=i||e[n]))throw new Error("Could not find a font-family for the rule '"+He(s)+"' and default family '"+n+"'.");if(i=function(e,t){if(t[e])return t[e];var r=Ne[e],n=r<=Ne.normal?-1:1,o=Se(t,Ee,r,n);if(!o)throw new Error("Could not find a matching font-stretch value for "+e);return o}(s.stretch,i),i=function(e,t){if(t[e])return t[e];for(var r=xe[e],n=0;n<r.length;++n)if(t[r[n]])return t[r[n]];throw new Error("Could not find a matching font-style for "+e)}(s.style,i),!(i=function(e,t){if(t[e])return t[e];if(400===e&&t[500])return t[500];if(500===e&&t[400])return t[400];var r=Fe[e],n=Se(t,Qe,r,e<400?-1:1);if(!n)throw new Error("Could not find a matching font-weight for value "+e);return n}(s.weight,i)))throw new Error("Failed to resolve a font for the rule '"+He(s)+"'.");return i}(f(this.pdf,this.fontFaces),a.map((function(e){return{family:e,stretch:"normal",weight:n,style:r}})));this.pdf.setFont(A.ref.name,A.ref.style)}else{var u="";("bold"===n||parseInt(n,10)>=700||"bold"===r)&&(u="bold"),"italic"===r&&(u+="italic"),0===u.length&&(u="normal");for(var c="",l={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},d=0;d<a.length;d++){if(void 0!==this.pdf.internal.getFont(a[d],u,{noFallback:!0,disableWarning:!0})){c=a[d];break}if("bolditalic"===u&&void 0!==this.pdf.internal.getFont(a[d],"bold",{noFallback:!0,disableWarning:!0}))c=a[d],u="bold";else if(void 0!==this.pdf.internal.getFont(a[d],"normal",{noFallback:!0,disableWarning:!0})){c=a[d],u="normal";break}}if(""===c)for(var h=0;h<a.length;h++)if(l[a[h]]){c=l[a[h]];break}c=""===c?"Times":c,this.pdf.setFont(c,u)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(e){this.ctx.globalCompositeOperation=e}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(e){this.ctx.globalAlpha=e}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(e){this.ctx.ignoreClearRect=Boolean(e)}})};d.prototype.fill=function(){b.call(this,"fill",!1)},d.prototype.stroke=function(){b.call(this,"stroke",!1)},d.prototype.beginPath=function(){this.path=[{type:"begin"}]},d.prototype.moveTo=function(e,t){if(isNaN(e)||isNaN(t))throw i.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var r=this.ctx.transform.applyToPoint(new a(e,t));this.path.push({type:"mt",x:r.x,y:r.y}),this.ctx.lastPoint=new a(e,t)},d.prototype.closePath=function(){var e=new a(0,0),t=0;for(t=this.path.length-1;-1!==t;t--)if("begin"===this.path[t].type&&"object"==typeof this.path[t+1]&&"number"==typeof this.path[t+1].x){e=new a(this.path[t+1].x,this.path[t+1].y),this.path.push({type:"lt",x:e.x,y:e.y});break}"object"==typeof this.path[t+2]&&"number"==typeof this.path[t+2].x&&this.path.push(JSON.parse(JSON.stringify(this.path[t+2]))),this.path.push({type:"close"}),this.ctx.lastPoint=new a(e.x,e.y)},d.prototype.lineTo=function(e,t){if(isNaN(e)||isNaN(t))throw i.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var r=this.ctx.transform.applyToPoint(new a(e,t));this.path.push({type:"lt",x:r.x,y:r.y}),this.ctx.lastPoint=new a(r.x,r.y)},d.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),b.call(this,null,!0)},d.prototype.quadraticCurveTo=function(e,t,r,n){if(isNaN(r)||isNaN(n)||isNaN(e)||isNaN(t))throw i.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var o=this.ctx.transform.applyToPoint(new a(r,n)),s=this.ctx.transform.applyToPoint(new a(e,t));this.path.push({type:"qct",x1:s.x,y1:s.y,x:o.x,y:o.y}),this.ctx.lastPoint=new a(o.x,o.y)},d.prototype.bezierCurveTo=function(e,t,r,n,o,s){if(isNaN(o)||isNaN(s)||isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n))throw i.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var A=this.ctx.transform.applyToPoint(new a(o,s)),u=this.ctx.transform.applyToPoint(new a(e,t)),c=this.ctx.transform.applyToPoint(new a(r,n));this.path.push({type:"bct",x1:u.x,y1:u.y,x2:c.x,y2:c.y,x:A.x,y:A.y}),this.ctx.lastPoint=new a(A.x,A.y)},d.prototype.arc=function(e,t,r,n,o,s){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n)||isNaN(o))throw i.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(s=Boolean(s),!this.ctx.transform.isIdentity){var A=this.ctx.transform.applyToPoint(new a(e,t));e=A.x,t=A.y;var u=this.ctx.transform.applyToPoint(new a(0,r)),c=this.ctx.transform.applyToPoint(new a(0,0));r=Math.sqrt(Math.pow(u.x-c.x,2)+Math.pow(u.y-c.y,2))}Math.abs(o-n)>=2*Math.PI&&(n=0,o=2*Math.PI),this.path.push({type:"arc",x:e,y:t,radius:r,startAngle:n,endAngle:o,counterclockwise:s})},d.prototype.arcTo=function(e,t,r,n,o){throw new Error("arcTo not implemented.")},d.prototype.rect=function(e,t,r,n){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n))throw i.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(e,t),this.lineTo(e+r,t),this.lineTo(e+r,t+n),this.lineTo(e,t+n),this.lineTo(e,t),this.lineTo(e+r,t),this.lineTo(e,t)},d.prototype.fillRect=function(e,t,r,n){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n))throw i.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!p.call(this)){var o={};"butt"!==this.lineCap&&(o.lineCap=this.lineCap,this.lineCap="butt"),"miter"!==this.lineJoin&&(o.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(e,t,r,n),this.fill(),o.hasOwnProperty("lineCap")&&(this.lineCap=o.lineCap),o.hasOwnProperty("lineJoin")&&(this.lineJoin=o.lineJoin)}},d.prototype.strokeRect=function(e,t,r,n){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n))throw i.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");m.call(this)||(this.beginPath(),this.rect(e,t,r,n),this.stroke())},d.prototype.clearRect=function(e,t,r,n){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n))throw i.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(e,t,r,n))},d.prototype.save=function(e){e="boolean"!=typeof e||e;for(var t=this.pdf.internal.getCurrentPageInfo().pageNumber,r=0;r<this.pdf.internal.getNumberOfPages();r++)this.pdf.setPage(r+1),this.pdf.internal.out("q");if(this.pdf.setPage(t),e){this.ctx.fontSize=this.pdf.internal.getFontSize();var n=new l(this.ctx);this.ctxStack.push(this.ctx),this.ctx=n}},d.prototype.restore=function(e){e="boolean"!=typeof e||e;for(var t=this.pdf.internal.getCurrentPageInfo().pageNumber,r=0;r<this.pdf.internal.getNumberOfPages();r++)this.pdf.setPage(r+1),this.pdf.internal.out("Q");this.pdf.setPage(t),e&&0!==this.ctxStack.length&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin)},d.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var h=function(e){var t,r,n,o;if(!0===e.isCanvasGradient&&(e=e.getColor()),!e)return{r:0,g:0,b:0,a:0,style:e};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(e))t=0,r=0,n=0,o=0;else{var s=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(e);if(null!==s)t=parseInt(s[1]),r=parseInt(s[2]),n=parseInt(s[3]),o=1;else if(null!==(s=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(e)))t=parseInt(s[1]),r=parseInt(s[2]),n=parseInt(s[3]),o=parseFloat(s[4]);else{if(o=1,"string"==typeof e&&"#"!==e.charAt(0)){var i=new f(e);e=i.ok?i.toHex():"#000000"}4===e.length?(t=e.substring(1,2),t+=t,r=e.substring(2,3),r+=r,n=e.substring(3,4),n+=n):(t=e.substring(1,3),r=e.substring(3,5),n=e.substring(5,7)),t=parseInt(t,16),r=parseInt(r,16),n=parseInt(n,16)}}return{r:t,g:r,b:n,a:o,style:e}},p=function(){return this.ctx.isFillTransparent||0==this.globalAlpha},m=function(){return Boolean(this.ctx.isStrokeTransparent||0==this.globalAlpha)};d.prototype.fillText=function(e,t,r,n){if(isNaN(t)||isNaN(r)||"string"!=typeof e)throw i.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(n=isNaN(n)?void 0:n,!p.call(this)){r=j.call(this,r);var o=T(this.ctx.transform.rotation),s=this.ctx.transform.scaleX;N.call(this,{text:e,x:t,y:r,scale:s,angle:o,align:this.textAlign,maxWidth:n})}},d.prototype.strokeText=function(e,t,r,n){if(isNaN(t)||isNaN(r)||"string"!=typeof e)throw i.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!m.call(this)){n=isNaN(n)?void 0:n,r=j.call(this,r);var o=T(this.ctx.transform.rotation),s=this.ctx.transform.scaleX;N.call(this,{text:e,x:t,y:r,scale:s,renderingMode:"stroke",angle:o,align:this.textAlign,maxWidth:n})}},d.prototype.measureText=function(e){if("string"!=typeof e)throw i.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var t=this.pdf,r=this.pdf.internal.scaleFactor,n=t.internal.getFontSize(),o=t.getStringUnitWidth(e)*n/t.internal.scaleFactor,s=function(e){var t=(e=e||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return t}}),this};return new s({width:o*=Math.round(96*r/72*1e4)/1e4})},d.prototype.scale=function(e,t){if(isNaN(e)||isNaN(t))throw i.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var r=new u(e,0,0,t,0,0);this.ctx.transform=this.ctx.transform.multiply(r)},d.prototype.rotate=function(e){if(isNaN(e))throw i.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var t=new u(Math.cos(e),Math.sin(e),-Math.sin(e),Math.cos(e),0,0);this.ctx.transform=this.ctx.transform.multiply(t)},d.prototype.translate=function(e,t){if(isNaN(e)||isNaN(t))throw i.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var r=new u(1,0,0,1,e,t);this.ctx.transform=this.ctx.transform.multiply(r)},d.prototype.transform=function(e,t,r,n,o,s){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n)||isNaN(o)||isNaN(s))throw i.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var a=new u(e,t,r,n,o,s);this.ctx.transform=this.ctx.transform.multiply(a)},d.prototype.setTransform=function(e,t,r,n,o,s){e=isNaN(e)?1:e,t=isNaN(t)?0:t,r=isNaN(r)?0:r,n=isNaN(n)?1:n,o=isNaN(o)?0:o,s=isNaN(s)?0:s,this.ctx.transform=new u(e,t,r,n,o,s)},d.prototype.drawImage=function(e,t,r,n,o,s,i,a,c){var l=this.pdf.getImageProperties(e),d=1,f=1,h=1,p=1;void 0!==n&&void 0!==a&&(h=a/n,p=c/o,d=l.width/n*a/n,f=l.height/o*c/o),void 0===s&&(s=t,i=r,t=0,r=0),void 0!==n&&void 0===a&&(a=n,c=o),void 0===n&&void 0===a&&(a=l.width,c=l.height);for(var m,y=this.ctx.transform.decompose(),b=T(y.rotate.shx),j=new u,_=(j=(j=(j=j.multiply(y.translate)).multiply(y.skew)).multiply(y.scale)).applyToRectangle(new A(s-t*h,i-r*p,n*d,o*f)),C=g.call(this,_),x=[],E=0;E<C.length;E+=1)-1===x.indexOf(C[E])&&x.push(C[E]);if(w(x),this.autoPaging)for(var N=x[0],Q=x[x.length-1],F=N;F<Q+1;F++){if(this.pdf.setPage(F),0!==this.ctx.clip_path.length){var U=this.path;m=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=v(m,this.posX,-1*this.pdf.internal.pageSize.height*(F-1)+this.posY),B.call(this,"fill",!0),this.path=U}var S=JSON.parse(JSON.stringify(_));S=v([S],this.posX,-1*this.pdf.internal.pageSize.height*(F-1)+this.posY)[0],this.pdf.addImage(e,"JPEG",S.x,S.y,S.w,S.h,null,null,b)}else this.pdf.addImage(e,"JPEG",_.x,_.y,_.w,_.h,null,null,b)};var g=function(e,t,r){var n=[];switch(t=t||this.pdf.internal.pageSize.width,r=r||this.pdf.internal.pageSize.height,e.type){default:case"mt":case"lt":n.push(Math.floor((e.y+this.posY)/r)+1);break;case"arc":n.push(Math.floor((e.y+this.posY-e.radius)/r)+1),n.push(Math.floor((e.y+this.posY+e.radius)/r)+1);break;case"qct":var o=H(this.ctx.lastPoint.x,this.ctx.lastPoint.y,e.x1,e.y1,e.x,e.y);n.push(Math.floor(o.y/r)+1),n.push(Math.floor((o.y+o.h)/r)+1);break;case"bct":var s=I(this.ctx.lastPoint.x,this.ctx.lastPoint.y,e.x1,e.y1,e.x2,e.y2,e.x,e.y);n.push(Math.floor(s.y/r)+1),n.push(Math.floor((s.y+s.h)/r)+1);break;case"rect":n.push(Math.floor((e.y+this.posY)/r)+1),n.push(Math.floor((e.y+e.h+this.posY)/r)+1)}for(var i=0;i<n.length;i+=1)for(;this.pdf.internal.getNumberOfPages()<n[i];)y.call(this);return n},y=function(){var e=this.fillStyle,t=this.strokeStyle,r=this.font,n=this.lineCap,o=this.lineWidth,s=this.lineJoin;this.pdf.addPage(),this.fillStyle=e,this.strokeStyle=t,this.font=r,this.lineCap=n,this.lineWidth=o,this.lineJoin=s},v=function(e,t,r){for(var n=0;n<e.length;n++)switch(e[n].type){case"bct":e[n].x2+=t,e[n].y2+=r;case"qct":e[n].x1+=t,e[n].y1+=r;case"mt":case"lt":case"arc":default:e[n].x+=t,e[n].y+=r}return e},w=function(e){return e.sort((function(e,t){return e-t}))},b=function(e,t){for(var r,n,o=this.fillStyle,s=this.strokeStyle,i=this.lineCap,a=this.lineWidth,A=a*this.ctx.transform.scaleX,u=this.lineJoin,c=JSON.parse(JSON.stringify(this.path)),l=JSON.parse(JSON.stringify(this.path)),d=[],f=0;f<l.length;f++)if(void 0!==l[f].x)for(var h=g.call(this,l[f]),p=0;p<h.length;p+=1)-1===d.indexOf(h[p])&&d.push(h[p]);for(var m=0;m<d.length;m++)for(;this.pdf.internal.getNumberOfPages()<d[m];)y.call(this);if(w(d),this.autoPaging)for(var b=d[0],j=d[d.length-1],_=b;_<j+1;_++){if(this.pdf.setPage(_),this.fillStyle=o,this.strokeStyle=s,this.lineCap=i,this.lineWidth=A,this.lineJoin=u,0!==this.ctx.clip_path.length){var C=this.path;r=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=v(r,this.posX,-1*this.pdf.internal.pageSize.height*(_-1)+this.posY),B.call(this,e,!0),this.path=C}n=JSON.parse(JSON.stringify(c)),this.path=v(n,this.posX,-1*this.pdf.internal.pageSize.height*(_-1)+this.posY),!1!==t&&0!==_||B.call(this,e,t),this.lineWidth=a}else this.lineWidth=A,B.call(this,e,t),this.lineWidth=a;this.path=c},B=function(e,t){if(("stroke"!==e||t||!m.call(this))&&("stroke"===e||t||!p.call(this))){for(var r,n,o=[],s=this.path,i=0;i<s.length;i++){var a=s[i];switch(a.type){case"begin":o.push({begin:!0});break;case"close":o.push({close:!0});break;case"mt":o.push({start:a,deltas:[],abs:[]});break;case"lt":var A=o.length;if(!isNaN(s[i-1].x)&&(r=[a.x-s[i-1].x,a.y-s[i-1].y],A>0))for(;A>=0;A--)if(!0!==o[A-1].close&&!0!==o[A-1].begin){o[A-1].deltas.push(r),o[A-1].abs.push(a);break}break;case"bct":r=[a.x1-s[i-1].x,a.y1-s[i-1].y,a.x2-s[i-1].x,a.y2-s[i-1].y,a.x-s[i-1].x,a.y-s[i-1].y],o[o.length-1].deltas.push(r);break;case"qct":var u=s[i-1].x+2/3*(a.x1-s[i-1].x),c=s[i-1].y+2/3*(a.y1-s[i-1].y),l=a.x+2/3*(a.x1-a.x),d=a.y+2/3*(a.y1-a.y),f=a.x,h=a.y;r=[u-s[i-1].x,c-s[i-1].y,l-s[i-1].x,d-s[i-1].y,f-s[i-1].x,h-s[i-1].y],o[o.length-1].deltas.push(r);break;case"arc":o.push({deltas:[],abs:[],arc:!0}),Array.isArray(o[o.length-1].abs)&&o[o.length-1].abs.push(a)}}n=t?null:"stroke"===e?"stroke":"fill";for(var g=0;g<o.length;g++){if(o[g].arc){for(var y=o[g].abs,v=0;v<y.length;v++){var w=y[v];"arc"===w.type?_.call(this,w.x,w.y,w.radius,w.startAngle,w.endAngle,w.counterclockwise,void 0,t):Q.call(this,w.x,w.y)}C.call(this,n),this.pdf.internal.out("h")}if(!o[g].arc&&!0!==o[g].close&&!0!==o[g].begin){var b=o[g].start.x,B=o[g].start.y;F.call(this,o[g].deltas,b,B)}}n&&C.call(this,n),t&&x.call(this)}},j=function(e){var t=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,r=t*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return e-r;case"top":return e+t-r;case"hanging":return e+t-2*r;case"middle":return e+t/2-r;case"ideographic":return e;case"alphabetic":default:return e}};d.prototype.createLinearGradient=function(){var e=function(){};return e.colorStops=[],e.addColorStop=function(e,t){this.colorStops.push([e,t])},e.getColor=function(){return 0===this.colorStops.length?"#000000":this.colorStops[0][1]},e.isCanvasGradient=!0,e},d.prototype.createPattern=function(){return this.createLinearGradient()},d.prototype.createRadialGradient=function(){return this.createLinearGradient()};var _=function(e,t,r,n,o,s,i,a){for(var A=S.call(this,r,n,o,s),u=0;u<A.length;u++){var c=A[u];0===u&&E.call(this,c.x1+e,c.y1+t),U.call(this,e,t,c.x2,c.y2,c.x3,c.y3,c.x4,c.y4)}a?x.call(this):C.call(this,i)},C=function(e){switch(e){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},x=function(){this.pdf.clip(),this.pdf.discardPath()},E=function(e,t){this.pdf.internal.out(r(e)+" "+n(t)+" m")},N=function(e){var t;switch(e.align){case"right":case"end":t="right";break;case"center":t="center";break;case"left":case"start":default:t="left"}var r=this.ctx.transform.applyToPoint(new a(e.x,e.y)),n=this.ctx.transform.decompose(),o=new u;o=(o=(o=o.multiply(n.translate)).multiply(n.skew)).multiply(n.scale);for(var s,i,c,l=this.pdf.getTextDimensions(e.text),d=this.ctx.transform.applyToRectangle(new A(e.x,e.y,l.w,l.h)),f=o.applyToRectangle(new A(e.x,e.y-l.h,l.w,l.h)),h=g.call(this,f),p=[],m=0;m<h.length;m+=1)-1===p.indexOf(h[m])&&p.push(h[m]);if(w(p),!0===this.autoPaging)for(var y=p[0],b=p[p.length-1],j=y;j<b+1;j++){if(this.pdf.setPage(j),0!==this.ctx.clip_path.length){var _=this.path;s=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=v(s,this.posX,-1*this.pdf.internal.pageSize.height*(j-1)+this.posY),B.call(this,"fill",!0),this.path=_}var C=JSON.parse(JSON.stringify(d));C=v([C],this.posX,-1*this.pdf.internal.pageSize.height*(j-1)+this.posY)[0],e.scale>=.01&&(i=this.pdf.internal.getFontSize(),this.pdf.setFontSize(i*e.scale),c=this.lineWidth,this.lineWidth=c*e.scale),this.pdf.text(e.text,C.x,C.y,{angle:e.angle,align:t,renderingMode:e.renderingMode,maxWidth:e.maxWidth}),e.scale>=.01&&(this.pdf.setFontSize(i),this.lineWidth=c)}else e.scale>=.01&&(i=this.pdf.internal.getFontSize(),this.pdf.setFontSize(i*e.scale),c=this.lineWidth,this.lineWidth=c*e.scale),this.pdf.text(e.text,r.x+this.posX,r.y+this.posY,{angle:e.angle,align:t,renderingMode:e.renderingMode,maxWidth:e.maxWidth}),e.scale>=.01&&(this.pdf.setFontSize(i),this.lineWidth=c)},Q=function(e,t,o,s){o=o||0,s=s||0,this.pdf.internal.out(r(e+o)+" "+n(t+s)+" l")},F=function(e,t,r){return this.pdf.lines(e,t,r,null,null)},U=function(e,r,n,i,a,A,u,c){this.pdf.internal.out([t(o(n+e)),t(s(i+r)),t(o(a+e)),t(s(A+r)),t(o(u+e)),t(s(c+r)),"c"].join(" "))},S=function(e,t,r,n){for(var o=2*Math.PI,s=Math.PI/2;t>r;)t-=o;var i=Math.abs(r-t);i<o&&n&&(i=o-i);for(var a=[],A=n?-1:1,u=t;i>1e-5;){var c=u+A*Math.min(i,s);a.push(L.call(this,e,u,c)),i-=Math.abs(c-u),u=c}return a},L=function(e,t,r){var n=(r-t)/2,o=e*Math.cos(n),s=e*Math.sin(n),i=o,a=-s,A=i*i+a*a,u=A+i*o+a*s,c=4/3*(Math.sqrt(2*A*u)-u)/(i*s-a*o),l=i-c*a,d=a+c*i,f=l,h=-d,p=n+t,m=Math.cos(p),g=Math.sin(p);return{x1:e*Math.cos(t),y1:e*Math.sin(t),x2:l*m-d*g,y2:l*g+d*m,x3:f*m-h*g,y3:f*g+h*m,x4:e*Math.cos(r),y4:e*Math.sin(r)}},T=function(e){return 180*e/Math.PI},H=function(e,t,r,n,o,s){var i=e+.5*(r-e),a=t+.5*(n-t),u=o+.5*(r-o),c=s+.5*(n-s),l=Math.min(e,o,i,u),d=Math.max(e,o,i,u),f=Math.min(t,s,a,c),h=Math.max(t,s,a,c);return new A(l,f,d-l,h-f)},I=function(e,t,r,n,o,s,i,a){var u,c,l,d,f,h,p,m,g,y,v,w,b,B,j=r-e,_=n-t,C=o-r,x=s-n,E=i-o,N=a-s;for(c=0;c<41;c++)g=(p=(l=e+(u=c/40)*j)+u*((f=r+u*C)-l))+u*(f+u*(o+u*E-f)-p),y=(m=(d=t+u*_)+u*((h=n+u*x)-d))+u*(h+u*(s+u*N-h)-m),0==c?(v=g,w=y,b=g,B=y):(v=Math.min(v,g),w=Math.min(w,y),b=Math.max(b,g),B=Math.max(B,y));return new A(Math.round(v),Math.round(w),Math.round(b-v),Math.round(B-w))}}(H.API),function(e){var t=function(e){var t,r,n,o,s,i,a,A,u,c;for(/[^\x00-\xFF]/.test(e),r=[],n=0,o=(e+=t="\0\0\0\0".slice(e.length%4||4)).length;o>n;n+=4)0!==(s=(e.charCodeAt(n)<<24)+(e.charCodeAt(n+1)<<16)+(e.charCodeAt(n+2)<<8)+e.charCodeAt(n+3))?(i=(s=((s=((s=((s=(s-(c=s%85))/85)-(u=s%85))/85)-(A=s%85))/85)-(a=s%85))/85)%85,r.push(i+33,a+33,A+33,u+33,c+33)):r.push(122);return function(e,t){for(var r=t;r>0;r--)e.pop()}(r,t.length),String.fromCharCode.apply(String,r)+"~>"},r=function(e){var t,r,n,o,s,i=String,a="length",A=255,u="charCodeAt",c="slice",l="replace";for(e[c](-2),e=e[c](0,-2)[l](/\s/g,"")[l]("z","!!!!!"),n=[],o=0,s=(e+=t="uuuuu"[c](e[a]%5||5))[a];s>o;o+=5)r=52200625*(e[u](o)-33)+614125*(e[u](o+1)-33)+7225*(e[u](o+2)-33)+85*(e[u](o+3)-33)+(e[u](o+4)-33),n.push(A&r>>24,A&r>>16,A&r>>8,A&r);return function(e,t){for(var r=t;r>0;r--)e.pop()}(n,t[a]),i.fromCharCode.apply(i,n)},o=function(e){var t=new RegExp(/^([0-9A-Fa-f]{2})+$/);if(-1!==(e=e.replace(/\s/g,"")).indexOf(">")&&(e=e.substr(0,e.indexOf(">"))),e.length%2&&(e+="0"),!1===t.test(e))return"";for(var r="",n=0;n<e.length;n+=2)r+=String.fromCharCode("0x"+(e[n]+e[n+1]));return r},s=function(e){for(var t=new Uint8Array(e.length),r=e.length;r--;)t[r]=e.charCodeAt(r);return(t=(0,n.zlibSync)(t)).reduce((function(e,t){return e+String.fromCharCode(t)}),"")};e.processDataByFilters=function(e,n){var i=0,a=e||"",A=[];for("string"==typeof(n=n||[])&&(n=[n]),i=0;i<n.length;i+=1)switch(n[i]){case"ASCII85Decode":case"/ASCII85Decode":a=r(a),A.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":a=t(a),A.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":a=o(a),A.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":a=a.split("").map((function(e){return("0"+e.charCodeAt().toString(16)).slice(-2)})).join("")+">",A.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":a=s(a),A.push("/FlateDecode");break;default:throw new Error('The filter: "'+n[i]+'" is not implemented')}return{data:a,reverseChain:A.reverse().join(" ")}}}(H.API),function(e){e.loadFile=function(e,t,r){return function(e,t,r){t=!1!==t,r="function"==typeof r?r:function(){};var n=void 0;try{n=function(e,t,r){var n=new XMLHttpRequest,o=0,s=function(e){var t=e.length,r=[],n=String.fromCharCode;for(o=0;o<t;o+=1)r.push(n(255&e.charCodeAt(o)));return r.join("")};if(n.open("GET",e,!t),n.overrideMimeType("text/plain; charset=x-user-defined"),!1===t&&(n.onload=function(){200===n.status?r(s(this.responseText)):r(void 0)}),n.send(null),t&&200===n.status)return s(n.responseText)}(e,t,r)}catch(e){}return n}(e,t,r)},e.loadImageFile=e.loadFile}(H.API),function(e){function t(){return(o.html2canvas?Promise.resolve(o.html2canvas):Promise.resolve().then(r.t.bind(r,"./node_modules/html2canvas/dist/html2canvas.js",23))).catch((function(e){return Promise.reject(new Error("Could not load html2canvas: "+e))})).then((function(e){return e.default?e.default:e}))}function n(){return(o.DOMPurify?Promise.resolve(o.DOMPurify):Promise.resolve().then(r.t.bind(r,"./node_modules/dompurify/dist/purify.js",23))).catch((function(e){return Promise.reject(new Error("Could not load dompurify: "+e))})).then((function(e){return e.default?e.default:e}))}var s=function(e){var t=typeof e;return"undefined"===t?"undefined":"string"===t||e instanceof String?"string":"number"===t||e instanceof Number?"number":"function"===t||e instanceof Function?"function":e&&e.constructor===Array?"array":e&&1===e.nodeType?"element":"object"===t?"object":"unknown"},i=function(e,t){var r=document.createElement(e);for(var n in t.className&&(r.className=t.className),t.innerHTML&&t.dompurify&&(r.innerHTML=t.dompurify.sanitize(t.innerHTML)),t.style)r.style[n]=t.style[n];return r},a=function(e,t){for(var r=3===e.nodeType?document.createTextNode(e.nodeValue):e.cloneNode(!1),n=e.firstChild;n;n=n.nextSibling)!0!==t&&1===n.nodeType&&"SCRIPT"===n.nodeName||r.appendChild(a(n,t));return 1===e.nodeType&&("CANVAS"===e.nodeName?(r.width=e.width,r.height=e.height,r.getContext("2d").drawImage(e,0,0)):"TEXTAREA"!==e.nodeName&&"SELECT"!==e.nodeName||(r.value=e.value),r.addEventListener("load",(function(){r.scrollTop=e.scrollTop,r.scrollLeft=e.scrollLeft}),!0)),r},A=function e(t){var r=Object.assign(e.convert(Promise.resolve()),JSON.parse(JSON.stringify(e.template))),n=e.convert(Promise.resolve(),r);return(n=n.setProgress(1,e,1,[e])).set(t)};(A.prototype=Object.create(Promise.prototype)).constructor=A,A.convert=function(e,t){return e.__proto__=t||A.prototype,e},A.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},A.prototype.from=function(e,t){return this.then((function(){switch(t=t||function(e){switch(s(e)){case"string":return"string";case"element":return"canvas"===e.nodeName.toLowerCase()?"canvas":"element";default:return"unknown"}}(e)){case"string":return this.then(n).then((function(t){return this.set({src:i("div",{innerHTML:e,dompurify:t})})}));case"element":return this.set({src:e});case"canvas":return this.set({canvas:e});case"img":return this.set({img:e});default:return this.error("Unknown source type.")}}))},A.prototype.to=function(e){switch(e){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},A.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then((function(){var e={position:"relative",display:"inline-block",width:Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},t=a(this.prop.src,this.opt.html2canvas.javascriptEnabled);"BODY"===t.tagName&&(e.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=i("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=i("div",{className:"html2pdf__container",style:e}),this.prop.container.appendChild(t),this.prop.container.firstChild.appendChild(i("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"}))},A.prototype.toCanvas=function(){var e=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(e).then(t).then((function(e){var t=Object.assign({},this.opt.html2canvas);return delete t.onrendered,e(this.prop.container,t)})).then((function(e){(this.opt.html2canvas.onrendered||function(){})(e),this.prop.canvas=e,document.body.removeChild(this.prop.overlay)}))},A.prototype.toContext2d=function(){var e=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(e).then(t).then((function(e){var t=this.opt.jsPDF,r=this.opt.fontFaces,n=Object.assign({async:!0,allowTaint:!0,scale:1,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete n.onrendered,t.context2d.autoPaging=!0,t.context2d.posX=this.opt.x,t.context2d.posY=this.opt.y,t.context2d.fontFaces=r,r)for(var o=0;o<r.length;++o){var s=r[o],i=s.src.find((function(e){return"truetype"===e.format}));i&&t.addFont(i.url,s.ref.name,s.ref.style)}return n.windowHeight=n.windowHeight||0,n.windowHeight=0==n.windowHeight?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):n.windowHeight,e(this.prop.container,n)})).then((function(e){(this.opt.html2canvas.onrendered||function(){})(e),this.prop.canvas=e,document.body.removeChild(this.prop.overlay)}))},A.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then((function(){var e=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=e}))},A.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then((function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF}))},A.prototype.output=function(e,t,r){return"img"===(r=r||"pdf").toLowerCase()||"image"===r.toLowerCase()?this.outputImg(e,t):this.outputPdf(e,t)},A.prototype.outputPdf=function(e,t){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then((function(){return this.prop.pdf.output(e,t)}))},A.prototype.outputImg=function(e){return this.thenList([function(){return this.prop.img||this.toImg()}]).then((function(){switch(e){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+e+'" is not supported.'}}))},A.prototype.save=function(e){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(e?{filename:e}:null).then((function(){this.prop.pdf.save(this.opt.filename)}))},A.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then((function(){this.prop.callback(this.prop.pdf)}))},A.prototype.set=function(e){if("object"!==s(e))return this;var t=Object.keys(e||{}).map((function(t){if(t in A.template.prop)return function(){this.prop[t]=e[t]};switch(t){case"margin":return this.setMargin.bind(this,e.margin);case"jsPDF":return function(){return this.opt.jsPDF=e.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,e.pageSize);default:return function(){this.opt[t]=e[t]}}}),this);return this.then((function(){return this.thenList(t)}))},A.prototype.get=function(e,t){return this.then((function(){var r=e in A.template.prop?this.prop[e]:this.opt[e];return t?t(r):r}))},A.prototype.setMargin=function(e){return this.then((function(){switch(s(e)){case"number":e=[e,e,e,e];case"array":if(2===e.length&&(e=[e[0],e[1],e[0],e[1]]),4===e.length)break;default:return this.error("Invalid margin array.")}this.opt.margin=e})).then(this.setPageSize)},A.prototype.setPageSize=function(e){function t(e,t){return Math.floor(e*t/72*96)}return this.then((function(){(e=e||H.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(e.inner={width:e.width-this.opt.margin[1]-this.opt.margin[3],height:e.height-this.opt.margin[0]-this.opt.margin[2]},e.inner.px={width:t(e.inner.width,e.k),height:t(e.inner.height,e.k)},e.inner.ratio=e.inner.height/e.inner.width),this.prop.pageSize=e}))},A.prototype.setProgress=function(e,t,r,n){return null!=e&&(this.progress.val=e),null!=t&&(this.progress.state=t),null!=r&&(this.progress.n=r),null!=n&&(this.progress.stack=n),this.progress.ratio=this.progress.val/this.progress.state,this},A.prototype.updateProgress=function(e,t,r,n){return this.setProgress(e?this.progress.val+e:null,t||null,r?this.progress.n+r:null,n?this.progress.stack.concat(n):null)},A.prototype.then=function(e,t){var r=this;return this.thenCore(e,t,(function(e,t){return r.updateProgress(null,null,1,[e]),Promise.prototype.then.call(this,(function(t){return r.updateProgress(null,e),t})).then(e,t).then((function(e){return r.updateProgress(1),e}))}))},A.prototype.thenCore=function(e,t,r){r=r||Promise.prototype.then,e&&(e=e.bind(this)),t&&(t=t.bind(this));var n=-1!==Promise.toString().indexOf("[native code]")&&"Promise"===Promise.name?this:A.convert(Object.assign({},this),Promise.prototype),o=r.call(n,e,t);return A.convert(o,this.__proto__)},A.prototype.thenExternal=function(e,t){return Promise.prototype.then.call(this,e,t)},A.prototype.thenList=function(e){var t=this;return e.forEach((function(e){t=t.thenCore(e)})),t},A.prototype.catch=function(e){e&&(e=e.bind(this));var t=Promise.prototype.catch.call(this,e);return A.convert(t,this)},A.prototype.catchExternal=function(e){return Promise.prototype.catch.call(this,e)},A.prototype.error=function(e){return this.then((function(){throw new Error(e)}))},A.prototype.using=A.prototype.set,A.prototype.saveAs=A.prototype.save,A.prototype.export=A.prototype.output,A.prototype.run=A.prototype.then,H.getPageSize=function(e,t,r){if("object"==typeof e){var n=e;e=n.orientation,t=n.unit||t,r=n.format||r}t=t||"mm",r=r||"a4",e=(""+(e||"P")).toLowerCase();var o,s=(""+r).toLowerCase(),i={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(t){case"pt":o=1;break;case"mm":o=72/25.4;break;case"cm":o=72/2.54;break;case"in":o=72;break;case"px":o=.75;break;case"pc":case"em":o=12;break;case"ex":o=6;break;default:throw"Invalid unit: "+t}var a,A=0,u=0;if(i.hasOwnProperty(s))A=i[s][1]/o,u=i[s][0]/o;else try{A=r[1],u=r[0]}catch(e){throw new Error("Invalid format: "+r)}if("p"===e||"portrait"===e)e="p",u>A&&(a=u,u=A,A=a);else{if("l"!==e&&"landscape"!==e)throw"Invalid orientation: "+e;e="l",A>u&&(a=u,u=A,A=a)}return{width:u,height:A,unit:t,k:o,orientation:e}},e.html=function(e,t){(t=t||{}).callback=t.callback||function(){},t.html2canvas=t.html2canvas||{},t.html2canvas.canvas=t.html2canvas.canvas||this.canvas,t.jsPDF=t.jsPDF||this,t.fontFaces=t.fontFaces?t.fontFaces.map(Ue):null;var r=new A(t);return t.worker?r:r.from(e).doCallback()}}(H.API),H.API.addJS=function(e){return Me=e,this.internal.events.subscribe("postPutResources",(function(){ke=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(ke+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),Re=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+Me+")"),this.internal.out(">>"),this.internal.out("endobj")})),this.internal.events.subscribe("putCatalog",(function(){void 0!==ke&&void 0!==Re&&this.internal.out("/Names <</JavaScript "+ke+" 0 R>>")})),this},function(e){var t;e.events.push(["postPutResources",function(){var e=this,r=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var n=e.outline.render().split(/\r\n/),o=0;o<n.length;o++){var s=n[o],i=r.exec(s);if(null!=i){var a=i[1];e.internal.newObjectDeferredBegin(a,!1)}e.internal.write(s)}if(this.outline.createNamedDestinations){var A=this.internal.pages.length,u=[];for(o=0;o<A;o++){var c=e.internal.newObject();u.push(c);var l=e.internal.getPageInfo(o+1);e.internal.write("<< /D["+l.objId+" 0 R /XYZ null null null]>> endobj")}var d=e.internal.newObject();for(e.internal.write("<< /Names [ "),o=0;o<u.length;o++)e.internal.write("(page_"+(o+1)+")"+u[o]+" 0 R");e.internal.write(" ] >>","endobj"),t=e.internal.newObject(),e.internal.write("<< /Dests "+d+" 0 R"),e.internal.write(">>","endobj")}}]),e.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+t+" 0 R"))}]),e.events.push(["initialized",function(){var e=this;e.outline={createNamedDestinations:!1,root:{children:[]}},e.outline.add=function(e,t,r){var n={title:t,options:r,children:[]};return null==e&&(e=this.root),e.children.push(n),n},e.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=e,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},e.outline.genIds_r=function(t){t.id=e.internal.newObjectDeferred();for(var r=0;r<t.children.length;r++)this.genIds_r(t.children[r])},e.outline.renderRoot=function(e){this.objStart(e),this.line("/Type /Outlines"),e.children.length>0&&(this.line("/First "+this.makeRef(e.children[0])),this.line("/Last "+this.makeRef(e.children[e.children.length-1]))),this.line("/Count "+this.count_r({count:0},e)),this.objEnd()},e.outline.renderItems=function(t){for(var r=this.ctx.pdf.internal.getVerticalCoordinateString,n=0;n<t.children.length;n++){var o=t.children[n];this.objStart(o),this.line("/Title "+this.makeString(o.title)),this.line("/Parent "+this.makeRef(t)),n>0&&this.line("/Prev "+this.makeRef(t.children[n-1])),n<t.children.length-1&&this.line("/Next "+this.makeRef(t.children[n+1])),o.children.length>0&&(this.line("/First "+this.makeRef(o.children[0])),this.line("/Last "+this.makeRef(o.children[o.children.length-1])));var s=this.count=this.count_r({count:0},o);if(s>0&&this.line("/Count "+s),o.options&&o.options.pageNumber){var i=e.internal.getPageInfo(o.options.pageNumber);this.line("/Dest ["+i.objId+" 0 R /XYZ 0 "+r(0)+" 0]")}this.objEnd()}for(var a=0;a<t.children.length;a++)this.renderItems(t.children[a])},e.outline.line=function(e){this.ctx.val+=e+"\r\n"},e.outline.makeRef=function(e){return e.id+" 0 R"},e.outline.makeString=function(t){return"("+e.internal.pdfEscape(t)+")"},e.outline.objStart=function(e){this.ctx.val+="\r\n"+e.id+" 0 obj\r\n<<\r\n"},e.outline.objEnd=function(){this.ctx.val+=">> \r\nendobj\r\n"},e.outline.count_r=function(e,t){for(var r=0;r<t.children.length;r++)e.count++,this.count_r(e,t.children[r]);return e.count}}])}(H.API),function(e){var t=[192,193,194,195,196,197,198,199];e.processJPEG=function(e,r,n,o,s,i){var a,A=this.decode.DCT_DECODE,u=null;if("string"==typeof e||this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e)){switch(e=s||e,e=this.__addimage__.isArrayBuffer(e)?new Uint8Array(e):e,(a=function(e){for(var r,n=256*e.charCodeAt(4)+e.charCodeAt(5),o=e.length,s={width:0,height:0,numcomponents:1},i=4;i<o;i+=2){if(i+=n,-1!==t.indexOf(e.charCodeAt(i+1))){r=256*e.charCodeAt(i+5)+e.charCodeAt(i+6),s={width:256*e.charCodeAt(i+7)+e.charCodeAt(i+8),height:r,numcomponents:e.charCodeAt(i+9)};break}n=256*e.charCodeAt(i+2)+e.charCodeAt(i+3)}return s}(e=this.__addimage__.isArrayBufferView(e)?this.__addimage__.arrayBufferToBinaryString(e):e)).numcomponents){case 1:i=this.color_spaces.DEVICE_GRAY;break;case 4:i=this.color_spaces.DEVICE_CMYK;break;case 3:i=this.color_spaces.DEVICE_RGB}u={data:e,width:a.width,height:a.height,colorSpace:i,bitsPerComponent:8,filter:A,index:r,alias:n}}return u}}(H.API);var Ke,ze,Ve,qe,Ge,Xe=function(){var e,t,r;function s(e){var t,r,n,o,s,i,a,A,u,c,l,d,f,h;for(this.data=e,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},i=null;;){switch(t=this.readUInt32(),u=function(){var e,t;for(t=[],e=0;e<4;++e)t.push(String.fromCharCode(this.data[this.pos++]));return t}.call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(t);break;case"fcTL":i&&this.animation.frames.push(i),this.pos+=4,i={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},s=this.readUInt16(),o=this.readUInt16()||100,i.delay=1e3*s/o,i.disposeOp=this.data[this.pos++],i.blendOp=this.data[this.pos++],i.data=[];break;case"IDAT":case"fdAT":for("fdAT"===u&&(this.pos+=4,t-=4),e=(null!=i?i.data:void 0)||this.imgData,d=0;0<=t?d<t:d>t;0<=t?++d:--d)e.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(n=this.palette.length/3,this.transparency.indexed=this.read(t),this.transparency.indexed.length>n)throw new Error("More transparent colors than palette size");if((c=n-this.transparency.indexed.length)>0)for(f=0;0<=c?f<c:f>c;0<=c?++f:--f)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(t)[0];break;case 2:this.transparency.rgb=this.read(t)}break;case"tEXt":a=(l=this.read(t)).indexOf(0),A=String.fromCharCode.apply(String,l.slice(0,a)),this.text[A]=String.fromCharCode.apply(String,l.slice(a+1));break;case"IEND":return i&&this.animation.frames.push(i),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=4===(h=this.colorType)||6===h,r=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*r,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=t}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}s.prototype.read=function(e){var t,r;for(r=[],t=0;0<=e?t<e:t>e;0<=e?++t:--t)r.push(this.data[this.pos++]);return r},s.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},s.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},s.prototype.decodePixels=function(e){var t=this.pixelBitlength/8,r=new Uint8Array(this.width*this.height*t),o=0,s=this;if(null==e&&(e=this.imgData),0===e.length)return new Uint8Array(0);function i(n,i,a,A){var u,c,l,d,f,h,p,m,g,y,v,w,b,B,j,_,C,x,E,N,Q,F=Math.ceil((s.width-n)/a),U=Math.ceil((s.height-i)/A),S=s.width==F&&s.height==U;for(B=t*F,w=S?r:new Uint8Array(B*U),h=e.length,b=0,c=0;b<U&&o<h;){switch(e[o++]){case 0:for(d=C=0;C<B;d=C+=1)w[c++]=e[o++];break;case 1:for(d=x=0;x<B;d=x+=1)u=e[o++],f=d<t?0:w[c-t],w[c++]=(u+f)%256;break;case 2:for(d=E=0;E<B;d=E+=1)u=e[o++],l=(d-d%t)/t,j=b&&w[(b-1)*B+l*t+d%t],w[c++]=(j+u)%256;break;case 3:for(d=N=0;N<B;d=N+=1)u=e[o++],l=(d-d%t)/t,f=d<t?0:w[c-t],j=b&&w[(b-1)*B+l*t+d%t],w[c++]=(u+Math.floor((f+j)/2))%256;break;case 4:for(d=Q=0;Q<B;d=Q+=1)u=e[o++],l=(d-d%t)/t,f=d<t?0:w[c-t],0===b?j=_=0:(j=w[(b-1)*B+l*t+d%t],_=l&&w[(b-1)*B+(l-1)*t+d%t]),p=f+j-_,m=Math.abs(p-f),y=Math.abs(p-j),v=Math.abs(p-_),g=m<=y&&m<=v?f:y<=v?j:_,w[c++]=(u+g)%256;break;default:throw new Error("Invalid filter algorithm: "+e[o-1])}if(!S){var L=((i+b*A)*s.width+n)*t,T=b*B;for(d=0;d<F;d+=1){for(var H=0;H<t;H+=1)r[L++]=w[T++];L+=(a-1)*t}}b++}}return e=(0,n.unzlibSync)(e),1==s.interlaceMethod?(i(0,0,8,8),i(4,0,8,8),i(0,4,4,8),i(2,0,4,4),i(0,2,2,4),i(1,0,2,2),i(0,1,1,2)):i(0,0,1,1),r},s.prototype.decodePalette=function(){var e,t,r,n,o,s,i,a,A;for(r=this.palette,s=this.transparency.indexed||[],o=new Uint8Array((s.length||0)+r.length),n=0,e=0,t=i=0,a=r.length;i<a;t=i+=3)o[n++]=r[t],o[n++]=r[t+1],o[n++]=r[t+2],o[n++]=null!=(A=s[e++])?A:255;return o},s.prototype.copyToImageData=function(e,t){var r,n,o,s,i,a,A,u,c,l,d;if(n=this.colors,c=null,r=this.hasAlphaChannel,this.palette.length&&(c=null!=(d=this._decodedPalette)?d:this._decodedPalette=this.decodePalette(),n=4,r=!0),u=(o=e.data||e).length,i=c||t,s=a=0,1===n)for(;s<u;)A=c?4*t[s/4]:a,l=i[A++],o[s++]=l,o[s++]=l,o[s++]=l,o[s++]=r?i[A++]:255,a=A;else for(;s<u;)A=c?4*t[s/4]:a,o[s++]=i[A++],o[s++]=i[A++],o[s++]=i[A++],o[s++]=r?i[A++]:255,a=A},s.prototype.decode=function(){var e;return e=new Uint8Array(this.width*this.height*4),this.copyToImageData(e,this.decodePixels()),e};var i=function(){if("[object Window]"===Object.prototype.toString.call(o)){try{t=o.document.createElement("canvas"),r=t.getContext("2d")}catch(e){return!1}return!0}return!1};return i(),e=function(e){var n;if(!0===i())return r.width=e.width,r.height=e.height,r.clearRect(0,0,e.width,e.height),r.putImageData(e,0,0),(n=new Image).src=t.toDataURL(),n;throw new Error("This method requires a Browser with Canvas-capability.")},s.prototype.decodeFrames=function(t){var r,n,o,s,i,a,A,u;if(this.animation){for(u=[],n=i=0,a=(A=this.animation.frames).length;i<a;n=++i)r=A[n],o=t.createImageData(r.width,r.height),s=this.decodePixels(new Uint8Array(r.data)),this.copyToImageData(o,s),r.imageData=o,u.push(r.image=e(o));return u}},s.prototype.renderFrame=function(e,t){var r,n,o;return r=(n=this.animation.frames)[t],o=n[t-1],0===t&&e.clearRect(0,0,this.width,this.height),1===(null!=o?o.disposeOp:void 0)?e.clearRect(o.xOffset,o.yOffset,o.width,o.height):2===(null!=o?o.disposeOp:void 0)&&e.putImageData(o.imageData,o.xOffset,o.yOffset),0===r.blendOp&&e.clearRect(r.xOffset,r.yOffset,r.width,r.height),e.drawImage(r.image,r.xOffset,r.yOffset)},s.prototype.animate=function(e){var t,r,n,o,s,i,a=this;return r=0,i=this.animation,o=i.numFrames,n=i.frames,s=i.numPlays,(t=function(){var i,A;if(i=r++%o,A=n[i],a.renderFrame(e,i),o>1&&r/o<s)return a.animation._timeout=setTimeout(t,A.delay)})()},s.prototype.stopAnimation=function(){var e;return clearTimeout(null!=(e=this.animation)?e._timeout:void 0)},s.prototype.render=function(e){var t,r;return e._png&&e._png.stopAnimation(),e._png=this,e.width=this.width,e.height=this.height,t=e.getContext("2d"),this.animation?(this.decodeFrames(t),this.animate(t)):(r=t.createImageData(this.width,this.height),this.copyToImageData(r,this.decodePixels()),t.putImageData(r,0,0))},s}();function We(e){var t=0;if(71!==e[t++]||73!==e[t++]||70!==e[t++]||56!==e[t++]||56!=(e[t++]+1&253)||97!==e[t++])throw new Error("Invalid GIF 87a/89a header.");var r=e[t++]|e[t++]<<8,n=e[t++]|e[t++]<<8,o=e[t++],s=o>>7,i=1<<1+(7&o);e[t++],e[t++];var a=null,A=null;s&&(a=t,A=i,t+=3*i);var u=!0,c=[],l=0,d=null,f=0,h=null;for(this.width=r,this.height=n;u&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(11!==e[t]||78==e[t+1]&&69==e[t+2]&&84==e[t+3]&&83==e[t+4]&&67==e[t+5]&&65==e[t+6]&&80==e[t+7]&&69==e[t+8]&&50==e[t+9]&&46==e[t+10]&&48==e[t+11]&&3==e[t+12]&&1==e[t+13]&&0==e[t+16])t+=14,h=e[t++]|e[t++]<<8,t++;else for(t+=12;;){if(!((E=e[t++])>=0))throw Error("Invalid block size");if(0===E)break;t+=E}break;case 249:if(4!==e[t++]||0!==e[t+4])throw new Error("Invalid graphics extension block.");var p=e[t++];l=e[t++]|e[t++]<<8,d=e[t++],0==(1&p)&&(d=null),f=p>>2&7,t++;break;case 254:for(;;){if(!((E=e[t++])>=0))throw Error("Invalid block size");if(0===E)break;t+=E}break;default:throw new Error("Unknown graphic control label: 0x"+e[t-1].toString(16))}break;case 44:var m=e[t++]|e[t++]<<8,g=e[t++]|e[t++]<<8,y=e[t++]|e[t++]<<8,v=e[t++]|e[t++]<<8,w=e[t++],b=w>>6&1,B=1<<1+(7&w),j=a,_=A,C=!1;w>>7&&(C=!0,j=t,_=B,t+=3*B);var x=t;for(t++;;){var E;if(!((E=e[t++])>=0))throw Error("Invalid block size");if(0===E)break;t+=E}c.push({x:m,y:g,width:y,height:v,has_local_palette:C,palette_offset:j,palette_size:_,data_offset:x,data_length:t-x,transparent_index:d,interlaced:!!b,delay:l,disposal:f});break;case 59:u=!1;break;default:throw new Error("Unknown gif block: 0x"+e[t-1].toString(16))}this.numFrames=function(){return c.length},this.loopCount=function(){return h},this.frameInfo=function(e){if(e<0||e>=c.length)throw new Error("Frame index out of range.");return c[e]},this.decodeAndBlitFrameBGRA=function(t,n){var o=this.frameInfo(t),s=o.width*o.height,i=new Uint8Array(s);Je(e,o.data_offset,i,s);var a=o.palette_offset,A=o.transparent_index;null===A&&(A=256);var u=o.width,c=r-u,l=u,d=4*(o.y*r+o.x),f=4*((o.y+o.height)*r+o.x),h=d,p=4*c;!0===o.interlaced&&(p+=4*r*7);for(var m=8,g=0,y=i.length;g<y;++g){var v=i[g];if(0===l&&(l=u,(h+=p)>=f&&(p=4*c+4*r*(m-1),h=d+(u+c)*(m<<1),m>>=1)),v===A)h+=4;else{var w=e[a+3*v],b=e[a+3*v+1],B=e[a+3*v+2];n[h++]=B,n[h++]=b,n[h++]=w,n[h++]=255}--l}},this.decodeAndBlitFrameRGBA=function(t,n){var o=this.frameInfo(t),s=o.width*o.height,i=new Uint8Array(s);Je(e,o.data_offset,i,s);var a=o.palette_offset,A=o.transparent_index;null===A&&(A=256);var u=o.width,c=r-u,l=u,d=4*(o.y*r+o.x),f=4*((o.y+o.height)*r+o.x),h=d,p=4*c;!0===o.interlaced&&(p+=4*r*7);for(var m=8,g=0,y=i.length;g<y;++g){var v=i[g];if(0===l&&(l=u,(h+=p)>=f&&(p=4*c+4*r*(m-1),h=d+(u+c)*(m<<1),m>>=1)),v===A)h+=4;else{var w=e[a+3*v],b=e[a+3*v+1],B=e[a+3*v+2];n[h++]=w,n[h++]=b,n[h++]=B,n[h++]=255}--l}}}function Je(e,t,r,n){for(var o=e[t++],s=1<<o,a=s+1,A=a+1,u=o+1,c=(1<<u)-1,l=0,d=0,f=0,h=e[t++],p=new Int32Array(4096),m=null;;){for(;l<16&&0!==h;)d|=e[t++]<<l,l+=8,1===h?h=e[t++]:--h;if(l<u)break;var g=d&c;if(d>>=u,l-=u,g!==s){if(g===a)break;for(var y=g<A?g:m,v=0,w=y;w>s;)w=p[w]>>8,++v;var b=w;if(f+v+(y!==g?1:0)>n)return void i.log("Warning, gif stream longer than expected.");r[f++]=b;var B=f+=v;for(y!==g&&(r[f++]=b),w=y;v--;)w=p[w],r[--B]=255&w,w>>=8;null!==m&&A<4096&&(p[A++]=m<<8|b,A>=c+1&&u<12&&(++u,c=c<<1|1)),m=g}else A=a+1,c=(1<<(u=o+1))-1,m=null}return f!==n&&i.log("Warning, gif stream shorter than expected."),r}function Ye(e){var t,r,n,o,s,i=Math.floor,a=new Array(64),A=new Array(64),u=new Array(64),c=new Array(64),l=new Array(65535),d=new Array(65535),f=new Array(64),h=new Array(64),p=[],m=0,g=7,y=new Array(64),v=new Array(64),w=new Array(64),b=new Array(256),B=new Array(2048),j=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],_=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],C=[0,1,2,3,4,5,6,7,8,9,10,11],x=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],E=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],N=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Q=[0,1,2,3,4,5,6,7,8,9,10,11],F=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],U=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function S(e,t){for(var r=0,n=0,o=new Array,s=1;s<=16;s++){for(var i=1;i<=e[s];i++)o[t[n]]=[],o[t[n]][0]=r,o[t[n]][1]=s,n++,r++;r*=2}return o}function L(e){for(var t=e[0],r=e[1]-1;r>=0;)t&1<<r&&(m|=1<<g),r--,--g<0&&(255==m?(T(255),T(0)):T(m),g=7,m=0)}function T(e){p.push(e)}function H(e){T(e>>8&255),T(255&e)}function I(e,t,r,n,o){for(var s,i=o[0],a=o[240],A=function(e,t){var r,n,o,s,i,a,A,u,c,l,d=0;for(c=0;c<8;++c){r=e[d],n=e[d+1],o=e[d+2],s=e[d+3],i=e[d+4],a=e[d+5],A=e[d+6];var h=r+(u=e[d+7]),p=r-u,m=n+A,g=n-A,y=o+a,v=o-a,w=s+i,b=s-i,B=h+w,j=h-w,_=m+y,C=m-y;e[d]=B+_,e[d+4]=B-_;var x=.707106781*(C+j);e[d+2]=j+x,e[d+6]=j-x;var E=.382683433*((B=b+v)-(C=g+p)),N=.5411961*B+E,Q=1.306562965*C+E,F=.707106781*(_=v+g),U=p+F,S=p-F;e[d+5]=S+N,e[d+3]=S-N,e[d+1]=U+Q,e[d+7]=U-Q,d+=8}for(d=0,c=0;c<8;++c){r=e[d],n=e[d+8],o=e[d+16],s=e[d+24],i=e[d+32],a=e[d+40],A=e[d+48];var L=r+(u=e[d+56]),T=r-u,H=n+A,I=n-A,P=o+a,O=o-a,k=s+i,R=s-i,M=L+k,D=L-k,K=H+P,z=H-P;e[d]=M+K,e[d+32]=M-K;var V=.707106781*(z+D);e[d+16]=D+V,e[d+48]=D-V;var q=.382683433*((M=R+O)-(z=I+T)),G=.5411961*M+q,X=1.306562965*z+q,W=.707106781*(K=O+I),J=T+W,Y=T-W;e[d+40]=Y+G,e[d+24]=Y-G,e[d+8]=J+X,e[d+56]=J-X,d++}for(c=0;c<64;++c)l=e[c]*t[c],f[c]=l>0?l+.5|0:l-.5|0;return f}(e,t),u=0;u<64;++u)h[j[u]]=A[u];var c=h[0]-r;r=h[0],0==c?L(n[0]):(L(n[d[s=32767+c]]),L(l[s]));for(var p=63;p>0&&0==h[p];)p--;if(0==p)return L(i),r;for(var m,g=1;g<=p;){for(var y=g;0==h[g]&&g<=p;)++g;var v=g-y;if(v>=16){m=v>>4;for(var w=1;w<=m;++w)L(a);v&=15}s=32767+h[g],L(o[(v<<4)+d[s]]),L(l[s]),g++}return 63!=p&&L(i),r}function P(e){e=Math.min(Math.max(e,1),100),s!=e&&(function(e){for(var t=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],r=0;r<64;r++){var n=i((t[r]*e+50)/100);n=Math.min(Math.max(n,1),255),a[j[r]]=n}for(var o=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],s=0;s<64;s++){var l=i((o[s]*e+50)/100);l=Math.min(Math.max(l,1),255),A[j[s]]=l}for(var d=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],f=0,h=0;h<8;h++)for(var p=0;p<8;p++)u[f]=1/(a[j[f]]*d[h]*d[p]*8),c[f]=1/(A[j[f]]*d[h]*d[p]*8),f++}(e<50?Math.floor(5e3/e):Math.floor(200-2*e)),s=e)}this.encode=function(e,s){s&&P(s),p=new Array,m=0,g=7,H(65496),H(65504),H(16),T(74),T(70),T(73),T(70),T(0),T(1),T(1),T(0),H(1),H(1),T(0),T(0),function(){H(65499),H(132),T(0);for(var e=0;e<64;e++)T(a[e]);T(1);for(var t=0;t<64;t++)T(A[t])}(),function(e,t){H(65472),H(17),T(8),H(t),H(e),T(3),T(1),T(17),T(0),T(2),T(17),T(1),T(3),T(17),T(1)}(e.width,e.height),function(){H(65476),H(418),T(0);for(var e=0;e<16;e++)T(_[e+1]);for(var t=0;t<=11;t++)T(C[t]);T(16);for(var r=0;r<16;r++)T(x[r+1]);for(var n=0;n<=161;n++)T(E[n]);T(1);for(var o=0;o<16;o++)T(N[o+1]);for(var s=0;s<=11;s++)T(Q[s]);T(17);for(var i=0;i<16;i++)T(F[i+1]);for(var a=0;a<=161;a++)T(U[a])}(),H(65498),H(12),T(3),T(1),T(0),T(2),T(17),T(3),T(17),T(0),T(63),T(0);var i=0,l=0,d=0;m=0,g=7,this.encode.displayName="_encode_";for(var f,h,b,j,S,O,k,R,M,D=e.data,K=e.width,z=e.height,V=4*K,q=0;q<z;){for(f=0;f<V;){for(S=V*q+f,k=-1,R=0,M=0;M<64;M++)O=S+(R=M>>3)*V+(k=4*(7&M)),q+R>=z&&(O-=V*(q+1+R-z)),f+k>=V&&(O-=f+k-V+4),h=D[O++],b=D[O++],j=D[O++],y[M]=(B[h]+B[b+256>>0]+B[j+512>>0]>>16)-128,v[M]=(B[h+768>>0]+B[b+1024>>0]+B[j+1280>>0]>>16)-128,w[M]=(B[h+1280>>0]+B[b+1536>>0]+B[j+1792>>0]>>16)-128;i=I(y,u,i,t,n),l=I(v,c,l,r,o),d=I(w,c,d,r,o),f+=32}q+=8}if(g>=0){var G=[];G[1]=g+1,G[0]=(1<<g+1)-1,L(G)}return H(65497),new Uint8Array(p)},e=e||50,function(){for(var e=String.fromCharCode,t=0;t<256;t++)b[t]=e(t)}(),t=S(_,C),r=S(N,Q),n=S(x,E),o=S(F,U),function(){for(var e=1,t=2,r=1;r<=15;r++){for(var n=e;n<t;n++)d[32767+n]=r,l[32767+n]=[],l[32767+n][1]=r,l[32767+n][0]=n;for(var o=-(t-1);o<=-e;o++)d[32767+o]=r,l[32767+o]=[],l[32767+o][1]=r,l[32767+o][0]=t-1+o;e<<=1,t<<=1}}(),function(){for(var e=0;e<256;e++)B[e]=19595*e,B[e+256>>0]=38470*e,B[e+512>>0]=7471*e+32768,B[e+768>>0]=-11059*e,B[e+1024>>0]=-21709*e,B[e+1280>>0]=32768*e+8421375,B[e+1536>>0]=-27439*e,B[e+1792>>0]=-5329*e}(),P(e)}function Ze(e,t){if(this.pos=0,this.buffer=e,this.datav=new DataView(e.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,-1===["BM","BA","CI","CP","IC","PT"].indexOf(this.flag))throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function $e(e){function t(e){if(!e)throw Error("assert :P")}function r(e,t,r){for(var n=0;4>n;n++)if(e[t+n]!=r.charCodeAt(n))return!0;return!1}function n(e,t,r,n,o){for(var s=0;s<o;s++)e[t+s]=r[n+s]}function o(e,t,r,n){for(var o=0;o<n;o++)e[t+o]=r}function s(e){return new Int32Array(e)}function i(e,t){for(var r=[],n=0;n<e;n++)r.push(new t);return r}function a(e,t){var r=[];return function e(r,n,o){for(var s=o[n],i=0;i<s&&(r.push(o.length>n+1?[]:new t),!(o.length<n+1));i++)e(r[i],n+1,o)}(r,0,e),r}function A(e,t){for(var r="",n=0;n<4;n++)r+=String.fromCharCode(e[t++]);return r}function u(e,t){return(e[t+0]<<0|e[t+1]<<8|e[t+2]<<16)>>>0}function c(e,t){return(e[t+0]<<0|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}new($e=function(){var e=this;function A(e,t){for(var r=1<<t-1>>>0;e&r;)r>>>=1;return r?(e&r-1)+r:e}function u(e,r,n,o,s){t(!(o%n));do{e[r+(o-=n)]=s}while(0<o)}function c(e,r,n,o,i){if(t(2328>=i),512>=i)var a=s(512);else if(null==(a=s(i)))return 0;return function(e,r,n,o,i,a){var c,d,f=r,h=1<<n,p=s(16),m=s(16);for(t(0!=i),t(null!=o),t(null!=e),t(0<n),d=0;d<i;++d){if(15<o[d])return 0;++p[o[d]]}if(p[0]==i)return 0;for(m[1]=0,c=1;15>c;++c){if(p[c]>1<<c)return 0;m[c+1]=m[c]+p[c]}for(d=0;d<i;++d)c=o[d],0<o[d]&&(a[m[c]++]=d);if(1==m[15])return(o=new l).g=0,o.value=a[0],u(e,f,1,h,o),h;var g,y=-1,v=h-1,w=0,b=1,B=1,j=1<<n;for(d=0,c=1,i=2;c<=n;++c,i<<=1){if(b+=B<<=1,0>(B-=p[c]))return 0;for(;0<p[c];--p[c])(o=new l).g=c,o.value=a[d++],u(e,f+w,i,j,o),w=A(w,c)}for(c=n+1,i=2;15>=c;++c,i<<=1){if(b+=B<<=1,0>(B-=p[c]))return 0;for(;0<p[c];--p[c]){if(o=new l,(w&v)!=y){for(f+=j,g=1<<(y=c)-n;15>y&&!(0>=(g-=p[y]));)++y,g<<=1;h+=j=1<<(g=y-n),e[r+(y=w&v)].g=g+n,e[r+y].value=f-r-y}o.g=c-n,o.value=a[d++],u(e,f+(w>>n),i,j,o),w=A(w,c)}}return b!=2*m[15]-1?0:h}(e,r,n,o,i,a)}function l(){this.value=this.g=0}function d(){this.value=this.g=0}function f(){this.G=i(5,l),this.H=s(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=i(Or,d)}function h(e,r,n,o){t(null!=e),t(null!=r),t(2147483648>o),e.Ca=254,e.I=0,e.b=-8,e.Ka=0,e.oa=r,e.pa=n,e.Jd=r,e.Yc=n+o,e.Zc=4<=o?n+o-4+1:n,x(e)}function p(e,t){for(var r=0;0<t--;)r|=N(e,128)<<t;return r}function m(e,t){var r=p(e,t);return E(e)?-r:r}function g(e,r,n,o){var s,i=0;for(t(null!=e),t(null!=r),t(4294967288>o),e.Sb=o,e.Ra=0,e.u=0,e.h=0,4<o&&(o=4),s=0;s<o;++s)i+=r[n+s]<<8*s;e.Ra=i,e.bb=o,e.oa=r,e.pa=n}function y(e){for(;8<=e.u&&e.bb<e.Sb;)e.Ra>>>=8,e.Ra+=e.oa[e.pa+e.bb]<<Mr-8>>>0,++e.bb,e.u-=8;j(e)&&(e.h=1,e.u=0)}function v(e,r){if(t(0<=r),!e.h&&r<=Rr){var n=B(e)&kr[r];return e.u+=r,y(e),n}return e.h=1,e.u=0}function w(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function b(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function B(e){return e.Ra>>>(e.u&Mr-1)>>>0}function j(e){return t(e.bb<=e.Sb),e.h||e.bb==e.Sb&&e.u>Mr}function _(e,t){e.u=t,e.h=j(e)}function C(e){e.u>=Dr&&(t(e.u>=Dr),y(e))}function x(e){t(null!=e&&null!=e.oa),e.pa<e.Zc?(e.I=(e.oa[e.pa++]|e.I<<8)>>>0,e.b+=8):(t(null!=e&&null!=e.oa),e.pa<e.Yc?(e.b+=8,e.I=e.oa[e.pa++]|e.I<<8):e.Ka?e.b=0:(e.I<<=8,e.b+=8,e.Ka=1))}function E(e){return p(e,1)}function N(e,t){var r=e.Ca;0>e.b&&x(e);var n=e.b,o=r*t>>>8,s=(e.I>>>n>o)+0;for(s?(r-=o,e.I-=o+1<<n>>>0):r=o+1,n=r,o=0;256<=n;)o+=8,n>>=8;return n=7^o+Kr[n],e.b-=n,e.Ca=(r<<n)-1,s}function Q(e,t,r){e[t+0]=r>>24&255,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=r>>0&255}function F(e,t){return e[t+0]<<0|e[t+1]<<8}function U(e,t){return F(e,t)|e[t+2]<<16}function S(e,t){return F(e,t)|F(e,t+2)<<16}function L(e,r){var n=1<<r;return t(null!=e),t(0<r),e.X=s(n),null==e.X?0:(e.Mb=32-r,e.Xa=r,1)}function T(e,r){t(null!=e),t(null!=r),t(e.Xa==r.Xa),n(r.X,0,e.X,0,1<<r.Xa)}function H(){this.X=[],this.Xa=this.Mb=0}function I(e,r,n,o){t(null!=n),t(null!=o);var s=n[0],i=o[0];return 0==s&&(s=(e*i+r/2)/r),0==i&&(i=(r*s+e/2)/e),0>=s||0>=i?0:(n[0]=s,o[0]=i,1)}function P(e,t){return e+(1<<t)-1>>>t}function O(e,t){return((4278255360&e)+(4278255360&t)>>>0&4278255360)+((16711935&e)+(16711935&t)>>>0&16711935)>>>0}function k(t,r){e[r]=function(r,n,o,s,i,a,A){var u;for(u=0;u<i;++u){var c=e[t](a[A+u-1],o,s+u);a[A+u]=O(r[n+u],c)}}}function R(){this.ud=this.hd=this.jd=0}function M(e,t){return((4278124286&(e^t))>>>1)+(e&t)>>>0}function D(e){return 0<=e&&256>e?e:0>e?0:255<e?255:void 0}function K(e,t){return D(e+(e-t+.5>>1))}function z(e,t,r){return Math.abs(t-r)-Math.abs(e-r)}function V(e,t,r,n,o,s,i){for(n=s[i-1],r=0;r<o;++r)s[i+r]=n=O(e[t+r],n)}function q(e,t,r,n,o){var s;for(s=0;s<r;++s){var i=e[t+s],a=i>>8&255,A=16711935&(A=(A=16711935&i)+((a<<16)+a));n[o+s]=(4278255360&i)+A>>>0}}function G(e,t){t.jd=e>>0&255,t.hd=e>>8&255,t.ud=e>>16&255}function X(e,t,r,n,o,s){var i;for(i=0;i<n;++i){var a=t[r+i],A=a>>>8,u=a,c=255&(c=(c=a>>>16)+((e.jd<<24>>24)*(A<<24>>24)>>>5));u=255&(u=(u+=(e.hd<<24>>24)*(A<<24>>24)>>>5)+((e.ud<<24>>24)*(c<<24>>24)>>>5)),o[s+i]=(4278255360&a)+(c<<16)+u}}function W(t,r,n,o,s){e[r]=function(e,t,r,n,i,a,A,u,c){for(n=A;n<u;++n)for(A=0;A<c;++A)i[a++]=s(r[o(e[t++])])},e[t]=function(t,r,i,a,A,u,c){var l=8>>t.b,d=t.Ea,f=t.K[0],h=t.w;if(8>l)for(t=(1<<t.b)-1,h=(1<<l)-1;r<i;++r){var p,m=0;for(p=0;p<d;++p)p&t||(m=o(a[A++])),u[c++]=s(f[m&h]),m>>=l}else e["VP8LMapColor"+n](a,A,f,h,u,c,r,i,d)}}function J(e,t,r,n,o){for(r=t+r;t<r;){var s=e[t++];n[o++]=s>>16&255,n[o++]=s>>8&255,n[o++]=s>>0&255}}function Y(e,t,r,n,o){for(r=t+r;t<r;){var s=e[t++];n[o++]=s>>16&255,n[o++]=s>>8&255,n[o++]=s>>0&255,n[o++]=s>>24&255}}function Z(e,t,r,n,o){for(r=t+r;t<r;){var s=(i=e[t++])>>16&240|i>>12&15,i=i>>0&240|i>>28&15;n[o++]=s,n[o++]=i}}function $(e,t,r,n,o){for(r=t+r;t<r;){var s=(i=e[t++])>>16&248|i>>13&7,i=i>>5&224|i>>3&31;n[o++]=s,n[o++]=i}}function ee(e,t,r,n,o){for(r=t+r;t<r;){var s=e[t++];n[o++]=s>>0&255,n[o++]=s>>8&255,n[o++]=s>>16&255}}function te(e,t,r,o,s,i){if(0==i)for(r=t+r;t<r;)Q(o,((i=e[t++])[0]>>24|i[1]>>8&65280|i[2]<<8&16711680|i[3]<<24)>>>0),s+=32;else n(o,s,e,t,r)}function re(t,r){e[r][0]=e[t+"0"],e[r][1]=e[t+"1"],e[r][2]=e[t+"2"],e[r][3]=e[t+"3"],e[r][4]=e[t+"4"],e[r][5]=e[t+"5"],e[r][6]=e[t+"6"],e[r][7]=e[t+"7"],e[r][8]=e[t+"8"],e[r][9]=e[t+"9"],e[r][10]=e[t+"10"],e[r][11]=e[t+"11"],e[r][12]=e[t+"12"],e[r][13]=e[t+"13"],e[r][14]=e[t+"0"],e[r][15]=e[t+"0"]}function ne(e){return e==Kn||e==zn||e==Vn||e==qn}function oe(){this.eb=[],this.size=this.A=this.fb=0}function se(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function ie(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new oe,this.f.kb=new se,this.sd=null}function ae(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Ae(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function ue(e){return alert("todo:WebPSamplerProcessPlane"),e.T}function ce(e,t){var r=e.T,o=t.ba.f.RGBA,s=o.eb,i=o.fb+e.ka*o.A,a=yo[t.ba.S],A=e.y,u=e.O,c=e.f,l=e.N,d=e.ea,f=e.W,h=t.cc,p=t.dc,m=t.Mc,g=t.Nc,y=e.ka,v=e.ka+e.T,w=e.U,b=w+1>>1;for(0==y?a(A,u,null,null,c,l,d,f,c,l,d,f,s,i,null,null,w):(a(t.ec,t.fc,A,u,h,p,m,g,c,l,d,f,s,i-o.A,s,i,w),++r);y+2<v;y+=2)h=c,p=l,m=d,g=f,l+=e.Rc,f+=e.Rc,i+=2*o.A,a(A,(u+=2*e.fa)-e.fa,A,u,h,p,m,g,c,l,d,f,s,i-o.A,s,i,w);return u+=e.fa,e.j+v<e.o?(n(t.ec,t.fc,A,u,w),n(t.cc,t.dc,c,l,b),n(t.Mc,t.Nc,d,f,b),r--):1&v||a(A,u,null,null,c,l,d,f,c,l,d,f,s,i+o.A,null,null,w),r}function le(e,r,n){var o=e.F,s=[e.J];if(null!=o){var i=e.U,a=r.ba.S,A=a==Rn||a==Vn;r=r.ba.f.RGBA;var u=[0],c=e.ka;u[0]=e.T,e.Kb&&(0==c?--u[0]:(--c,s[0]-=e.width),e.j+e.ka+e.T==e.o&&(u[0]=e.o-e.j-c));var l=r.eb;c=r.fb+c*r.A,e=Cn(o,s[0],e.width,i,u,l,c+(A?0:3),r.A),t(n==u),e&&ne(a)&&jn(l,c,A,i,u,r.A)}return 0}function de(e){var t=e.ma,r=t.ba.S,n=11>r,o=r==Pn||r==kn||r==Rn||r==Mn||12==r||ne(r);if(t.memory=null,t.Ib=null,t.Jb=null,t.Nd=null,!Hr(t.Oa,e,o?11:12))return 0;if(o&&ne(r)&&yr(),e.da)alert("todo:use_scaling");else{if(n){if(t.Ib=ue,e.Kb){if(r=e.U+1>>1,t.memory=s(e.U+2*r),null==t.memory)return 0;t.ec=t.memory,t.fc=0,t.cc=t.ec,t.dc=t.fc+e.U,t.Mc=t.cc,t.Nc=t.dc+r,t.Ib=ce,yr()}}else alert("todo:EmitYUV");o&&(t.Jb=le,n&&mr())}if(n&&!So){for(e=0;256>e;++e)Lo[e]=89858*(e-128)+Eo>>xo,Io[e]=-22014*(e-128)+Eo,Ho[e]=-45773*(e-128),To[e]=113618*(e-128)+Eo>>xo;for(e=No;e<Qo;++e)t=76283*(e-16)+Eo>>xo,Po[e-No]=Ve(t,255),Oo[e-No]=Ve(t+8>>4,15);So=1}return 1}function fe(e){var r=e.ma,n=e.U,o=e.T;return t(!(1&e.ka)),0>=n||0>=o?0:(n=r.Ib(e,r),null!=r.Jb&&r.Jb(e,r,n),r.Dc+=n,1)}function he(e){e.ma.memory=null}function pe(e,t,r,n){return 47!=v(e,8)?0:(t[0]=v(e,14)+1,r[0]=v(e,14)+1,n[0]=v(e,1),0!=v(e,3)?0:!e.h)}function me(e,t){if(4>e)return e+1;var r=e-2>>1;return(2+(1&e)<<r)+v(t,r)+1}function ge(e,t){return 120<t?t-120:1<=(r=((r=Zn[t-1])>>4)*e+(8-(15&r)))?r:1;var r}function ye(e,t,r){var n=B(r),o=e[t+=255&n].g-8;return 0<o&&(_(r,r.u+8),n=B(r),t+=e[t].value,t+=n&(1<<o)-1),_(r,r.u+e[t].g),e[t].value}function ve(e,r,n){return n.g+=e.g,n.value+=e.value<<r>>>0,t(8>=n.g),e.g}function we(e,r,n){var o=e.xc;return t((r=0==o?0:e.vc[e.md*(n>>o)+(r>>o)])<e.Wb),e.Ya[r]}function be(e,r,o,s){var i=e.ab,a=e.c*r,A=e.C;r=A+r;var u=o,c=s;for(s=e.Ta,o=e.Ua;0<i--;){var l=e.gc[i],d=A,f=r,h=u,p=c,m=(c=s,u=o,l.Ea);switch(t(d<f),t(f<=l.nc),l.hc){case 2:qr(h,p,(f-d)*m,c,u);break;case 0:var g=d,y=f,v=c,w=u,b=(x=l).Ea;0==g&&(zr(h,p,null,null,1,v,w),V(h,p+1,0,0,b-1,v,w+1),p+=b,w+=b,++g);for(var B=1<<x.b,j=B-1,_=P(b,x.b),C=x.K,x=x.w+(g>>x.b)*_;g<y;){var E=C,N=x,Q=1;for(Vr(h,p,v,w-b,1,v,w);Q<b;){var F=(Q&~j)+B;F>b&&(F=b),(0,Yr[E[N++]>>8&15])(h,p+ +Q,v,w+Q-b,F-Q,v,w+Q),Q=F}p+=b,w+=b,++g&j||(x+=_)}f!=l.nc&&n(c,u-m,c,u+(f-d-1)*m,m);break;case 1:for(m=h,y=p,b=(h=l.Ea)-(w=h&~(v=(p=1<<l.b)-1)),g=P(h,l.b),B=l.K,l=l.w+(d>>l.b)*g;d<f;){for(j=B,_=l,C=new R,x=y+w,E=y+h;y<x;)G(j[_++],C),Zr(C,m,y,p,c,u),y+=p,u+=p;y<E&&(G(j[_++],C),Zr(C,m,y,b,c,u),y+=b,u+=b),++d&v||(l+=g)}break;case 3:if(h==c&&p==u&&0<l.b){for(y=c,h=m=u+(f-d)*m-(w=(f-d)*P(l.Ea,l.b)),p=c,v=u,g=[],w=(b=w)-1;0<=w;--w)g[w]=p[v+w];for(w=b-1;0<=w;--w)y[h+w]=g[w];Gr(l,d,f,c,m,c,u)}else Gr(l,d,f,h,p,c,u)}u=s,c=o}c!=o&&n(s,o,u,c,a)}function Be(e,r){var n=e.V,o=e.Ba+e.c*e.C,s=r-e.C;if(t(r<=e.l.o),t(16>=s),0<s){var i=e.l,a=e.Ta,A=e.Ua,u=i.width;if(be(e,s,n,o),s=A=[A],t((n=e.C)<(o=r)),t(i.v<i.va),o>i.o&&(o=i.o),n<i.j){var c=i.j-n;n=i.j,s[0]+=c*u}if(n>=o?n=0:(s[0]+=4*i.v,i.ka=n-i.j,i.U=i.va-i.v,i.T=o-n,n=1),n){if(A=A[0],11>(n=e.ca).S){var l=n.f.RGBA,d=(o=n.S,s=i.U,i=i.T,c=l.eb,l.A),f=i;for(l=l.fb+e.Ma*l.A;0<f--;){var h=a,p=A,m=s,g=c,y=l;switch(o){case In:$r(h,p,m,g,y);break;case Pn:en(h,p,m,g,y);break;case Kn:en(h,p,m,g,y),jn(g,y,0,m,1,0);break;case On:nn(h,p,m,g,y);break;case kn:te(h,p,m,g,y,1);break;case zn:te(h,p,m,g,y,1),jn(g,y,0,m,1,0);break;case Rn:te(h,p,m,g,y,0);break;case Vn:te(h,p,m,g,y,0),jn(g,y,1,m,1,0);break;case Mn:tn(h,p,m,g,y);break;case qn:tn(h,p,m,g,y),_n(g,y,m,1,0);break;case Dn:rn(h,p,m,g,y);break;default:t(0)}A+=u,l+=d}e.Ma+=i}else alert("todo:EmitRescaledRowsYUVA");t(e.Ma<=n.height)}}e.C=r,t(e.C<=e.i)}function je(e){var t;if(0<e.ua)return 0;for(t=0;t<e.Wb;++t){var r=e.Ya[t].G,n=e.Ya[t].H;if(0<r[1][n[1]+0].g||0<r[2][n[2]+0].g||0<r[3][n[3]+0].g)return 0}return 1}function _e(e,r,n,o,s,i){if(0!=e.Z){var a=e.qd,A=e.rd;for(t(null!=go[e.Z]);r<n;++r)go[e.Z](a,A,o,s,o,s,i),a=o,A=s,s+=i;e.qd=a,e.rd=A}}function Ce(e,r){var n=e.l.ma,o=0==n.Z||1==n.Z?e.l.j:e.C;if(o=e.C<o?o:e.C,t(r<=e.l.o),r>o){var s=e.l.width,i=n.ca,a=n.tb+s*o,A=e.V,u=e.Ba+e.c*o,c=e.gc;t(1==e.ab),t(3==c[0].hc),Wr(c[0],o,r,A,u,i,a),_e(n,o,r,i,a,s)}e.C=e.Ma=r}function xe(e,r,n,o,s,i,a){var A=e.$/o,u=e.$%o,c=e.m,l=e.s,d=n+e.$,f=d;s=n+o*s;var h=n+o*i,p=280+l.ua,m=e.Pb?A:16777216,g=0<l.ua?l.Wa:null,y=l.wc,v=d<h?we(l,u,A):null;t(e.C<i),t(h<=s);var w=!1;e:for(;;){for(;w||d<h;){var b=0;if(A>=m){var x=d-n;t((m=e).Pb),m.wd=m.m,m.xd=x,0<m.s.ua&&T(m.s.Wa,m.s.vb),m=A+eo}if(u&y||(v=we(l,u,A)),t(null!=v),v.Qb&&(r[d]=v.qb,w=!0),!w)if(C(c),v.jc){b=c,x=r;var E=d,N=v.pd[B(b)&Or-1];t(v.jc),256>N.g?(_(b,b.u+N.g),x[E]=N.value,b=0):(_(b,b.u+N.g-256),t(256<=N.value),b=N.value),0==b&&(w=!0)}else b=ye(v.G[0],v.H[0],c);if(c.h)break;if(w||256>b){if(!w)if(v.nd)r[d]=(v.qb|b<<8)>>>0;else{if(C(c),w=ye(v.G[1],v.H[1],c),C(c),x=ye(v.G[2],v.H[2],c),E=ye(v.G[3],v.H[3],c),c.h)break;r[d]=(E<<24|w<<16|b<<8|x)>>>0}if(w=!1,++d,++u>=o&&(u=0,++A,null!=a&&A<=i&&!(A%16)&&a(e,A),null!=g))for(;f<d;)b=r[f++],g.X[(506832829*b&4294967295)>>>g.Mb]=b}else if(280>b){if(b=me(b-256,c),x=ye(v.G[4],v.H[4],c),C(c),x=ge(o,x=me(x,c)),c.h)break;if(d-n<x||s-d<b)break e;for(E=0;E<b;++E)r[d+E]=r[d+E-x];for(d+=b,u+=b;u>=o;)u-=o,++A,null!=a&&A<=i&&!(A%16)&&a(e,A);if(t(d<=s),u&y&&(v=we(l,u,A)),null!=g)for(;f<d;)b=r[f++],g.X[(506832829*b&4294967295)>>>g.Mb]=b}else{if(!(b<p))break e;for(w=b-280,t(null!=g);f<d;)b=r[f++],g.X[(506832829*b&4294967295)>>>g.Mb]=b;b=d,t(!(w>>>(x=g).Xa)),r[b]=x.X[w],w=!0}w||t(c.h==j(c))}if(e.Pb&&c.h&&d<s)t(e.m.h),e.a=5,e.m=e.wd,e.$=e.xd,0<e.s.ua&&T(e.s.vb,e.s.Wa);else{if(c.h)break e;null!=a&&a(e,A>i?i:A),e.a=0,e.$=d-n}return 1}return e.a=3,0}function Ee(e){t(null!=e),e.vc=null,e.yc=null,e.Ya=null;var r=e.Wa;null!=r&&(r.X=null),e.vb=null,t(null!=e)}function Ne(){var t=new ir;return null==t?null:(t.a=0,t.xb=mo,re("Predictor","VP8LPredictors"),re("Predictor","VP8LPredictors_C"),re("PredictorAdd","VP8LPredictorsAdd"),re("PredictorAdd","VP8LPredictorsAdd_C"),qr=q,Zr=X,$r=J,en=Y,tn=Z,rn=$,nn=ee,e.VP8LMapColor32b=Xr,e.VP8LMapColor8b=Jr,t)}function Qe(e,r,n,a,A){var u=1,d=[e],h=[r],p=a.m,m=a.s,g=null,y=0;e:for(;;){if(n)for(;u&&v(p,1);){var w=d,b=h,j=a,x=1,E=j.m,N=j.gc[j.ab],Q=v(E,2);if(j.Oc&1<<Q)u=0;else{switch(j.Oc|=1<<Q,N.hc=Q,N.Ea=w[0],N.nc=b[0],N.K=[null],++j.ab,t(4>=j.ab),Q){case 0:case 1:N.b=v(E,3)+2,x=Qe(P(N.Ea,N.b),P(N.nc,N.b),0,j,N.K),N.K=N.K[0];break;case 3:var F,U=v(E,8)+1,S=16<U?0:4<U?1:2<U?2:3;if(w[0]=P(N.Ea,S),N.b=S,F=x=Qe(U,1,0,j,N.K)){var T,H=U,I=N,k=1<<(8>>I.b),R=s(k);if(null==R)F=0;else{var M=I.K[0],D=I.w;for(R[0]=I.K[0][0],T=1;T<1*H;++T)R[T]=O(M[D+T],R[T-1]);for(;T<4*k;++T)R[T]=0;I.K[0]=null,I.K[0]=R,F=1}}x=F;break;case 2:break;default:t(0)}u=x}}if(d=d[0],h=h[0],u&&v(p,1)&&!(u=1<=(y=v(p,4))&&11>=y)){a.a=3;break e}var K;if(K=u)t:{var z,V,q,G=a,X=d,W=h,J=y,Y=n,Z=G.m,$=G.s,ee=[null],te=1,re=0,ne=$n[J];r:for(;;){if(Y&&v(Z,1)){var oe=v(Z,3)+2,se=P(X,oe),ie=P(W,oe),ae=se*ie;if(!Qe(se,ie,0,G,ee))break r;for(ee=ee[0],$.xc=oe,z=0;z<ae;++z){var Ae=ee[z]>>8&65535;ee[z]=Ae,Ae>=te&&(te=Ae+1)}}if(Z.h)break r;for(V=0;5>V;++V){var ue=Wn[V];!V&&0<J&&(ue+=1<<J),re<ue&&(re=ue)}var ce=i(te*ne,l),le=te,de=i(le,f);if(null==de)var fe=null;else t(65536>=le),fe=de;var he=s(re);if(null==fe||null==he||null==ce){G.a=1;break r}var pe=ce;for(z=q=0;z<te;++z){var me=fe[z],ge=me.G,ye=me.H,we=0,be=1,Be=0;for(V=0;5>V;++V){ue=Wn[V],ge[V]=pe,ye[V]=q,!V&&0<J&&(ue+=1<<J);n:{var je,_e=ue,Ce=G,Ne=he,Fe=pe,Ue=q,Se=0,Le=Ce.m,Te=v(Le,1);if(o(Ne,0,0,_e),Te){var He=v(Le,1)+1,Ie=v(Le,1),Pe=v(Le,0==Ie?1:8);Ne[Pe]=1,2==He&&(Ne[Pe=v(Le,8)]=1);var Oe=1}else{var ke=s(19),Re=v(Le,4)+4;if(19<Re){Ce.a=3;var Me=0;break n}for(je=0;je<Re;++je)ke[Yn[je]]=v(Le,3);var De=void 0,Ke=void 0,ze=Ce,Ve=ke,qe=_e,Ge=Ne,Xe=0,We=ze.m,Je=8,Ye=i(128,l);o:for(;c(Ye,0,7,Ve,19);){if(v(We,1)){var Ze=2+2*v(We,3);if((De=2+v(We,Ze))>qe)break o}else De=qe;for(Ke=0;Ke<qe&&De--;){C(We);var $e=Ye[0+(127&B(We))];_(We,We.u+$e.g);var et=$e.value;if(16>et)Ge[Ke++]=et,0!=et&&(Je=et);else{var tt=16==et,rt=et-16,nt=Xn[rt],ot=v(We,Gn[rt])+nt;if(Ke+ot>qe)break o;for(var st=tt?Je:0;0<ot--;)Ge[Ke++]=st}}Xe=1;break o}Xe||(ze.a=3),Oe=Xe}(Oe=Oe&&!Le.h)&&(Se=c(Fe,Ue,8,Ne,_e)),Oe&&0!=Se?Me=Se:(Ce.a=3,Me=0)}if(0==Me)break r;if(be&&1==Jn[V]&&(be=0==pe[q].g),we+=pe[q].g,q+=Me,3>=V){var it,at=he[0];for(it=1;it<ue;++it)he[it]>at&&(at=he[it]);Be+=at}}if(me.nd=be,me.Qb=0,be&&(me.qb=(ge[3][ye[3]+0].value<<24|ge[1][ye[1]+0].value<<16|ge[2][ye[2]+0].value)>>>0,0==we&&256>ge[0][ye[0]+0].value&&(me.Qb=1,me.qb+=ge[0][ye[0]+0].value<<8)),me.jc=!me.Qb&&6>Be,me.jc){var At,ut=me;for(At=0;At<Or;++At){var ct=At,lt=ut.pd[ct],dt=ut.G[0][ut.H[0]+ct];256<=dt.value?(lt.g=dt.g+256,lt.value=dt.value):(lt.g=0,lt.value=0,ct>>=ve(dt,8,lt),ct>>=ve(ut.G[1][ut.H[1]+ct],16,lt),ct>>=ve(ut.G[2][ut.H[2]+ct],0,lt),ve(ut.G[3][ut.H[3]+ct],24,lt))}}}$.vc=ee,$.Wb=te,$.Ya=fe,$.yc=ce,K=1;break t}K=0}if(!(u=K)){a.a=3;break e}if(0<y){if(m.ua=1<<y,!L(m.Wa,y)){a.a=1,u=0;break e}}else m.ua=0;var ft=a,ht=d,pt=h,mt=ft.s,gt=mt.xc;if(ft.c=ht,ft.i=pt,mt.md=P(ht,gt),mt.wc=0==gt?-1:(1<<gt)-1,n){a.xb=po;break e}if(null==(g=s(d*h))){a.a=1,u=0;break e}u=(u=xe(a,g,0,d,h,h,null))&&!p.h;break e}return u?(null!=A?A[0]=g:(t(null==g),t(n)),a.$=0,n||Ee(m)):Ee(m),u}function Fe(e,r){var n=e.c*e.i,o=n+r+16*r;return t(e.c<=r),e.V=s(o),null==e.V?(e.Ta=null,e.Ua=0,e.a=1,0):(e.Ta=e.V,e.Ua=e.Ba+n+r,1)}function Ue(e,r){var n=e.C,o=r-n,s=e.V,i=e.Ba+e.c*n;for(t(r<=e.l.o);0<o;){var a=16<o?16:o,A=e.l.ma,u=e.l.width,c=u*a,l=A.ca,d=A.tb+u*n,f=e.Ta,h=e.Ua;be(e,a,s,i),xn(f,h,l,d,c),_e(A,n,n+a,l,d,u),o-=a,s+=a*e.c,n+=a}t(n==r),e.C=e.Ma=r}function Se(){this.ub=this.yd=this.td=this.Rb=0}function Le(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Te(){this.Fb=this.Bb=this.Cb=0,this.Zb=s(4),this.Lb=s(4)}function He(){this.Yb=function(){var e=[];return function e(t,r,n){for(var o=n[r],s=0;s<o&&(t.push(n.length>r+1?[]:0),!(n.length<r+1));s++)e(t[s],r+1,n)}(e,0,[3,11]),e}()}function Ie(){this.jb=s(3),this.Wc=a([4,8],He),this.Xc=a([4,17],He)}function Pe(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new s(4),this.od=new s(4)}function Oe(){this.ld=this.La=this.dd=this.tc=0}function ke(){this.Na=this.la=0}function Re(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Me(){this.ad=s(384),this.Za=0,this.Ob=s(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function De(){this.uc=this.M=this.Nb=0,this.wa=Array(new Oe),this.Y=0,this.ya=Array(new Me),this.aa=0,this.l=new qe}function Ke(){this.y=s(16),this.f=s(8),this.ea=s(8)}function ze(){this.cb=this.a=0,this.sc="",this.m=new w,this.Od=new Se,this.Kc=new Le,this.ed=new Pe,this.Qa=new Te,this.Ic=this.$c=this.Aa=0,this.D=new De,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=i(8,w),this.ia=0,this.pb=i(4,Re),this.Pa=new Ie,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Ke),this.Hd=0,this.rb=Array(new ke),this.sb=0,this.wa=Array(new Oe),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Me),this.L=this.aa=0,this.gd=a([4,2],Oe),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function Ve(e,t){return 0>e?0:e>t?t:e}function qe(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Ge(){var e=new ze;return null!=e&&(e.a=0,e.sc="OK",e.cb=0,e.Xb=0,no||(no=Ye)),e}function Xe(e,t,r){return 0==e.a&&(e.a=t,e.sc=r,e.cb=0),0}function We(e,t,r){return 3<=r&&157==e[t+0]&&1==e[t+1]&&42==e[t+2]}function Je(e,r){if(null==e)return 0;if(e.a=0,e.sc="OK",null==r)return Xe(e,2,"null VP8Io passed to VP8GetHeaders()");var n=r.data,s=r.w,i=r.ha;if(4>i)return Xe(e,7,"Truncated header.");var a=n[s+0]|n[s+1]<<8|n[s+2]<<16,A=e.Od;if(A.Rb=!(1&a),A.td=a>>1&7,A.yd=a>>4&1,A.ub=a>>5,3<A.td)return Xe(e,3,"Incorrect keyframe parameters.");if(!A.yd)return Xe(e,4,"Frame not displayable.");s+=3,i-=3;var u=e.Kc;if(A.Rb){if(7>i)return Xe(e,7,"cannot parse picture header");if(!We(n,s,i))return Xe(e,3,"Bad code word");u.c=16383&(n[s+4]<<8|n[s+3]),u.Td=n[s+4]>>6,u.i=16383&(n[s+6]<<8|n[s+5]),u.Ud=n[s+6]>>6,s+=7,i-=7,e.za=u.c+15>>4,e.Ub=u.i+15>>4,r.width=u.c,r.height=u.i,r.Da=0,r.j=0,r.v=0,r.va=r.width,r.o=r.height,r.da=0,r.ib=r.width,r.hb=r.height,r.U=r.width,r.T=r.height,o((a=e.Pa).jb,0,255,a.jb.length),t(null!=(a=e.Qa)),a.Cb=0,a.Bb=0,a.Fb=1,o(a.Zb,0,0,a.Zb.length),o(a.Lb,0,0,a.Lb)}if(A.ub>i)return Xe(e,7,"bad partition length");h(a=e.m,n,s,A.ub),s+=A.ub,i-=A.ub,A.Rb&&(u.Ld=E(a),u.Kd=E(a)),u=e.Qa;var c,l=e.Pa;if(t(null!=a),t(null!=u),u.Cb=E(a),u.Cb){if(u.Bb=E(a),E(a)){for(u.Fb=E(a),c=0;4>c;++c)u.Zb[c]=E(a)?m(a,7):0;for(c=0;4>c;++c)u.Lb[c]=E(a)?m(a,6):0}if(u.Bb)for(c=0;3>c;++c)l.jb[c]=E(a)?p(a,8):255}else u.Bb=0;if(a.Ka)return Xe(e,3,"cannot parse segment header");if((u=e.ed).zd=E(a),u.Tb=p(a,6),u.wb=p(a,3),u.Pc=E(a),u.Pc&&E(a)){for(l=0;4>l;++l)E(a)&&(u.vd[l]=m(a,6));for(l=0;4>l;++l)E(a)&&(u.od[l]=m(a,6))}if(e.L=0==u.Tb?0:u.zd?1:2,a.Ka)return Xe(e,3,"cannot parse filter header");var d=i;if(i=c=s,s=c+d,u=d,e.Xb=(1<<p(e.m,2))-1,d<3*(l=e.Xb))n=7;else{for(c+=3*l,u-=3*l,d=0;d<l;++d){var f=n[i+0]|n[i+1]<<8|n[i+2]<<16;f>u&&(f=u),h(e.Jc[+d],n,c,f),c+=f,u-=f,i+=3}h(e.Jc[+l],n,c,u),n=c<s?0:5}if(0!=n)return Xe(e,n,"cannot parse partitions");for(n=p(c=e.m,7),i=E(c)?m(c,4):0,s=E(c)?m(c,4):0,u=E(c)?m(c,4):0,l=E(c)?m(c,4):0,c=E(c)?m(c,4):0,d=e.Qa,f=0;4>f;++f){if(d.Cb){var g=d.Zb[f];d.Fb||(g+=n)}else{if(0<f){e.pb[f]=e.pb[0];continue}g=n}var y=e.pb[f];y.Sc[0]=to[Ve(g+i,127)],y.Sc[1]=ro[Ve(g+0,127)],y.Eb[0]=2*to[Ve(g+s,127)],y.Eb[1]=101581*ro[Ve(g+u,127)]>>16,8>y.Eb[1]&&(y.Eb[1]=8),y.Qc[0]=to[Ve(g+l,117)],y.Qc[1]=ro[Ve(g+c,127)],y.lc=g+c}if(!A.Rb)return Xe(e,4,"Not a key frame.");for(E(a),A=e.Pa,n=0;4>n;++n){for(i=0;8>i;++i)for(s=0;3>s;++s)for(u=0;11>u;++u)l=N(a,uo[n][i][s][u])?p(a,8):ao[n][i][s][u],A.Wc[n][i].Yb[s][u]=l;for(i=0;17>i;++i)A.Xc[n][i]=A.Wc[n][co[i]]}return e.kc=E(a),e.kc&&(e.Bd=p(a,8)),e.cb=1}function Ye(e,t,r,n,o,s,i){var a=t[o].Yb[r];for(r=0;16>o;++o){if(!N(e,a[r+0]))return o;for(;!N(e,a[r+1]);)if(a=t[++o].Yb[0],r=0,16==o)return 16;var A=t[o+1].Yb;if(N(e,a[r+2])){var u=e,c=0;if(N(u,(d=a)[(l=r)+3]))if(N(u,d[l+6])){for(a=0,l=2*(c=N(u,d[l+8]))+(d=N(u,d[l+9+c])),c=0,d=oo[l];d[a];++a)c+=c+N(u,d[a]);c+=3+(8<<l)}else N(u,d[l+7])?(c=7+2*N(u,165),c+=N(u,145)):c=5+N(u,159);else c=N(u,d[l+4])?3+N(u,d[l+5]):2;a=A[2]}else c=1,a=A[1];A=i+so[o],0>(u=e).b&&x(u);var l,d=u.b,f=(l=u.Ca>>1)-(u.I>>d)>>31;--u.b,u.Ca+=f,u.Ca|=1,u.I-=(l+1&f)<<d,s[A]=((c^f)-f)*n[(0<o)+0]}return 16}function Ze(e){var t=e.rb[e.sb-1];t.la=0,t.Na=0,o(e.zc,0,0,e.zc.length),e.ja=0}function $e(e,r){if(null==e)return 0;if(null==r)return Xe(e,2,"NULL VP8Io parameter in VP8Decode().");if(!e.cb&&!Je(e,r))return 0;if(t(e.cb),null==r.ac||r.ac(r)){r.ob&&(e.L=0);var a=Ro[e.L];if(2==e.L?(e.yb=0,e.zb=0):(e.yb=r.v-a>>4,e.zb=r.j-a>>4,0>e.yb&&(e.yb=0),0>e.zb&&(e.zb=0)),e.Va=r.o+15+a>>4,e.Hb=r.va+15+a>>4,e.Hb>e.za&&(e.Hb=e.za),e.Va>e.Ub&&(e.Va=e.Ub),0<e.L){var A=e.ed;for(a=0;4>a;++a){var u;if(e.Qa.Cb){var c=e.Qa.Lb[a];e.Qa.Fb||(c+=A.Tb)}else c=A.Tb;for(u=0;1>=u;++u){var l=e.gd[a][u],d=c;if(A.Pc&&(d+=A.vd[0],u&&(d+=A.od[0])),0<(d=0>d?0:63<d?63:d)){var f=d;0<A.wb&&(f=4<A.wb?f>>2:f>>1)>9-A.wb&&(f=9-A.wb),1>f&&(f=1),l.dd=f,l.tc=2*d+f,l.ld=40<=d?2:15<=d?1:0}else l.tc=0;l.La=u}}}a=0}else Xe(e,6,"Frame setup failed"),a=e.a;if(a=0==a){if(a){e.$c=0,0<e.Aa||(e.Ic=Do);e:{a=e.Ic,A=4*(f=e.za);var h=32*f,p=f+1,m=0<e.L?f*(0<e.Aa?2:1):0,g=(2==e.Aa?2:1)*f;if((l=A+832+(u=3*(16*a+Ro[e.L])/2*h)+(c=null!=e.Fa&&0<e.Fa.length?e.Kc.c*e.Kc.i:0))!=l)a=0;else{if(l>e.Vb){if(e.Vb=0,e.Ec=s(l),e.Fc=0,null==e.Ec){a=Xe(e,1,"no memory during frame initialization.");break e}e.Vb=l}l=e.Ec,d=e.Fc,e.Ac=l,e.Bc=d,d+=A,e.Gd=i(h,Ke),e.Hd=0,e.rb=i(p+1,ke),e.sb=1,e.wa=m?i(m,Oe):null,e.Y=0,e.D.Nb=0,e.D.wa=e.wa,e.D.Y=e.Y,0<e.Aa&&(e.D.Y+=f),t(!0),e.oc=l,e.pc=d,d+=832,e.ya=i(g,Me),e.aa=0,e.D.ya=e.ya,e.D.aa=e.aa,2==e.Aa&&(e.D.aa+=f),e.R=16*f,e.B=8*f,f=(h=Ro[e.L])*e.R,h=h/2*e.B,e.sa=l,e.ta=d+f,e.qa=e.sa,e.ra=e.ta+16*a*e.R+h,e.Ha=e.qa,e.Ia=e.ra+8*a*e.B+h,e.$c=0,d+=u,e.mb=c?l:null,e.nb=c?d:null,t(d+c<=e.Fc+e.Vb),Ze(e),o(e.Ac,e.Bc,0,A),a=1}}if(a){if(r.ka=0,r.y=e.sa,r.O=e.ta,r.f=e.qa,r.N=e.ra,r.ea=e.Ha,r.Vd=e.Ia,r.fa=e.R,r.Rc=e.B,r.F=null,r.J=0,!Un){for(a=-255;255>=a;++a)En[255+a]=0>a?-a:a;for(a=-1020;1020>=a;++a)Nn[1020+a]=-128>a?-128:127<a?127:a;for(a=-112;112>=a;++a)Qn[112+a]=-16>a?-16:15<a?15:a;for(a=-255;510>=a;++a)Fn[255+a]=0>a?0:255<a?255:a;Un=1}on=ut,sn=st,An=it,un=at,cn=At,an=ot,ln=Xt,dn=Wt,fn=Zt,hn=$t,pn=Jt,mn=Yt,gn=er,yn=tr,vn=Dt,wn=Kt,bn=zt,Bn=Vt,fo[0]=_t,fo[1]=lt,fo[2]=Bt,fo[3]=jt,fo[4]=Ct,fo[5]=Et,fo[6]=xt,fo[7]=Nt,fo[8]=Ft,fo[9]=Qt,lo[0]=gt,lo[1]=ft,lo[2]=ht,lo[3]=pt,lo[4]=yt,lo[5]=vt,lo[6]=wt,ho[0]=Tt,ho[1]=dt,ho[2]=Ut,ho[3]=St,ho[4]=It,ho[5]=Ht,ho[6]=Pt,a=1}else a=0}a&&(a=function(e,r){for(e.M=0;e.M<e.Va;++e.M){var i,a=e.Jc[e.M&e.Xb],A=e.m,u=e;for(i=0;i<u.za;++i){var c=A,l=u,d=l.Ac,f=l.Bc+4*i,h=l.zc,p=l.ya[l.aa+i];if(l.Qa.Bb?p.$b=N(c,l.Pa.jb[0])?2+N(c,l.Pa.jb[2]):N(c,l.Pa.jb[1]):p.$b=0,l.kc&&(p.Ad=N(c,l.Bd)),p.Za=!N(c,145)+0,p.Za){var m=p.Ob,g=0;for(l=0;4>l;++l){var y,v=h[0+l];for(y=0;4>y;++y){v=Ao[d[f+y]][v];for(var w=io[N(c,v[0])];0<w;)w=io[2*w+N(c,v[w])];v=-w,d[f+y]=v}n(m,g,d,f,4),g+=4,h[0+l]=v}}else v=N(c,156)?N(c,128)?1:3:N(c,163)?2:0,p.Ob[0]=v,o(d,f,v,4),o(h,0,v,4);p.Dd=N(c,142)?N(c,114)?N(c,183)?1:3:2:0}if(u.m.Ka)return Xe(e,7,"Premature end-of-partition0 encountered.");for(;e.ja<e.za;++e.ja){if(u=a,c=(A=e).rb[A.sb-1],d=A.rb[A.sb+A.ja],i=A.ya[A.aa+A.ja],f=A.kc?i.Ad:0)c.la=d.la=0,i.Za||(c.Na=d.Na=0),i.Hc=0,i.Gc=0,i.ia=0;else{var b,B;if(c=d,d=u,f=A.Pa.Xc,h=A.ya[A.aa+A.ja],p=A.pb[h.$b],l=h.ad,m=0,g=A.rb[A.sb-1],v=y=0,o(l,m,0,384),h.Za)var j=0,_=f[3];else{w=s(16);var C=c.Na+g.Na;if(C=no(d,f[1],C,p.Eb,0,w,0),c.Na=g.Na=(0<C)+0,1<C)on(w,0,l,m);else{var x=w[0]+3>>3;for(w=0;256>w;w+=16)l[m+w]=x}j=1,_=f[0]}var E=15&c.la,Q=15&g.la;for(w=0;4>w;++w){var F=1&Q;for(x=B=0;4>x;++x)E=E>>1|(F=(C=no(d,_,C=F+(1&E),p.Sc,j,l,m))>j)<<7,B=B<<2|(3<C?3:1<C?2:0!=l[m+0]),m+=16;E>>=4,Q=Q>>1|F<<7,y=(y<<8|B)>>>0}for(_=E,j=Q>>4,b=0;4>b;b+=2){for(B=0,E=c.la>>4+b,Q=g.la>>4+b,w=0;2>w;++w){for(F=1&Q,x=0;2>x;++x)C=F+(1&E),E=E>>1|(F=0<(C=no(d,f[2],C,p.Qc,0,l,m)))<<3,B=B<<2|(3<C?3:1<C?2:0!=l[m+0]),m+=16;E>>=2,Q=Q>>1|F<<5}v|=B<<4*b,_|=E<<4<<b,j|=(240&Q)<<b}c.la=_,g.la=j,h.Hc=y,h.Gc=v,h.ia=43690&v?0:p.ia,f=!(y|v)}if(0<A.L&&(A.wa[A.Y+A.ja]=A.gd[i.$b][i.Za],A.wa[A.Y+A.ja].La|=!f),u.Ka)return Xe(e,7,"Premature end-of-file encountered.")}if(Ze(e),A=r,u=1,i=(a=e).D,c=0<a.L&&a.M>=a.zb&&a.M<=a.Va,0==a.Aa)e:{if(i.M=a.M,i.uc=c,Lr(a,i),u=1,i=(B=a.D).Nb,c=(v=Ro[a.L])*a.R,d=v/2*a.B,w=16*i*a.R,x=8*i*a.B,f=a.sa,h=a.ta-c+w,p=a.qa,l=a.ra-d+x,m=a.Ha,g=a.Ia-d+x,Q=0==(E=B.M),y=E>=a.Va-1,2==a.Aa&&Lr(a,B),B.uc)for(F=(C=a).D.M,t(C.D.uc),B=C.yb;B<C.Hb;++B){j=B,_=F;var U=(S=(M=C).D).Nb;b=M.R;var S=S.wa[S.Y+j],L=M.sa,T=M.ta+16*U*b+16*j,H=S.dd,I=S.tc;if(0!=I)if(t(3<=I),1==M.L)0<j&&wn(L,T,b,I+4),S.La&&Bn(L,T,b,I),0<_&&vn(L,T,b,I+4),S.La&&bn(L,T,b,I);else{var P=M.B,O=M.qa,k=M.ra+8*U*P+8*j,R=M.Ha,M=M.Ia+8*U*P+8*j;U=S.ld,0<j&&(dn(L,T,b,I+4,H,U),hn(O,k,R,M,P,I+4,H,U)),S.La&&(mn(L,T,b,I,H,U),yn(O,k,R,M,P,I,H,U)),0<_&&(ln(L,T,b,I+4,H,U),fn(O,k,R,M,P,I+4,H,U)),S.La&&(pn(L,T,b,I,H,U),gn(O,k,R,M,P,I,H,U))}}if(a.ia&&alert("todo:DitherRow"),null!=A.put){if(B=16*E,E=16*(E+1),Q?(A.y=a.sa,A.O=a.ta+w,A.f=a.qa,A.N=a.ra+x,A.ea=a.Ha,A.W=a.Ia+x):(B-=v,A.y=f,A.O=h,A.f=p,A.N=l,A.ea=m,A.W=g),y||(E-=v),E>A.o&&(E=A.o),A.F=null,A.J=null,null!=a.Fa&&0<a.Fa.length&&B<E&&(A.J=lr(a,A,B,E-B),A.F=a.mb,null==A.F&&0==A.F.length)){u=Xe(a,3,"Could not decode alpha data.");break e}B<A.j&&(v=A.j-B,B=A.j,t(!(1&v)),A.O+=a.R*v,A.N+=a.B*(v>>1),A.W+=a.B*(v>>1),null!=A.F&&(A.J+=A.width*v)),B<E&&(A.O+=A.v,A.N+=A.v>>1,A.W+=A.v>>1,null!=A.F&&(A.J+=A.v),A.ka=B-A.j,A.U=A.va-A.v,A.T=E-B,u=A.put(A))}i+1!=a.Ic||y||(n(a.sa,a.ta-c,f,h+16*a.R,c),n(a.qa,a.ra-d,p,l+8*a.B,d),n(a.Ha,a.Ia-d,m,g+8*a.B,d))}if(!u)return Xe(e,6,"Output aborted.")}return 1}(e,r)),null!=r.bc&&r.bc(r),a&=1}return a?(e.cb=0,a):0}function et(e,t,r,n,o){o=e[t+r+32*n]+(o>>3),e[t+r+32*n]=-256&o?0>o?0:255:o}function tt(e,t,r,n,o,s){et(e,t,0,r,n+o),et(e,t,1,r,n+s),et(e,t,2,r,n-s),et(e,t,3,r,n-o)}function rt(e){return(20091*e>>16)+e}function nt(e,t,r,n){var o,i=0,a=s(16);for(o=0;4>o;++o){var A=e[t+0]+e[t+8],u=e[t+0]-e[t+8],c=(35468*e[t+4]>>16)-rt(e[t+12]),l=rt(e[t+4])+(35468*e[t+12]>>16);a[i+0]=A+l,a[i+1]=u+c,a[i+2]=u-c,a[i+3]=A-l,i+=4,t++}for(o=i=0;4>o;++o)A=(e=a[i+0]+4)+a[i+8],u=e-a[i+8],c=(35468*a[i+4]>>16)-rt(a[i+12]),et(r,n,0,0,A+(l=rt(a[i+4])+(35468*a[i+12]>>16))),et(r,n,1,0,u+c),et(r,n,2,0,u-c),et(r,n,3,0,A-l),i++,n+=32}function ot(e,t,r,n){var o=e[t+0]+4,s=35468*e[t+4]>>16,i=rt(e[t+4]),a=35468*e[t+1]>>16;tt(r,n,0,o+i,e=rt(e[t+1]),a),tt(r,n,1,o+s,e,a),tt(r,n,2,o-s,e,a),tt(r,n,3,o-i,e,a)}function st(e,t,r,n,o){nt(e,t,r,n),o&&nt(e,t+16,r,n+4)}function it(e,t,r,n){sn(e,t+0,r,n,1),sn(e,t+32,r,n+128,1)}function at(e,t,r,n){var o;for(e=e[t+0]+4,o=0;4>o;++o)for(t=0;4>t;++t)et(r,n,t,o,e)}function At(e,t,r,n){e[t+0]&&un(e,t+0,r,n),e[t+16]&&un(e,t+16,r,n+4),e[t+32]&&un(e,t+32,r,n+128),e[t+48]&&un(e,t+48,r,n+128+4)}function ut(e,t,r,n){var o,i=s(16);for(o=0;4>o;++o){var a=e[t+0+o]+e[t+12+o],A=e[t+4+o]+e[t+8+o],u=e[t+4+o]-e[t+8+o],c=e[t+0+o]-e[t+12+o];i[0+o]=a+A,i[8+o]=a-A,i[4+o]=c+u,i[12+o]=c-u}for(o=0;4>o;++o)a=(e=i[0+4*o]+3)+i[3+4*o],A=i[1+4*o]+i[2+4*o],u=i[1+4*o]-i[2+4*o],c=e-i[3+4*o],r[n+0]=a+A>>3,r[n+16]=c+u>>3,r[n+32]=a-A>>3,r[n+48]=c-u>>3,n+=64}function ct(e,t,r){var n,o=t-32,s=Tn,i=255-e[o-1];for(n=0;n<r;++n){var a,A=s,u=i+e[t-1];for(a=0;a<r;++a)e[t+a]=A[u+e[o+a]];t+=32}}function lt(e,t){ct(e,t,4)}function dt(e,t){ct(e,t,8)}function ft(e,t){ct(e,t,16)}function ht(e,t){var r;for(r=0;16>r;++r)n(e,t+32*r,e,t-32,16)}function pt(e,t){var r;for(r=16;0<r;--r)o(e,t,e[t-1],16),t+=32}function mt(e,t,r){var n;for(n=0;16>n;++n)o(t,r+32*n,e,16)}function gt(e,t){var r,n=16;for(r=0;16>r;++r)n+=e[t-1+32*r]+e[t+r-32];mt(n>>5,e,t)}function yt(e,t){var r,n=8;for(r=0;16>r;++r)n+=e[t-1+32*r];mt(n>>4,e,t)}function vt(e,t){var r,n=8;for(r=0;16>r;++r)n+=e[t+r-32];mt(n>>4,e,t)}function wt(e,t){mt(128,e,t)}function bt(e,t,r){return e+2*t+r+2>>2}function Bt(e,t){var r,o=t-32;for(o=new Uint8Array([bt(e[o-1],e[o+0],e[o+1]),bt(e[o+0],e[o+1],e[o+2]),bt(e[o+1],e[o+2],e[o+3]),bt(e[o+2],e[o+3],e[o+4])]),r=0;4>r;++r)n(e,t+32*r,o,0,o.length)}function jt(e,t){var r=e[t-1],n=e[t-1+32],o=e[t-1+64],s=e[t-1+96];Q(e,t+0,16843009*bt(e[t-1-32],r,n)),Q(e,t+32,16843009*bt(r,n,o)),Q(e,t+64,16843009*bt(n,o,s)),Q(e,t+96,16843009*bt(o,s,s))}function _t(e,t){var r,n=4;for(r=0;4>r;++r)n+=e[t+r-32]+e[t-1+32*r];for(n>>=3,r=0;4>r;++r)o(e,t+32*r,n,4)}function Ct(e,t){var r=e[t-1+0],n=e[t-1+32],o=e[t-1+64],s=e[t-1-32],i=e[t+0-32],a=e[t+1-32],A=e[t+2-32],u=e[t+3-32];e[t+0+96]=bt(n,o,e[t-1+96]),e[t+1+96]=e[t+0+64]=bt(r,n,o),e[t+2+96]=e[t+1+64]=e[t+0+32]=bt(s,r,n),e[t+3+96]=e[t+2+64]=e[t+1+32]=e[t+0+0]=bt(i,s,r),e[t+3+64]=e[t+2+32]=e[t+1+0]=bt(a,i,s),e[t+3+32]=e[t+2+0]=bt(A,a,i),e[t+3+0]=bt(u,A,a)}function xt(e,t){var r=e[t+1-32],n=e[t+2-32],o=e[t+3-32],s=e[t+4-32],i=e[t+5-32],a=e[t+6-32],A=e[t+7-32];e[t+0+0]=bt(e[t+0-32],r,n),e[t+1+0]=e[t+0+32]=bt(r,n,o),e[t+2+0]=e[t+1+32]=e[t+0+64]=bt(n,o,s),e[t+3+0]=e[t+2+32]=e[t+1+64]=e[t+0+96]=bt(o,s,i),e[t+3+32]=e[t+2+64]=e[t+1+96]=bt(s,i,a),e[t+3+64]=e[t+2+96]=bt(i,a,A),e[t+3+96]=bt(a,A,A)}function Et(e,t){var r=e[t-1+0],n=e[t-1+32],o=e[t-1+64],s=e[t-1-32],i=e[t+0-32],a=e[t+1-32],A=e[t+2-32],u=e[t+3-32];e[t+0+0]=e[t+1+64]=s+i+1>>1,e[t+1+0]=e[t+2+64]=i+a+1>>1,e[t+2+0]=e[t+3+64]=a+A+1>>1,e[t+3+0]=A+u+1>>1,e[t+0+96]=bt(o,n,r),e[t+0+64]=bt(n,r,s),e[t+0+32]=e[t+1+96]=bt(r,s,i),e[t+1+32]=e[t+2+96]=bt(s,i,a),e[t+2+32]=e[t+3+96]=bt(i,a,A),e[t+3+32]=bt(a,A,u)}function Nt(e,t){var r=e[t+0-32],n=e[t+1-32],o=e[t+2-32],s=e[t+3-32],i=e[t+4-32],a=e[t+5-32],A=e[t+6-32],u=e[t+7-32];e[t+0+0]=r+n+1>>1,e[t+1+0]=e[t+0+64]=n+o+1>>1,e[t+2+0]=e[t+1+64]=o+s+1>>1,e[t+3+0]=e[t+2+64]=s+i+1>>1,e[t+0+32]=bt(r,n,o),e[t+1+32]=e[t+0+96]=bt(n,o,s),e[t+2+32]=e[t+1+96]=bt(o,s,i),e[t+3+32]=e[t+2+96]=bt(s,i,a),e[t+3+64]=bt(i,a,A),e[t+3+96]=bt(a,A,u)}function Qt(e,t){var r=e[t-1+0],n=e[t-1+32],o=e[t-1+64],s=e[t-1+96];e[t+0+0]=r+n+1>>1,e[t+2+0]=e[t+0+32]=n+o+1>>1,e[t+2+32]=e[t+0+64]=o+s+1>>1,e[t+1+0]=bt(r,n,o),e[t+3+0]=e[t+1+32]=bt(n,o,s),e[t+3+32]=e[t+1+64]=bt(o,s,s),e[t+3+64]=e[t+2+64]=e[t+0+96]=e[t+1+96]=e[t+2+96]=e[t+3+96]=s}function Ft(e,t){var r=e[t-1+0],n=e[t-1+32],o=e[t-1+64],s=e[t-1+96],i=e[t-1-32],a=e[t+0-32],A=e[t+1-32],u=e[t+2-32];e[t+0+0]=e[t+2+32]=r+i+1>>1,e[t+0+32]=e[t+2+64]=n+r+1>>1,e[t+0+64]=e[t+2+96]=o+n+1>>1,e[t+0+96]=s+o+1>>1,e[t+3+0]=bt(a,A,u),e[t+2+0]=bt(i,a,A),e[t+1+0]=e[t+3+32]=bt(r,i,a),e[t+1+32]=e[t+3+64]=bt(n,r,i),e[t+1+64]=e[t+3+96]=bt(o,n,r),e[t+1+96]=bt(s,o,n)}function Ut(e,t){var r;for(r=0;8>r;++r)n(e,t+32*r,e,t-32,8)}function St(e,t){var r;for(r=0;8>r;++r)o(e,t,e[t-1],8),t+=32}function Lt(e,t,r){var n;for(n=0;8>n;++n)o(t,r+32*n,e,8)}function Tt(e,t){var r,n=8;for(r=0;8>r;++r)n+=e[t+r-32]+e[t-1+32*r];Lt(n>>4,e,t)}function Ht(e,t){var r,n=4;for(r=0;8>r;++r)n+=e[t+r-32];Lt(n>>3,e,t)}function It(e,t){var r,n=4;for(r=0;8>r;++r)n+=e[t-1+32*r];Lt(n>>3,e,t)}function Pt(e,t){Lt(128,e,t)}function Ot(e,t,r){var n=e[t-r],o=e[t+0],s=3*(o-n)+Sn[1020+e[t-2*r]-e[t+r]],i=Ln[112+(s+4>>3)];e[t-r]=Tn[255+n+Ln[112+(s+3>>3)]],e[t+0]=Tn[255+o-i]}function kt(e,t,r,n){var o=e[t+0],s=e[t+r];return Hn[255+e[t-2*r]-e[t-r]]>n||Hn[255+s-o]>n}function Rt(e,t,r,n){return 4*Hn[255+e[t-r]-e[t+0]]+Hn[255+e[t-2*r]-e[t+r]]<=n}function Mt(e,t,r,n,o){var s=e[t-3*r],i=e[t-2*r],a=e[t-r],A=e[t+0],u=e[t+r],c=e[t+2*r],l=e[t+3*r];return 4*Hn[255+a-A]+Hn[255+i-u]>n?0:Hn[255+e[t-4*r]-s]<=o&&Hn[255+s-i]<=o&&Hn[255+i-a]<=o&&Hn[255+l-c]<=o&&Hn[255+c-u]<=o&&Hn[255+u-A]<=o}function Dt(e,t,r,n){var o=2*n+1;for(n=0;16>n;++n)Rt(e,t+n,r,o)&&Ot(e,t+n,r)}function Kt(e,t,r,n){var o=2*n+1;for(n=0;16>n;++n)Rt(e,t+n*r,1,o)&&Ot(e,t+n*r,1)}function zt(e,t,r,n){var o;for(o=3;0<o;--o)Dt(e,t+=4*r,r,n)}function Vt(e,t,r,n){var o;for(o=3;0<o;--o)Kt(e,t+=4,r,n)}function qt(e,t,r,n,o,s,i,a){for(s=2*s+1;0<o--;){if(Mt(e,t,r,s,i))if(kt(e,t,r,a))Ot(e,t,r);else{var A=e,u=t,c=r,l=A[u-2*c],d=A[u-c],f=A[u+0],h=A[u+c],p=A[u+2*c],m=27*(y=Sn[1020+3*(f-d)+Sn[1020+l-h]])+63>>7,g=18*y+63>>7,y=9*y+63>>7;A[u-3*c]=Tn[255+A[u-3*c]+y],A[u-2*c]=Tn[255+l+g],A[u-c]=Tn[255+d+m],A[u+0]=Tn[255+f-m],A[u+c]=Tn[255+h-g],A[u+2*c]=Tn[255+p-y]}t+=n}}function Gt(e,t,r,n,o,s,i,a){for(s=2*s+1;0<o--;){if(Mt(e,t,r,s,i))if(kt(e,t,r,a))Ot(e,t,r);else{var A=e,u=t,c=r,l=A[u-c],d=A[u+0],f=A[u+c],h=Ln[112+(4+(p=3*(d-l))>>3)],p=Ln[112+(p+3>>3)],m=h+1>>1;A[u-2*c]=Tn[255+A[u-2*c]+m],A[u-c]=Tn[255+l+p],A[u+0]=Tn[255+d-h],A[u+c]=Tn[255+f-m]}t+=n}}function Xt(e,t,r,n,o,s){qt(e,t,r,1,16,n,o,s)}function Wt(e,t,r,n,o,s){qt(e,t,1,r,16,n,o,s)}function Jt(e,t,r,n,o,s){var i;for(i=3;0<i;--i)Gt(e,t+=4*r,r,1,16,n,o,s)}function Yt(e,t,r,n,o,s){var i;for(i=3;0<i;--i)Gt(e,t+=4,1,r,16,n,o,s)}function Zt(e,t,r,n,o,s,i,a){qt(e,t,o,1,8,s,i,a),qt(r,n,o,1,8,s,i,a)}function $t(e,t,r,n,o,s,i,a){qt(e,t,1,o,8,s,i,a),qt(r,n,1,o,8,s,i,a)}function er(e,t,r,n,o,s,i,a){Gt(e,t+4*o,o,1,8,s,i,a),Gt(r,n+4*o,o,1,8,s,i,a)}function tr(e,t,r,n,o,s,i,a){Gt(e,t+4,1,o,8,s,i,a),Gt(r,n+4,1,o,8,s,i,a)}function rr(){this.ba=new ie,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Ae,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function nr(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function or(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function sr(){this.ua=0,this.Wa=new H,this.vb=new H,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new f,this.yc=new l}function ir(){this.xb=this.a=0,this.l=new qe,this.ca=new ie,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new b,this.Pb=0,this.wd=new b,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new sr,this.ab=0,this.gc=i(4,or),this.Oc=0}function ar(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new qe,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function Ar(e,t,r,n,o,s,i){for(e=null==e?0:e[t+0],t=0;t<i;++t)o[s+t]=e+r[n+t]&255,e=o[s+t]}function ur(e,t,r,n,o,s,i){var a;if(null==e)Ar(null,null,r,n,o,s,i);else for(a=0;a<i;++a)o[s+a]=e[t+a]+r[n+a]&255}function cr(e,t,r,n,o,s,i){if(null==e)Ar(null,null,r,n,o,s,i);else{var a,A=e[t+0],u=A,c=A;for(a=0;a<i;++a)u=c+(A=e[t+a])-u,c=r[n+a]+(-256&u?0>u?0:255:u)&255,u=A,o[s+a]=c}}function lr(e,r,o,i){var a=r.width,A=r.o;if(t(null!=e&&null!=r),0>o||0>=i||o+i>A)return null;if(!e.Cc){if(null==e.ga){var u;if(e.ga=new ar,(u=null==e.ga)||(u=r.width*r.o,t(0==e.Gb.length),e.Gb=s(u),e.Uc=0,null==e.Gb?u=0:(e.mb=e.Gb,e.nb=e.Uc,e.rc=null,u=1),u=!u),!u){u=e.ga;var c=e.Fa,l=e.P,d=e.qc,f=e.mb,h=e.nb,p=l+1,m=d-1,y=u.l;if(t(null!=c&&null!=f&&null!=r),go[0]=null,go[1]=Ar,go[2]=ur,go[3]=cr,u.ca=f,u.tb=h,u.c=r.width,u.i=r.height,t(0<u.c&&0<u.i),1>=d)r=0;else if(u.$a=c[l+0]>>0&3,u.Z=c[l+0]>>2&3,u.Lc=c[l+0]>>4&3,l=c[l+0]>>6&3,0>u.$a||1<u.$a||4<=u.Z||1<u.Lc||l)r=0;else if(y.put=fe,y.ac=de,y.bc=he,y.ma=u,y.width=r.width,y.height=r.height,y.Da=r.Da,y.v=r.v,y.va=r.va,y.j=r.j,y.o=r.o,u.$a)e:{t(1==u.$a),r=Ne();t:for(;;){if(null==r){r=0;break e}if(t(null!=u),u.mc=r,r.c=u.c,r.i=u.i,r.l=u.l,r.l.ma=u,r.l.width=u.c,r.l.height=u.i,r.a=0,g(r.m,c,p,m),!Qe(u.c,u.i,1,r,null))break t;if(1==r.ab&&3==r.gc[0].hc&&je(r.s)?(u.ic=1,c=r.c*r.i,r.Ta=null,r.Ua=0,r.V=s(c),r.Ba=0,null==r.V?(r.a=1,r=0):r=1):(u.ic=0,r=Fe(r,u.c)),!r)break t;r=1;break e}u.mc=null,r=0}else r=m>=u.c*u.i;u=!r}if(u)return null;1!=e.ga.Lc?e.Ga=0:i=A-o}t(null!=e.ga),t(o+i<=A);e:{if(r=(c=e.ga).c,A=c.l.o,0==c.$a){if(p=e.rc,m=e.Vc,y=e.Fa,l=e.P+1+o*r,d=e.mb,f=e.nb+o*r,t(l<=e.P+e.qc),0!=c.Z)for(t(null!=go[c.Z]),u=0;u<i;++u)go[c.Z](p,m,y,l,d,f,r),p=d,m=f,f+=r,l+=r;else for(u=0;u<i;++u)n(d,f,y,l,r),p=d,m=f,f+=r,l+=r;e.rc=p,e.Vc=m}else{if(t(null!=c.mc),r=o+i,t(null!=(u=c.mc)),t(r<=u.i),u.C>=r)r=1;else if(c.ic||mr(),c.ic){c=u.V,p=u.Ba,m=u.c;var v=u.i,w=(y=1,l=u.$/m,d=u.$%m,f=u.m,h=u.s,u.$),b=m*v,B=m*r,_=h.wc,x=w<B?we(h,d,l):null;t(w<=b),t(r<=v),t(je(h));t:for(;;){for(;!f.h&&w<B;){if(d&_||(x=we(h,d,l)),t(null!=x),C(f),256>(v=ye(x.G[0],x.H[0],f)))c[p+w]=v,++w,++d>=m&&(d=0,++l<=r&&!(l%16)&&Ce(u,l));else{if(!(280>v)){y=0;break t}v=me(v-256,f);var E,N=ye(x.G[4],x.H[4],f);if(C(f),!(w>=(N=ge(m,N=me(N,f)))&&b-w>=v)){y=0;break t}for(E=0;E<v;++E)c[p+w+E]=c[p+w+E-N];for(w+=v,d+=v;d>=m;)d-=m,++l<=r&&!(l%16)&&Ce(u,l);w<B&&d&_&&(x=we(h,d,l))}t(f.h==j(f))}Ce(u,l>r?r:l);break t}!y||f.h&&w<b?(y=0,u.a=f.h?5:3):u.$=w,r=y}else r=xe(u,u.V,u.Ba,u.c,u.i,r,Ue);if(!r){i=0;break e}}o+i>=A&&(e.Cc=1),i=1}if(!i)return null;if(e.Cc&&(null!=(i=e.ga)&&(i.mc=null),e.ga=null,0<e.Ga))return alert("todo:WebPDequantizeLevels"),null}return e.nb+o*a}function dr(e,t,r,n,o,s){for(;0<o--;){var i,a=e,A=t+(r?1:0),u=e,c=t+(r?0:3);for(i=0;i<n;++i){var l=u[c+4*i];255!=l&&(l*=32897,a[A+4*i+0]=a[A+4*i+0]*l>>23,a[A+4*i+1]=a[A+4*i+1]*l>>23,a[A+4*i+2]=a[A+4*i+2]*l>>23)}t+=s}}function fr(e,t,r,n,o){for(;0<n--;){var s;for(s=0;s<r;++s){var i=e[t+2*s+0],a=15&(u=e[t+2*s+1]),A=4369*a,u=(240&u|u>>4)*A>>16;e[t+2*s+0]=(240&i|i>>4)*A>>16&240|(15&i|i<<4)*A>>16>>4&15,e[t+2*s+1]=240&u|a}t+=o}}function hr(e,t,r,n,o,s,i,a){var A,u,c=255;for(u=0;u<o;++u){for(A=0;A<n;++A){var l=e[t+A];s[i+4*A]=l,c&=l}t+=r,i+=a}return 255!=c}function pr(e,t,r,n,o){var s;for(s=0;s<o;++s)r[n+s]=e[t+s]>>8}function mr(){jn=dr,_n=fr,Cn=hr,xn=pr}function gr(r,n,o){e[r]=function(e,r,s,i,a,A,u,c,l,d,f,h,p,m,g,y,v){var w,b=v-1>>1,B=a[A+0]|u[c+0]<<16,j=l[d+0]|f[h+0]<<16;t(null!=e);var _=3*B+j+131074>>2;for(n(e[r+0],255&_,_>>16,p,m),null!=s&&(_=3*j+B+131074>>2,n(s[i+0],255&_,_>>16,g,y)),w=1;w<=b;++w){var C=a[A+w]|u[c+w]<<16,x=l[d+w]|f[h+w]<<16,E=B+C+j+x+524296,N=E+2*(C+j)>>3;_=N+B>>1,B=(E=E+2*(B+x)>>3)+C>>1,n(e[r+2*w-1],255&_,_>>16,p,m+(2*w-1)*o),n(e[r+2*w-0],255&B,B>>16,p,m+(2*w-0)*o),null!=s&&(_=E+j>>1,B=N+x>>1,n(s[i+2*w-1],255&_,_>>16,g,y+(2*w-1)*o),n(s[i+2*w+0],255&B,B>>16,g,y+(2*w+0)*o)),B=C,j=x}1&v||(_=3*B+j+131074>>2,n(e[r+v-1],255&_,_>>16,p,m+(v-1)*o),null!=s&&(_=3*j+B+131074>>2,n(s[i+v-1],255&_,_>>16,g,y+(v-1)*o)))}}function yr(){yo[In]=vo,yo[Pn]=bo,yo[On]=wo,yo[kn]=Bo,yo[Rn]=jo,yo[Mn]=_o,yo[Dn]=Co,yo[Kn]=bo,yo[zn]=Bo,yo[Vn]=jo,yo[qn]=_o}function vr(e){return e&~Uo?0>e?0:255:e>>Fo}function wr(e,t){return vr((19077*e>>8)+(26149*t>>8)-14234)}function br(e,t,r){return vr((19077*e>>8)-(6419*t>>8)-(13320*r>>8)+8708)}function Br(e,t){return vr((19077*e>>8)+(33050*t>>8)-17685)}function jr(e,t,r,n,o){n[o+0]=wr(e,r),n[o+1]=br(e,t,r),n[o+2]=Br(e,t)}function _r(e,t,r,n,o){n[o+0]=Br(e,t),n[o+1]=br(e,t,r),n[o+2]=wr(e,r)}function Cr(e,t,r,n,o){var s=br(e,t,r);t=s<<3&224|Br(e,t)>>3,n[o+0]=248&wr(e,r)|s>>5,n[o+1]=t}function xr(e,t,r,n,o){var s=240&Br(e,t)|15;n[o+0]=240&wr(e,r)|br(e,t,r)>>4,n[o+1]=s}function Er(e,t,r,n,o){n[o+0]=255,jr(e,t,r,n,o+1)}function Nr(e,t,r,n,o){_r(e,t,r,n,o),n[o+3]=255}function Qr(e,t,r,n,o){jr(e,t,r,n,o),n[o+3]=255}function Ve(e,t){return 0>e?0:e>t?t:e}function Fr(t,r,n){e[t]=function(e,t,o,s,i,a,A,u,c){for(var l=u+(-2&c)*n;u!=l;)r(e[t+0],o[s+0],i[a+0],A,u),r(e[t+1],o[s+0],i[a+0],A,u+n),t+=2,++s,++a,u+=2*n;1&c&&r(e[t+0],o[s+0],i[a+0],A,u)}}function Ur(e,t,r){return 0==r?0==e?0==t?6:5:0==t?4:0:r}function Sr(e,t,r,n,o){switch(e>>>30){case 3:sn(t,r,n,o,0);break;case 2:an(t,r,n,o);break;case 1:un(t,r,n,o)}}function Lr(e,t){var r,s,i=t.M,a=t.Nb,A=e.oc,u=e.pc+40,c=e.oc,l=e.pc+584,d=e.oc,f=e.pc+600;for(r=0;16>r;++r)A[u+32*r-1]=129;for(r=0;8>r;++r)c[l+32*r-1]=129,d[f+32*r-1]=129;for(0<i?A[u-1-32]=c[l-1-32]=d[f-1-32]=129:(o(A,u-32-1,127,21),o(c,l-32-1,127,9),o(d,f-32-1,127,9)),s=0;s<e.za;++s){var h=t.ya[t.aa+s];if(0<s){for(r=-1;16>r;++r)n(A,u+32*r-4,A,u+32*r+12,4);for(r=-1;8>r;++r)n(c,l+32*r-4,c,l+32*r+4,4),n(d,f+32*r-4,d,f+32*r+4,4)}var p=e.Gd,m=e.Hd+s,g=h.ad,y=h.Hc;if(0<i&&(n(A,u-32,p[m].y,0,16),n(c,l-32,p[m].f,0,8),n(d,f-32,p[m].ea,0,8)),h.Za){var v=A,w=u-32+16;for(0<i&&(s>=e.za-1?o(v,w,p[m].y[15],4):n(v,w,p[m+1].y,0,4)),r=0;4>r;r++)v[w+128+r]=v[w+256+r]=v[w+384+r]=v[w+0+r];for(r=0;16>r;++r,y<<=2)v=A,w=u+ko[r],fo[h.Ob[r]](v,w),Sr(y,g,16*+r,v,w)}else if(v=Ur(s,i,h.Ob[0]),lo[v](A,u),0!=y)for(r=0;16>r;++r,y<<=2)Sr(y,g,16*+r,A,u+ko[r]);for(r=h.Gc,v=Ur(s,i,h.Dd),ho[v](c,l),ho[v](d,f),y=g,v=c,w=l,255&(h=r>>0)&&(170&h?An(y,256,v,w):cn(y,256,v,w)),h=d,y=f,255&(r>>=8)&&(170&r?An(g,320,h,y):cn(g,320,h,y)),i<e.Ub-1&&(n(p[m].y,0,A,u+480,16),n(p[m].f,0,c,l+224,8),n(p[m].ea,0,d,f+224,8)),r=8*a*e.B,p=e.sa,m=e.ta+16*s+16*a*e.R,g=e.qa,h=e.ra+8*s+r,y=e.Ha,v=e.Ia+8*s+r,r=0;16>r;++r)n(p,m+r*e.R,A,u+32*r,16);for(r=0;8>r;++r)n(g,h+r*e.B,c,l+32*r,8),n(y,v+r*e.B,d,f+32*r,8)}}function Tr(e,n,o,s,i,a,A,u,c){var l=[0],d=[0],f=0,h=null!=c?c.kd:0,p=null!=c?c:new nr;if(null==e||12>o)return 7;p.data=e,p.w=n,p.ha=o,n=[n],o=[o],p.gb=[p.gb];e:{var m=n,y=o,v=p.gb;if(t(null!=e),t(null!=y),t(null!=v),v[0]=0,12<=y[0]&&!r(e,m[0],"RIFF")){if(r(e,m[0]+8,"WEBP")){v=3;break e}var w=S(e,m[0]+4);if(12>w||4294967286<w){v=3;break e}if(h&&w>y[0]-8){v=7;break e}v[0]=w,m[0]+=12,y[0]-=12}v=0}if(0!=v)return v;for(w=0<p.gb[0],o=o[0];;){e:{var B=e;y=n,v=o;var j=l,_=d,C=m=[0];if((N=f=[f])[0]=0,8>v[0])v=7;else{if(!r(B,y[0],"VP8X")){if(10!=S(B,y[0]+4)){v=3;break e}if(18>v[0]){v=7;break e}var x=S(B,y[0]+8),E=1+U(B,y[0]+12);if(2147483648<=E*(B=1+U(B,y[0]+15))){v=3;break e}null!=C&&(C[0]=x),null!=j&&(j[0]=E),null!=_&&(_[0]=B),y[0]+=18,v[0]-=18,N[0]=1}v=0}}if(f=f[0],m=m[0],0!=v)return v;if(y=!!(2&m),!w&&f)return 3;if(null!=a&&(a[0]=!!(16&m)),null!=A&&(A[0]=y),null!=u&&(u[0]=0),A=l[0],m=d[0],f&&y&&null==c){v=0;break}if(4>o){v=7;break}if(w&&f||!w&&!f&&!r(e,n[0],"ALPH")){o=[o],p.na=[p.na],p.P=[p.P],p.Sa=[p.Sa];e:{x=e,v=n,w=o;var N=p.gb;j=p.na,_=p.P,C=p.Sa,E=22,t(null!=x),t(null!=w),B=v[0];var Q=w[0];for(t(null!=j),t(null!=C),j[0]=null,_[0]=null,C[0]=0;;){if(v[0]=B,w[0]=Q,8>Q){v=7;break e}var F=S(x,B+4);if(4294967286<F){v=3;break e}var L=8+F+1&-2;if(E+=L,0<N&&E>N){v=3;break e}if(!r(x,B,"VP8 ")||!r(x,B,"VP8L")){v=0;break e}if(Q[0]<L){v=7;break e}r(x,B,"ALPH")||(j[0]=x,_[0]=B+8,C[0]=F),B+=L,Q-=L}}if(o=o[0],p.na=p.na[0],p.P=p.P[0],p.Sa=p.Sa[0],0!=v)break}o=[o],p.Ja=[p.Ja],p.xa=[p.xa];e:if(N=e,v=n,w=o,j=p.gb[0],_=p.Ja,C=p.xa,x=v[0],B=!r(N,x,"VP8 "),E=!r(N,x,"VP8L"),t(null!=N),t(null!=w),t(null!=_),t(null!=C),8>w[0])v=7;else{if(B||E){if(N=S(N,x+4),12<=j&&N>j-12){v=3;break e}if(h&&N>w[0]-8){v=7;break e}_[0]=N,v[0]+=8,w[0]-=8,C[0]=E}else C[0]=5<=w[0]&&47==N[x+0]&&!(N[x+4]>>5),_[0]=w[0];v=0}if(o=o[0],p.Ja=p.Ja[0],p.xa=p.xa[0],n=n[0],0!=v)break;if(4294967286<p.Ja)return 3;if(null==u||y||(u[0]=p.xa?2:1),A=[A],m=[m],p.xa){if(5>o){v=7;break}u=A,h=m,y=a,null==e||5>o?e=0:5<=o&&47==e[n+0]&&!(e[n+4]>>5)?(w=[0],N=[0],j=[0],g(_=new b,e,n,o),pe(_,w,N,j)?(null!=u&&(u[0]=w[0]),null!=h&&(h[0]=N[0]),null!=y&&(y[0]=j[0]),e=1):e=0):e=0}else{if(10>o){v=7;break}u=m,null==e||10>o||!We(e,n+3,o-3)?e=0:(h=e[n+0]|e[n+1]<<8|e[n+2]<<16,y=16383&(e[n+7]<<8|e[n+6]),e=16383&(e[n+9]<<8|e[n+8]),1&h||3<(h>>1&7)||!(h>>4&1)||h>>5>=p.Ja||!y||!e?e=0:(A&&(A[0]=y),u&&(u[0]=e),e=1))}if(!e)return 3;if(A=A[0],m=m[0],f&&(l[0]!=A||d[0]!=m))return 3;null!=c&&(c[0]=p,c.offset=n-c.w,t(4294967286>n-c.w),t(c.offset==c.ha-o));break}return 0==v||7==v&&f&&null==c?(null!=a&&(a[0]|=null!=p.na&&0<p.na.length),null!=s&&(s[0]=A),null!=i&&(i[0]=m),0):v}function Hr(e,t,r){var n=t.width,o=t.height,s=0,i=0,a=n,A=o;if(t.Da=null!=e&&0<e.Da,t.Da&&(a=e.cd,A=e.bd,s=e.v,i=e.j,11>r||(s&=-2,i&=-2),0>s||0>i||0>=a||0>=A||s+a>n||i+A>o))return 0;if(t.v=s,t.j=i,t.va=s+a,t.o=i+A,t.U=a,t.T=A,t.da=null!=e&&0<e.da,t.da){if(!I(a,A,r=[e.ib],s=[e.hb]))return 0;t.ib=r[0],t.hb=s[0]}return t.ob=null!=e&&e.ob,t.Kb=null==e||!e.Sd,t.da&&(t.ob=t.ib<3*n/4&&t.hb<3*o/4,t.Kb=0),1}function Ir(e){if(null==e)return 2;if(11>e.S){var t=e.f.RGBA;t.fb+=(e.height-1)*t.A,t.A=-t.A}else t=e.f.kb,e=e.height,t.O+=(e-1)*t.fa,t.fa=-t.fa,t.N+=(e-1>>1)*t.Ab,t.Ab=-t.Ab,t.W+=(e-1>>1)*t.Db,t.Db=-t.Db,null!=t.F&&(t.J+=(e-1)*t.lb,t.lb=-t.lb);return 0}function Pr(e,t,r,n){if(null==n||0>=e||0>=t)return 2;if(null!=r){if(r.Da){var o=r.cd,i=r.bd,a=-2&r.v,A=-2&r.j;if(0>a||0>A||0>=o||0>=i||a+o>e||A+i>t)return 2;e=o,t=i}if(r.da){if(!I(e,t,o=[r.ib],i=[r.hb]))return 2;e=o[0],t=i[0]}}n.width=e,n.height=t;e:{var u=n.width,c=n.height;if(e=n.S,0>=u||0>=c||!(e>=In&&13>e))e=2;else{if(0>=n.Rd&&null==n.sd){a=i=o=t=0;var l=(A=u*Ko[e])*c;if(11>e||(i=(c+1)/2*(t=(u+1)/2),12==e&&(a=(o=u)*c)),null==(c=s(l+2*i+a))){e=1;break e}n.sd=c,11>e?((u=n.f.RGBA).eb=c,u.fb=0,u.A=A,u.size=l):((u=n.f.kb).y=c,u.O=0,u.fa=A,u.Fd=l,u.f=c,u.N=0+l,u.Ab=t,u.Cd=i,u.ea=c,u.W=0+l+i,u.Db=t,u.Ed=i,12==e&&(u.F=c,u.J=0+l+2*i),u.Tc=a,u.lb=o)}if(t=1,o=n.S,i=n.width,a=n.height,o>=In&&13>o)if(11>o)e=n.f.RGBA,t&=(A=Math.abs(e.A))*(a-1)+i<=e.size,t&=A>=i*Ko[o],t&=null!=e.eb;else{e=n.f.kb,A=(i+1)/2,l=(a+1)/2,u=Math.abs(e.fa),c=Math.abs(e.Ab);var d=Math.abs(e.Db),f=Math.abs(e.lb),h=f*(a-1)+i;t&=u*(a-1)+i<=e.Fd,t&=c*(l-1)+A<=e.Cd,t=(t&=d*(l-1)+A<=e.Ed)&u>=i&c>=A&d>=A,t&=null!=e.y,t&=null!=e.f,t&=null!=e.ea,12==o&&(t&=f>=i,t&=h<=e.Tc,t&=null!=e.F)}else t=0;e=t?0:2}}return 0!=e||null!=r&&r.fd&&(e=Ir(n)),e}var Or=64,kr=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],Rr=24,Mr=32,Dr=8,Kr=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];k("Predictor0","PredictorAdd0"),e.Predictor0=function(){return 4278190080},e.Predictor1=function(e){return e},e.Predictor2=function(e,t,r){return t[r+0]},e.Predictor3=function(e,t,r){return t[r+1]},e.Predictor4=function(e,t,r){return t[r-1]},e.Predictor5=function(e,t,r){return M(M(e,t[r+1]),t[r+0])},e.Predictor6=function(e,t,r){return M(e,t[r-1])},e.Predictor7=function(e,t,r){return M(e,t[r+0])},e.Predictor8=function(e,t,r){return M(t[r-1],t[r+0])},e.Predictor9=function(e,t,r){return M(t[r+0],t[r+1])},e.Predictor10=function(e,t,r){return M(M(e,t[r-1]),M(t[r+0],t[r+1]))},e.Predictor11=function(e,t,r){var n=t[r+0];return 0>=z(n>>24&255,e>>24&255,(t=t[r-1])>>24&255)+z(n>>16&255,e>>16&255,t>>16&255)+z(n>>8&255,e>>8&255,t>>8&255)+z(255&n,255&e,255&t)?n:e},e.Predictor12=function(e,t,r){var n=t[r+0];return(D((e>>24&255)+(n>>24&255)-((t=t[r-1])>>24&255))<<24|D((e>>16&255)+(n>>16&255)-(t>>16&255))<<16|D((e>>8&255)+(n>>8&255)-(t>>8&255))<<8|D((255&e)+(255&n)-(255&t)))>>>0},e.Predictor13=function(e,t,r){var n=t[r-1];return(K((e=M(e,t[r+0]))>>24&255,n>>24&255)<<24|K(e>>16&255,n>>16&255)<<16|K(e>>8&255,n>>8&255)<<8|K(e>>0&255,n>>0&255))>>>0};var zr=e.PredictorAdd0;e.PredictorAdd1=V,k("Predictor2","PredictorAdd2"),k("Predictor3","PredictorAdd3"),k("Predictor4","PredictorAdd4"),k("Predictor5","PredictorAdd5"),k("Predictor6","PredictorAdd6"),k("Predictor7","PredictorAdd7"),k("Predictor8","PredictorAdd8"),k("Predictor9","PredictorAdd9"),k("Predictor10","PredictorAdd10"),k("Predictor11","PredictorAdd11"),k("Predictor12","PredictorAdd12"),k("Predictor13","PredictorAdd13");var Vr=e.PredictorAdd2;W("ColorIndexInverseTransform","MapARGB","32b",(function(e){return e>>8&255}),(function(e){return e})),W("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",(function(e){return e}),(function(e){return e>>8&255}));var qr,Gr=e.ColorIndexInverseTransform,Xr=e.MapARGB,Wr=e.VP8LColorIndexInverseTransformAlpha,Jr=e.MapAlpha,Yr=e.VP8LPredictorsAdd=[];Yr.length=16,(e.VP8LPredictors=[]).length=16,(e.VP8LPredictorsAdd_C=[]).length=16,(e.VP8LPredictors_C=[]).length=16;var Zr,$r,en,tn,rn,nn,on,sn,an,An,un,cn,ln,dn,fn,hn,pn,mn,gn,yn,vn,wn,bn,Bn,jn,_n,Cn,xn,En=s(511),Nn=s(2041),Qn=s(225),Fn=s(767),Un=0,Sn=Nn,Ln=Qn,Tn=Fn,Hn=En,In=0,Pn=1,On=2,kn=3,Rn=4,Mn=5,Dn=6,Kn=7,zn=8,Vn=9,qn=10,Gn=[2,3,7],Xn=[3,3,11],Wn=[280,256,256,256,40],Jn=[0,1,1,1,0],Yn=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Zn=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],$n=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],eo=8,to=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],ro=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],no=null,oo=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],so=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],io=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],ao=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],Ao=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],uo=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],co=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],lo=[],fo=[],ho=[],po=1,mo=2,go=[],yo=[];gr("UpsampleRgbLinePair",jr,3),gr("UpsampleBgrLinePair",_r,3),gr("UpsampleRgbaLinePair",Qr,4),gr("UpsampleBgraLinePair",Nr,4),gr("UpsampleArgbLinePair",Er,4),gr("UpsampleRgba4444LinePair",xr,2),gr("UpsampleRgb565LinePair",Cr,2);var vo=e.UpsampleRgbLinePair,wo=e.UpsampleBgrLinePair,bo=e.UpsampleRgbaLinePair,Bo=e.UpsampleBgraLinePair,jo=e.UpsampleArgbLinePair,_o=e.UpsampleRgba4444LinePair,Co=e.UpsampleRgb565LinePair,xo=16,Eo=1<<xo-1,No=-227,Qo=482,Fo=6,Uo=(256<<Fo)-1,So=0,Lo=s(256),To=s(256),Ho=s(256),Io=s(256),Po=s(Qo-No),Oo=s(Qo-No);Fr("YuvToRgbRow",jr,3),Fr("YuvToBgrRow",_r,3),Fr("YuvToRgbaRow",Qr,4),Fr("YuvToBgraRow",Nr,4),Fr("YuvToArgbRow",Er,4),Fr("YuvToRgba4444Row",xr,2),Fr("YuvToRgb565Row",Cr,2);var ko=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Ro=[0,2,8],Mo=[8,7,6,4,4,2,2,2,1,1,1,1],Do=1;this.WebPDecodeRGBA=function(e,r,n,o,s){var i=Pn,a=new rr,A=new ie;a.ba=A,A.S=i,A.width=[A.width],A.height=[A.height];var u=A.width,c=A.height,l=new ae;if(null==l||null==e)var d=2;else t(null!=l),d=Tr(e,r,n,l.width,l.height,l.Pd,l.Qd,l.format,null);if(0!=d?u=0:(null!=u&&(u[0]=l.width[0]),null!=c&&(c[0]=l.height[0]),u=1),u){A.width=A.width[0],A.height=A.height[0],null!=o&&(o[0]=A.width),null!=s&&(s[0]=A.height);e:{if(o=new qe,(s=new nr).data=e,s.w=r,s.ha=n,s.kd=1,r=[0],t(null!=s),(0==(e=Tr(s.data,s.w,s.ha,null,null,null,r,null,s))||7==e)&&r[0]&&(e=4),0==(r=e)){if(t(null!=a),o.data=s.data,o.w=s.w+s.offset,o.ha=s.ha-s.offset,o.put=fe,o.ac=de,o.bc=he,o.ma=a,s.xa){if(null==(e=Ne())){a=1;break e}if(function(e,r){var n=[0],o=[0],s=[0];t:for(;;){if(null==e)return 0;if(null==r)return e.a=2,0;if(e.l=r,e.a=0,g(e.m,r.data,r.w,r.ha),!pe(e.m,n,o,s)){e.a=3;break t}if(e.xb=mo,r.width=n[0],r.height=o[0],!Qe(n[0],o[0],1,e,null))break t;return 1}return t(0!=e.a),0}(e,o)){if(o=0==(r=Pr(o.width,o.height,a.Oa,a.ba))){t:{o=e;r:for(;;){if(null==o){o=0;break t}if(t(null!=o.s.yc),t(null!=o.s.Ya),t(0<o.s.Wb),t(null!=(n=o.l)),t(null!=(s=n.ma)),0!=o.xb){if(o.ca=s.ba,o.tb=s.tb,t(null!=o.ca),!Hr(s.Oa,n,kn)){o.a=2;break r}if(!Fe(o,n.width))break r;if(n.da)break r;if((n.da||ne(o.ca.S))&&mr(),11>o.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),null!=o.ca.f.kb.F&&mr()),o.Pb&&0<o.s.ua&&null==o.s.vb.X&&!L(o.s.vb,o.s.Wa.Xa)){o.a=1;break r}o.xb=0}if(!xe(o,o.V,o.Ba,o.c,o.i,n.o,Be))break r;s.Dc=o.Ma,o=1;break t}t(0!=o.a),o=0}o=!o}o&&(r=e.a)}else r=e.a}else{if(null==(e=new Ge)){a=1;break e}if(e.Fa=s.na,e.P=s.P,e.qc=s.Sa,Je(e,o)){if(0==(r=Pr(o.width,o.height,a.Oa,a.ba))){if(e.Aa=0,n=a.Oa,t(null!=(s=e)),null!=n){if(0<(u=0>(u=n.Md)?0:100<u?255:255*u/100)){for(c=l=0;4>c;++c)12>(d=s.pb[c]).lc&&(d.ia=u*Mo[0>d.lc?0:d.lc]>>3),l|=d.ia;l&&(alert("todo:VP8InitRandom"),s.ia=1)}s.Ga=n.Id,100<s.Ga?s.Ga=100:0>s.Ga&&(s.Ga=0)}$e(e,o)||(r=e.a)}}else r=e.a}0==r&&null!=a.Oa&&a.Oa.fd&&(r=Ir(a.ba))}a=r}i=0!=a?null:11>i?A.f.RGBA.eb:A.f.kb.y}else i=null;return i};var Ko=[3,4,3,4,4,2,2,4,4,4,2,1,1]});var l=[0],d=[0],f=[],h=new $e,p=e,m=function(e,t){var r={},n=0,o=!1,s=0,i=0;if(r.frames=[],!function(e,t,r,n){for(var o=0;o<4;o++)if(e[t+o]!="RIFF".charCodeAt(o))return!0;return!1}(e,t)){var a,l;for(c(e,t+=4),t+=8;t<e.length;){var d=A(e,t),f=c(e,t+=4);t+=4;var h=f+(1&f);switch(d){case"VP8 ":case"VP8L":void 0===r.frames[n]&&(r.frames[n]={}),(g=r.frames[n]).src_off=o?i:t-8,g.src_size=s+f+8,n++,o&&(o=!1,s=0,i=0);break;case"VP8X":(g=r.header={}).feature_flags=e[t];var p=t+4;g.canvas_width=1+u(e,p),p+=3,g.canvas_height=1+u(e,p),p+=3;break;case"ALPH":o=!0,s=h+8,i=t-8;break;case"ANIM":(g=r.header).bgcolor=c(e,t),p=t+4,g.loop_count=(a=e)[(l=p)+0]<<0|a[l+1]<<8,p+=2;break;case"ANMF":var m,g;(g=r.frames[n]={}).offset_x=2*u(e,t),t+=3,g.offset_y=2*u(e,t),t+=3,g.width=1+u(e,t),t+=3,g.height=1+u(e,t),t+=3,g.duration=u(e,t),t+=3,m=e[t++],g.dispose=1&m,g.blend=m>>1&1}"ANMF"!=d&&(t+=h)}return r}}(p,0);m.response=p,m.rgbaoutput=!0,m.dataurl=!1;var g=m.header?m.header:null,y=m.frames?m.frames:null;if(g){g.loop_counter=g.loop_count,l=[g.canvas_height],d=[g.canvas_width];for(var v=0;v<y.length&&0!=y[v].blend;v++);}var w=y[0],b=h.WebPDecodeRGBA(p,w.src_off,w.src_size,d,l);w.rgba=b,w.imgwidth=d[0],w.imgheight=l[0];for(var B=0;B<d[0]*l[0]*4;B++)f[B]=b[B];return this.width=d,this.height=l,this.data=f,this}!function(e){var t=function(t,o,u,c){var l=4,d=i;switch(c){case e.image_compression.FAST:l=1,d=s;break;case e.image_compression.MEDIUM:l=6,d=a;break;case e.image_compression.SLOW:l=9,d=A}t=r(t,o,u,d);var f=(0,n.zlibSync)(t,{level:l});return e.__addimage__.arrayBufferToBinaryString(f)},r=function(e,t,r,n){for(var o,s,i,a=e.length/t,A=new Uint8Array(e.length+a),u=c(),d=0;d<a;d+=1){if(i=d*t,o=e.subarray(i,i+t),n)A.set(n(o,r,s),i+d);else{for(var f,h=u.length,p=[];f<h;f+=1)p[f]=u[f](o,r,s);var m=l(p.concat());A.set(p[m],i+d)}s=o}return A},o=function(e){var t=Array.apply([],e);return t.unshift(0),t},s=function(e,t){var r,n=[],o=e.length;n[0]=1;for(var s=0;s<o;s+=1)r=e[s-t]||0,n[s+1]=e[s]-r+256&255;return n},i=function(e,t,r){var n,o=[],s=e.length;o[0]=2;for(var i=0;i<s;i+=1)n=r&&r[i]||0,o[i+1]=e[i]-n+256&255;return o},a=function(e,t,r){var n,o,s=[],i=e.length;s[0]=3;for(var a=0;a<i;a+=1)n=e[a-t]||0,o=r&&r[a]||0,s[a+1]=e[a]+256-(n+o>>>1)&255;return s},A=function(e,t,r){var n,o,s,i,a=[],A=e.length;a[0]=4;for(var c=0;c<A;c+=1)n=e[c-t]||0,o=r&&r[c]||0,s=r&&r[c-t]||0,i=u(n,o,s),a[c+1]=e[c]-i+256&255;return a},u=function(e,t,r){if(e===t&&t===r)return e;var n=Math.abs(t-r),o=Math.abs(e-r),s=Math.abs(e+t-r-r);return n<=o&&n<=s?e:o<=s?t:r},c=function(){return[o,s,i,a,A]},l=function(e){var t=e.map((function(e){return e.reduce((function(e,t){return e+Math.abs(t)}),0)}));return t.indexOf(Math.min.apply(null,t))};e.processPNG=function(r,o,s,i){var a,A,u,c,l,d,f,h,p,m,g,y,v,w,b,B=this.decode.FLATE_DECODE,j="";if(this.__addimage__.isArrayBuffer(r)&&(r=new Uint8Array(r)),this.__addimage__.isArrayBufferView(r)){if(r=(u=new Xe(r)).imgData,A=u.bits,a=u.colorSpace,l=u.colors,-1!==[4,6].indexOf(u.colorType)){if(8===u.bits){p=(h=32==u.pixelBitlength?new Uint32Array(u.decodePixels().buffer):16==u.pixelBitlength?new Uint16Array(u.decodePixels().buffer):new Uint8Array(u.decodePixels().buffer)).length,g=new Uint8Array(p*u.colors),m=new Uint8Array(p);var _,C=u.pixelBitlength-u.bits;for(w=0,b=0;w<p;w++){for(v=h[w],_=0;_<C;)g[b++]=v>>>_&255,_+=u.bits;m[w]=v>>>_&255}}if(16===u.bits){p=(h=new Uint32Array(u.decodePixels().buffer)).length,g=new Uint8Array(p*(32/u.pixelBitlength)*u.colors),m=new Uint8Array(p*(32/u.pixelBitlength)),y=u.colors>1,w=0,b=0;for(var x=0;w<p;)v=h[w++],g[b++]=v>>>0&255,y&&(g[b++]=v>>>16&255,v=h[w++],g[b++]=v>>>0&255),m[x++]=v>>>16&255;A=8}i!==e.image_compression.NONE&&"function"==typeof n.zlibSync?(r=t(g,u.width*u.colors,u.colors,i),f=t(m,u.width,1,i)):(r=g,f=m,B=void 0)}if(3===u.colorType&&(a=this.color_spaces.INDEXED,d=u.palette,u.transparency.indexed)){var E=u.transparency.indexed,N=0;for(w=0,p=E.length;w<p;++w)N+=E[w];if((N/=255)==p-1&&-1!==E.indexOf(0))c=[E.indexOf(0)];else if(N!==p){for(h=u.decodePixels(),m=new Uint8Array(h.length),w=0,p=h.length;w<p;w++)m[w]=E[h[w]];f=t(m,u.width,1)}}var Q=function(t){var r;switch(t){case e.image_compression.FAST:r=11;break;case e.image_compression.MEDIUM:r=13;break;case e.image_compression.SLOW:r=14;break;default:r=12}return r}(i);return B===this.decode.FLATE_DECODE&&(j="/Predictor "+Q+" "),j+="/Colors "+l+" /BitsPerComponent "+A+" /Columns "+u.width,(this.__addimage__.isArrayBuffer(r)||this.__addimage__.isArrayBufferView(r))&&(r=this.__addimage__.arrayBufferToBinaryString(r)),(f&&this.__addimage__.isArrayBuffer(f)||this.__addimage__.isArrayBufferView(f))&&(f=this.__addimage__.arrayBufferToBinaryString(f)),{alias:s,data:r,index:o,filter:B,decodeParameters:j,transparency:c,palette:d,sMask:f,predictor:Q,width:u.width,height:u.height,bitsPerComponent:A,colorSpace:a}}}}(H.API),function(e){e.processGIF89A=function(t,r,n,o){var s=new We(t),i=s.width,a=s.height,A=[];s.decodeAndBlitFrameRGBA(0,A);var u={data:A,width:i,height:a},c=new Ye(100).encode(u,100);return e.processJPEG.call(this,c,r,n,o)},e.processGIF87A=e.processGIF89A}(H.API),Ze.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,16===this.bitPP&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var e=0===this.colors?1<<this.bitPP:this.colors;this.palette=new Array(e);for(var t=0;t<e;t++){var r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:o,green:n,blue:r,quad:s}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Ze.prototype.parseBGR=function(){this.pos=this.offset;try{var e="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[e]()}catch(e){i.log("bit decode error:"+e)}},Ze.prototype.bit1=function(){var e,t=Math.ceil(this.width/8),r=t%4;for(e=this.height-1;e>=0;e--){for(var n=this.bottom_up?e:this.height-1-e,o=0;o<t;o++)for(var s=this.datav.getUint8(this.pos++,!0),i=n*this.width*4+8*o*4,a=0;a<8&&8*o+a<this.width;a++){var A=this.palette[s>>7-a&1];this.data[i+4*a]=A.blue,this.data[i+4*a+1]=A.green,this.data[i+4*a+2]=A.red,this.data[i+4*a+3]=255}0!==r&&(this.pos+=4-r)}},Ze.prototype.bit4=function(){for(var e=Math.ceil(this.width/2),t=e%4,r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,o=0;o<e;o++){var s=this.datav.getUint8(this.pos++,!0),i=n*this.width*4+2*o*4,a=s>>4,A=15&s,u=this.palette[a];if(this.data[i]=u.blue,this.data[i+1]=u.green,this.data[i+2]=u.red,this.data[i+3]=255,2*o+1>=this.width)break;u=this.palette[A],this.data[i+4]=u.blue,this.data[i+4+1]=u.green,this.data[i+4+2]=u.red,this.data[i+4+3]=255}0!==t&&(this.pos+=4-t)}},Ze.prototype.bit8=function(){for(var e=this.width%4,t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var o=this.datav.getUint8(this.pos++,!0),s=r*this.width*4+4*n;if(o<this.palette.length){var i=this.palette[o];this.data[s]=i.red,this.data[s+1]=i.green,this.data[s+2]=i.blue,this.data[s+3]=255}else this.data[s]=255,this.data[s+1]=255,this.data[s+2]=255,this.data[s+3]=255}0!==e&&(this.pos+=4-e)}},Ze.prototype.bit15=function(){for(var e=this.width%3,t=parseInt("11111",2),r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,o=0;o<this.width;o++){var s=this.datav.getUint16(this.pos,!0);this.pos+=2;var i=(s&t)/t*255|0,a=(s>>5&t)/t*255|0,A=(s>>10&t)/t*255|0,u=s>>15?255:0,c=n*this.width*4+4*o;this.data[c]=A,this.data[c+1]=a,this.data[c+2]=i,this.data[c+3]=u}this.pos+=e}},Ze.prototype.bit16=function(){for(var e=this.width%3,t=parseInt("11111",2),r=parseInt("111111",2),n=this.height-1;n>=0;n--){for(var o=this.bottom_up?n:this.height-1-n,s=0;s<this.width;s++){var i=this.datav.getUint16(this.pos,!0);this.pos+=2;var a=(i&t)/t*255|0,A=(i>>5&r)/r*255|0,u=(i>>11)/t*255|0,c=o*this.width*4+4*s;this.data[c]=u,this.data[c+1]=A,this.data[c+2]=a,this.data[c+3]=255}this.pos+=e}},Ze.prototype.bit24=function(){for(var e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),i=t*this.width*4+4*r;this.data[i]=s,this.data[i+1]=o,this.data[i+2]=n,this.data[i+3]=255}this.pos+=this.width%4}},Ze.prototype.bit32=function(){for(var e=this.height-1;e>=0;e--)for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),a=t*this.width*4+4*r;this.data[a]=s,this.data[a+1]=o,this.data[a+2]=n,this.data[a+3]=i}},Ze.prototype.getData=function(){return this.data},function(e){e.processBMP=function(t,r,n,o){var s=new Ze(t,!1),i=s.width,a=s.height,A={data:s.getData(),width:i,height:a},u=new Ye(100).encode(A,100);return e.processJPEG.call(this,u,r,n,o)}}(H.API),$e.prototype.getData=function(){return this.data},function(e){e.processWEBP=function(t,r,n,o){var s=new $e(t,!1),i=s.width,a=s.height,A={data:s.getData(),width:i,height:a},u=new Ye(100).encode(A,100);return e.processJPEG.call(this,u,r,n,o)}}(H.API),H.API.setLanguage=function(e){return void 0===this.internal.languageSettings&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),void 0!=={af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"FYRO Macedonian",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[e]&&(this.internal.languageSettings.languageCode=e,!1===this.internal.languageSettings.isSubscribed&&(this.internal.events.subscribe("putCatalog",(function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")})),this.internal.languageSettings.isSubscribed=!0)),this},Ke=H.API,ze=Ke.getCharWidthsArray=function(e,t){var r,n,o=(t=t||{}).font||this.internal.getFont(),s=t.fontSize||this.internal.getFontSize(),i=t.charSpace||this.internal.getCharSpace(),a=t.widths?t.widths:o.metadata.Unicode.widths,A=a.fof?a.fof:1,u=t.kerning?t.kerning:o.metadata.Unicode.kerning,c=u.fof?u.fof:1,l=!1!==t.doKerning,d=0,f=e.length,h=0,p=a[0]||A,m=[];for(r=0;r<f;r++)n=e.charCodeAt(r),"function"==typeof o.metadata.widthOfString?m.push((o.metadata.widthOfGlyph(o.metadata.characterToGlyph(n))+i*(1e3/s)||0)/1e3):(d=l&&"object"==typeof u[n]&&!isNaN(parseInt(u[n][h],10))?u[n][h]/c:0,m.push((a[n]||p)/A+d)),h=n;return m},Ve=Ke.getStringUnitWidth=function(e,t){var r=(t=t||{}).fontSize||this.internal.getFontSize(),n=t.font||this.internal.getFont(),o=t.charSpace||this.internal.getCharSpace();return Ke.processArabic&&(e=Ke.processArabic(e)),"function"==typeof n.metadata.widthOfString?n.metadata.widthOfString(e,r,o)/r:ze.apply(this,arguments).reduce((function(e,t){return e+t}),0)},qe=function(e,t,r,n){for(var o=[],s=0,i=e.length,a=0;s!==i&&a+t[s]<r;)a+=t[s],s++;o.push(e.slice(0,s));var A=s;for(a=0;s!==i;)a+t[s]>n&&(o.push(e.slice(A,s)),a=0,A=s),a+=t[s],s++;return A!==s&&o.push(e.slice(A,s)),o},Ge=function(e,t,r){r||(r={});var n,o,s,i,a,A,u,c=[],l=[c],d=r.textIndent||0,f=0,h=0,p=e.split(" "),m=ze.apply(this,[" ",r])[0];if(A=-1===r.lineIndent?p[0].length+2:r.lineIndent||0){var g=Array(A).join(" "),y=[];p.map((function(e){(e=e.split(/\s*\n/)).length>1?y=y.concat(e.map((function(e,t){return(t&&e.length?"\n":"")+e}))):y.push(e[0])})),p=y,A=Ve.apply(this,[g,r])}for(s=0,i=p.length;s<i;s++){var v=0;if(n=p[s],A&&"\n"==n[0]&&(n=n.substr(1),v=1),d+f+(h=(o=ze.apply(this,[n,r])).reduce((function(e,t){return e+t}),0))>t||v){if(h>t){for(a=qe.apply(this,[n,o,t-(d+f),t]),c.push(a.shift()),c=[a.pop()];a.length;)l.push([a.shift()]);h=o.slice(n.length-(c[0]?c[0].length:0)).reduce((function(e,t){return e+t}),0)}else c=[n];l.push(c),d=h+A,f=m}else c.push(n),d+=f+h,f=m}return u=A?function(e,t){return(t?g:"")+e.join(" ")}:function(e){return e.join(" ")},l.map(u)},Ke.splitTextToSize=function(e,t,r){var n,o=(r=r||{}).fontSize||this.internal.getFontSize(),s=function(e){if(e.widths&&e.kerning)return{widths:e.widths,kerning:e.kerning};var t=this.internal.getFont(e.fontName,e.fontStyle);return t.metadata.Unicode?{widths:t.metadata.Unicode.widths||{0:1},kerning:t.metadata.Unicode.kerning||{}}:{font:t.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}.call(this,r);n=Array.isArray(e)?e:String(e).split(/\r?\n/);var i=1*this.internal.scaleFactor*t/o;s.textIndent=r.textIndent?1*r.textIndent*this.internal.scaleFactor/o:0,s.lineIndent=r.lineIndent;var a,A,u=[];for(a=0,A=n.length;a<A;a++)u=u.concat(Ge.apply(this,[n[a],i,s]));return u},function(e){e.__fontmetrics__=e.__fontmetrics__||{};for(var t="klmnopqrstuvwxyz",r={},n={},o=0;o<t.length;o++)r[t[o]]="0123456789abcdef"[o],n["0123456789abcdef"[o]]=t[o];var s=function(e){return"0x"+parseInt(e,10).toString(16)},i=e.__fontmetrics__.compress=function(e){var t,r,o,a,A=["{"];for(var u in e){if(t=e[u],isNaN(parseInt(u,10))?r="'"+u+"'":(u=parseInt(u,10),r=(r=s(u).slice(2)).slice(0,-1)+n[r.slice(-1)]),"number"==typeof t)t<0?(o=s(t).slice(3),a="-"):(o=s(t).slice(2),a=""),o=a+o.slice(0,-1)+n[o.slice(-1)];else{if("object"!=typeof t)throw new Error("Don't know what to do with value type "+typeof t+".");o=i(t)}A.push(r+o)}return A.push("}"),A.join("")},a=e.__fontmetrics__.uncompress=function(e){if("string"!=typeof e)throw new Error("Invalid argument passed to uncompress.");for(var t,n,o,s,i={},a=1,A=i,u=[],c="",l="",d=e.length-1,f=1;f<d;f+=1)"'"==(s=e[f])?t?(o=t.join(""),t=void 0):t=[]:t?t.push(s):"{"==s?(u.push([A,o]),A={},o=void 0):"}"==s?((n=u.pop())[0][n[1]]=A,o=void 0,A=n[0]):"-"==s?a=-1:void 0===o?r.hasOwnProperty(s)?(c+=r[s],o=parseInt(c,16)*a,a=1,c=""):c+=s:r.hasOwnProperty(s)?(l+=r[s],A[o]=parseInt(l,16)*a,a=1,o=void 0,l=""):l+=s;return i},A={codePages:["WinAnsiEncoding"],WinAnsiEncoding:a("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},u={Unicode:{Courier:A,"Courier-Bold":A,"Courier-BoldOblique":A,"Courier-Oblique":A,Helvetica:A,"Helvetica-Bold":A,"Helvetica-BoldOblique":A,"Helvetica-Oblique":A,"Times-Roman":A,"Times-Bold":A,"Times-BoldItalic":A,"Times-Italic":A}},c={Unicode:{"Courier-Oblique":a("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":a("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":a("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:a("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":a("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":a("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:a("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:a("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":a("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:a("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":a("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":a("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":a("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":a("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};e.events.push(["addFont",function(e){var t=e.font,r=c.Unicode[t.postScriptName];r&&(t.metadata.Unicode={},t.metadata.Unicode.widths=r.widths,t.metadata.Unicode.kerning=r.kerning);var n=u.Unicode[t.postScriptName];n&&(t.metadata.Unicode.encoding=n,t.encoding=n.codePages[0])}])}(H.API),function(e){var t=function(e){for(var t=e.length,r=new Uint8Array(t),n=0;n<t;n++)r[n]=e.charCodeAt(n);return r};e.API.events.push(["addFont",function(r){var n=void 0,o=r.font,s=r.instance;if(!o.isStandardFont){if(void 0===s)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+o.postScriptName+"').");if("string"!=typeof(n=!1===s.existsFileInVFS(o.postScriptName)?s.loadFile(o.postScriptName):s.getFileFromVFS(o.postScriptName)))throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+o.postScriptName+"').");!function(r,n){n=/^\x00\x01\x00\x00/.test(n)?t(n):t(c(n)),r.metadata=e.API.TTFFont.open(n),r.metadata.Unicode=r.metadata.Unicode||{encoding:{},kerning:{},widths:[]},r.metadata.glyIdsUsed=[0]}(o,n)}}])}(H),function(e){function t(){return(o.canvg?Promise.resolve(o.canvg):Promise.resolve().then(r.bind(r,"./node_modules/canvg/lib/index.es.js"))).catch((function(e){return Promise.reject(new Error("Could not load canvg: "+e))})).then((function(e){return e.default?e.default:e}))}H.API.addSvgAsImage=function(e,r,n,o,s,a,A,u){if(isNaN(r)||isNaN(n))throw i.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(o)||isNaN(s))throw i.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var c=document.createElement("canvas");c.width=o,c.height=s;var l=c.getContext("2d");l.fillStyle="#fff",l.fillRect(0,0,c.width,c.height);var d={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},f=this;return t().then((function(t){return t.fromString(l,e,d)}),(function(){return Promise.reject(new Error("Could not load canvg."))})).then((function(e){return e.render(d)})).then((function(){f.addImage(c.toDataURL("image/jpeg",1),r,n,o,s,A,u)}))}}(),H.API.putTotalPages=function(e){var t,r=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(e,"g"),r=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(e,this.internal.getFont()),"g"),r=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var n=1;n<=this.internal.getNumberOfPages();n++)for(var o=0;o<this.internal.pages[n].length;o++)this.internal.pages[n][o]=this.internal.pages[n][o].replace(t,r);return this},H.API.viewerPreferences=function(e,t){var r;e=e||{},t=t||!1;var n,o,s,i={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},a=Object.keys(i),A=[],u=0,c=0,l=0;function d(e,t){var r,n=!1;for(r=0;r<e.length;r+=1)e[r]===t&&(n=!0);return n}if(void 0===this.internal.viewerpreferences&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(i)),this.internal.viewerpreferences.isSubscribed=!1),r=this.internal.viewerpreferences.configuration,"reset"===e||!0===t){var f=a.length;for(l=0;l<f;l+=1)r[a[l]].value=r[a[l]].defaultValue,r[a[l]].explicitSet=!1}if("object"==typeof e)for(o in e)if(s=e[o],d(a,o)&&void 0!==s){if("boolean"===r[o].type&&"boolean"==typeof s)r[o].value=s;else if("name"===r[o].type&&d(r[o].valueSet,s))r[o].value=s;else if("integer"===r[o].type&&Number.isInteger(s))r[o].value=s;else if("array"===r[o].type){for(u=0;u<s.length;u+=1)if(n=!0,1===s[u].length&&"number"==typeof s[u][0])A.push(String(s[u]-1));else if(s[u].length>1){for(c=0;c<s[u].length;c+=1)"number"!=typeof s[u][c]&&(n=!1);!0===n&&A.push([s[u][0]-1,s[u][1]-1].join(" "))}r[o].value="["+A.join(" ")+"]"}else r[o].value=r[o].defaultValue;r[o].explicitSet=!0}return!1===this.internal.viewerpreferences.isSubscribed&&(this.internal.events.subscribe("putCatalog",(function(){var e,t=[];for(e in r)!0===r[e].explicitSet&&("name"===r[e].type?t.push("/"+e+" /"+r[e].value):t.push("/"+e+" "+r[e].value));0!==t.length&&this.internal.write("/ViewerPreferences\n<<\n"+t.join("\n")+"\n>>")})),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=r,this},function(e){var t=function(){var e='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',t=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),r=unescape(encodeURIComponent(e)),n=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),o=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),s=unescape(encodeURIComponent("</x:xmpmeta>")),i=r.length+n.length+o.length+t.length+s.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+i+" >>"),this.internal.write("stream"),this.internal.write(t+r+n+o+s),this.internal.write("endstream"),this.internal.write("endobj")},r=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};e.addMetadata=function(e,n){return void 0===this.internal.__metadata__&&(this.internal.__metadata__={metadata:e,namespaceuri:n||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",r),this.internal.events.subscribe("postPutResources",t)),this}}(H.API),function(e){var t=e.API,r=t.pdfEscape16=function(e,t){for(var r,n=t.metadata.Unicode.widths,o=["","0","00","000","0000"],s=[""],i=0,a=e.length;i<a;++i){if(r=t.metadata.characterToGlyph(e.charCodeAt(i)),t.metadata.glyIdsUsed.push(r),t.metadata.toUnicode[r]=e.charCodeAt(i),-1==n.indexOf(r)&&(n.push(r),n.push([parseInt(t.metadata.widthOfGlyph(r),10)])),"0"==r)return s.join("");r=r.toString(16),s.push(o[4-r.length],r)}return s.join("")},n=function(e){var t,r,n,o,s,i,a;for(s="/CIDInit /ProcSet findresource begin\n12 dict begin\nbegincmap\n/CIDSystemInfo <<\n  /Registry (Adobe)\n  /Ordering (UCS)\n  /Supplement 0\n>> def\n/CMapName /Adobe-Identity-UCS def\n/CMapType 2 def\n1 begincodespacerange\n<0000><ffff>\nendcodespacerange",n=[],i=0,a=(r=Object.keys(e).sort((function(e,t){return e-t}))).length;i<a;i++)t=r[i],n.length>=100&&(s+="\n"+n.length+" beginbfchar\n"+n.join("\n")+"\nendbfchar",n=[]),void 0!==e[t]&&null!==e[t]&&"function"==typeof e[t].toString&&(o=("0000"+e[t].toString(16)).slice(-4),t=("0000"+(+t).toString(16)).slice(-4),n.push("<"+t+"><"+o+">"));return n.length&&(s+="\n"+n.length+" beginbfchar\n"+n.join("\n")+"\nendbfchar\n"),s+"endcmap\nCMapName currentdict /CMap defineresource pop\nend\nend"};t.events.push(["putFont",function(t){!function(t){var r=t.font,o=t.out,s=t.newObject,i=t.putStream,a=t.pdfEscapeWithNeededParanthesis;if(r.metadata instanceof e.API.TTFFont&&"Identity-H"===r.encoding){for(var A=r.metadata.Unicode.widths,u=r.metadata.subset.encode(r.metadata.glyIdsUsed,1),c="",l=0;l<u.length;l++)c+=String.fromCharCode(u[l]);var d=s();i({data:c,addLength1:!0,objectId:d}),o("endobj");var f=s();i({data:n(r.metadata.toUnicode),addLength1:!0,objectId:f}),o("endobj");var h=s();o("<<"),o("/Type /FontDescriptor"),o("/FontName /"+a(r.fontName)),o("/FontFile2 "+d+" 0 R"),o("/FontBBox "+e.API.PDFObject.convert(r.metadata.bbox)),o("/Flags "+r.metadata.flags),o("/StemV "+r.metadata.stemV),o("/ItalicAngle "+r.metadata.italicAngle),o("/Ascent "+r.metadata.ascender),o("/Descent "+r.metadata.decender),o("/CapHeight "+r.metadata.capHeight),o(">>"),o("endobj");var p=s();o("<<"),o("/Type /Font"),o("/BaseFont /"+a(r.fontName)),o("/FontDescriptor "+h+" 0 R"),o("/W "+e.API.PDFObject.convert(A)),o("/CIDToGIDMap /Identity"),o("/DW 1000"),o("/Subtype /CIDFontType2"),o("/CIDSystemInfo"),o("<<"),o("/Supplement 0"),o("/Registry (Adobe)"),o("/Ordering ("+r.encoding+")"),o(">>"),o(">>"),o("endobj"),r.objectNumber=s(),o("<<"),o("/Type /Font"),o("/Subtype /Type0"),o("/ToUnicode "+f+" 0 R"),o("/BaseFont /"+a(r.fontName)),o("/Encoding /"+r.encoding),o("/DescendantFonts ["+p+" 0 R]"),o(">>"),o("endobj"),r.isAlreadyPutted=!0}}(t)}]),t.events.push(["putFont",function(t){!function(t){var r=t.font,o=t.out,s=t.newObject,i=t.putStream,a=t.pdfEscapeWithNeededParanthesis;if(r.metadata instanceof e.API.TTFFont&&"WinAnsiEncoding"===r.encoding){for(var A=r.metadata.rawData,u="",c=0;c<A.length;c++)u+=String.fromCharCode(A[c]);var l=s();i({data:u,addLength1:!0,objectId:l}),o("endobj");var d=s();i({data:n(r.metadata.toUnicode),addLength1:!0,objectId:d}),o("endobj");var f=s();o("<<"),o("/Descent "+r.metadata.decender),o("/CapHeight "+r.metadata.capHeight),o("/StemV "+r.metadata.stemV),o("/Type /FontDescriptor"),o("/FontFile2 "+l+" 0 R"),o("/Flags 96"),o("/FontBBox "+e.API.PDFObject.convert(r.metadata.bbox)),o("/FontName /"+a(r.fontName)),o("/ItalicAngle "+r.metadata.italicAngle),o("/Ascent "+r.metadata.ascender),o(">>"),o("endobj"),r.objectNumber=s();for(var h=0;h<r.metadata.hmtx.widths.length;h++)r.metadata.hmtx.widths[h]=parseInt(r.metadata.hmtx.widths[h]*(1e3/r.metadata.head.unitsPerEm));o("<</Subtype/TrueType/Type/Font/ToUnicode "+d+" 0 R/BaseFont/"+a(r.fontName)+"/FontDescriptor "+f+" 0 R/Encoding/"+r.encoding+" /FirstChar 29 /LastChar 255 /Widths "+e.API.PDFObject.convert(r.metadata.hmtx.widths)+">>"),o("endobj"),r.isAlreadyPutted=!0}}(t)}]);var o=function(e){var t,n=e.text||"",o=e.x,s=e.y,i=e.options||{},a=e.mutex||{},A=a.pdfEscape,u=a.activeFontKey,c=a.fonts,l=u,d="",f=0,h="",p=c[l].encoding;if("Identity-H"!==c[l].encoding)return{text:n,x:o,y:s,options:i,mutex:a};for(h=n,l=u,Array.isArray(n)&&(h=n[0]),f=0;f<h.length;f+=1)c[l].metadata.hasOwnProperty("cmap")&&(t=c[l].metadata.cmap.unicode.codeMap[h[f].charCodeAt(0)]),t||h[f].charCodeAt(0)<256&&c[l].metadata.hasOwnProperty("Unicode")?d+=h[f]:d+="";var m="";return parseInt(l.slice(1))<14||"WinAnsiEncoding"===p?m=A(d,l).split("").map((function(e){return e.charCodeAt(0).toString(16)})).join(""):"Identity-H"===p&&(m=r(d,c[l])),a.isHex=!0,{text:m,x:o,y:s,options:i,mutex:a}};t.events.push(["postProcessText",function(e){var t=e.text||"",r=[],n={text:t,x:e.x,y:e.y,options:e.options,mutex:e.mutex};if(Array.isArray(t)){var s=0;for(s=0;s<t.length;s+=1)Array.isArray(t[s])&&3===t[s].length?r.push([o(Object.assign({},n,{text:t[s][0]})).text,t[s][1],t[s][2]]):r.push(o(Object.assign({},n,{text:t[s]})).text);e.text=r}else e.text=o(Object.assign({},n,{text:t})).text}])}(H),function(e){var t=function(){return void 0===this.internal.vFS&&(this.internal.vFS={}),!0};e.existsFileInVFS=function(e){return t.call(this),void 0!==this.internal.vFS[e]},e.addFileToVFS=function(e,r){return t.call(this),this.internal.vFS[e]=r,this},e.getFileFromVFS=function(e){return t.call(this),void 0!==this.internal.vFS[e]?this.internal.vFS[e]:null}}(H.API),function(e){e.__bidiEngine__=e.prototype.__bidiEngine__=function(e){var r,n,o,s,i,a,A,u=t,c=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],l=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],d={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},f={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},h=["(",")","(","<",">","<","[","]","[","{","}","{","«","»","«","‹","›","‹","⁅","⁆","⁅","⁽","⁾","⁽","₍","₎","₍","≤","≥","≤","〈","〉","〈","﹙","﹚","﹙","﹛","﹜","﹛","﹝","﹞","﹝","﹤","﹥","﹤"],p=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),m=!1,g=0;this.__bidiEngine__={};var y=function(e){var t=e.charCodeAt(),r=t>>8,n=f[r];return void 0!==n?u[256*n+(255&t)]:252===r||253===r?"AL":p.test(r)?"L":8===r?"R":"N"},v=function(e){for(var t,r=0;r<e.length;r++){if("L"===(t=y(e.charAt(r))))return!1;if("R"===t)return!0}return!1},w=function(e,t,i,a){var A,u,c,l,d=t[a];switch(d){case"L":case"R":m=!1;break;case"N":case"AN":break;case"EN":m&&(d="AN");break;case"AL":m=!0,d="R";break;case"WS":d="N";break;case"CS":a<1||a+1>=t.length||"EN"!==(A=i[a-1])&&"AN"!==A||"EN"!==(u=t[a+1])&&"AN"!==u?d="N":m&&(u="AN"),d=u===A?u:"N";break;case"ES":d="EN"===(A=a>0?i[a-1]:"B")&&a+1<t.length&&"EN"===t[a+1]?"EN":"N";break;case"ET":if(a>0&&"EN"===i[a-1]){d="EN";break}if(m){d="N";break}for(c=a+1,l=t.length;c<l&&"ET"===t[c];)c++;d=c<l&&"EN"===t[c]?"EN":"N";break;case"NSM":if(o&&!s){for(l=t.length,c=a+1;c<l&&"NSM"===t[c];)c++;if(c<l){var f=e[a],h=f>=1425&&f<=2303||64286===f;if(A=t[c],h&&("R"===A||"AL"===A)){d="R";break}}}d=a<1||"B"===(A=t[a-1])?"N":i[a-1];break;case"B":m=!1,r=!0,d=g;break;case"S":n=!0,d="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":m=!1;break;case"BN":d="N"}return d},b=function(e,t,r){var n=e.split("");return r&&B(n,r,{hiLevel:g}),n.reverse(),t&&t.reverse(),n.join("")},B=function(e,t,o){var s,i,a,A,u,f=-1,h=e.length,p=0,v=[],b=g?l:c,B=[];for(m=!1,r=!1,n=!1,i=0;i<h;i++)B[i]=y(e[i]);for(a=0;a<h;a++){if(u=p,v[a]=w(e,B,v,a),s=240&(p=b[u][d[v[a]]]),p&=15,t[a]=A=b[p][5],s>0)if(16===s){for(i=f;i<a;i++)t[i]=1;f=-1}else f=-1;if(b[p][6])-1===f&&(f=a);else if(f>-1){for(i=f;i<a;i++)t[i]=A;f=-1}"B"===B[a]&&(t[a]=0),o.hiLevel|=A}n&&function(e,t,r){for(var n=0;n<r;n++)if("S"===e[n]){t[n]=g;for(var o=n-1;o>=0&&"WS"===e[o];o--)t[o]=g}}(B,t,h)},j=function(e,t,n,o,s){if(!(s.hiLevel<e)){if(1===e&&1===g&&!r)return t.reverse(),void(n&&n.reverse());for(var i,a,A,u,c=t.length,l=0;l<c;){if(o[l]>=e){for(A=l+1;A<c&&o[A]>=e;)A++;for(u=l,a=A-1;u<a;u++,a--)i=t[u],t[u]=t[a],t[a]=i,n&&(i=n[u],n[u]=n[a],n[a]=i);l=A}l++}}},_=function(e,t,r){var n=e.split(""),o={hiLevel:g};return r||(r=[]),B(n,r,o),function(e,t,r){if(0!==r.hiLevel&&A)for(var n,o=0;o<e.length;o++)1===t[o]&&(n=h.indexOf(e[o]))>=0&&(e[o]=h[n+1])}(n,r,o),j(2,n,t,r,o),j(1,n,t,r,o),n.join("")};return this.__bidiEngine__.doBidiReorder=function(e,t,r){if(function(e,t){if(t)for(var r=0;r<e.length;r++)t[r]=r;void 0===s&&(s=v(e)),void 0===a&&(a=v(e))}(e,t),o||!i||a)if(o&&i&&s^a)g=s?1:0,e=b(e,t,r);else if(!o&&i&&a)g=s?1:0,e=_(e,t,r),e=b(e,t);else if(!o||s||i||a){if(o&&!i&&s^a)e=b(e,t),s?(g=0,e=_(e,t,r)):(g=1,e=_(e,t,r),e=b(e,t));else if(o&&s&&!i&&a)g=1,e=_(e,t,r),e=b(e,t);else if(!o&&!i&&s^a){var n=A;s?(g=1,e=_(e,t,r),g=0,A=!1,e=_(e,t,r),A=n):(g=0,e=_(e,t,r),e=b(e,t),g=1,A=!1,e=_(e,t,r),A=n,e=b(e,t))}}else g=0,e=_(e,t,r);else g=s?1:0,e=_(e,t,r);return e},this.__bidiEngine__.setOptions=function(e){e&&(o=e.isInputVisual,i=e.isOutputVisual,s=e.isInputRtl,a=e.isOutputRtl,A=e.isSymmetricSwapping)},this.__bidiEngine__.setOptions(e),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],r=new e.__bidiEngine__({isInputVisual:!0});e.API.events.push(["postProcessText",function(e){var t=e.text,n=(e.x,e.y,e.options||{}),o=(e.mutex,n.lang,[]);if(n.isInputVisual="boolean"!=typeof n.isInputVisual||n.isInputVisual,r.setOptions(n),"[object Array]"===Object.prototype.toString.call(t)){var s=0;for(o=[],s=0;s<t.length;s+=1)"[object Array]"===Object.prototype.toString.call(t[s])?o.push([r.doBidiReorder(t[s][0]),t[s][1],t[s][2]]):o.push([r.doBidiReorder(t[s])]);e.text=o}else e.text=r.doBidiReorder(t);r.setOptions({isInputVisual:!0})}])}(H),H.API.TTFFont=function(){function e(e){var t;if(this.rawData=e,t=this.contents=new tt(e),this.contents.pos=4,"ttcf"===t.readString(4))throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new wt(this),this.registerTTF()}return e.open=function(t){return new e(t)},e.prototype.parse=function(){return this.directory=new rt(this.contents),this.head=new st(this),this.name=new dt(this),this.cmap=new at(this),this.toUnicode={},this.hhea=new At(this),this.maxp=new ft(this),this.hmtx=new ht(this),this.post=new ct(this),this.os2=new ut(this),this.loca=new vt(this),this.glyf=new mt(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},e.prototype.registerTTF=function(){var e,t,r,n,o;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=function(){var t,r,n,o;for(o=[],t=0,r=(n=this.bbox).length;t<r;t++)e=n[t],o.push(Math.round(e*this.scaleFactor));return o}.call(this),this.stemV=0,this.post.exists?(r=255&(n=this.post.italic_angle),0!=(32768&(t=n>>16))&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+r)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=1===(o=this.familyClass)||2===o||3===o||4===o||5===o||7===o,this.isScript=10===this.familyClass,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),0!==this.italicAngle&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},e.prototype.characterToGlyph=function(e){var t;return(null!=(t=this.cmap.unicode)?t.codeMap[e]:void 0)||0},e.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},e.prototype.widthOfString=function(e,t,r){var n,o,s,i;for(s=0,o=0,i=(e=""+e).length;0<=i?o<i:o>i;o=0<=i?++o:--o)n=e.charCodeAt(o),s+=this.widthOfGlyph(this.characterToGlyph(n))+r*(1e3/t)||0;return s*(t/1e3)},e.prototype.lineHeight=function(e,t){var r;return null==t&&(t=!1),r=t?this.lineGap:0,(this.ascender+r-this.decender)/1e3*e},e}();var et,tt=function(){function e(e){this.data=null!=e?e:[],this.pos=0,this.length=this.data.length}return e.prototype.readByte=function(){return this.data[this.pos++]},e.prototype.writeByte=function(e){return this.data[this.pos++]=e},e.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},e.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},e.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},e.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},e.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},e.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},e.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},e.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},e.prototype.readString=function(e){var t,r;for(r=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)r[t]=String.fromCharCode(this.readByte());return r.join("")},e.prototype.writeString=function(e){var t,r,n;for(n=[],t=0,r=e.length;0<=r?t<r:t>r;t=0<=r?++t:--t)n.push(this.writeByte(e.charCodeAt(t)));return n},e.prototype.readShort=function(){return this.readInt16()},e.prototype.writeShort=function(e){return this.writeInt16(e)},e.prototype.readLongLong=function(){var e,t,r,n,o,s,i,a;return e=this.readByte(),t=this.readByte(),r=this.readByte(),n=this.readByte(),o=this.readByte(),s=this.readByte(),i=this.readByte(),a=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^r)+4294967296*(255^n)+16777216*(255^o)+65536*(255^s)+256*(255^i)+(255^a)+1):72057594037927940*e+281474976710656*t+1099511627776*r+4294967296*n+16777216*o+65536*s+256*i+a},e.prototype.writeLongLong=function(e){var t,r;return t=Math.floor(e/4294967296),r=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r)},e.prototype.readInt=function(){return this.readInt32()},e.prototype.writeInt=function(e){return this.writeInt32(e)},e.prototype.read=function(e){var t,r;for(t=[],r=0;0<=e?r<e:r>e;r=0<=e?++r:--r)t.push(this.readByte());return t},e.prototype.write=function(e){var t,r,n,o;for(o=[],r=0,n=e.length;r<n;r++)t=e[r],o.push(this.writeByte(t));return o},e}(),rt=function(){var e;function t(e){var t,r,n;for(this.scalarType=e.readInt(),this.tableCount=e.readShort(),this.searchRange=e.readShort(),this.entrySelector=e.readShort(),this.rangeShift=e.readShort(),this.tables={},r=0,n=this.tableCount;0<=n?r<n:r>n;r=0<=n?++r:--r)t={tag:e.readString(4),checksum:e.readInt(),offset:e.readInt(),length:e.readInt()},this.tables[t.tag]=t}return t.prototype.encode=function(t){var r,n,o,s,i,a,A,u,c,l,d,f,h;for(h in d=Object.keys(t).length,a=Math.log(2),c=16*Math.floor(Math.log(d)/a),s=Math.floor(c/a),u=16*d-c,(n=new tt).writeInt(this.scalarType),n.writeShort(d),n.writeShort(c),n.writeShort(s),n.writeShort(u),o=16*d,A=n.pos+o,i=null,f=[],t)for(l=t[h],n.writeString(h),n.writeInt(e(l)),n.writeInt(A),n.writeInt(l.length),f=f.concat(l),"head"===h&&(i=A),A+=l.length;A%4;)f.push(0),A++;return n.write(f),r=2981146554-e(n.data),n.pos=i+8,n.writeUInt32(r),n.data},e=function(e){var t,r,n,o;for(e=pt.call(e);e.length%4;)e.push(0);for(n=new tt(e),r=0,t=0,o=e.length;t<o;t=t+=4)r+=n.readUInt32();return 4294967295&r},t}(),nt={}.hasOwnProperty,ot=function(e,t){for(var r in t)nt.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};et=function(){function e(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return e.prototype.parse=function(){},e.prototype.encode=function(){},e.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},e}();var st=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return ot(t,et),t.prototype.tag="head",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},t.prototype.encode=function(e){var t;return(t=new tt).writeInt(this.version),t.writeInt(this.revision),t.writeInt(this.checkSumAdjustment),t.writeInt(this.magicNumber),t.writeShort(this.flags),t.writeShort(this.unitsPerEm),t.writeLongLong(this.created),t.writeLongLong(this.modified),t.writeShort(this.xMin),t.writeShort(this.yMin),t.writeShort(this.xMax),t.writeShort(this.yMax),t.writeShort(this.macStyle),t.writeShort(this.lowestRecPPEM),t.writeShort(this.fontDirectionHint),t.writeShort(e),t.writeShort(this.glyphDataFormat),t.data},t}(),it=function(){function e(e,t){var r,n,o,s,i,a,A,u,c,l,d,f,h,p,m,g,y;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),c=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=3===this.platformID&&1===this.encodingID&&4===this.format||0===this.platformID&&4===this.format,this.codeMap={},this.format){case 0:for(a=0;a<256;++a)this.codeMap[a]=e.readByte();break;case 4:for(d=e.readUInt16(),l=d/2,e.pos+=6,o=function(){var t,r;for(r=[],a=t=0;0<=l?t<l:t>l;a=0<=l?++t:--t)r.push(e.readUInt16());return r}(),e.pos+=2,h=function(){var t,r;for(r=[],a=t=0;0<=l?t<l:t>l;a=0<=l?++t:--t)r.push(e.readUInt16());return r}(),A=function(){var t,r;for(r=[],a=t=0;0<=l?t<l:t>l;a=0<=l?++t:--t)r.push(e.readUInt16());return r}(),u=function(){var t,r;for(r=[],a=t=0;0<=l?t<l:t>l;a=0<=l?++t:--t)r.push(e.readUInt16());return r}(),n=(this.length-e.pos+this.offset)/2,i=function(){var t,r;for(r=[],a=t=0;0<=n?t<n:t>n;a=0<=n?++t:--t)r.push(e.readUInt16());return r}(),a=m=0,y=o.length;m<y;a=++m)for(p=o[a],r=g=f=h[a];f<=p?g<=p:g>=p;r=f<=p?++g:--g)0===u[a]?s=r+A[a]:0!==(s=i[u[a]/2+(r-f)-(l-a)]||0)&&(s+=A[a]),this.codeMap[r]=65535&s}e.pos=c}return e.encode=function(e,t){var r,n,o,s,i,a,A,u,c,l,d,f,h,p,m,g,y,v,w,b,B,j,_,C,x,E,N,Q,F,U,S,L,T,H,I,P,O,k,R,M,D,K,z,V,q,G;switch(Q=new tt,s=Object.keys(e).sort((function(e,t){return e-t})),t){case"macroman":for(h=0,p=function(){var e=[];for(f=0;f<256;++f)e.push(0);return e}(),g={0:0},o={},F=0,T=s.length;F<T;F++)null==g[z=e[n=s[F]]]&&(g[z]=++h),o[n]={old:e[n],new:g[e[n]]},p[n]=g[e[n]];return Q.writeUInt16(1),Q.writeUInt16(0),Q.writeUInt32(12),Q.writeUInt16(0),Q.writeUInt16(262),Q.writeUInt16(0),Q.write(p),{charMap:o,subtable:Q.data,maxGlyphID:h+1};case"unicode":for(E=[],c=[],y=0,g={},r={},m=A=null,U=0,H=s.length;U<H;U++)null==g[w=e[n=s[U]]]&&(g[w]=++y),r[n]={old:w,new:g[w]},i=g[w]-n,null!=m&&i===A||(m&&c.push(m),E.push(n),A=i),m=n;for(m&&c.push(m),c.push(65535),E.push(65535),C=2*(_=E.length),j=2*Math.pow(Math.log(_)/Math.LN2,2),l=Math.log(j/2)/Math.LN2,B=2*_-j,a=[],b=[],d=[],f=S=0,I=E.length;S<I;f=++S){if(x=E[f],u=c[f],65535===x){a.push(0),b.push(0);break}if(x-(N=r[x].new)>=32768)for(a.push(0),b.push(2*(d.length+_-f)),n=L=x;x<=u?L<=u:L>=u;n=x<=u?++L:--L)d.push(r[n].new);else a.push(N-x),b.push(0)}for(Q.writeUInt16(3),Q.writeUInt16(1),Q.writeUInt32(12),Q.writeUInt16(4),Q.writeUInt16(16+8*_+2*d.length),Q.writeUInt16(0),Q.writeUInt16(C),Q.writeUInt16(j),Q.writeUInt16(l),Q.writeUInt16(B),D=0,P=c.length;D<P;D++)n=c[D],Q.writeUInt16(n);for(Q.writeUInt16(0),K=0,O=E.length;K<O;K++)n=E[K],Q.writeUInt16(n);for(V=0,k=a.length;V<k;V++)i=a[V],Q.writeUInt16(i);for(q=0,R=b.length;q<R;q++)v=b[q],Q.writeUInt16(v);for(G=0,M=d.length;G<M;G++)h=d[G],Q.writeUInt16(h);return{charMap:r,subtable:Q.data,maxGlyphID:y+1}}},e}(),at=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return ot(t,et),t.prototype.tag="cmap",t.prototype.parse=function(e){var t,r,n;for(e.pos=this.offset,this.version=e.readUInt16(),n=e.readUInt16(),this.tables=[],this.unicode=null,r=0;0<=n?r<n:r>n;r=0<=n?++r:--r)t=new it(e,this.offset),this.tables.push(t),t.isUnicode&&null==this.unicode&&(this.unicode=t);return!0},t.encode=function(e,t){var r,n;return null==t&&(t="macroman"),r=it.encode(e,t),(n=new tt).writeUInt16(0),n.writeUInt16(1),r.table=n.data.concat(r.subtable),r},t}(),At=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return ot(t,et),t.prototype.tag="hhea",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},t}(),ut=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return ot(t,et),t.prototype.tag="OS/2",t.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=function(){var t,r;for(r=[],t=0;t<10;++t)r.push(e.readByte());return r}(),this.charRange=function(){var t,r;for(r=[],t=0;t<4;++t)r.push(e.readInt());return r}(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=function(){var t,r;for(r=[],t=0;t<2;t=++t)r.push(e.readInt());return r}(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},t}(),ct=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return ot(t,et),t.prototype.tag="post",t.prototype.parse=function(e){var t,r,n;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:break;case 131072:var o;for(r=e.readUInt16(),this.glyphNameIndex=[],o=0;0<=r?o<r:o>r;o=0<=r?++o:--o)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],n=[];e.pos<this.offset+this.length;)t=e.readByte(),n.push(this.names.push(e.readString(t)));return n;case 151552:return r=e.readUInt16(),this.offsets=e.read(r);case 196608:break;case 262144:return this.map=function(){var t,r,n;for(n=[],o=t=0,r=this.file.maxp.numGlyphs;0<=r?t<r:t>r;o=0<=r?++t:--t)n.push(e.readUInt32());return n}.call(this)}},t}(),lt=function(e,t){this.raw=e,this.length=e.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},dt=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return ot(t,et),t.prototype.tag="name",t.prototype.parse=function(e){var t,r,n,o,s,i,a,A,u,c,l;for(e.pos=this.offset,e.readShort(),t=e.readShort(),i=e.readShort(),r=[],o=0;0<=t?o<t:o>t;o=0<=t?++o:--o)r.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+i+e.readShort()});for(a={},o=u=0,c=r.length;u<c;o=++u)n=r[o],e.pos=n.offset,A=e.readString(n.length),s=new lt(A,n),null==a[l=n.nameID]&&(a[l]=[]),a[n.nameID].push(s);this.strings=a,this.copyright=a[0],this.fontFamily=a[1],this.fontSubfamily=a[2],this.uniqueSubfamily=a[3],this.fontName=a[4],this.version=a[5];try{this.postscriptName=a[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch(e){this.postscriptName=a[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=a[7],this.manufacturer=a[8],this.designer=a[9],this.description=a[10],this.vendorUrl=a[11],this.designerUrl=a[12],this.license=a[13],this.licenseUrl=a[14],this.preferredFamily=a[15],this.preferredSubfamily=a[17],this.compatibleFull=a[18],this.sampleText=a[19]},t}(),ft=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return ot(t,et),t.prototype.tag="maxp",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},t}(),ht=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return ot(t,et),t.prototype.tag="hmtx",t.prototype.parse=function(e){var t,r,n,o,s,i,a;for(e.pos=this.offset,this.metrics=[],t=0,i=this.file.hhea.numberOfMetrics;0<=i?t<i:t>i;t=0<=i?++t:--t)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(n=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var r,o;for(o=[],t=r=0;0<=n?r<n:r>n;t=0<=n?++r:--r)o.push(e.readInt16());return o}(),this.widths=function(){var e,t,r,n;for(n=[],e=0,t=(r=this.metrics).length;e<t;e++)o=r[e],n.push(o.advance);return n}.call(this),r=this.widths[this.widths.length-1],a=[],t=s=0;0<=n?s<n:s>n;t=0<=n?++s:--s)a.push(this.widths.push(r));return a},t.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},t}(),pt=[].slice,mt=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return ot(t,et),t.prototype.tag="glyf",t.prototype.parse=function(){return this.cache={}},t.prototype.glyphFor=function(e){var t,r,n,o,s,i,a,A,u,c;return e in this.cache?this.cache[e]:(o=this.file.loca,t=this.file.contents,r=o.indexOf(e),0===(n=o.lengthOf(e))?this.cache[e]=null:(t.pos=this.offset+r,s=(i=new tt(t.read(n))).readShort(),A=i.readShort(),c=i.readShort(),a=i.readShort(),u=i.readShort(),this.cache[e]=-1===s?new yt(i,A,c,a,u):new gt(i,s,A,c,a,u),this.cache[e]))},t.prototype.encode=function(e,t,r){var n,o,s,i,a;for(s=[],o=[],i=0,a=t.length;i<a;i++)n=e[t[i]],o.push(s.length),n&&(s=s.concat(n.encode(r)));return o.push(s.length),{table:s,offsets:o}},t}(),gt=function(){function e(e,t,r,n,o,s){this.raw=e,this.numberOfContours=t,this.xMin=r,this.yMin=n,this.xMax=o,this.yMax=s,this.compound=!1}return e.prototype.encode=function(){return this.raw.data},e}(),yt=function(){function e(e,t,r,n,o){var s,i;for(this.raw=e,this.xMin=t,this.yMin=r,this.xMax=n,this.yMax=o,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],s=this.raw;i=s.readShort(),this.glyphOffsets.push(s.pos),this.glyphIDs.push(s.readUInt16()),32&i;)s.pos+=1&i?4:2,128&i?s.pos+=8:64&i?s.pos+=4:8&i&&(s.pos+=2)}return e.prototype.encode=function(){var e,t,r;for(t=new tt(pt.call(this.raw.data)),e=0,r=this.glyphIDs.length;e<r;++e)t.pos=this.glyphOffsets[e];return t.data},e}(),vt=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return ot(t,et),t.prototype.tag="loca",t.prototype.parse=function(e){var t,r;return e.pos=this.offset,t=this.file.head.indexToLocFormat,this.offsets=0===t?function(){var t,n;for(n=[],r=0,t=this.length;r<t;r+=2)n.push(2*e.readUInt16());return n}.call(this):function(){var t,n;for(n=[],r=0,t=this.length;r<t;r+=4)n.push(e.readUInt32());return n}.call(this)},t.prototype.indexOf=function(e){return this.offsets[e]},t.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},t.prototype.encode=function(e,t){for(var r=new Uint32Array(this.offsets.length),n=0,o=0,s=0;s<r.length;++s)if(r[s]=n,o<t.length&&t[o]==s){++o,r[s]=n;var i=this.offsets[s],a=this.offsets[s+1]-i;a>0&&(n+=a)}for(var A=new Array(4*r.length),u=0;u<r.length;++u)A[4*u+3]=255&r[u],A[4*u+2]=(65280&r[u])>>8,A[4*u+1]=(16711680&r[u])>>16,A[4*u]=(4278190080&r[u])>>24;return A},t}(),wt=function(){function e(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return e.prototype.generateCmap=function(){var e,t,r,n,o;for(t in n=this.font.cmap.tables[0].codeMap,e={},o=this.subset)r=o[t],e[t]=n[r];return e},e.prototype.glyphsFor=function(e){var t,r,n,o,s,i,a;for(n={},s=0,i=e.length;s<i;s++)n[o=e[s]]=this.font.glyf.glyphFor(o);for(o in t=[],n)(null!=(r=n[o])?r.compound:void 0)&&t.push.apply(t,r.glyphIDs);if(t.length>0)for(o in a=this.glyphsFor(t))r=a[o],n[o]=r;return n},e.prototype.encode=function(e,t){var r,n,o,s,i,a,A,u,c,l,d,f,h,p,m;for(n in r=at.encode(this.generateCmap(),"unicode"),s=this.glyphsFor(e),d={0:0},m=r.charMap)d[(a=m[n]).old]=a.new;for(f in l=r.maxGlyphID,s)f in d||(d[f]=l++);return u=function(e){var t,r;for(t in r={},e)r[e[t]]=t;return r}(d),c=Object.keys(u).sort((function(e,t){return e-t})),h=function(){var e,t,r;for(r=[],e=0,t=c.length;e<t;e++)i=c[e],r.push(u[i]);return r}(),o=this.font.glyf.encode(s,h,d),A=this.font.loca.encode(o.offsets,h),p={cmap:this.font.cmap.raw(),glyf:o.table,loca:A,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(p["OS/2"]=this.font.os2.raw()),this.font.directory.encode(p)},e}();H.API.PDFObject=function(){var e;function t(){}return e=function(e,t){return(Array(t+1).join("0")+e).slice(-t)},t.convert=function(r){var n,o,s,i;if(Array.isArray(r))return"["+function(){var e,o,s;for(s=[],e=0,o=r.length;e<o;e++)n=r[e],s.push(t.convert(n));return s}().join(" ")+"]";if("string"==typeof r)return"/"+r;if(null!=r?r.isString:void 0)return"("+r+")";if(r instanceof Date)return"(D:"+e(r.getUTCFullYear(),4)+e(r.getUTCMonth(),2)+e(r.getUTCDate(),2)+e(r.getUTCHours(),2)+e(r.getUTCMinutes(),2)+e(r.getUTCSeconds(),2)+"Z)";if("[object Object]"==={}.toString.call(r)){for(o in s=["<<"],r)i=r[o],s.push("/"+o+" "+t.convert(i));return s.push(">>"),s.join("\n")}return""+r},t}(),t.default=H},"./node_modules/performance-now/lib/performance-now.js":function(e){(function(){var t,r,n,o,s,i;"undefined"!=typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:"undefined"!=typeof process&&null!==process&&process.hrtime?(e.exports=function(){return(t()-s)/1e6},r=process.hrtime,o=(t=function(){var e;return 1e9*(e=r())[0]+e[1]})(),i=1e9*process.uptime(),s=o-i):Date.now?(e.exports=function(){return Date.now()-n},n=Date.now()):(e.exports=function(){return(new Date).getTime()-n},n=(new Date).getTime())}).call(this)},"./node_modules/raf/index.js":function(e,t,r){for(var n=r("./node_modules/performance-now/lib/performance-now.js"),o="undefined"==typeof window?global:window,s=["moz","webkit"],i="AnimationFrame",a=o["request"+i],A=o["cancel"+i]||o["cancelRequest"+i],u=0;!a&&u<s.length;u++)a=o[s[u]+"Request"+i],A=o[s[u]+"Cancel"+i]||o[s[u]+"CancelRequest"+i];if(!a||!A){var c=0,l=0,d=[];a=function(e){if(0===d.length){var t=n(),r=Math.max(0,16.666666666666668-(t-c));c=r+t,setTimeout((function(){var e=d.slice(0);d.length=0;for(var t=0;t<e.length;t++)if(!e[t].cancelled)try{e[t].callback(c)}catch(e){setTimeout((function(){throw e}),0)}}),Math.round(r))}return d.push({handle:++l,callback:e,cancelled:!1}),l},A=function(e){for(var t=0;t<d.length;t++)d[t].handle===e&&(d[t].cancelled=!0)}}e.exports=function(e){return a.call(o,e)},e.exports.cancel=function(){A.apply(o,arguments)},e.exports.polyfill=function(e){e||(e=o),e.requestAnimationFrame=a,e.cancelAnimationFrame=A}},"./node_modules/regenerator-runtime/runtime.js":function(e){var t=function(e){"use strict";var t,r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",a=o.toStringTag||"@@toStringTag";function A(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{A({},"")}catch(e){A=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var o=t&&t.prototype instanceof m?t:m,s=Object.create(o.prototype),i=new N(n||[]);return s._invoke=function(e,t,r){var n=l;return function(o,s){if(n===f)throw new Error("Generator is already running");if(n===h){if("throw"===o)throw s;return F()}for(r.method=o,r.arg=s;;){var i=r.delegate;if(i){var a=C(i,r);if(a){if(a===p)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===l)throw n=h,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=f;var A=c(e,t,r);if("normal"===A.type){if(n=r.done?h:d,A.arg===p)continue;return{value:A.arg,done:r.done}}"throw"===A.type&&(n=h,r.method="throw",r.arg=A.arg)}}}(e,r,i),s}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var l="suspendedStart",d="suspendedYield",f="executing",h="completed",p={};function m(){}function g(){}function y(){}var v={};A(v,s,(function(){return this}));var w=Object.getPrototypeOf,b=w&&w(w(Q([])));b&&b!==r&&n.call(b,s)&&(v=b);var B=y.prototype=m.prototype=Object.create(v);function j(e){["next","throw","return"].forEach((function(t){A(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function r(o,s,i,a){var A=c(e[o],e,s);if("throw"!==A.type){var u=A.arg,l=u.value;return l&&"object"==typeof l&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,i,a)}),(function(e){r("throw",e,i,a)})):t.resolve(l).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,a)}))}a(A.arg)}var o;this._invoke=function(e,n){function s(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(s,s):s()}}function C(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,C(e,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=c(n,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var s=o.arg;return s?s.done?(r[e.resultName]=s.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,p):s:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function Q(e){if(e){var r=e[s];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}return{next:F}}function F(){return{value:t,done:!0}}return g.prototype=y,A(B,"constructor",y),A(y,"constructor",g),g.displayName=A(y,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,A(e,a,"GeneratorFunction")),e.prototype=Object.create(B),e},e.awrap=function(e){return{__await:e}},j(_.prototype),A(_.prototype,i,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,o,s){void 0===s&&(s=Promise);var i=new _(u(t,r,n,o),s);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},j(B),A(B,a,"Generator"),A(B,s,(function(){return this})),A(B,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=Q,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var s=this.tryEntries.length-1;s>=0;--s){var i=this.tryEntries[s],a=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var A=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(A&&u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(A){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var s=o;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var i=s?s.completion:{};return i.type=e,i.arg=t,s?(this.method="next",this.next=s.finallyLoc,p):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:Q(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),p}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},"./node_modules/rgbcolor/index.js":function(e){e.exports=function(e){this.ok=!1,this.alpha=1,"#"==e.charAt(0)&&(e=e.substr(1,6)),e=(e=e.replace(/ /g,"")).toLowerCase();var t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};e=t[e]||e;for(var r=[{re:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*((?:\d?\.)?\d)\)$/,example:["rgba(123, 234, 45, 0.8)","rgba(255,234,245,1.0)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3]),parseFloat(e[4])]}},{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,example:["#00ff00","336699"],process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,example:["#fb0","f0f"],process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}],n=0;n<r.length;n++){var o=r[n].re,s=r[n].process,i=o.exec(e);if(i){var a=s(i);this.r=a[0],this.g=a[1],this.b=a[2],a.length>3&&(this.alpha=a[3]),this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.alpha=this.alpha<0?0:this.alpha>1||isNaN(this.alpha)?1:this.alpha,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toRGBA=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.alpha+")"},this.toHex=function(){var e=this.r.toString(16),t=this.g.toString(16),r=this.b.toString(16);return 1==e.length&&(e="0"+e),1==t.length&&(t="0"+t),1==r.length&&(r="0"+r),"#"+e+t+r},this.getHelpXML=function(){for(var e=new Array,n=0;n<r.length;n++)for(var o=r[n].example,s=0;s<o.length;s++)e[e.length]=o[s];for(var i in t)e[e.length]=i;var a=document.createElement("ul");for(a.setAttribute("id","rgbcolor-examples"),n=0;n<e.length;n++)try{var A=document.createElement("li"),u=new RGBColor(e[n]),c=document.createElement("div");c.style.cssText="margin: 3px; border: 1px solid black; background:"+u.toHex()+"; color:"+u.toHex(),c.appendChild(document.createTextNode("test"));var l=document.createTextNode(" "+e[n]+" -> "+u.toRGB()+" -> "+u.toHex());A.appendChild(c),A.appendChild(l),a.appendChild(A)}catch(e){}return a}}},"./node_modules/stackblur-canvas/dist/stackblur-es.js":function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}r.r(t),r.d(t,{BlurStack:function(){return d},canvasRGB:function(){return c},canvasRGBA:function(){return A},image:function(){return i},imageDataRGB:function(){return l},imageDataRGBA:function(){return u}});var o=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],s=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function i(e,t,r,n,o,s){if("string"==typeof e&&(e=document.getElementById(e)),e&&"naturalWidth"in e){var i=o?"offset":"natural",a=e[i+"Width"],u=e[i+"Height"];if("string"==typeof t&&(t=document.getElementById(t)),t&&"getContext"in t){s||(t.style.width=a+"px",t.style.height=u+"px"),t.width=a,t.height=u;var l=t.getContext("2d");l.clearRect(0,0,a,u),l.drawImage(e,0,0,e.naturalWidth,e.naturalHeight,0,0,a,u),isNaN(r)||r<1||(n?A(t,0,0,a,u,r):c(t,0,0,a,u,r))}}}function a(e,t,r,o,s){if("string"==typeof e&&(e=document.getElementById(e)),!e||"object"!==n(e)||!("getContext"in e))throw new TypeError("Expecting canvas with `getContext` method in processCanvasRGB(A) calls!");var i=e.getContext("2d");try{return i.getImageData(t,r,o,s)}catch(e){throw new Error("unable to access image data: "+e)}}function A(e,t,r,n,o,s){if(!(isNaN(s)||s<1)){s|=0;var i=a(e,t,r,n,o);i=u(i,0,0,n,o,s),e.getContext("2d").putImageData(i,t,r)}}function u(e,t,r,n,i,a){for(var A,u=e.data,c=2*a+1,l=n-1,f=i-1,h=a+1,p=h*(h+1)/2,m=new d,g=m,y=1;y<c;y++)g=g.next=new d,y===h&&(A=g);g.next=m;for(var v=null,w=null,b=0,B=0,j=o[a],_=s[a],C=0;C<i;C++){g=m;for(var x=u[B],E=u[B+1],N=u[B+2],Q=u[B+3],F=0;F<h;F++)g.r=x,g.g=E,g.b=N,g.a=Q,g=g.next;for(var U=0,S=0,L=0,T=0,H=h*x,I=h*E,P=h*N,O=h*Q,k=p*x,R=p*E,M=p*N,D=p*Q,K=1;K<h;K++){var z=B+((l<K?l:K)<<2),V=u[z],q=u[z+1],G=u[z+2],X=u[z+3],W=h-K;k+=(g.r=V)*W,R+=(g.g=q)*W,M+=(g.b=G)*W,D+=(g.a=X)*W,U+=V,S+=q,L+=G,T+=X,g=g.next}v=m,w=A;for(var J=0;J<n;J++){var Y=D*j>>_;if(u[B+3]=Y,0!==Y){var Z=255/Y;u[B]=(k*j>>_)*Z,u[B+1]=(R*j>>_)*Z,u[B+2]=(M*j>>_)*Z}else u[B]=u[B+1]=u[B+2]=0;k-=H,R-=I,M-=P,D-=O,H-=v.r,I-=v.g,P-=v.b,O-=v.a;var $=J+a+1;$=b+($<l?$:l)<<2,k+=U+=v.r=u[$],R+=S+=v.g=u[$+1],M+=L+=v.b=u[$+2],D+=T+=v.a=u[$+3],v=v.next;var ee=w,te=ee.r,re=ee.g,ne=ee.b,oe=ee.a;H+=te,I+=re,P+=ne,O+=oe,U-=te,S-=re,L-=ne,T-=oe,w=w.next,B+=4}b+=n}for(var se=0;se<n;se++){var ie=u[B=se<<2],ae=u[B+1],Ae=u[B+2],ue=u[B+3],ce=h*ie,le=h*ae,de=h*Ae,fe=h*ue,he=p*ie,pe=p*ae,me=p*Ae,ge=p*ue;g=m;for(var ye=0;ye<h;ye++)g.r=ie,g.g=ae,g.b=Ae,g.a=ue,g=g.next;for(var ve=n,we=0,be=0,Be=0,je=0,_e=1;_e<=a;_e++){B=ve+se<<2;var Ce=h-_e;he+=(g.r=ie=u[B])*Ce,pe+=(g.g=ae=u[B+1])*Ce,me+=(g.b=Ae=u[B+2])*Ce,ge+=(g.a=ue=u[B+3])*Ce,je+=ie,we+=ae,be+=Ae,Be+=ue,g=g.next,_e<f&&(ve+=n)}B=se,v=m,w=A;for(var xe=0;xe<i;xe++){var Ee=B<<2;u[Ee+3]=ue=ge*j>>_,ue>0?(ue=255/ue,u[Ee]=(he*j>>_)*ue,u[Ee+1]=(pe*j>>_)*ue,u[Ee+2]=(me*j>>_)*ue):u[Ee]=u[Ee+1]=u[Ee+2]=0,he-=ce,pe-=le,me-=de,ge-=fe,ce-=v.r,le-=v.g,de-=v.b,fe-=v.a,Ee=se+((Ee=xe+h)<f?Ee:f)*n<<2,he+=je+=v.r=u[Ee],pe+=we+=v.g=u[Ee+1],me+=be+=v.b=u[Ee+2],ge+=Be+=v.a=u[Ee+3],v=v.next,ce+=ie=w.r,le+=ae=w.g,de+=Ae=w.b,fe+=ue=w.a,je-=ie,we-=ae,be-=Ae,Be-=ue,w=w.next,B+=n}}return e}function c(e,t,r,n,o,s){if(!(isNaN(s)||s<1)){s|=0;var i=a(e,t,r,n,o);i=l(i,0,0,n,o,s),e.getContext("2d").putImageData(i,t,r)}}function l(e,t,r,n,i,a){for(var A,u=e.data,c=2*a+1,l=n-1,f=i-1,h=a+1,p=h*(h+1)/2,m=new d,g=m,y=1;y<c;y++)g=g.next=new d,y===h&&(A=g);g.next=m;for(var v,w,b=null,B=null,j=o[a],_=s[a],C=0,x=0,E=0;E<i;E++){var N=u[x],Q=u[x+1],F=u[x+2],U=h*N,S=h*Q,L=h*F,T=p*N,H=p*Q,I=p*F;g=m;for(var P=0;P<h;P++)g.r=N,g.g=Q,g.b=F,g=g.next;for(var O=0,k=0,R=0,M=1;M<h;M++)v=x+((l<M?l:M)<<2),T+=(g.r=N=u[v])*(w=h-M),H+=(g.g=Q=u[v+1])*w,I+=(g.b=F=u[v+2])*w,O+=N,k+=Q,R+=F,g=g.next;b=m,B=A;for(var D=0;D<n;D++)u[x]=T*j>>_,u[x+1]=H*j>>_,u[x+2]=I*j>>_,T-=U,H-=S,I-=L,U-=b.r,S-=b.g,L-=b.b,v=C+((v=D+a+1)<l?v:l)<<2,T+=O+=b.r=u[v],H+=k+=b.g=u[v+1],I+=R+=b.b=u[v+2],b=b.next,U+=N=B.r,S+=Q=B.g,L+=F=B.b,O-=N,k-=Q,R-=F,B=B.next,x+=4;C+=n}for(var K=0;K<n;K++){var z=u[x=K<<2],V=u[x+1],q=u[x+2],G=h*z,X=h*V,W=h*q,J=p*z,Y=p*V,Z=p*q;g=m;for(var $=0;$<h;$++)g.r=z,g.g=V,g.b=q,g=g.next;for(var ee=0,te=0,re=0,ne=1,oe=n;ne<=a;ne++)x=oe+K<<2,J+=(g.r=z=u[x])*(w=h-ne),Y+=(g.g=V=u[x+1])*w,Z+=(g.b=q=u[x+2])*w,ee+=z,te+=V,re+=q,g=g.next,ne<f&&(oe+=n);x=K,b=m,B=A;for(var se=0;se<i;se++)u[v=x<<2]=J*j>>_,u[v+1]=Y*j>>_,u[v+2]=Z*j>>_,J-=G,Y-=X,Z-=W,G-=b.r,X-=b.g,W-=b.b,v=K+((v=se+h)<f?v:f)*n<<2,J+=ee+=b.r=u[v],Y+=te+=b.g=u[v+1],Z+=re+=b.b=u[v+2],b=b.next,G+=z=B.r,X+=V=B.g,W+=q=B.b,ee-=z,te-=V,re-=q,B=B.next,x+=n}return e}var d=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}},"./node_modules/svg-pathdata/lib/SVGPathData.module.js":function(e,t,r){"use strict";r.r(t),r.d(t,{COMMAND_ARG_COUNTS:function(){return j},SVGPathData:function(){return B},SVGPathDataParser:function(){return b},SVGPathDataTransformer:function(){return l},encodeSVGPath:function(){return s}});var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function o(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function s(e){var t="";Array.isArray(e)||(e=[e]);for(var r=0;r<e.length;r++){var n=e[r];if(n.type===B.CLOSE_PATH)t+="z";else if(n.type===B.HORIZ_LINE_TO)t+=(n.relative?"h":"H")+n.x;else if(n.type===B.VERT_LINE_TO)t+=(n.relative?"v":"V")+n.y;else if(n.type===B.MOVE_TO)t+=(n.relative?"m":"M")+n.x+" "+n.y;else if(n.type===B.LINE_TO)t+=(n.relative?"l":"L")+n.x+" "+n.y;else if(n.type===B.CURVE_TO)t+=(n.relative?"c":"C")+n.x1+" "+n.y1+" "+n.x2+" "+n.y2+" "+n.x+" "+n.y;else if(n.type===B.SMOOTH_CURVE_TO)t+=(n.relative?"s":"S")+n.x2+" "+n.y2+" "+n.x+" "+n.y;else if(n.type===B.QUAD_TO)t+=(n.relative?"q":"Q")+n.x1+" "+n.y1+" "+n.x+" "+n.y;else if(n.type===B.SMOOTH_QUAD_TO)t+=(n.relative?"t":"T")+n.x+" "+n.y;else{if(n.type!==B.ARC)throw new Error('Unexpected command type "'+n.type+'" at index '+r+".");t+=(n.relative?"a":"A")+n.rX+" "+n.rY+" "+n.xRot+" "+ +n.lArcFlag+" "+ +n.sweepFlag+" "+n.x+" "+n.y}}return t}function i(e,t){var r=e[0],n=e[1];return[r*Math.cos(t)-n*Math.sin(t),r*Math.sin(t)+n*Math.cos(t)]}function a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0;r<e.length;r++)if("number"!=typeof e[r])throw new Error("assertNumbers arguments["+r+"] is not a number. "+typeof e[r]+" == typeof "+e[r]);return!0}var A=Math.PI;function u(e,t,r){e.lArcFlag=0===e.lArcFlag?0:1,e.sweepFlag=0===e.sweepFlag?0:1;var n=e.rX,o=e.rY,s=e.x,a=e.y;n=Math.abs(e.rX),o=Math.abs(e.rY);var u=i([(t-s)/2,(r-a)/2],-e.xRot/180*A),c=u[0],l=u[1],d=Math.pow(c,2)/Math.pow(n,2)+Math.pow(l,2)/Math.pow(o,2);1<d&&(n*=Math.sqrt(d),o*=Math.sqrt(d)),e.rX=n,e.rY=o;var f=Math.pow(n,2)*Math.pow(l,2)+Math.pow(o,2)*Math.pow(c,2),h=(e.lArcFlag!==e.sweepFlag?1:-1)*Math.sqrt(Math.max(0,(Math.pow(n,2)*Math.pow(o,2)-f)/f)),p=n*l/o*h,m=-o*c/n*h,g=i([p,m],e.xRot/180*A);e.cX=g[0]+(t+s)/2,e.cY=g[1]+(r+a)/2,e.phi1=Math.atan2((l-m)/o,(c-p)/n),e.phi2=Math.atan2((-l-m)/o,(-c-p)/n),0===e.sweepFlag&&e.phi2>e.phi1&&(e.phi2-=2*A),1===e.sweepFlag&&e.phi2<e.phi1&&(e.phi2+=2*A),e.phi1*=180/A,e.phi2*=180/A}function c(e,t,r){a(e,t,r);var n=e*e+t*t-r*r;if(0>n)return[];if(0===n)return[[e*r/(e*e+t*t),t*r/(e*e+t*t)]];var o=Math.sqrt(n);return[[(e*r+t*o)/(e*e+t*t),(t*r-e*o)/(e*e+t*t)],[(e*r-t*o)/(e*e+t*t),(t*r+e*o)/(e*e+t*t)]]}var l,d=Math.PI/180;function f(e,t,r){return(1-r)*e+r*t}function h(e,t,r,n){return e+Math.cos(n/180*A)*t+Math.sin(n/180*A)*r}function p(e,t,r,n){var o=t-e,s=r-t,i=3*o+3*(n-r)-6*s,a=6*(s-o),A=3*o;return Math.abs(i)<1e-6?[-A/a]:function(e,t,r){void 0===r&&(r=1e-6);var n=e*e/4-t;if(n<-r)return[];if(n<=r)return[-e/2];var o=Math.sqrt(n);return[-e/2-o,-e/2+o]}(a/i,A/i,1e-6)}function m(e,t,r,n,o){var s=1-o;return e*(s*s*s)+t*(3*s*s*o)+r*(3*s*o*o)+n*(o*o*o)}!function(e){function t(){return o((function(e,t,r){return e.relative&&(void 0!==e.x1&&(e.x1+=t),void 0!==e.y1&&(e.y1+=r),void 0!==e.x2&&(e.x2+=t),void 0!==e.y2&&(e.y2+=r),void 0!==e.x&&(e.x+=t),void 0!==e.y&&(e.y+=r),e.relative=!1),e}))}function r(){var e=NaN,t=NaN,r=NaN,n=NaN;return o((function(o,s,i){return o.type&B.SMOOTH_CURVE_TO&&(o.type=B.CURVE_TO,e=isNaN(e)?s:e,t=isNaN(t)?i:t,o.x1=o.relative?s-e:2*s-e,o.y1=o.relative?i-t:2*i-t),o.type&B.CURVE_TO?(e=o.relative?s+o.x2:o.x2,t=o.relative?i+o.y2:o.y2):(e=NaN,t=NaN),o.type&B.SMOOTH_QUAD_TO&&(o.type=B.QUAD_TO,r=isNaN(r)?s:r,n=isNaN(n)?i:n,o.x1=o.relative?s-r:2*s-r,o.y1=o.relative?i-n:2*i-n),o.type&B.QUAD_TO?(r=o.relative?s+o.x1:o.x1,n=o.relative?i+o.y1:o.y1):(r=NaN,n=NaN),o}))}function n(){var e=NaN,t=NaN;return o((function(r,n,o){if(r.type&B.SMOOTH_QUAD_TO&&(r.type=B.QUAD_TO,e=isNaN(e)?n:e,t=isNaN(t)?o:t,r.x1=r.relative?n-e:2*n-e,r.y1=r.relative?o-t:2*o-t),r.type&B.QUAD_TO){e=r.relative?n+r.x1:r.x1,t=r.relative?o+r.y1:r.y1;var s=r.x1,i=r.y1;r.type=B.CURVE_TO,r.x1=((r.relative?0:n)+2*s)/3,r.y1=((r.relative?0:o)+2*i)/3,r.x2=(r.x+2*s)/3,r.y2=(r.y+2*i)/3}else e=NaN,t=NaN;return r}))}function o(e){var t=0,r=0,n=NaN,o=NaN;return function(s){if(isNaN(n)&&!(s.type&B.MOVE_TO))throw new Error("path must start with moveto");var i=e(s,t,r,n,o);return s.type&B.CLOSE_PATH&&(t=n,r=o),void 0!==s.x&&(t=s.relative?t+s.x:s.x),void 0!==s.y&&(r=s.relative?r+s.y:s.y),s.type&B.MOVE_TO&&(n=t,o=r),i}}function s(e,t,r,n,s,i){return a(e,t,r,n,s,i),o((function(o,a,A,u){var c=o.x1,l=o.x2,d=o.relative&&!isNaN(u),f=void 0!==o.x?o.x:d?0:a,h=void 0!==o.y?o.y:d?0:A;function p(e){return e*e}o.type&B.HORIZ_LINE_TO&&0!==t&&(o.type=B.LINE_TO,o.y=o.relative?0:A),o.type&B.VERT_LINE_TO&&0!==r&&(o.type=B.LINE_TO,o.x=o.relative?0:a),void 0!==o.x&&(o.x=o.x*e+h*r+(d?0:s)),void 0!==o.y&&(o.y=f*t+o.y*n+(d?0:i)),void 0!==o.x1&&(o.x1=o.x1*e+o.y1*r+(d?0:s)),void 0!==o.y1&&(o.y1=c*t+o.y1*n+(d?0:i)),void 0!==o.x2&&(o.x2=o.x2*e+o.y2*r+(d?0:s)),void 0!==o.y2&&(o.y2=l*t+o.y2*n+(d?0:i));var m=e*n-t*r;if(void 0!==o.xRot&&(1!==e||0!==t||0!==r||1!==n))if(0===m)delete o.rX,delete o.rY,delete o.xRot,delete o.lArcFlag,delete o.sweepFlag,o.type=B.LINE_TO;else{var g=o.xRot*Math.PI/180,y=Math.sin(g),v=Math.cos(g),w=1/p(o.rX),b=1/p(o.rY),j=p(v)*w+p(y)*b,_=2*y*v*(w-b),C=p(y)*w+p(v)*b,x=j*n*n-_*t*n+C*t*t,E=_*(e*n+t*r)-2*(j*r*n+C*e*t),N=j*r*r-_*e*r+C*e*e,Q=(Math.atan2(E,x-N)+Math.PI)%Math.PI/2,F=Math.sin(Q),U=Math.cos(Q);o.rX=Math.abs(m)/Math.sqrt(x*p(U)+E*F*U+N*p(F)),o.rY=Math.abs(m)/Math.sqrt(x*p(F)-E*F*U+N*p(U)),o.xRot=180*Q/Math.PI}return void 0!==o.sweepFlag&&0>m&&(o.sweepFlag=+!o.sweepFlag),o}))}e.ROUND=function(e){function t(t){return Math.round(t*e)/e}return void 0===e&&(e=1e13),a(e),function(e){return void 0!==e.x1&&(e.x1=t(e.x1)),void 0!==e.y1&&(e.y1=t(e.y1)),void 0!==e.x2&&(e.x2=t(e.x2)),void 0!==e.y2&&(e.y2=t(e.y2)),void 0!==e.x&&(e.x=t(e.x)),void 0!==e.y&&(e.y=t(e.y)),void 0!==e.rX&&(e.rX=t(e.rX)),void 0!==e.rY&&(e.rY=t(e.rY)),e}},e.TO_ABS=t,e.TO_REL=function(){return o((function(e,t,r){return e.relative||(void 0!==e.x1&&(e.x1-=t),void 0!==e.y1&&(e.y1-=r),void 0!==e.x2&&(e.x2-=t),void 0!==e.y2&&(e.y2-=r),void 0!==e.x&&(e.x-=t),void 0!==e.y&&(e.y-=r),e.relative=!0),e}))},e.NORMALIZE_HVZ=function(e,t,r){return void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===r&&(r=!0),o((function(n,o,s,i,a){if(isNaN(i)&&!(n.type&B.MOVE_TO))throw new Error("path must start with moveto");return t&&n.type&B.HORIZ_LINE_TO&&(n.type=B.LINE_TO,n.y=n.relative?0:s),r&&n.type&B.VERT_LINE_TO&&(n.type=B.LINE_TO,n.x=n.relative?0:o),e&&n.type&B.CLOSE_PATH&&(n.type=B.LINE_TO,n.x=n.relative?i-o:i,n.y=n.relative?a-s:a),n.type&B.ARC&&(0===n.rX||0===n.rY)&&(n.type=B.LINE_TO,delete n.rX,delete n.rY,delete n.xRot,delete n.lArcFlag,delete n.sweepFlag),n}))},e.NORMALIZE_ST=r,e.QT_TO_C=n,e.INFO=o,e.SANITIZE=function(e){void 0===e&&(e=0),a(e);var t=NaN,r=NaN,n=NaN,s=NaN;return o((function(o,i,a,A,u){var c=Math.abs,l=!1,d=0,f=0;if(o.type&B.SMOOTH_CURVE_TO&&(d=isNaN(t)?0:i-t,f=isNaN(r)?0:a-r),o.type&(B.CURVE_TO|B.SMOOTH_CURVE_TO)?(t=o.relative?i+o.x2:o.x2,r=o.relative?a+o.y2:o.y2):(t=NaN,r=NaN),o.type&B.SMOOTH_QUAD_TO?(n=isNaN(n)?i:2*i-n,s=isNaN(s)?a:2*a-s):o.type&B.QUAD_TO?(n=o.relative?i+o.x1:o.x1,s=o.relative?a+o.y1:o.y2):(n=NaN,s=NaN),o.type&B.LINE_COMMANDS||o.type&B.ARC&&(0===o.rX||0===o.rY||!o.lArcFlag)||o.type&B.CURVE_TO||o.type&B.SMOOTH_CURVE_TO||o.type&B.QUAD_TO||o.type&B.SMOOTH_QUAD_TO){var h=void 0===o.x?0:o.relative?o.x:o.x-i,p=void 0===o.y?0:o.relative?o.y:o.y-a;d=isNaN(n)?void 0===o.x1?d:o.relative?o.x:o.x1-i:n-i,f=isNaN(s)?void 0===o.y1?f:o.relative?o.y:o.y1-a:s-a;var m=void 0===o.x2?0:o.relative?o.x:o.x2-i,g=void 0===o.y2?0:o.relative?o.y:o.y2-a;c(h)<=e&&c(p)<=e&&c(d)<=e&&c(f)<=e&&c(m)<=e&&c(g)<=e&&(l=!0)}return o.type&B.CLOSE_PATH&&c(i-A)<=e&&c(a-u)<=e&&(l=!0),l?[]:o}))},e.MATRIX=s,e.ROTATE=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=0),a(e,t,r);var n=Math.sin(e),o=Math.cos(e);return s(o,n,-n,o,t-t*o+r*n,r-t*n-r*o)},e.TRANSLATE=function(e,t){return void 0===t&&(t=0),a(e,t),s(1,0,0,1,e,t)},e.SCALE=function(e,t){return void 0===t&&(t=e),a(e,t),s(e,0,0,t,0,0)},e.SKEW_X=function(e){return a(e),s(1,0,Math.atan(e),1,0,0)},e.SKEW_Y=function(e){return a(e),s(1,Math.atan(e),0,1,0,0)},e.X_AXIS_SYMMETRY=function(e){return void 0===e&&(e=0),a(e),s(-1,0,0,1,e,0)},e.Y_AXIS_SYMMETRY=function(e){return void 0===e&&(e=0),a(e),s(1,0,0,-1,0,e)},e.A_TO_C=function(){return o((function(e,t,r){return B.ARC===e.type?function(e,t,r){var n,o,s,a;e.cX||u(e,t,r);for(var A=Math.min(e.phi1,e.phi2),c=Math.max(e.phi1,e.phi2)-A,l=Math.ceil(c/90),h=new Array(l),p=t,m=r,g=0;g<l;g++){var y=f(e.phi1,e.phi2,g/l),v=f(e.phi1,e.phi2,(g+1)/l),w=v-y,b=4/3*Math.tan(w*d/4),j=[Math.cos(y*d)-b*Math.sin(y*d),Math.sin(y*d)+b*Math.cos(y*d)],_=j[0],C=j[1],x=[Math.cos(v*d),Math.sin(v*d)],E=x[0],N=x[1],Q=[E+b*Math.sin(v*d),N-b*Math.cos(v*d)],F=Q[0],U=Q[1];h[g]={relative:e.relative,type:B.CURVE_TO};var S=function(t,r){var n=i([t*e.rX,r*e.rY],e.xRot),o=n[0],s=n[1];return[e.cX+o,e.cY+s]};n=S(_,C),h[g].x1=n[0],h[g].y1=n[1],o=S(F,U),h[g].x2=o[0],h[g].y2=o[1],s=S(E,N),h[g].x=s[0],h[g].y=s[1],e.relative&&(h[g].x1-=p,h[g].y1-=m,h[g].x2-=p,h[g].y2-=m,h[g].x-=p,h[g].y-=m),p=(a=[h[g].x,h[g].y])[0],m=a[1]}return h}(e,e.relative?0:t,e.relative?0:r):e}))},e.ANNOTATE_ARCS=function(){return o((function(e,t,r){return e.relative&&(t=0,r=0),B.ARC===e.type&&u(e,t,r),e}))},e.CLONE=function(){return function(e){var t={};for(var r in e)t[r]=e[r];return t}},e.CALCULATE_BOUNDS=function(){var e=t(),s=n(),i=r(),a=o((function(t,r,n){var o=i(s(e(function(e){var t={};for(var r in e)t[r]=e[r];return t}(t))));function A(e){e>a.maxX&&(a.maxX=e),e<a.minX&&(a.minX=e)}function l(e){e>a.maxY&&(a.maxY=e),e<a.minY&&(a.minY=e)}if(o.type&B.DRAWING_COMMANDS&&(A(r),l(n)),o.type&B.HORIZ_LINE_TO&&A(o.x),o.type&B.VERT_LINE_TO&&l(o.y),o.type&B.LINE_TO&&(A(o.x),l(o.y)),o.type&B.CURVE_TO){A(o.x),l(o.y);for(var d=0,f=p(r,o.x1,o.x2,o.x);d<f.length;d++)0<(L=f[d])&&1>L&&A(m(r,o.x1,o.x2,o.x,L));for(var g=0,y=p(n,o.y1,o.y2,o.y);g<y.length;g++)0<(L=y[g])&&1>L&&l(m(n,o.y1,o.y2,o.y,L))}if(o.type&B.ARC){A(o.x),l(o.y),u(o,r,n);for(var v=o.xRot/180*Math.PI,w=Math.cos(v)*o.rX,b=Math.sin(v)*o.rX,j=-Math.sin(v)*o.rY,_=Math.cos(v)*o.rY,C=o.phi1<o.phi2?[o.phi1,o.phi2]:-180>o.phi2?[o.phi2+360,o.phi1+360]:[o.phi2,o.phi1],x=C[0],E=C[1],N=function(e){var t=e[0],r=e[1],n=180*Math.atan2(r,t)/Math.PI;return n<x?n+360:n},Q=0,F=c(j,-w,0).map(N);Q<F.length;Q++)(L=F[Q])>x&&L<E&&A(h(o.cX,w,j,L));for(var U=0,S=c(_,-b,0).map(N);U<S.length;U++){var L;(L=S[U])>x&&L<E&&l(h(o.cY,b,_,L))}}return t}));return a.minX=1/0,a.maxX=-1/0,a.minY=1/0,a.maxY=-1/0,a}}(l||(l={}));var g,y=function(){function e(){}return e.prototype.round=function(e){return this.transform(l.ROUND(e))},e.prototype.toAbs=function(){return this.transform(l.TO_ABS())},e.prototype.toRel=function(){return this.transform(l.TO_REL())},e.prototype.normalizeHVZ=function(e,t,r){return this.transform(l.NORMALIZE_HVZ(e,t,r))},e.prototype.normalizeST=function(){return this.transform(l.NORMALIZE_ST())},e.prototype.qtToC=function(){return this.transform(l.QT_TO_C())},e.prototype.aToC=function(){return this.transform(l.A_TO_C())},e.prototype.sanitize=function(e){return this.transform(l.SANITIZE(e))},e.prototype.translate=function(e,t){return this.transform(l.TRANSLATE(e,t))},e.prototype.scale=function(e,t){return this.transform(l.SCALE(e,t))},e.prototype.rotate=function(e,t,r){return this.transform(l.ROTATE(e,t,r))},e.prototype.matrix=function(e,t,r,n,o,s){return this.transform(l.MATRIX(e,t,r,n,o,s))},e.prototype.skewX=function(e){return this.transform(l.SKEW_X(e))},e.prototype.skewY=function(e){return this.transform(l.SKEW_Y(e))},e.prototype.xSymmetry=function(e){return this.transform(l.X_AXIS_SYMMETRY(e))},e.prototype.ySymmetry=function(e){return this.transform(l.Y_AXIS_SYMMETRY(e))},e.prototype.annotateArcs=function(){return this.transform(l.ANNOTATE_ARCS())},e}(),v=function(e){return" "===e||"\t"===e||"\r"===e||"\n"===e},w=function(e){return"0".charCodeAt(0)<=e.charCodeAt(0)&&e.charCodeAt(0)<="9".charCodeAt(0)},b=function(e){function t(){var t=e.call(this)||this;return t.curNumber="",t.curCommandType=-1,t.curCommandRelative=!1,t.canParseCommandOrComma=!0,t.curNumberHasExp=!1,t.curNumberHasExpDigits=!1,t.curNumberHasDecimal=!1,t.curArgs=[],t}return o(t,e),t.prototype.finish=function(e){if(void 0===e&&(e=[]),this.parse(" ",e),0!==this.curArgs.length||!this.canParseCommandOrComma)throw new SyntaxError("Unterminated command at the path end.");return e},t.prototype.parse=function(e,t){var r=this;void 0===t&&(t=[]);for(var n=function(e){t.push(e),r.curArgs.length=0,r.canParseCommandOrComma=!0},o=0;o<e.length;o++){var s=e[o],i=!(this.curCommandType!==B.ARC||3!==this.curArgs.length&&4!==this.curArgs.length||1!==this.curNumber.length||"0"!==this.curNumber&&"1"!==this.curNumber),a=w(s)&&("0"===this.curNumber&&"0"===s||i);if(!w(s)||a)if("e"!==s&&"E"!==s)if("-"!==s&&"+"!==s||!this.curNumberHasExp||this.curNumberHasExpDigits)if("."!==s||this.curNumberHasExp||this.curNumberHasDecimal||i){if(this.curNumber&&-1!==this.curCommandType){var A=Number(this.curNumber);if(isNaN(A))throw new SyntaxError("Invalid number ending at "+o);if(this.curCommandType===B.ARC)if(0===this.curArgs.length||1===this.curArgs.length){if(0>A)throw new SyntaxError('Expected positive number, got "'+A+'" at index "'+o+'"')}else if((3===this.curArgs.length||4===this.curArgs.length)&&"0"!==this.curNumber&&"1"!==this.curNumber)throw new SyntaxError('Expected a flag, got "'+this.curNumber+'" at index "'+o+'"');this.curArgs.push(A),this.curArgs.length===j[this.curCommandType]&&(B.HORIZ_LINE_TO===this.curCommandType?n({type:B.HORIZ_LINE_TO,relative:this.curCommandRelative,x:A}):B.VERT_LINE_TO===this.curCommandType?n({type:B.VERT_LINE_TO,relative:this.curCommandRelative,y:A}):this.curCommandType===B.MOVE_TO||this.curCommandType===B.LINE_TO||this.curCommandType===B.SMOOTH_QUAD_TO?(n({type:this.curCommandType,relative:this.curCommandRelative,x:this.curArgs[0],y:this.curArgs[1]}),B.MOVE_TO===this.curCommandType&&(this.curCommandType=B.LINE_TO)):this.curCommandType===B.CURVE_TO?n({type:B.CURVE_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x2:this.curArgs[2],y2:this.curArgs[3],x:this.curArgs[4],y:this.curArgs[5]}):this.curCommandType===B.SMOOTH_CURVE_TO?n({type:B.SMOOTH_CURVE_TO,relative:this.curCommandRelative,x2:this.curArgs[0],y2:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===B.QUAD_TO?n({type:B.QUAD_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===B.ARC&&n({type:B.ARC,relative:this.curCommandRelative,rX:this.curArgs[0],rY:this.curArgs[1],xRot:this.curArgs[2],lArcFlag:this.curArgs[3],sweepFlag:this.curArgs[4],x:this.curArgs[5],y:this.curArgs[6]})),this.curNumber="",this.curNumberHasExpDigits=!1,this.curNumberHasExp=!1,this.curNumberHasDecimal=!1,this.canParseCommandOrComma=!0}if(!v(s))if(","===s&&this.canParseCommandOrComma)this.canParseCommandOrComma=!1;else if("+"!==s&&"-"!==s&&"."!==s)if(a)this.curNumber=s,this.curNumberHasDecimal=!1;else{if(0!==this.curArgs.length)throw new SyntaxError("Unterminated command at index "+o+".");if(!this.canParseCommandOrComma)throw new SyntaxError('Unexpected character "'+s+'" at index '+o+". Command cannot follow comma");if(this.canParseCommandOrComma=!1,"z"!==s&&"Z"!==s)if("h"===s||"H"===s)this.curCommandType=B.HORIZ_LINE_TO,this.curCommandRelative="h"===s;else if("v"===s||"V"===s)this.curCommandType=B.VERT_LINE_TO,this.curCommandRelative="v"===s;else if("m"===s||"M"===s)this.curCommandType=B.MOVE_TO,this.curCommandRelative="m"===s;else if("l"===s||"L"===s)this.curCommandType=B.LINE_TO,this.curCommandRelative="l"===s;else if("c"===s||"C"===s)this.curCommandType=B.CURVE_TO,this.curCommandRelative="c"===s;else if("s"===s||"S"===s)this.curCommandType=B.SMOOTH_CURVE_TO,this.curCommandRelative="s"===s;else if("q"===s||"Q"===s)this.curCommandType=B.QUAD_TO,this.curCommandRelative="q"===s;else if("t"===s||"T"===s)this.curCommandType=B.SMOOTH_QUAD_TO,this.curCommandRelative="t"===s;else{if("a"!==s&&"A"!==s)throw new SyntaxError('Unexpected character "'+s+'" at index '+o+".");this.curCommandType=B.ARC,this.curCommandRelative="a"===s}else t.push({type:B.CLOSE_PATH}),this.canParseCommandOrComma=!0,this.curCommandType=-1}else this.curNumber=s,this.curNumberHasDecimal="."===s}else this.curNumber+=s,this.curNumberHasDecimal=!0;else this.curNumber+=s;else this.curNumber+=s,this.curNumberHasExp=!0;else this.curNumber+=s,this.curNumberHasExpDigits=this.curNumberHasExp}return t},t.prototype.transform=function(e){return Object.create(this,{parse:{value:function(t,r){void 0===r&&(r=[]);for(var n=0,o=Object.getPrototypeOf(this).parse.call(this,t);n<o.length;n++){var s=o[n],i=e(s);Array.isArray(i)?r.push.apply(r,i):r.push(i)}return r}}})},t}(y),B=function(e){function t(r){var n=e.call(this)||this;return n.commands="string"==typeof r?t.parse(r):r,n}return o(t,e),t.prototype.encode=function(){return t.encode(this.commands)},t.prototype.getBounds=function(){var e=l.CALCULATE_BOUNDS();return this.transform(e),e},t.prototype.transform=function(e){for(var t=[],r=0,n=this.commands;r<n.length;r++){var o=e(n[r]);Array.isArray(o)?t.push.apply(t,o):t.push(o)}return this.commands=t,this},t.encode=function(e){return s(e)},t.parse=function(e){var t=new b,r=[];return t.parse(e,r),t.finish(r),r},t.CLOSE_PATH=1,t.MOVE_TO=2,t.HORIZ_LINE_TO=4,t.VERT_LINE_TO=8,t.LINE_TO=16,t.CURVE_TO=32,t.SMOOTH_CURVE_TO=64,t.QUAD_TO=128,t.SMOOTH_QUAD_TO=256,t.ARC=512,t.LINE_COMMANDS=t.LINE_TO|t.HORIZ_LINE_TO|t.VERT_LINE_TO,t.DRAWING_COMMANDS=t.HORIZ_LINE_TO|t.VERT_LINE_TO|t.LINE_TO|t.CURVE_TO|t.SMOOTH_CURVE_TO|t.QUAD_TO|t.SMOOTH_QUAD_TO|t.ARC,t}(y),j=((g={})[B.MOVE_TO]=2,g[B.LINE_TO]=2,g[B.HORIZ_LINE_TO]=1,g[B.VERT_LINE_TO]=1,g[B.CLOSE_PATH]=0,g[B.QUAD_TO]=4,g[B.SMOOTH_QUAD_TO]=2,g[B.CURVE_TO]=6,g[B.SMOOTH_CURVE_TO]=4,g[B.ARC]=7,g)}},n={};function o(e){var t=n[e];if(void 0!==t)return t.exports;var s=n[e]={exports:{}};return r[e].call(s.exports,s,s.exports,o),s.exports}o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,{a:t}),t},t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__},o.t=function(r,n){if(1&n&&(r=this(r)),8&n)return r;if("object"==typeof r&&r){if(4&n&&r.__esModule)return r;if(16&n&&"function"==typeof r.then)return r}var s=Object.create(null);o.r(s);var i={};e=e||[null,t({}),t([]),t(t)];for(var a=2&n&&r;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((function(e){i[e]=function(){return r[e]}}));return i.default=function(){return r},o.d(s,i),s},o.d=function(e,t){for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};return function(){"use strict";o.r(s);var e=o("./src/worker.js"),t=(o("./src/plugin/jspdf-plugin.js"),o("./src/plugin/pagebreaks.js"),o("./src/plugin/hyperlinks.js"),function e(t,r){var n=new e.Worker(r);return t?n.from(t).save():n});t.Worker=e.default,s.default=t}(),s.default}()}));
//# sourceMappingURL=html2pdf.bundle.min.js.map
// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                         I N P U T                                              // 
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

var input = {};









// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      K E Y B O A R D                                           // 
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

const KEY_BACKSP = 8;
const KEY_DEL    = 46;
const KEY_ESC    = 27;
const KEY_END    = 35;
const KEY_PGUP   = 33;
const KEY_PGDN   = 34;
const KEY_LSHIFT = 16;
const KEY_LALT   = 18;
const KEY_LEFT   = 37;
const KEY_RIGHT  = 39;
const KEY_UP     = 38;
const KEY_DOWN   = 40;
const KEY_PLUS   = 107;
const KEY_MINUS  = 109;
const KEY_LCTRL  = 17;
const KEY_RCTRL  = 17;
const KEY_PREVIOUS  = 177;
const KEY_NEXT  = 176;
const KEY_PLAY  = 179;
const KEY_CONTEXTMEMU  = 93;


input["keyboard"]             = {};
input["keyboard"]["keys"]     = {};
input["keyboard"]["codes"]    = {};




function Input_Keyboard_Assign(element, onupdate)
{
 input["keyboard"]["controller"]  = element;
 input["keyboard"]["onupdate"]    = onupdate;
 
 input["keyboard"]["controller"].onkeydown = Input_Keyboard_Down;
 input["keyboard"]["controller"].onkeyup   = Input_Keyboard_Up;
 
 /*
 window.addEventListener("keydown", Input_Keyboard_Down, true);
 window.addEventListener("keyup",   Input_Keyboard_Up,   true);
 */
}



function Input_Keyboard_Release()
{
 if(!input["keyboard"]["controller"]) return;
	 
 input["keyboard"]["controller"].onkeydown = false;
 input["keyboard"]["controller"].onkeyup   = false;
 
 input["keyboard"]["controller"]  = false;
 input["keyboard"]["onupdate"]    = false;
}




function Input_Keyboard_Lock()
{
 input["keyboard"]["locked"] = true;
}




function Input_Keyboard_Unlock()
{
 input["keyboard"]["locked"] = false;
}




function Input_Keyboard_Update()
{
 if(input["keyboard"]["onupdate"]) 
 {
  input["keyboard"]["onupdate"]();
 }
}





function Input_Keyboard_Down(event)
{
 if(input["keyboard"]["locked"]) return;
 
 input["keyboard"]["keys"][String.fromCharCode(event.keyCode)] = true;
 input["keyboard"]["codes"][event.keyCode]                     = true;
 
 Input_Keyboard_Update();
}





function Input_Keyboard_Up(event)
{
 if(input["keyboard"]["locked"]) return;
 
 delete input["keyboard"]["keys"][String.fromCharCode(event.keyCode)];
 delete input["keyboard"]["codes"][event.keyCode];
 
 Input_Keyboard_Update();
}





function Input_Keyboard_Pressed(key, codes)
{
 if(codes) for(var code of codes) if(!input["keyboard"]["codes"][code]) return false;
 
 if(key && !input["keyboard"]["keys"][key]) return false;
 
 return true;
}






function Input_Keyboard_Reset()
{
 input["keyboard"]["keys"]  = {};
 input["keyboard"]["codes"] = {};
}






// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                           M O U S E                                            // 
//                                                                                                //
// -----------------------------------------------------------------------------------------------//




function Input_Mouse_Bind(element, onmousemove, onmouseup, onmousedown, onwheel)
{
 // MOUSE MOVE
 element.onmousemove = 
 function(event)
 {
  var element = event.currentTarget;
  if(!element) return;
  
  var rect   = element.getBoundingClientRect();
  var x      = event.clientX - rect.left;
  var y      = event.clientY - rect.top;
 
  var dx = x - parseInt(element.getAttribute("lastx") || 0);
  var dy = y - parseInt(element.getAttribute("lasty") || 0);
 
  element.setAttribute("lastx", x)
  element.setAttribute("lasty", y)
  
  var button = element.getAttribute("button");
 
  if(onmousemove) onmousemove(dx, dy, button);
 }


 // MOUSE DOWN 
 element.onmousedown = 
 function(event)
 {
  var element = event.currentTarget;
  if(!element) return;
  
  element.setAttribute("mousedown", true);
  element.setAttribute("button",    event.button);
  
  if(onmousedown) onmousedown(element);
 }
 
 
 // MOUSE UP
 element.onmouseup = 
 function(event)
 {
  var element = event.currentTarget;
  if(!element) return;
  
  element.setAttribute("mousedown", false);
  element.setAttribute("button",    false);

  if(onmouseup) onmouseup(element);
 }
 
}








// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                           T O U C H                                            // 
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Input_Touch_Handler(event)
{
 var touches = event.changedTouches;
 var first   = touches[0];
 var type    = "";
 
 switch(event.type)
 {
  case 
	"touchstart": 
		type = "mousedown"; 
	break;
        
	case "touchmove":  
		type = "mousemove"; 
	break;        
        
	case "touchend":   
		type = "mouseup";   
	break;
    
	default:           
	return;
 }

 // initMouseEvent(type, canBubble, cancelable, view, clickCount, 
 //                screenX, screenY, clientX, clientY, ctrlKey, 
 //                altKey, shiftKey, metaKey, button, relatedTarget);

 var simulatedEvent = document.createEvent("MouseEvent");
 
 simulatedEvent.initMouseEvent(type, true, true, window, 1, first.screenX, first.screenY, first.clientX, first.clientY, false, false, false, false, 0/*left*/, null);

 first.target.dispatchEvent(simulatedEvent);
 event.preventDefault();
}





function Input_Touch_Remap(element) 
{
 if(!element) var element = document;
 
 element.addEventListener("touchstart",  Input_Touch_Handler, true);
 element.addEventListener("touchmove",   Input_Touch_Handler, true);
 element.addEventListener("touchend",    Input_Touch_Handler, true);
 element.addEventListener("touchcancel", Input_Touch_Handler, true);    
}





function Input_Touch_Unmap(element)
{
 if(!element) var element = document;
 
 element.removeEventListener("touchstart",  Input_Touch_Handler, true);
 element.removeEventListener("touchmove",   Input_Touch_Handler, true);
 element.removeEventListener("touchend",    Input_Touch_Handler, true);
 element.removeEventListener("touchcancel", Input_Touch_Handler, true);    
}/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.localforage=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(a){"use strict";function c(){k=!0;for(var a,b,c=l.length;c;){for(b=l,l=[],a=-1;++a<c;)b[a]();c=l.length}k=!1}function d(a){1!==l.push(a)||k||e()}var e,f=a.MutationObserver||a.WebKitMutationObserver;if(f){var g=0,h=new f(c),i=a.document.createTextNode("");h.observe(i,{characterData:!0}),e=function(){i.data=g=++g%2}}else if(a.setImmediate||void 0===a.MessageChannel)e="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(){var b=a.document.createElement("script");b.onreadystatechange=function(){c(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},a.document.documentElement.appendChild(b)}:function(){setTimeout(c,0)};else{var j=new a.MessageChannel;j.port1.onmessage=c,e=function(){j.port2.postMessage(0)}}var k,l=[];b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(a,b,c){"use strict";function d(){}function e(a){if("function"!=typeof a)throw new TypeError("resolver must be a function");this.state=s,this.queue=[],this.outcome=void 0,a!==d&&i(this,a)}function f(a,b,c){this.promise=a,"function"==typeof b&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),"function"==typeof c&&(this.onRejected=c,this.callRejected=this.otherCallRejected)}function g(a,b,c){o(function(){var d;try{d=b(c)}catch(b){return p.reject(a,b)}d===a?p.reject(a,new TypeError("Cannot resolve promise with itself")):p.resolve(a,d)})}function h(a){var b=a&&a.then;if(a&&("object"==typeof a||"function"==typeof a)&&"function"==typeof b)return function(){b.apply(a,arguments)}}function i(a,b){function c(b){f||(f=!0,p.reject(a,b))}function d(b){f||(f=!0,p.resolve(a,b))}function e(){b(d,c)}var f=!1,g=j(e);"error"===g.status&&c(g.value)}function j(a,b){var c={};try{c.value=a(b),c.status="success"}catch(a){c.status="error",c.value=a}return c}function k(a){return a instanceof this?a:p.resolve(new this(d),a)}function l(a){var b=new this(d);return p.reject(b,a)}function m(a){function b(a,b){function d(a){g[b]=a,++h!==e||f||(f=!0,p.resolve(j,g))}c.resolve(a).then(d,function(a){f||(f=!0,p.reject(j,a))})}var c=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=new Array(e),h=0,i=-1,j=new this(d);++i<e;)b(a[i],i);return j}function n(a){function b(a){c.resolve(a).then(function(a){f||(f=!0,p.resolve(h,a))},function(a){f||(f=!0,p.reject(h,a))})}var c=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=-1,h=new this(d);++g<e;)b(a[g]);return h}var o=a(1),p={},q=["REJECTED"],r=["FULFILLED"],s=["PENDING"];b.exports=e,e.prototype.catch=function(a){return this.then(null,a)},e.prototype.then=function(a,b){if("function"!=typeof a&&this.state===r||"function"!=typeof b&&this.state===q)return this;var c=new this.constructor(d);if(this.state!==s){g(c,this.state===r?a:b,this.outcome)}else this.queue.push(new f(c,a,b));return c},f.prototype.callFulfilled=function(a){p.resolve(this.promise,a)},f.prototype.otherCallFulfilled=function(a){g(this.promise,this.onFulfilled,a)},f.prototype.callRejected=function(a){p.reject(this.promise,a)},f.prototype.otherCallRejected=function(a){g(this.promise,this.onRejected,a)},p.resolve=function(a,b){var c=j(h,b);if("error"===c.status)return p.reject(a,c.value);var d=c.value;if(d)i(a,d);else{a.state=r,a.outcome=b;for(var e=-1,f=a.queue.length;++e<f;)a.queue[e].callFulfilled(b)}return a},p.reject=function(a,b){a.state=q,a.outcome=b;for(var c=-1,d=a.queue.length;++c<d;)a.queue[c].callRejected(b);return a},e.resolve=k,e.reject=l,e.all=m,e.race=n},{1:1}],3:[function(a,b,c){(function(b){"use strict";"function"!=typeof b.Promise&&(b.Promise=a(2))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(a){return}}function f(){try{if(!ua||!ua.open)return!1;var a="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),b="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!a||b)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(a){return!1}}function g(a,b){a=a||[],b=b||{};try{return new Blob(a,b)}catch(f){if("TypeError"!==f.name)throw f;for(var c="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,d=new c,e=0;e<a.length;e+=1)d.append(a[e]);return d.getBlob(b.type)}}function h(a,b){b&&a.then(function(a){b(null,a)},function(a){b(a)})}function i(a,b,c){"function"==typeof b&&a.then(b),"function"==typeof c&&a.catch(c)}function j(a){return"string"!=typeof a&&(console.warn(a+" used as a key, but it is not a string."),a=String(a)),a}function k(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function l(a){for(var b=a.length,c=new ArrayBuffer(b),d=new Uint8Array(c),e=0;e<b;e++)d[e]=a.charCodeAt(e);return c}function m(a){return new va(function(b){var c=a.transaction(wa,Ba),d=g([""]);c.objectStore(wa).put(d,"key"),c.onabort=function(a){a.preventDefault(),a.stopPropagation(),b(!1)},c.oncomplete=function(){var a=navigator.userAgent.match(/Chrome\/(\d+)/),c=navigator.userAgent.match(/Edge\//);b(c||!a||parseInt(a[1],10)>=43)}}).catch(function(){return!1})}function n(a){return"boolean"==typeof xa?va.resolve(xa):m(a).then(function(a){return xa=a})}function o(a){var b=ya[a.name],c={};c.promise=new va(function(a,b){c.resolve=a,c.reject=b}),b.deferredOperations.push(c),b.dbReady?b.dbReady=b.dbReady.then(function(){return c.promise}):b.dbReady=c.promise}function p(a){var b=ya[a.name],c=b.deferredOperations.pop();if(c)return c.resolve(),c.promise}function q(a,b){var c=ya[a.name],d=c.deferredOperations.pop();if(d)return d.reject(b),d.promise}function r(a,b){return new va(function(c,d){if(ya[a.name]=ya[a.name]||B(),a.db){if(!b)return c(a.db);o(a),a.db.close()}var e=[a.name];b&&e.push(a.version);var f=ua.open.apply(ua,e);b&&(f.onupgradeneeded=function(b){var c=f.result;try{c.createObjectStore(a.storeName),b.oldVersion<=1&&c.createObjectStore(wa)}catch(c){if("ConstraintError"!==c.name)throw c;console.warn('The database "'+a.name+'" has been upgraded from version '+b.oldVersion+" to version "+b.newVersion+', but the storage "'+a.storeName+'" already exists.')}}),f.onerror=function(a){a.preventDefault(),d(f.error)},f.onsuccess=function(){var b=f.result;b.onversionchange=function(a){a.target.close()},c(b),p(a)}})}function s(a){return r(a,!1)}function t(a){return r(a,!0)}function u(a,b){if(!a.db)return!0;var c=!a.db.objectStoreNames.contains(a.storeName),d=a.version<a.db.version,e=a.version>a.db.version;if(d&&(a.version!==b&&console.warn('The database "'+a.name+"\" can't be downgraded from version "+a.db.version+" to version "+a.version+"."),a.version=a.db.version),e||c){if(c){var f=a.db.version+1;f>a.version&&(a.version=f)}return!0}return!1}function v(a){return new va(function(b,c){var d=new FileReader;d.onerror=c,d.onloadend=function(c){var d=btoa(c.target.result||"");b({__local_forage_encoded_blob:!0,data:d,type:a.type})},d.readAsBinaryString(a)})}function w(a){return g([l(atob(a.data))],{type:a.type})}function x(a){return a&&a.__local_forage_encoded_blob}function y(a){var b=this,c=b._initReady().then(function(){var a=ya[b._dbInfo.name];if(a&&a.dbReady)return a.dbReady});return i(c,a,a),c}function z(a){o(a);for(var b=ya[a.name],c=b.forages,d=0;d<c.length;d++){var e=c[d];e._dbInfo.db&&(e._dbInfo.db.close(),e._dbInfo.db=null)}return a.db=null,s(a).then(function(b){return a.db=b,u(a)?t(a):b}).then(function(d){a.db=b.db=d;for(var e=0;e<c.length;e++)c[e]._dbInfo.db=d}).catch(function(b){throw q(a,b),b})}function A(a,b,c,d){void 0===d&&(d=1);try{var e=a.db.transaction(a.storeName,b);c(null,e)}catch(e){if(d>0&&(!a.db||"InvalidStateError"===e.name||"NotFoundError"===e.name))return va.resolve().then(function(){if(!a.db||"NotFoundError"===e.name&&!a.db.objectStoreNames.contains(a.storeName)&&a.version<=a.db.version)return a.db&&(a.version=a.db.version+1),t(a)}).then(function(){return z(a).then(function(){A(a,b,c,d-1)})}).catch(c);c(e)}}function B(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function C(a){function b(){return va.resolve()}var c=this,d={db:null};if(a)for(var e in a)d[e]=a[e];var f=ya[d.name];f||(f=B(),ya[d.name]=f),f.forages.push(c),c._initReady||(c._initReady=c.ready,c.ready=y);for(var g=[],h=0;h<f.forages.length;h++){var i=f.forages[h];i!==c&&g.push(i._initReady().catch(b))}var j=f.forages.slice(0);return va.all(g).then(function(){return d.db=f.db,s(d)}).then(function(a){return d.db=a,u(d,c._defaultConfig.version)?t(d):a}).then(function(a){d.db=f.db=a,c._dbInfo=d;for(var b=0;b<j.length;b++){var e=j[b];e!==c&&(e._dbInfo.db=d.db,e._dbInfo.version=d.version)}})}function D(a,b){var c=this;a=j(a);var d=new va(function(b,d){c.ready().then(function(){A(c._dbInfo,Aa,function(e,f){if(e)return d(e);try{var g=f.objectStore(c._dbInfo.storeName),h=g.get(a);h.onsuccess=function(){var a=h.result;void 0===a&&(a=null),x(a)&&(a=w(a)),b(a)},h.onerror=function(){d(h.error)}}catch(a){d(a)}})}).catch(d)});return h(d,b),d}function E(a,b){var c=this,d=new va(function(b,d){c.ready().then(function(){A(c._dbInfo,Aa,function(e,f){if(e)return d(e);try{var g=f.objectStore(c._dbInfo.storeName),h=g.openCursor(),i=1;h.onsuccess=function(){var c=h.result;if(c){var d=c.value;x(d)&&(d=w(d));var e=a(d,c.key,i++);void 0!==e?b(e):c.continue()}else b()},h.onerror=function(){d(h.error)}}catch(a){d(a)}})}).catch(d)});return h(d,b),d}function F(a,b,c){var d=this;a=j(a);var e=new va(function(c,e){var f;d.ready().then(function(){return f=d._dbInfo,"[object Blob]"===za.call(b)?n(f.db).then(function(a){return a?b:v(b)}):b}).then(function(b){A(d._dbInfo,Ba,function(f,g){if(f)return e(f);try{var h=g.objectStore(d._dbInfo.storeName);null===b&&(b=void 0);var i=h.put(b,a);g.oncomplete=function(){void 0===b&&(b=null),c(b)},g.onabort=g.onerror=function(){var a=i.error?i.error:i.transaction.error;e(a)}}catch(a){e(a)}})}).catch(e)});return h(e,c),e}function G(a,b){var c=this;a=j(a);var d=new va(function(b,d){c.ready().then(function(){A(c._dbInfo,Ba,function(e,f){if(e)return d(e);try{var g=f.objectStore(c._dbInfo.storeName),h=g.delete(a);f.oncomplete=function(){b()},f.onerror=function(){d(h.error)},f.onabort=function(){var a=h.error?h.error:h.transaction.error;d(a)}}catch(a){d(a)}})}).catch(d)});return h(d,b),d}function H(a){var b=this,c=new va(function(a,c){b.ready().then(function(){A(b._dbInfo,Ba,function(d,e){if(d)return c(d);try{var f=e.objectStore(b._dbInfo.storeName),g=f.clear();e.oncomplete=function(){a()},e.onabort=e.onerror=function(){var a=g.error?g.error:g.transaction.error;c(a)}}catch(a){c(a)}})}).catch(c)});return h(c,a),c}function I(a){var b=this,c=new va(function(a,c){b.ready().then(function(){A(b._dbInfo,Aa,function(d,e){if(d)return c(d);try{var f=e.objectStore(b._dbInfo.storeName),g=f.count();g.onsuccess=function(){a(g.result)},g.onerror=function(){c(g.error)}}catch(a){c(a)}})}).catch(c)});return h(c,a),c}function J(a,b){var c=this,d=new va(function(b,d){if(a<0)return void b(null);c.ready().then(function(){A(c._dbInfo,Aa,function(e,f){if(e)return d(e);try{var g=f.objectStore(c._dbInfo.storeName),h=!1,i=g.openKeyCursor();i.onsuccess=function(){var c=i.result;if(!c)return void b(null);0===a?b(c.key):h?b(c.key):(h=!0,c.advance(a))},i.onerror=function(){d(i.error)}}catch(a){d(a)}})}).catch(d)});return h(d,b),d}function K(a){var b=this,c=new va(function(a,c){b.ready().then(function(){A(b._dbInfo,Aa,function(d,e){if(d)return c(d);try{var f=e.objectStore(b._dbInfo.storeName),g=f.openKeyCursor(),h=[];g.onsuccess=function(){var b=g.result;if(!b)return void a(h);h.push(b.key),b.continue()},g.onerror=function(){c(g.error)}}catch(a){c(a)}})}).catch(c)});return h(c,a),c}function L(a,b){b=k.apply(this,arguments);var c=this.config();a="function"!=typeof a&&a||{},a.name||(a.name=a.name||c.name,a.storeName=a.storeName||c.storeName);var d,e=this;if(a.name){var f=a.name===c.name&&e._dbInfo.db,g=f?va.resolve(e._dbInfo.db):s(a).then(function(b){var c=ya[a.name],d=c.forages;c.db=b;for(var e=0;e<d.length;e++)d[e]._dbInfo.db=b;return b});d=a.storeName?g.then(function(b){if(b.objectStoreNames.contains(a.storeName)){var c=b.version+1;o(a);var d=ya[a.name],e=d.forages;b.close();for(var f=0;f<e.length;f++){var g=e[f];g._dbInfo.db=null,g._dbInfo.version=c}return new va(function(b,d){var e=ua.open(a.name,c);e.onerror=function(a){e.result.close(),d(a)},e.onupgradeneeded=function(){e.result.deleteObjectStore(a.storeName)},e.onsuccess=function(){var a=e.result;a.close(),b(a)}}).then(function(a){d.db=a;for(var b=0;b<e.length;b++){var c=e[b];c._dbInfo.db=a,p(c._dbInfo)}}).catch(function(b){throw(q(a,b)||va.resolve()).catch(function(){}),b})}}):g.then(function(b){o(a);var c=ya[a.name],d=c.forages;b.close();for(var e=0;e<d.length;e++){d[e]._dbInfo.db=null}return new va(function(b,c){var d=ua.deleteDatabase(a.name);d.onerror=function(){var a=d.result;a&&a.close(),c(d.error)},d.onblocked=function(){console.warn('dropInstance blocked for database "'+a.name+'" until all open connections are closed')},d.onsuccess=function(){var a=d.result;a&&a.close(),b(a)}}).then(function(a){c.db=a;for(var b=0;b<d.length;b++)p(d[b]._dbInfo)}).catch(function(b){throw(q(a,b)||va.resolve()).catch(function(){}),b})})}else d=va.reject("Invalid arguments");return h(d,b),d}function M(){return"function"==typeof openDatabase}function N(a){var b,c,d,e,f,g=.75*a.length,h=a.length,i=0;"="===a[a.length-1]&&(g--,"="===a[a.length-2]&&g--);var j=new ArrayBuffer(g),k=new Uint8Array(j);for(b=0;b<h;b+=4)c=Da.indexOf(a[b]),d=Da.indexOf(a[b+1]),e=Da.indexOf(a[b+2]),f=Da.indexOf(a[b+3]),k[i++]=c<<2|d>>4,k[i++]=(15&d)<<4|e>>2,k[i++]=(3&e)<<6|63&f;return j}function O(a){var b,c=new Uint8Array(a),d="";for(b=0;b<c.length;b+=3)d+=Da[c[b]>>2],d+=Da[(3&c[b])<<4|c[b+1]>>4],d+=Da[(15&c[b+1])<<2|c[b+2]>>6],d+=Da[63&c[b+2]];return c.length%3==2?d=d.substring(0,d.length-1)+"=":c.length%3==1&&(d=d.substring(0,d.length-2)+"=="),d}function P(a,b){var c="";if(a&&(c=Ua.call(a)),a&&("[object ArrayBuffer]"===c||a.buffer&&"[object ArrayBuffer]"===Ua.call(a.buffer))){var d,e=Ga;a instanceof ArrayBuffer?(d=a,e+=Ia):(d=a.buffer,"[object Int8Array]"===c?e+=Ka:"[object Uint8Array]"===c?e+=La:"[object Uint8ClampedArray]"===c?e+=Ma:"[object Int16Array]"===c?e+=Na:"[object Uint16Array]"===c?e+=Pa:"[object Int32Array]"===c?e+=Oa:"[object Uint32Array]"===c?e+=Qa:"[object Float32Array]"===c?e+=Ra:"[object Float64Array]"===c?e+=Sa:b(new Error("Failed to get type for BinaryArray"))),b(e+O(d))}else if("[object Blob]"===c){var f=new FileReader;f.onload=function(){var c=Ea+a.type+"~"+O(this.result);b(Ga+Ja+c)},f.readAsArrayBuffer(a)}else try{b(JSON.stringify(a))}catch(c){console.error("Couldn't convert value into a JSON string: ",a),b(null,c)}}function Q(a){if(a.substring(0,Ha)!==Ga)return JSON.parse(a);var b,c=a.substring(Ta),d=a.substring(Ha,Ta);if(d===Ja&&Fa.test(c)){var e=c.match(Fa);b=e[1],c=c.substring(e[0].length)}var f=N(c);switch(d){case Ia:return f;case Ja:return g([f],{type:b});case Ka:return new Int8Array(f);case La:return new Uint8Array(f);case Ma:return new Uint8ClampedArray(f);case Na:return new Int16Array(f);case Pa:return new Uint16Array(f);case Oa:return new Int32Array(f);case Qa:return new Uint32Array(f);case Ra:return new Float32Array(f);case Sa:return new Float64Array(f);default:throw new Error("Unkown type: "+d)}}function R(a,b,c,d){a.executeSql("CREATE TABLE IF NOT EXISTS "+b.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],c,d)}function S(a){var b=this,c={db:null};if(a)for(var d in a)c[d]="string"!=typeof a[d]?a[d].toString():a[d];var e=new va(function(a,d){try{c.db=openDatabase(c.name,String(c.version),c.description,c.size)}catch(a){return d(a)}c.db.transaction(function(e){R(e,c,function(){b._dbInfo=c,a()},function(a,b){d(b)})},d)});return c.serializer=Va,e}function T(a,b,c,d,e,f){a.executeSql(c,d,e,function(a,g){g.code===g.SYNTAX_ERR?a.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[b.storeName],function(a,h){h.rows.length?f(a,g):R(a,b,function(){a.executeSql(c,d,e,f)},f)},f):f(a,g)},f)}function U(a,b){var c=this;a=j(a);var d=new va(function(b,d){c.ready().then(function(){var e=c._dbInfo;e.db.transaction(function(c){T(c,e,"SELECT * FROM "+e.storeName+" WHERE key = ? LIMIT 1",[a],function(a,c){var d=c.rows.length?c.rows.item(0).value:null;d&&(d=e.serializer.deserialize(d)),b(d)},function(a,b){d(b)})})}).catch(d)});return h(d,b),d}function V(a,b){var c=this,d=new va(function(b,d){c.ready().then(function(){var e=c._dbInfo;e.db.transaction(function(c){T(c,e,"SELECT * FROM "+e.storeName,[],function(c,d){for(var f=d.rows,g=f.length,h=0;h<g;h++){var i=f.item(h),j=i.value;if(j&&(j=e.serializer.deserialize(j)),void 0!==(j=a(j,i.key,h+1)))return void b(j)}b()},function(a,b){d(b)})})}).catch(d)});return h(d,b),d}function W(a,b,c,d){var e=this;a=j(a);var f=new va(function(f,g){e.ready().then(function(){void 0===b&&(b=null);var h=b,i=e._dbInfo;i.serializer.serialize(b,function(b,j){j?g(j):i.db.transaction(function(c){T(c,i,"INSERT OR REPLACE INTO "+i.storeName+" (key, value) VALUES (?, ?)",[a,b],function(){f(h)},function(a,b){g(b)})},function(b){if(b.code===b.QUOTA_ERR){if(d>0)return void f(W.apply(e,[a,h,c,d-1]));g(b)}})})}).catch(g)});return h(f,c),f}function X(a,b,c){return W.apply(this,[a,b,c,1])}function Y(a,b){var c=this;a=j(a);var d=new va(function(b,d){c.ready().then(function(){var e=c._dbInfo;e.db.transaction(function(c){T(c,e,"DELETE FROM "+e.storeName+" WHERE key = ?",[a],function(){b()},function(a,b){d(b)})})}).catch(d)});return h(d,b),d}function Z(a){var b=this,c=new va(function(a,c){b.ready().then(function(){var d=b._dbInfo;d.db.transaction(function(b){T(b,d,"DELETE FROM "+d.storeName,[],function(){a()},function(a,b){c(b)})})}).catch(c)});return h(c,a),c}function $(a){var b=this,c=new va(function(a,c){b.ready().then(function(){var d=b._dbInfo;d.db.transaction(function(b){T(b,d,"SELECT COUNT(key) as c FROM "+d.storeName,[],function(b,c){var d=c.rows.item(0).c;a(d)},function(a,b){c(b)})})}).catch(c)});return h(c,a),c}function _(a,b){var c=this,d=new va(function(b,d){c.ready().then(function(){var e=c._dbInfo;e.db.transaction(function(c){T(c,e,"SELECT key FROM "+e.storeName+" WHERE id = ? LIMIT 1",[a+1],function(a,c){var d=c.rows.length?c.rows.item(0).key:null;b(d)},function(a,b){d(b)})})}).catch(d)});return h(d,b),d}function aa(a){var b=this,c=new va(function(a,c){b.ready().then(function(){var d=b._dbInfo;d.db.transaction(function(b){T(b,d,"SELECT key FROM "+d.storeName,[],function(b,c){for(var d=[],e=0;e<c.rows.length;e++)d.push(c.rows.item(e).key);a(d)},function(a,b){c(b)})})}).catch(c)});return h(c,a),c}function ba(a){return new va(function(b,c){a.transaction(function(d){d.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(c,d){for(var e=[],f=0;f<d.rows.length;f++)e.push(d.rows.item(f).name);b({db:a,storeNames:e})},function(a,b){c(b)})},function(a){c(a)})})}function ca(a,b){b=k.apply(this,arguments);var c=this.config();a="function"!=typeof a&&a||{},a.name||(a.name=a.name||c.name,a.storeName=a.storeName||c.storeName);var d,e=this;return d=a.name?new va(function(b){var d;d=a.name===c.name?e._dbInfo.db:openDatabase(a.name,"","",0),b(a.storeName?{db:d,storeNames:[a.storeName]}:ba(d))}).then(function(a){return new va(function(b,c){a.db.transaction(function(d){function e(a){return new va(function(b,c){d.executeSql("DROP TABLE IF EXISTS "+a,[],function(){b()},function(a,b){c(b)})})}for(var f=[],g=0,h=a.storeNames.length;g<h;g++)f.push(e(a.storeNames[g]));va.all(f).then(function(){b()}).catch(function(a){c(a)})},function(a){c(a)})})}):va.reject("Invalid arguments"),h(d,b),d}function da(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(a){return!1}}function ea(a,b){var c=a.name+"/";return a.storeName!==b.storeName&&(c+=a.storeName+"/"),c}function fa(){var a="_localforage_support_test";try{return localStorage.setItem(a,!0),localStorage.removeItem(a),!1}catch(a){return!0}}function ga(){return!fa()||localStorage.length>0}function ha(a){var b=this,c={};if(a)for(var d in a)c[d]=a[d];return c.keyPrefix=ea(a,b._defaultConfig),ga()?(b._dbInfo=c,c.serializer=Va,va.resolve()):va.reject()}function ia(a){var b=this,c=b.ready().then(function(){for(var a=b._dbInfo.keyPrefix,c=localStorage.length-1;c>=0;c--){var d=localStorage.key(c);0===d.indexOf(a)&&localStorage.removeItem(d)}});return h(c,a),c}function ja(a,b){var c=this;a=j(a);var d=c.ready().then(function(){var b=c._dbInfo,d=localStorage.getItem(b.keyPrefix+a);return d&&(d=b.serializer.deserialize(d)),d});return h(d,b),d}function ka(a,b){var c=this,d=c.ready().then(function(){for(var b=c._dbInfo,d=b.keyPrefix,e=d.length,f=localStorage.length,g=1,h=0;h<f;h++){var i=localStorage.key(h);if(0===i.indexOf(d)){var j=localStorage.getItem(i);if(j&&(j=b.serializer.deserialize(j)),void 0!==(j=a(j,i.substring(e),g++)))return j}}});return h(d,b),d}function la(a,b){var c=this,d=c.ready().then(function(){var b,d=c._dbInfo;try{b=localStorage.key(a)}catch(a){b=null}return b&&(b=b.substring(d.keyPrefix.length)),b});return h(d,b),d}function ma(a){var b=this,c=b.ready().then(function(){for(var a=b._dbInfo,c=localStorage.length,d=[],e=0;e<c;e++){var f=localStorage.key(e);0===f.indexOf(a.keyPrefix)&&d.push(f.substring(a.keyPrefix.length))}return d});return h(c,a),c}function na(a){var b=this,c=b.keys().then(function(a){return a.length});return h(c,a),c}function oa(a,b){var c=this;a=j(a);var d=c.ready().then(function(){var b=c._dbInfo;localStorage.removeItem(b.keyPrefix+a)});return h(d,b),d}function pa(a,b,c){var d=this;a=j(a);var e=d.ready().then(function(){void 0===b&&(b=null);var c=b;return new va(function(e,f){var g=d._dbInfo;g.serializer.serialize(b,function(b,d){if(d)f(d);else try{localStorage.setItem(g.keyPrefix+a,b),e(c)}catch(a){"QuotaExceededError"!==a.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==a.name||f(a),f(a)}})})});return h(e,c),e}function qa(a,b){if(b=k.apply(this,arguments),a="function"!=typeof a&&a||{},!a.name){var c=this.config();a.name=a.name||c.name,a.storeName=a.storeName||c.storeName}var d,e=this;return d=a.name?new va(function(b){b(a.storeName?ea(a,e._defaultConfig):a.name+"/")}).then(function(a){for(var b=localStorage.length-1;b>=0;b--){var c=localStorage.key(b);0===c.indexOf(a)&&localStorage.removeItem(c)}}):va.reject("Invalid arguments"),h(d,b),d}function ra(a,b){a[b]=function(){var c=arguments;return a.ready().then(function(){return a[b].apply(a,c)})}}function sa(){for(var a=1;a<arguments.length;a++){var b=arguments[a];if(b)for(var c in b)b.hasOwnProperty(c)&&($a(b[c])?arguments[0][c]=b[c].slice():arguments[0][c]=b[c])}return arguments[0]}var ta="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},ua=e();"undefined"==typeof Promise&&a(3);var va=Promise,wa="local-forage-detect-blob-support",xa=void 0,ya={},za=Object.prototype.toString,Aa="readonly",Ba="readwrite",Ca={_driver:"asyncStorage",_initStorage:C,_support:f(),iterate:E,getItem:D,setItem:F,removeItem:G,clear:H,length:I,key:J,keys:K,dropInstance:L},Da="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ea="~~local_forage_type~",Fa=/^~~local_forage_type~([^~]+)~/,Ga="__lfsc__:",Ha=Ga.length,Ia="arbf",Ja="blob",Ka="si08",La="ui08",Ma="uic8",Na="si16",Oa="si32",Pa="ur16",Qa="ui32",Ra="fl32",Sa="fl64",Ta=Ha+Ia.length,Ua=Object.prototype.toString,Va={serialize:P,deserialize:Q,stringToBuffer:N,bufferToString:O},Wa={_driver:"webSQLStorage",_initStorage:S,_support:M(),iterate:V,getItem:U,setItem:X,removeItem:Y,clear:Z,length:$,key:_,keys:aa,dropInstance:ca},Xa={_driver:"localStorageWrapper",_initStorage:ha,_support:da(),iterate:ka,getItem:ja,setItem:pa,removeItem:oa,clear:ia,length:na,key:la,keys:ma,dropInstance:qa},Ya=function(a,b){return a===b||"number"==typeof a&&"number"==typeof b&&isNaN(a)&&isNaN(b)},Za=function(a,b){for(var c=a.length,d=0;d<c;){if(Ya(a[d],b))return!0;d++}return!1},$a=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},_a={},ab={},bb={INDEXEDDB:Ca,WEBSQL:Wa,LOCALSTORAGE:Xa},cb=[bb.INDEXEDDB._driver,bb.WEBSQL._driver,bb.LOCALSTORAGE._driver],db=["dropInstance"],eb=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(db),fb={description:"",driver:cb.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},gb=function(){function a(b){d(this,a);for(var c in bb)if(bb.hasOwnProperty(c)){var e=bb[c],f=e._driver;this[c]=f,_a[f]||this.defineDriver(e)}this._defaultConfig=sa({},fb),this._config=sa({},this._defaultConfig,b),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return a.prototype.config=function(a){if("object"===(void 0===a?"undefined":ta(a))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var b in a){if("storeName"===b&&(a[b]=a[b].replace(/\W/g,"_")),"version"===b&&"number"!=typeof a[b])return new Error("Database version must be a number.");this._config[b]=a[b]}return!("driver"in a&&a.driver)||this.setDriver(this._config.driver)}return"string"==typeof a?this._config[a]:this._config},a.prototype.defineDriver=function(a,b,c){var d=new va(function(b,c){try{var d=a._driver,e=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!a._driver)return void c(e);for(var f=eb.concat("_initStorage"),g=0,i=f.length;g<i;g++){var j=f[g];if((!Za(db,j)||a[j])&&"function"!=typeof a[j])return void c(e)}(function(){for(var b=function(a){return function(){var b=new Error("Method "+a+" is not implemented by the current driver"),c=va.reject(b);return h(c,arguments[arguments.length-1]),c}},c=0,d=db.length;c<d;c++){var e=db[c];a[e]||(a[e]=b(e))}})();var k=function(c){_a[d]&&console.info("Redefining LocalForage driver: "+d),_a[d]=a,ab[d]=c,b()};"_support"in a?a._support&&"function"==typeof a._support?a._support().then(k,c):k(!!a._support):k(!0)}catch(a){c(a)}});return i(d,b,c),d},a.prototype.driver=function(){return this._driver||null},a.prototype.getDriver=function(a,b,c){var d=_a[a]?va.resolve(_a[a]):va.reject(new Error("Driver not found."));return i(d,b,c),d},a.prototype.getSerializer=function(a){var b=va.resolve(Va);return i(b,a),b},a.prototype.ready=function(a){var b=this,c=b._driverSet.then(function(){return null===b._ready&&(b._ready=b._initDriver()),b._ready});return i(c,a,a),c},a.prototype.setDriver=function(a,b,c){function d(){g._config.driver=g.driver()}function e(a){return g._extend(a),d(),g._ready=g._initStorage(g._config),g._ready}function f(a){return function(){function b(){for(;c<a.length;){var f=a[c];return c++,g._dbInfo=null,g._ready=null,g.getDriver(f).then(e).catch(b)}d();var h=new Error("No available storage method found.");return g._driverSet=va.reject(h),g._driverSet}var c=0;return b()}}var g=this;$a(a)||(a=[a]);var h=this._getSupportedDrivers(a),j=null!==this._driverSet?this._driverSet.catch(function(){return va.resolve()}):va.resolve();return this._driverSet=j.then(function(){var a=h[0];return g._dbInfo=null,g._ready=null,g.getDriver(a).then(function(a){g._driver=a._driver,d(),g._wrapLibraryMethodsWithReady(),g._initDriver=f(h)})}).catch(function(){d();var a=new Error("No available storage method found.");return g._driverSet=va.reject(a),g._driverSet}),i(this._driverSet,b,c),this._driverSet},a.prototype.supports=function(a){return!!ab[a]},a.prototype._extend=function(a){sa(this,a)},a.prototype._getSupportedDrivers=function(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c];this.supports(e)&&b.push(e)}return b},a.prototype._wrapLibraryMethodsWithReady=function(){for(var a=0,b=eb.length;a<b;a++)ra(this,eb[a])},a.prototype.createInstance=function(b){return new a(b)},a}(),hb=new gb;b.exports=hb},{3:3}]},{},[4])(4)});// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                         M E D I A                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

var media        = {};
media["devices"] = {};




async function Media_Init()
{
 // AWAKE USER MEDIA AND REQUEST PERMISSIONS
 await navigator.mediaDevices.getUserMedia({audio:true, video:true});
 
 await Media_Devices_List(); 
   
 navigator.mediaDevices.ondevicechange = Media_Devices_OnChange;
}







function Media_Info_Type(filename)
{
 var ext = Path_Extension(filename).toLowerCase();
 
 if(["jpg", "jpeg", "gif", "png", "svg"].includes(ext))
 {
  return "image";
 }	  
     
	 
 if(["mov", "avi", "mpg", "mpeg", "mp4"].includes(ext))
 {
  return "video";
 }
  
  
 if(["mp3", "wav", "ogg"].includes(ext))
 {
  return "audio";
 }
 
 
 
 if(["pdf"].includes(ext))
 {
  return "pdf";
 }
 
 
 
 return "unknown";
}








// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                        D E V I C E S                                           //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Media_Devices_List()
{
 // ENUMERATE AVAILABLE DEVICES
 var devices = await navigator.mediaDevices.enumerateDevices();
  
 // ASSEMBLE DEVICES LIST
 var list = {};
 for(var device of devices) 
 {  console.log(device);
  // NEW DEVICE TYPE?
  if(!list[device.kind]) list[device.kind] = {};
   
  list[device.kind][device.deviceId] = device;
 }
  
 media["devices"] = list;
}





function Media_Devices_Select(type, id)
{ 	
 // DOES CHOSEN DEVICE EXIST?
 var device = Safe_Get(media, ["devices", type, id], false);

 // IF IT DOESN'T EXIST, TRY DEFAULT DEVICE (FIRST ONE IN LIST) FOR THAT DEVICE TYPE
 if(!device)
 {
  var devices = Object.keys(Safe_Get(media, ["devices", type], {}));
  if(devices.length == 0) return false;
  
  var id = devices[0];
  var device = Safe_Get(media, ["devices", type, id], false);
 }
  
 return device;
}




function Media_Devices_OnChange(event)
{
 Media_Devices_List();
}








// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          A U D I O                                             //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



function Media_Audio_Duration(src, callback)
{
 var promise = new Promise((resolve, reject) =>
 { 
  var sample = new Audio();	
 	
  sample.oncanplaythrough = 
  function()
  {
   delete sample;
   resolve(sample.duration);
  }
 
  sample.onerror =
  function()
  {
   delete sample;	  
   resolve(-1);
  }
 
  sample.src = src;
  sample.load();
 });
 
 return promise;
}




async function Media_Audio_Record(time, onstart)
{
 var format = "audio/wav";
 
 var promise = new Promise(async(resolve, reject) =>
 {
  try
  {
   var stream   = await navigator.mediaDevices.getUserMedia({audio:true});
  }
  catch(e)
  {
   resolve(false);
   return;
  }
  
  var recorder = new MediaRecorder(stream);			
  var chunks   = [];
				
  // COLLECT AUDIO CHUNKS			
  recorder.addEventListener("dataavailable", 
  function(e)
  {
   chunks.push(e.data);
  });
 
  // WHEN DONE, PUT CHUNKS TOGETHER
  recorder.addEventListener("stop",
  function()
  {
   var output = new Blob(chunks, {"type" : format});
  
   resolve(output);
  });
  
  // START RECORDER
  recorder.start();
  if(onstart) onstart(recorder);
  
  // IF TIMED, AUTOSTOP
  if(time)
  {
   setTimeout(function()
   {
    recorder.stop(); 
   }, time);								   			
  }
  
 });
 
 return promise;
}





function Media_Audio_Play(source, options = {volume:1, loop:false})
{ 
 var audio;
 
 var promise = new Promise((resolve, reject) =>
 {   
  // ASSUME BLOB
  if(typeof source == "object") 
  {
   source = URL.createObjectURL(source);
  }
  
  var player = new Audio();
  audio      = player;
 	
  // AS SOON AS PLAYABLE, PLAY
  player.oncanplaythrough = 
  function()
  {
   player.volume = options["volume"] || 1;
   player.play();
   
   //console.log(player, player.src, player.volume);
  } 
 
  // ON ERROR, CONSIDER IT PLAYED
  player.onerror =
  function(error)
  { 
   resolve();
  }
 
  player.onended =
  function()
  {
   resolve();
   
   if(options["loop"]) 
   {
    if(typeof options["loop"] == "function") options["loop"](player);
	player.play(); 
   }
   else 
   {
	// END
   }
  }	 
  
  // IF THIS AUDIO'S EXISTENCE IS BASED ON THE EXISTENCE OF A SPECIFIC CONTAINER, SET UP AN EVENT TO MANAGE THIS
  if(options["container"])
  {
   player.addEventListener("timeupdate",
   function(event)
   {
	if(!options["container"].isConnected) 
	{
     player.pause(); 
	 player.remove();
	}
   }, true);
  }
  
  
 
  // ASSIGN SOURCE AND LOAD
  player.src = source;
  player.load();
 });


 promise["audio"] = audio;
 return promise;
}








// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      S P E E C H                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


// TRIGGER VOICES LISTING
speechSynthesis.onvoiceschanged =
function(event)
{
}




async function Media_Speech_GetVoices()
{
 var promise = new Promise((resolve, reject) =>
 {
  speechSynthesis.onvoiceschanged =
  function()
  {
   var available = speechSynthesis.getVoices();
  
   resolve(available);
  }
  
  var available = speechSynthesis.getVoices();
  if(available.length > 0) resolve(available);
 });
 
 return promise;
}



async function Media_Speech_GetVoice(name)
{
 var name      = name.toLowerCase();
 
 var available = await Media_Speech_GetVoices();
 for(var voice of available)
 {
  if(voice.name.toLowerCase() == name)
  {
   return voice;
  }
 }
}




async function Media_Speech_ListVoices(lang = "")
{
 var voices = [];
 var lang   = lang.toLowerCase();
 
 var available = await Media_Speech_GetVoices();
 for(var voice of available)
 {
  if(!lang || voice.lang.toLowerCase() == lang)
  {
   voices.push(voice);
  }
 }
 
 // PREFER LOCAL TO REMOTE
 voices.sort(
 function(a, b)
 {
  if(a.localService && !b.localService) return -1;
  else
  if(!a.localService && b.localService) return 1;
  else 
  return 0;
 });
 
 return voices;
}




async function Media_Speech_Speak(text, voice, options = {rate:1, pitch:1}, onword)
{
 var promise = new Promise(async(resolve, reject) =>
 {
  // INIT SPEECH
  var speech   = new SpeechSynthesisUtterance();
  speech.text  = text;
  speech.rate  = options["rate"]  || 1;
  speech.pitch = options["pitch"] || 1;


  // ARE WE USING A SPECIFIC VOICE?
  if(typeof voice == "string") 
  {
   // 5 CHARACTERS = LANGUAGE CODE
   if(voice.length == 5)
   {
    speech.lang = voice;
   }
   else
   // MORE THAN 4 CHARACTERS = SPECIFIC VOICE NAME
   {
    speech.voice = await Media_Speech_GetVoice(voice);
	
	// NOT AVAILABLE, RETURN IMMEDIATELY
	if(!speech.voice) resolve();
   }
  }
  else
  {
   speech.voice = voice
  }
  
  
  // ON SPEECH END, RETURN FROM ASYNC FUNCTION
  speech.onend = 
  function()
  {
   resolve();
  }


  // ON WORD SPOKEN
  if(onword)
  {
   speech.onboundary = 
   function(event)
   {
    var segment = text.substr(event.charIndex, event.charLength);
	var time    = event.elapsedTime;
	
    onword(segment, time);
   }
  }
  
  
  // SPEAK
  speechSynthesis.speak(speech)
 });

 return promise;
}







async function Media_Speech_RecognizeCustom(sentences, lang, sample, service, onstartrecord, onendrecord)
{ 
 // IF SAMPLE IS A NUMBER RATHER THAN A BLOB, THEN IT REPRESENTS THE LENGTH OF A SAMPLE TO BE RECORDED
 if(typeof sample == "number")
 {
  var sample = await Media_Audio_Record(sample, onstartrecord);
  if(onendrecord) onendrecord();
 }

 // READ SAMPLE AS FILE
 var data  = await Storage_File_Read(sample);
 
 // PACKAGE QUERY FOR THE RECOGNIZER 
 var query = 
 {
  "binaryData"   : data,
  "fileExtension": "wav",
  "culture"      : lang,
  "sentences"    : sentences
 }
			 
			 
 console.log("recognizing...", query); 
			 
 // CALL SERVICE AND RETURN RESULT
 var response = await Request_Post(service, query, "json");
 // WRITE LOG
 await Core_Api("Users_Write_Log",{
 event: service,
 data: {
      api_name : service,
      request : query,
      response : ((JSON.stringify(response)).length < 65.535) ? response : "too much characters"
 },
 user_id: User_Id()
 });
 
 console.log("response", response);
 
 var index = Safe_Get(response, "indexRecognized", -1);
 if(index == -1) var sentence = false; else var sentence = sentences[index];
 
 var result           = {};
 result["sample"]     = sample;
 result["sentence"]   = sentence;
 result["confidence"] = Safe_Get(response, "confidence", 0);
 
 return result;
} 





async function Media_Speech_Recognize(text, lang, time, controller, onstart)
{
 var promise = new Promise((resolve, reject) =>
 {	
  var recognition = new webkitSpeechRecognition();
  controller = recognition;

  recognition.continuous     = false;
  recognition.interimResults = false;

  recognition.onstart = 
  function()
  {
   if(onstart) onstart();	   
   
   if(time) setTimeout(function(){recognition.stop()}, time);	  
  }
  
  recognition.onerror =
  function(error)
  { 
   resolve(error);	
  }
  
  recognition.onresult = 
  function(event)
  {
   var result = event.results;	  
    
   // *TODO* PROCESS THE RESULT AND MAKE IT MATCH THE STRUCTURE OF OUR CUSTOM RECOGNIZER 
	   
   resolve(result);	
  }
  
  recognition.start();
 });

 return promise;
}






// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                            D S P                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Audio_DSP_CreateMeter(context, stream)
{
 var meter = {};
 
 var source   = context.createMediaStreamSource(stream);
 var analyser = context.createAnalyser();
 var node     = context.createScriptProcessor(2048, 1, 1);
 
 meter["source"]   = source;
 meter["analyser"] = analyser;
 meter["node"]     = node;
 
 analyser.smoothingTimeConstant = 0.8;
 analyser.fftSize               = 1024;

 source.connect(analyser);
 meter.analyser.connect(node);
 node.connect(context.destination);
 
 node.onaudioprocess = function() 
 {
  var array = new Uint8Array(analyser.frequencyBinCount);
  analyser.getByteFrequencyData(array);
  var values = 0;

  var length = array.length;
  for(var i = 0; i < length; i++) 
  {
   values += (array[i]);
  }

  meter.average = (values / length) / 100;
 }

 return meter;
}

// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                        U T I L S                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

var utils = {};








// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                     O B J E C T S                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Object_Copy(obj)
{
 var copy = structuredClone(obj);
 return copy;
}



function Object_From_String(string, separator = ";", assigner = ":")
{
 if(typeof(string) != "string") return {};
 
 var obj = {};
    
 var tokens = string.split(separator);
 for(token of tokens)
 {
  token     = token.trim();
  var parts = token.split(assigner);
  
  if(parts.length > 0)
  {
   var field  = parts[0].trim();
  
   if(parts.length > 1) var value = parts[1].trim(); else value = undefined;
  
   obj[field] = value;
  }
 }
 
 return obj;
}




function Object_From_Paths(array, separator = "/")
{
 var obj = {};
 
 for(var string of array)
 {
  var item = string.split(separator);
  
  Safe_Set(obj, item, {});
 }
 
 return obj;
}





function Object_From_Objects(array, field)
{
 var obj = {};
 
 for(var item of array)
 {
  var id  = item[field];
  obj[id] = item;
 }
 
 return obj;
}






function Object_To_String(obj, separator = ";", assigner = ":")
{
 var tokens = [];
 
 for(var key in obj)
 {
  var token = key + assigner + " " + obj[key];
  
  tokens.push(token);
 }
 
 var string = tokens.join(separator);
 
 return string;
}






function Object_To_Pairs(source, field)
{
 var dest = {};
 
 for(var id in source)
 {
  dest[id] = source[id][field];
 }
 
 return dest;
}







function Object_To_Array(obj, mapkey)
{
 var array = [];
 var keys  = Object.keys(obj);
 
 for(var key of keys) 
 {
  var item = obj[key];
  array.push(item);
  
  if(mapkey) item[mapkey] = key;
 }
 
 return array;
}








function Object_Fields_MaxId(obj, tag)
{
 var subset = Object_Subset(obj, tag);
 var fields = Object.keys(subset);

 var max = 0;
 for(var field of fields) 
 {
  var id = parseInt(field.replace(tag, "").trim());
  
  if(id > max) max = id;
 }
 
 return id;
}





function Object_Fields_BrandSelf(obj, brand)
{
 var keys = Object.keys(obj);
 
 for(var key of keys) 
 {
  if(typeof obj[key] == "object" || typeof obj[key] == "array")
  {
   obj[key][brand] = key
  }
 }
}





function Object_Fields_Brand(obj, field, value)
{
 var keys = Object.keys(obj);
 
 for(var key of keys) 
 {
  if(typeof obj[key] == "object" || typeof obj[key] == "array")
  {
   obj[key][field] = value;
  }
 }
}





function Object_Values_Average(obj)
{
 var values = Object.values(obj);
 if(values.length == 0) return undefined;
 
 var sum = values.reduce((a, b) => parseInt(a) + parseInt(b), 0);
 var avg = (sum / values.length) || 0;
 
 return avg;
}




function Object_Catalog_ByNumericValue(obj, field, map = {})
{
 var catalog = {};
 
 for(var id in obj)
 {
  var item  = obj[id];
  var value = item[field];
  
  for(var key in map)
  {
   var upto = map[key];
  
   if((value <= upto) || (upto === undefined)) 
   {
	Safe_Push(catalog, key, item);
	break;
   }
   
  }
 }
 
 return catalog;
}






function Object_Map(obj, map, parent = false)
{ 
 if(!map) var map = [];
 
 var keys = Object.keys(obj);
 
 for(var key of keys)
 {
  var item         = {};
  item["key"]      = key;
  item["source"]   = obj[key];
  item["count"]    = 1;
  item["parent"]   = parent;
  item["children"] = [];
  
  if(parent) parent["children"].push(item);
  
  
  Object_Map(obj[key], map, item);
  
  var depth   = 0;
  var pointer = item["parent"];
  
  while(pointer)
  {
   pointer["count"]++;
   pointer = pointer["parent"];
   
   depth ++;
  }
  
  if(!map[depth]) map[depth] = [];
  
  map[depth].push(item);
 }
  
 return map;
}



function Object_Subset(obj, tag, mode = "starts-with")
{
 var sub  = {};
 var keys = Object.keys(obj);
 
 switch(mode)
 {
  case "starts-with":
	for(var key of keys) 
	{
     if(key.toLowerCase().startsWith(tag.toLowerCase()))
	 {
	  sub[key] = obj[key];
	 }
	}
  break;
  
  case "starts-without":
	for(var key of keys) 
	{
     if(!key.toLowerCase().startsWith(tag.toLowerCase()))
	 {
	  sub[key] = obj[key];
	 }
	}
  break;
  
  case "collect":
  {
	for(var key of keys)
	{
     if(tag.includes(key))
	 {
	  sub[key] = obj[key];
	 }
	}
  }
 }
 
 return sub;
}





function Object_Purge(obj, tag)
{
 var fields = Object.keys(Object_Subset(obj, tag));
 
 for(var field of fields) delete obj[field];
}





function Object_Is_Array(obj)
{
 return (typeof obj == "object") && Array.isArray(obj);
}




function Object_Valid(obj)
{
 return (typeof obj == "object") && (Object.keys(obj).length > 0);
}








// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      A R R A Y S                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Array_In(item, array)
{
 return array.includes(item);
}




function Array_PushUnique(array, item)
{
 if(!array.includes(item)) 
 {
  array.push(item);
  return true;
 }
 
 return false;
}




function Array_To_Object(array)
{
 var obj  = {};
 var keys = Object.keys(array);
 
 for(var key of keys)
 {
  obj[key] = array[key];
 }
 
 return obj;
}



function Array_From_String(string, separator = ",")
{
 var arr = [];
  
 var tokens = string.split(separator);
 for(token of tokens)
 {
  var value = token.trim();
  arr.push(value);
 }
 
 return arr;
}



function Array_From_Fields(array, field)
{
 var list = [];
 
 for(var item of array) list.push(item[field]);
	 
 return list;
}





function Array_Element_DeleteAt(array, index)
{
 array.splice(index, 1);
 return index;
}




function Array_Element_Delete(array, element)
{
 var index = array.indexOf(element);
 if(index == -1) return;
 
 array.splice(index, 1);
 return index;
}



function Array_Element_Insert(array, index, element)
{
 array.splice(index, 0, element);
}




function Array_Element_DeleteAll(array, element)
{
 var indices = [];
 
 while(array.includes(element)) 
 {
  var index = Array_Element_Delete(array, element);
  indices.push(index);
 }
 
 return indices;
}





function Array_Elements_Random(array)
{
 return array[Numbers_Random(0, array.length - 1)];
}




function Array_Items_Sort(array, field)
{
 array.sort(
 function(a, b)
 {
  if(a[field] > b[field]) return 1;
  else
  if(a[field] < b[field]) return -1;
  else
  return 0;
 });
}




function Array_Organize_ByField(array, field)
{
 var catalog = {};
 
 for(var item of array)
 {
  var key = item[field];
  
  catalog[key] = item;
 }
 
 return catalog;
}



function Array_Catalog_ByField(array, field)
{
 var catalog = {};
 
 for(var item of array)
 {
  var key = item[field];
  
  if(!catalog[key]) catalog[key] = [];
  catalog[key].push(item);
 }
 
 return catalog;
}




function Array_Catalog_Counts(array)
{
 var catalog = {};
 
 for(var item of array)
 {
  if(typeof catalog[item] == "undefined") 
  {
   catalog[item] = 1;
  }
  else
  {
   catalog[item]++;
  }
 }
 
 return catalog;
}




function Array_Integrate_AddFromObject(array, object, id_field)
{
 for(var item of array)
 {
  var id   = item[id_field];
  var data = object[id];
  
  if(typeof data != "undefined")
  {
   item.assign(data);
  }
 }
}





function Array_Empty(array)
{
 return Object_Is_Array(array) && (array.length == 0);
}




function Array_Valid(array)
{
 return Object_Is_Array(array) && (array.length > 0);
}







// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      S T R I N G S                                             //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function String_Unicode_Length(string)
{
 var segmenter = new Intl.Segmenter(); 
 var segments  = segmenter.segment(string);
 
 return [...segments].length;
}





function String_Filter_AllowDigits(string, allowspaces)
{
 if(allowspaces) 
 {
  return string.replace(/[^0-9 ]/gi,'');
 }
 else 
 {	 
  return string.replace(/[^0-9]/gi,'');
 }
}






function String_Filter_AllowAlphanum(string, allowspaces)
{
 if(allowspaces) 
 {
  return string.replace(/[^a-z0-9 ]/gi,'');
 }
 else 
 {	 
  return string.replace(/[^a-z0-9]/gi,'');
 }
}




function String_Filter_AllowAlpha(string, allowspaces)
{
 if(allowspaces)
 {
  return string.replace(/[^a-zA-Z ]/g,"");
 }
 else
 {
  return string.replace(/[^a-zA-Z]/g,"");
 }
}




function String_Split(string, separators)
{
 // ESCAPE SEPARATORS
 var escaped = [];
 for(var separator of separators) escaped.push("\\" + separator); 
  
 // BUILD REGEX
 var regex = new RegExp("(?:" + escaped.join("|") + ")+"); 
 
 // SPLIT
 return string.split(regex)
}




function String_Capitalize_Initial(string) 
{
 return string.charAt(0).toUpperCase() + string.slice(1);
}





function String_Capitalize_Camel(string, separator = "-", joiner = "")
{
 var parts = string.split(separator);
 
 for(var i in parts) parts[i] = String_Capitalize_Initial(parts[i]);
 
 return parts.join(joiner);
}



function String_Lowercase_Initial(string) 
{
 return string.charAt(0).toLowerCase() + string.slice(1);
}







function String_Variables_Set(string, variables = {}, delimiter = "$")
{	
 var varnames = Object.keys(variables);
 
 for(var i in varnames)
 {
  var name  = varnames[i];
  var value = variables[name];
  
  string = string.replaceAll(delimiter + name + delimiter, value);
 }
 
 return string;
}






function String_Extract_TagContent(string, delimiter_a = "{", delimiter_b = "}")
{
 var regex   = new RegExp(delimiter_a + "(.*?)" + delimiter_b, "g");
 var matches = string.matchAll(regex);
 var content = Array.from(matches, x => x[1]);
 
 return content;
}




function String_Extract_TagBlocks(string, delimiter_a = "{", delimiter_b = "}")
{
 var blocks = [];

 var tags = String_Extract_TagContent(string, delimiter_a, delimiter_b);

 var c = 0;
 for(var tag of tags)
 {  
  // FIND TAG AND EMPTY IT
  var search = delimiter_a + tag + delimiter_b;
  var i      = string.indexOf(search); 
  string     = string.replace(search, " ".repeat(search.length));
  
  // PRE-TAG CONTENT
  var text = string.substring(c, i);
  if(text.length > 0)
  {
   var block        = {};
   block["type"]    = "text";
   block["content"] = text;
   blocks.push(block);
  }

  // TAG CONTENT
  var block        = {};
  block["type"]    = "tag";
  block["content"] = tag;
  blocks.push(block);
  
  // MOVE ON
  c = i + search.length;
 }

 // REMAINDER
 var text = string.substring(c, string.length);
 if(text.length > 0)
 { 
  var block        = {};
  block["type"]    = "text";
  block["content"] = text;
  blocks.push(block);
 }

 return blocks;
}




function String_HTML_SegmentTag(html, delimiter_a = "<", delimiter_b = ">")
{
 var parts = {};
 
 var a = html.search(delimiter_a);
 if(a == -1) return parts;
 
 var b = html.substr(a).search(" ");
 if(b == -1) return parts;
 
 parts["head"] = html.substr(0, a + b);  
 html = html.replace(parts["head"], "");
 
 var a = html.search(delimiter_b);
 if(a == -1) return parts;
 parts["tail"] = html.substr(a);
 
 html = html.replace(parts["tail"], "");
 
 parts["content"] = html;
 
 return parts;
}




function String_Parse_Ini(data)
{
 var regex = 
 {
  section: /^\s*\[\s*([^\]]*)\s*\]\s*$/,
  param:   /^\s*([^=]+?)\s*=\s*(.*?)\s*$/,
  comment: /^\s*;.*$/
 };
     
 var value   = {};
 var lines   = data.split(/[\r\n]+/);
 var section = null;
 
 lines.forEach(
 function(line)
 {
  if(regex.comment.test(line))
  {
   return;
  }
  else 
  if(regex.param.test(line))
  {
   var match = line.match(regex.param);
   if(section)
   {
    value[section][match[1]] = match[2].replaceAll('"', '');
   }
   else
   {
    value[match[1]] = match[2].replaceAll('"', '');;
   }
  }
  else 
  if(regex.section.test(line))
  {
   var match       = line.match(regex.section);
   value[match[1]] = {};
   section         = match[1].replaceAll('"', '');;
  }
  else if(line.length == 0 && section)
  {
   section = null;
  };
 });
 
 return value;
}
	




function String_Simplify(string)
{
 if(!string) return "";
 
 return String(string).trim().toLowerCase();
}




function String_Is_Number(string)
{
 return !isNaN(string);
}





function String_Copycount_Get(string, delimiter_a = "(", delimiter_b = ")")
{
 var a = string.lastIndexOf(delimiter_a);
 var b = string.lastIndexOf(delimiter_b);
 
 if(b > a)
 {
  var count = string.substr(a + 1, b - a - 1);
  
  if(String_Is_Number(count)) return parseInt(count);
 }
}




function String_Copycount_Set(string, count, delimiter_a = "(", delimiter_b = ")")
{
 var current = String_Copycount_Get(string, delimiter_a, delimiter_b);
 if(current)
 { 
  var a    = string.lastIndexOf(delimiter_a);
  var b    = string.lastIndexOf(delimiter_b); 
  
  var head = string.substr(0, a);
  var tail = string.substr(b + 1, string.length - b);
  
  return head + delimiter_a + count + delimiter_b + tail;
 }
 else
 {
  return string + " " + delimiter_a + count + delimiter_b; 
 }
}



function String_Copycount_Next(string, delimiter_a = "(", delimiter_b = ")")
{
 var current = String_Copycount_Get(string, delimiter_a, delimiter_b);
 if(!current) current = 1; else current = current + 1;
 
 return String_Copycount_Set(string, current, delimiter_a, delimiter_b);
}





function String_Numtemplate_Info(string, digit_symbol = "N")
{
 var info   = string.split(" ");
 var digits = info[info.length - 1] || "";
 
 if(digits.includes(digit_symbol))
 {
  var header = info[0];
  digits     = digits.trim().length;
 }
 else
 {
  var header = string.trim();
  digits     = 0;
 }
 
 return {header:header, digits:digits};
}




function String_Numtemplate_Next(template, list)
{
 var max = 0;
 
 for(var item of list)
 {
  if(item.startsWith(template["header"]))
  {
   var parts = item.split(" ");
   var count = parseInt(parts[parts.length - 1]);
   
   if(count > max) max = count;
  }	  
 }
 
 max = max + 1;
 
 return template["header"] + " " + String(max).padStart(template["digits"], "0");
}




function String_Numtemplate_Comply(string, template)
{
 if(!string) return false;
 
 if(!string.startsWith(template["header"])) return false;

 var parts  = string.split(" ");
 var digits = String_Filter_AllowDigits(parts[parts.length -1]).trim();
 if(digits.length != template["digits"]) return false;
 
 return true;
}



function String_Numtemplate_Derive(string, digit_symbol = "N")
{
 if(!string) return "";
 
 var parts  = string.split(" ");
 var digits = String_Filter_AllowDigits(parts[parts.length -1]).trim();
 if(digits.length == 0) return "";
 
 return parts[0] + " " + digit_symbol.repeat(digits.length);
}






function String_Speak_Time(string, letter = 150, pause = 250)
{
 var time  = 0;
 var words = string.split(" ");
 
 for(var word of words)
 {
  var l     = word.trim().length;
  if(l<2) l = 2; 
   
  time = time + l * letter;
  time = time + pause;
 }
}





function String_Analysis_Categorize(sentence, terms = [])
{
 var analyzed = [sentence];
 
 var validate = 
 function(text, from, to)
 {  
  var invalid =  "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
 
  // VALIDATE LEFT BOUNDARY
  if(from != 0)
  {
   if(invalid.includes(text[from - 1])) return false;
  }
  
  // VALIDATE RIGHT BOUNDARY
  if(to != text.length - 1)
  {
   if(invalid.includes(text[to + 1])) return false;
  }
  
  return true;
 }
 
 do
 {
  var found = false;

  for(var i in analyzed) if(typeof analyzed[i] == "string")
  {
   var text  = analyzed[i] || "";
   
   // CHECK BLOCK AGAINST ALL TERMS
   for(var term of terms)
   {
	var index = text.toLowerCase().indexOf(term);
	
    if(index != -1 && validate(text, index, index + term.length - 1))
    {     
     var head = text.substring(0, index);
	 var core = text.substring(index, index + term.length); 
	 var tail = text.substring(index + term.length);
	 
	 Array_Element_DeleteAt(analyzed, i);
	 
	 if(tail.trim()) Array_Element_Insert(analyzed, i, tail);
	 Array_Element_Insert(analyzed, i, {type:"term", text:core});
	 if(head.trim()) Array_Element_Insert(analyzed, i, head);
	 
	 found = true;
	 break;
    }
   }
   
  }
  
 } while(found);
 
 
 // NOW CONVERT THE LEFTOVER STRINGS INTO OBJECTS
 do
 {  
  var found = false;
  
  for(var i in analyzed) if(typeof analyzed[i] == "string")
  {
   var text   = analyzed[i];
   Array_Element_DeleteAt(analyzed, i); 

   var tokens = String_Split(text, [" "]);
   tokens.reverse(); 
   for(var token of tokens)
   {
    var block = {type:"text", text:token}
	Array_Element_Insert(analyzed, i, block);
   }
   
   found = true;
   break;
  }
 
 } while(found);
 
 
 return analyzed;
}




function String_Analysis_StructuredMatch(target, guess, threshold = 1)
{
 if(typeof target == "string") var target = String_Analysis_Categorize(target);
 if(typeof guess  == "string") var guess  = String_Analysis_Categorize(guess);
 
 // RESET BLOCKS
 for(var block of guess)  block["used"]  = false;
 for(var block of target) block["match"] = false;
	 
 // SCAN
 for(var target_block of target)
 {
  var target_text = String_Filter_AllowAlphanum(target_block["text"]).trim().toLowerCase();

  for(var guess_block of guess)
  if(!guess_block["used"])
  {
   var guess_text = String_Filter_AllowAlphanum(guess_block["text"]).trim().toLowerCase();
  
   var similarity = 1 - String_Analysis_Distance(guess_text, target_text);
   
   // FOUND MATCH
   if(similarity >= threshold)
   {
	target_block["match"] = similarity;
	guess_block["used"]   = true;
	
	break;
   }
  }
  
 }

 return target; 
}





function String_Analysis_Distance(a, b, options = {})
{
 if(options["alphanum"])
 {
  a = String_Filter_AllowAlphanum(a, true);
  b = String_Filter_AllowAlphanum(b, true);
 }
	
	
 function _min(d0, d1, d2, bx, ay)
 {
  return d0 < d1 || d2 < d1 ? d0 > d2 ? d2 + 1 : d0 + 1 : bx === ay ? d1 : d1 + 1;
 }

 
 if(a === b) 
 {
  return 0;
 }

 if(a.length > b.length) 
 {
  var tmp = a;
  a = b;
  b = tmp;
 }

 var la  = a.length;
 var lb  = b.length;
 var max = Math.max(la, lb);  


 while(la > 0 && (a.charCodeAt(la - 1) === b.charCodeAt(lb - 1))) 
 {
  la--;
  lb--;
 }

 var offset = 0;

 while(offset < la && (a.charCodeAt(offset) === b.charCodeAt(offset))) 
 {
  offset++;
 }

 la -= offset;
 lb -= offset;

 if(la === 0 || lb < 3) 
 {
  return lb / max;
 }

 var x = 0, y, d0, d1, d2, d3, dd, dy, ay, bx0, bx1, bx2, bx3
 var vector = [];

 for(y = 0; y < la; y++) 
 {
  vector.push(y + 1);
  vector.push(a.charCodeAt(offset + y));
 }

 var len = vector.length - 1;

 for(; x < lb - 3;) 
 {
  bx0 = b.charCodeAt(offset + (d0 = x));
  bx1 = b.charCodeAt(offset + (d1 = x + 1));
  bx2 = b.charCodeAt(offset + (d2 = x + 2));
  bx3 = b.charCodeAt(offset + (d3 = x + 3));
  dd = (x += 4);
   
  for(y = 0; y < len; y += 2) 
  {
   dy = vector[y];
   ay = vector[y + 1];
   d0 = _min(dy, d0, d1, bx0, ay);
   d1 = _min(d0, d1, d2, bx1, ay);
   d2 = _min(d1, d2, d3, bx2, ay);
   dd = _min(d2, d3, dd, bx3, ay);
   vector[y] = dd;
   d3 = d2;
   d2 = d1;
   d1 = d0;
   d0 = dy;
  }
 }

 for(; x < lb;) 
 {
  bx0 = b.charCodeAt(offset + (d0 = x));
  dd  = ++x;
  for(y = 0; y < len; y += 2) 
  {
   dy = vector[y];
   vector[y] = dd = _min(dy, d0, dd, bx0, vector[y + 1]);
   d0 = dy;
  }
 }


 return dd / max;
}







// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                         B L O B S                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Blob_ToBase64(blob)
{
 var promise = new Promise((resolve, reject) =>
 {
  var reader = new FileReader();
  
  reader.onloadend = 
  function() 
  {		  
   var data = reader.result.split("base64,")[1];						  
   
   resolve(data);
  }			  
 
  reader.readAsDataURL(blob);
 });

 return promise;
}












// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                    F U N C T I O N S                                           //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Function_Debounce(func, wait)
{
 let timeout;

 return function executedFunction(...args) 
 {
  const later = 
  function()
  {
   clearTimeout(timeout);

   func(...args);
  }

  clearTimeout(timeout);

  timeout = setTimeout(later, wait);
 }
}





function Function_Throttle(func, interval)
{
 func["throttle-time"] = interval;
 
 if(!func["throttle-next"] || Date.now() > func["throttle-next"])
 {
  func["throttle-next"] = Date.now() + func["throttle-time"];
  func();
 }
} 




function Function_ThrottleEvent(callback, delay)
{
 let throttleTimeout = null;
 let storedEvent     = null;

 function throttledEventHandler(event)
 {
  storedEvent = event;

  const shouldHandleEvent = !throttleTimeout;

  if(shouldHandleEvent) 
  {
   callback(storedEvent);

   storedEvent = null;

   throttleTimeout = setTimeout(
   function()
   {
    throttleTimeout = null;

    if(storedEvent) 
	{
     throttledEventHandler(storedEvent);
    }
   }, delay);
  }
 }

 return throttledEventHandler;
}






async function Function_Worker(f)
{ 
 var params = []; 
 for(var i = 1; i < arguments.length; i++) params.push(arguments[i]);

 var promise = new Promise((resolve, reject) =>
 {
  // GET FUNCTION CODE AS STRING
  var text = f.toString(); 

  // EXTRACT ARGUMENTS
  var args = text.slice(text.indexOf("(") + 1, text.indexOf(")")); 
  args     = args.split(",");
  for(arg of args) arg = arg.trim();

  // ALTER FUNCTION CODE:
  
  // DECLARE ARGUMENTS AS VARIABLES
  var body  = "onmessage = function(){";
  body      = body +  text.slice(text.indexOf("{") + 1, text.lastIndexOf("}")); 
  for(var i = 0, c = params.length; i<c; i++) body = "var " + args[i] + " = " + JSON.stringify(params[i]) + ";" + body;
  
  // REPLACE RETURN STATEMENTS WITH THREAD POSTMESSAGE AND TERMINATION
  body      = body.replace(/return\s+([^;]*);/g, 'postMessage($1)');
  body      = body + "}";
  
  // CREATE WORKER FROM CONSTRUCTED CODE
  var code   = URL.createObjectURL(new Blob([body], {type:"text/javascript"}));
  var thread = new Worker(code);

  thread.onmessage =
  function(result)
  {
   resolve(result.data);
 
   thread.terminate();
  }
  
  // CALL WORKER
  thread.postMessage("");
  
 });

 return promise;
}





function Functions_List(filter, categorize, separator = "_")
{
 var functions = {};
 
 for(var id in window)
 {
  var f = window[id];
  
  if(typeof f == "function")
  {
   if(!f.toString().includes("native code"))
   {
	if(!filter || id.startsWith(filter))
	{
	 functions[id] = f;
	}
   }
  }
 }
 
 return functions;
}






// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                       C L I E N T                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Client_Language_Get()
{
 var language = navigator.language.split("-");
 
 return language[0] || "en";
}





function Client_Location_Parameter(parameter)
{
 var url   = window.location.href;
 var value = URL_Parameter_Get(parameter, url);
 
 return value;
}



function Client_Location_Current()
{
 return document.location.origin + document.location.pathname;
}



function Client_Location_Clear()
{
 history.replaceState({}, "", Client_Location_Current());
}




async function Client_Wait(seconds)
{
 var time    = Math.floor(seconds  * 1000);

 var promise = new Promise((resolve, reject) =>
 {
  var wait = 
  setTimeout(
  function()
  {
   clearTimeout(wait);
   
   resolve();	  
  }, 
  time);
  
 });
 
 return promise;
}





function Client_Variables_Get()
{
 var variables =
 {
  host : location.origin
 }
 
 return variables;
}





function Client_Variables_Apply(string)
{ 
 var variables = Client_Variables_Get();
 var parsed    = String_Variables_Set(string, variables);
 
 return parsed;
}




async function Client_Screen_Info()
{
 var info          = {};
 info["secondary"] = [];
 
 var details = await getScreenDetails();
 
 for(var screen of details["screens"])
 {
  if(!screen.isPrimary) info["secondary"].push(screen); 
 }
 
 info["primary"] = details.currentScreen;
 
 return info;
}



function Client_Reload()
{
 document.location.reload();
}




async function Client_Picker(type, options = {})
{
 var promise = new Promise((resolve, reject) => 
 {
  var input = document.createElement("input");
  input.type             = type;
  input.style.position   = "absolute";
  input.style.zIndex     = 100;
  input.style.left       = options["left"] || (window.innerWidth  / 2) + "px";
  input.style.top        = options["top"]  || (window.innerHeight / 2) + "px";
  input.style.width      = "0px";
  input.style.height     = "0px";
  input.style.opacity    = 0;
 
  document.body.appendChild(input);

  input.onchange = 
  function(event)
  {
   resolve(input.value);
  } 

  input.onblur = 
  function(event)
  {
   resolve(false);
  }
 
  input.focus(); 
  setTimeout(function(){input.showPicker()}, 125); 
 });
 
 return promise;
}





// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                           S A F E                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

function Safe_Set(object, field, value, setonly)
{
  // NOT AN OBJECT OR ARRAY? RETURN SAFEVALUE
 if(typeof object != "array" && typeof object != "object") return false;
 
 // LIST OF NESTED FIELDS IS A STRING? FIX IT TO ARRAY CONTAINING A SINGLE STRING
 if(typeof field == "string") field = [field];
 	
	
 var pointer = object;
 var level   = "";
 
 for(var i=0, c=field.length; i<c; i++) 
 {
  level = field[i];
 
  if(i == (c-1))
  {
   //if(!setonly || pointer[level] === undefined) 
   //{
	pointer[level] = value;
	return pointer;
   //}
  }
  else
  {
   if(typeof pointer[level] == "undefined") pointer[level] = {};
   pointer = pointer[level]
  }
 }
 
 return true;
}





function Safe_Get(object, field, safevalue)
{
 // NOT AN OBJECT OR ARRAY? RETURN SAFEVALUE
 if(typeof object != "array" && typeof object != "object") return safevalue;


 // LIST OF NESTED FIELDS IS A STRING? FIX IT TO ARRAY CONTAINING A SINGLE STRING
 if(typeof field == "string") field = [field];


 // DEFAULT TO SAFE VALUE
 var value = safevalue;
 
 // RUN
 var check = object;
 var i     = 0;
 var l     = field.length;
 
 while(typeof check[field[i]] != "undefined" && check[field[i]] != null)
 {
  check = check[field[i]];
  
  if(i == (l-1)) value = check; else i = i + 1;
 }
 
 return value;
}




function Safe_Add(object, field, inc)
{
 var value = Safe_Get(object, field);
 
 if(typeof value == "undefined") var value = 0;
 value = parseInt(value) + inc;
 
 Safe_Set(object, field, value);
}




function Safe_Switch(object, field, safedefault = true)
{
 var value = Safe_Get(object, field);
 if(typeof value == "undefined") var value = safedefault; else value = !value;
 
 Safe_Set(object, field, value);
}




function Safe_Delete(object, field)
{ 
 // NOT AN OBJECT OR ARRAY? RETURN SAFEVALUE
 if(typeof object != "array" && typeof object != "object") return false;
 
 // LIST OF NESTED FIELDS IS A STRING? FIX IT TO ARRAY CONTAINING A SINGLE STRING
 if(typeof field == "string") field = [field];

	
 var pointer = object;
 var level   = "";
 
 for(var i=0, c=field.length; i<c; i++) 
 {
  level = field[i];
 
  if(i == (c-1))
  {
   delete pointer[level];
   return true;
  }
  else
  {
   if(typeof pointer[level] == "undefined") pointer[level] = {};
   pointer = pointer[level]
  }
 }
 
 return false;
}





function Safe_Push(object, field, item)
{
 // NOT AN OBJECT OR ARRAY? RETURN SAFEVALUE
 if(typeof object != "array" && typeof object != "object") return false;
 	
 if(!object[field]) object[field] = [];
 object[field].push(item);
 
 return item;
}




/*function Safe_Push(object, field, item)
{
 if(typeof object != "array" && typeof object != "object") return false;
 	
 var pointer = object;
 var level   = "";
 
 for(var i=0, c=field.length; i<c; i++) 
 {
  level = field[i];
 
  if(i == (c-1))
  {
   pointer[level].push(item);
  }
  else
  {
   if(typeof pointer[level] == "undefined") pointer[level] = [];
   pointer = pointer[level]
  }
 }
 
 return true;
}*/






function Safe_JSON(string, saferesult)
{ 
 try
 {
  var result = JSON.parse(string);
 }
 catch
 {
  var result = saferesult;
 }
 
 return result;
}




function Safe_JSON_Field(object, field, safevalue)
{
 var json  = Safe_Get(object, field, "");

 var value = Safe_JSON(json, safevalue);
 
 Safe_Set(object, field, value);
 
 return value;
}
 





function Safe_Function(funcname, safefunc)
{
 if(window[funcname]) return window[funcname]; else return safefunc;
}




function Safe_Length(item)
{
 if(Array.isArray(item))  return item.length;
 
 if(typeof item == "object") return Object.keys(item).length;
 
 return 0; 
}




function Safe_Validate(item)
{
 switch(typeof item)
 {
  case "object":
	if(Array.isArray(item)) return (item.length != 0); else return (Object.keys(item) != 0);
  break;
  
  default:
	return (item != false) && (item != null);
  break;
 }
}







// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                        P A T H S                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Path_Filename(path)
{
 return path.replace(/^.*[\\\/]/, '');
}




function Path_Extension(filename)
{
 var extension = filename.split('.').pop();
 
 if(extension == filename) return ""; else return extension;
}




function Path_Folder(path)
{
 return path.match(/(.*)[\/\\]/)[1]||'';
}




function Path_RemoveExtension(filename)
{
 return filename.substr(0, filename.lastIndexOf('.')) || filename;
}








// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                         C O L O R S                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



function Color_Hex_ToRGBA(hex, alpha = 1)
{
 hex   = hex.trim().toLowerCase(); 
 var c = hex.substring(1).split('');
 
 if(c.length== 3)
 {
  c = [c[0], c[0], c[1], c[1], c[2], c[2]];
 }
 
 c= '0x'+c.join('');
 
 var rgba = [(c>>16)&255, (c>>8)&255, c&255];
 
 
 return 'rgba(' + rgba.join(',')+', ' + alpha + ')';
}



function Color_Shade(color, percent) 
{
 if(percent == 0) return color;
	 
 color = color.trim();

 var R = parseInt(color.substring(1,3),16);
 var G = parseInt(color.substring(3,5),16);
 var B = parseInt(color.substring(5,7),16);

 R = parseInt(R * (100 + percent) / 100);
 G = parseInt(G * (100 + percent) / 100);
 B = parseInt(B * (100 + percent) / 100);

 R = (R<255) ? R: 255;  
 G = (G<255) ? G: 255;  
 B = (B<255) ? B: 255;  
 
 var RR = ((R.toString(16).length==1) ? "0" + R.toString(16): R.toString(16));
 var GG = ((G.toString(16).length==1) ? "0" + G.toString(16): G.toString(16));
 var BB = ((B.toString(16).length==1) ? "0" + B.toString(16): B.toString(16));

 return "#" + RR + GG + BB;
}









// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                       R E Q U E S T S                                          //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Request_Response(response, type, options = {})
{
 switch(type)
 {
  case "text":
	var  data = await response.text();
  break;
  
  case "json":
	var text = await response.text();
	var data = Safe_JSON(text);
  break;
  
  case "blob":
	var data = await response.blob();
  break;
  
  case "csv":
	
	var text = await response.text();
	
	// SPLIT IN LINES
	var delimiter = options["delimiter"] || ";";	
	var lines     = text.split("\r\n");
	for(var i in lines)
	{
     lines[i] = lines[i].split(delimiter);
	}
	
	// FIRST LINE = FIELDS?
	var fields = options["fields"];
	if(fields && lines.length > 1)
	{
     var data   = [];
	 var fields = lines[0]; console.log(fields);
	 
	 for(var i = 1; i<lines.length; i++)
	 {
	  var obj  = {};
	  var line = lines[i];
	  
      for(var n in fields)
	  {
	   var field = fields[n];
	   var value = line[n];
	   
	   obj[field] = value;
	  }
	  
	  data.push(obj);
	 }	
	}
	
	else
    
	{
	 var data = lines;
	}
	
  break;
 }
 
 return data;
}





async function Request_Load(url, type, options)
{
 var response = await fetch(url);
 var data     = await Request_Response(response, type, options);
 
 return data;
}






async function Request_Post(url, data, type, header)
{
 var config = 
 {
  method: "POST",
  headers: {
		    'Content-Type': 'application/json'
           },
  body:   JSON.stringify(data)		   
 }
 
 var response = await fetch(url, config);
 var data     = await Request_Response(response, type);
 
 return data;
}







async function Request_Upload(uploader, onuploadstart, options) 
{ 
 var promise = new Promise((resolve, reject) =>
 {
  if(uploader.indexOf("?") == -1) uploader = uploader + "?";
  
  var input           = document.createElement("input");
  input.type          = "file";
  input.style.display = "none";
  document.body.appendChild(input);
 
  // 1b - WHEN THE USER HAS PICKED A FILE...
  input.addEventListener("change",
  function()
  { 
   console.log("input change");
   
   input.changed = true;
   document.body.removeChild(input);
  
   var file = input.files[0];
  
   if(onuploadstart) onuploadstart();
  
   var reader = new FileReader();
  
   // 2b - WHEN THE FILE HAS BEEN READ FROM LOCAL DEVICE...
   reader.onloadend = 
   function() 
   {
    var data = reader.result;
    if (data.indexOf("base64,") > 0)
    {
     data = data.split("base64,")[1];
    }
   
    // CHECK FILESIZE LIMIT, IF SPECIFIED
    if(options && options["maxsize"] && (data.length > options["maxsize"]))  	  
    {
	 resolve({status:"error", reason:"too big"});
    }
    else
    // FILESIZE IS OK, MOVE ON	    
    {
     var request = new XMLHttpRequest();
    
     request.open("POST", uploader + "&srcfilename=" + Path_Filename(reader.source.name), true);
     request.setRequestHeader("Content-Type", `${file.type}`);
  
     // 3b - WHEN DATA HAS BEEN RECEIVED BY THE SERVER...
     request.onreadystatechange =
     function()
     { 
	  if(request.readyState==4 && request.status==200)
      {
	   var response = request.responseText;	
    
	   resolve({status:"ok", path:response});
      }		 
     }

     // 3a - SEND DATA TO THE SERVER
     request.send(data); 
    }
   
   }
   
   // 2a - READ FILE FROM LOCAL DEVICE 
   reader.source = file;
   reader.readAsDataURL(file);
  },
  false);
 
  // 1a - FIRE UP FILE SELECTION DIALOG
  window.addEventListener("focus",
  function()
  {
   setTimeout(
   function()
   {
    if(!input.changed) resolve({status:"cancelled"});  
   }, 250);
  }, 
  {once:true});

  input.click();
 });
 
 return promise;
}




async function Request_Download(url)
{
 var name = Path_Filename(url);
 var blob = await Request_Load(url, "blob");

 await Storage_Blob_Download(blob, name); 
}








// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      S T O R A G E                                             //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



async function Storage_File_Read(source, options = {})
{
 var promise = new Promise((resolve, reject) =>
 {
  var reader = new FileReader();
  
  reader.onloadend = 
  function() 
  {
   var data = reader.result;
   
   if(!options["whole"])
   {
    if(data.indexOf("base64,") > 0)
    {
     data = data.split("base64,")[1];
    }
   }
   
   resolve(data);  
  }
 
  reader.source = source;
  reader.readAsDataURL(source);
 });
 
 return promise;
}




async function Storage_File_ReadBlob(source, options)
{
 var promise = new Promise((resolve, reject) =>
 {
  var reader = new FileReader();
  
  reader.onloadend = 
  function() 
  {
   var data = reader.result;
   
   resolve(data);  
  }
 
  reader.source = source;
  reader.readAsBlob(source);
 });
 
 return promise;
}



async function Storage_File_Select(options = {})
{
 var promise = new Promise((resolve, reject) =>
 {
  // SETUP FILE SELECT DIALOG
  var selector           = document.createElement("input");
  selector.type          = "file";
  selector.style.display = "none";
  
  selector.accept        = options["accept"];
  
  
  if(options["multiple"]) selector.multiple = "multiple";
  
 
  // DETECT FILES SELECTED
  selector.addEventListener("change",
  function()
  {  
   selector.changed = true;
   document.body.removeChild(selector);
  
   var selected = selector.files;
  
   resolve(selected);
  }, 
  false);
  
  
  // DETECT IF NO FILES SELECTED
  window.addEventListener("focus",
  function()
  {
   setTimeout(
   function()
   {
    if(!selector.changed) resolve([]);  
   }, 250);
  }, 
  {once:true});
  
 
  // TRIGGER SELECTOR
  document.body.appendChild(selector);
  selector.click();
 });
 
 return promise;
}





async function Storage_File_Upload(filename, data, type, uploader, options)
{
 var promise = new Promise((resolve, reject) =>
 {
  // SETUP REQUEST
  var request = new XMLHttpRequest();
    
  request.open("POST", uploader + "&srcfilename=" + Path_Filename(filename), true);
  request.setRequestHeader("Content-Type", type);
  
  // ON SERVER RESPONSE
  request.onreadystatechange =
  function()
  { 
   if(request.readyState == 4 && request.status == 200)
   {
	var response = request.responseText;	
    
	resolve({status:"ok", path:response});
   } 		 
  }

  // SEND DATA TO THE UPLOADER
  request.send(data); 
 });
 
 return promise;
}






async function Storage_Files_Upload(files, uploader, options = {}, onfileuploaded)
{
 for(var file of files)
 {
  console.log(file);
  
  var filename = Safe_Get(options, ["filename"]) || file["override-name"] || file["name"];
  
  var data     = await Storage_File_Read(file);
  var response = await Storage_File_Upload(filename, data, file["type"], uploader, options);

  if(onfileuploaded) onfileuploaded(filename, data, response);
 }
}





function Storage_Blob_Download(blob, filename)
{
 url = URL.createObjectURL(blob);
 
 var a           = document.createElement("a");
 a.style.display = "none";
 a.href          = url;
 a.download      = filename;
 a.click();
 
 URL.revokeObjectURL(url)
}





function Storage_Data_Download(data, filename, mimetype)
{
 if(typeof(data) == "object") var data = JSON.stringify(data, null, 2);
 
 var blob = new Blob([data], {type:mimetype});
 
 Storage_Blob_Download(blob, filename);
}








// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                           U R L S                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



function URL_Parameter_Get(parameter, url)
{
 if(!url) var url = window.location.href;
 
 var urlobject = new URL(url);
 var value     = urlobject.searchParams.get(parameter);
 
 return value;
}





function URL_Encode(str) 
{
  str = (str + '').toString();

  // Tilde should be allowed unescaped in future versions of PHP (as reflected below), but if you want to reflect current
  // PHP behavior, you would need to add ".replace(/~/g, '%7E');" to the following.
  return encodeURIComponent(str)
    .replace(/!/g, '%21')
    .replace(/'/g, '%27')
    .replace(/\(/g, '%28')
    .
  replace(/\)/g, '%29')
    .replace(/\*/g, '%2A')
    .replace(/%20/g, '+');
}





function URL_Decode(str) 
{
 return decodeURIComponent((str + '').replace(/%(?![\da-f]{2})/gi, function () {
        // PHP tolerates poorly formed escape sequences
        return '%25';
    }).replace(/\+/g, '%20'));
}











// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                     G E O M E T R Y                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

function Geometry_Point_InRect(x, y, r) 
{
 return x >= r.left && x < r.right && y >= r.top && y < r.bottom;
}



function Geometry_Rect_Intersect(rect1, rect2)
{
 return !( rect1.top > rect2.bottom || rect1.right < rect2.left || rect1.bottom < rect2.top || rect1.left > rect2.right);
}




function Geometry_Rect_Displacement(rect, corner)
{
 switch(corner)
 {
  case "top":
	var x = rect.width / 2;
    var y = 0;
  break;	
  
  case "center":
	var x = rect.width  / 2;
    var y = rect.height / 2;
  break;	
  
  case "bottom":
	var x = rect.width / 2;
    var y = rect.height;
  break;	
	 
	 
	 
  case "right top":
	var x = rect.width;
    var y = 0;
  break;

  case "right":
	var x = rect.width;
    var y = rect.height / 2;
  break;
  
  case "right bottom":
	var x = rect.width;
    var y = rect.height;
  break;
  
 
  
  case "left top":
	var x = 0;
    var y = 0;
  break;
  
  case "left":
	var x = 0;
    var y = rect.height / 2;
  break
  
  case "left bottom":
	var x = 0;
    var y = rect.height;
  break;
 }
 
 return {left:x, top:y};
}





function Geometry_Rect_Corner(rect, corner)
{
 var displacement = Geometry_Rect_Displacement(rect, corner);
 var x = rect.left + displacement["left"]; 
 var y = rect.top  + displacement["top"];
 
 return {left:x, top:y};
}




function Geometry_Rect_Inside(rect1, rect2)
{
 return ( ((rect2.top <= rect1.top) && (rect1.top <= rect2.bottom)) && ((rect2.top <= rect1.bottom) && (rect1.bottom <= rect2.bottom)) && ((rect2.left <= rect1.left) && (rect1.left <= rect2.right)) && ((rect2.left <= rect1.right) && (rect1.right <= rect2.right)) );
}



function Geometry_Rect_Translate(rect, x, y)
{
 var result = {};
 
 result.left   = rect.left   + x;
 result.right  = rect.right  + x;
 result.width  = rect.width  + x;
 result.top    = rect.top    + y;
 result.bottom = rect.bottom + y;
 result.height = rect.height + y;
 
 return result;
}



function Geometry_Line_Points(x0, y0, x1, y1)
{
 var points = [];
	
 var dx = Math.abs(x1-x0);
 var dy = Math.abs(y1-y0);
 var sx = (x0 < x1) ? 1 : -1;
 var sy = (y0 < y1) ? 1 : -1;
 var err = dx-dy;

 while(true)
 {
  points.push({x:x0, y:y0}); 

  if ((x0==x1) && (y0==y1)) break;
  var e2 = 2*err;
  if (e2 >-dy){ err -= dy; x0  += sx; }
  if (e2 < dx){ err += dx; y0  += sy; }
 }
 
 return points;
}












// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      N U M B E R S                                             //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



function Numbers_Interpolate(x, y, a)
{
 return x * (1 - a) + y * a;
}




function Numbers_PercentageDifference(a, b)
{
 return  100 * Math.abs( ( a - b ) / ( (a + b)/2 ) );
}




function Numbers_PercentageDistance(a, b)
{
 return (b - a) * 100;
}




function Numbers_Random(min, max)
{
 return Math.floor(Math.random() * (max - min)) + min;
}



function Numbers_Between(x, a, b)
{
 return x >= a && x <= b;
}



function Numbers_Within(x, a, b)
{
 return x > a && x < b;
}



function Numbers_Range_Intersect(ra, rb)
{
 return Numbers_Within(ra["from"], rb["from"], rb["to"]) || Numbers_Within(ra["to"],   rb["from"], rb["to"]) || Numbers_Within(rb["from"], ra["from"], ra["to"]) || Numbers_Within(rb["to"], ra["from"], ra["to"]);
}




function Numbers_Is_Even(n)
{
 return (n % 2 == 0);
}



function Numbers_Is_Odd(n)
{
 return (n % 2 != 0);
}




// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                I N T E R P O L A T I O N                                       //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



async function Interpolation_Thread(target, values, time, options = {fps:60}, events)
{
 var promise = new Promise((resolve, reject) =>
 { 
  var interpolator               = {};
  
  interpolator["target"]         = target;
  interpolator["keys"]           = Object.keys(values);
  
  interpolator["start-time"]     = Date.now();
  interpolator["start-values"]   = Object_Subset(target, interpolator["keys"], "collect");
  interpolator["end-values"]     = values;
  
  interpolator["execution-time"] = time;
  interpolator["execution-freq"] = options["fps"];
  
  
  interpolator["thread"]         = setInterval(
  function()
  {
   interpolator["elapsed-time"]  = Date.now() - interpolator["start-time"];
   interpolator["interpolation"] = interpolator["elapsed-time"] / (interpolator["execution-time"] * 1000);
   
   for(var key of interpolator["keys"])
   {
	var a = parseFloat(interpolator["start-values"][key]);
	var b = parseFloat(interpolator["end-values"][key]);
	
    interpolator["target"][key] = Numbers_Interpolate(a, b, interpolator["interpolation"]);
	
	if(events && events["onchange"]) events["onchange"](interpolator);
   }
   
   if(interpolator["interpolation"] >= 1)
   {
	clearInterval(interpolator["thread"]);
	
	resolve();
   }	   
  },
  
  Math.floor(1000/ interpolator["execution-freq"]));
  
  this["interpolator"] = interpolator;
 });
 
 return promise;
}






// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                       D A T A S E T S                                          //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Dataset_Compute_CumulativeAverages(dataset, field, scale)
{ 
 var output = [];
 
 var max    = dataset.length * scale;
 var total  = 0;
 for(var item of dataset)
 {
  total     = total + Safe_Get(item, field, 0);
  var score = (total / max) * scale;
  
  output.push(score);
 }
 
 return output;
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                     T E M P L A T E                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Template_OnLoad(module, data)
{
}



async function Template_OnShow(module, data)
{
}




async function Template_OnUnload()
{
}





// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          M O R E                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                     A C T I V I T I E S                                        //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Activity_Function(type, action)
{
 var f = window["Activity_" + String_Capitalize_Initial(type) + "_" + String_Capitalize_Initial(action)];
 
 return f || async function(){};	 
}




async function Activity_Run(source, config = {mode:"test", escape:true})
{
 console.log("ACTIVITY RUN");
 console.log(source);
 console.log(config);
 console.log("");

 // IF ESCAPING IS ALLOWED AND MODE = TEST, MUST CONFIRM ESCAPING
 if(config["escape"] && config["mode"] == "test")
 {
  config["escape"] =
  async function(popup)
  {
   // FASTEXIT: JUST EXIT
   if(config["fastexit"])
   {
	return true;
   }
   else
   // CONFIRM EXIT
   {
    // POPUP
    var title    = UI_Language_String("activities", "escape popup title"); 
    var content  = UI_Language_String("activities", "escape popup text save"); 
    var picture  = Resources_URL("images/cover-logout.png");

    var confirm  = await UI_Popup_Confirm(title, content, picture);
    return confirm;
   }
  }
 }
 
 
 // DETERMINE TYPE FROM SOURCE
 var type = String_Filter_AllowAlpha(Path_Filename(source.toLowerCase())); 

 Core_State_Set("activity", ["result"], false);
 Core_State_Set("activity", ["type"],   type);
 Core_State_Set("activity", ["source"], source);
 Core_State_Set("activity", ["config"], config);
 
 // DETERMINE NAMESPACE
 var namespace = "Activity_" + String_Capitalize_Initial(type);
 
 
 // SET UP CONTAINER
 var container = UI_Element_Create("activities/" + type + "-container");
 Core_State_Set("activity", ["container"], container);
 
 for(var control of ["prev", "feedback", "next", "finish"])
 {
  var element = UI_Element_Find(container,  "activity-" + control);
  var func    = window[namespace + "_Control" + String_Capitalize_Initial(control)];
  if(element && func) element.onclick = func;
 }
 


 // CREATE RUN PROMISE
 var promise = new Promise(async(resolve, reject) =>
 {  
  // DISPLAY
  var template = config["popup"] || "standard";
  var popup    = await UI_Popup_Create({content:container}, undefined, "activities/display-popup-" + template, 
  {
   open:   true, 
   escape: config["escape"], 
  
   onescape:
   function()
   {
    // ESCAPING THE ACTIVITY NULLS THE RESULT
    Core_State_Set("activity", ["result"], false);	   
   },
  
   onclose:
   async function()
   {
    var result = Core_State_Get("activity", ["result"]);
   
    // REFRESH CLASS DATA
    await Course_Class_RefreshData();

    resolve(result);
   }		  
  });
	
  Core_State_Set("activity", ["popup"], popup);
  var display = UI_Element_Find(popup, "popup-window");
   
 
   
  // RUN
  var run = Safe_Function(namespace + "_Run"); console.log(namespace + "_Run");
  await run(source, display, config);
 
  
 
  // TERMINATE
 });
 
 Core_State_Set("activity", ["result"], false);
 
 return promise;
}




async function Activity_Result_Store(result)
{
 var config   = Core_State_Get("activity", ["config"]);
 var source   = Core_State_Get("activity", ["source"]);
 var checkResult = Core_State_Get("activity","result",false);
 var mode = config["mode"];
 if(checkResult == false) mode = config["mode"] + "ing";
 var duration = 0;
 
 // STORE ACTIVITY RESULT
 var id = await Core_Api("Activity_Result_Store", 
 {
   student_id: User_Id(), 
   source:     source.replace("content/lessons/", ""), 
   mode:       mode,
   score:      result["score"], 
   data:       result["data"], 
   duration:   duration
 });
 return id;
}


async function Activity_Result_Update()
{
 var id      = Core_State_Get("activity",["existed-id"],false);
 var type   = Core_State_Get("activity", ["type"]);
 if(type == "test")  id = Core_State_Get("activity",["data","id"],false);
 var config   = Core_State_Get("activity", ["config"]);
 var result = Core_State_Get("activity","result",false);
 var mode = config["mode"];
 if(result == false)
 {
   mode = config["mode"] + "ing";
   result  = Activity_Get_Current_Result()
 } 
 if(id){
   // UPDATE ACTIVITY RESULT
   await Core_Api("Activity_Result_Update", 
   {
      id : id,
      mode:       mode,
      score:      result["score"],
      data:  result["data"] 
   });
 }
 else{
   // STORE ACTIVITY RESULT
   let returnId = await Activity_Result_Store(result);
   if(type == "test")
   Core_State_Set("activity",["data","id"],returnId);
   else Core_State_Set("activity",["existed-id"],returnId);
 }
}


async function Activity_Result_Popup(result)
{
 if(!result) return;
 console.log(result);
 
 var config   = Core_State_Get("activity", ["config"]);
 var type     = Core_State_Get("activity", ["type"]);
 var source   = Core_State_Get("activity", ["source"]);
 
 var duration = 0;
 
 // STORE ACTIVITY RESULT
 if(config.mode != "test")
 await Activity_Result_Store(result);
 else await Activity_Result_Update();
 
 // DISPLAY END OF ACTIVITY POPUP BASED ON RESULT 
 var score           = result["score"];
 if(score < 0) score = 0;
 
 for(var level of ["good", "soso", "bad"])
 {
  if(score >= Module_Config("test", "score-" + level))
  {  
   var subtitle = UI_Language_String("activities/results", "popup result title");
   var title    = UI_Language_String("activities/results", level + " title");
   var content  = UI_Language_String("activities/results", level + " text");
   
   var animation = Core_Data_Value("activities/results", "popup result animation", level);
   var picture   = Resources_URL("images/activity-" + level + ".png");
	   
   await UI_Popup_Create({title, subtitle, content, picture}, undefined, undefined, {escape:true, open:true, animation:animation});
   
   break;
  }
 }
 
}

function Activity_Get_Current_Result(){
   var mode   = Core_State_Get("activity", ["config","mode"],"practice");
   var type   = Core_State_Get("activity", ["type"]);
   if(mode == "test"){
      var test   = Core_State_Get("activity", ["data"]);
      var result = {score:0,data:[]};
      var index  = 0;
      var scoreTotal = 0;
      if(type == "test")
      {
         index = parseInt(test["index"]) + 1;
         for (let i = 0; i < index; i++) {
            let score = test["sheets"][i]["result"];
            result.data.push({question: test["sheets"][i]["id"],score: score});
            scoreTotal += score;
         }
      }else if(type == "vocabulary"){
         index = Core_State_Get("activity", ["index"]);
         for (let i = 0; i < index; i++) {
            let score = test[i]["score"];
            result.data.push({term: test[i]["id"],score: score});
            scoreTotal += score;
         }
      }
      result.score = scoreTotal / index;
      return result;
   }
   else return {score:0,data:[]};
}


function Activity_Get_Testing(){
   var source = Core_State_Get("activity", ["source"]);
   source = source.replace("content/lessons/", "");
   var activities   = Core_State_Get("course", ["class-data","activities",source],[]);
   var result = null;
   activities.forEach(element => {
      if(element["mode"] == "testing"){
         result = element;
      } 
   });
   return result;
}

function Activity_Load_ExistTest(test,resultData){
   var data   = Core_State_Get("activity", ["data"]);
   Core_State_Set("activity", ["data","id"],resultData["id"]);
   var sheets = data.sheets;
   for (let index = 0; index < resultData.data.length; index++) {
      sheets[index].result = resultData.data[index].score;
   }
   Core_State_Set("activity", ["data","sheets"],sheets);
   Core_State_Set("activity", ["data","index"],resultData.data.length);
   test["index"] = resultData.data.length;
   return test;
}

function Activity_Load_ExistVocabulary(test,resultData){
   Core_State_Set("activity", ["existed-id"],resultData["id"]);
   for (let index = 0; index < resultData.data.length; index++) {
      test[index].score = resultData.data[index].score;
   }
   Core_State_Set("activity", ["data"],test);
   Core_State_Set("activity", ["index"],resultData.data.length);
   return test;
}

// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                     B O O K P A G E                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Activity_Bookpage_Run(source, display, config)
{	
 var lesson = Path_Filename(Path_Folder(source));
 var page               = await Lesson_Bookpage_Render(lesson);
 if(!page.lastElementChild) page     = Bookpage_Create_Empty_Page();
 page.style.height      = "90vh";
 page.style.aspectRatio = 1.4;
 page.style.perspective = "100vh";
 page.style.position = "absolute";
 page.style.top = "37px";
 page.style.zIndex = 100;
 page.lastElementChild.style.backfaceVisibility = "hidden";
 page.lastElementChild.style.transformOrigin = "left";
 page.lastElementChild.style.transition = "transform 0.25s";
 page.firstElementChild.style.backfaceVisibility = "hidden";
 page.firstElementChild.style.transformOrigin = "right";
 page.firstElementChild.style.transition = "transform 0.25s";
 page.dataset.uid = lesson;

 Core_State_Set("activity",["bookpage","current-page"],page);

 var frame   = await UI_Frame_Flexi(Resources_URL("images/frames/book-classic"), 32);
 Document_CSS_SetClass(frame, "border-rounded");
 var content = UI_Element_Find(frame, "content");
 content.style.overflow = "unset";
 content.style.height = "90vh";
 content.style.width = "64vw";
 display.innerHTML = "";
 display.appendChild(frame);

 content.appendChild(page);

 Document_Element_FitContent(page, 0.01);
 Bookpage_Adjust(page);
 
 // CHANGE WIDTH CONTENT AFTER LOAD PAGE
 var pageWidth = page.clientWidth;
 content.style.width = pageWidth + "px";
 // FIX TOP PAGE AFTER LOAD
 page.style.top = display.offsetTop + 32 + "px";
 Document_Element_SetData(content,"top", display.offsetTop + 32 + "px");
 var right = UI_Element_Find(frame, "right");
 right.classList.add("style-clickable");
 right.onclick = Activity_Bookpage_FlipBook_ControlNext

 var left = UI_Element_Find(frame, "left");
 left.classList.add("style-clickable");
 left.onclick = Activity_Bookpage_FlipBook_ControlPrev

 var top = content.parentElement.previousSibling.children[0];
 var topInner = UI_Element_Create("activities/bookpage-top");
 topInner.style.display = "inline-flex";
 top.appendChild(topInner);
 var currentPageButton = UI_Element_Find(top,"current");
 currentPageButton.onclick = Activity_Bookpage_ResetSlide;

 //EDIT FEATURE BUTTON
 var button = document.createElement("div");
 button.style.cssText = "display:inline-flex;float:right;margin-right:5px";
 button.classList.add("style-clickable","fa-solid","fa-pen-clip");
 button.onclick = async () => {
  //CHECK CURRENT PAGE
  var page = Core_State_Get("activity", ["bookpage","current-page"]);
  var lesson_id = Core_State_Get("course", "current-lesson");
  if(page.dataset.uid != lesson_id) return;
  var scale = "";
  var page = Core_State_Get("activity",["bookpage","current-page"],null);
  if(page){
    if(UI_Element_Find(page,"vocabulary") && UI_Element_Find(page,"vocabulary").firstElementChild.firstElementChild != null) scale += "&scaleVocabulary=" + UI_Element_Find(page,"vocabulary").firstElementChild.firstElementChild.style.zoom;
    if(UI_Element_Find(page,"dialogue") && UI_Element_Find(page,"dialogue").firstElementChild.firstElementChild != null) scale += "&scaleDialogue=" + UI_Element_Find(page,"dialogue").firstElementChild.firstElementChild.style.zoom;
  }
  window.open("?framework=null&module=bookpage&lesson=" + lesson_id + "&edit=true" + scale, "_", "popup, width="+ screen.width + ", height=" + screen.height + ", fullscreen=yes");
}
 top.appendChild(button);

 await Activity_Bookpage_Load_Flip_Book(content,lesson)
}




async function Activity_Bookpage_Finish(player)
{
 var popup = Core_State_Get("activity", ["popup"]); 
 await UI_Popup_Close(popup); 
}



async function Activity_Bookpage_Load_Flip_Book(content,lesson)
{
  var currentPage = Core_State_Get("activity",["bookpage","current-page"]);
  var prevLesson = Lesson_Get_From_Config(lesson,"prev");
  
  if(prevLesson)
  {
     var prevPage               = await Lesson_Bookpage_Render(prevLesson);
     if(!prevPage.lastElementChild) prevPage     = Bookpage_Create_Empty_Page();
     if(prevPage.lastElementChild){
       prevPage.style.height      = "90vh";
       prevPage.style.aspectRatio = 1.4;
       prevPage.lastElementChild.style.backfaceVisibility = "hidden";
       prevPage.lastElementChild.style.transformOrigin = "left";
       prevPage.lastElementChild.style.transition = "transform 0.25s";
       prevPage.lastElementChild.style.transform =  "rotateY(-180deg)";
       prevPage.firstElementChild.style.backfaceVisibility = "hidden";
       prevPage.firstElementChild.style.transformOrigin = "right";
       prevPage.firstElementChild.style.transition = "transform 0.25s";
     }
     prevPage.style.perspective = "100vh";
     prevPage.dataset.uid = prevLesson;
     prevPage.style.position = "absolute";
     prevPage.style.top = content.dataset.top;
     prevPage.style.zIndex= 10;
     Core_State_Set("activity",["bookpage","prev-page"],prevPage);
     content.insertBefore(prevPage,currentPage);
     Document_Element_FitContent(prevPage, 0.01);
     Bookpage_Adjust(prevPage);
  }

  var nextLesson = Lesson_Get_From_Config(lesson,"next");
  if(nextLesson)
  {
     var nextPage               = await Lesson_Bookpage_Render(nextLesson);
     if(!nextPage.lastElementChild) nextPage     = Bookpage_Create_Empty_Page();
     if(nextPage.lastElementChild)
     {
       nextPage.style.height      = "90vh";
       nextPage.style.aspectRatio = 1.4;
       nextPage.lastElementChild.style.backfaceVisibility = "hidden";
       nextPage.lastElementChild.style.transformOrigin = "left";
       nextPage.lastElementChild.style.transition = "transform 0.25s";
       nextPage.firstElementChild.style.backfaceVisibility = "hidden";
       nextPage.firstElementChild.style.transformOrigin = "right";
       nextPage.firstElementChild.style.transition = "transform 0.25s";
       nextPage.firstElementChild.style.transform =  "rotateY(180deg)";
     }
     nextPage.style.perspective = "100vh";
     nextPage.dataset.uid = nextLesson;
     nextPage.style.position = "absolute";
     nextPage.style.top = content.dataset.top;
     nextPage.style.zIndex = 10;
     Core_State_Set("activity",["bookpage","next-page"],nextPage);
     content.appendChild(nextPage);
     Document_Element_FitContent(nextPage, 0.01);
     Bookpage_Adjust(nextPage);
  }

  // var pageRenderd = await Multi_Lesson_Bookpage_Render(lesson,30);
  // var lessons = Object.keys(pageRenderd);
  // var lessonNext = [];
  // var lessonPre  = [];
  // var checkLessonNext = 0;
  // for (let index = 0; index < lessons.length; index++) {
  //   const les = lessons[index];
  //   if(les == lesson || les == lesson.toUpperCase()) checkLessonNext = 1;
  //   else{
  //     if(checkLessonNext == 1) lessonNext.push(les);
  //     else lessonPre.unshift(les);
  //   }
  // }
  // for (let index = 0; index < lessonPre.length; index++) {
  //   const lessonPrev = lessonPre[index];
  //   var prePage = pageRenderd[lessonPrev];
  //   if(lessonPrev != prevLesson) await Activity_Bookpage_FlipBook_Render(content,prePage,lessonPrev,"pre");
  // } 
  // for (let index = 0; index < lessonNext.length; index++) {
  //   const lesNext = lessonNext[index];
  //   var pageNext = pageRenderd[lesNext];
  //   if(lesNext != nextLesson) await Activity_Bookpage_FlipBook_Render(content,pageNext,lesNext,"next");
  // } 
}



function Activity_Bookpage_FlipBook_ControlNext()
{
  Activity_Bookpage_FlipBook_Disable_Control();
  var currentPage = Core_State_Get("activity",["bookpage","current-page"]);
  var nextPage = Core_State_Get("activity",["bookpage","next-page"]);
  if(nextPage){
   nextPage.style.zIndex = 200;
   nextPage.firstElementChild.style.transform =  "rotateY(0deg)";
   currentPage.lastElementChild.style.transform =  "rotateY(-180deg)";
   setTimeout(async () => {
     currentPage.style.zIndex = 10;
     nextPage.style.zIndex = 100;
     if(nextPage.nextSibling)
     {
      nextPage.nextSibling.firstElementChild.style.transform =  "rotateY(180deg)";
      Core_State_Set("activity",["bookpage","next-page"],nextPage.nextSibling);
     }
     else{
      // CHECK LESSON EXIST
      let currentLesson = nextPage.dataset.uid;
      var lessons = Object.keys(Core_State_Get("course",["class-data","book-data"])["lessons"] || {});
      var checkLessonNext = 0;
      for (let index = 0; index < lessons.length; index++) {
        const les = lessons[index];
        if(les == currentLesson || les == currentLesson.toUpperCase()) {
          if(index < lessons.length - 1) checkLessonNext = index + 1;
        }
      }
      if(checkLessonNext)
      {
        var newPage = await Lesson_Bookpage_Render(lessons[checkLessonNext]);
        var newPageRendered = await Activity_Bookpage_FlipBook_Render(nextPage.parentElement,newPage,lessons[checkLessonNext],"next");
        newPageRendered.firstElementChild.style.transform =  "rotateY(180deg)";
        Core_State_Set("activity",["bookpage","next-page"],newPageRendered);
      } 
      else {
        Core_State_Set("activity",["bookpage","next-page"],null);
      }
     }
     Activity_Bookpage_FlipBook_Enable_Control();
   }, 250);
   
   Core_State_Set("activity",["bookpage","current-page"],nextPage);
   Core_State_Set("activity",["bookpage","prev-page"],currentPage);
  }
  else Activity_Bookpage_FlipBook_Enable_Control();
}



function Activity_Bookpage_FlipBook_ControlPrev()
{
  Activity_Bookpage_FlipBook_Disable_Control();
  var currentPage = Core_State_Get("activity",["bookpage","current-page"]);
  var prevPage = Core_State_Get("activity",["bookpage","prev-page"]);
  if(prevPage){
   prevPage.style.zIndex = 200;
   prevPage.lastElementChild.style.transform =  "rotateY(0deg)";
   currentPage.firstElementChild.style.transform =  "rotateY(180deg)";
   setTimeout(async () => {
     currentPage.style.zIndex = 10;
     prevPage.style.zIndex = 100;
     if(!prevPage.previousSibling)
     {
      // CHECK LESSON EXIST
      let currentLesson = prevPage.dataset.uid;
      var lessons = Object.keys(Core_State_Get("course",["class-data","book-data"])["lessons"] || {});
      var checkLessonPre = -1;
      for (let index = 0; index < lessons.length; index++) {
        const les = lessons[index];
        if(les == currentLesson || les == currentLesson.toUpperCase()) {
          if(index > 0) checkLessonPre = index - 1;
        }
      }
      if(checkLessonPre >= 0)
      {
        var newPage =await Lesson_Bookpage_Render(lessons[checkLessonPre]);
        var newPageRendered = await Activity_Bookpage_FlipBook_Render(prevPage.parentElement,newPage,lessons[checkLessonPre],"pre");
        Core_State_Set("activity",["bookpage","prev-page"],newPageRendered);
      } 
      else{
        Core_State_Set("activity",["bookpage","prev-page"],null);
      }
     }
     else{
      Core_State_Set("activity",["bookpage","prev-page"],prevPage.previousSibling);
     }
     Activity_Bookpage_FlipBook_Enable_Control();
   },250);
   Core_State_Set("activity",["bookpage","current-page"],prevPage);
   Core_State_Set("activity",["bookpage","next-page"],currentPage);
  }
  else Activity_Bookpage_FlipBook_Enable_Control();
}



async function Activity_Bookpage_FlipBook_Render(content,page,lesson,mode)
{
  var newPage = page;
  if(!newPage.lastElementChild)
  {
    newPage = Bookpage_Create_Empty_Page();
  }

  newPage.style.height      = "90vh";
  newPage.style.aspectRatio = 1.4;
  newPage.style.perspective = "100vh";
  newPage.dataset.uid = lesson;
  newPage.style.position = "absolute";
  newPage.style.top = content.dataset.top;
  newPage.style.zIndex= 10;

  newPage.lastElementChild.style.backfaceVisibility = "hidden";
  newPage.lastElementChild.style.transformOrigin = "left";
  newPage.lastElementChild.style.transition = "transform 0.25s";

  newPage.firstElementChild.style.backfaceVisibility = "hidden";
  newPage.firstElementChild.style.transformOrigin = "right";
  newPage.firstElementChild.style.transition = "transform 0.25s";

  switch (mode) {
    case "pre":
      newPage.lastElementChild.style.transform =  "rotateY(-180deg)";
      content.insertBefore(newPage,content.children[0]); 
      break;
  
    default:
      newPage.firstElementChild.style.transform =  "rotateY(180deg)";
      content.appendChild(newPage);
      break;
  }

  Document_Element_FitContent(newPage, 0.01);
  Bookpage_Adjust(newPage); 
  return newPage;
}

function  Activity_Bookpage_FlipBook_Disable_Control(){
 var popup = Core_State_Get("activity","popup");
 var right = UI_Element_Find(popup, "right");
 right.onclick = null;

 var left = UI_Element_Find(popup, "left");
 left.onclick = null;
}

function  Activity_Bookpage_FlipBook_Enable_Control(){
  var popup = Core_State_Get("activity","popup");
  var right = UI_Element_Find(popup, "right");
  right.onclick = Activity_Bookpage_FlipBook_ControlNext;
  
  var left = UI_Element_Find(popup, "left");
  left.onclick = Activity_Bookpage_FlipBook_ControlPrev;
}

function Activity_Bookpage_ResetSlide(){

  var content = Core_State_Get("activity",["bookpage","current-page"]).parentElement;
  //RESET LESSON
  var defaultLesson = Core_State_Get("course","current-lesson");
  var prevLesson = Lesson_Get_From_Config(defaultLesson,"prev");
  var nextLesson = Lesson_Get_From_Config(defaultLesson,"next");

  var resetLesson = UI_Element_Find(content,defaultLesson);
  var resetPreLesson = UI_Element_Find(content,prevLesson);
  var resetNextLesson = UI_Element_Find(content,nextLesson);

  Core_State_Set("activity",["bookpage","current-page"],resetLesson);
  Core_State_Set("activity",["bookpage","prev-page"],resetPreLesson);
  Core_State_Set("activity",["bookpage","next-page"],resetNextLesson);

  //RESET TRANSITION / Z-INDEX
  var pre = true;
  for (let index = 0; index < content.children.length; index++) {
    var element = content.children[index];
    element.firstElementChild.style.transform =  null;
    element.lastElementChild.style.transform =  null;
    element.style.zIndex = 10;
    console.log(element.dataset.uid, defaultLesson);
    if(element.dataset.uid == defaultLesson)
    {
      pre = false;
      element.style.zIndex = 100;
    }  
    else if(pre){
      element.lastElementChild.style.transform =  "rotateY(-180deg)";
    } else{
      element.firstElementChild.style.transform =  "rotateY(180deg)";
    }
  }
}
// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                   D I A L O G U E                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Activity_Dialogue_Run(source, display, config)
{ 
 // TRICK: USE PARENT DIRECTORY, SO THAT IF WE RUN lessons/xxx/vocabulary  IT ACTUALLY READS FROM lessons/xxx/ THE INFO.DAT FILE
 source = Path_Folder(source);
 
 // SET TEST MODULE IN THE DESIRED MODE AND LOAD TEST
 var terms = await Vocabulary_Terms_Read(source);
 terms     = Object_To_Array(terms, "id");
 
 Core_State_Set("activity", ["data"], terms); 
 Core_State_Set("activity", ["index"], 0);
 
 // UPDATE CONTAINER CONTROLS 
 Activity_Vocabulary_UpdateControls();
 
 // DISPLAY FIRST TERM
 Activity_Vocabulary_DisplayTerm()
}




async function Activity_Vocabulary_Finish()
{
 var terms  = Core_State_Get("activity", ["data"]);
 var config = Core_State_Get("activity", ["config"]);
 
 var result = Vocabulary_Practice_Result(terms); 
 Core_State_Set("activity", ["result"], result);
 
 var popup = Core_State_Get("activity", ["popup"]); 
 await UI_Popup_Close(popup); 
}




function Activity_Vocabulary_DisplayTerm()
{
 var popup     = Core_State_Get("activity", ["popup"]);
 var terms     = Core_State_Get("activity", ["data"]);
 var config    = Core_State_Get("activity", ["config"]);

 var container = UI_Element_Find(popup, "activity-body");
 var index     = Core_State_Get("activity", ["index"]);
 var term      = terms[index];
 
 Vocabulary_Practice(terms, index, container, {mode:config["mode"], oncomplete:
 function()
 {
  var popup = Core_State_Get("activity", ["popup"]);
  
  var terms = Core_State_Get("activity", ["data"]);
  var index = Core_State_Get("activity", ["index"]);
  
  
  // IF THIS WAS THE LAST TERM, DISPLAY THE FINISH FLAG
  Activity_Vocabulary_UpdateLastTerm();
  
  
 }});
}




function Activity_Vocabulary_UpdateLastTerm()
{
 var popup = Core_State_Get("activity", ["popup"]);
 var terms = Core_State_Get("activity", ["data"]);
 var index = Core_State_Get("activity", ["index"]);

 // IF THIS WAS THE LAST TERM, DISPLAY THE FINISH FLAG
 var finish = UI_Element_Find(popup, "activity-finish");
 var next   = UI_Element_Find(popup, "activity-next");
  
 if(index == terms.length - 1)
 {
  next.style.display   = "none";
  finish.style.display = "flex";
  
  Document_Element_Animate(finish, "flash 1.5s 1.5");  
 }
 else
 // OTHERWISE DISPLAY THE "NEXT" BUTTON
 {
  next.style.visibility = "visible";
   
  //Document_Element_Animate(next, "flash 1.5s 1.5");  
 }
}





function Activity_Vocabulary_UpdateControls()
{
 var popup     = Core_State_Get("activity", ["popup"]);
 var terms     = Core_State_Get("activity", ["data"]);
 var config    = Core_State_Get("activity", ["config"]);
 
 var index     = Core_State_Get("activity", ["index"]);
 var total     = terms.length;
 
 var progress       = UI_Element_Find(popup, "activity-progress");
 var index          = parseInt(index) + 1;
 progress.innerHTML = index + " / " + total;
 
 
 // IN TEST MODE, HIDE "NEXT". NEXT IS MADE AVAILABLE ONLY ON TERM COMPLETION
 if(config["mode"] == "test")
 {
  var next              = UI_Element_Find(popup, "activity-next");	 
  next.style.visibility = "hidden";
 }
 

 if(config["mode"] == "practice")
 {
  // DISABLE "PREV" ON THE FIRST SHEET
  var prev = UI_Element_Find(popup, "activity-prev");
  if(index == 1)
  {
   Document_CSS_SetClass(prev, "style-disabled");
  }
  else
  {
   Document_CSS_UnsetClass(prev, "style-disabled");
  }
 
  // ON THE LAST SHEET, "NEXT" MUST BE FINISH INSTEAD
  Activity_Vocabulary_UpdateLastTerm();
  
 }
 
}




function Activity_Vocabulary_ControlPrev()
{
 var index = Core_State_Get("activity", ["index"]);
 
 if(index > 0) 
 {
  index = index - 1;
  Core_State_Set("activity", ["index"], index);
  
  Activity_Vocabulary_DisplayTerm();
  Activity_Vocabulary_UpdateControls();
 }
}




function Activity_Vocabulary_ControlNext()
{
 var config = Core_State_Get("activity", ["config"]);
 var terms  = Core_State_Get("activity", ["data"]);
 var index  = Core_State_Get("activity", ["index"]);
 var total  = terms.length;
 var term   = terms[index];
 
 // IF IN STUDENT MODE
 if(config["student"]) 
 { 
  // IN ALL OTHER CASES, MOVE FORWARD 
  {
   index = index + 1;
   Core_State_Set("activity", ["index"], index);
  
   Activity_Vocabulary_UpdateControls();
   Activity_Vocabulary_DisplayTerm();
  }

 }
 
 else
 
 // IF NOT IN STUDENT MODE, JUST GO FORWARD
 {
  index = index + 1;
  Core_State_Set("activity", ["index"], index);
  
  Activity_Vocabulary_UpdateControls();
  Activity_Vocabulary_DisplayTerm();
 }
}




async function Activity_Vocabulary_ControlFinish()
{
 await Activity_Vocabulary_Finish();
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                     D O C U M E N T S                                          //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Activity_Documents_Run(source, display, config)
{
 // JUST LOAD DOCUMENT INTO THE IFRAME
 var iframe = UI_Element_Find(display, "document");
 
 // HERE MODE IS USED TO CARRY OVER FILENAME
 var file = config["mode"];
 
 if(Path_Extension(file.toLowerCase()) != "pdf") file = file + ".pdf";
	 
 iframe.src = source + "/" + file;
}




async function Activity_Documents_Finish(player)
{
 var popup = Core_State_Get("activity", ["popup"]); 
 await UI_Popup_Close(popup); 
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                  P R E S E N T A T I O N                                       //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Activity_Presentation_Run(source, display, config)
{	
 // PREV SLIDE
 UI_Element_Find(display, "activity-prev").onclick =
 async function()
 {
  var presentation = Core_State_Get("activity", "presentation");
  
  await Presentation_Slide_Prev(presentation, true, true);
  
  var slide = Presentation_Slide_Current(presentation);
  
  await Presentation_Slide_PlayScripts(slide);
 }
 
 // NEXT SLIDE
 UI_Element_Find(display, "activity-next").onclick =
 async function()
 {
  var presentation = Core_State_Get("activity", "presentation");
  
  await Presentation_Slide_Next(presentation, true, true);
  
  var slide = Presentation_Slide_Current(presentation);
  await Presentation_Slide_PlayScripts(slide);
 }

 
 // LOAD AND SETUP PRESENTATION
 var container    = UI_Element_Find(display, "activity-body");
 var presentation = await Presentation_Load(source);
 Core_State_Set("activity", "presentation", presentation);
 
 Presentation_Assign(presentation, container);
 Presentation_Adapt(presentation);
 
 
 // FIRST SLIDE
 Presentation_Slide_Display(presentation["slides"][0]);
 var slide = Presentation_Slide_Current(presentation);
 Presentation_Slide_PlayScripts(slide);
}




async function Activity_Presentation_Finish(player)
{
 var popup = Core_State_Get("activity", ["popup"]); 
 await UI_Popup_Close(popup); 
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          T E S T                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Activity_Test_Run(source, display, config)
{
 // IF MAGIC PARAMETER IS ON, ACTIVATE CHEATS
 if(Core_Magic())
 {
  Input_Keyboard_Assign(document.body,
  function()
  {
   // SKIP TEST
   if(Input_Keyboard_Pressed(false, [KEY_LCTRL, KEY_RIGHT]))
   {
    Activity_Test_Next();
   }
   
   // FINISH TEST
   if(Input_Keyboard_Pressed(false, [KEY_LCTRL, KEY_PGDN]))
   {
    Activity_Test_Finish();
   }
  });
 }
	
	
 // SET TEST MODULE IN THE DESIRED MODE AND LOAD TEST
 Test_Mode(config["mode"] || "test");
 
 // LOAD NEW TEST OR EXIST TEST
 var test = await Test_Load(source);
 Core_State_Set("activity", "data", test);
 var checkExist = Activity_Get_Testing()
 if(checkExist && config["mode"] == "test")
 {
    test = Activity_Load_ExistTest(test,checkExist);
 }
 
 // IN STUDENT MODE, DO NOT ALLOW GOING BACK
 if(config["student"])
 {
  // DISALLOW GOING BACK
  UI_Element_Find(display, "activity-prev").style.visibility = "hidden";
 }
 

 // FIND WHERE IN THE CONTAINER THE TEST WILL BE DISPLAYED, AND ASSIGN IT
 Test_Assign(test, UI_Element_Find(display, "activity-body"));
 
 
 // SET CURRENT SHEET
 test["index"] = config["sheet"] || test["index"];
 if(test["index"] > test["sheets"].length -1) test["index"] = 0;
 
 if(checkExist && test["index"] == 0  && config["mode"] == "test")
 {
   test["index"] = test["sheets"].length - 1;
   var next      = UI_Element_Find(display, "activity-next");
   next.style.display = "none";
	
   var finish = UI_Element_Find(display, "activity-finish")
   finish.style.display = "flex";
   Document_Element_Animate(finish, "flash 1.5s 1.5");
 }
 
 // SHOW FIRST SHEET
 Activity_Test_UpdateControls();
 Test_Display(test, "practice");
}





async function Activity_Test_Finish()
{
 var test   = Core_State_Get("activity", ["data"]);
 var result = Test_Result(test);

 Core_State_Set("activity", ["result"], result);
 
 var popup = Core_State_Get("activity", ["popup"]); 
 await UI_Popup_Close(popup); 
}





function Activity_Test_UpdateControls()
{
 var test      = Core_State_Get("activity", ["data"]);
 var container = Core_State_Get("activity", ["container"]);
 var config    = Core_State_Get("activity", ["config"]);
 var sheet     = Test_Sheet_Current(test);
 
 var progress       = UI_Element_Find(container, "activity-progress");
 var index          = parseInt(test["index"]) + 1;
 var total          = test["sheets"].length;
 progress.innerHTML = index + " / " + total;
 

 // DISABLE "PREV" ON THE FIRST SHEET
 var prev = UI_Element_Find(container, "activity-prev");
 if(index == 1)
 {
  Document_CSS_SetClass(prev, "style-disabled");
 }
 else
 {
  Document_CSS_UnsetClass(prev, "style-disabled");
 }
  

 // DISABLE "NEXT" ON THE LAST SHEET, IN BROWSING MODE ONLY
 if(!config["student"])
 {
  var next = UI_Element_Find(container, "activity-next");
  if(index == total)
  {
   Document_CSS_SetClass(next, "style-disabled");
  }
  else
  {
   Document_CSS_UnsetClass(next, "style-disabled");
  }
 }
 
}





function Activity_Test_ControlPrev()
{
 var test = Core_State_Get("activity", ["data"]);
 
 Test_Sheet_Prev(test, true);
 
 Activity_Test_UpdateControls();
}



async function Activity_Test_Next()
{
 var config    = Core_State_Get("activity", ["config"]);
 var test      = Core_State_Get("activity", ["data"]);
 var container = Core_State_Get("activity", ["container"]);
 var index     = parseInt(test["index"]) + 1;
 var total     = test["sheets"].length;
 var sheet     = Test_Sheet_Current(test);
 
 await Test_Sheet_Next(test, true);
 Activity_Test_UpdateControls();
}




async function Activity_Test_ControlNext()
{
 var config    = Core_State_Get("activity", ["config"]);
 var test      = Core_State_Get("activity", ["data"]);
 var container = Core_State_Get("activity", ["container"]);
 var index     = parseInt(test["index"]) + 1;
 var total     = test["sheets"].length;
 var sheet     = Test_Sheet_Current(test);

 var next      = UI_Element_Find(container, "activity-next");
 
 // IF IN STUDENT MODE
 if(config["student"]) 
 { 
  
  // IF THERE WAS STILL NO FEEDBACK, GIVE FEEDBACK
  if(typeof sheet["result"] == "undefined")
  {
   // DISABLE INTERACTION
   var popup = Core_State_Get("activity", ["popup"]);
   next.style.visibility = "hidden";
   Document_Element_Disable(popup);
  
   // GET FEEDBACK
   sheet["result"] = await Test_Feedback_CurrentSheet();
   console.log("Sheet Result: ", sheet["result"]);

   // RESTORE INTERACTION
   next.style.visibility = "visible";
   Document_Element_Restore(popup);
   
   // IN TEST MODE, DON'GO FORWARD. REQUIRE ONE MORE CLICK LATER
   if(config["mode"] == "test")
   {
    // UPDATE ACTIVITIES RESULT
    await Activity_Result_Update(); 
    
    // BLINK CONTROL TO SIGNAL THAT THE USER CAN NOW REALLY GO FORWARD
    await Document_Element_Animate(next, "flash 1.5s 1.5");
   }
   else
   // IN OTHER MODES JUST GO FORWARD	   
   {
	Test_Sheet_Next(test, true);
    Activity_Test_UpdateControls(); 
   }
  }
  else
  {
   // ADVANCE
   Test_Sheet_Next(test, true);
   Activity_Test_UpdateControls();
  }
  
  // IF THIS WAS THE LAST TEST TO EVALUATE, HIDE NEXT AND SHOW "FINISH"
  if(index == total)
  {
   next.style.display = "none";
	
   var finish = UI_Element_Find(container, "activity-finish")
   finish.style.display = "flex";
   Document_Element_Animate(finish, "flash 1.5s 1.5");
  }
  
 }
 
 else
 
 // IF NOT IN STUDENT MODE, JUST GO FORWARD
 {
  Test_Sheet_Next(test, true);
  Activity_Test_UpdateControls();
 }
 Test_Enable();
}



async function Activity_Test_ControlFinish()
{
 await Activity_Test_Finish();
}
// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                         V I D E O                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Activity_Video_Run(source, display, config)
{
 var player = await Video_Load(source); 
 Core_State_Set("activity", ["data"], player); 
 
 config["onend"] = Activity_Video_Finish;
 
 Video_Setup(display, player, config);
}




async function Activity_Video_Finish(player)
{
 var terms  = Core_State_Get("activity", ["data"]);
 var config = Core_State_Get("activity", ["config"]);
 
 Core_State_Set("activity", ["result"], {score:1, data:[]});
 
 var popup = Core_State_Get("activity", ["popup"]); 
 await UI_Popup_Close(popup); 
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                   V O C A B U L A R Y                                          //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Activity_Vocabulary_Run(source, display, config)
{
 // IN TEST MODE, HIDE NAVIGATION
 if(config["mode"] == "test")
 {
  UI_Element_Find(display, "activity-prev").style.visibility = "hidden";
  UI_Element_Find(display, "activity-next").style.visibility = "hidden";
 }
 
 // TRICK: USE PARENT DIRECTORY, SO THAT IF WE RUN lessons/xxx/vocabulary  IT ACTUALLY READS FROM lessons/xxx/ THE INFO.DAT FILE
 source = Path_Folder(source);
 
 // SET TEST MODULE IN THE DESIRED MODE AND LOAD TEST
 var terms = await Vocabulary_Terms_Read(source);
 terms     = Object_To_Array(terms, "id");
 
 Core_State_Set("activity", ["data"], terms); 
 Core_State_Set("activity", ["index"], 0);
 
 // UPDATE ACTIVITIES RESULT
 if(config["mode"] == "test")
 {
   var checkExist = Activity_Get_Testing()
   if(checkExist)
   {
      Activity_Load_ExistVocabulary(terms,checkExist);
   }
   else{
      Core_State_Set("activity", ["existed-id"], false);
      await Activity_Result_Update(); 
   }
 } 
 
 // UPDATE CONTAINER CONTROLS 
 Activity_Vocabulary_UpdateControls();
 
 // DISPLAY FIRST TERM
 Activity_Vocabulary_DisplayTerm()
}




async function Activity_Vocabulary_Finish()
{
 var terms  = Core_State_Get("activity", ["data"]);
 var config = Core_State_Get("activity", ["config"]);
 
 var result = Vocabulary_Practice_Result(terms); 
 Core_State_Set("activity", ["result"], result);
 
 var popup = Core_State_Get("activity", ["popup"]); 
 await UI_Popup_Close(popup); 
}




function Activity_Vocabulary_DisplayTerm()
{
 var popup     = Core_State_Get("activity", ["popup"]);
 var terms     = Core_State_Get("activity", ["data"]);
 var config    = Core_State_Get("activity", ["config"]);

 var container = UI_Element_Find(popup, "activity-body");
 var index     = Core_State_Get("activity", ["index"]);
 var term      = terms[index];
 
 Vocabulary_Practice(terms, index, container, {mode:config["mode"], oncomplete:
 function()
 {
  var popup = Core_State_Get("activity", ["popup"]);
  
  var terms = Core_State_Get("activity", ["data"]);
  var index = Core_State_Get("activity", ["index"]);
  
  
  // IF THIS WAS THE LAST TERM, DISPLAY THE FINISH FLAG
  Activity_Vocabulary_UpdateLastTerm();
  
  
 }});
}




function Activity_Vocabulary_UpdateLastTerm()
{
 var popup = Core_State_Get("activity", ["popup"]);
 var terms = Core_State_Get("activity", ["data"]);
 var index = Core_State_Get("activity", ["index"]);

 // IF THIS WAS THE LAST TERM, DISPLAY THE FINISH FLAG
 var finish = UI_Element_Find(popup, "activity-finish");
 var next   = UI_Element_Find(popup, "activity-next");
  
 if(index == terms.length - 1)
 {
  next.style.display   = "none";
  finish.style.display = "flex";
  
  Document_Element_Animate(finish, "flash 1.5s 1.5");  
 }
 else
 // OTHERWISE DISPLAY THE "NEXT" BUTTON
 {
  next.style.visibility = "visible";
   
  //Document_Element_Animate(next, "flash 1.5s 1.5");  
 }
}





function Activity_Vocabulary_UpdateControls()
{
 var popup     = Core_State_Get("activity", ["popup"]);
 var terms     = Core_State_Get("activity", ["data"]);
 var config    = Core_State_Get("activity", ["config"]);
 
 var index     = Core_State_Get("activity", ["index"]);
 var total     = terms.length;
 
 var progress       = UI_Element_Find(popup, "activity-progress");
 var index          = parseInt(index) + 1;
 progress.innerHTML = index + " / " + total;
 
 
 // IN TEST MODE, HIDE "NEXT". NEXT IS MADE AVAILABLE ONLY ON TERM COMPLETION
 if(config["mode"] == "test")
 {
  var next              = UI_Element_Find(popup, "activity-next");	 
  next.style.visibility = "hidden";
 }
 

 if(config["mode"] == "practice")
 {
  // DISABLE "PREV" ON THE FIRST SHEET
  var prev = UI_Element_Find(popup, "activity-prev");
  if(index == 1)
  {
   Document_CSS_SetClass(prev, "style-disabled");
  }
  else
  {
   Document_CSS_UnsetClass(prev, "style-disabled");
  }
 
  // ON THE LAST SHEET, "NEXT" MUST BE FINISH INSTEAD
  Activity_Vocabulary_UpdateLastTerm();
  
 }
 
}




function Activity_Vocabulary_ControlPrev()
{
 var index = Core_State_Get("activity", ["index"]);
 
 if(index > 0) 
 {
  index = index - 1;
  Core_State_Set("activity", ["index"], index);
  
  Activity_Vocabulary_DisplayTerm();
  Activity_Vocabulary_UpdateControls();
 }
}




async function Activity_Vocabulary_ControlNext()
{
 var config = Core_State_Get("activity", ["config"]);
 var terms  = Core_State_Get("activity", ["data"]);
 var index  = Core_State_Get("activity", ["index"]);
 var total  = terms.length;
 var term   = terms[index];
 
 // IF IN STUDENT MODE
 if(config["student"]) 
 { 
  // IN ALL OTHER CASES, MOVE FORWARD 
  {
   index = index + 1;
   Core_State_Set("activity", ["index"], index);
  
   Activity_Vocabulary_UpdateControls();
   Activity_Vocabulary_DisplayTerm();
  }

  // UPDATE ACTIVITIES RESULT
  if(config["mode"] == "test")
  await Activity_Result_Update(); 
 }
 
 else
 
 // IF NOT IN STUDENT MODE, JUST GO FORWARD
 {
  index = index + 1;
  Core_State_Set("activity", ["index"], index);
  
  Activity_Vocabulary_UpdateControls();
  Activity_Vocabulary_DisplayTerm();
 }
}




async function Activity_Vocabulary_ControlFinish()
{
 await Activity_Vocabulary_Finish();
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                         M A N A G E                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Admin_OnLoad(module, data)
{ 
 // CREATE MENU HEADER
 var menus   = Core_Data_Page("admin/menus");
 var allowed = User_Config("admin-functions", "").split(","); 
 
 var items = {};
 for(var key in menus) if(allowed.includes(key))
 {
  items[key]            = {};
  items[key]["text"]    = UI_Language_Object(menus[key]);
  items[key]["icons"]   = [];
  items[key]["onclick"] = Safe_Function("Admin_" + String_Capitalize_Initial(key), function(){});
 }
 
 var header = UI_Header("module-menu", items, {selectfirst:false, css:"color-noted", template:"standard"});
  
 UI_Element_Find(module, "module-header").appendChild(header);
 
 
 
 // CREATE STAFF SUBMENU
 /*
 var items   = {};
 var roles   = User_Config("edit-staff", "").split(",");
 for(var role of roles)
 {
  var item      = [];
  item["icon"]  = "";
  item["text"]  = UI_Language_Object(Core_Config(["roles", role], {}));
  item["state"] = "enabled";
  item["func"]  = Users_Staff_List;
  item["tag"]   = role;

  items[role]   = item;
 }
 var menu = UI_Menu_Create("staff-submenu", items);
 Core_State_Set("users", ["menus", "staff"], menu);
 */
}



async function Admin_OnUnload()
{
}



async function Admin_OnShow(module, data)
{
}






// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                       B O O K I N G                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Admin_Booking()
{
 var display   = await Booking_Search_Display({nohide:true, center:User_Center()}, {});
 
 var container = UI_Element_Find("module-page");
 container.innerHTML = "";
 container.appendChild(display);
}




async function Admin_Courses()
{
 var display   = await Courses_Display();
 
 var container = UI_Element_Find("module-page");
 container.innerHTML = "";
 container.appendChild(display);
}



async function Admin_Lessons()
{
 var display   = await Classes_Search_Display();
 
 var container = UI_Element_Find("module-page");
 container.innerHTML = "";
 container.appendChild(display);
}



async function Admin_Timeoff()
{
 var display   = await Timeoff_Display();
 
 var container = UI_Element_Find("module-page");
 container.innerHTML = "";
 container.appendChild(display);
}




async function Admin_Assessment()
{
 // BASED ON USER ROLE DETERMINE WHAT TO SHOW
 var scope = User_Config("admin-assessment");
 switch(scope)
 {
  case "self":
	var user_id  = User_Id();
	var teachers = false;
  break;
  
  case "center":
	var teachers = await Core_Api("Users_List_ByCenter", {role:["teacher"], center:[User_Center()], fields:"id,firstname,lastname", order:"firstname,lastname"});
	var user_id  = Safe_Get(teachers, [0, "id"], false); // DEFAULT TO FIRST TEACHER IN THE LIST
  break;
  
  case "managed":
	var user_id  = User_Id();
	var teachers = true; // WILL AUTOMATICALLY GET TEACHERS MANAGED BY THE CURRENT USER
  break;
 }
	
	
 var display   = await Assessment_List_Display(user_id, teachers);
 
 var container = UI_Element_Find("module-page");
 container.innerHTML = "";
 container.appendChild(display);
}





async function Admin_Projects()
{
 // BASED ON USER ROLE DETERMINE WHAT TO SHOW
 var scope = User_Config("admin-assessment");
 switch(scope)
 {
  case "self":
	var user_id  = User_Id();
	var teachers = false;
  break;
  
  case "center":
	var teachers = await Core_Api("Users_List_ByCenter", {role:["teacher"], center:[User_Center()], fields:"id,firstname,lastname", order:"firstname,lastname"});
	var user_id  = Safe_Get(teachers, [0, "id"], false); // DEFAULT TO FIRST TEACHER IN THE LIST
  break;
  
  case "managed":
	var user_id  = User_Id();
	var teachers = true; // WILL AUTOMATICALLY GET TEACHERS MANAGED BY THE CURRENT USER
  break;
 }
	
	
 var display   = await Projects_List_Display(user_id, teachers);
 
 var container = UI_Element_Find("module-page");
 container.innerHTML = "";
 container.appendChild(display);
}



async function Admin_Grades()
{
  
 var scope = User_Config("admin-assessment");
 switch(scope)
 {
  case "self":
	var user_id  = User_Id();
	var teachers = false;
  break;
  
  case "center":
	var teachers = await Core_Api("Users_List_ByCenter", {role:["teacher"], center:[User_Center()], fields:"id,firstname,lastname", order:"firstname,lastname"});
	var user_id  = Safe_Get(teachers, [0, "id"], false); // DEFAULT TO FIRST TEACHER IN THE LIST
  break;
  
  case "managed":
	var user_id  = User_Id();
	var teachers = true; // WILL AUTOMATICALLY GET TEACHERS MANAGED BY THE CURRENT USER
  break;
 }
	
 var display   = await Grades_List_Display(user_id, teachers);
 
 var container = UI_Element_Find("module-page");
 container.innerHTML = "";
 container.appendChild(display);
}

async function Admin_Attendance()
{
  var moduleBody = Core_State_Get("core","module-body");
  await Attendance_OnLoad(moduleBody);
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                   A S S E S S M E N T                                          //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Assessment_Assess_Seat(seat_id, sections = {all:true})
{
 // LOAD REQUIRED DATA, INCLUDING STUDENT'S PERFORMANCE OF 5 PAST CLASSES AND PREPARATION FOR THIS ONE
 var data    = await Core_Api("Assessment_Seat_Data", {seat_id, options:{performance:5, preparation:true}});
 var student = Safe_Get(data, ["seat", "student"], {});
 if(student.nickname == null) student.nickname = "";

 console.log(data);
 
 // PROCESS ASSESSMENT JSON
 var assessment = Safe_Get(data, ["seat", "assessment"], "");
 assessment     = Safe_JSON(assessment, {});
 Safe_Set(data, ["seat", "assessment"], assessment);
 
 
 var lesson = Safe_Get(data,["lesson"],"");
 var class_type = lesson["info"]["type"];

 // CREATE PAGE 
 if(class_type == "placement")
 {
  const date = Date_Now();
  student["age"] = Date_Distance(student["birthdate"], date, "years");
  student["birthdate"] = Date_Get(student["birthdate"],["day","month","year"]);
  var page = Assessment_Page("placement", {student:student});
  var seat = Safe_Get(data, ["seat"], {});
  Document_Element_SetObject(page, "data", data); 


  // STUDENT INFO
  var element = UI_Element_Find(page, "picture");
  User_Picture_Load(element, student);
 }
 else
 {
  var page = Assessment_Page("seat", {student:student});
  var seat = Safe_Get(data, ["seat"], {});
  Document_Element_SetObject(page, "data", data); 


  // STUDENT INFO
  var element = UI_Element_Find(page, "picture");
  User_Picture_Load(element, student);


  // PAST PERFORMANCE CHART
  var borderColor     = Document_CSS_GetVariable("color-noted");
  var backgroundColor = Color_Hex_ToRGBA(Document_CSS_GetVariable("color-noted"), 0.5);

  var set    = Safe_Get(data, ["performance"]);
  var labels = Array(set.length).fill("");

  var chart  = UI_Chart_Lines(labels,
  // DATA
  [
  {data:set, borderColor, backgroundColor, fill:true}, 
  ],

  // OPTIONS
  {
  interpolation : true,
  min           : 0,
  max           : 5
  },

  // Y FORMATTER
  Assessment_Chart_FormatAxis); 


  UI_Element_Find(page, "chart-recentclasses").appendChild(chart);

  UI_Element_Find(page, "title-recentclasses").innerHTML = UI_Language_String("assessment/preparation", "recentclasses title", {n:set.length});



  // SELF PREPARATION CHART
  var sets        = [];
  var preparation = data["preparation"] || {};
  for(var key in preparation)
  {
  var set = {};

  var score              = preparation[key];
  var color              = Assessment_Grade_Display(score, "color");
  var label              = UI_Language_String("assessment/preparation", key + " label");

  set["label"]           = label;
  set["data"]            = [score];
  set["borderColor"]     = color;
  set["backgroundColor"] = Color_Hex_ToRGBA(color, 0.5);

  sets.push(set);
  }

  var chart = UI_Chart_Bars(sets, {min:0, max:1});
  UI_Element_Find(page, "chart-studymaterials").appendChild(chart);

  UI_Element_Find(page, "title-studymaterials").innerHTML = UI_Language_String("assessment/preparation", "materials title");
 
 }

 // OUTCOMES ETC. 
 var content  = UI_Element_Find(page, "content");


 // 1. ATTENDANCE
 if(sections["attendance"] || sections["all"])
 {
  // SECTION
  var caption = UI_Language_String("assessment/assess", "section attendance"); 
  var section = Assessment_Section("attendance");
  var items   = UI_Element_Find(section, "items");
  content.appendChild(section);
  
  // ATTENDANCE
  var item    = Assessment_Item("attendance", "select", seat, Assessment_Record_SeatField);
  items.appendChild(item);
 }
 
 console.log(data);
 
 // 2. OUTCOMES AND SKILLS
 if(sections["outcomes"] || sections["all"])
 {
  var assessment = Safe_Get(data, ["seat", "assessment"]);  
  //hide core skills if lesson type != placement
  var type = Safe_Get(data, ["lesson", "info","type"],"standard");
  var categories = ["outcomes"];
  if(type == "placement") categories.push("core skills")

  for(var category of categories)
  {
   var outcomes = Safe_Get(data, ["lesson", category], {});
  
   if(outcomes && Object.keys(outcomes).length > 0)
   {
    // SECTION
	var caption = UI_Language_String("assessment/assess", "section " + category); 
    var section = Assessment_Section(category, outcomes, assessment, Assessment_Record_Outcome);
   
    content.appendChild(section);
   }
  }
 
 }
 
 // 2.1 HYBRID ASSESSMENTS
 if(sections["test"] || sections["all"])
 {

  var tests = Safe_Get(data,["lesson", "test"]);
  
    if(tests && tests["type"])
    {
      var testtype = tests["type"];

      // SECTION
      var caption = UI_Language_String("assessment/assess", "section " + testtype);
      var section = Hybrid_Assessment_Section(testtype, tests, assessment, Assessment_Record_Outcome,"edit-range");
   
     content.appendChild(section);
    }
 
 }
 
 // 3. FEEDBACK AND BEHAVIOR
 if(sections["feedback"] || sections["all"])
 {
  var section = Assessment_Section("feedback");
  var items   = UI_Element_Find(section, "items");
  content.appendChild(section);
   
  var item    = Assessment_Item("behavior", "select", seat, Assessment_Record_SeatField);
  items.appendChild(item);
  
  var item    = Assessment_Item("feedback", "text", seat, Assessment_Record_SeatField);
  items.appendChild(item);
 }
 
 
 return page;
}




async function Assessment_Class_Display(class_id, options = {})
{
 var display = UI_Table();
 
 
 // LOAD CLASS WITH SEATS
 var classdata = await Classes_Load(class_id, {seats:true, users:true});
 
 // LOAD LESSON
 var lesson_id = Safe_Get(classdata, ["info", "lesson_id"], "null");
 var lesson    = await Lesson_Load(lesson_id, {all:true});

 // ASSESSABLES
 var outcomes = lesson["outcomes"]    || {};
 var skills   = lesson["core skills"] || {};
 // DOAN NHAT NAM 19/01/2024: UPDATE JUST LESSON HAVE TYPE = “placement” CAN SHOW SKILL
 var lessonType = Safe_Get(lesson, ["info", "type"], Safe_Get(classdata, ["info", "type"], "null"));
 if(lessonType != "placement") skills = {};
 
 console.log(classdata);
 console.log(lesson);
 
 
 var table = UI_Table("standard", {fixed:true});
 
 // HEADER
 var row = UI_Table_Row(table, {fixed:true});
 
 // STUDENT
 var cell       = UI_Table_Cell(row, {type:"header"});
 cell.innerHTML = "";
 
 // OUTCOMES
 for(var id in outcomes)
 {
  var outcome    = outcomes[id]    || {};
  var info       = outcome["info"] || {};
  var text       = UI_Language_Object(info, id);
  
  var cell       = UI_Table_Cell(row, {type:"header"});
  cell.innerHTML = text;
 }
 
 // SKILLS
 for(var id in skills)
 {
  var skill      = skills[id]    || {};
  var info       = skill["info"] || {};
  var text       = UI_Language_Object(info, id);
  
  var cell       = UI_Table_Cell(row, {type:"header"});
  cell.innerHTML = text;
 }
 
 // BEHAVIOR
 var cell       = UI_Table_Cell(row, {type:"header"});
 cell.innerHTML = UI_Language_String("assessment/assess", "item behavior");
 
 // ATTENDANCE
 var cell       = UI_Table_Cell(row, {type:"header"});
 cell.innerHTML = UI_Language_String("assessment/assess", "item attendance");
 

 
 // FOR EACH SEAT
 var seats = classdata["seats"] || [];
 for(var seat of seats)
 {
  var row = UI_Table_Row(table);
  
  seat["assessment"] = Safe_JSON(seat["assessment"], {});
  
  // STUDENT INFO
  var student = seat["student"] || {};
  
  var element = UI_Element_Create("assessment/class-cell-student");
  var name    = [student["firstname"] || "", student["lastname"] || ""].join(" ").trim();
  if(Boolean(student["nickname"])) 
    name = name + "(" + student["nickname"] + ")";
  UI_Element_Find(element, "name").innerHTML = name;
  
  User_Picture_Load(UI_Element_Find(element, "picture"), student);
    
  element.dataset.studentId = student["id"];
  element.style.cursor = "pointer";
  element.onclick = async (e) => { 
    await User_View_Popup(e.currentTarget.dataset.studentId,{css:"background-color: var(--color-alt-2);"});
  } 
  
  var cell = UI_Table_Cell(row);
  cell.appendChild(element);
  
  
  
  // FOR EACH OUTCOME
  for(var id in outcomes)
  {
   var outcome    = outcomes[id]    || {};
  
   var select  = UI_Element_Create("core/control-dropdown-small");
   Document_Select_AddOption(select, "", "");
   for(var value = 1; value <= 5; value++)
   {
	var scale = outcome["lv " + value] || {};
	var text  = value + " / " + UI_Language_Object(scale, value);
    Document_Select_AddOption(select, text, value);
   }
   
   Document_Element_SetData(select, "seat", seat["id"]);
   Document_Element_SetData(select, "field", id);
   Document_Element_SetData(select, "type", "assessment");
   
   select.value    = Safe_Get(seat, ["assessment", id]);
   select.onchange = Assessment_Class_UpdateSeat;
   
   var cell = UI_Table_Cell(row);
   cell.appendChild(select);
  }
  
  
  // FOR EACH SKILL
  for(var id in skills)
  {
   var skill = skills[id];
   
   var select  = UI_Element_Create("core/control-dropdown-small");
   Document_Select_AddOption(select, "", "");
   for(var value = 1; value <= 5; value++)
   {
	var scale = skill["lv " + value] || {};
	var text  = value + " / " + UI_Language_Object(scale, value);
    Document_Select_AddOption(select, text, value);
   }
   
   Document_Element_SetData(select, "seat", seat["id"]);
   Document_Element_SetData(select, "field", id);
   Document_Element_SetData(select, "type", "assessment");
   
   select.value    = Safe_Get(seat, ["assessment", id]);
   select.onchange = Assessment_Class_UpdateSeat;
   
   var cell = UI_Table_Cell(row);
   cell.appendChild(select);
  }
  

  // BEHAVIOR
  var select  = UI_Element_Create("core/control-dropdown-small");
  Document_Select_AddOption(select, "", "");
  UI_Select_FromDatapage(select, "assessment/behavior");
  
  Document_Element_SetData(select, "seat", seat["id"]);
  Document_Element_SetData(select, "field", "behavior");
  Document_Element_SetData(select, "type", "seat");
  
  select.value    = seat["behavior"];
  select.onchange = Assessment_Class_UpdateSeat;
  
  var cell = UI_Table_Cell(row);
  cell.appendChild(select);
  
  
  
  // ATTENDANCE
  var select  = UI_Element_Create("core/control-dropdown-small");
  Document_Select_AddOption(select, "", "");
  UI_Select_FromDatapage(select, "assessment/attendance-short");
  
  Document_Element_SetData(select, "seat", seat["id"]);
  Document_Element_SetData(select, "field", "attendance");
  Document_Element_SetData(select, "type", "seat");
  
  select.value = seat["attendance"];
  select.onchange = Assessment_Class_UpdateSeat;
  
  var cell = UI_Table_Cell(row);
  cell.appendChild(select);
 }
 
 if(options["popup"])
 {
  var popup = await UI_Popup_Create({content:table}, [], "assessment/class-popup", {escape:true, open:true});
  
  return popup;
 }
 else
 {
  return table;
 }
}




async function Assessment_Class_UpdateSeat(event)
{
 var element = event.currentTarget;
 var id      = Document_Element_GetData(element, "seat");
 var type    = Document_Element_GetData(element, "type");
 var field   = Document_Element_GetData(element, "field");
 var value   = element.value;
 
 console.log("Update ", id, type, field, value);
 
 if(!isNaN(parseInt(value))) value = parseInt(value);

 switch(type)
 {
  case "seat":
	await Core_Api("Class_Seat_SetField", {id, field, value});
  break;
  
  case "assessment":
	await Core_Api("Assessment_Outcome_Store", {table:"classes_seats", id, field, value}); 
  //AUTO SET SKILL IF SET OUTCOME
  await Assessment_CoreSkill_Update(id,field,value)
  break;
 }
 
 // SYNC ASSESSMENT, ATTENDANCE AND BEHAVIOR FOR SEATS THAT ARE SOMEHOW "CONNECTED" TO THIS ONE (COURSE / SESSION)
 Core_Api("Class_Seats_Sync", {id});
}




async function Assessment_CoreSkill_Update(id,field,value)
{
  var outcomes = Core_State_Get("classes", ["preview", "lesson", "outcomes"],{});
  if(field in outcomes)
  {
    var skill = Safe_Get(outcomes, [field, "cefr","skill"], "");
    if(skill != "")
    {
      var sum = Number.parseFloat(value);
      var count = 1;
      var data = Core_State_Get("classes", ["preview","class"], {});
      var currentmodule = Core_State_Get("core", "module","home");
      if(currentmodule == "classroom") data = Core_State_Get("classroom", "class", {});

      var seats = Safe_Get(data, "seats", []);
      var seat = seats.find(o => o.id === id);
      var assessment     = Safe_JSON(seat.assessment ?? {}, {}); 
      assessment[field] = value;

      //GET ALL OUTCOME HAS SAME SKILL
      for (let key in outcomes) {
        if(key != field)
        {
          let outcomeskill = Safe_Get(outcomes, [key, "cefr","skill"], "");
          if(outcomeskill == skill){
            let outcomevalue = assessment[key];
            count++;
            sum += Number.parseFloat(outcomevalue);
          } 
        } 
      }
      value = (sum*1.0/count).toString();

      if(!isNaN(parseFloat(value))) value = parseFloat(value);

      await Core_Api("Assessment_Outcome_Store", {table:"classes_seats", id, field:skill, value}); 

      //UPDATE ASSESSMENT SEATS
      assessment[skill] = value;
      seats.forEach(ob => {
        if(ob.id == id) ob.assessment = JSON.stringify(assessment);
      });
      Core_State_Set("classes",["preview","class","seats"],seats);
      if(currentmodule == "classroom") Core_State_Set("classroom",["class","seats"],seats);
    } 
  } 
}
// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      E L E M E N T S                                           //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Assessment_Page(template, data)
{
 var student = Safe_Get(data, ["student"], {});
 
 var page    = UI_Element_Create("assessment/page-" + template, student);
 
 return page;
}





function Assessment_Section(category, outcomes, assessment, onchange)
{
 assessment  = assessment || {};
 
 var caption = UI_Language_String("assessment/assess", "section " + category); 
 caption     = caption.replace("section", ""); // TRICK: IF "section" APPEARS IN THE STRING, IT MEANS A STANDARD ONE WAS NOT FOUND. SO WE INTERPRET "CATEGORY" AS THE INTENDED CAPTION
 
 var section = UI_Element_Create("assessment/section", {caption});
 Document_Element_SetData(section, "uid", "section-" + category);
 
 // DISPLAY A ROW FOR EACH ONE OF THE PROVIDED OUTCOMES
 
 if(outcomes)
 {
  var items    = UI_Element_Find(section, "items");
  for(var id in outcomes)
  {
   // GET OUTCOME INFO
   var outcome = outcomes[id];
   var info    = Safe_Get(outcome, ["info"], {});
  
   // CREATE ROW
   var item    = Assessment_Item(id, "select", assessment, onchange, {fill:false, caption:info});
   var select  = UI_Element_Find(item, id);
  

   // POPULATE ROW SELECT WITH OUTCOME SCORES
   Document_Select_AddOption(select, "", "");
	  
   var scores = Object_Subset(outcome, "lv");
   for(var score in scores)
   {
    var value  = String_Filter_AllowDigits(score);
   
    var option = outcome[score];   
    var text   = value + " / " + UI_Language_Object(option);
   
    Document_Select_AddOption(select, text, value, option);
   }
 
   select.value = assessment[id];

   section.appendChild(item);
  }
 }
 
 return section;
}


function Hybrid_Assessment_Section(category, outcomes, assessment, onchange, itemtype="edit-number")
{
 assessment  = assessment || {};
 
 var caption = UI_Language_String("assessment/assess", "section " + category); 
 caption     = caption.replace("section", ""); // TRICK: IF "section" APPEARS IN THE STRING, IT MEANS A STANDARD ONE WAS NOT FOUND. SO WE INTERPRET "CATEGORY" AS THE INTENDED CAPTION
 
 var section = UI_Element_Create("assessment/section", {caption});
 Document_Element_SetData(section, "uid", "section-" + category);
 
 // DISPLAY A ROW FOR EACH ONE OF THE PROVIDED OUTCOMES
 
 if(outcomes)
 {
  var items = '';
  for(var id in outcomes)
  {
   
   //By pass test type
   if(id == "type")
      continue;

   // GET OUTCOME INFO
   items = UI_Language_String("assessment/assess", "item " + id) + ', ' + items;

   
  }
  var countoutcomes = Object.keys(outcomes).length;

  if(countoutcomes > 1){
    var pos = items.lastIndexOf(',');
    items = items.substring(0,pos) + items.substring(pos+1);
  }

  if(countoutcomes > 2){
    var pos = items.lastIndexOf(',');
    items = items.substring(0,pos) + ' ' + UI_Language_String("assessment/assess", "readable assessment and") + items.substring(pos+1);
  }

  items = UI_Language_String("assessment/assess", "readable assessment hybrid",{text:items});
  var item = UI_Element_Create("assessment/display-assessment-item", {id:category,text:items});
  Document_Element_SetObject(item);
  section.appendChild(item);
 }
 
 return section;
}


function Assessment_Item(id, type = "select", data, onchange, options = {fill:true})
{
 data = data || {};
	
 // IF CAPTION IS SPECIFIED AS A LANGUAGE OBJECT...
 if(options["caption"])
 {
  var caption = UI_Language_Object(options["caption"]);
 }
 else
 // OTHERWISE, GET THE CAPTION FROM STANDARD ASSESSMENT INFO
 {
  var caption = UI_Language_String("assessment/assess", "item " + id); 
 }
 
 
 // CREATE ITEM (ROW) AND LINK IT TO THE DATA IT ALTERS
 var item = UI_Element_Create("assessment/item-" + type, {id:id, caption:caption});
 Document_Element_SetObject(item, "data", data);



 // ITEM CONTROL (SELECT, TEXT, ETC.)
 var control = UI_Element_Find(item, id);
 if(control)
 {
 
  if(type == "select" & options["fill"])
  {
   Document_Select_AddOption(control, "", "");
   UI_Select_FromDatapage(control, "assessment/" + id); 
  } 
 
  // SET CURRENT DATA VALUE
  if(data) 
  {
   control.value = data[id];
  }
  
  // CONTROL ONCHANGE 
  if(onchange) control.onchange = onchange;
 }


 return item;
}







// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                       E V E N T S                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Assessment_Record_SeatField(event)
{
 var select = event.currentTarget;
 var page   = Document_Element_FindParent(select, "uid", "page");
 var data   = Document_Element_GetObject(page, "data");
 var seat   = data["seat"] || {};

 var field  = Document_Element_GetData(select, "uid");
 var value  = select.value;
 
 // STORE IN DB
 await Core_Api("Class_Seat_SetField", {id:seat["id"], field:field, value:value}); 
 
 // SYNC ASSESSMENT, ATTENDANCE AND BEHAVIOR FOR SEATS THAT ARE SOMEHOW "CONNECTED" TO THIS ONE (COURSE / SESSION)
 Core_Api("Class_Seats_Sync", {id:seat["id"]});
 
 // STORE IN LOCAL DATA
 Safe_Set(seat, [field], value);
}




async function Assessment_Record_Outcome(event)
{
 var select     = event.currentTarget;
 var page       = Document_Element_FindParent(select, "uid", "page");
 var data       = Document_Element_GetObject(page, "data");
 
 var seat_id    = Safe_Get(data, ["seat", "id"]); 
 var outcome_id = Document_Element_GetData(select, "uid");
 var value      = select.value;
 
 if(!isNaN(parseInt(value))) value = parseInt(value);

 // STORE IN DB 
 await Core_Api("Assessment_Outcome_Store", {table:"classes_seats", id:seat_id, field:outcome_id, value}); 
 //AUTO SET SKILL IF SET OUTCOME
 await Assessment_CoreSkill_Update(seat_id,outcome_id,value)

 // SYNC ASSESSMENT, ATTENDANCE AND BEHAVIOR FOR SEATS THAT ARE SOMEHOW "CONNECTED" TO THIS ONE (COURSE / SESSION)
 Core_Api("Class_Seats_Sync", {id:seat_id});
 
 // UPDATE LOCALLY CACHED DATA
 Safe_Set(data, ["seat", "assessment", outcome_id], value);
}









// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      R E P O R T I N G                                         //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



function Assessment_Grade_Display(value, what = "text")
{
 var grades = Core_Data_Page("assessment/grades");
 var keys   = Object.keys(grades);
 
 // FIX IT
 if(value < 0) value = 0; if(value > 1) value = 1;
 
 for(var key of keys)
 {
  var v         = String_Filter_AllowDigits(key);
  var threshold = Module_Config("assessment", "grade-" + v, 0);
  
  if(value >= threshold)
  {
   var data = Core_Data_Section("assessment/grades", "grade " + v);	 
   
   switch(what)
   {
	case "color":
		var color = Document_CSS_GetVariable("color-" + data["color"]);
		
		return color;
	break;
	
    case "text":
		var text = UI_Language_Object(data);
		
		return text;
	break;
	
	case "data":
	
		return data;
	break;
   }
   
  }
 }
}





function Assessment_Report_Grade(assessment, fields = false)
{
 if(!fields) var values = assessment;
 else
 {
  var values = {};
  for(var field of fields) values[field] = assessment[field];
 }

 var average = Object_Values_Average(values);
 
 return average;
}




function Assessment_Category_Transcribe(category, assessment, threshold = 3)
{
 var parts = {good:[], bad:[]};
 
 // SEPARATE GOOD FROM BAD OUTCOMES ACCORDING TO THRESHOLD
 for(var outcome_id in category)
 {
  for(var assessment_id in assessment)
  {
   if(assessment_id == outcome_id)
   {
    var value = assessment[assessment_id];
    var info  = Safe_Get(category, [assessment_id, "lv " + value]);
    var text  = UI_Language_Object(info);
    
	if(text)
	{
     if(value < threshold) parts["bad"].push(text); else parts["good"].push(text);
	}
	
   }
  }
 }

 
 // DECODE
 var paragraphs = [];
 var person     =  UI_Language_String("assessment/assess", "readable assessment you");
   
   
 // PUT TOGETHER THE GOOD FIRST, THEN THE BAD. ADD A "," BETWEEN PARTS, "AND" ON THE LAST
 for(var category of ["good", "bad"])
 {
  var text      = "";
  var tokens    = parts[category];
  
  for(var i = 0; i<tokens.length; i++)
  {
   text = text + tokens[i];
  
   if(i == tokens.length - 2)
   {
    text = text + " " + UI_Language_String("assessment/assess", "readable assessment and") + " ";
   }
   else
   if(i < tokens.length - 1)
   {
    text = text + ", ";
   }
  }
  
  
  // IF AT LEAST ONE LINE OF TEXT, ADD PARAGRAPH
  if(text != "") 
  {
   paragraphs.push(
   {
	category: category, 
	text:     person + " " + text
   });
  }
  
 }

 
 // ASSEMBLE GOOD AND BAD 
 switch(paragraphs.length)
 {
  case 0:
	var text = "";
  break;
 
  case 1: 
	// ONLY GOOD OR ONLY BAD
    var text = String_Capitalize_Initial(paragraphs[0]["text"]);
  break;
 
  default:
    // GOOD AND BAD
    var however = UI_Language_String("assessment/assess", "readable assessment however");
    var text    = String_Capitalize_Initial(paragraphs[0]["text"]) + ". " + String_Capitalize_Initial(however) + ", " + paragraphs[1]["text"];
  break;
 }
 
 return text;
}




function Assessment_Report_Transcribe(outcomes, assessment, more = {}, threshold = 3)
{
 var paragraphs = [];
 
 // BEHAVIOR DATA, IF AVAILABLE
 var parts = [];
 
 if(more["behavior"])
 {
  var behavior = more["behavior"];
  var text     = UI_Language_String("assessment/behavior", behavior);  
  text         = text.toLowerCase();
  text         = UI_Language_String("assessment/assess", "readable assessment behavior", {text});
  
  parts.push(text);  
 }
 
 if(more["attendance"])
 {
  var attendance = more["attendance"];
  
  var text       = UI_Language_String("assessment/attendance", attendance);  
  text           = text.toLowerCase();
  text           = UI_Language_String("assessment/assess", "readable assessment attendance", {text});
  
  // IF THE CLASS WAS MISSED, STOP HERE. JUST RETURN THE "MISSED CLASS" TEXT.
  if(attendance == "miss") return text;
  
  parts.push(text);  
 }
 
 // BEHAVIOR OR ATTENDANCE ONLY
 if(parts.length == 1)
 {
  paragraphs.push(parts[0]);
 }
 else
 // ATTENDANCE AND BEHAVIOR
 if(parts.length == 2)
 {
  var timely    = (attendance == "yes");
  var attentive = (parseInt(String_Filter_AllowDigits(behavior)) >= 3);
 
  // TIMELY AND ATTENTIVE
  if(timely && attentive)   var connector  = "and";
  
  // TIMELY BUT NOT ATTENTIVE
  if(timely && !attentive)  var connector  = "but";
  
  // LATE BUT ATTENTIVE
  if(!timely && attentive)  var connector  = "however";
	  
  // LATE AND NOT ATTENTIVE
  if(!timely && !attentive) var connector = "and";
  
  var text = parts[1] + ", " + UI_Language_String("assessment/assess", "readable assessment " + connector) + " " + parts[0].toLowerCase();
  paragraphs.push(text);
 }
 
 
 
 // ONE PARAGRAPH PER CATEGORY (OUTCOMES, CORE SKILLS, EXTRA SKILLS, ETC. ...)
 for(var id in outcomes)
 { 
  var category = outcomes[id];
  
  var text = Assessment_Category_Transcribe(category, assessment, threshold)
  
  if(text.trim()) paragraphs.push(text);
 }



 // EXPLICIT FEEDBACK
 if(more["feedback"])
 {
  var text = more["feedback"].trim();
  text     = String_Capitalize_Initial(text);
  
  if(text) paragraphs.push(text);
 }


 
 // OVERALL GRADING
 var grade = Assessment_Report_Grade(assessment);
 grade     = Math.floor(grade);
 
 if(grade < 1 || isNaN(grade))
 {
  // NOT GRADED YET
 }
 else
 {
  grade    = UI_Language_String("assessment/grades", "grade " + grade);
  var text = String_Capitalize_Initial(UI_Language_String("assessment/assess", "readable assessment grading")) + ": " + grade.toUpperCase();
  
  paragraphs.push(text);
 }
  
 
 // JOIN ALL PARAGRAPHS
 for(var i in paragraphs) paragraphs[i] += ". ";
 var text = paragraphs.join("<br><br>");	
 
 
 // FINAL CLEANUP
 text = text.trim();
 
 if(text == "") text = UI_Language_String("assessment/assess", "assessment nothing");
 
 return text; 
}




function Assessment_Report_ChartData(items, thresholdspage, options = {emptysets:false})
{
 var chartdata  = [];
 
 var page       = Core_Data_Page(thresholdspage);
 var thresholds = Object_To_Pairs(page, "threshold");
 
 var catalog    = Object_Catalog_ByNumericValue(items, "score", thresholds);
 var keys       = Object.keys(thresholds);
 keys           = keys.reverse();
 
 for(var key of keys)
 {
  var datapoint      = {};
  var points         = catalog[key] || [];
  
  if(points.length > 0 || options["emptysets"])
  {
   datapoint["value"] = points.length;
   datapoint["color"] = Document_CSS_GetVariable("color-" + key);
   datapoint["label"] = UI_Language_String(thresholdspage, key);
   
   chartdata.push(datapoint);
  }
 }
 
 return chartdata;
}




function Assessment_Chart_FormatAxis(value)
{  
 var string = "grade " + value;
 
 if(UI_Language_Exists("assessment/grades", string)) 
 {
  var text = UI_Language_String("assessment/grades", string); 
 }
 else 
 {
  var text = ""; 
 }
  
 return text;
}





function Assessment_Display_Score(container, score)
{ 
 // UNDEFINED SCORE = NOT SCORED YET
 if(typeof score == "undefined")
 {
  var score   = 0;
  var disable = true;
 }
 else
 {
  var disable = false;
 }
 
 
 // DISPLAY STARS
 for(var i = 1; i<=5; i++)
 {
  if(i <= score) var template = "full"; else var template = "empty";
  var point = UI_Element_Create("assessment/point-" + template);
  
  if(disable) Document_Element_Disable(point, "style-disabled");  

  container.appendChild(point);
 }
}




function Assessment_Display_Assessment(category, outcomes, assessment)
{
 var row            = UI_Element_Create("assessment/display-assessment");
 
 // COVER PICTURE
 var element        = UI_Element_Find(row, "cover");
 if(element)
 {
  var url           = Resources_URL("images/cover-" + category + ".jpg");
  var fallback      = Resources_URL("");
  Document_Image_Load(element, [url, fallback]);
  
  // COVER CAPTION
  var element       = UI_Element_Find(row, "caption");
  element.innerHTML = UI_Language_String("assessment/display", category);
 }
 
 
 // OUTCOMES
 var container = UI_Element_Find(row, "outcomes");
 for(var id in outcomes)
 { 
  var outcome = outcomes[id];
  var text    = String_Capitalize_Initial(UI_Language_Object(outcome["info"]));
    
  var score   = assessment[id];
  var item    = UI_Element_Create("assessment/display-assessment-item", {text}); 
  var points  = UI_Element_Find(item, "score");
  Assessment_Display_Score(points, score);
  
  container.appendChild(item);  
 } 
 
 return row;
}





function Assessment_Display_Feedback(teacher_id, text)
{
 var row        = UI_Element_Create("assessment/display-feedback"); 
 UI_Element_Find(row, "teacher-assessment").innerHTML = text;
 
 var picture  = UI_Element_Find(row, "teacher-picture");
 User_Picture_Load(picture, teacher_id, "teacher");
 
 return row;
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                             A S S E S S M E N T  /  L I S T                                    //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Assessment_List_Display(teacher_id, managed = false)
{
 // IF SPECIFIC TEACHER AND TEACHER NOT CURRENT USER, LOAD IT
 if(teacher_id && teacher_id != User_Id()) 
 { 
  var user = await Core_Api("User_Read", {user_id:teacher_id, options:{fields:"id,firstname,lastname"}});
 }
 else
 {
  var user = await Core_User();
 }
 
 
 // CREATE DISPLAY
 var display = UI_Element_Create("assessment/list-display");
 Core_State_Set("assessment", "list-display", display);
 
 
 // IF LIST OF MANAGED TEACHERS, SHOW SELECTOR
 if(managed)
 {  
  // IF IT'S NOT A LIST BUT JUST A "TRUE" FLAG, BUILD THE LIST BY CALLING API
  if(typeof managed != "object")
  {
   var managed = await Core_Api("Users_List_ByManager", {manager_id:user["id"], fields:"id,firstname,lastname"});
  }

  var selector = UI_Element_Find(display, "selector");
  var select   = UI_Element_Find(selector, "teachers");
  
  // ADD MAIN USER TO THE LIST
  var name = [user["firstname"] || "", user["lastname"] || ""].join(" ").trim();
  Document_Select_AddOption(select, name, user["id"]);
  
  for(var teacher of managed)
  {
   var name = [teacher["firstname"] || "", teacher["lastname"] || ""].join(" ").trim();
   Document_Select_AddOption(select, name, teacher["id"]);
  }
  
  select.value = user["id"];
  
  select.onchange = 
  function()
  {
   Assessment_List_Teacher(select.value);
  }
  
  selector.style.display = "flex";
 }
 
 await Assessment_List_Teacher(user["id"]);


 return display;
}




async function Assessment_List_Teacher(teacher_id)
{
 var display = Core_State_Get("assessment", "list-display");
  
 // HIDE DETAIL VIEW
 UI_Element_Find(display, "detail").style.visibility = "hidden";


 // GET CLASS ASSESSMENT DATA
 var period     = parseInt(User_Config("admin-days", -30));
 var date_from  = Date_Portion(Date_Add_Days(Date_Now(), period), "no-seconds");
 var date_to    = Date_Portion(Date_Now(), "no-seconds");
 var data       = await Core_Api("Assessment_Status", {teacher_id, date_from, date_to, options:{incomplete:true}});


 // PROCESS DATA
 
 // SECTION
 for(var item of data) 
 {
  item["period"] = Date_Format_Period(Date_Now(), item["date_start"], {locale:UI_Language_Current(true), conversational:true});
 }
 
 // SORT BY DATE AND CLASS ID
 data.sort(
 function(a, b)
 {
  if(a["date_start"] < b["date_start"]) return 1;
  else
  if(a["date_start"] > b["date_start"]) return -1;
  else
  {
   if(a["class_id"] < b["class_id"]) return 1;
   else
   if(a["class_id"] > b["class_id"]) return -1;
   else   
   return 0;
  }
 });
 
 
 // ASSEMBLE DISPLAY
 var list = UI_List_Items(data, ["style-outlined-accented", "outline-inner"], Assessment_List_Seat, {style:"vertical", overflow:true, sections:"period"},
 
 // ITEMS
 function(item)
 {  
  var locale      = UI_Language_Current(true);
  var info        = {};
  info["date"]    = Date_Format(item["date_start"], locale, "date-shortmonth-weekday-noyear") + ", " + Date_Format(item["date_start"], locale, "time-only");
  info["lesson"]  = item["lesson_id"];
  info["student"] = Safe_Get(item, ["student", "nickname"],"") != "" ? Safe_Get(item, ["student", "nickname"],"") : [Safe_Get(item, ["student", "firstname"], ""), Safe_Get(item, ["student", "lastname"], "")].join(" ").trim();
 
  info["todo"]    = UI_Language_String("assessment/list", "todo") + " ";
  for(var token of item["todo"] || [])
  {console.log(token);
   var icon     = Core_Data_Value("assessment/categories", token, "icon");
   var title    = UI_Language_String("assessment/categories", token);
   
   info["todo"] = info["todo"] + "<li class = 'fa fa-" + icon + "' title = '" + title + "'></li>";
  }
 
  var element = UI_Element_Create("assessment/list-item", info);  
  Document_Element_SetObject(element, "item", item);
  
  return element; 
 },
 
 // SECTIONS
 function(section, item)
 {
  var element = UI_Element_Create("assessment/list-section", {period:section.toUpperCase()});  
  return element;
 });
 


 // DISPLAY LIST 
 var container       = UI_Element_Find(display, "list");
 container.innerHTML = "";
 container.appendChild(list);
}




async function Assessment_List_Seat(element)
{
 var item            = Document_Element_GetObject(element, "item");
 var display         = Core_State_Get("assessment", "list-display");
  
 var page            = await Assessment_Assess_Seat(item["id"]);
 
 var container       = UI_Element_Find(display, "detail");
 container.innerHTML = "";
 container.appendChild(page);
 
 container.style.visibility = "visible";
}// -----------------------------------------------------------------------------------------------//Attendance_Courses
//                                                                                                //
//                                   A T T E N D A N C E                                          //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Attendance_OnLoad(module, data)
{
  var page = await Attendance_Courses_Display();
  
  var module = UI_Element_Find(module, "module-page"); 
  module.innerHTML = "";
  module.appendChild(page);
}


async function Attendance_OnShow(module, data)
{
}


async function Attendance_OnUnload()
{
}


// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          M O R E                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Attendance_Courses_Display(options = {})
{
 var display = UI_Element_Create("attendance/display");
 Core_State_Set("admin", ["attendance","display"], display);
 
 // ALL CENTERS
 var centers = Array_Organize_ByField(Centers_Available(), "id");
 
 // STORED SEARCH, IF ANY
 var search  = Core_State_Get("admin",["attendance", "search"], {});
 
 // DETERMINE AND STORE CENTERS AVAILABLE TO ME
 Core_State_Set("admin", ["attendance","centers"], centers);
  
  
 // CENTERS SELECT
 var select = UI_Element_Find(display, "search-centers");
 Document_Select_OptionsFromObjects(select, centers, "name", false);
 
 if(typeof search["centers"] != "undefined") Document_Select_SelectByValue(select, search["centers"]);
 

 
 // STATUS
 var select = UI_Element_Find(display, "search-status"); 
 Document_Select_AddOption(select, UI_Language_String("courses", "search any"), "");
 Document_Select_AddOption(select, "---", "").disabled = true;
 UI_Select_FromDatapage(select, "courses/course-status");
 
 if(typeof search["status"] != "undefined") select.value = search["status"];
 
 
 
 
 // ALL PROGRAMS
 var programs = Core_Config("programs");
 
 // PROGRAM SELECT
 var select = UI_Element_Find(display, "search-program");
 Document_Select_AddOption(select, UI_Language_String("courses", "search any"), "");
 Document_Select_AddOption(select, "---", "").disabled = true;
 Document_Select_OptionsFromObjects(select, programs, "name", false);
 
 if(typeof search["program"] != "undefined") select.value = search["program"];
 
 select.onchange = 
 function(event)
 {
  var display   = Core_State_Get("admin",["attendance", "display"]);
  var element  = event.currentTarget;
  var program  = element.value;
  
  // ALL LEVELS
  var programs = Core_Config("programs", "");
  var levels   = Safe_Get(programs, [program, "levels"], "").split(",");
  
  // LEVEL SELECT
  var select = UI_Element_Find(display, "search-level");
  Document_Select_Clear(select);
  Document_Select_AddOption(select, UI_Language_String("courses", "search any"), "");
  Document_Select_AddOption(select, "---", false).disabled = true;
  Document_Select_OptionsFromValues(select, levels, levels);
  
  //if(typeof search["level"] != "undefined") select.value = search["level"];
 }
 
 
 
 // DATE MODES
 var select   = UI_Element_Find(display, "search-datemode");
 UI_Select_FromDatapage(select, "courses/search-date-modes");
 select.value = "ends-after";
 
 select.onchange = 
 function(event)
 {
  var element = event.currentTarget;
  var display = Core_State_Get("admin", ["attendance","display"]);
  
  var input   = UI_Element_Find(display, "search-datefrom");
  if(element.value == "ongoing")
  {
   input.style.display = "none";
  }
  else 
  {
   input.style.display = "flex";
  }	  
 }
 
 
 // DATE 
 var input = UI_Element_Find(display, "search-datefrom");
 if(typeof search["date"] != "undefined") input.value = Date_To_Input(search["date"]); else input.value = Date_To_Input(Date_Now());
 
 
 // TIMEFROM TIMETO
 var select_from = UI_Element_Find(display, "search-timefrom");
 var select_to   = UI_Element_Find(display, "search-timeto");
 var time_start  = Time_To_Minutes(Core_Config(["operations", "timetable", "time-opening"], "01:00"));
 var time_end    = Time_To_Minutes(Core_Config(["operations", "timetable", "time-closing"], "24:00"));
 var time        = time_start;
 while(time <= time_end)
 {
  var text = Time_From_Minutes(time);
  
  Document_Select_AddOption(select_from, text, time);
  Document_Select_AddOption(select_to,   text, time);
  
  time = time + 30;
 }
 
 select_from.value    = time_start;
 select_to.value      = time_end;
 
	
 // DAYS 
 var select = UI_Element_Find(display, "search-days");
 var locale = UI_Language_Current(true);
 for(var day = 1; day<=7; day++)
 {
  var text = Date_Weekday_Name(day, "long", locale);
  Document_Select_AddOption(select, text, day);
 }
 

 // BUTTON SEARCH
 UI_Element_Find(display, "button-course-search").onclick = Attendance_Courses_Search;

 return display;
}




async function Attendance_Display(element)
{
  var course_id = Document_Element_GetData(element, "course_id", {});

  var course = Document_Element_GetObject(element,"course");
  var program = course.program;
  var level = course.level;
 
  var programs = Core_Config("programs");
  var lessons = Safe_Get(programs,[program,level],"");
  lessons = lessons.split(",");
  var lessonTimes = {};

  var seats = await Core_Api("Class_Seats_ListByLessonName",{course_id:course_id,lessons:lessons});
  var attendances = {};
  for (const key in seats) {
    var seat = seats[key];
    if(typeof attendances[seat.student_id] == "undefined") attendances[seat.student_id] = {};
    attendances[seat.student_id][seat.lesson_id] = seat
    lessonTimes[seat.lesson_id] = seat.date_start 
  }

  var studentIds = Object.keys(attendances);
  var students = await Core_Api("Users_Read",{ids:studentIds, fields:"firstname,lastname,midname,nickname",options:{array:false}})

  const table = UI_Table("standard", { fixed: true });
  table.classList.add("border-rounded");
  table.style.backgroundColor = "var(--color-medium)";

  const headerRow = UI_Table_Row(table);
  headerRow.style.cssText = "position: sticky;z-index: 11;";
  headerRow.style.top = 0;

  const cellStudentHeader = UI_Table_Cell(headerRow, { type: "header" });
  cellStudentHeader.style.cssText = "position: sticky; left: 0; z-index: 1;border-top-left-radius: 6px; min-width:200px;"
  cellStudentHeader.innerHTML = UI_Language_String("grades/module","student name");
  cellStudentHeader.rowSpan = 1;

  // ATTENDANCE
  var select = UI_Element_Create("attendance/attendance-select");

  lessons.forEach(lessonId => {
    var cellHeader = UI_Table_Cell(headerRow,{type:"header"});
    cellHeader.innerHTML = lessonId + "<br/>" +  "(" + Date_Get(lessonTimes[lessonId],["year","month","day"]) + ")";
  });

  for (const studentId in attendances) {
      var studentName = (students[studentId]["lastname"] || "") + " " + (students[studentId]["midname"] || "") + " " + (students[studentId]["firstname"] || "") + ( students[studentId]["nickname"] != null ?  "(" + (students[studentId]["nickname"]) + ")" : "" );
      var attendancesLessons = attendances[studentId];
      var row = UI_Table_Row(table);
      var cellStudentName = UI_Table_Cell(row);
      cellStudentName.innerHTML = studentName;
      cellStudentName.style.cssText = "position: sticky; left: 0; z-index: 1;";
      for (const lessonId in attendancesLessons) {
          const seat = attendancesLessons[lessonId];
          var selectCell = select.cloneNode(true);
          var icon = UI_Element_Find(selectCell,seat.attendance);
          if(typeof icon != "undefined") icon.style.display = "block";

          var cell = UI_Table_Cell(row);
          cell.appendChild(selectCell);
      }
  }

  var container       = UI_Element_Find("attendance-display");
  container.innerHTML = "";
  container.appendChild(table);

  container.parentElement.style.visibility = "visible";
}




async function Attendance_Courses_Search(reload = true)
{
 var module = Core_State_Get("admin", ["attendance","display"]);
 
 if(reload)
 {
  // SEARCH
  var centers   = [UI_Element_Find(module, "search-centers").value]                 || false;
  var program   = UI_Element_Find(module, "search-program").value                   || false;
  var level     = UI_Element_Find(module, "search-level").value                     || false;
  var status    = UI_Element_Find(module, "search-status").value                    || false;
  var date      = Date_From_Input(UI_Element_Find(module, "search-datefrom").value) || false;
  var date_mode = UI_Element_Find("search-datemode").value;
  var loadmore = Core_State_Get("admin",["attendance","loadmore"],false);
  var offset = Core_State_Get("admin",["attendance","offset"],0);
  if(!loadmore) Core_State_Set("admin",["attendance","offset"],0);
  
 
  var search    = {centers, program, level, date, date_mode, status, order:"date_start DESC", options: {limit:100, offset:offset}};
  Core_State_Set("admin",["attendance","search"], search);
 
  var courses   = await Core_Api("Courses_List", search);
  Core_State_Set("admin",["attendance","data"], courses);
 
 }
 else
 { 
  var courses = Core_State_Get("admin",["attendance","data"], []);
 }
 
 
 // FILTER THE RESULTS BY DATES/TIMES DATA
 var days      = Document_Input_Get(UI_Element_Find(module, "search-days"));
 var time_from = parseInt(UI_Element_Find(module, "search-timefrom").value);
 var time_to   = parseInt(UI_Element_Find(module, "search-timeto").value);

 var filtered = [];
  
 for(var course of courses)
 {  
  var validate = true;
  
  var schedule = course["schedule"] || [];
  for(var item of schedule)
  {
   // CHECK DAY
   if(days.length > 0 && !days.includes(item["day"])) 
   {
    validate = false;
	break;
   }
	
   // CHECK TIME
   if(!Numbers_Between(parseInt(item["time"]), time_from, time_to))
   {
    console.log("discarded for time " + item["time"] + " not between " + time_from + " and " + time_to);
    validate = false;
	break;
   }
  }
  
  if(validate) filtered.push(course);
 }
 
 var courses = filtered;
 
 await Attendance_Courses_Search_Display(courses);
}




async function Attendance_Courses_Search_Display(courses)
{
 var module = Core_State_Get("admin", ["attendance","display"]);
 
 // ASSEMBLE RESULTS  
 var list = UI_List_Items(courses, ["style-outlined-accented", "outline-inner"], Attendance_Display, undefined,
 function(course)
 { 
  var locale   = UI_Language_Current(true);
  var centers  = Core_Config("centers");
  var programs = Core_Config("programs");
 
  var data              = {};
  
  data["name"]          = course["name"] || "#" + course["id"];
  
  data["date"]          = UI_Language_Date(course["date_start"], "monthdayyear-compact");
  data["center"]        = Safe_Get(centers,  [course["center_id"], "name"], course["center_id"]);
  data["program"]       = Safe_Get(programs, [course["program"], "name"], course["program"]) || UI_Language_String("courses/course-display", "no program");
  data["level"]         = course["level"] || UI_Language_String("courses/course-display", "no level");
  
  data["seats_taken"]   = course["seats"]["taken"] || 0;
  data["seats_total"]   = course["seats"]["total"] || 0;
  
  data["classes_taken"] = course["classes"]["taken"] || 0;
  data["classes_total"] = course["classes"]["total"] || 0;
  
  
  var days  = [];
  for(var item of course["schedule"] || [])
  {
   var day  = Date_Weekday_Name(item["day"], "short", locale);
   var time = Time_From_Minutes(item["time"]);
   
   days.push(day + " " + time);
  }
  data["days"] = days.join(", ");
  
  var element     = UI_Element_Create("courses/course-item", data);
  Document_Element_SetObject(element, "course", course);
  Document_Element_SetData(element, "course_id", course["id"]);
  
  return element;
 });

 Core_State_Set("admin", ["attendance","courses-list"], list);
 
 // ADD LOAD MORE LISTENER
 const handleInfiniteScroll = async (e) => {
   var element = e.target;
   var endOfElement = element.clientHeight + element.scrollTop >= element.scrollHeight - 100 ;
   var loadmore = Core_State_Get("admin", ["attendance","loadmore"], false);
   if (endOfElement && !loadmore) {
     console.log("load more courses");
     Core_State_Set("admin", ["attendance","loadmore"], true);

     var offset =  Core_State_Get("admin", ["attendance","offset"],0);
     Core_State_Set("admin", ["attendance","offset"],offset + 100);

     await Attendance_Courses_Search(true);
     
     Core_State_Set("admin", ["attendance","loadmore"], false);
   }
 };

 if(courses.length > 0) list.onscroll = handleInfiniteScroll
 
 // DISPLAY RESULTS
 var container = UI_Element_Find(module, "courses-list"); 
 if(Core_State_Get("admin",["attendance", "loadmore"], false))
 {
  if(courses.length > 0)
  {
    list.children.forEach(element => {
      container.children[0].appendChild(element);
    });

    container.style.visibility = "visible";
  }
  // REMOVE LISTENER SCROLL
  var coursesData = Core_State_Get("admin",["attendance", "data"], []);
  if(coursesData.length == 0) container.children[0].onscroll = null;
 }
 else
 {
  if(courses.length > 0)
  {
    container.innerHTML  = "";
    container.appendChild(list);

    container.style.visibility = "visible";
  }
  else
  {
    container.style.visibility = "hidden";
    container.innerHTML  = "";
  }
 }
 

 // CLEAR COURSE DISPLAY
 UI_Element_Find(module, "attendance-display").innerHTML = ""; 
 UI_Element_Find(module, "attendance-detail").style.visibility = "hidden";
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                        B O O K I N G                                           //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Booking_OnLoad(module, data)
{
}


async function Booking_OnShow(module, data)
{
}


async function Booking_OnUnload()
{
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      B O O K   P A G E                                         //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

var BOOKPAGE_EXTRAS     = ["lesson-id", "title", "vocabulary", "dialogue", "dialogue-title"];


async function Bookpage_Read(source)
{
 var bookpage = await Core_Api("Bookpage_Read", {source});

 var config   = Core_Data_Page("bookpage/template");
 var template = Data_Page_FromConfig(config);
 var bookpage = Data_Page_Complete(bookpage, template, true);
 
 return bookpage;
}





async function Bookpage_Display(bookpage, container, extras = {}, options = {scale:true})
{
 var rendered = await Bookpage_Render(bookpage, extras, options);
 
 container.innerHTML = "";
 container.appendChild(rendered);
 
 if(options["scale"])
 {
  Document_Element_FitContent(container, 0.01, true);
 }
  
 Bookpage_Adjust(rendered);
 
 return rendered;
}





function Bookpage_Adjust(container)
{
 for(var id of BOOKPAGE_EXTRAS)
 {
  var section = UI_Element_Find(container, id);
  
  if(section)
  {
   var element = section.firstElementChild;
   if(element) Document_Element_FitContent(element);
  }
 }
}




async function Bookpage_Render(bookpage, extras = {}, options = {layout:false})
{ 
 // CREATE PAGE BASED ON TEMPLATE
 var template = Safe_Get(bookpage, ["page", "template"], "standard"); console.log(template);
 var page     = await Request_Load("content/templates/bookpages/" + template + ".html" + "?c=" + Date.now(), "text"); 
 
 
 // COVER PICTURE
 var cover = extras["cover"] || "";
 page      = String_Variables_Set(page, {cover});
 
 
 // LESSON TYPE (SHOWN IN "CONTENT" PARAGRAPH)
 var type  = extras["type"] || "";
 page      = String_Variables_Set(page, {type});
 
 
 //var page     = Document_Element_Create(html);
 
 
 // POPULATE PAGE
 
 var paragraphs = [];
 
 // PARAGRAPHS HTML
 for(var id in bookpage)
 {
  if(id != "page")
  {
   var template   = bookpage[id]["template"] || "standard";
   var html       = await Request_Load("content/templates/paragraphs/" + template + ".html" + "?c=" + Date.now(), "text");
   
   // HACK: MARK THE PARAGRAPH'S HTML
   html = html.replace("<div", "<div data-component = 'paragraph' ");
   
   // APPLY TEXT
   var text = {};
   var list = Safe_Get(bookpage, [id, "texts"], []);
   
   for(var n = 1; n <=6; n++)
   {
	var block = list[n] || "";
	block     = block.replaceAll("\r\n", "<br>");
    block     = block.replaceAll("\n",   "<br>"); 
	
	if(block)
	{
     text["text-" + n] = block;
	}
	else
	{
     text["text-" + n] = "";
	}
   }  
   //console.log(text);

   html = String_Variables_Set(html, text);
   
   
   // APPLY TITLE AND SUBTITLE
   var text = {};
   for(var field of ["title", "subtitle"])
   {
    text[field] = Safe_Get(bookpage, [id, field], "");
   }
   
   html = String_Variables_Set(html, text);
   
   
   // APPLY PICTURES
   var pictures = {};
   var list     = Safe_Get(bookpage, [id, "pictures"], []);
   
   for(var n = 1; n <=6; n++)
   {
	var picture = list[n];
	if(picture)
	{
     pictures["picture-" + n] = picture;
	}
	else
	{
     pictures["picture-" + n] = "";
	}
   }
   
   html = String_Variables_Set(html, pictures);
   
   
   // CONFIRM PARAGRAPH
   paragraphs[id] = html;
  }
 }
 

 

 // INJECT PARAGRAPHS 
 var ids = Core_Data_Value("bookpage/paragraphs", "info", "paragraphs").split(",");
 page     = String_Variables_Set(page, paragraphs);
 /*
 for(var id of ids) 
 {
  var html    = paragraphs[id] || "";
  var element = UI_Element_Find(page, id);
  
  page        = String_Variables_Set(html, {type});
  
  if(element) element.innerHTML = html;
 }
 */
 
 // INJECT EXTRAS
 for(var id of BOOKPAGE_EXTRAS) if(!extras[id]) extras[id] = UI_Element_Component("editor/bookpage-placeholder-" + id); 
 page     = String_Variables_Set(page, extras);

 /*
 {
  var html    = extras[id] || UI_Element_Component("editor/bookpage-placeholder-" + id);
  var element = UI_Element_Find(page, id);
  
  if(element) element.innerHTML = html;
 }
 */

 
 // CREATE PAGE
 var page     = Document_Element_Create(page);
 
 // VISUALIZE LAYOUT IF OPTION SET
 if(options["layout"])
 { 
  var columns  = Document_Element_Children(page, false);

  for(var column of columns)
  {
   var elements = Document_Element_Children(column, false);
   for(var element of elements)
   {
    if(element.nodeName == "DIV")
    {
     element.style.outline = "6px dashed red";

     var components = Document_Element_Children(element, true);
     for(var component of components)
     {
      if(["DIV", "IMG"].includes(component.nodeName))
      {
       component.style.outline = "3px dashed blue";
      }
     }
    }
   }
  }
 }
 
 
 // SHADOW (RAISED) PAGES
 if(options["shadow"]) Document_CSS_SetClass(page, "shadow-sharp-bottom");
 
 return page; 
}

async function Bookpage_Read_Mutiple(sources)
{
 var bookpages = await Core_Api("Bookpage_Read_Mutiple", {sources});
 for (let index = 0; index < bookpages.length; index++) {
     var bookpage = bookpages[index];
     var config   = Core_Data_Page("bookpage/template");
     var template = Data_Page_FromConfig(config);
     bookpages[index] = Data_Page_Complete(bookpage, template, true);
 }
 return bookpages;
}

function Bookpage_Create_Empty_Page()
{
 var newPage = document.createElement("div");
 newPage.classList.add("container-row", "gap-medium", "shadow-sharp-bottom");

 var tmpPage = document.createElement("div");
 tmpPage.classList.add("container-column");
 tmpPage.style.width = "210mm";
 tmpPage.style.height = "297mm";
 tmpPage.style.backgroundColor = "var(--color-white)";
 tmpPage.style.overflow = "hidden";

 var tmpPage2 = tmpPage.cloneNode(true);
 
 newPage.appendChild(tmpPage);
 newPage.appendChild(tmpPage2);
 return newPage;
}


async function Bookpage_Download(lesson)
{
 var module = Core_State_Get("core","module-body",null);
 if(typeof lesson != "string") lesson = Core_State_Get("editor",["lessons","selected-lesson"],null);
 if(lesson != null)
 {
  var downloadpage = await Lesson_Bookpage_Render(lesson);
  downloadpage.classList.remove("container-row");
  var div = document.createElement("div");
  div.appendChild(downloadpage);
  module.appendChild(div);
  Bookpage_Adjust(downloadpage,0.01);
  var dialog = UI_Element_Find(downloadpage,"dialogue");
  if(dialog){
     var lines = UI_Element_Find(dialog,"lines");
     var height = dialog.clientHeight;
     var width = dialog.clientWidth;
     if(lines.children.length > 0){
      var scale = lines.children[0].style.zoom;
      lines.style.transform = "scale(" + scale + ")";
      lines.style.transformOrigin = "top left";
      lines.style.overflow = "unset";
      lines.style.height = height/scale;
      lines.style.width = width/scale;
      dialog.style.width = width/scale;
      // REMOVE ZOOM
      for (let index = 0; index < lines.children.length; index++) {
         var element = lines.children[index];
         element.style.zoom = null;
         element.lastElementChild.style.width = "100%";
         var fontsize = window.getComputedStyle(element.lastElementChild.lastElementChild, null).getPropertyValue('font-size');
         element.lastElementChild.lastElementChild.style.fontSize = fontsize*scale + 'px';
      }
     }
     
  }
  var vocabulary = UI_Element_Find(downloadpage,"vocabulary");
  if(vocabulary){
     var lines = UI_Element_Find(vocabulary,"lines");
     var height = vocabulary.clientHeight;
     if(lines.children.length > 0){
      var scale = lines.children[0].style.zoom;
      lines.style.transform = "scale(" + scale + ")";
      lines.style.transformOrigin = "top left";
      lines.style.overflow = "unset";
      lines.style.height = height/scale;
      // REMOVE ZOOM
      for (let index = 0; index < lines.children.length; index++) {
         var element = lines.children[index];
         element.style.zoom = null;
      }
     }
  }
  const opt = {
   filename: lesson + "_BOOKPAGE.pdf"
  };
  // FIX ZOOM PAGE
  if(document.body.style.zoom != null)
  {
   downloadpage.style.transformOrigin = "top left";
   downloadpage.style.marginLeft = (document.body.offsetWidth - document.body.clientWidth)/2;
   if(document.body.style.zoom == 2 && parseFloat(document.body.clientWidth)  <= 1588)
   {
    downloadpage.style.marginLeft = parseFloat(downloadpage.style.marginLeft) + (1588 - parseFloat(document.body.clientWidth))/4;
   }
   
   div.id = "div"
  }
  div.style.display = "none";
  await html2pdf().set(opt).from(downloadpage).save();
  div.remove();
 }
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      B O O K   P A G E                                         //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Bookpage_OnLoad(module, data)
{
}



async function Bookpage_OnShow(module, data)
{
 var lesson = Client_Location_Parameter("lesson");
 
 var page   = await Lesson_Bookpage_Render(lesson);
 
 module.appendChild(page);
 
 // IF PRINT SIZE REQUIRED...
 if(Client_Location_Parameter("print"))
 {
  Document_CSS_UnsetClass(module, "content-centered");
  module.style.alignItems = "center"; 
  module.style.overflow   = "auto";
 }
 else
 // IF PRINT SIZE IS NOT REQUIRED, RESIZE TO SCREEN
 {
  Document_Element_FitContent(page);
  Bookpage_Adjust(page);
 }

 if(Client_Location_Parameter("edit")){
   await Bookpage_Render_Canvas(module,page);
 }
 
 console.log(page);
}




async function Bookpage_OnUnload()
{
}





// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          M O R E                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Bookpage_Render_Canvas(module,page)
{
  // CUSTOM page
  Document_CSS_UnsetClass(module, "content-centered");

  page.classList.remove("container-row");
  page.firstElementChild.style.zoom = null;
  page.lastElementChild.style.zoom = null;

  var dialog = UI_Element_Find(page,"dialogue");
  if(dialog){
     var lines = UI_Element_Find(dialog,"lines");
     var height = dialog.clientHeight;
     var width = dialog.clientWidth;
     if(lines.children.length > 0){
      var scale = lines.children[0].style.zoom;
      if(Client_Location_Parameter("scaleDialogue"))  scale = Client_Location_Parameter("scaleDialogue");
      lines.style.transform = "scale(" + scale + ")";
      lines.style.transformOrigin = "top left";
      lines.style.overflow = "unset";
      lines.style.height = height/scale;
      lines.style.width = width/scale;
      dialog.style.width = width/scale;
      // REMOVE ZOOM
      for (let index = 0; index < lines.children.length; index++) {
         var element = lines.children[index];
         element.style.zoom = null;
         element.lastElementChild.style.width = "100%";
         var fontsize = window.getComputedStyle(element.lastElementChild.lastElementChild, null).getPropertyValue('font-size');
         element.lastElementChild.lastElementChild.style.fontSize = fontsize*scale + 'px';
      }
     }
  }

  var vocabulary = UI_Element_Find(page,"vocabulary");
  if(vocabulary){
     var lines = UI_Element_Find(vocabulary,"lines");
     var height = vocabulary.clientHeight;
     if(lines.children.length > 0){
      var scale = lines.children[0].style.zoom;
      if(Client_Location_Parameter("scaleVocabulary"))  scale = Client_Location_Parameter("scaleVocabulary");
      lines.style.transform = "scale(" + scale + ")";
      lines.style.transformOrigin = "top left";
      lines.style.overflow = "unset";
      lines.style.height = height/scale;
      // REMOVE ZOOM
      for (let index = 0; index < lines.children.length; index++) {
         var element = lines.children[index];
         element.style.zoom = null;
      }
     }
  }

  
  await html2canvas(page).then(async function(canvas)
  {
    page.style.display = "none";
    Bookpage_Canvas_Create(module,canvas);
});
}

function Bookpage_Canvas_Create(module,canvas)
{
   canvas.addEventListener("mousemove", Bookpage_Edit_Pointer); 

   var whiteboard = UI_Element_Create("bookpage/bookpage-whiteboard");
   whiteboard.onmousedown = Bookpage_Whiteboard_Draw_Start;
   whiteboard.onmouseup   = Bookpage_Whiteboard_Draw_End;
   whiteboard.onmousemove =  Bookpage_Whiteboard_Draw_Draw;
   whiteboard.ondragstart =  Bookpage_Event_DragStart; 
   whiteboard.appendChild(canvas);
   module.appendChild(whiteboard);

   var rightContainer = UI_Element_Create("bookpage/bookpage-whiteboard-rightmenu");
   module.appendChild(rightContainer);

   Core_State_Set("bookpage","canvas",canvas);
   Core_State_Set("bookpage","whiteboard",whiteboard);
   
   Document_Element_SetObject(whiteboard, "canvas", canvas);
   Document_Element_SetObject(whiteboard, "handle", canvas.getContext("2d"));

   Bookpage_Whiteboard_SetPen(whiteboard);

   var container = UI_Element_Find(whiteboard, "tools");
   var pens      = Core_Data_Page("bookpage/pens");
   for(var id in pens)
   {
    var pen                   = pens[id];
    
    var tip                   = UI_Element_Create("whiteboard/tip-" + pen["type"]);
    tip.style.position        = "relative";
    tip.style.width           = "16px";
    tip.style.backgroundColor = RgbaToRgb(pen["color"]);
    tip.style.outline         = "solid 2px";
    tip.style.outlineColor    = "var(--color-dark)";
    tip.title                 = UI_Language_Object(pen);
    
    Document_CSS_SetClass(tip, "style-clickable");
    Document_CSS_SetClass(tip, "style-selectable");
  
    Document_Element_SetData(tip, "name", id);
    Document_Element_SetData(tip, "uid", id);
    Document_Element_SetObject(tip, "whiteboard", whiteboard);

    // ADD ICON
    if(typeof pen["icon"] != "undefined" && pen["icon"] != "") 
    {
      var icon = document.createElement("i");
      icon.classList.add(...pen["icon"].split(" "));
      tip.appendChild(icon);
      tip.style.outline = null;
      tip.style.alignItems = "center";
    }
    
    tip.onclick = 
    function(event)
    {
     var element    = event.currentTarget;
     var name       = Document_Element_GetData(element, "name");
     var whiteboard = Document_Element_GetObject(element, "whiteboard");
     Media_Audio_Play(Resources_URL("sounds/click.mp3"));
     Document_Element_Animate(element, "rubberBand 0.5s");
     Bookpage_Whiteboard_SetPen(whiteboard, name);
    }
    
    container.appendChild(tip);
   }

   // SET RIGHTMENNU
   var resetButton = UI_Element_Find(rightContainer,"reset");
   resetButton.onclick = Bookpage_Canvas_Reset;
   var undoButton = UI_Element_Find(rightContainer,"undo");
   undoButton.onclick = Bookpage_Canvas_Undo;
   var redoButton = UI_Element_Find(rightContainer,"redo");
   redoButton.onclick = Bookpage_Canvas_Redo;
   var downloadButton = UI_Element_Find(rightContainer,"download");
   downloadButton.onclick = Bookpage_Canvas_Download;
   // SAVE CANVAS
   Bookpage_Canvas_Save();
}


function Bookpage_Whiteboard_Draw_End(event)
{

 var whiteboard = event.currentTarget;
 var status = Document_Element_GetData(whiteboard, "status");

 switch (status) {
  case "draw":
    Bookpage_Canvas_Save();
    break;

  case "dragging":
    var element      = Core_State_Get("bookpage","current-input",null);
    if(element)
    Bookpage_ElementChanged(element);
    break;
  case "create-input":
    var element      = Core_State_Get("bookpage","current-input",null);
    if(element) element.focus();
    break;
  default:
    break;
 }
 Document_Element_SetData(whiteboard, "status", "");

}


function Bookpage_Edit_Pointer(event)
{  
 var layer   = Core_State_Get("bookpage","whiteboard",null);
 var pointer = UI_Element_Find(layer, "overlay").firstElementChild;
 var size    = Document_Element_Size(pointer);
 var target  = event.currentTarget;
 var rect    = target.getBoundingClientRect();

 var left    = (event.clientX  - rect.left + target.offsetLeft - (size["width"]/2))  + "px";
 var top     = (event.clientY  - rect.top - (size["height"]/2)) + "px";
 
 pointer.style.left = left;
 pointer.style.top  = top;
}




function Bookpage_Whiteboard_Draw_Start(event)
{
  console.log("mouse down")
 var elementSelected = Core_State_Get("bookpage","current-input",null);
 var whiteboard = event.currentTarget;
 var canvas = Document_Element_GetObject(whiteboard, "canvas");
 var target = event.target;
 if(target != canvas) 
 {
  if(target.tagName == "INPUT") Core_State_Set("bookpage","current-input",target);
 }
 else
 {    
  if(elementSelected)
  {
    console.log(elementSelected)
    var handle =  Document_Element_GetObject(whiteboard, "handle");
    var pointer  = {};
    pointer["x"] = parseFloat(elementSelected.style.left) - canvas.offsetLeft + whiteboard.offsetLeft;
    pointer["y"] = parseFloat(elementSelected.style.top) - canvas.offsetTop + whiteboard.offsetTop + 20;
    handle.font = elementSelected.style.fontSize + "  Arial"; 
    handle.fillStyle = elementSelected.style.color;
    var arrValue = elementSelected.value.split(/\n/g);
    for (let index = 0; index < arrValue.length; index++) {
      const element = arrValue[index];
      handle.fillText(element,pointer["x"],pointer["y"] + parseFloat(elementSelected.style.fontSize)*index);
    }
    var detail = Document_Element_GetObject(elementSelected,"details");
    detail.remove();
    elementSelected.remove();
    Core_State_Set("bookpage","current-input",null);
    Bookpage_Canvas_Save();
  } 
  else 
  {
    var pointOverlay = UI_Element_Find(whiteboard, "overlay").firstElementChild;
    var pointer  = {};
 
    pointer["x"] = parseFloat(pointOverlay.style.left) - canvas.offsetLeft + whiteboard.offsetLeft;
    pointer["y"] = parseFloat(pointOverlay.style.top) - canvas.offsetTop + whiteboard.offsetTop + parseFloat(pointOverlay.style.width) / 2;
 
    Document_Element_SetData(whiteboard, "status", "draw");
    Document_Element_SetObject(whiteboard, "pointer", pointer);
 
    var pen     = Document_Element_GetObject(whiteboard, "pen");
    if(pen["id"] == "text")
    {
       var input = UI_Element_Create("bookpage/bookpage-whiteboard-input");
       input.style.left = pointOverlay.style.left;
       input.style.top = pointOverlay.style.top
       
       whiteboard.appendChild(input);
       Core_State_Set("bookpage","current-input",input);
       Document_Element_SetData(whiteboard, "status", "create-input");
       Bookpage_Input_Detail(input)
    } 
  }    
 }
}
 




function  Bookpage_Whiteboard_Draw_Draw(event)
{  
 var whiteboard = event.currentTarget || event.srcElement;
 if(!whiteboard)
 {
  return;
 }
  
 var status = Document_Element_GetData(whiteboard, "status");
 var canvas = Document_Element_GetObject(whiteboard, "canvas");
 var pointOverlay = UI_Element_Find(whiteboard,"overlay").firstElementChild;

 switch(status)
 {
  case "draw":
   
	var handle  = Document_Element_GetObject(whiteboard, "handle");
	var pointer = Document_Element_GetObject(whiteboard, "pointer");
   var pen     = Document_Element_GetObject(whiteboard, "pen");
     
	handle.beginPath();
	handle.strokeStyle = pen["color"];
	handle.lineWidth   = pen["size"];
	handle.moveTo(pointer["x"], pointer["y"]);
 
  pointer["x"] = parseFloat(pointOverlay.style.left) - canvas.offsetLeft + whiteboard.offsetLeft;
  pointer["y"] = parseFloat(pointOverlay.style.top) - canvas.offsetTop + whiteboard.offsetTop + parseFloat(pointOverlay.style.width) / 2;
 
	handle.lineTo(pointer["x"], pointer["y"]);
	handle.stroke();

  break;
  case "dragging":
   var element      = Core_State_Get("bookpage","current-input");
   //console.log(element);
   if(element)
   Bookpage_ElementChanged(element);
   break;
 }

}



function Bookpage_Whiteboard_SetPen(whiteboard, set = {id:"default", type:"round", size:1, color:"white", mode:"destination-over"})
{
 if(typeof set == "string")
 {
  // SET OUTLINE
  var penId = set;
  var elementPen = UI_Element_Find(whiteboard,penId);
  elementPen.style.outline         = "solid 4px";
  elementPen.style.outlineColor    = "var(--color-wheel-2)";

  var pens = Core_Data_Page("bookpage/pens");
  var set  = pens[penId] || {};
  set.id = penId;
  set.element = elementPen;
 }
	
 var pen = Document_Element_GetObject(whiteboard, "pen") || {};
 var element = Safe_Get(pen,"element",null);
 if(element) 
 {
  // RESET OUTLINE
  element.style.outline         = "solid 2px";
  element.style.outlineColor    = "var(--color-dark)";
  if(pen.icon != "") element.style.outline = null;
 }
 Object.assign(pen, set);
 
 Document_Element_SetObject(whiteboard, "pen", pen);
 
 var tip = UI_Element_Create("whiteboard/tip-" + pen["type"]);
 Document_Element_SetObject(whiteboard, "tip", tip);
 tip.style.width           = pen["size"] + "px";
 tip.style.backgroundColor = pen["color"];
 
 var overlay       = UI_Element_Find(whiteboard, "overlay");
 overlay.innerHTML = "";
 overlay.appendChild(tip);
 
 var handle     = Document_Element_GetObject(whiteboard, "handle");
 handle.lineCap = pen["type"];
 
 handle.globalCompositeOperation = pen["mode"];
}


function Bookpage_Event_Disable()
{
   var whiteboard = Core_State_Get("bookpage","whiteboard");
   whiteboard.onmousedown = null;
   whiteboard.onmouseup   = null;
   whiteboard.onmousemove =  null;
}

function Bookpage_Event_Enable()
{
   var whiteboard = Core_State_Get("bookpage","whiteboard");
   whiteboard.onmousedown = Bookpage_Whiteboard_Draw_Start;
   whiteboard.onmouseup   = Bookpage_Whiteboard_Draw_End;
   whiteboard.onmousemove =  Bookpage_Whiteboard_Draw_Draw;
}


function Bookpage_Event_DragStart(event)
{
 event.preventDefault();
 var whiteboard = Core_State_Get("bookpage","whiteboard");
 var element = event.target;

 Core_State_Set("bookpage","current-input",element);
 Document_Element_SetData(whiteboard, "status", "dragging");
}



function Bookpage_ElementChanged(element)
{
 if(!element) return;
 var whiteboard = Core_State_Get("bookpage","whiteboard");
 var pointOverlay = UI_Element_Find(whiteboard, "overlay").firstElementChild;
 
 element.style.left = pointOverlay.style.left;
 element.style.top = pointOverlay.style.top;
 element["changed"] = true;
}

function Bookpage_Canvas_Save()
{
   var whiteboard = Core_State_Get("bookpage","whiteboard");
   var canvas = Document_Element_GetObject(whiteboard, "canvas");
   var handle = canvas.getContext("2d");
   var img = handle.getImageData(0, 0, canvas.width, canvas.height);
   var history = Core_State_Get("bookpage","history",{list : [], index : 0});
   if(history.list.length > history.index) history.list.splice(history.index, history.list.length - history.index);
   history.list.push(img);
   history.index += 1;
   Core_State_Set("bookpage","history",history);
}


function Bookpage_Canvas_Undo()
{
   var history = Core_State_Get("bookpage","history");
   var index = history.index - 1;
   if(index >= 1){
      var img = history.list[index - 1];
      var whiteboard = Core_State_Get("bookpage","whiteboard");
      var handle = Document_Element_GetObject(whiteboard, "handle");
      handle.putImageData(img, 0, 0);
      Core_State_Set("bookpage",["history","index"],index);
   }
}



function Bookpage_Canvas_Redo()
{
   var history = Core_State_Get("bookpage","history");
   var index = history.index + 1;
   if(index <= history.list.length ){
      var img = history.list[index - 1];
      var whiteboard = Core_State_Get("bookpage","whiteboard");
      var handle = Document_Element_GetObject(whiteboard, "handle");
      handle.putImageData(img, 0, 0);
      Core_State_Set("bookpage",["history","index"],index);
   }
}


function Bookpage_Canvas_Download()
{
   var canvas = Core_State_Get("bookpage","canvas");
   var lesson = Client_Location_Parameter("lesson");
   var opt = {
      filename: lesson
   }
   html2pdf().set(opt).from(canvas).save();
}


function Bookpage_Canvas_Reset()
{
  var history = Core_State_Get("bookpage","history");
  var img = history.list[0];
  var whiteboard = Core_State_Get("bookpage","whiteboard");
  var handle = Document_Element_GetObject(whiteboard, "handle");
  handle.putImageData(img, 0, 0);
  Core_State_Set("bookpage","history",{list : [img], index : 1});
  Bookpage_Whiteboard_SetPen(whiteboard);
}


function Bookpage_Input_Detail(input)
{
  var whiteboard = Core_State_Get("bookpage","whiteboard");
  var rightContainer = UI_Element_Find(whiteboard.parentElement,"right-menu");
  var detail = UI_Element_Create("bookpage/bookpage-input-information");

  var fontSize = UI_Element_Find(detail,"font-size");
  fontSize.value = parseFloat(input.style.fontSize);
  fontSize.onchange = (e) => {
    var element = e.target;
    input.style.fontSize = element.value;
  }

  var color = UI_Element_Find(detail,"text-color");
  color.value = input.style.color;
  color.onchange = (e) => {
    var element = e.target;
    input.style.color = element.value;
  }

  var saveButton = UI_Element_Find(detail,"save-button");
  Document_Element_SetObject(saveButton, "input", input);
  saveButton.onclick = (e) => {
    var element = e.target;
    var input = Document_Element_GetObject(element, "input");
    var whiteboard = Core_State_Get("bookpage","whiteboard");
    var canvas = Document_Element_GetObject(whiteboard, "canvas");
    var handle = Document_Element_GetObject(whiteboard, "handle");
    
    var pointer  = {};
    pointer["x"] = parseFloat(input.style.left) - canvas.offsetLeft + whiteboard.offsetLeft;
    pointer["y"] = parseFloat(input.style.top) - canvas.offsetTop + whiteboard.offsetTop + 20;
    
    handle.font = input.style.fontSize + "  Arial"; 
    handle.fillStyle = input.style.color;
    var arrValue = input.value.split(/\n/g);
    for (let index = 0; index < arrValue.length; index++) {
      const element = arrValue[index];
      handle.fillText(element,pointer["x"],pointer["y"] + parseFloat(input.style.fontSize)*index);
    }
    var detail = Document_Element_GetObject(input,"details");
    detail.remove();
    
    input.remove();
    Core_State_Set("bookpage","current-input",null);
    Bookpage_Canvas_Save();
  }

  rightContainer.appendChild(detail);
  Document_Element_SetObject(input, "details", detail);
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                       C E N T E R S                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Centers_List()
{
 var centers = Core_Config(["centers"]);
 for(var id in centers) centers[id]["id"] = id;
 
 return centers;
}




function Centers_Name(center)
{
 var name = Core_Config(["centers", center, "name"], "");
 
 return name;
}



function Centers_Center(center)
{ 
 var data   = Core_Config(["centers", center]);
 data["id"] = center; 
 
 return data;
}



function Centers_From_Cluster(cluster, onlyid)
{
 var centers = [];
 var list    = Centers_List();
 
 for(var id in list)
 {
  var center = list[id];
  if(center["cluster"] == cluster) 
  {
   if(onlyid) centers.push(id); 
   else 
   {
	centers.push(center);
   }
  }
 }
 
 return centers;
}




function Centers_Related(center, onlyid)
{
 var centers = Centers_List();
 var cluster = Safe_Get(centers, [center, "cluster"], false);
 
 if(!cluster) 
 {
  if(onlyid) return [center];
  else
  {
   center = centers[center];
   return [center];
  }
 }
 
 var related = Centers_From_Cluster(cluster, onlyid);
 return related;
}



function Centers_Available(available)
{
 if(!available) var available = Core_Config(["roles", User_Role(), "operate-on-centers"], "none");
 var centers = [];
 
 switch(available)
 {
  case "home":
	centers.push(Centers_Center(User_Center()));
  break;
  
  case "cluster":
	centers.push(...Centers_Related(User_Center()));
  break;
  
  case "all":		
	centers.push(...Object_To_Array(Centers_List()));
  break;
 }
 
 return centers;
}



async function Centers_Rooms(center)
{
 var rooms = Core_Api("Center_Rooms", {center});
 
 return rooms;
}



async function Centers_Room_Select(rooms, center, dates, config = {})
{
 // BOTH CENTER AND DATES SPECIFIED: GET ROOMS FROM AVAILABILITY QUERY
 if(center && dates)
 {
  var rooms = await Core_Api("Center_Rooms_Available", {center, dates, options:{utc:true}}); 
 }
 
 
 // CENTER SPECIFIED, BUT NOT DATES: GET ROOMS FROM CENTER'S WHOLE LIST
 if(center && !dates)
 {
  var rooms = await Centers_Rooms(center);
  rooms     = Object.keys(rooms);
 }
 
 
 // NO ROOMS 
 if(!rooms) rooms = [];
 
 
 // BUILD OPTIONS LIST
 var options = [];
 
 if(config["nullfirst"])
 {
  var option   = new Option();
  option.text  = "";
  option.value = "";
  options.push(option);
 }
 
 console.log(rooms);
 for(var room of rooms)
 {
  option       = new Option();
  option.text  = room;
  option.value = room;
  
  options.push(option);
 }
 
 if(config["online"])
 {
  var option   = new Option();
  option.text  = UI_Language_String("centers/popups", "room online");
  option.value = "online";
  options.push(option);
 }
 
 
 var title = config["title"] || UI_Language_String("centers/popups", "room select title");
 
 var room = await UI_Popup_Select(title, false, false, options);
 return room;
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          M O R E                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                       C L A S S E S                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Classes_Load(id, options = {})
{
 // OPTIONS:  users
 var classdata = await Core_Api("Class_Read", {class_id:id, options:options});
  
 return classdata;
}




async function Class_Preview(id, options = {})
// OPTIONAL CONTROLS:
// - online      (boolean)
// - assessment  (function)
// - classroom   (function)
// - quickassess (div)
{
 var classitem = await Classes_Load(id, {seats:true, students:true});
 var classdata = classitem["info"];
 var lesson    = await Lesson_Load(classdata["lesson_id"], {outcomes:true});
 
 Core_State_Set("classes", ["preview", "class"],  classitem);
 Core_State_Set("classes", ["preview", "lesson"], lesson);
 
 // CLASS PREVIEW
 var page   = UI_Element_Create("classes/class-preview");
 
 // COVER IMAGE
 var cover    = UI_Element_Find(page, "cover");
 var source   = "content/lessons/" + classdata["lesson_id"] + "/cover.png";
 var fallback = Resources_URL("images/cover-lesson.jpg");
 Document_Image_Load(cover, [source, fallback]);
 
 
 // TITLE
 var title = UI_Element_Find(page, "title");
 var text  = UI_Language_Object(lesson["title"]) || "";
 var line  = UI_Element_Create("classes/class-preview-title", {text});
 title.appendChild(line);
 
 // OUTCOMES
 var outcomes = lesson["outcomes"] || {};
 for(id in outcomes)
 {
  var outcome = Safe_Get(outcomes, [id, "info"]);
  var line    = UI_Element_Create("classes/class-preview-aim", {text:UI_Language_Object(outcome)});
  title.appendChild(line);
 }
 
 
 // STUDENTS
 var container = UI_Element_Find(page, "students");
 var seats     = classitem["seats"] || [];
 
 for(var seat of seats)
 {
  var student = seat["student"] || {};
  
  
  if(options["attendance"])
  {
   var more = UI_Element_Create("core/control-dropdown-small");
   
   Document_Select_AddOption(more, "", "");   
   UI_Select_FromDatapage(more, "assessment/attendance-short");
  }
  else
  {
   var more = false;
  }

  var item    = User_Card(student, "item-stretch", more);
  
  if(options["quickassess"])
  {
   if(options["nickname"]){
    item  = User_Card(student, "item-input", more);
    var nickname = UI_Element_Find(item,"nickname");
    Document_Element_SetData(nickname, "field", "nickname");
    Document_Element_SetData(nickname, "userid", student["id"]);
    nickname.value          = student["nickname"] || "";
    nickname.placeholder    = "Nickname";
    nickname.onchange = Classes_User_Set
   } 
   Document_CSS_SetClass(item, "style-clickable");
   Document_Element_SetObject(item, "seat", seat);
  
   item.onclick = 
   async function(event)
   {
    var element = event.currentTarget;
    var seat    = Document_Element_GetObject(element, "seat");
    
    var page            = await Assessment_Assess_Seat(seat["id"], sections = {all:true});
    var container       = options["quickassess"];
    container.innerHTML = "";
    container.appendChild(page);
   }
  }
  
  container.appendChild(item);
 }
 
 
 // ACTIONS
 if(options["noactions"])
 {
  UI_Element_Find(page, "actions").style.display = "none";
 }
 
 
 var container = UI_Element_Find(page, "actions-standard");
 
 // ASSESSMENT
 if(options["assessment"])
 {
  // OPEN CLASSROOM
  var text       = UI_Language_String("classes/class-preview", "button assessment");
  var button     = UI_Element_Create("core/button-small-light", {text}); 
  Document_Element_SetObject(button, "class", classdata);
  container.appendChild(button);
  button.onclick = 
  async function(event)
  {
   var element = event.currentTarget;
   var data    = Document_Element_GetObject(element, "class");
   
   await Assessment_Class_Display(data["id"], {popup:true});
  }
 }
 
 
 // CLASSROOM
 if(options["classroom"])
 {
  // OPEN CLASSROOM
  var text       = UI_Language_String("classes/class-preview", "button classroom");
  var button     = UI_Element_Create("core/button-small-light", {text}); 
  Document_Element_SetObject(button, "class", classdata);
  container.appendChild(button);
  button.onclick = options["classroom"];
 }
  
 
 if(options["online"])
 {
  // ONLINE
  var container = UI_Element_Find(page, "actions-online");
 
  // URL
  var element         = UI_Element_Create("core/control-edit-plain"); 
  element.placeholder = UI_Language_String("classes/class-preview", "caption stream"); 
  element.value       = classdata["classroom_url"] || "";
  Document_Element_SetObject(element, "class", classdata);
 
  element.onchange    = 
  function(event)
  {
   var element = event.currentTarget;
   var data    = Document_Element_GetObject(element, "class");
    
   data["classroom_url"] = element.value;
   Core_Api("Class_Field_Set", {id:data["id"], field:"classroom_url", value:element.value});
  }  
 
  container.appendChild(element);
 
  // OPEN URL
  var button     = UI_Element_Create("core/button-square-light", {text:"<li class = 'fa fa-arrow-up-right-from-square'></li>"}); 
  Document_Element_SetObject(button, "class", classdata);
 
  button.onclick = 
  function(event)
  {
   var element = event.currentTarget;
   var data    = Document_Element_GetObject(element, "class");
  
   window.open(data["classroom_url"], "classroom", "popup, fullscreen=yes");
  }
 
  container.appendChild(button);
 }
 
 
 return page;
}



function Class_Info(item)
{
 var data        = {};
 var locale      = UI_Language_Current(true);
  
 data["date"]    = Date_Format(item["date_start"], locale, "date-shortmonth-weekday-noyear");
 data["lesson"]  = item["lesson_id"];
 data["time"]    = Date_Format(item["date_start"], locale, "time-only") + "<br>" + Date_Format(item["date_end"], locale, "time-only");
 data["teacher"] = [Safe_Get(item, ["teacher", "firstname"], ""), Safe_Get(item, ["teacher", "lastname"], "")].join(" ").trim();
  
 if(item["online"] == 1)
 {
  data["online"] = "<li class = 'fa fa-globe'></li>";
 }
 else
 {
  data["online"] = "";
 }
 
 return data;
}

async function Classes_User_Set(event)
{
 var element = event.currentTarget;
 var field   = Document_Element_GetData(element, "field");
 var value   = element.value;
 var id   = Document_Element_GetData(element, "userid");

 await Core_Api("User_Update_Field", {user_id:id, field:field, value:value});
}
// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                        D I S P L A Y                                           //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



async function Class_Display(id, options = {})
{
 var data = await Core_Api("Class_Read", {class_id:id, options:{users:true, seats:true}});
 Core_State_Set("classes", ["display", "data"], data);
 Core_State_Set("classes", ["display", "modified"], false);
 
 //console.log(data);
 
 var buttons = [];
 
 if(options["delete"])
 {
  var button = 
  {
   text: "delete",
   onclick: false
  }
  
  buttons.push(button);
 }
  
 var center     = Safe_Get(data, ["info", "center_id"]);
 var date_start = Safe_Get(data, ["info", "date_start"]);
 var date_end   = Safe_Get(data, ["info", "date_end"]);  
 
 var time_from = Date_Portion(date_start, "time-timecode");
 var time_to   = Date_Portion(date_end,   "time-timecode");
 var title     = Centers_Name(center) + " / " + Date_Format(date_start, UI_Language_Current(true), "date-long-weekday") + " / " + time_from + " - " + time_to;
 
 var content = UI_Element_Create("classes/class-display", {id:"#" + id, title}, {language:"classes/class-display"});
 Core_State_Set("classes", ["display", "content"], content);


 // STAFF
 Class_Display_Staff();
 
 
 // STUDENTS
 Class_Display_Students();
 
 
 // SLOT
 Class_Display_Data();
 
 var promise = new Promise(async(resolve, reject) =>
 { 
  await UI_Popup_Create({content}, buttons, "classes/class-popup", {escape:true, open:true, onclose:
  async function()
  {
   // OPTIONAL RELOAD AND RETURN
   if(options["reload"]) var data = await Core_Api("Class_Read", {class_id:id, options:{users:true, seats:true}});
   
   resolve(data);
  }});
  
 });
 
 return promise;
}




function Class_Display_Data()
{
 var data      = Core_State_Get("classes", ["display", "data"]);
 var content   = Core_State_Get("classes", ["display", "content"]);
 
 
 // TYPE
 var element      = UI_Element_Find(content, "class-type");
 UI_Select_FromConfig(element, ["lesson-types"]);
 var type         = Safe_Get(data, ["info", "type"], "");
 element.value    = type;
 element.onchange = Class_Display_UpdateField;
 
 // CENTER
 var element   = UI_Element_Find(content, "class-center");
 var center    = Safe_Get(data, ["info", "center_id"], "");
 var text      = Centers_Name(center);
 element.value = text;
 element.setAttribute("readonly", true);
 
 
 // ROOM
 var element     = UI_Element_Find(content, "class-room");
 var room        = Safe_Get(data, ["info", "classroom_id"], "");
 element.value   = room;
 element.setAttribute("readonly", true);
 Document_CSS_SetClass(element, "style-clickable");
 element.onclick = Class_Display_ChangeRoom;
 
 // ONLINE
 var element      = UI_Element_Find(content, "class-online");
 UI_Select_FromDatapage(element, "classes/online");
 var online       = Safe_Get(data, ["info", "online"], "0");
 element.value    = online;
 element.onchange = Class_Display_ChangeOnline;
 
 Document_Event_Trigger(element, "change");

 
 
 // STREAM URL
 var element      = UI_Element_Find(content, "class-classroom_url");
 var url          = Safe_Get(data, ["info", "classroom_url"], "");
 element.value    = url;
 element.onchange = Class_Display_UpdateStream;
 
 // LESSON
 var element     = UI_Element_Find(content, "class-lesson");
 var lesson      = Safe_Get(data, ["info", "lesson_id"], "");
 element.value   = lesson;
 element.setAttribute("readonly", true);
 Document_CSS_SetClass(element, "style-clickable");
 element.onclick = Class_Display_ChangeLesson;
 
 // DATE
 var element     = UI_Element_Find(content, "class-date");
 var date        = Safe_Get(data, ["info", "date_start"], "");
 element.value   = Date_To_Input(date);
 element.setAttribute("readonly", true);
 
 // TIME
 var element     = UI_Element_Find(content, "class-time");
 var time        = Date_Portion(Safe_Get(data, ["info", "date_start"], ""), "time-timecode");
 element.setAttribute("readonly", true);
 element.value   = time;
 
 // SEATS
 var element      = UI_Element_Find(content, "class-seats");
 var seats        = Safe_Get(data, ["info", "seats_total"], "");
 element.setAttribute("readonly", true);
 element.value    = seats;
 element.onchange = Class_Display_UpdateField;
  
 // DURATION
 var element     = UI_Element_Find(content, "class-duration");
 var duration    = Safe_Get(data, ["info", "duration"], "");
 element.setAttribute("readonly", true);
 element.value   = Time_Format_Period(duration, UI_Language_Current(), " ");
 
 // NOTES
 var element      = UI_Element_Find(content, "class-notes");
 var notes        = Safe_Get(data, ["info", "notes"], "");
 element.value    = notes;
 element.onchange = Class_Display_UpdateField;
}




function Class_Display_Students()
{
 var data      = Core_State_Get("classes", ["display", "data"]);
 var content   = Core_State_Get("classes", ["display", "content"]);
 
 var container       = UI_Element_Find(content, "class-students");
 container.innerHTML = "";
  
 for(var seat of data["seats"])
 {
  var user = seat["student"];
  if(user)
  {
   var element = UI_Element_Create("classes/class-user", user);
   var picture = UI_Element_Find(element, "picture");
   
   var actions    = UI_Element_Find(element, "actions");
   
   var action     = UI_Element_Create("classes/user-action", {style:"solid", icon:"trash-can"});
   Document_Element_SetObject(action, "seat", seat);
   action.onclick = Class_Display_RemoveStudent;
   actions.appendChild(action);
   
   var hint       = UI_Language_String("classes/user", "attendance hint");
   var action     = UI_Element_Create("classes/user-checkbox", {hint});
   switch(seat["attendance"])
   {
    case "yes":
	case "late":
		action.checked = true;
	break;
	
	case "no":
		action.checked = false;
	break;
	
    default:
		action.indeterminate = true;
	break;
   }	   
   Document_Element_SetObject(action, "seat", seat);
   action.onclick = Class_Display_SetAttendance;
   actions.appendChild(action);
   

   User_Picture_Load(picture, user);
   
   container.appendChild(element);
  }
 }
 
 var element    = UI_Element_Create("classes/class-user-add", {position:""});
 container.appendChild(element);
 
 var actions    = UI_Element_Find(element, "actions");
 var action     = UI_Element_Create("classes/user-action", {style:"regular", icon:"square-plus"});
 action.onclick = Class_Display_AddStudent;
 actions.appendChild(action);
}




function Class_Display_Staff()
{
 var data      = Core_State_Get("classes", ["display", "data"]);
 var content   = Core_State_Get("classes", ["display", "content"]);
 
 var container       = UI_Element_Find(content, "class-staff");
 container.innerHTML = "";
 
 var positions = Core_Data_Sections("classes/class-staff");
 for(var position of positions)
 {
  var user = data[position];
  if(user)
  {
   var element = UI_Element_Create("classes/class-user", user);
   var picture = UI_Element_Find(element, "picture");
   
   User_Picture_Load(picture, user);
   
   var actions    = UI_Element_Find(element, "actions");
   
   var action     = UI_Element_Create("classes/user-action", {style:"solid", icon:"trash-can"});
   Document_Element_SetData(action, "position", position);
   action.onclick = Class_Display_UnsetStaff;
   actions.appendChild(action);
   
   container.appendChild(element);
  }
  else
  {
   var text    = UI_Language_String("classes/class-staff", position);
   var element = UI_Element_Create("classes/class-user-add", {position:text});
   
   var actions = UI_Element_Find(element, "actions");
  
   var action     = UI_Element_Create("classes/user-action", {style:"regular", icon:"square-plus"});
   Document_Element_SetData(action, "position", position);
   action.onclick = Class_Display_SetStaff;
   actions.appendChild(action);
   
   container.appendChild(element);
  }
 }
 
}




async function Class_Display_UpdateStream(event)
{
 var element  = event.currentTarget;
 var data     = Core_State_Get("classes", ["display", "data"]);
 var class_id = Safe_Get(data, ["info", "id"]);

 Safe_Set(data, ["classroom_url"], element.value);
 await Core_Api("Class_Field_Set", {id:class_id, field:"classroom_url", value:element.value});
 
 Core_State_Set("classes", ["display", "updated"], true);
}





async function Class_Display_UpdateField(event)
{
 var element  = event.currentTarget;
 var data     = Core_State_Get("classes", ["display", "data"]);
 var class_id = Safe_Get(data, ["info", "id"]);
 
 // EXTRACT FIELD FROM ELEMENT'S UID
 var field    = Document_Element_GetData(element, "uid").split("-")[1];
 
 // UPDATE IN MEMORY
 Safe_Set(data, [field], element.value);
 
 // UPDATE DB
 await Core_Api("Class_Field_Set", {id:class_id, field, value:element.value});
 
 // MARK CLASS AS UPDATED
 Core_State_Set("classes", ["display", "updated"], true);
}





async function Class_Display_UnsetStaff(event)
{
 var element  = event.currentTarget;
 var data     = Core_State_Get("classes", ["display", "data"]);
 var class_id = Safe_Get(data, ["info", "id"]); 
 
 // DETERMINE ROLE
 var position = Document_Element_GetData(element, "position");
 var role     = Core_Data_Value("classes/class-staff", position, "role");
 

 // CONFIRMATION POPUP
 var text     = UI_Language_Object(Core_Config(["roles"])[role]);
 var title    = UI_Language_String("classes/popups", "staff delete title", {role:text}); 
 var content  = UI_Language_String("classes/popups", "staff delete text", {role:text}); 
 var picture  = Resources_URL("images/cover-logout.png");
 
 var confirm  = await UI_Popup_Confirm(title, content, picture);
 if(!confirm) return;
 
 
 
 // DETERMINE DATE
 var dates      = [];
 var date_start = Safe_Get(data, ["info", "date_start"]);
 var date_end   = Safe_Get(data, ["info", "date_end"]);
 dates.push({date_start, date_end});

 
 // UNSET STAFF
 var field = Core_Data_Value("classes/class-staff", position, "field");
 await Core_Api("Class_Field_Set", {id:class_id, field, value:null});
 
 
 // RELOAD CLASS
 var data     = await Core_Api("Class_Read", {class_id, options:{users:true, seats:true}});
 Core_State_Set("classes", ["display", "data"], data);
 
 // REFRESH STAFF DISPLAY
 Class_Display_Staff();
 
 Core_State_Set("classes", ["display", "updated"], true);
}




async function Class_Display_SetStaff(event)
{
 var element  = event.currentTarget;
 var data     = Core_State_Get("classes", ["display", "data"]);
 var class_id = Safe_Get(data, ["info", "id"]); 
 
 // DETERMINE ROLE
 var position = Document_Element_GetData(element, "position");
 var role     = Core_Data_Value("classes/class-staff", position, "role");
 
 // DETERMINE CENTERS
 var center   = Safe_Get(data, ["info", "center_id"], User_Center());
 var centers  = Centers_Related(center, true);
 
 // DETERMINE DATE
 var dates      = [];
 var date_start = Safe_Get(data, ["info", "date_start"]);
 var date_end   = Safe_Get(data, ["info", "date_end"]);
 dates.push({date_start, date_end});
 
 var users = await Core_Api("Users_Available_Teach", {centers, roles:[role], dates, 
 options:
 {
  info:"firstname,lastname",
  utc: false
 }});
 
 users     = Object_To_Array(users);
 
 var user  = await Users_Popup_SelectFromList(users, {id:true, firstname:true, lastname:true}, "users/table-fields");
 if(!user) return;
 
 
 // SET STAFF
 var field = Core_Data_Value("classes/class-staff", position, "field");
 await Core_Api("Class_Field_Set", {id:class_id, field, value:user["id"]});
 
 
 // RELOAD CLASS
 var data     = await Core_Api("Class_Read", {class_id, options:{users:true, seats:true}});
 Core_State_Set("classes", ["display", "data"], data);
 
 // REFRESH STAFF DISPLAY
 Class_Display_Staff();
 
 Core_State_Set("classes", ["display", "updated"], true);
}



async function Class_Display_ChangeOnline(event)
{
 var element  = event.currentTarget;
 var data     = Core_State_Get("classes", ["display", "data"]);
 var class_id = Safe_Get(data, ["info", "id"]); 
 
 // DEPENDING ON ONLINE OR NOT, DISPLAY OR DO NOT DISPLAY THE "STREAM URL" FIELD
 var display = Core_State_Get("classes", ["display", "content"]);  
 if(element.value == "0")
 {
  UI_Element_Find(display, "row-stream").style.visibility = "hidden";
 }
 else
 {
  UI_Element_Find(display, "row-stream").style.visibility = "visible";
 }
 
 
 // UPDATE MEMORY & DB
 Safe_Set(data, ["info", "online"], element.value);
 await Core_Api("Class_Field_Set", {id:class_id, field:"online", value:element.value});
 
 Core_State_Set("classes", ["display", "updated"], true);
}



async function Class_Display_ChangeRoom(event)
{
 var element  = event.currentTarget;
 var data     = Core_State_Get("classes", ["display", "data"]);
 var class_id = Safe_Get(data, ["info", "id"]); 
 
 
 // CLASS CURRENT CENTER AND ROOM
 var center   = Safe_Get(data, ["info", "center_id"], "");
 var oldroom  = Safe_Get(data, ["info", "classroom_id"], "");
 
 
 // CLASS DATE, NEEDED TO CHECK ROOM AVAILABILITY
 var dates      = [];
 var date_start = Safe_Get(data, ["info", "date_start"]);
 var date_end   = Safe_Get(data, ["info", "date_end"]);
 dates.push({date_start, date_end});


 // FIND AVAILABLE ROOMS
 var rooms   = await Core_Api("Center_Rooms_Available", {center, dates, options:{utc:true}}); 
 
 
 // PICK ROOM FROM AVAILABLE ONES 
 var options = [];
 
 var option   = new Option();
 option.text  = oldroom;
 option.value = oldroom;
 options.push(option);
 
 for(var room of rooms)
 {
  option       = new Option();
  option.text  = room;
  option.value = room;
  
  options.push(option);
 }
 
 var newroom = await UI_Popup_Select(false, false, false, options); console.log(newroom);
 if(!newroom || newroom == oldroom) return;


 // UPDATE ROOM IN MEMORY
 Safe_Set(data, ["info", "classroom_id"], newroom);
 await Core_Api("Class_Field_Set", {id:class_id, field:"classroom_id", value:newroom});

 // UPDATE DISPLAY
 Class_Display_Data();
 
 Core_State_Set("classes", ["display", "updated"], true);
}







async function Class_Display_ChangeLesson(event)
{
 var element  = event.currentTarget;
 var data     = Core_State_Get("classes", ["display", "data"]);
 var class_id = Safe_Get(data, ["info", "id"]); 
 
 // CLASS CURRENT LESSON
 var lesson   = Safe_Get(data, ["info", "lesson_id"], "");
 
 var type      = Safe_Get(data, ["info", "type"], "");
 var typeChange = Safe_Get(data, ["type"],"");
 if(typeChange == "placement" || (typeChange == "" && type == "placement")) var newlesson = await Lesson_Popup_SelectTypePlacement(lesson);
 else
 var newlesson = await Lesson_Popup_SelectFromCatalog(lesson);
 if(!newlesson || newlesson == lesson) return;

 
 // CHANGING LESSON ALSO CHANGES CLASS TYPE
 var info    = await Core_Api("Lesson_Info", {lesson:newlesson, sections:["info"]});
 var newtype = Safe_Get(info, ["info", "type"], "standard");
 if(typeChange == "placement" || (typeChange == "" && type == "placement"))  var newtype = "placement";

 // UPDATE ROOM IN MEMORY
 Safe_Set(data, ["info", "lesson_id"], newlesson);
 Safe_Set(data, ["info", "type"],      newtype);
 
 await Core_Api("Class_Field_Set", {id:class_id, field:"lesson_id", value:newlesson});
 await Core_Api("Class_Field_Set", {id:class_id, field:"type",      value:newtype});


 // UPDATE DISPLAY
 Class_Display_Data();
 
 Core_State_Set("classes", ["display", "updated"], true);
}



async function Class_Display_SetAttendance(event)
{
 var element = event.currentTarget;
 var seat    = Document_Element_GetObject(element, "seat");
 
 if(element.checked) 
 {
  var value = "yes";
 }
 else 
 {
  var value = "no";
 }	 
 
 await Core_Api("Class_Seat_SetField", {id:seat["id"], field:"attendance", value});
 
 // SYNC ASSESSMENT, ATTENDANCE AND BEHAVIOR FOR SEATS THAT ARE SOMEHOW "CONNECTED" TO THIS ONE (COURSE / SESSION)
 Core_Api("Class_Seats_Sync", {id:seat["id"]});
}


async function Class_Display_AddStudent(event)
{
 var element  = event.currentTarget;
 var data     = Core_State_Get("classes", ["display", "data"]);
 var class_id = Safe_Get(data, ["info", "id"]); 
 

 // DETERMINE CENTERS
 var center   = Safe_Get(data, ["info", "center_id"], User_Center());
 var centers  = Centers_Related(center, true);
 
 // ROLES
 var roles    = ["student"];
 
 
 var user  = await Users_Popup_SelectFromSearch(centers, roles, "firstname,lastname", "25", "id");
 if(!user) return;
 
 
 // ADD STUDENT (SEAT)
 var seat =
 {
  student_id:user["id"]
 }
 await Core_Api("Class_Seat_Add", {class_id, data:seat});
 
 
 // RELOAD CLASS
 var data     = await Core_Api("Class_Read", {class_id, options:{users:true, seats:true}});
 Core_State_Set("classes", ["display", "data"], data);
 
 // REFRESH STAFF DISPLAY
 Class_Display_Students();
 
 Core_State_Set("classes", ["display", "updated"], true);
}




async function Class_Display_RemoveStudent(event)
{
 var element  = event.currentTarget;
 var data     = Core_State_Get("classes", ["display", "data"]);
 var class_id = Safe_Get(data, ["info", "id"]); 
 var seat     = Document_Element_GetObject(element, "seat");
 
 // CONFIRMATION POPUP
 var name     = [Safe_Get(seat, ["student", "firstname"], ""), Safe_Get(seat, ["student", "lastname"], "")].join(" ");
 var title    = UI_Language_String("classes/popups", "student delete title"); 
 var content  = UI_Language_String("classes/popups", "student delete text", {name}); 
 var picture  = Resources_URL("images/cover-logout.png");
 
 var confirm  = await UI_Popup_Confirm(title, content, picture);
 if(!confirm) return;
 
 await Core_Api("Class_Seat_Cancel", {id:seat["id"]});
 
 
 // RELOAD CLASS
 var data     = await Core_Api("Class_Read", {class_id, options:{users:true, seats:true}});
 Core_State_Set("classes", ["display", "data"], data);
 
 // REFRESH STAFF DISPLAY
 Class_Display_Students();
 
 Core_State_Set("classes", ["display", "updated"], true);
}



async function Class_Display_NoEdit(id, options = {})
{
 var data = await Core_Api("Class_Read", {class_id:id, options:{users:true, seats:true}});
 Core_State_Set("classes", ["display", "data"], data);
 Core_State_Set("classes", ["display", "modified"], false);
 
 var buttons = [];
  
 var center     = Safe_Get(data, ["info", "center_id"]);
 var date_start = Safe_Get(data, ["info", "date_start"]);
 var date_end   = Safe_Get(data, ["info", "date_end"]);  
 
 var time_from = Date_Portion(date_start, "time-timecode");
 var time_to   = Date_Portion(date_end,   "time-timecode");
 var title     = Centers_Name(center) + " / " + Date_Format(date_start, UI_Language_Current(true), "date-long-weekday") + " / " + time_from + " - " + time_to;
 
 var content = UI_Element_Create("classes/class-display", {id:"#" + id, title}, {language:"classes/class-display"});
 Core_State_Set("classes", ["display", "content"], content);


 // STAFF
 var container       = UI_Element_Find(content, "class-staff");
 container.innerHTML = "";
 
 var positions = Core_Data_Sections("classes/class-staff");
 for(var position of positions)
 {
  var user = data[position];
  if(user)
  {
   var element = UI_Element_Create("classes/class-user", user);
   var picture = UI_Element_Find(element, "picture");
   
   User_Picture_Load(picture, user);
   
   container.appendChild(element);
  }
  else
  {
   var text    = UI_Language_String("classes/class-staff", position);
   var element = UI_Element_Create("classes/class-user-add", {position:text});
   
   container.appendChild(element);
  }
 }
 
 
 // STUDENTS
 var container       = UI_Element_Find(content, "class-students");
 container.innerHTML = "";
  
 for(var seat of data["seats"])
 {
  var user = seat["student"];
  if(user)
  {
   var element = UI_Element_Create("classes/class-user", user);
   var picture = UI_Element_Find(element, "picture");

   User_Picture_Load(picture, user);
   
   container.appendChild(element);
  }
 }
 
 
 // SLOT
 // TYPE
 var element      = UI_Element_Find(content, "class-type");
 UI_Select_FromConfig(element, ["lesson-types"]);
 var type         = Safe_Get(data, ["info", "type"], "");
 element.value    = type;
 element.setAttribute("disabled", true);
 
 // CENTER
 var element   = UI_Element_Find(content, "class-center");
 var center    = Safe_Get(data, ["info", "center_id"], "");
 var text      = Centers_Name(center);
 element.value = text;
 element.setAttribute("readonly", true);
 
 // ROOM
 var element     = UI_Element_Find(content, "class-room");
 var room        = Safe_Get(data, ["info", "classroom_id"], "");
 element.value   = room;
 element.setAttribute("readonly", true);
 
 // ONLINE
 var element      = UI_Element_Find(content, "class-online");
 UI_Select_FromDatapage(element, "classes/online");
 var online       = Safe_Get(data, ["info", "online"], "0");
 element.value    = online;
 element.setAttribute("disabled", true);
 
 if(online == "0") UI_Element_Find(content, "row-stream").style.visibility = "hidden";
 // STREAM URL
 var element      = UI_Element_Find(content, "class-classroom_url");
 var url          = Safe_Get(data, ["info", "classroom_url"], "");
 element.value    = url;
 element.onchange = Class_Display_UpdateStream;
 
 // LESSON
 var element     = UI_Element_Find(content, "class-lesson");
 var lesson      = Safe_Get(data, ["info", "lesson_id"], "");
 element.value   = lesson;
 element.setAttribute("readonly", true);
 
 // DATE
 var element     = UI_Element_Find(content, "class-date");
 var date        = Safe_Get(data, ["info", "date_start"], "");
 element.value   = Date_To_Input(date);
 element.setAttribute("readonly", true);
 
 // TIME
 var element     = UI_Element_Find(content, "class-time");
 var time        = Date_Portion(Safe_Get(data, ["info", "date_start"], ""), "time-timecode");
 element.setAttribute("readonly", true);
 element.value   = time;
 
 // SEATS
 var element      = UI_Element_Find(content, "class-seats");
 var seats        = Safe_Get(data, ["info", "seats_total"], "");
 element.setAttribute("readonly", true);
 element.value    = seats;
  
 // DURATION
 var element     = UI_Element_Find(content, "class-duration");
 var duration    = Safe_Get(data, ["info", "duration"], "");
 element.setAttribute("readonly", true);
 element.value   = Time_Format_Period(duration, UI_Language_Current(), " ");
 
 // NOTES
 var element      = UI_Element_Find(content, "class-notes");
 var notes        = Safe_Get(data, ["info", "notes"], "");
 element.value    = notes;
 element.setAttribute("readonly", true);
 
 var promise = new Promise(async(resolve, reject) =>
 { 
  await UI_Popup_Create({content}, buttons, "classes/class-popup", {escape:true, open:true, onclose:
  async function()
  {
   // OPTIONAL RELOAD AND RETURN
   if(options["reload"]) var data = await Core_Api("Class_Read", {class_id:id, options:{users:true, seats:true}});
   
   resolve(data);
  }});
  
 });
 
 return promise;
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                       S E A R C H                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Classes_Search_Display(fixed = {}, options = {}, resources = {})
{
 // RESET BOOKING POPUP IF ANY
 Core_State_Set("classes", "booking-popup", false);
 
 
 // CREATE DISPLAY 
 var display = UI_Element_Create("classes/search-display", {}, {language:"classes/search-display"});
 
 // 1. SET UP RESOURCES
 
 // CENTERS
 var centers = resources["centers"] || Array_From_Fields(Centers_Available(), "id");
 if(fixed["center"]) Array_PushUnique(centers, fixed["center"]);
 
 
 // LESSON TYPES
 var types = resources["types"]   || Object.keys(Core_Config("lesson-types")); 
 if(fixed["type"]) Array_PushUnique(types, fixed["type"]);
 
 
 // LESSONS CONTENT
 var lessons = await Resources_Lessons();
 lessons     = lessons["list"];
 
 switch(typeof resources["lessons"])
 {
  // FILTER: ONLY LESSONS BEGINNING WITH THIS TAG
  case "string":
	var filtered = [];
	var filter   = resources["lessons"].toLowerCase();
	for(var lesson of lessons) if(lesson.toLowerCase().startsWith(filter)) filtered.push(lesson);
	
	lessons = filtered;
  break;
  
  // EXPLICIT LIST
  case "object":
	lessons = resources["lessons"];
  break;
 }
 
 if(fixed["lesson"]) Array_PushUnique(lessons, fixed["lesson"]);
 
 

 
 
 // 2. SET UP DROPWDOWNS
 
 // SEARCH: CENTERS
 var select = UI_Element_Find(display, "search-center");
 
 Document_Select_AddOption(select, "", "");
 for(var center of centers)
 {
  var text  = Centers_Name(center); 
  var value = center;
  Document_Select_AddOption(select, text, value);
 }
 
 select.value = fixed["center"] || User_Center();
 
 
 // SEARCH: LESSON TYPES
 var select = UI_Element_Find(display, "search-type");
 
 Document_Select_AddOption(select, "", "");
 for(var type of types)
 {
  var text  = UI_Language_Object(Core_Config(["lesson-types", type], {}), type);
  var value = type;
  Document_Select_AddOption(select, text, value);
 }
 

 
 // SEARCH: LESSON CONTENT 
 var select = UI_Element_Find(display, "search-lesson");
 
 Document_Select_AddOption(select, "", "");
 for(var lesson of lessons)
 {
  Document_Select_AddOption(select, lesson, lesson);
 }

 // SEARCH: DATE FROM
 var select = UI_Element_Find(display, "search-datefrom");
 
 UI_Select_FromDatapage(select, "classes/search-datefrom");
 
 
 // SEARCH: DATE TO
 var select = UI_Element_Find(display, "search-dateto");
 
 UI_Select_FromDatapage(select, "classes/search-dateto");
 
 
 // SEARCH: TIME
 var select = UI_Element_Find(display, "search-time");
 
 Document_Select_AddOption(select, "", "");
 UI_Select_FromDatapage(select, Core_Config("shifts"));
 
 select.onchange = Classes_Search_DisplayResults;
 
 
 // OPTIONS: ONLINE
 var select = UI_Element_Find(display, "options-online");
 
 Document_Select_AddOption(select, "", "");
 UI_Select_FromDatapage(select, "classes/options-online");
 
 
 // OPTIONS: TEACHER
 var select = UI_Element_Find(display, "options-teacher");
 
 Document_Select_AddOption(select, "", "");
 UI_Select_FromDatapage(select, "classes/options-teacher");


 // OPTIONS: OVERBOOK
 var select = UI_Element_Find(display, "options-seat");
 
 Document_Select_AddOption(select, "", "");
 UI_Select_FromDatapage(select, "classes/options-seat");
  
 
 
 



 // 3. SHOW / HIDE FIELDS DEPENDING ON FIXED SEARCH FIELDS
 for(var field of ["center", "type", "lesson", "datefrom", "dateto", ,"seat", "online", "time"])
 {
  var box    = UI_Element_Find(display, "box-search-" + field);
  var select = UI_Element_Find(box, "search-" + field);
  
  if(fixed[field])
  {	 console.log("hide " + field);
   Document_Element_Disable(select, "style-disabled");
   if(!options["nohide"]) box.style.display = "none";
   
   select.value = fixed[field];
  }
 }
 
 
 
 
 // 4. SHOW / HIDE FIELDS DEPENDING ON FIXED OPTIONS FIELDS
 for(var field of ["seat", "online", "teacher"])
 {
  var box    = UI_Element_Find(display, "box-options-" + field);
  var select = UI_Element_Find(box, "options-" + field);
  
  if(options[field])
  {	 
   Document_Element_Disable(select, "style-disabled");
   if(!options["nohide"]) box.style.display = "none";
   
   select.value = fixed[field];
  }
 }
 
 
 // SEARCH BUTTON
 var button     = UI_Element_Find(display, "search-button");
 button.onclick = Classes_Search_Execute;
 
 

/*
 
 // BOOK BUTTON
 var button     = UI_Element_Find(display, "book-button");
 button.onclick = Booking_Book; 
*/


 // 5. STORE STATE
 Core_State_Set("classes", "search-fixed",     fixed);
 Core_State_Set("classes", "search-options",   options);
 Core_State_Set("classes", "search-resources", resources);
 
 Core_State_Set("classes", "search-display",   display);
 
 
 // 6. AUTOSEARCH
 if(options["autosearch"])
 {
  // HIDE SEARCH PANEL
  UI_Element_Find(display, "panel-search").style.display = "none";
  
  // SEARCH AWAY
  Classes_Search_Execute();
 }
 
 
 
 return display;
}





async function Classes_Search_Execute()
{
 var display = Core_State_Get("classes", "search-display");
 var options = Core_State_Get("classes", "search-options");
  
 // DETERMINE SEARCH OPTIONS BASED ON SEARCH PANEL VALUES
 var search = {};
 
 
 // CENTER
 var center = UI_Element_Find(display, "search-center").value;
 if(center) search["centers"] = [center];
 
 
 // TYPE
 search["type"] = UI_Element_Find(display, "search-type").value; 
 
 
 // LESSON
 search["lesson"] = UI_Element_Find(display, "search-lesson").value;
 
 
 // DATE FROM
 var period          = UI_Element_Find(display, "search-datefrom").value;
 search["date_from"] = Date_Period_Time(period, "start");
 
 
 // DATE TO
 var period          = UI_Element_Find(display, "search-dateto").value;
 search["date_to"] = Date_Period_Time(period, "end");
 
 
 
 var options       = {};
 options["fields"] = "id,date_start,date_end,teacher_id,center_id,online,lesson_id";
 
 // TEACHER REQUIRED?
 switch(UI_Element_Find(display, "options-teacher").value)
 {
  case "required":
	options["teacher"] = true;
  break;
  
  case "not required":
	options["teacher"] = false;
  break;
 }
 
 
 // FREE SEAT REQUIRED?
 switch(UI_Element_Find(display, "options-seat").value)
 {
  case "required":
	options["seat"] = true;
  break;
  
  case "not required":
	options["seat"] = false;
  break;
 }
 
 
 // ONLINE / OFFLINE?
 switch(UI_Element_Find(display, "options-online").value)
 {
  case "yes":
	options["online"] = true;
  break;
  
  case "no":
	options["online"] = false;
  break;
 }
 


 
 // EXECUTE SEARCH
 var classes = await Core_Api("Classes_Search", {search, options, info:{teacher:true}});
 Core_State_Set("classes", "search-results", classes);
 
 
 // DISPLAY RESULTS
 Classes_Search_DisplayResults();
}





function Classes_Search_DisplayResults()
{ 
 var display = Core_State_Get("classes", "search-display");
 
 var panel       = UI_Element_Find(display, "search-results"); 
 panel.innerHTML = "";
 
 // CLEAR DETAILS
 UI_Element_Find(display, "panel-detail").style.visibility = "hidden";


 // GET RESULTS
 var classes = Core_State_Get("classes", "search-results", false); 
 if(classes === false) return;
 
 
 // FILTER RESULTS BY TIME
 var filter = UI_Element_Find(display, "search-time").value;
 
 if(!filter)
 {
  var filtered = classes;
 }
 else
 {
  filter    = Core_Config(["shifts", filter]);
  time_from = Time_To_Minutes(filter["from"]);
  time_to   = Time_To_Minutes(filter["to"]);
  
  var filtered  = [];
  for(var item of classes)
  {
   var time = Time_To_Minutes(Date_Portion(item["date_start"], "time-only")); 
   if(Numbers_Between(time, time_from, time_to))
   {
	filtered.push(item);
   }
  }
 }



 // PROCESS FILTERED LIST
 if(filtered.length == 0) return;
 
 for(var item of filtered)
 {
  item["day"] = Date_Portion(item["date_start"], "date-only");
 }
 
 

 // ASSEMBLE LIST
 var list = UI_List_Items(filtered, ["style-outlined-accented", "outline-inner"], Classes_Search_DisplayDetails, {style:"vertical", overflow:true, sections:"day"},
 
 // ITEMS
 function(item)
 { 
  var info = Class_Info(item);
  
  var element = UI_Element_Create("classes/search-item", info);
  Document_Element_SetObject(element, "item", item);
  
  return element;
 },
 
 // SECTIONS
 function(section, item)
 {
  var day     = Date_Format(section, UI_Language_Current(true), "date-long-weekday-noyear");
  
  var element = UI_Element_Create("classes/search-section", {day});
  return element;
 });
 
 
 
 // DISPLAY
 panel.appendChild(list);
 panel.style.visibility = "visible";
}





async function Classes_Search_DisplayDetails(element, item)
{
 var display   = Core_State_Get("classes", "search-display");
 var options   = Core_State_Get("classes", "search-options");
 var resources = Core_State_Get("classes", "search-resources");
  
 // DISPLAY
 if(!item) var item = Document_Element_GetObject(element, "item");
 var page = await Class_Preview(item["id"], {noactions:true, attendance:false});
 
 // BUTTONS
 UI_Element_Find(display, "preview-buttons").innerHTML = "";
 
 // BOOKING
 if(options["book"])
 {
  var button  = UI_Element_Create("core/button-small-stretch", {text:UI_Language_String("classes/search-display", "button book")});
  var student = resources["student"];

  Document_Element_SetObject(button, "student", student); 
  Document_Element_SetObject(button, "class", item);
  
  button.onclick = Classes_Search_Book;
  
  UI_Element_Find(display, "preview-buttons").appendChild(button);
 }
 
 
 var panel       = UI_Element_Find(display, "search-detail");
 panel.innerHTML = "";
 panel.appendChild(page);
 

 // SHOW
 Core_State_Set("classes", "class", item);
 UI_Element_Find(display, "panel-detail").style.visibility = "visible"; 
}



async function Classes_Search_Book(event)
{
 var element   = event.currentTarget;
 var student   = Document_Element_GetObject(element, "student");
 var data      = Document_Element_GetObject(element, "class");
 var resources = Core_State_Get("classes", "search-resources"); 
 var lesson    = Core_State_Get("classes", ["preview", "lesson"]);
 
 // IF STUDENT ID PASSED RATHER THAN THE WHOLE STUDENT, READ IT
 if(student && typeof student != "object")
 {
  student = await Core_Api("User_Read", {user_id:student, fields:"id,firstname,lastname"});
 }
 
 // IF NO STUDENT SELECTED, PICK ONE MANUALLY 
 if(!student)
 {
  var student = await Users_Popup_SelectFromSearch(resources["centers"], ["student"], "id,firstname,lastname", 25, "firstname,lastname");
  if(!student) return;
 }
 
 
 // GET INFO STORED BY PREVIEW
 var info         = {};
 info["lesson"]   = Core_State_Get("classes", ["preview", "class", "info", "lesson_id"]);
 info["class_id"] = Core_State_Get("classes", ["preview", "class", "info", "id"]);
 info["title"]    = UI_Language_Object(Core_State_Get("classes", ["preview", "lesson", "title"], {}));
 
 var date         = Core_State_Get("classes", ["preview", "class", "info", "date_start"]);
 info["date"]     = Date_Format(date, UI_Language_Current(true), "date-long-weekday");
 
 info["name"]     = [student["firstname"] || "", student["lastname"] || ""].join(" ").trim();
 
 
 // CONFIRMATION POPUP 
 var title    = UI_Language_String("classes/popups", "book confirm title");
 var text     = UI_Language_String("classes/popups", "book confirm text", info);
 var picture  = Resources_URL("images/cover-booking.png");
 
 var confirm  = await UI_Popup_Confirm(title, text, picture);
 if(!confirm) return;
 
 // BOOK SEAT
 var seat           = {};
 seat["student_id"] = student["id"];
 
 var seat_id = await Core_Api("Class_Seat_Add", {class_id:info["class_id"], data:seat});
 
 // IF THE SEARCH WAS LAUNCHED IN AUTOSEARCH & BOOKING MODE, CLOSE THE POPUP
 // THIS WILL ALSO RESOLVE THE BOOKING PROMISE
 var popup = Core_State_Get("classes", "booking-popup");
 if(popup)
 {
  Core_State_Set("classes", "booked-seat", seat_id);
  UI_Popup_Close(popup);
 }
 else
 {
  // RELOAD PREVIEW
  var item = Core_State_Get("classes", "class");
  Classes_Search_DisplayDetails(false, item);
 }
 
 // RETURN BOOKED SEAT
 return seat_id;
}





async function Classes_Search_Popup(fixed = {}, options = {}, resources = {})
{
 // RESET BOOKING RESULT
 Core_State_Set("classes", "booked-seat",  false);
 
 // CREATE SEARCH DISPLAY
 var content = await Classes_Search_Display(fixed, options, resources);
 
 if(options["autosearch"])
 {
  var template = "auto";
 }
 else
 {
  var template = "standard";
 }
 
 // CREATE BOOKING PROMISE
 var promise = new Promise(async(resolve, reject) =>
 { 
 
  // CREATE POPUP AND FILL IT WITH SEARCH DISPLAY
  var popup = await UI_Popup_Create({content}, [], "classes/search-popup-" + template, {escape:true, open:true, onclose:
  function()
  {
   // ON POPUP CLOSED, MAKE THE BOOKING PROMISE RETURN THE BOOKED SEAT (IF ANY)
   var seat = Core_State_Get("classes", "booked-seat");
   
   resolve(seat);
  }});
  
  // SET BOOKING POPUP SO THAT UPON BOOKING ACTION SUCCESSFUL, IT WILL BE CLOSED AND THE 
  // BOOKING PROMISE WILL BE RESOLVED
  Core_State_Set("classes", "booking-popup", popup);
 });
 
 return promise;
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                        M A N A G E                                             //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

function Classroom_Manage()
{ 
 var presentation = Core_State_Get("classroom", ["presentation"]);
 
 // DISPLAY INFO
 var lesson    = Core_State_Get("classroom", ["lesson"]);
 var classdata = Core_State_Get("classroom", ["class"]);
 
 var title = lesson["title"] || {};
 title     = UI_Language_Object(title) || "";
 var date  = Safe_Get(classdata, ["info", "date_start"], "");
 date      = Date_Format(date);
 
 var info       = UI_Element_Find("header-info");
 info.innerHTML = title.toUpperCase() + " / " + date.toUpperCase();
 
 
 
 // DOCUMENTS MENU
 var documents = Safe_Get(lesson, "documents", []);
 var items     = {};
 for(var file of documents)
 {
  file = file || "";
  file = file.trim();//.toLowerCase();
  
  var item =
  {
   text:    String_Capitalize_Initial(file),
   state:   "enabled",
   tag:     file,
   func:    
   function(item)
   {
	var file = Document_Element_GetObject(item, "tag");
	Classroom_Manage_DisplayFile(file)
   }
  }
  
  items[file] = item;
 }
 var menu = UI_Menu_Create("files-menu", items);
 Core_State_Set("classroom", "files-menu", menu);
 
 
 
 // DISPLAY RIGHT PANEL SELECTOR
 var items  = {};
 
 items["lessonplan"] =
 {
  text    : UI_Language_String("classroom", "selector lessonplan caption"),
  onclick : Classroom_Manage_DisplayLessonplan
 }
 
 items["files"] =
 {
  text    : UI_Language_String("classroom", "selector files caption"),
  onclick : Classroom_Manage_DisplayFiles
 }
 
 items["instructions"] =
 {
  text :   UI_Language_String("classroom", "selector instructions caption"),
  onclick: Classroom_Manage_DisplayInstructions
 }
 
 items["assessment"] =
 {
  text :   UI_Language_String("classroom", "selector assessment caption"),
  onclick: Classroom_Manage_DisplayAssessment
 }
 
 items["project"] =
 {
  text :   UI_Language_String("classroom", "selector project caption"),
  onclick: Classroom_Manage_DisplayProject
 }

 // ADD REVIEW MENU IF COURSE PROGRAM HAVE REVIEW
 var course_program = Core_State_Get("course",["current-course","program"]);
 var programs = Core_Config("programs");
 if((typeof programs[course_program] !== "undefined") && (typeof programs[course_program]["review"] !== "undefined") && programs[course_program]["review"] == "yes")
 {
  items["review"] =
  {
   text :   UI_Language_String("classroom", "selector review caption"),
   onclick: Classroom_Manage_DisplayReminder
  }
 }
 
 var header = UI_Header("header-selector", items, {selectfirst:false, css:"color-noted"});
 Core_State_Set("classroom", "selector-right", header);
 Classroom_Manage_UpdateSelector();
 
 UI_Element_Find("header-right").appendChild(header);
 
 
 
 
 // SLIDES THUMBNAILS
 var list  = UI_Element_Find("presentation-thumbnails");
 var stage = "";
 for(var slide of presentation["slides"])
 {  
  // CREATE SLIDE THUMBNAIL
  var thumbnail              = UI_Element_Create("classroom/slide-thumbnail");
  thumbnail.onclick          = Classroom_Manage_SelectSlide;  
  slide["thumbnail"]         = thumbnail;
  Document_Element_SetObject(thumbnail, "slide", slide);
  
  
  // GET SLIDE MENU AND ASSIGN IT TO THE THUMBNAIL
  var menu = slide["menu"];
  UI_Menu_Assign(thumbnail, menu);
  
  // GET SLIDE THUMBNAILS STAGE AND APPEND TO LIST
  var currentstage = Safe_Get(slide, ["header", "stage"], "");
  if(currentstage != "" && stage != currentstage){

    stage = currentstage;

    currentstage = stage.replaceAll("\n", "<br>");
    stage = currentstage.replaceAll("\r\n", "<br>");
    currentstage = UI_Language_String("presentation/stages", currentstage);
    
    var thumbnailstage = UI_Element_Create("classroom/slide-stage-thumbnail");

    UI_Element_Find(thumbnailstage, "slide-thumb-stage").innerHTML = currentstage;

    list.appendChild(thumbnailstage);
  }
  
  // APPEND THUMBNAIL TO LIST AND RENDER
  list.appendChild(thumbnail);  
  Presentation_Slide_Render(slide, thumbnail);
  //CHECK AND ADD LISTENER FOR IFRAME
  if(thumbnail.firstChild.tagName == "IFRAME"){
   //CREATE LAYER 
   div = document.createElement("div")
   div.style.position = "absolute";
   div.style.height = "100%";
   div.style.width = "100%";
   div.style.zIndex = 3;

   thumbnail.insertBefore(div,thumbnail.firstChild);

   div.onclick = function(e){
      div.style.zIndex = 0;
   }

   thumbnail.children[1].onmouseout = function(e){
      if(document.activeElement.tagName != "IFRAME")
      div.style.zIndex = 3;
   }
  }
}
 
 
 // USERS
 var classdata = Core_State_Get("classroom", ["class"]);
 var seats     = classdata["seats"] || [];
 
 
 // CREATE USER CARDS
 var container = UI_Element_Find("presentation-students");
 var count     = 0;
 for(var seat of seats)
 { 
  var student = Safe_Get(seat, ["student"], {});
  
  var card    = User_Card(student, "compact");
  Document_CSS_SetClass(card, "style-clickable");
  Document_CSS_SetClass(card, "effect-highlight-outline");  
  Document_Element_SetObject(card, "seat", seat);
  
  card.style.visibility = "hidden";
  card.onclick          = Classroom_Manage_SelectStudent;
  // CHANGE FIRSTNAME TO NICKNAME IF HAS NICKNAME
  if(Boolean(student["nickname"]))
  {
   var name = UI_Element_Find(card,"firstname");
   name.innerHTML = student["nickname"];
  } 
      
  // CARD MENU
  var items = {};
  
  // EMOJIS
  var emojis     = Core_Data_Page("classroom/attract");
  var menu       = UI_Menu_FromObject(student["id"], emojis, "category", Classroom_Manage_SendAttract);
  Document_Element_SetObject(menu, "student", student);
  Document_Element_SetObject(menu, "seat",    seat);
  
  UI_Menu_Assign(card, menu);
  
  container.appendChild(card);
  count = count + 1;
 }
 
 
 // FILL SPACE WITH EMPTY SLOTS
 // TOTAL SEATS ARE EITHER THE CLASS' SPECIFIED SEATS_TOTAL, OR THE MAXIMUM ALLOWED BY MODULE CONFIGURATION
 var total     = Safe_Get(classdata, ["info", "seats_total"], Module_Config("classroom", "student-slots", 0));
 
 for(var i = count; i< total; i++)
 {
  var card              = User_Card({}, "compact");
  card.style.visibility = "hidden";
  
  Document_CSS_PurgeClasses(card, "shadow");

  container.appendChild(card);  
 }
 
 
 
 // SWITCHES
 UI_Element_Find("switch-present").onclick    = Classroom_Manage_Present;
 
 UI_Element_Find("switch-timer").onclick      = Classroom_Manage_Timer;
 
 UI_Element_Find("switch-summary").onclick    = Classroom_Manage_LessonSummary;
 
//  UI_Element_Find("switch-pointer").onclick    = Classroom_Manage_SwitchPointer;
 
 UI_Element_Find("switch-whiteboard").onclick = Classroom_Manage_SwitchWhiteboard;
 
 UI_Element_Find("switch-assessment").onclick = Classroom_Manage_Assessments;
 
 UI_Element_Find("switch-setting").onclick = Classroom_Settings;

 // ANIMATE ELEMENTS
 
 // SLIDE THUMBNAILS
 /*
 var container = UI_Element_Find("presentation-thumbnails");
 Document_Element_AnimateChildren(container, "slideInLeft 0.250s 1", 
 {
  delay:    250, 
  interval: 0, 
  onstart:
  function(element) 
  {
   element.style.visibility = "visible";
  }
 });
 */
 
 // STUDENTS
 var container = UI_Element_Find("presentation-students");
 Document_Element_AnimateChildren(container, "zoomIn 0.250s 1", 
 {
  delay:    125, 
  interval: 125, 
  onstart:
  function(element) 
  {
   element.style.visibility = "visible";
  }
 });
 
}


async function Classroom_Settings() {
   const settingPopup = UI_Element_Create("classroom/setting-popup");
   const classroom = Core_State_Get("classroom");
   let config = classroom["config"];

   const speeds = [
      {
         name: "1s",
         value : 1
       },
       {
         name: "2s",
         value : 2
       },
       {
         name: "3s",
         value : 3
       },
       {
         name: "4s",
         value : 4
       }
   ];

   const animationDuration = UI_Element_Find(settingPopup, "animation-duration");
   Document_Select_OptionsFromObjects(animationDuration, speeds, "name", "value");
   config["animationDuration"] && (animationDuration.value = config["animationDuration"]);

   const popup = await UI_Popup_Create( {
      content : settingPopup
   } , [] , "");

   UI_Element_Find(settingPopup, "btn-save").onclick = async () => {
      console.log(animationDuration.value)
      console.log( Number(animationDuration.value));
      config = {
         ...classroom["config"],
         animationDuration : Number(animationDuration.value)};
      const data = await Core_Api("ClassRoom_Update_Config" , {
         id: classroom["current-class"],
         config
       })
      data && Core_State_Set("classroom" , ["config"], config);
      UI_Popup_Close(popup);
   };
}


function Classroom_Manage_DisplayFiles()
{	 
 var menu     = Core_State_Get("classroom", "files-menu");
 var position = Document_Element_Corner(UI_Element_Find("files"), "bottom"); 
 
 setTimeout(
 function()
 {
  UI_Menu_Show(menu, position["left"], position["top"] + parseInt(Document_CSS_GetValue("gap-medium", "gap")) * 2, {direction:"bottom"});
 }, 125);
}



function Classroom_Manage_DisplayFile(file)
{
 var lesson = Core_State_Get("classroom", "lesson", {}); 
 
 var page = UI_Element_Create("classroom/document-container");
 page.src = "content/lessons/" + lesson["source"] + "/documents/" + file;
 
 // DISPLAY
 var container       = UI_Element_Find("presentation-panel-right");
 container.innerHTML = "";
 container.appendChild(page);
}



function Classroom_Manage_DisplayLessonplan()
{ 
 // SEARCH LESSON.PDF IN DOCUMENTS
 var lesson    = Core_State_Get("classroom", "lesson", {}); 
 var documents = Safe_Get(lesson, "documents", []);
 var plan      = false;
 
 for(var file of documents)
 {
  file = file || "";
  file = file.trim().toLowerCase();
  if(["lesson plan.pdf", "plan.pdf"].includes(file))
  {
   plan = file;
   break;
  }
 }

 if(!plan) return;

 Classroom_Manage_DisplayFile(plan);
}



function Classroom_Manage_DisplayInstructions()
{
 var slide = Core_State_Get("classroom", "current-slide");
 
 Classroom_Manage_SlideInstructions();
}




function Classroom_Manage_DisplayAssessment()
{
 var seat  = Core_State_Get("classroom", "current-seat");
 
 Classroom_Manage_SelectStudent(false, seat);
}





function Classroom_Manage_UpdateSelector(set)
{
 var header = Core_State_Get("classroom", "selector-right");
 
 // IF THERE IS A PROJECT ASSOCIATED TO THIS LESSON, ENABLE PROJECT TAB, OTHERWISE DISABLE
 var project = Core_State_Get("classroom", ["lesson", "project", "source"]);
 if(project) UI_Header_Enable(header, "project"); else UI_Header_Disable(header, "project");
 
 // IF THERE IS A SELECTED SLIDE, ENABLE INSTRUCTIONS TAB, OTHERWISE DISABLE
 var slide = Core_State_Get("classroom", "current-slide");
 if(slide) UI_Header_Enable(header, "instructions"); else UI_Header_Disable(header, "instructions"); 
 
 // IF THERE IS A SELECTED STUDENT, ENABLE ASSESSMENT TAB, OTHERWISE DISABLE
 var seat  = Core_State_Get("classroom", "current-seat");
 if(seat) UI_Header_Enable(header, "assessment");   else UI_Header_Disable(header, "assessment"); 
 
 // IF THERE ARE FILES, ENABLE FILES TAB, OTHERWISE DISABLE
 var files  = Core_State_Get("classroom", ["lesson", "documents"]);
 if(files.length > 0 )
 {
  UI_Header_Enable(header, "files");
  // IF THERE IS PLAN FILE, ENABLE PLAN TAB, OTHERWISE DISABLE
  if(files.includes("Plan.pdf") || files.includes("plan.pdf") || files.includes("lesson plan.pdf")) UI_Header_Enable(header, "lessonplan");   else UI_Header_Disable(header, "lessonplan"); 
 }   
 else
 {
  UI_Header_Disable(header, "files"); 
  UI_Header_Disable(header, "lessonplan"); 
 } 
 
 if(set) UI_Header_Set(header, set);
}






async function Classroom_Manage_SelectStudent(event, seat)
{
 var container = UI_Element_Find("presentation-panel-right");
 var current   = Core_State_Get("classroom", ["current-seat"]);
 
 
 // IF COMING FROM A CLICK...
 if(!seat)
 {
  // GET STUDENT
  var element   = event.currentTarget;
  var seat      = Document_Element_GetObject(element, "seat");
 }
 
 
 Core_State_Set("classroom", ["current-seat"], seat);
 Classroom_Manage_UpdateSelector("assessment");
 
 // HIGHLIGHT CURRENT
 var list      = UI_Element_Find("presentation-students");
 Document_Conditional_Class(list, "style-outlined-accented", element); 
 
 // ASSEMBLE ASSESSMENT PAGE  
 var page    = await Assessment_Assess_Seat(seat["id"]);
 
 // DISPLAY
 container.innerHTML = "";
 container.appendChild(page);
}






function Classroom_Manage_SendVocabulary(item)
{  
 var id = Document_Element_GetData(item, "uid");
 
 Classroom_Manage_TriggerEvent("vocab", id);
}




function Classroom_Manage_SendAttract(item)
{ 
 var menu       = Document_Element_GetObject(item, "menu");
 var student    = Document_Element_GetObject(menu, "student"); 
 var seat       = Document_Element_GetObject(menu, "seat"); console.log(seat);
 
 var seat_id    = seat["id"];
 var student_id = student["id"]; 
 var attract_id = Document_Element_GetData(item, "uid");

 Classroom_Manage_TriggerEvent("attract", {seat_id, student_id, attract_id});
}




async function Classroom_Manage_Present()
{
 var { projector, config = {} } = Core_State_Get("classroom");
 var icon      = UI_Element_Find("switch-present");
 
 // ALREADY OPENED. CLOSE?
 
 if(projector)
 {
  /*
  var title    = UI_Language_String("classroom/manage", "popup close title"); 
  var content  = UI_Language_String("classroom/manage", "popup close subtitle"); 
  var picture  = Resources_URL("images/cover-presentation.jpg");

  var confirm  = await UI_Popup_Confirm(title, content, picture);
  */
  
  // CLOSE IT
  //if(confirm)
  //{
   // UPDATE SWITCH ICON
   Document_CSS_SetClass(icon,   "fa-tv");
   Document_CSS_UnsetClass(icon, "fa-rectangle-xmark");
   
   Classroom_Manage_TriggerEvent("close");
   Core_State_Set("classroom", ["projector"], false);
  //}
 }
 else
 if(true)
 {
  // ATTEMPT GETTING 2ND SCREEN INFO, IF ANY
  var info      = await Client_Screen_Info();
  var display   = info["secondary"][0] || info["primary"] || window.screen;
  var url       = Classroom_Link();
  
  var projector = window.open(url, "projector", "popup, width="+ display["availWidth"] + ", height=" + display["availHeight"] + ", fullscreen=yes");
//   projector.onresize = function(){
//   }
projector.addEventListener("load", (event) => {
   console.log(event);
   
  });
  await Client_Wait(0.5);
  projector.moveTo(display["left"], display["top"]);
  
  await Client_Wait(0.5);
  projector.resizeTo(display["availWidth"], display["availHeight"]);

  projector.location.reload();
  

//   projector.application.state.classroom = {
//    config : config
//   };

  Core_State_Set("classroom", ["projector"], projector);
  //CHECK CLOSE CHILD WINDOW
  var timer = setInterval(checkChild, 500);
  function checkChild() {
    if (projector.closed) {
        Document_CSS_SetClass(icon,   "fa-tv");
        Document_CSS_UnsetClass(icon, "fa-rectangle-xmark");
        Core_State_Set("classroom", ["projector"], false);  
        clearInterval(timer);
    }
  }
 
  // UPDATE SWITCH ICON
  Document_CSS_SetClass(icon,   "fa-rectangle-xmark");
  Document_CSS_UnsetClass(icon, "fa-tv");
  //ASSIGN KEY EVENT ON MANAGE PAGE
  Input_Keyboard_Assign(document.body, Classroom_Manage_KeyboardHandler);
 }
}




async function Classroom_Manage_SwitchPointer()
{
 Classroom_Manage_TriggerEvent("pointer");
}



async function Classroom_Manage_SwitchWhiteboard()
{
 Classroom_Manage_TriggerEvent("wb-toggle");
}




async function Classroom_Manage_LessonSummary()
{
 var lesson = Core_State_Get("classroom", ["lesson"]);
 
 await Lesson_Summary_Popup(lesson);
}





async function Classroom_Manage_Timer()
{
 var duration = await Classroom_Present_TimerPopup();

 Classroom_Manage_TriggerEvent("timer", duration);
}






function Classroom_Manage_TriggerEvent(command, data)
{
 // IS A THIRD PARTY WEBSITE CURRENTLY OPENED IN THE PROJECTOR WINDOW?
 var link      = Core_State_Get("classroom", ["current-link"]);
 
 // WE CAN CHECK IF A PROJECTOR WINDOW IS OPENED ONLY IF IT'S NOT POINTING TO THIRD PART WEBSITES
 // OTHERWISE WE WILL CAUSE A SECURITY EXCEPTION (SIGH...)
 if(!link) 
 {
  var projector = Core_State_Get("classroom", ["projector"]);
 }
 
 // IF THERE IS A PROJECTOR OPENED - AND WE ARE CURRENTLY NOT SHOWING A 3RD PARTY WEBSITE, THEN TRIGGER THE EVENT WITHIN THE PROJECTOR
 if(projector && !link)
 {
  projector["Classroom_Present_TriggerEvent"](command, data);
 }
 else
 // WITH NO PROJECTOR WINDOW OPEN, WE TRIGGER THE EVENT WITHIN THIS SAME WINDOW
 {
  Classroom_Present_TriggerEvent(command, data);
 }
}




function Classroom_Manage_SlideInstructions()
{ 
 var slide = Core_State_Get("classroom", ["current-slide"], slide);
 if(slide)
 {	 
  var page            = UI_Element_Create("classroom/slide-page", {}, {language:"classroom/manage"});

  // PARAGRAPH TAB
  var tabDefault = "tab-instructions";
  var paragraphElement = UI_Element_Create("classroom/paragraph-tab", {}, {language:"classroom/manage"});
  page.prepend(paragraphElement);

  var scriptsTab =  UI_Element_Find(page,"tab-scripts");
  var instructionsTab =  UI_Element_Find(page,"tab-instructions");

  // COLLECT INSTRUCTIONS
  var text            = Safe_Get(slide, ["header", "teachertext"], "");

  //CUSTOM FIRST SLIDE ADD TEACHER DESCRIPTION
  var lesson = Core_State_Get("classroom",["lesson","source"]) || "";
  if(Lesson_Type(lesson) == "hybrid") 
  {
    var language = Client_Language_Get();
    text = Core_State_Get("classroom",["lesson","desc-teacher",language]) + "\n" + text;
  }

  text                = text.replaceAll("\n", "<br>");
  text                = text.replaceAll("\r\n", "<br>");

  var stage            = Safe_Get(slide, ["header", "stage"], "");
  stage                = stage.replaceAll("\n", "<br>");
  stage                = stage.replaceAll("\r\n", "<br>");
  stage                = UI_Language_String("presentation/stages", stage);
  
  if(text.trim() == "")
  {
   UI_Element_Find(page, "instructions-paragraph").style.display = "none";
   tabDefault = "tab-scripts";
   instructionsTab.style.color = "var(--color-dark)";
   instructionsTab.classList.remove("style-clickable");
  }
  else
  {
   UI_Element_Find(page, "instructions-paragraph").style.display = "none";
   UI_Element_Find(page, "instructions").innerHTML = text;
   UI_Element_Find(page, "slide-stage").innerHTML = stage;

   instructionsTab.onclick = () => {
    instructionsTab.classList.add("color-noted"); 
    scriptsTab.classList.remove("color-noted"); 
    UI_Element_Find(page,"scripts-paragraph").style.display = "none";
    UI_Element_Find(page,"instructions-paragraph").style.display = "flex";
   }
  }
  
  
  // COLLECT SCRIPTS
  console.log(slide["scripts"]);
  if(!slide["scripts"] || slide["scripts"].length == 0)
  {
   UI_Element_Find(page, "scripts-paragraph").style.display = "none";
   tabDefault = "tab-instructions";
   scriptsTab.style.color = "var(--color-dark)";
   scriptsTab.classList.remove("style-clickable");
  }
  else
  {
   for(var script of slide["scripts"])
   {
    var text     = script["name"] || script["id"];
    var item     = UI_Element_Create("classroom/slide-page-script", {text});
    Document_Element_SetObject(item, "tag", {slide_id:slide["id"], script_id:script["id"]});
   
    item.onclick = 
    function(event)
    {
     var element = event.currentTarget;
     Classroom_Manage_RunScript(element);
    }
   
    UI_Element_Find(page, "scripts").appendChild(item);

    // RESET MAX-HEIGHT OF COLLECT INSTRUCTIONS
    // UI_Element_Find(page, "instructions").style.maxHeight = "180px";
   }
   
   UI_Element_Find(page, "scripts-paragraph").style.display = "none";
   scriptsTab.onclick = () => {
    scriptsTab.classList.add("color-noted"); 
    instructionsTab.classList.remove("color-noted"); 
    UI_Element_Find(page,"instructions-paragraph").style.display = "none";
    UI_Element_Find(page,"scripts-paragraph").style.display = "flex";
   }
  }
  
  UI_Element_Find(page,tabDefault).click();
  
  // DISPLAY
  var container       = UI_Element_Find("presentation-panel-right");
  container.innerHTML = "";
  container.appendChild(page);
 }
}




function Classroom_Manage_SelectSlide(event)
{
 var presentation = Core_State_Get("classroom", ["presentation"]);
 
 var element      = event.currentTarget;
 var slide        = Document_Element_GetObject(element, "slide");
 var index        = presentation["slides"].indexOf(slide); 

 // CENTER AND UPDATE SLIDE THUMBNAIL
 var thumbnail = slide["thumbnail"];
 var list      = UI_Element_Find("presentation-thumbnails");
 if(thumbnail)
 { 
  thumbnail.scrollIntoView({behavior: "smooth", block: "center"});
  Document_Conditional_Class(list, "style-outlined-accented", thumbnail); 
 }
 
 Core_State_Set("classroom", ["current-slide"],     slide);
 Core_State_Set("classroom", "current-slide-index", index);
 
 Classroom_Manage_UpdateSelector("instructions");
 Classroom_Manage_SlideInstructions();

 Classroom_Manage_TriggerEvent("slide", index);
}




function Classroom_Manage_RunScript(item)
{
 var data = Document_Element_GetObject(item, "tag");
 
 Classroom_Manage_TriggerEvent("script", data);
}





function Classroom_Manage_TriggerElement(item)
{
 var data = Document_Element_GetObject(item, "tag");
 
 Classroom_Manage_TriggerEvent("click", data);
}




function Classroom_Manage_ResetSlide(item)
{
 var presentation = Core_State_Get("classroom", ["presentation"]);
 var slide        = Document_Element_GetObject(item, "tag");
 var index        = presentation["slides"].indexOf(slide); 
 
 Classroom_Manage_TriggerEvent("reset", index);
}





function Classroom_Manage_OpenLink(item)
{
 var data           = Document_Element_GetObject(item, "tag");
 var url            = data["url"]; 
 
 window.open(url, "projector", "popup, width="+ screen.width + ", height=" + screen.height + ", fullscreen=yes");
 
 Core_State_Set("classroom", ["current-link"], url);
}




function Classroom_Manage_OpenDocument(item)
{
 // CHECK PROJECTOR ONLY IF THIS IS NOT THE SEPARATE "PRESENT" WINDOW
 if(Core_State_Get("classroom", "page") != "present")
 {
  var projector = Core_State_Get("classroom", ["projector"]);
  if(!projector) return;
 }
 
 var data = Document_Element_GetObject(item, "tag");
 var file = data["file"];

 Classroom_Manage_TriggerEvent("doc", file);
}



function Classroom_Manage_CleanProjector(item)
{
 Classroom_Manage_TriggerEvent("clean");
}



async function Classroom_Manage_Assessments()
{
  var classdata = Core_State_Get("classroom", ["class"]);
  await Assessment_Class_Display(classdata["info"]["id"], {popup:true});
}


async function Classroom_Manage_KeyboardHandler()
{
 var projector = Core_State_Get("classroom", ["projector"]);
 
 // PREVENT KEYBOARD EVENT OVERLAPS
 if(Core_State_Get("classroom", ["changing-slide"])) return;
 if(Core_State_Get("classroom", ["playing-script"])) return;
 
 
 // NEXT SLIDE
 if(Input_Keyboard_Pressed(false, [KEY_RIGHT]) && !["INPUT","TEXTAREA"].includes(document.activeElement.tagName))
 {
    var event = new KeyboardEvent('keydown',{'key':'ArrowRight','code':'ArrowRight','keyCode':KEY_RIGHT,'view':projector});
    projector.document.body.dispatchEvent(event);
     var eventup = new KeyboardEvent('keyup',{'key':'ArrowRight','code':'ArrowRight','keyCode':KEY_RIGHT,'view':projector});
    projector.document.body.dispatchEvent(eventup);
 }
 
 
 // PREV SLIDE
 if(Input_Keyboard_Pressed(false, [KEY_LEFT]) && !["INPUT","TEXTAREA"].includes(document.activeElement.tagName))
 {
    var event = new KeyboardEvent('keydown',{'key':'ArrowLeft','code':'ArrowLeft','keyCode':KEY_LEFT,'view':projector});
    projector.document.body.dispatchEvent(event);
    var eventup = new KeyboardEvent('keyup',{'key':'ArrowLeft','code':'ArrowLeft','keyCode':KEY_LEFT,'view':projector});
    projector.document.body.dispatchEvent(eventup);
 }
 
 
 // NEXT SCRIPT FOR CURRENT SLIDE
 if(Input_Keyboard_Pressed(false, [KEY_DOWN]) && !["INPUT","TEXTAREA"].includes(document.activeElement.tagName))
 {
    var event = new KeyboardEvent('keydown',{'key':'ArrowDown','code':'ArrowDown','keyCode':KEY_DOWN,'view':projector});
    projector.document.body.dispatchEvent(event);
    var eventup = new KeyboardEvent('keyup',{'key':'ArrowDown','code':'ArrowDown','keyCode':KEY_DOWN,'view':projector});
    projector.document.body.dispatchEvent(eventup);
 }
 
 
 // NEXT SLIDE
 if(Input_Keyboard_Pressed(false, [KEY_NEXT]) )
 {
    var event = new KeyboardEvent('keydown',{'key':'ArrowRight','code':'ArrowRight','keyCode':KEY_RIGHT,'view':projector});
    projector.document.body.dispatchEvent(event);
    var eventup = new KeyboardEvent('keyup',{'key':'ArrowRight','code':'ArrowRight','keyCode':KEY_RIGHT,'view':projector});
    projector.document.body.dispatchEvent(eventup);
 }


 // PREV SLIDE
 if(Input_Keyboard_Pressed(false, [KEY_PREVIOUS]))
 {
    var event = new KeyboardEvent('keydown',{'key':'ArrowLeft','code':'ArrowLeft','keyCode':KEY_LEFT,'view':projector});
    projector.document.body.dispatchEvent(event);
    var eventup = new KeyboardEvent('keyup',{'key':'ArrowLeft','code':'ArrowLeft','keyCode':KEY_LEFT,'view':projector});
    projector.document.body.dispatchEvent(eventup);
 }


 // NEXT SCRIPT FOR CURRENT SLIDE
 if(Input_Keyboard_Pressed(false, [KEY_PLAY]))
 {
    var event = new KeyboardEvent('keydown',{'key':'ArrowDown','code':'ArrowDown','keyCode':KEY_DOWN,'view':projector});
    projector.document.body.dispatchEvent(event);
    var eventup = new KeyboardEvent('keyup',{'key':'ArrowDown','code':'ArrowDown','keyCode':KEY_DOWN,'view':projector});
    projector.document.body.dispatchEvent(eventup);
 }

 // PREV SCRIPT FOR CURRENT SLIDE
 if(Input_Keyboard_Pressed(false, [KEY_UP]))
 { 
    var event = new KeyboardEvent('keydown',{'key':'ArrowUp','code':'ArrowUp','keyCode':KEY_UP,'view':projector});
    projector.document.body.dispatchEvent(event);
    var eventup = new KeyboardEvent('keyup',{'key':'ArrowUp','code':'ArrowUp','keyCode':KEY_UP,'view':projector});
    projector.document.body.dispatchEvent(eventup);
 }
 

 // RESET SLIDE
 if(Input_Keyboard_Pressed(false, [KEY_RCTRL]))
 { 
  var presentation = Safe_Get(projector,["application", "state", "classroom", "presentation"],{});
  var slide = Presentation_Slide_Current(presentation);
  var index = Presentation_Slide_Index(presentation, slide);
  Classroom_Present_TriggerEvent("manage-reset", index);
 }
 


  // ERASE WHITE BOARD OR RESET SLIDE 
  if(Input_Keyboard_Pressed(false, [KEY_CONTEXTMEMU]))
  {
   var classroom = Safe_Get(projector,["application", "state", "classroom"],{});
   //CHECK HAS WHITEBOARD
   let whiteboardstatus = classroom.whiteboard.parentElement.style.visibility
   if(whiteboardstatus == "visible")
   {
      Classroom_Manage_EraseWhiteboard(projector);
   }
   else
   {
      var presentation = classroom.presentation;
      var slide = Presentation_Slide_Current(presentation);
      var index = Presentation_Slide_Index(presentation, slide);
      Classroom_Present_TriggerEvent("manage-reset", index);
   }
  }
}

function Classroom_Manage_EraseWhiteboard(projector)
{ 
 // CLICK ANIMATION
 var element = (projector.document.getElementsByClassName("container-column content-centered fa-solid fa-eraser style-clickable"))[0];
 Media_Audio_Play(Resources_URL("sounds/click.mp3"));
 Document_Element_Animate(element, "rubberBand 0.5s");
 element.click();
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                   C L A S S R O O M                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



async function Classroom_OnLoad(module, data)
{ 
 var page = Client_Location_Parameter("page");
 Core_State_Set("classroom", "page", page);
 
 
 // SET BY ANOTHER MODULE? 
 if(!class_id)
 {
  var class_id = Core_State_Get("global", ["view-class"], false);
  if(class_id)
  {
   // UNSET
   Core_State_Set("global", ["view-class"], false);
  }
 }
 
 // SET BY URL?
 if(!class_id)
 {
  var class_id = Client_Location_Parameter("class");
 }
  
 
 // SET CLASS AS CURRENT
 Core_State_Set("classroom", ["current-class"], class_id);
 // UNSET CURRENT SEAT IF EXIST
 Core_State_Set("classroom", ["current-seat"], false);
 
 // STILL NO VALID CLASS TO READ? THEN LEAVE
 if(class_id)
 {
  // LOAD CLASSROOM DATA (PEOPLE, LESSON ID, ETC.)
  var classdata = await Classes_Load(class_id, {seats:true, users:true});
 }
 else
 {
  var classdata = {};
 }
 
 Core_State_Set("classroom", ["class"], classdata);

 // SET CURRENT COURSE
 var course_id = Core_State_Get("classroom", ["class", "info", "course_id"]);
 if(course_id)
 {
  var courseObj = await Core_Api("Courses_Read",{id:course_id});
 }
 else
 {
  var courseObj = {};
 }
 
 Core_State_Set("course",["current-course"],courseObj);
  
 // LOAD LESSON AND STORE IT
 var force_lesson    = Client_Location_Parameter("lesson_id");
 var lesson_id       = force_lesson || Safe_Get(classdata, ["info", "lesson_id"], "null");
 var lesson          = await Lesson_Load(lesson_id, {all:true});
 classdata["lesson"] = lesson;
 Core_State_Set("classroom", ["lesson"], lesson);

 // LOAD CLASS ROOM CONFIG
 var classRoomConfig = {}
 if(typeof classdata["info"] != "undefined")
 classRoomConfig = classdata["info"]["classroom_data"] || {};
 Core_State_Set("classroom", ["config"], classRoomConfig);
 
 var presentation_source = "content/lessons/" + lesson_id + "/presentation";

 // LOAD PRESENTATION
 var presentation        = await Presentation_Load(presentation_source); 
 Core_State_Set("classroom", ["presentation"], presentation);
 
 // *** HACK *** ADJUST PRESENTATION (CONVERT ONCLICK TO SCRIPTS)
 Presentation_Adjust_OnclickToScripts(presentation);
 
 // CREATE SLIDES MENUS
 var index = 0;
 for(var slide of presentation["slides"])
 {
  // CREATE SLIDE MENU
  var items = {};
 
  
  
  // SCRIPTS MENU
  var scripts = slide["scripts"] || [];
  for(var script of slide["scripts"])
  {
   var id        = script["id"];
   var item      = {};
   
   item["text"]  = script["name"];
   item["state"] = "enabled";
   item["icon"]  = "play";
   item["func"]  = Classroom_Manage_RunScript;
   item["tag"]   = {slide_id:slide["id"], script_id:script["id"]}; 
   
   items[id] = item;
  }
  

  // CLICKABLE ITEMS MENU
  var clickable = [];
  var elements  = slide["elements"] || [];
  for(var element of elements)
  {
   if(Presentation_Element_Active(element)) clickable.push(element);
  }
		
 
  for(var element of clickable)
  {
   if(Presentation_Element_Active(element))
   {
	var id        = Document_Element_GetData(element, "uid");
    var item      = {};
   
    item["text"]  = Document_Element_GetData(element, "name");
    item["state"] = "enabled";
	item["icon"]  = "hand-point-right";
    item["func"]  = Classroom_Manage_TriggerElement;
    item["tag"]   = {slide_id:slide["id"], element_id:id}; 
   
    items[id] = item;
   }
  }
  
  
  
  
  // IF THERE WERE ANY SCRIPTS OR CLICKABLE ELEMENTS, ADD A BREAK LINE
  if(clickable.length > 0 || scripts.length > 0) 
  {  
   items["break1"] = 
   {
    id:"break1"
   }  
  }
  
  
  // VOCAB SUBMENU
  var vocabulary = Core_State_Get("classroom", ["lesson", "vocabulary"]);
  if(Safe_Length(vocabulary) > 0)
  {
   var subitems = {};
   
   for(var id in vocabulary)
   {
	var term      = vocabulary[id];
    var item      = {};
	
	item["text"]  = UI_Language_Object(term["info"] || {});
    item["state"] = "enabled";
	item["icon"]  = "language";
    item["func"]  = Classroom_Manage_SendVocabulary;
    item["tag"]   = term; 
	
	subitems[id]  = item;
   }
   
   
   // CREATE SUBMENU
   var item = {};
   
   item["text"]        = UI_Language_String("classroom/manage", "menu presentation vocabulary");
   item["state"]       = "enabled";
   item["icon"]        = "book";
   item["submenu"]     = UI_Menu_Create("vocabulary", subitems);
   
   items["vocabulary"] = item;
  }
  
  
  
  
  // DOCUMENTS SUBMENU
  var lesson    = Core_State_Get("classroom", ["lesson"], {});
  var documents = Object_Subset(lesson, "document "); //console.log(documents);
  if(Safe_Length(documents) > 0)
  {
   var subitems = {};
   
   for(var id in documents)
   {
    var item      = {};
	var document  = documents[id];
	var file      = document["file"];
		
	item["text"]  = UI_Language_Object(document) || file;
    item["state"] = "enabled";
	item["icon"]  = "file";
    item["func"]  = Classroom_Manage_OpenDocument;
    item["tag"]   = {file}; 
	
	subitems[id]  = item;
   }
   
   
   // CREATE SUBMENU
   var item = {};
   
   item["text"]        = UI_Language_String("classroom/manage", "menu presentation documents");
   item["state"]       = "enabled";
   item["icon"]        = "folder-open";
   item["submenu"]     = UI_Menu_Create("documents", subitems);
   
   items["documents"]  = item;
  }
  
  
  
  // LINKS SUBMENU
  var lesson = Core_State_Get("classroom", ["lesson"], {});
  var links  = Object_Subset(lesson, "link");
  if(Safe_Length(links) > 0)
  {
   var subitems = {};
   
   for(var id in links)
   {
    var item      = {};
	var link      = links[id];
	var url       = link["url"];
		
	item["text"]  = UI_Language_Object(link);
    item["state"] = "enabled";
	item["icon"]  = "passport";
    item["func"]  = Classroom_Manage_OpenLink;
    item["tag"]   = {url}; 
	
	subitems[id]  = item;
   }
   
   
   // CREATE SUBMENU
   var item = {};
   
   item["text"]        = UI_Language_String("classroom/manage", "menu presentation links");
   item["state"]       = "enabled";
   item["icon"]        = "globe";
   item["submenu"]     = UI_Menu_Create("links", subitems);
   
   items["links"] = item;
  }
  
  
  // BREAK LINE
  items["break2"] = 
  {
   id:"break2"
  } 
  
  
  // CLEAN PRESENTATION LAYERS
  items["clean"] = 
  {
   id:    "clean",
   icon:  "soap", 
   text:  UI_Language_String("classroom/manage", "menu projector clean"),
   state: "enabled",
   func:  Classroom_Manage_CleanProjector,
   tag:   slide
  }
  
 
  // RESET SLIDE
  items["reset"] = 
  {
   id:    "reset",
   icon:  "arrows-rotate", 
   text:  UI_Language_String("classroom/manage", "menu slide reset"),
   state: "enabled",
   func:  Classroom_Manage_ResetSlide,
   tag:   slide
  }
  
  var menu      = UI_Menu_Create(slide["id"], items);
  slide["menu"] = menu;
 
  index = index + 1;
 }
 
}




async function Classroom_OnShow(module, data)
{
 // SET INITIAL PAGE
 var page = Core_State_Get("classroom", ["page"]);
 if(!page) var page = Client_Location_Parameter("page") || "manage";
 
 var submodule       = UI_Element_Create("classroom/" + page);  
 var container       = UI_Element_Find("module-page");
 
 // HIDE SOME COMPONENTS BASED ON ROLE
 if(!User_Can("view-presentation-thumbnails"))  UI_Element_Find(submodule, "presentation-panel-left").style.display = "none";
 
 
 container.innerHTML = "";
 container.appendChild(submodule);
 
 var func = "Classroom_" + String_Capitalize_Initial(page);
 window[func]();
}





async function Classroom_OnUnload()
{
 // CLOSE PROJECTOR IF OPENED
 var projector = Core_State_Get("classroom", ["projector"]); 
 if(projector)
 {
  Classroom_Manage_TriggerEvent("close");
  
  Core_State_Set("classroom", ["projector"], false);
 }
}




function Classroom_Find_Student(id)
{
 var seats = Core_State_Get("classroom", ["class", "seats"], {});
 
 for(var seat_id in seats)
 {
  var seat = seats[seat_id];
  
  var student_id = Safe_Get(seat, ["student", "id"]);
  if(id == student_id)
  {
   return seat["student"];
  }
 }
 
 return false;
}



function Classroom_Find_Term(id)
{
 var vocabulary = Core_State_Get("classroom", ["lesson", "vocabulary"], {});
 var term       = vocabulary[id];
 
 return term;
}





function Classroom_Link()
{
 var class_id  = Core_State_Get("classroom", "current-class");
 var lesson_id = Core_State_Get("classroom", ["lesson", "source"]);
 var slide_id  = Core_State_Get("classroom", ["current-slide", "id"]);
 
 var link      = "?framework=null&module=classroom&page=present&lesson_id=" + lesson_id + "&class=" + class_id + "&slide=" + slide_id;

 return link;
}




function Classroom_Mode()
{
 var page = Core_State_Get("classroom", "page");
 
 return page;
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      P R E S E N T                                             //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Classroom_Present()
{
 var presentation = Core_State_Get("classroom", ["presentation"]);
 
 
 // FLATTEN
 var body = UI_Element_Find("module-body");
 Document_CSS_PurgeClasses(body, "padding");
 
 
 // DISPLAY INITIAL SLIDE
 var display = UI_Element_Find("presentation-display");
 Presentation_Assign(presentation, display, Classroom_Present_DisplayEventHandler);
 
 var slide_id = Client_Location_Parameter("slide");
 var slide    = false;
 
 if(slide_id) 
 {
  // FIND ID
  slide = Presentation_Slide_Find(presentation, slide_id);
  
  // NO ID FOUND? TRY A DIRECT INDEX
  if(!slide) var slide = presentation["slides"][slide_id];  
 }
 
 
 // NO INITIAL SLIDE YET? DEFAULT TO SLIDE 0
 if(!slide) var slide = presentation["slides"][0];
 
 Classroom_Present_SetSlide(slide);
 
 
 // SET SWITCHES
 UI_Element_Find("switch-fullscreen").onclick = Classroom_Present_GoFullscreen;
 UI_Element_Find("switch-whiteboard").onclick = Classroom_Present_ToggleWhiteboard;
 UI_Element_Find("switch-eraser").onclick     = Classroom_Present_EraseWhiteboard;
 UI_Element_Find("switch-timer").onclick      = Classroom_Present_Timer;
 
 // POINTER 
 var container = UI_Element_Find(body, "presentation-desktop");
 container.addEventListener("mousemove", Classroom_Present_Pointer); 
 
 
 // WHITEBOARD
 var layer      = Classroom_Present_GetLayer("whiteboard");
 var whiteboard = Whiteboard_Create(layer);
 Core_State_Set("classroom", "whiteboard", whiteboard);

 // UNSET BACKGROUND COLOR
 var screen = UI_Element_Find(body,"presentation-screen");
 screen.style.backgroundColor = null;
 
 // KEYBOARD HANDLER
 Input_Keyboard_Assign(document.body, Classroom_Present_KeyboardHandler);
}










// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                        L A Y E R S                                             //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//




function Classroom_Present_GetLayer(layer)
{
 var element = UI_Element_Find("layer-" + layer);   
 if(!element){
  var projector = Core_State_Get("classroom", ["projector"]);
  if(!projector) return; 
  switch(layer){
    case "timer": element = projector.document.getElementsByTagName("div")[9];
    case "whiteboard":  element = projector.document.getElementsByTagName("div")[10];
  }
 }
 return element;
}




function Classroom_Present_ShowLayer(layer)
{
 if(typeof layer == "string") var layer = Classroom_Present_GetLayer(layer);
 
 layer.style.display = "flex";
 layer.onclick       = Classroom_Present_HideLayer;
}





function Classroom_Present_HideLayer(event, name)
{
 if(event)
 {
  // PROCESS THE EVENT ONLY IF THE LAYER ITSELF IS CLICKED
  if(event.srcElement != event.currentTarget) return;
  var layer = event.currentTarget;
 }
 else
 { 
  var layer = Classroom_Present_GetLayer(name);
  if(!layer) return;
 }
	 
 
 // IF SET TO AUTOHIDE, HIDE
 if(layer.getAttribute("erase")) layer.style.display = "none";
 
 // IF SET TO AUTOCLEAN, CLEAN
 if(layer.getAttribute("erase")) layer.innerHTML = "";
}







// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                         T I M E R                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Classroom_Present_StartTimer(duration)
{
 if(Classroom_Present_TimerRunning()) Classroom_Present_StopTimer();
 
 var layer       = Classroom_Present_GetLayer("timer");
 var timer       = UI_Element_Create("classroom/timer");
 //DOAN NHAT NAM update position timer popup
 layer.style.justifyContent =  "flex-end";
 timer.style.alignSelf =  "flex-end";
 timer.style.fontSize =  "60px";
 timer.style.width =  null;
 timer.style.height =  null;
 //DOAN NHAT NAM update position timer popup
 layer.appendChild(timer);

 Core_State_Set("classroom", ["timer", "display"],  timer); 
 Core_State_Set("classroom", ["timer", "start"],    Time_Now()); 
 Core_State_Set("classroom", ["timer", "duration"], duration * 1000);
	
 var thread = setInterval(Classroom_Present_ProcessTimer, 1000);
 Core_State_Set("classroom", ["timer", "thread"],   thread); 
 
 Classroom_Present_ProcessTimer();
 Classroom_Present_ShowLayer("timer");
 
 Media_Audio_Play(Resources_URL("sounds/pop.mp3"));
 Document_Element_Animate(timer, "rubberBand 1.5s linear 1");
}



async function Classroom_Present_ProcessTimer()
{  
 // MODULE CHANGED? STOP TIMER
 if(Core_State_Get("core", "module") != "classroom")
 { 
  Classroom_Present_StopTimer();
  return;
 }
 
 
 var start         = Core_State_Get("classroom", ["timer", "start"]);
 var duration      = Core_State_Get("classroom", ["timer", "duration"]);
 var display       = Core_State_Get("classroom", ["timer", "display"]);
 
 var elapsed       = Time_Now() - start;
 var time          = Math.floor((duration - elapsed) / 1000);
 
 if(elapsed >= duration)
 {
  Classroom_Present_StopTimer(3);
 }
 else
 {
  display.innerHTML = Time_Seconds_ToTimecode(time);
 }
 
}


async function Classroom_Present_StopTimer(attention)
{
 var thread = Core_State_Get("classroom", ["timer", "thread"]);
 if(thread) clearInterval(thread);
 Core_State_Set("classroom", ["timer", "thread"], false);  
 

 var layer = Classroom_Present_GetLayer("timer");
 if(attention && layer && layer.style.display != "none")
 {
  var display  = Core_State_Get("classroom", ["timer", "display"]);
  
  for(var i = 0; i < attention; i++)
  {
   Media_Audio_Play(Resources_URL("sounds/bell.mp3"));
   await Document_Element_Animate(display, "tada 1.5s linear 1");
   await Client_Wait(0.250);
  }
 }
 
 Classroom_Present_HideLayer(false, "timer");
}




async function Classroom_Present_TimerRunning()
{
 var thread = Core_State_Get("classroom", ["timer", "thread"]);
 
 return thread;
}




async function Classroom_Present_TimerPopup()
{
 var picture  = Resources_URL("images/cover-stopwatch.jpg");
 var title    = UI_Language_String("classroom", "popup timer title");
 var subtitle = UI_Language_String("classroom", "popup timer subtitle");
 
 var options  = UI_Language_Options("classroom/timer");
 options      = [{text:"", value:false}, ...options];

 var duration = await UI_Popup_Select(title, subtitle, picture, options);
 return duration;
}



async function Classroom_Present_Timer(event)
{
 var duration = await Classroom_Present_TimerPopup();

 Classroom_Present_TriggerEvent("timer", duration);
}







// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      S L I D E S                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



function Classroom_Present_SelectSlide(event)
{
 var presentation = Core_State_Get("classroom", ["presentation"]);
 
 var element      = event.currentTarget;
 var slide        = Document_Element_GetObject(element, "slide");
 var index        = presentation["slides"].indexOf(slide); 

 Classroom_Present_EventHandler({c:"slide", d:index});
}





function Classroom_Present_ResetSlide(item)
{
 var presentation = Core_State_Get("classroom", ["presentation"]);
 var slide        = Document_Element_GetObject(item, "tag");
 var index        = presentation["slides"].indexOf(slide); 
 
 Classroom_Present_EventHandler({c:"reset", d:index});
}









// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                            M I S C                                             //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Classroom_Present_TriggerEvent(command, data)
{
 Classroom_Present_EventHandler({c:command, d:data});
}



async function Classroom_Present_GoFullscreen()
{
 document.onfullscreenchange = 
 function(event)
 {
  var presentation = Core_State_Get("classroom", ["presentation"]);
  var display      = UI_Element_Find("presentation-display");
  
  setTimeout(
  function()
  {
   Presentation_Assign(presentation, display, Classroom_Present_DisplayEventHandler)
  }, 
  125);
 
  //document.onfullscreenchange = false;
 }
 
 //UI_Element_Find("presentation-desktop").requestFullscreen();
  if (document.fullscreenElement) {
    document.exitFullscreen();
  } else if (document.webkitFullscreenElement ) { /* Safari */
    document.webkitExitFullscreen();
  } else if (document.msFullscreenElement) { /* IE11 */
    document.msExitFullscreen();
  }
  else document.documentElement.requestFullscreen();
}



function Classroom_Present_Clear()
{
 // WINDOW CURRENTLY SWITCHED TO LINK? THEN RETURN TO SLIDE
 var link = Core_State_Get("classroom", "current-link");
 if(link)
 {
  var url = Classroom_Link();
  window.open(url, "projector", "popup, width="+ screen.width + ", height=" + screen.height + ", fullscreen=yes");
  
  Core_State_Set("classroom", "current-link", false);
 }
 
 else
	 
 // IF NOT SWITCHED TO LINK, THEN JUST REMOVE LAYERS AND MENUS LYING AROUND
 {
  UI_Menu_CloseAll();
 
  Classroom_Present_HideLayer(false, "aux");
  Classroom_Present_HideLayer(false, "timer");
  Classroom_Present_HideLayer(false, "whiteboard");
 }
}




async function Classroom_Present_SetSlide(slide, exit_anim, enter_anim, time)
{ 
 var presentation = Core_State_Get("classroom", ["presentation"]);
 if(!presentation) return;
 
 var current      = Presentation_Slide_Current(presentation);

 if(slide != current && presentation["display"])
 {
  Core_State_Set("classroom", ["changing-slide"], true);
	  
  // EXIT CURRENT SLIDE	  
  if(exit_anim) await Document_Element_Animate(presentation["display"], exit_anim + " " + time + "s ease-in");
  presentation["display"].style.visible = "hidden";
	  
  Presentation_Slide_Display(slide);
  
  
  // WHITEBOARD: STORE CURRENT (IF ANY), ERASE, AND RESTORE NEW
  var whiteboard = Core_State_Get("classroom", "whiteboard");
  if(current)
  {
   Whiteboard_Canvas_Store(whiteboard, current["id"]);
   Whiteboard_Canvas_Erase(whiteboard);
  }
  Whiteboard_Canvas_Recall(whiteboard, slide["id"]);
	 
	 
  // ENTER NEW SLIDE
  if(enter_anim) await Document_Element_Animate(presentation["display"], enter_anim + " " + time + "s ease-out");
  presentation["display"].style.visible = "visible";
	   
  Core_State_Set("classroom", ["changing-slide"], false);
  
  
  // GET SLIDE MENU AND ASSIGN IT TO THE THUMBNAIL
  var menu = slide["menu"];
  UI_Menu_Assign(UI_Element_Find("presentation-desktop"), menu);
  
  
  // DISPLAY SCRIPTS
  Classroom_Present_ShowScripts();
 }
}



function Classroom_Present_Pointer(event)
{  
 var layer   = Classroom_Present_GetLayer("pointer");
 var pointer = UI_Element_Find(layer, "pointer");
 var size    = Document_Element_Size(pointer);
 
 var target  = event.currentTarget;
 var rect    = target.getBoundingClientRect();
 
 var left    = (event.clientX - rect.left - (size["width"] / 2))  + "px";
 var top     = (event.clientY - rect.top  - (size["height"] / 2)) + "px";
 
 pointer.style.left = left;
 pointer.style.top  = top;
}



function Classroom_Present_ToggleWhiteboard(event)
{  
 // CLICK ANIMATION
 var element = event ? event.currentTarget : null;
 Media_Audio_Play(Resources_URL("sounds/click.mp3"));
 Document_Element_Animate(element, "rubberBand 0.5s");
 
 
 var layer   = Classroom_Present_GetLayer("whiteboard");
 var visible = Document_Element_Toggle(layer, "visibility");
 
 // SHOWING THE WHITEBOARD HIDES POINTER
 /*
 if(visible)
 { 
  layer                  = Classroom_Present_GetLayer("pointer"); 
  layer.style.visibility = "hidden";
 }
 else
 // HIDING THE WHITEBOARD SHOWS POINTER
 {
  layer                  = Classroom_Present_GetLayer("pointer"); 
  layer.style.visibility = "visible";
 }
 */
 
 return visible;
}


function Classroom_Present_EraseWhiteboard(event)
{ 
 // CLICK ANIMATION
 var element = event.currentTarget;
 Media_Audio_Play(Resources_URL("sounds/click.mp3"));
 Document_Element_Animate(element, "rubberBand 0.5s");
 
 // ERASE WHITEBOARD
 var whiteboard = Core_State_Get("classroom", "whiteboard");
 Whiteboard_Canvas_Erase(whiteboard);
 
 // ALSO ERASE DOCUMENTS OR OTHER THINGS THAT MAY BE OPEN
 Classroom_Present_Clear();
}





function Classroom_Present_FixScripts(visibility)
{ 
 var container = UI_Element_Find("presentation-scripts");
 
 if(visibility)
 {
  container.style.opacity = 0.33;
  Document_CSS_UnsetClass(container, "style-evanescent-total");
 }
 else
 {
  container.style.opacity = "";
  Document_CSS_SetClass(container, "style-evanescent-total");
 }
}


function Classroom_Present_ShowScripts()
{
 var presentation = Core_State_Get("classroom", "presentation");
 var slide        = Presentation_Slide_Current(presentation);
 var scripts      = slide["scripts"] || "";
 

 var current      = Safe_Get(slide, ["current-script"], 0);
 var list         = UI_List_Items(scripts, "none", 
 // ON ITEM CLICK
 async function(element)
 {
  var item  = Document_Element_GetObject(element, "itemlist-item");

  // EXECUTE SCRIPT
  await Presentation_Script_Execute(item);
  
  current = scripts.indexOf(Presentation_Slide_FindScript(slide,item["id"])) + 1;
  Safe_Set(slide, ["current-script"], current);
  // REFRESH
  Classroom_Present_ShowScripts();
 }, 
 
 undefined,
 
 // ITEM CREATION
 function(item)
 {
  caption  = item["name"];
  if(item["executed"]) var icon = "circle-check"; else var icon = "circle";
	  
  var element = UI_Element_Create("classroom/slide-script-item", {caption, icon});
  
  var index = scripts.indexOf(item); console.log(index); console.log(current);
  if(index == current) element.style.backgroundColor = "var(--color-accented)";
     
  
  return element;
 }); 
 
 var container       = UI_Element_Find("presentation-scripts");
 container.innerHTML = "";
 container.appendChild(list);
 //SHOW LIST WITHOUT MOUSE HOVER
 if(container.classList.contains('style-evanescent-total')) container.classList.remove('style-evanescent-total');
}






// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      H A N D L E R S                                           //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Classroom_Present_DisplayEventHandler()
{
}



async function Classroom_Present_KeyboardHandler(event)
{
 var presentation = Core_State_Get("classroom", ["presentation"]);
 
 
 // PREVENT KEYBOARD EVENT OVERLAPS
 if(Core_State_Get("classroom", ["changing-slide"])) return;
 if(Core_State_Get("classroom", ["playing-script"])) return;
 
 
 // NEXT SLIDE
 //if(Input_Keyboard_Pressed(false, [KEY_RIGHT]))
 if(Input_Keyboard_Pressed(false, [KEY_NEXT]) || Input_Keyboard_Pressed(false, [KEY_RIGHT]))
 {
  Classroom_Present_TriggerEvent("next-slide");
  Classroom_Present_SelectClassroomSlide({c:"next-slide"})
 }
 
 
 // PREV SLIDE
 //if(Input_Keyboard_Pressed(false, [KEY_LEFT]))
 if(Input_Keyboard_Pressed(false, [KEY_PREVIOUS]) || Input_Keyboard_Pressed(false, [KEY_LEFT]))
 {
  Classroom_Present_TriggerEvent("prev-slide");
  Classroom_Present_SelectClassroomSlide({c:"prev-slide"})
 }
 
 
 // NEXT SCRIPT FOR CURRENT SLIDE
 //if(Input_Keyboard_Pressed(false, [KEY_DOWN]))
 if(Input_Keyboard_Pressed(false, [KEY_PLAY]) || Input_Keyboard_Pressed(false, [KEY_DOWN]))
 {
  Classroom_Present_TriggerEvent("next-script");
 }
 
 
 // PREV SCRIPT FOR CURRENT SLIDE
 if(Input_Keyboard_Pressed(false, [KEY_UP]))
 { 
  Classroom_Present_TriggerEvent("prev-script");
 }
 
 
 // RESET SLIDE
 if(Input_Keyboard_Pressed(false, [KEY_RCTRL]))
 { 
  var slide = Presentation_Slide_Current(presentation);
  var index = Presentation_Slide_Index(presentation, slide);
  Classroom_Present_TriggerEvent("reset", index);
 }

  // ERASE WHITE BOARD OR RESET SLIDE 
  if(Input_Keyboard_Pressed(false, [KEY_CONTEXTMEMU]))
  {
    //CHECK HAS WHITEBOARD
    let whiteboardstatus = UI_Element_Find("layer-whiteboard").style.visibility;
    if(whiteboardstatus == "visible")
    {
      let eventerase = {currentTarget:UI_Element_Find("switch-eraser")};
      Classroom_Present_EraseWhiteboard(eventerase);
    }
    else
    {
      var slide = Presentation_Slide_Current(presentation);
      var index = Presentation_Slide_Index(presentation, slide);
      Classroom_Present_TriggerEvent("reset", index);
    }
  }
}



async function Classroom_Present_EventHandler(event)
{   
 var presentation = Core_State_Get("classroom", ["presentation"]);
 console.log(event);
 
 switch(event["c"])
 {
  // SET PRESENTED SLIDE
  case "slide":
	
	Classroom_Present_Clear();	
	
	// INTERPRET EVENT DATA
	var index = event["d"];
    
	// FIND TARGET SLIDE
	var set = Safe_Get(presentation, ["slides", index], false);
    if(!set) return;
	
    // SET NEW SLIDE
	Media_Audio_Play(Resources_URL("sounds/slide.mp3"))
    await  Classroom_Present_SetSlide(set, "bounceOutDown", "bounceInUp", "0.5");	
	
  break;
  
  
  
  
  case "next-slide":
    
	Classroom_Present_Clear();

	var set = Presentation_Slide_Next(presentation);
	
	Media_Audio_Play(Resources_URL("sounds/slide.mp3"))
    await  Classroom_Present_SetSlide(set, "bounceOutLeft", "bounceInRight", "0.5");
	
  break;
  
  
  
  
  
  case "prev-slide":
    
	Classroom_Present_Clear();
	
	var set = Presentation_Slide_Prev(presentation);
	
	Media_Audio_Play(Resources_URL("sounds/slide.mp3"))
    await  Classroom_Present_SetSlide(set, "bounceOutRight", "bounceInLeft", "0.5");

  break;
  
  
  
  
  case "next-script":
  
	var slide = Presentation_Slide_Current(presentation);
    if(!slide) return;
     
    Core_State_Set("classroom", ["playing-script"], true);	

	await Presentation_Slide_NextScript(slide);
	
	// REFRESH SCRIPTS DISPLAY TO REFLECT CURRENT SCRIPT
	Classroom_Present_ShowScripts();
	
	Core_State_Set("classroom", ["playing-script"], false);
		
  
  break;
  
  
  
  
  case "prev-script":
  
	var slide = Presentation_Slide_Current(presentation);
    if(!slide) return;
  
  
    Core_State_Set("classroom", ["playing-script"], true);
		
	await Presentation_Slide_PrevScript(slide);
	
	// REFRESH SCRIPTS DISPLAY TO REFLECT CURRENT SCRIPT
	Classroom_Present_ShowScripts();
	
	Core_State_Set("classroom", ["playing-script"], false);
  
  break;
  
  
  
  // RESET SLIDE
  case "reset":
	
	// INTERPRET EVENT DATA
	var index = event["d"];
    
	// FIND TARGET SLIDE
	
	Media_Audio_Play(Resources_URL("sounds/reset.mp3"))
	var slide = Safe_Get(presentation, ["slides", index], false);
    if(!slide) return;
	
	// RESET
	Classroom_Present_Clear();
	Presentation_Slide_Reset(slide);
  Classroom_Present_ShowScripts();
  break;
  
  
  
 
  // RESET SLIDE
  case "manage-reset":

  // INTERPRET EVENT DATA
  var index = event["d"];
    
  // FIND TARGET SLIDE
  
  Media_Audio_Play(Resources_URL("sounds/reset.mp3"));
  var projector = Core_State_Get("classroom", ["projector"]);
  presentation = Safe_Get(projector,["application", "state", "classroom", "presentation"],{});
  var slide = Safe_Get(presentation, ["slides", index], false);
    if(!slide) return;
  
  // RESET
  Classroom_Present_Clear();
  Presentation_Slide_Reset(slide);
  Classroom_Present_ShowScripts();
  break;
  
  
  
  // RUN SCRIPT
  case "script":
	
	var data  = event["d"];
	
	// FIND SLIDE
	var slide = Presentation_Slide_Find(presentation, data["slide_id"]);
	if(!slide) return;
	
	// FIND SCRIPT IN SLIDE
	var script = Presentation_Slide_FindScript(slide, data["script_id"]);
	if(!script) return;
	
	Presentation_Script_Execute(script);
	
  break;
  
  
  
  
  
  // TRIGGER ELEMENT CLICK
  case "click":
	
	var data  = event["d"];
	
	// FIND SLIDE
	var slide = Presentation_Slide_Find(presentation, data["slide_id"]);
	if(!slide) return;
	
	// FIND ELEMENT IN SLIDE
	var element = Presentation_Slide_FindElement(slide, data["element_id"]);
	if(!element) return;
	
	element.click();
	
  break;
  
  
  
  
  case "attract":
	
	var data    = event["d"];
	var layer   = UI_Element_Find("layer-attract");    

    
	// RECORD BADGE
	console.log(data);
	Core_Api("Class_Seat_AddBadge", {seat_id:data["seat_id"], badge:data["attract_id"]});
	

	// STUDENT
	var student = Classroom_Find_Student(data["student_id"]);	
	var student_picture = Resources_URL("propic.jpg", "user", student["id"]);
	
	var element = UI_Element_Create("classroom/attract-student", student);
    Document_Image_Load(UI_Element_Find(element, "picture"), [student_picture, "hide"]);
	
	layer.appendChild(element);
	
    Document_Element_Animate(element, "zoomInUp 0.5s");
	await Client_Wait(1);
	await Document_Element_Animate(element, "fadeOutUp 0.5s");
    element.remove();
   
  
	// MESSAGE
	var attract = Core_Data_Section("classroom/attract", data["attract_id"]);  
	var message = UI_Language_Object(attract);
	var sound   = attract["sound"];
	var emoji   = attract["icon"];
	switch(attract["category"])
	{
     case "evaluation":
		var animation = "rubberBand";
	 break;
	 
	 case "request":
		var animation = "tada";
	 break;
	 
	 case "reward":
		var animation = "heartBeat";
	 break;
	 
	 default:
		var animation = "";
	 break;
	}
	var element = UI_Element_Create("classroom/attract-message", {message, emoji});
		
	layer.appendChild(element);
	
    await Document_Element_Animate(element, "zoomInUp 0.5s");
	if(sound) Media_Audio_Play(Resources_URL("sounds/" + sound + ".mp3", "application"));
	await Document_Element_Animate(UI_Element_Find(element, "emoji"), animation + " 1s");
	await Client_Wait(1);
	
	await Document_Element_Animate(element, "fadeOutUp 0.5s");
    element.remove();
	
    layer.innerHTML = "";	
	
  break;
  
  
  
  
  case "vocab":
	
	var data  = event["d"];
	
	// DISPLAY AUX LAYER
	Classroom_Present_Clear();
	var layer   = Classroom_Present_GetLayer("aux");   
	
	var term    = Classroom_Find_Term(data);
	var sticker = await Vocabulary_Term_Display(term, "big");
	layer.appendChild(sticker);
	
	Classroom_Present_ShowLayer(layer);
	
  break;
  
  
  
  case "doc":
  
	var file = event["d"];
	if(Path_Extension(file.toLowerCase()) != "pdf") file = file + ".pdf";
	
	var lesson_id = Core_State_Get("classroom", ["lesson", "source"], ""); 
    var source    = "content/lessons/" + lesson_id + "/documents/" + file;  console.log(source);
	
    // DISPLAY AUX LAYER
	Classroom_Present_Clear();
	var layer     = Classroom_Present_GetLayer("aux");
	
	
	var container = UI_Element_Create("classroom/document-container", {source});
	layer.appendChild(container);
	
	Classroom_Present_ShowLayer(layer);
	
  break;
  
  
  case "timer":
   
	var duration    = event["d"];
	
	if(!duration || isNaN(duration)) 
	{
     Classroom_Present_StopTimer();
	}
	else
	{
	 Classroom_Present_StartTimer(duration);
	}
	
  break;
  
  
  // SHOWS/HIDES A "LASER POINTER" OVER THE PRESENTATION
  case "pointer":
  
    var layer   = Classroom_Present_GetLayer("pointer");
	var visible = Document_Element_Toggle(layer, "visibility");
	
    if(visible)
	{
     Media_Audio_Play(Resources_URL("sounds/switch.mp3"));
	}
	
  break;
  
  
  
  // SHOWS/HIDES A TRANSPARENT WHITEBOARD OVER THE PRESENTATION
  case "wb-toggle":
  
	Classroom_Present_ToggleWhiteboard();

  break;
  
  
  case "wb-erase":
  
	Classroom_Present_EraseWhiteboard();
  
  break;

  
  
  case "clean":
  
	Classroom_Present_Clear();
  
  break;
  
  
  
  case "full":
  
	UI_Element_Find("presentation-desktop").requestFullscreen();
	
  break;
  
  
  case "exit":	
  
	document.exitFullscreen();
	
  break;
  
  
  case "close":
  
	window.close();
 
  break;
  
 }
 
}



function Classroom_Present_SelectClassroomSlide(event)
{

 var presentation = Core_State_Get("classroom", ["presentation"]);
 // CHILD WINDOW EVENT
 if(typeof event["c"] !== "undefined")
 {
  var element      = window.opener.document.getElementsByClassName("container-column content-centered color-light shadow-sharp-bottom effect-highlight-outline text-caption-small border-rounded");
  var slide        = "";
  switch (event["c"]) {
    case "next-slide":
      slide        = Presentation_Slide_Next(presentation);
      break;
  
    default:
      slide        = Presentation_Slide_Prev(presentation);
  }

  var index        = presentation["slides"].indexOf(slide); 
  let eventselect  = 
  {
    currentTarget: element[index]
  };

  window.opener.Classroom_Present_SelectClassroomSlide(eventselect);
 }
 else// PARENT WINDOW EVENT
 {
  var element      = event.currentTarget;
  var slide        = Document_Element_GetObject(element, "slide");
  var index        = presentation["slides"].indexOf(slide); 

  // CENTER AND UPDATE SLIDE THUMBNAIL
  var thumbnail = slide["thumbnail"];
  var list      = UI_Element_Find("presentation-thumbnails");
  if(thumbnail)
  { 
    thumbnail.scrollIntoView({behavior: "smooth", block: "center"});
    Document_Conditional_Class(list, "style-outlined-accented", thumbnail); 
  }
  
  Core_State_Set("classroom", ["current-slide"],     slide);
  Core_State_Set("classroom", "current-slide-index", index);
  
  //Classroom_Manage_UpdateSelector("instructions");
  //Classroom_Manage_SlideInstructions();
 }
}

document.addEventListener('keydown', event => {
  console.log(`User pressed: ${event.key}`);
  console.log(`event:`, event);
  // if(event.key == 'ArrowUp' || event.key == 'ArrowDown' || event.key == 'ArrowLeft' || event.key == 'ArrowRight')
  // { 
  //   event.preventDefault();
  // }
  return false;
});// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                        P R O J E C T                                           //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Classroom_Manage_DisplayProject()
{
 var class_id       = Core_State_Get("classroom", ["class", "info", "id"]);
 var project_source = Core_State_Get("classroom", ["lesson", "project", "source"]);
  
 // IF A PROJECT HASN'T BEEN ALLOCATED YET, DO IT 
 var project_id = Core_State_Get("classroom", ["class", "info", "project_id"]);
 var teacher_id = Core_State_Get("classroom", ["class", "info", "teacher_id"]);
 
 if(!project_id)
 { 
  project_id     = await Core_Api("Project_Create", {project_id:project_source, class_id, teacher_id});
  await Core_Api("Class_Field_Set", {id:class_id, field:"project_id", value:project_id});
  Core_State_Set("classroom", ["class", "info", "project_id"], project_id);
 }
	


 // PROJECT	
 var project = await Project_Read(project_source) || {};
 Core_State_Set("classroom", "project", project);
 
 var title = UI_Language_Object(project["title"]);
 var page  = UI_Element_Create("classroom/project-page", {title}, {language:"classroom/projects"});
 
 var files     = UI_List_Files(project["files"], "download", {style:"icons"});
 var container = UI_Element_Find(page, "project-files");
 container.appendChild(files);
 

 
 // GROUPS
 var groups    = await Core_Api("Project_List_Students", {project_id});
 var maxgroups = 9;
 var container = UI_Element_Find(page, "project-groups");
 
 for(var n = 1; n <= maxgroups; n++)
 {
  var group   = groups[n] || [];
  var box     = Project_Group_Display(n, group, options = {remove:Classroom_Project_RemoveStudent, file:false})
  
  container.appendChild(box);
 }
 
 
 // SET UP DRAGGING STUDENTS TO GROUPS
 var sources = Document_Element_Children(UI_Element_Find("presentation-students"));
 var destinations = Document_Element_Children(UI_Element_Find(page, "project-groups"));
 
 Document_Handler_DragVirtual(sources, destinations, "style-outlined-accented",
 // DRAG START
 function(event)
 {
  var element = event.srcElement;
  var seat    = Document_Element_GetObject(element, "seat");
  var student = seat["student"] || {};
  
  Core_State_Set("classroom", "dragging-student", student);
 },
 
 function(event)
 // DRAG DROP
 {
  var element = event.srcElement;
  
  var student = Core_State_Get("classroom", "dragging-student");
  
  Classroom_Project_AddStudent(student, element);
 });
 
 var container       = UI_Element_Find("presentation-panel-right");
 container.innerHTML = "";
 container.appendChild(page);
}




async function Classroom_Project_AddStudent(student, group)
{	  
 var project = Core_State_Get("classroom", "project");
 
 
 // TRACE BACK TO GROUP CONTAINER
 group = Document_Element_FindParent(group, "group");

 var class_id      = Core_State_Get("classroom", ["class", "info", "id"]);
 var student_id    = student["id"]
 var name          = (typeof student["nickname"] != "undefined" && student["nickname"] != "") ? student["nickname"] :  student["firstname"];
 var group_id      = Document_Element_GetData(group, "group");
 var project_id    = Core_State_Get("classroom", ["class", "info", "project_id"]);
 
  
 // ALREADY PRESENT IN ONE OF THE GROUPS?
 var ingroup = false;
 var groups  = Document_Element_Children(UI_Element_Find("project-groups"), "group");;
 for(var box of groups)
 {
  var element = Document_Element_FindChild(box, "student_id", student_id);
  if(element)
  {
   var ingroup = box;
   break;
  }
 }
 
 // PRESENT IN THIS SAME GROUP: REJECT
 if(ingroup == group)
 {
  await Document_Element_Animate(element, "rubberBand 0.5s 1");
  return;
 }
 
 // PRESENT IN ANOTHER GROUP: REMOVE FIRST
 if(ingroup)
 {
  element.remove();
 }
 
 
 // ASSIGN

 var item          = UI_Element_Create("classroom/project-group-item", {name}); 
 var img = UI_Element_Find(item, "image");
 User_Picture_Load(img, student["id"], "student");
 
 UI_Element_Find(item, "remove").onclick = Classroom_Project_RemoveStudent;
 
 Document_Element_SetData(item, "project_id", project_id);
 Document_Element_SetData(item, "student_id", student_id);
   
 group.appendChild(item);
 Document_Element_Animate(item, "bounceIn 0.5s 1");

 // CREATE DATABASE RECORD
 var days          = Safe_Get(project, ["info", "duration"], 365);
 var assignment_id = await Core_Api("Project_Assign_Student", {project_id, student_id, group_id, days});
 
 // GENERATE FILE BASED ON ASSIGNMENT ID
 var name          = assignment_id + "-" + group_id; 
 var url           = await Core_Service("file-create", {name, type:"slides"});
 
 // UPDATE DATABASE RECORD
 await Core_Api("Project_File_Set", {assignment_id, url});

}



async function Classroom_Project_RemoveStudent(event)
{
 var element    = event.currentTarget;
 var item       = Document_Element_FindParent(element, "project_id");
 var project_id = Document_Element_GetData(item, "project_id");
 var student_id = Document_Element_GetData(item, "student_id");
 
 Core_Api("Project_Remove_Student", {project_id, student_id}); 
 
 await Document_Element_Animate(item, "bounceOut 0.5s 1");
 item.remove();
}




async function Classroom_Project_Display()
{


  
}


async function Classroom_Project_Assign()
{
}



async function Classroom_Project_DownloadFile(item)
{
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                       C O N T R O L                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Control_OnLoad(module, data)
{
 Core_State_Set("control", "persist", true);
 Core_State_Set("control", "data", data);
 
 var container = UI_Element_Find(module, "control-list"); 
 var tools     = Object_Subset(Core_Data_Page("control/tools"), "tool");
 
 for(var id in tools)
 {
  var tool = tools[id];
  
  var f    = tool["f"];
  var icon = tool["icon"];
  var text = UI_Language_Object(tool);
  
  var box  = UI_Element_Create("control/tool", {icon, text});
  
  box.onclick = Safe_Function(f, function(){});
  
  container.appendChild(box);
 }
}



async function Control_OnShow(module, data)
{
}




async function Control_OnUnload()
{
}






// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                           T O O L S                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Control_Tool_LessonAsClassroom()
{
 var picture  = Resources_URL("images/cover-control.png");
 var title    = UI_Language_String("control/tools", "test classroom title");
 var subtitle = UI_Language_String("control/tools", "test classroom subtitle");
 
 var last     = User_Settings_Get("control", "last lesson");
 var lessons  = Core_State_Get("control", ["data", "lessons"]);
 var options  = [];
 options.push({text:"", value:false});
 for(var lesson of lessons)
 {
  var value  = lesson;
  var text   = lesson;
  var option = {value, text};
  
  options.push(option);
 }
 
 var lesson   = await UI_Popup_Select(title, subtitle, picture, options, last);
 if(!lesson) return;
 
 User_Settings_Set("control", "last lesson", lesson);
 Control_Lesson_AsClassroom(lesson);
}





async function Control_Tool_LessonAsStudentCourse()
{
 var picture  = Resources_URL("images/cover-control.png");
 var title    = UI_Language_String("control/tools", "test courselesson title");
 var subtitle = UI_Language_String("control/tools", "test courselesson subtitle");
 
 var last     = User_Settings_Get("control", "last lesson");
 var lessons  = Core_State_Get("control", ["data", "lessons"]);
 var options  = [];
 options.push({text:"", value:false});
 for(var lesson of lessons)
 {
  var value  = lesson;
  var text   = lesson;
  var option = {value, text};
  
  options.push(option);
 }
 
 var lesson   = await UI_Popup_Select(title, subtitle, picture, options, last);
 if(!lesson) return;

 User_Settings_Set("control", "last lesson", lesson);
 Control_Lesson_AsCourseSeat(lesson);
}




async function Control_Tool_ChangeRole()
{
 var roles    = Core_Config(["roles"]);
 var options  = [];
 for(var role in roles)
 {
  var text  = UI_Language_Object(roles[role]);
  var value = role;
  
  options.push({value, text});
 }
 
 var picture  = Resources_URL("images/cover-control.png");
 var title    = UI_Language_String("control/tools", "role change title");
 var subtitle = UI_Language_String("control/tools", "role change subtitle");
 
 var newrole  = await UI_Popup_Select(title, subtitle, picture, options, User_Role());
 if(!newrole) return;
 
 application["user"]["role"] = newrole;
}








async function Control_Tool_TestSpeechSynthesis()
{ 	 
 var picture = Resources_URL("images/cover-control.png");
 var content = UI_Element_Create("control/tool-speech-synthesis");
 var voices  = await Media_Speech_ListVoices();
 var bylang  = [];
 for(var voice of voices)
 {
  if(!bylang[voice.lang]) bylang[voice.lang] = [];
  bylang[voice.lang].push(voice);
 }
 
 var select_language  = UI_Element_Find(content, "language");
 var select_voice     = UI_Element_Find(content, "voice");
 var input_text       = UI_Element_Find(content, "text");
 
 
 // SELECT LANGUAGE 
 var langs            = Object.keys(bylang);
 Document_Select_AddOption(select_language, "", "");
 for(var lang of langs)
 {
  Document_Select_AddOption(select_language, lang, lang);
 }

 select_language.onchange =
 function()
 {
  User_Settings_Set("control", "last speech synth language", select_language.value);
  
  Document_Select_Clear(select_voice);
  Document_Select_AddOption(select_voice, "", "");
  
  var lang = select_language.value;
  var list = bylang[lang] || [];
  for(var voice of list)
  {
   Document_Select_AddOption(select_voice, voice.name, voice.name, voice);	  
  }
 }
 
 select_voice.onchange = 
 function()
 {
  User_Settings_Set("control", "last speech synth voice", select_voice.value);
 }
 
 select_language.value = User_Settings_Get("control", "last speech synth language");
 select_language.onchange();
 select_voice.value = User_Settings_Get("control", "last speech synth voice");
  
 
 
 // SPEAK
 var speak = 
 function()
 {
  Media_Speech_Speak(input_text.value, select_voice.value);
  
  User_Settings_Set("control", "last speech synth text", input_text.value);
 }
 
 input_text.value = User_Settings_Get("control", "last speech synth text");
 
 Document_Handler_EnterKey(input_text, speak);
 
 var button = 
 { 
  text   : UI_Language_String("control/tool-speech-synthesis", "button speak"), 
  onclick: speak
 }
	
	

 // POPUP
 var title = UI_Language_String("control/tool-speech-synthesis", "popup title");  
 var popup = await UI_Popup_Create({picture, title, content}, [button]);
}




async function Control_Tool_AzureSpeechSynthesis()
{ 	 
 var picture = Resources_URL("images/cover-control.png");
 var content = UI_Element_Create("control/tool-azure-tts");

 
 var select_language = UI_Element_Find(content, "language");
 var select_voice    = UI_Element_Find(content, "voice");
 var select_style    = UI_Element_Find(content, "style");
 var input_text      = UI_Element_Find(content, "text");
 var select_pitch    = UI_Element_Find(content, "pitch");
 var select_rate     = UI_Element_Find(content, "rate");
 
 
 // PITCH
 var page = Core_Data_Page("control/tool-azure-tts");
 var list = Core_Data_Value("control/tool-azure-tts", "voice parameters", "pitch").split(",");
 for(var item of list)
 {
  var value = item;
  var text  = UI_Language_Object(page[item]);
  
  Document_Select_AddOption(select_pitch, text, value);
 }
 
 
 select_pitch.value    = User_Settings_Get("control", "last speech synth pitch", "default");
 select_pitch.onchange = 
 function()
 {
  // STORE LAST PITCH
  User_Settings_Set("control", "last speech synth pitch", select_pitch.value);
 }
 
 
 // RATE
 var page = Core_Data_Page("control/tool-azure-tts");
 var list = Core_Data_Value("control/tool-azure-tts", "voice parameters", "rate").split(",");
 for(var item of list)
 {
  var value = item;
  var text  = UI_Language_Object(page[item]);
  
  Document_Select_AddOption(select_rate, text, value);
 }
 
 select_rate.value    = User_Settings_Get("control", "last speech synth rate", "default");
 select_rate.onchange = 
 function()
 {
  // STORE LAST RATE
  User_Settings_Set("control", "last speech synth rate", select_rate.value);
 }
 
 
 // ON CHANGE TEXT
 input_text.onchange = 
 function()
 {
  // STORE LAST WRITTEN TEXT
  User_Settings_Set("control", "last speech synth text", input_text.value);
 }
 
 
 // LANGUAGE
 var languages = Core_Config(["partner", "localization", "languages"]).split(",");
 for(var language of languages)
 {
  var text  = UI_Language_String("core/languages", language, {}, language);
  var value = language;
  Document_Select_AddOption(select_language, text, value);
 }
 
 
 // ON CHANGE LANGUAGE
 select_language.onchange = 
 async function()
 { 
  select_voice.innerHTML = "";
  
  // STORE LAST USED LANGUAGE
  User_Settings_Set("control", "last speech synth language", select_language.value);
  
  var voices   = await Services_Azure_LocaleVoices(select_language.value);
  var dialects = Object.keys(voices);
  for(var dialect of dialects)
  {
   Document_Select_AddOption(select_voice, dialect.toUpperCase(), "").disabled = true;
   Document_Select_AddOption(select_voice, "", "").disabled = true;
   
   for(var voice of voices[dialect])
   {
	if(voice["StyleList"]) var style = " *"; else var style = "";
		
	var text   = voice["LocalName"] + style;
	var value  = voice["ShortName"];
	var option = Document_Select_AddOption(select_voice, text, value);
	
	Document_Element_SetObject(option, "voice", voice);
   }
   
   Document_Select_AddOption(select_voice, "", "").disabled = true;
  }
 }
 
 
 // ON CHANGE VOICE
 select_voice.onchange = 
 async function()
 { 
  select_style.innerHTML = "";
  
  var option = Document_Select_SelectedOption(select_voice);  
  var voice  = Document_Element_GetObject(option, "voice");
  if(!voice) return;
  
  // STORE LAST USED VOICE
  User_Settings_Set("control", "last speech synth voice", select_voice.value);
  
  for(var style of voice["StyleList"] || [])
  {
   var text   = style;
   var value  = style; 
   Document_Select_AddOption(select_style, text, value);
  }
  
  select_style.onchange = 
  function()
  {
   // STORE LAST USED STYLE
   User_Settings_Set("control", "last speech synth style", select_style.value);
  }
  
  select_style.value = User_Settings_Get("control", "last speech synth style");
 }
 
 
 
 // INIT
 select_language.value = UI_Language_Current();
 await select_language.onchange();
 select_voice.value = User_Settings_Get("control", "last speech synth voice");
 await select_voice.onchange();
 select_style.value = User_Settings_Get("control", "last speech synth style");
 
 
 // SAVE =
 var save = 
 async function()
 {
  var options = {};
  options["lang"]  = select_language.value;
  options["style"] = select_style.value;
  options["pitch"] = select_pitch.value;
  options["rate"]  = select_rate.value;
  
  var audio = await Services_Azure_Speak(input_text.value, select_voice.value, options);
  
  var filename = Document_Select_SelectedOption(select_voice).text + " " + Date_Now() + ".mp3"; 
  await Storage_Blob_Download(audio, filename);
 }
 
 var button_save = 
 { 
  text   : UI_Language_String("control/tool-azure-tts", "button save"), 
  onclick: save
 }
	


 // SPEAK
 var speak = 
 async function()
 {
  var options = {};
  options["lang"]  = select_language.value;
  options["style"] = select_style.value;
  options["pitch"] = select_pitch.value;
  options["rate"]  = select_rate.value;
  
  var audio = await Services_Azure_Speak(input_text.value, select_voice.value, options);
  
  Media_Audio_Play(audio);
 }
 
 input_text.value = User_Settings_Get("control", "last speech synth text") || "";
 
 Document_Handler_EnterKey(input_text, speak);
 
 var button_speak = 
 { 
  text   : UI_Language_String("control/tool-azure-tts", "button speak"), 
  onclick: speak
 }
 
 
 // CLOSE
 var close = 
 async function()
 {
  UI_Popup_Close(popup);
 }
  
 var button_close = 
 { 
  text   : UI_Language_String("control/tool-azure-tts", "button close"), 
  onclick: close
 }
	
	

 // POPUP
 var title = UI_Language_String("control/tool-azure-tts", "popup title");  
 var popup = await UI_Popup_Create({picture, title, content}, [button_speak, button_save, button_close], "flexi", {open:true, escape:false});
}







// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          M O R E                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



async function Control_Lesson_AsCourseSeat(lesson_id)
{
 var virtual = await Core_Api("Control_Virtual_Seat", {lesson_id});
 
 var display = UI_Element_Find("main-module");
 await Course_Class(display, virtual["seat_id"]); 

 await Core_Api("Control_Virtual_Cleanup", {virtual});
}




async function Control_Lesson_AsClassroom(lesson_id)
{
 var virtual = await Core_Api("Control_Virtual_Seat", {lesson_id});

 Core_State_Set("global", ["view-class"], virtual["class_id"]);
 await Module_Load("classroom");
 
 await Core_Api("Control_Virtual_Cleanup", {virtual});
}


// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          C O R E                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

application = {};


function Core_Init(partner)
{
 application["html"]                  = application_html; 
 application["data"]                  = application_data;
 application["config"]                = application_config;

 application["user"]                  = {};
 
 application["state"]                 = {};
 application["state"]["core"]         = {};
 application["state"]["core"]["lang"] = Client_Language_Get();

 Safe_Set(application, ["config", "partner", "name"], partner);
}




async function Core_User()
{
 var user = Safe_Get(application, ["user"], {});
 var data = await Core_Api("User_Read", {options:{settings:true, permissions:true, propic:true}});
 
 Object.assign(user, data);
 Safe_Set(application, ["user"], user);
 
 return user;
}



function Core_Config(config, def)
{
 if(typeof config == "string") var config = [config];
 
 return Safe_Get(application, ["config", ...config], def);
}





async function Core_Login(id, password)
{
 var response = await Core_Api("Core_Login", {user_id:id, password:password});

 if(typeof response == "string")
 {
  switch(response)
  {
   case "no":
   break;
   
   case "nouser":
   break;
  
   case "wrongpass":
   break;
  }

  return false;  
 }
 else
 {
  application["user"] = response;
  return true;
 }
}



async function Core_Logout()
{
 await Core_Api("Core_Logout", {});
 
 delete application["user"];
}



async function Core_Reload()
{
 var initial = Core_State_Get("core", ["initial-page"], "home");
 
 await Module_Load(initial, document.body);
}




function Core_State_Get(module, field = [], def)
{
 if(typeof field == "string") field = [field];
 
 return Safe_Get(application, ["state", module, ...field], def);
}




function Core_State_Set(module, field = [], value)
{
 if(typeof field == "string") field = [field];
 
 return Safe_Set(application, ["state", module, ...field], value);
}





async function Core_Api(func, params = {}, options = {type:"json"})
{
 var url      = Path_Folder(document.location.origin + document.location.pathname) + "/api.php?f=" + func;  
 var response = await Request_Post(url, params, options["type"]);
 
 return response;
}




async function Core_Service(service, params, options = {type:"json"})
{
 // FIRST CHECK IF IT'S A CONFIGURED SERVICE
 var url = Core_Config(["system", "services", service]) || service;
 url     = document.location.origin + "/services/" + url;
 
 // CALL
 var response = await Request_Post(url, params, options["type"]);
 
 // WRITE LOG
 await Core_Api("Users_Write_Log",{
    event: service,
    data: {
        api_name : service,
        request : params,
        response : ((JSON.stringify(response)).length < 65.535) ? response : "too much characters" 
    },
    user_id: User_Id()
 });
 
 // RETURN
 return response;
}




async function Core_Script(service, params, options = {type:"text"})
{
 // FIRST CHECK IF IT'S A CONFIGURED SERVICE
 var url = document.location.origin + document.location.pathname + "services/" + service;
 
 // CALL
 var response = await Request_Post(url, params, options["type"]);
 
 // WRITE LOG
 await Core_Api("Users_Write_Log",{
    event: service,
    data: {
        api_name : service,
        request : params,
        response : ((JSON.stringify(response)).length < 65.535) ? response : "too much characters" 
    },
    user_id: User_Id()
 });
 
 // RETURN
 return response;
}






function Core_Data_Page(pageid)
{
 if(!pageid.includes("/")) pageid = pageid + "/module";
 
 var page = Safe_Get(application, ["data", pageid], {});
 
 return page;
}





function Core_Data_Pages(module)
{
 var data  = Object_Subset(application["data"], module);
 var pages = Object.keys(data);

 for(var i in pages) pages[i] = pages[i].replace(module + "/", "");

 return pages;
}





function Core_Data_Section(pageid, section)
{
 var page = Core_Data_Page(pageid);
 
 var data = Safe_Get(page, [section]);
 return data; 
}





function Core_Data_Sections(pageid)
{
 var page = Core_Data_Page(pageid);
 
 var sections = Object.keys(page);
 return sections; 
}




function Core_Data_Keys(pageid, section)
{
 var page = Core_Data_Page(pageid);
 
 var data = Safe_Get(page, [section], {});
 
 var keys = Object.keys(data);
 return keys; 
}




function Core_Data_Value(pageid, section, field, def)
{
 var page = Core_Data_Page(pageid);
 
 var value = Safe_Get(page, [section, field], def);
 
 return value;
}



function Core_Magic()
{
 if(Client_Location_Parameter("magic") == 137) return true;
 
 return User_Can("cast-spells");
}




async function Core_App_Register(worker)
{
 var registration = Core_State_Get("core", ["app", "registration"]);
 if(registration) return registration;
 
 window.addEventListener("beforeinstallprompt", 
 function(event)
 {
  Core_State_Set("core", ["app", "installer"], event);
  
  event.preventDefault();
 });
 
 var registration = await navigator.serviceWorker.register(worker);
 Core_State_Set("core", ["app", "registration"], registration);
  
 return registration;
}



async function Core_App_Install()
{
 var installer = Core_State_Get("core", ["app", "installer"]);
 
 if(installer) 
 {
  var result = await installer.prompt();
  return result.outcome;
 }
 
 return "unavailable";
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          D A T A                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//




function Data_Page_Complete(data, config, sections = false)
{
 var page = data;
 
 if(sections)
 {
  for(var section in config) 
  {
   if(!page[section]) page[section] = {};
  }
 }
 
 for(var section in config)
 {
  page[section] = data[section] || config[section];
 
  for(var field in config[section])
  {
   var value = Safe_Get(data, [section, field], undefined);
   if(value === undefined) var value = Safe_Get(config, [section, field]);
   
   Safe_Set(page, [section, field], value);
  }
 }
 
 return page;
}







function Data_Page_Sanitize(data, config, complete = false)
{
	
 // 1. CLEAN UP DATA FROM UNWANTED SECTIONS
 for(var section in data)
 {
  // ANALIZE SECTIONS. SECTIONS THAT ARE ARRAYS OR OBJECTS SHOULD BE SANITIZED.
  // WE SKIP SECTIONS THAT ARE INDIVIDUAL VALUES
  var sanitize_section = (typeof(data[section]) == "object" || typeof(data[section]) == "array");
  
  if(sanitize_section)
  {
   
   if(!Data_Key_Compliant(section, config))
   {
    delete data[section];
   }
   else
   {
	// SECTION VALIDATED. BUT NOW WE SHOULD SANITIZE ITS KEYS
	// REMEMBER WE MUST COMPARE WITH THE TEMPLATE SECTION FOR THAT SECTION, NOT THE SECTION ITSELF
	var section_template = String_Numtemplate_Derive(section) || section;
	
	for(var key in data[section])
	{
     var invalid_key = (typeof(data[section][key]) == "object" || typeof(data[section][key]) == "array");
	 
     if(invalid_key || !Data_Key_Compliant(key, config[section_template]))
	 {
	  delete data[section][key];
	 }
	}
	
   }
   
  }
  
 }
 
 
 // 2. COMPLETE WITH MISSIN STANDARD SECTIONS
 if(complete)
 {
  for(var id in config)
  {
   var info = String_Numtemplate_Info(id);
   if((info["digits"] == 0) && !data[id])
   {
    Data_Section_Add(data, config, id);
   }
  }
 }
 
}







function Data_Page_FromConfig(config = {})
{
 var data = {};

 
 // SCAN CONFIG SECTIONS
 for(var section_id in config)
 {
  var section = config[section_id];
  
  // CHECK IF SECTION IS A TEMPLATE
  var template = section_id.split(" ");
  digits       = template[template.length - 1] || "";
  if(digits.includes("N"))
  {
   template = template[0];
   digits   = digits.trim().length;
   var s_id = template + " " + "0".repeat(digits);
  }
  else
  {
   var s_id = section_id;
  }
  
  // CREATE DATA SECTION
  data[s_id] = {};
  
  // SCAN CONFIG SECTION'S KEYS
  for(var field_id in section)
  {
   // CHECK IF KEY IS A TEMPLATE
   var template = field_id.split(" ");
   digits       = template[template.length - 1] || "";
   if(digits.includes("N"))
   {
    template = template[0];
    digits   = digits.trim().length;
    var f_id = template + " " + "0".repeat(digits);
   }
   else
   {
	var f_id = field_id;
   }
   
   
   // GET DEFAULT VALUE FOR THIS FIELD
   var field = Object_From_String(config[section_id][field_id]);
   var value = field["default"] || "";
   
   
   data[s_id][f_id] = value;
  }
  
 }
 
 return data;
}




function Data_Config_Templates(config, section_id)
{ 
 var templates = {};
 
 // RETURN CONFIG SECTION TEMPLATES
 if(!section_id)
 {
  var keys = Object.keys(config);
 }
 else
 // RETURN SECTION FIELD TEMPLATES
 {
  // WE NEED TO DERIVE A TEMPLATE SECTION FROM THE SECTION ID, IN ORDER TO LOOK FOR TEMPLATE FIELDS IN IT
  var section_template = String_Numtemplate_Derive(section_id) || section_id;
  var section          = config[section_template];
  if(section) var keys = Object.keys(section); else var keys = [];
 }
 
 
 // DETERMINE WHICH KEYS ARE TEMPLATES (STRING WITH LAST PORTION BEING A SEQUENCE OF "N" = IT'S A TEMPLATE)
 for(var key of keys)
 {
  var name = key.split(" ");
  if(name.length > 1 && name[name.length -1].includes("N"))
  {
   var template = {};
   
   template["name"]   = name[0].trim();
   template["digits"] = name[name.length -1].trim().length;
  
   templates[key] = template;
  }
 }	 

 return templates;
}




// NOTE: CALL WITH config[section] IF NEED TO CHECK COMPLIANCY OF A FIELD
function Data_Key_Compliant(id, config, templateonly)
{
 // SCAN ALL KEYS AND SEE IF IT MATCHES ONE
 for(var key in config)
 {
  // IDENTICAL TO ONE OF THE KEYS? THEN IT COMPLIES
  if(id == key && !templateonly) return true;
   
  // MAYBE IT MATCHES A TEMPLATE? THEN IT COMPLIES
  var template = String_Numtemplate_Info(key);
  if(template["digits"] > 0 && String_Numtemplate_Comply(id, template)) return true;
 }
  
 return false;
}





function Data_Section_Add(data, config, templateid)
{
 var template = String_Numtemplate_Info(templateid);
 if(template["digits"] == 0) 
 {
  var id = templateid; 
 }
 else 
 {
  var sections = Object.keys(data);
  var id       = String_Numtemplate_Next(template, sections);
 }
 
 var section = {};
 for(var field in config[templateid])
 {
  var field_config = Object_From_String(config[templateid][field]);
  section[field]   = field_config["default"] || "";
 }
 
 data[id] = section;
 
 return {data:section, id};
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      H A N D L E R S                                           // 
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



async function Handler_Speech_Recognition(sentences, content_lang, container, config = {})
{ 
 Document_Element_Disable(container);
	
 // SPEECH SERVICE URL
 var service = Safe_Get(application, ["config", "system", "speech", "service"], "");
 service     = Client_Variables_Apply(service);
 
 
 // CALCULATE LONGEST POSSIBLE SPEECH TIME
 var letter_time = config["letter_time"] || 150;
 var pause_time  = config["pause_time"]  || 250;
 var max         = 0;
 for(var sentence of sentences) 
 {
  var time           = String_Speak_Time(sentence, letter_time, pause_time);
  if(time > max) max = time;
 }
 max = max + 500;
 if(max < 3000) max = 3000;
 
 
 // CREATE GAUGE
 var color  = Document_CSS_GetVariable("color-alert");
 var gauge  = UI_Gauge_ProgressCircle(container, undefined, color);
 UI_Gauge_TimeUpdate(gauge, max);
   
 // FIRE RECOGNITION
 var lang_code = Core_Data_Value("core/languages", "en", "code"); console.log(lang_code);
 var result    = await Media_Speech_RecognizeCustom(sentences, lang_code, max, service,
   
 // ON RECORD START
 function()
 {
  if(config["icon"])
  {
   config["icon"].style.color = "var(--color-alert)";
   Document_Element_Animate(config["icon"], "flash 1.5s ease-in-out infinite");
  }
  
  if(config["onstart"]) config["onstart"]();
 },
   
 // ON RECORD END
 function()
 {
  if(config["icon"])
  {
   config["icon"].style.color = "";
   Document_Element_Animate(config["icon"], false);
  }
  
  gauge.remove();
  
  if(config["onend"]) config["onend"]();
 }); 
 
 Document_Element_Restore(container); 
 
 return result; 
}








async function Handler_Element_Feedback(element, value, options = {})
{  
 var feedback  = Core_Data_Section("core/feedback", value);
  
  
 if(options["outline"]) 
 {
  var outline = "outline-" + options["outline"];
 }
 else
 {
  var outline = "outline-inner";
 }
  
  
 if(options["lock"])
 {
  Document_Element_Disable(options["lock"]);
 }

 
 var removed = Document_CSS_PurgeClasses(element, "style-outlined");
 if(!options["nostyle"]) 
 {
  Document_CSS_SetClass(element, "style-outlined-" + feedback["color"]);
  Document_CSS_SetClass(element, outline);
 }
 
 if(!options["silent"])
 {
  Media_Audio_Play(Resources_URL("sounds/" + feedback["sound"] + ".mp3"));
 }
 
 
 await Document_Element_Animate(element, feedback["animation"]);  
 
 
 if(!options["permanent"])
 {
  Document_CSS_UnsetClass(element, "style-outlined-" + feedback["color"]);
  Document_CSS_UnsetClass(element, outline);
  
  Document_CSS_SetClasses(element, removed);
 }
 

 if(options["lock"])
 {
  Document_Element_Restore(options["lock"]);
 }
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                     M O D U L E S                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Module_Load(module, container, configuration = {})
{
 var namespace = String_Capitalize_Initial(module);
 console.log("Loading Module " + module); 
 
 
 // UNLOAD PREVIOUS MODULE   
 await Module_Unload();
 
 // SET SELECTED MODULE
 Safe_Set(application, ["state", "core", "module"], module);
 
 // INIT MODULE STATE IF NEVER LOADED BEFORE
 var state = Core_State_Get(module);
 if(!state) Safe_Set(application, ["state", module], {}, true);
 
 // RESET MODULE STATE IF NOT SET TO PERSIST
 /*
 var persist = Core_State_Get(module, "persist");
 if(!persist) 
 {
  Safe_Set(application, ["state", module], {}, true);
 }
 */
 
 // INITIALIZE MODULE HTML
 var element = UI_Element_Create(module + "/module");
 Core_State_Set("core", "module-body", element);
 
 
 // EXPLICITLY MULTIPAGE MODULE?
 /*
 var pages  = Module_Data(module, "module", "pages", "");
 pages      = pages.split(",");
 
 if(pages.length > 0)
 {
  // CREATE A HEADER TO ACCESS PAGES
  var items = [];
  
  for(let page of pages)
  {  
   var item        = {};
   item["text"]    = UI_Language_Object(Module_Data(module, "page " + page, undefined, {})) || page;
   item["onclick"] = 
   function()
   {
	Module_Page_Set(page);
   }
   
   items[page]     = item;
  }
  
  var header    = UI_Header("module-page-select", items, {selectfirst:false, css:"color-noted"});  
 
  var selector = UI_Element_Find(element, "module-header");
  if(selector) selector.appendChild(header);
 }
 */
 if(module == 'perftest'){
	 let ipinfo = await fetch("https://api.ipify.org?format=json").then(res => res.text());
	 await Core_Api("Users_Login_Write_Log",{
 event: "perftest",
 data: {
      api_name : "perftest",
      request : "perftest from:",
	  ip: ipinfo,
      response : "perftest"
 }
 });
 }
 // ONLOAD (EVERYTHING BEFORE INJECTING MODULE UI)
 var Module_OnLoad = Safe_Function(namespace + "_OnLoad");
 if(Module_OnLoad) 
 {
  var data = await Core_Api(namespace + "_Load", configuration);
  await Module_OnLoad(element, data);
 }
 
 
 // INJECT MODULE UI AND CALL ONSHOW
 if(!container) var container = document.getElementById("main-module");
 if(container){
	 container.innerHTML = "";
	 container.appendChild(element);
 }
 
 var Module_OnShow = Safe_Function(namespace + "_OnShow");
 if(Module_OnShow) 
 {
  await Module_OnShow(element, data);
 }
}




async function Module_Unload()
{ 
 var module = Module_Current();
 
 if(module)
 {
  var namespace = String_Capitalize_Initial(module);
 
  var Module_OnUnload = Safe_Function(namespace + "_OnUnload");	
  if(Module_OnUnload) 
  {
   await Module_OnUnload();
  }
 }
 
 Safe_Delete(application, ["state", "core", "module"]);
}





function Module_Current()
{
 var module = Safe_Get(application, ["state", "core", "module"], false);
 
 return module;
}




function Module_Data(module, section, field, def)
{
 var get           = ["data", module + "/module"];
 if(typeof section != "undefined") get.push(section);
 if(typeof field   != "undefined") get.push(field);
 	
 var value = Safe_Get(application, get, def);
 
 return value;
}




function Module_Config(module, field, def)
{
 return Safe_Get(application, ["config", "modules", module, field], def);
}





function Module_Preload_Set(module, parameter, value)
{
 Core_State_Set("modules", ["preload", module, parameter], value);
}





function Module_Parameter_Get(parameter, module)
{
 if(!module) var module = Module_Current();
 
 
 // FIRST CHECK IF PARAMETER SET BY URL
 var value = Client_Location_Parameter(parameter);
 
 
 // THEN CHECK IF SET BY ANOTHER MODULE
 if(!value)
 {
  var value = Core_State_Get("modules", ["preload", module, parameter]);
  Core_State_Set("modules", ["preload", module, parameter], undefined);
 }
 
 
 // FINALLY CHECK IF ALREADY PREVIOUSLY SET/STORED 
 if(!value)
 {
  var value = Core_State_Get(module, parameter);
 }
 
 
 return value;
}







// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                         P A G E S                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

function Module_Page_Get()
{
 var module = Module_Current();
 
 // TRY IN ORDER:
 // - HARD SETTING FROM URL PARAMETER IN module-page FORMAT
 // - CURRENT STATE
 // - DEFAULT AS SPECIFIED BY MODULE CONFIGURATION DATA
 // - USER GIVEN DEFAULT
 var page = Client_Location_Parameter("page") || Core_State_Get(module, ["page"]) || Module_Data(module, "module", "default-page") || "main";
 
 return page;
}





async function Module_Page_Set(page)
{
 var module = Module_Current();
 
 // IF NO PAGE IS GIVEN, TRY A DEFAULT
 if(!page) var page = Module_Page_Get();
 
 console.log("Module Page: ", page);
 
 // STORE STATE
 Core_State_Set(module, ["page"], page); 
 
 // IDENTIFY AND CALL (IF AVAILABLE) PAGE INITIALIZATION FUNCTION
 var page_function = String_Capitalize_Initial(module) + "_" + String_Capitalize_Initial(page);
 var page_function = window[page_function];
 if(page_function) 
 {  
  var body = Core_State_Get("core", "module-body");
  
  // LOAD PAGE HTML
  var submodule = UI_Element_Create(module + "/" + page, {}, {language:module + "/" + page});
  var container = UI_Element_Find(body, "module-page");
  
  Core_State_Set(module, "submodule", submodule);
  await page_function(submodule);
  
  container.innerHTML = "";
  container.appendChild(submodule);
 }
 
}




function Module_Page_Body()
{
 var module = Module_Current();
 
 return Core_State_Get(module, "submodule");	
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      P A R T N E R                                             //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

function Partner_Name()
{
 var name = Safe_Get(application, ["config", "partner", "name"], "default");
 
 return name;
}



function Partner_Data(section, field)
{
 var value = Safe_Get(application, ["config", "partner", section, field]);
 
 return value;
}




function Partner_Languages()
{
 var languages = {};
 
 var used = Partner_Data("localization", "languages");
 used     = used.split(",");
 
 
 var all = Core_Data_Page("core/languages");
 for(var id of used)
 {
  languages[id] = all[id];
 }
 
 return languages;
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                             U I                                                // 
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



function UI_Element_Component(source)
{
 // DETERMINE PLATFORM IN USE, DEFAULT TO DESKTOP
 var platform = Safe_Get(application, ["state", "core", "platform"], "desktop");  
 
 // GET COMPONENT HTML. IF NOT AVAILABLE FOR THE SPECIFIED PLATFORM, GET IT IN ITS DEFAULT (DESKTOP) VERSION
 var html                = Safe_Get(application, ["html", source, platform], "");
 if(html == "") var html = Safe_Get(application, ["html", source, "desktop"], "");
 if(html == "") var html = "<null></null>";
 
 return html;
}




function UI_Element_Create(source, variables, options = {})
{		
 // GET COMPONENT HTML
 if(options["html"]) 
 {
  var html = source;
 }
 else
 {
  var html = UI_Element_Component(source);
 }
 
 // SEARCH FOR REFERENCE TO CORE COMPONENTS
 var tokens = String_Extract_TagContent(html, "<element", "/>");
 for(var token of tokens)
 {
  // GET COMPONENT NAME (LAST ATTRIBUTE OF THE TAG)	 
  var parts     = token.trim().split(" ");
  var name      = parts[parts.length - 1];
  
  // GET COMPONENT HTML AND BLEND IT WITH CUSTOM TAG ADDITIONAL ATTRIBUTES
  var component  = UI_Element_Component("core/" + name);
  var parts      = String_HTML_SegmentTag(component);
  component      = [parts["head"], parts["content"], token, parts["tail"]].join(" ");
 
 
  // APPLY TEMPLATE VARIABLES
  var sets = String_Extract_TagContent(component, "{", "}");
  for(var set of sets)
  { 
   var obj   = Object_From_String(set);
   component = String_Variables_Set(component, obj);  
  }
 
  
  // REPLACE ORIGINAL CUSTOM TAG WITH BLENDED COMPONENT 
  var tag       = "<element" + token + "/>";
  html          = html.replace(tag, component);
 }
 

 // APPLY ELEMENT'S PARENT MODULE LANGUAGE
 var path = Path_Folder(source);
 html = UI_Language_Apply(html, path + "/module");
 
 // APPLY CORE LANGUAGE
 html = UI_Language_Apply(html, "core/module");
 
 // APPLY OPTIONAL EXTRA LANGUAGE
 if(options["language"])
 {
  html = UI_Language_Apply(html, options["language"]);
 }
 
 // APPLY VARIABLES
 if(variables) html = String_Variables_Set(html, variables);
 
 
 if(options["structure"])
 // SPECIFIC DOM ELEMENT STRUCTURE
 {
  var element       = document.createElement(options["structure"]); 
  element.innerHTML = html;  
 }
 else
 // GENERIC ELEMENT
 {
  var element       = document.createElement(null); 
  element.innerHTML = html;
  element           = element.firstElementChild;
 }
 
 
 // *** ELEMENT HAS NOW BEEN CREATED
 // *** MOVE TO PREPROCESS IT
 
 // COLLECT ALL ELEMENT CHILDREN AND PROCESS THEM FOR AUTODATA FROM SPECIAL TAGS
 var children = Document_Element_Children(element, true);
 for(var child of children)
 { 
  // HAS AN OPTIONS SOURCE?
  var source = Document_Element_GetData(child, "optsource");
  if(source)
  { 
   Document_Select_AddOption(child, "", "");
  
   var page = Core_Data_Page(source);
   var keys = Object.keys(page);
   for(var key of keys)
   {
    var text  = UI_Language_Object(page[key]);
   
    Document_Select_AddOption(child, text, key);
   } 
  }
 }
 
 
 // *** RETURN ASSEMBLED ELEMENT
 return element;
}





function UI_Element_Find(root, uid, options = ["recurse"])
{
 // SPECIAL CASE: IF CALLED WITH ONLY ONE ARGUMENT, WILL TREAT THAT AS UID AND SCAN THE WHOLE DOCUMENT ACCORDINGLY
 if(arguments.length == 1) 
 {
  var uid     = root;
  var root    = document.body;
 }
 
 var element = Document_Element_FindChild(root, "uid", uid, options);


 return element;
}








// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          D A T A                                               // 
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function UI_Element_HasData(element, name)
{
 return element["applicationdata"] && (element["applicationdata"][name] !== undefined);
}





function UI_Element_GetData(element, name)
{
 if(!UI_Element_HasData) return undefined;
 
 return element["applicationdata"][name];
}





// TRACES BACK FROM AN EVENT, LOOKING FOR THE
function UI_Element_TraceData(event, dataname, datavalue)
{
 var root = Document_Event_Source(event);
 if(!root) return undefined;
}





function UI_Element_SearchData(root, dataname, datavalue)
{
}



function UI_Value_FromDatapage(element, page, value)
{
 if(typeof page == "string") var page = Core_Data_Page(page);
 var item = page[value] || {};
 
 element.value = UI_Language_Object(item);
}



function UI_Select_FromConfig(select, config)
{
 var data = Core_Config(config);
 
 for(var key in data)
 {
  var option   = new Option();
  option.text  = UI_Language_Object(data[key]);
  option.value = key;
  
  select.appendChild(option);
 }
}



function UI_Select_FromDatapage(select, page, category_field, categories = {}, category_style = "", filter)
{
 if(typeof page == "string") var page = Core_Data_Page(page);
 
 var catalog = {};
 
 // IF NO CATEGORY SPECIFIED, JUST GROUP ALL THE DATAPAGE TOGETHER
 if(!category_field)
 {
  catalog["*"] = page;
 }
 else
 // OTHERWISE ORGANIZE BY CATEGORY
 {
  for(var id in page)
  {
   var item     = page[id];
  
   var category = item[category_field];
   if(!catalog[category]) catalog[category] = {};
  
   catalog[category][id] = item;
  }
 }
 
 
 // CREATE OPTIONS
 for(var category in catalog)
 {
  // IF NO CATEGORY, DON'T ADD AN HEADER AND NO NEED FOR A SPACE BETWEEN CATEGORIES 
  if(category == "*")
  {
   var addspace = false;
  }
  else
  // OTHERWISE CREATE A HEADER FOR THIS CATEGORY, AND ADD A SPACE AFTER ALL ITS ITEMS
  {
   var text        = UI_Language_Object(categories[category]) || category;
   var value       = category;
   var option      = Document_Select_AddOption(select, text, value); 
   option.disabled = true;
   Document_CSS_SetClass(option, category_style);
   
   var addspace = true;
  }

  
  // CATEGORY OPTIONS
  for(var id in catalog[category])
  {  
   var item = catalog[category][id];
   
   if(!filter || filter(item))
   {
    var text   = UI_Language_Object(item);
    var value  = id;
    var option = Document_Select_AddOption(select, text, value); 
   }
  }
  
  
  // BLANK SPACE NEEDED?
  if(addspace)
  {
   var option      = Document_Select_AddOption(select, "", "");
   option.disabled = true;
  }
  
 }
}








// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                        P O P U P S                                             // 
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



async function UI_Popup_Create(data = {}, buttons = [], template = "core/popup-standard", config = {open:true, escape:true})
{	
 // LAYER: DARK BACKGROUND    WHITESPACE: ON TOP OF THE BACKGROUND    WINDOW: INSIDE WHITESPACE
 var popup      = UI_Element_Create("core/layer-glass-thin");
 Document_Element_SetObject(popup, "data",   data);
 Document_Element_SetObject(popup, "config", config);
 
 // THE POPUP ITSELF
 if(!template.includes("/"))
 {
  template = "core/popup-" + template;
 }
 
 var whitespace = UI_Element_Find(popup, "layer-front");
 var win        = UI_Element_Create(template, data); 
 Document_Element_SetData(win, "uid", "popup-window");
 
 
 // COLLAPSE UNSET ELEMENTS
 for(var id of ["title", "subtitle", "picture"])
 {
  if(!data[id]) 
  {
   var element = UI_Element_Find(win, id);
   if(element) 
   {
	//element.style.display = "none";
    element.remove();
   }
  }
 }
 
 
 // CONTENT
 var content   = Safe_Get(data, ["content"], "");
 var container = UI_Element_Find(win, "content");
 
 // NO CONTENT
 if(!content)
 {
  //container.style.display = "none";
 }
 else
 // EXPLICIT ELEMENT TO APPEND INSIDE
 if(typeof content == "object")
 {
  if(container) container.appendChild(content); else win.appendChild(content);
 }
 else
 // INTERPRET CONTENT TEXT
 {
  switch(content)
  {
   case "input":
		//data["placeholder"];
		var input = UI_Element_Create("core/control-edit-popup");
		Document_Element_SetData(input, "uid", "input");
		
		if(data["placeholder"]) input.placeholder = data["placeholder"];
		
		container.appendChild(input);
   break;
   
   case "select":
		//data["options"]
		var select = UI_Element_Create("core/control-dropdown-popup");
		Document_Element_SetData(select, "uid", "select");
		
		container.appendChild(select);
   break;
   
   // CONTENT = PURE TEXT
   default:
		container.innerHTML = content;
   break;
  }
 }
 
 
 // WHITESPACE IS THE TOPMOST EVELEMENT SO APPEND AND ATTACH POPUP DATA TO IT
 whitespace.appendChild(win);
 Document_Element_SetObject(whitespace, "popup", popup);
 
 
 // ESCAPE: AUTOMATICALLY CLOSE THE POPUP IF CLICKED OUTSIDE CONTENT AREA
 if(config["escape"])
 {
  whitespace.onclick =
  async function(event)
  {
   // PROCESS ONLY IF DIRECT CLICK ON WHITESPACE	    
   if(event.srcElement != event.currentTarget) return;
   
   var popup = Document_Element_GetObject(event.currentTarget, "popup");
	
   // IF ESCAPE IS A FUNCTION, USE IT TO CHECK WHETHER TO ACTUALLY ESCAPE OR NOT (USEFUL FOR CONFIRMATION EXITS)	 
   if(typeof config["escape"] == "function") var proceed = await config["escape"](); else var proceed = true; 	 
   
   if(proceed)
   {	   
    UI_Popup_Close(popup);
	
    var data     = Document_Element_GetObject(popup, "data");
    var onescape = data["onescape"];
    if(onescape) onescape(popup);
   }
   
  }
 }
 
 
 // IF BUTTONS DEFINED, ADD BUTTONS
 var container = UI_Element_Find(win, "buttons");
 if(container)
 {
  if(buttons && buttons.length > 0)
  {
   for(let button of buttons)
   {   
    // LINK BUTTON TO POPUP
	var button_template = button["template"] || "button-popup-plain";
	
    var element = UI_Element_Create("core/" + button_template, {text:button["text"]});
    Document_Element_SetObject(element, "popup", popup);
    
	
    // DETERMINE BUTTON ACTION (STANDARD ACTIONS OR CUSTOM EVENT)
    switch(button["onclick"])
    {
	 case "close": 
		  element.onclick = 
		  function(event)
		  {
		   var popup = Document_Element_GetObject(event.currentTarget, "popup");
           UI_Popup_Close(popup);
		  }
	 break;
	   
     default:
		 element.onclick = 
		 function(event)
		 {
	      var popup = Document_Element_GetObject(event.currentTarget, "popup"); 
	      button["onclick"](popup);
 	 	 }
 	 break;
    }
   
    // ADD BUTTON
    container.appendChild(element);
   }
  }
  else
  {
   container.style.display = "none";
  }
 }
 
 
 // IMMEDIATELY OPEN ON CREATION, IF SO CONFIGURED
 if(config["open"]) 
 { 
  console.log("opening... ");
  await UI_Popup_Show(popup, config);
  console.log("opened");
 }	 
 
 
 return popup;
}






async function UI_Popup_Show(popup, config)
{
 var config = config || Document_Element_GetObject(popup, "config");
 
 // BLUR THE BACKGROUND
 var body = UI_Element_Find(document.body, "main-body");
 Document_CSS_SetClass(body, "style-blurred-medium");


 // SHOW POPUP
 document.body.appendChild(popup);
 
 
 if(!config["instant"]) 
 {
  var win       = UI_Element_Find(popup, "popup-window");
  var animation = config["animation"] || "zoomIn 0.125s linear 1";
  
  await Document_Element_Animate(win, animation);
 }
}




async function UI_Popup_Close(popup)
{
 var config  = Document_Element_GetObject(popup, "config");
  
 // UNBLUR THE BACKGROUND
 var body = UI_Element_Find(document.body, "main-body");
 Document_CSS_UnsetClass(body, "style-blurred-medium");

 
 // REMOVE POPUP
 popup.remove();

 
 // CALL ONCLOSE EVENT IF PRESENT
 var onclose = config["onclose"];
 
 if(onclose) onclose(popup);
}





async function UI_Popup_Input(title, subtitle, picture, placeholder)
{
 var promise = new Promise(async(resolve, reject) =>
 {
  var button = 
  { 
   text   : UI_Language_String("core/popups", "button ok"), 
   onclick: 
   async function(popup)
   {
	var input = UI_Element_Find(popup, "input");
    var value = input.value;
	
    await UI_Popup_Close(popup);
	
	resolve(value);
   }
  };
	
  await UI_Popup_Create(
  {
   title:    title, 
   subtitle: subtitle, 
   picture:  picture,
   content:  "input",
   placeholder,
   onescape: 
   function(popup)
   {
	resolve(false);
   }
  },

  [
   button 
  ]);
  
 });
 
 return promise;
}



async function UI_Popup_Select(title, subtitle, picture, options, selected)
{
 var promise = new Promise(async(resolve, reject) =>
 {
  var button = 
  { 
   text   : UI_Language_String("core/popups", "button ok"), 
   onclick: 
   async function(popup)
   {
	var select = UI_Element_Find(popup, "select");
	var option = Document_Select_SelectedOption(select);
    var value  = option.value;
	
    await UI_Popup_Close(popup);
	
	resolve(value);
   }
  };
	
  var popup = await UI_Popup_Create(
  {
   title:    title, 
   subtitle: subtitle, 
   picture:  picture,
   content:  "select",
   onescape: 
   function(popup)
   {
	resolve(false);
   }
  },

  [
   button 
  ]);
  
  var select = UI_Element_Find(popup, "select");
  for(var option of options)
  {
   var text  = option["text"];
   var value = option["value"];

   Document_Select_AddOption(select, text, value);
  }
  
  if(selected) select.value = selected;
 });
 
 return promise;
}



async function UI_Popup_Confirm(title, content, picture)
{
 var promise = new Promise((resolve, reject) =>
 {
  var button_yes = 
  { 
   text   : UI_Language_String("core/popups", "button yes"), 
   onclick: 
   function(popup)
   {
    UI_Popup_Close(popup);
	
	resolve(true);
   }
  };
  
  var button_no = 
  { 
   text   : UI_Language_String("core/popups", "button no"), 
   onclick: 
   function(popup)
   {
    UI_Popup_Close(popup);
	
	resolve(false);
   }
  };

  UI_Popup_Create(
  {
   title, 
   content, 
   subtitle: "",
   picture,
   onescape: 
   function(popup)
   {
	resolve(false);
   }
  },

  [
   button_yes,
   button_no   
  ]);
  
 });
 
 return promise;
}





async function UI_Popup_Code(title, content, picture, code)
{
 var promise = new Promise((resolve, reject) =>
 {
  var button_confirm = 
  { 
   text   : UI_Language_String("core/popups", "button confirm"), 
   onclick: 
   async function(popup)
   {
    var input = UI_Element_Find(popup, "code");
	if(input.value == code)
	{
	 UI_Popup_Close(popup);
     resolve(true);
	}
	else
    {  
     await Document_Element_Animate(input, "headShake 0.75s linear 1");
     input.value = "";
	}
   }
  };
  
  UI_Popup_Create(
  {
   title, 
   content, 
   subtitle: "",
   picture,
   onescape: 
   function(popup)
   {
	resolve(false);
   }
  },

  [
   button_confirm,
  ],
  
  "core/popup-standard-code");
  
 });
 
 return promise;
}





async function UI_Popup_Intermission(title, content, picture, timer)
{
 var promise = new Promise(async (resolve, reject) =>
 {
  var button_ok = 
  { 
   text     : UI_Language_String("core/popups", "button ok"), 
   
   template : "button-large-plain",
   
   onclick  : 
   function(popup)
   {
    UI_Popup_Close(popup);
	
	resolve(true);
   }
  };
 

  if(!picture && typeof content == "object") var template = "content"; else var template = "standard";
  
  var popup   = await UI_Popup_Create({title, content, picture}, [button_ok], "core/popup-intermission-" + template, {open:false, escape:false});
  
  
  var buttons = UI_Element_Find(popup, "buttons");
  if(timer)
  {  
   buttons.style.visibility = "hidden";
   
   setTimeout(
   function()
   {
	buttons.style.visibility = "visible";
	
	Document_Element_Animate(buttons, "bounceIn 1s 1");
	
	
   }, Math.round(timer * 1000));
  }
  
  await UI_Popup_Show(popup);
 });
 
 return promise;
}




async function UI_Popup_Alert(title, content, picture)
{
 var promise = new Promise((resolve, reject) =>
 {
  var button_ok = 
  { 
   text   : UI_Language_String("core/popups", "button ok"), 
   onclick: 
   function(popup)
   {
    UI_Popup_Close(popup);
	
	resolve(true);
   }
  };
  
 
  UI_Popup_Create(
  {
   title, 
   content, 
   subtitle: "",
   picture,
   onescape: 
   function(popup)
   {
	resolve(false);
   }
  },

  [
   button_ok,
  ]);
  
 });
 
 return promise;
}



async function UI_Popup_SelectData(title, data = [], fields = {}, language)
{
 var promise = new Promise((resolve, reject) =>
 { 
  var content = UI_Element_Create("core/popup-select-box");
  var table   = UI_Table_Data(data, fields, language)
  content.appendChild(table);
 
  var onclick = 
  function(popup)
  {
   UI_Popup_Close(popup);
   
   var row = Document_Element_GetObject(table, "selected-row");
   if(row)
   {
	var item = Document_Element_GetObject(row, "item");
   }
   else
   {
	var item = false;
   }
   
   resolve(item);
  }

  var onescape =
  function()
  {
   resolve(false);
  }
 
  var button_caption = UI_Language_String("core/popups", "button select");
  
  UI_Popup_Create({title, content}, [{text:button_caption, onclick}], "flexi", {escape:true, open:true, onescape});  
 });
 
 return promise;
}






// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                         M E N U S                                              // 
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

function UI_Menu_Create(uid, items = {}, events = {}, options = {})
{
 var menu = UI_Element_Create("core/menu-plain", {uid:uid});

 Document_Element_SetObject(menu, "items",  items);
 Document_Element_SetObject(menu, "events", events);
 
 return menu;
}





function UI_Menu_Build(menu)
{
 menu.innerHTML = "";
 
 var items = Document_Element_GetObject(menu, "items");
 
 var uids = Object.keys(items);
 for(var uid of uids)
 {
  var item = items[uid];
 
  UI_Menu_AddItem(menu, uid, item["icon"], item["text"], item["state"], item["func"], item["submenu"], item["tag"]);
 }
}




function UI_Menu_GetItems(menu)
{
 return Document_Element_GetObject(menu, "items");
}




function UI_Menu_Assign(element, menu, options)
{  
 Document_Element_SetObject(element, "menu", menu);
 
 element.oncontextmenu =
 function(event)
 { 
  event.preventDefault();
  
  var x = event.pageX;
  var y = event.pageY;
  
  menu["source-parent"] = event.currentTarget;
  menu["source-target"] = event.target;
  
  UI_Menu_Show(menu, x, y, options, event);
 }
}




function UI_Menu_GetItem(menu, id)
{
 var items = Document_Element_GetObject(menu, "items");
 
 return items[id];
}





function UI_Menu_ListItems(menu, id)
{
 var items = Document_Element_GetObject(menu, "items");
 
 return items;
}





function UI_Menu_AddItem(menu, uid, icon, text, state, func, submenu, tag)
{
 
 switch(state)
 {
  case "enabled": 
   var template = "enabled";
   var visible  = true;   
   var enabled  = true;
  break;
  
  case "disabled":
   var template = "disabled";
   var visible  = true;   
   var enabled  = false;
  break;
  
  case "hidden":
	var template = "enabled";
	var visible  = false;   
	var enabled  = false;
  break;
  
  default:
	var visible = true;
  break;
 }
 
 
 // NO TEXT = SPACER
 if(!text) 
 {
  var template = "spacer";
  var enabled  = false;
 }
 
 
 
 // CREATE ITEM
 var element = UI_Element_Create("core/menu-item-" + template, {uid:uid, icon:icon, text:text}); 
 if(!visible) element.style.display = "none";

 // ICON TRICK: IF ICON LENGTH = 1 THEN IT'S AN EXPLICIT ICON, NOT A FONTAWESOME CODE. ADJUST ACCORDINGLY
 if(icon && String_Unicode_Length(icon) == 1)
 {
  var component = UI_Element_Find(element, "icon");
  Document_CSS_PurgeClasses(component, "fa-");
  component.innerHTML = icon;
 }
 
 // ICON TRICK: IF ICON NAME CONTAINS ".svg" THEN IT'S A SVG GLYPH
 if(icon && icon.includes(".svg"))
 {
  var component = UI_Element_Find(element, "icon");
  Document_CSS_PurgeClasses(component, "fa-");
  component.innerHTML = "<img src = '" + icon + "' style = 'width:100%; height:100%'></img>";
 }
 
 
 // LINK MENU
 Document_Element_SetObject(element, "menu", menu);


 // ATTACH TAG
 Document_Element_SetObject(element, "tag", tag);


 // ATTACH FUNCTION
 if(func)
 {
  Document_Element_SetObject(element, "func", func);
 }
 
 

 // IF ENABLED AND VISIBLE, MANAGE ITEM'S ONCLICK
 if(enabled && visible)
 {
  // ATTACH SUBMENU IF PRESENT
  if(submenu)
  {
   // SHOW SUBMENU SELECTOR
   UI_Element_Find(element, "submenu").style.visibility = "visible";
   
   // ATTACH SUBMENU TO ELEMENT
   Document_Element_SetObject(element, "submenu", submenu);
  }
   
  // ON CLICK
  element.onclick = UI_Menu_OnClick;
 }
 
 
 // ATTACH TO MENU
 menu.appendChild(element);
}




function UI_Menu_Show(menu, x, y, options = {}, event)
{
 // IF THIS IS A TOP LEVEL MENU, CLOSE ALL OTHERS FIRST
 if(!Document_Element_GetObject(menu, "parent-menu")) UI_Menu_CloseAll();
 
 
 // AN EMPTY MENU DOESN'T EVEN GET SHOWN
 var items = Document_Element_GetObject(menu, "items");
 if(Object.keys(items).length < 1) return;
 	
	
 // ON SHOW
 var events  = Document_Element_GetObject(menu, "events");
 if(events["onshow"]) events["onshow"](menu, event);
	
	
 // RENDER AND DISPLAY
 UI_Menu_Build(menu);
 
 
 // INITIALLY INVISIBLE
 menu.style.visibility = "hidden";
 document.body.appendChild(menu);
 
 
 // CALCULATE POSITION AND SIZE
 var style  = window.getComputedStyle(menu); 
 var width  = Math.floor(parseFloat(style.width));
 var height = Math.floor(parseFloat(style.height)); 
 

 // TRY DIFFERENT OPENING DIRECTIONS, ATTEMPTING TO AVOID CLIPPING
 var forcedirection = options["direction"];

 if(forcedirection) var directions = [forcedirection]; else var directions = ["top right", "bottom right", "top left", "bottom left"];
 
 for(var direction of directions)
 {
  Document_Element_SetData(menu, "showdirection", direction);
 
  switch(direction)
  {
   case "top":
	 menu.style.left = x;
	 menu.style.top  = y - height / 2;
   break;
   
   case "top right":
	 menu.style.left = x;
	 menu.style.top  = y - height;
   break;
  
   case "bottom right":
	menu.style.left = x;
	menu.style.top  = y;
   break;
   
   case "bottom":
	menu.style.left = x - width / 2;
	menu.style.top  = y;
   break;
  
   case "bottom left":
	 menu.style.left = x - width;
 	 menu.style.top  = y;
   break;
  
   case "top left":
	 menu.style.left = x - width;
	 menu.style.top  = y - height;
   break;
  }
  
  if(forcedirection || Document_Element_IsVisible(menu)) break;
 }

 
 // ACTUALLY SHOW
 menu.style.visibility = "visible";
 Document_Element_Animate(menu,  "fadeIn 0.125s linear 1");
 
 menu["status"] = "open";
 
 UI_Menu_GlobalCloser();
}




function UI_Menu_Close(menu, options = [])
{
 // REMOVE MENU FROM SCREEN
 if(menu.parentElement) menu.parentElement.removeChild(menu);
 menu["status"] = "closed";
    
 
 // IF MENU WAS OPENED BY ANOTHER MENU, MUST CLOSE THAT MENU AS WELL UNLESS OPTIONS DICTATE DIFFERENTLYY
 var parent = Document_Element_GetObject(menu, "parent-menu");
 if(parent && !options.includes("noparent")) 
 {
  Document_Element_SetObject(menu, "parent-menu", undefined);
  
  UI_Menu_Close(parent); 
 }
 
 
 // IF MENU HAS A SUBMENU OPENED, CLOSE IT UNLESS OPTIONS DICTATE DIFFERENTLY
 var submenu = Document_Element_GetObject(menu, "submenu");
 if(submenu && !options.includes("nosub"))
 {
  Document_Element_SetObject(menu, "submenu", undefined);
  
  UI_Menu_Close(submenu);
 }
}




function UI_Menu_CloseAll()
{
 var menus = Document_Element_FindChildren(document.body, "uielement", "menu");
 
 for(var menu of menus) if(menu && menu.parentElement) menu.parentElement.removeChild(menu);
}




function UI_Menu_OnClick(event)
{
 event.stopPropagation();
 var item = event.currentTarget;
 
 var menu    = Document_Element_FindParent(item, "uielement", "menu");
 var submenu = Document_Element_GetObject(item, "submenu");
 
 // IF THE ITEM HAS A SUBMENU, DISPLAY IT
 if(submenu)
 {
  // SEE IF THE CLICKED MENU ALREADY HAS AN OPENED SUBMENU
  var current = Document_Element_GetObject(menu, "submenu");
  if(current)
  {  
   UI_Menu_Close(current, ["noparent"]);
  }
  
	 
  // DETERMINE ORIGIN BASED ON ITEM POSITION	 
  var rect = UI_Element_Find(item, "submenu").getBoundingClientRect();  //console.log(rect);
  var x    = rect.right;
  var y    = rect.top;
  
  // LINK PARENT TO CHILD
  Document_Element_SetObject(menu,    "submenu",     submenu);
  Document_Element_SetObject(submenu, "parent-menu", menu);
  
  // DETERMINE SUBMENU DIRECTION. TOP OR BOTTOM MUST BE PRESERVED, BUT IT SHOULD ALWAYS SHOW TO THE RIGHT
  var direction = Document_Element_GetData(menu, "showdirection");
  direction = direction.replace("left",   "right");
  direction = direction.replace("middle", "right");
  
  UI_Menu_Show(submenu, x, y, {direction:direction}, event);
 }
 else
 // CALL FUNCTION AND CLOSE MENU
 {  
  if(menu) UI_Menu_Close(menu); 
 
  var func = Document_Element_GetObject(item, "func");
  if(func) func(item); 
 }	 

}





function UI_Menu_GlobalCloser()
{
 if(Document_Element_GetObject(document, "menu-globalcloser")) return;
 
 var handler = document.addEventListener("click", 
 function()
 {
  Document_Element_SetObject(document, "menu-globalcloser", undefined);
  UI_Menu_CloseAll();
 }, 
 {capture:false, once:true});
 
 Document_Element_SetObject(document, "menu-globalcloser", handler);
}


function UI_Menu_FullScreenCloser(element)
{
   var handler = document.addEventListener("click", 
      function()
      {
         var menus = Document_Element_FindChildren(element, "uielement", "menu");
      
         for(var menu of menus) if(menu && menu.parentElement) menu.parentElement.removeChild(menu);
      });
}



function UI_Menu_FromDatapage(id, page, category_field, categories = {}, handler = false)
{
 // BUILD CATALOG OF CATEGORIES AND THEIR ITEMS
 var catalog = {};
 for(var id in page)
 {
  var item = page[id];
  
  var category = item[category_field];
  if(!catalog[category]) catalog[category] = {};
  
  catalog[category][id] = item;
 }
 
 // PARSE ITEMS
 var items = {};
 for(var category in catalog)
 {
  // MAIN ITEMS - REPRESENTING CATEGORIES
  var item      = {};
  
  item["text"]  = UI_Language_Object(categories[category]);
  item["state"] = "enabled";
  item["icon"]  = categories[category]["icon"] || false;
   
  // SUBMENU FOR THIS MAIN (CATEGORY) ITEM
  var sub_items = {}; 
  for(var id in catalog[category])
  {
   var sub_item = {};
  
   sub_item["text"]  = UI_Language_Object(catalog[category][id]);
   sub_item["state"] = "enabled";
   sub_item["func"]  = handler;
  
   sub_items[id] = sub_item;
  }
  
  // CREATE SUBMENU
  item["submenu"] = UI_Menu_Create(id, sub_items, 
  {
   onshow: Editor_Presentation_MenuStyles
  });
  
  // MAIN ITEM MENU
  items[category] = item;
 }
 
 // FINALLY CREATE THE MAIN MENU
 var menu  = UI_Menu_Create("element-style", items);
 
 return menu;
}




function UI_Menu_FromObject(id, obj, category_field = false, handler = false)
{ 
 var items = {};
 
 // IF CATEGORY FIELD SET, COLLECT KEYS IN A STRUCTURED MANNER
 if(category_field)
 {
  // FIRST CATALOGUE CATEGORIES
  var catalog = {};
  for(var key in obj)
  {
   var category = obj[key][category_field];
   if(category) Safe_Push(catalog, category, key);
  }
  
  
  // NOT PUT KEYS IN A SEQUENCES BY CATEGORY, AND WITH SEPARATORS BETWEEN CATEGORIES
  var keys       = [];
  var categories = Object.keys(catalog);
  for(var i = 0; i < categories.length; i++) 
  {
   // ADD ALL KEYS IN THIS CATEGORY
   for(var key of catalog[categories[i]]) keys.push(key);
   
   // IF NOT LAST CATEGORY IN THE CATALOG, ADD A SEPARATOR ITEM
   if(i < categories.length - 1)
   {
	// THIS REPRESENTS A SEPARATOR
	keys.push(false);
   }	   
  }
 }
 else
 // NO CATEGORY FIELD SET, SIMPLY COLLECT OBJECT'S KEYS
 {
  var keys = Object.keys(obj);
 }
 
 
 // PARSE OBJECT AND CREATE ITEMS
 var sc = 0;
 for(var key of keys)
 {
  var item = {};
  
  if(!key)
  {
   // SEPARATOR
   var id = "separator " + sc; 
   sc     = sc + 1;
  }
  else
  {
   var id        = key;
   item["text"]  = UI_Language_Object(obj[key]);
   item["icon"]  = obj[key]["icon"] || false;
   item["state"] = "enabled";
   item["func"]  = handler;
  }
  
  items[id] = item;
 }
 
 
 // CREATE THE MENU
 var menu  = UI_Menu_Create(id, items);
 return menu;
}






// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                        T A B L E S                                             // 
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

function UI_Table(style = "standard", config = {})
{
 var table = document.createElement("table");
 Document_CSS_SetClass(table, "table-" + style);
 
 Document_Element_SetData(table,   "style",  style);
 Document_Element_SetObject(table, "config", config);

 var cells = [];
 Document_Element_SetObject(table, "cells", cells);
 
 if(config["fixed"])
 {
  table.style.height = "auto";
 }
 
 if(config["seamless"])
 {
  table.style.borderCollapse = "collapse";
 }
 
 return table;
}



function UI_Table_Row(table, config = {}, onclick)
{
 var style = Document_Element_GetData(table, "style");
 
 var row   = document.createElement("tr");
 Document_CSS_SetClass(row, "table-" + style + "-row");
 Document_Element_SetData(row,   "style", style);
 Document_Element_SetObject(row, "table", table);
 Document_Element_SetObject(row, "config", config);
 Document_Element_SetObject(row, "onclick", onclick);
 
 if(config["fixed"])
 {
  row.style.position = "sticky";
  row.style.top      = "0";
 }
 
 
 if(config["selectable"])
 { 
  Document_CSS_SetClass(row, "effect-highlight-accented");
  
  row.onclick = 
  function(event)
  {
   var row   = event.currentTarget;
   var table = row.parentElement;
   
   Document_Conditional_Class(table, "style-highlight-accented", row);
   Document_Element_SetObject(table, "selected-row", row);
   
   var onclick = Document_Element_GetObject(row, "onclick");
   if(onclick) onclick(event);
  }
 }
 
 table.appendChild(row);
 return row;
}



function UI_Table_Cell(row, config = {type:"cell"})
{
 var style = Document_Element_GetData(row, "style");
 var table = Document_Element_GetObject(row, "table");
 var cells = Document_Element_GetObject(table, "cells");
 
 var type    = config["type"] || "cell";
 var onclick = config["onclick"];
 
 var cell  = document.createElement("td");
 
 var row_config = Document_Element_GetObject(row, "config");
 if(row_config["selectable"])
 {
  cell.style.backgroundColor = "inherit";
  cell.style.color           = "inherit";
 }
 
 Document_CSS_SetClass(cell, "table-" + style + "-" + type);
 Document_Element_SetData(cell, "style", style);
 
 if(onclick)
 {
  Document_CSS_SetClass(cell, "style-clickable");
  cell.onclick = onclick;
 }
 
 cells.push(cell);
 
 row.appendChild(cell);
 return cell;
}





function UI_Table_Data(data = [], fields = {}, language, events = {}, actions = false)
{
 var table = UI_Table("standard", {seamless:true, fixed:true});
 
 // HEADER
 var row = UI_Table_Row(table, {fixed:true});
 for(var field in fields)
 {
  var cell             = UI_Table_Cell(row, {type:"header"});   
  cell.style.textAlign = "left";
  
  cell.innerHTML = UI_Language_String(language, field, "");
  
  if(events[field])
  {
   cell.onclick = events[field];
   
   Document_CSS_SetClass(cell, "style-clickable");
   Document_Element_SetData(cell, "field", field);
  }
 }
 
 // IF AN ACTION SET IS DEFINED, ADD AN EMPTY CELL TO THE HEADER
 if(actions)
 {
  var cell  = UI_Table_Cell(row, {type:"header"});  
 }
 
 
 
 // ROWS
 for(var item of data)
 {
  var row = UI_Table_Row(table, {selectable:true}, events["row"]);
  Document_Element_SetObject(row, "item", item);
   
  var i = 0; 
  for(var field in fields)
  {
   var cell             = UI_Table_Cell(row);
   cell.style.textAlign = "left";
    
   // HOW TO DEAL WITH THE CONTENT OF THIS FIELD?
   switch(typeof fields[field])
   {
    // IF FIELD EQUIPPED WITH A FUNCTION: CALL THE FUNCTION TO DETERMINE CONTENT
	case "function": 
		var value = fields[field](item[field]);
    break;
   
    // IF FIELD EQUIPPED WITH AN OBJECT: USE IT AS A DATAPAGE TO DECODE THE VALUE
    case "object":
		var obj   = fields[field][item[field]];
		var value = UI_Language_Object(obj, item[field]);
    break;

    // DIRECT CONTENT
    default:	
		var value = item[field]; 
	break;
   }
   
   cell.innerHTML = value || "";
   i++;
  }
  
  // IF AN ACTION SET IS DEFINED, ADD A CELL WITH ACTION ICONS
  if(actions)
  {
   var cell  = UI_Table_Cell(row, {type:"actions"});  
   for(var id in actions)
   {
	var action  = actions[id];
   
	var element = document.createElement("li");
	Document_CSS_SetClass(element, "style-clickable");
	Document_CSS_SetClass(element, "fa");
	Document_CSS_SetClass(element, "fa-" + action["icon"]);
	
	Document_Element_SetObject(element, "action", action);
	Document_Element_SetObject(element, "item",   item);
	Document_Element_SetObject(element, "row",    row);
	
	element.onclick = 
	function(event)
	{	 
	 var element = event.currentTarget;
	 var action  = Document_Element_GetObject(element, "action");
	 var item    = Document_Element_GetObject(element, "item");
	 var row     = Document_Element_GetObject(element, "row");
	 
     if(action["onclick"]) 
	 {
	  event.stopPropagation();
	
	  action["onclick"](item, row);
	 }
    }
	
	cell.appendChild(element);
   }
  }
 }
 
 return table;
}	






// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                     H E A D E R S                                              // 
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

function UI_Header(id, items = {}, options = {})
{
 var template = options["template"] || "standard";
 
 var header   = UI_Element_Create("core/header-" + template);
 var labels   = UI_Element_Find(header, "labels");
 var selected = false;
 
 Document_Element_SetData(header,   "uid",     id);
 Document_Element_SetObject(header, "options", options);
 
 if(Object.keys(items).length > 1) Document_Element_SetData(header, "multi", true); 
 
 for(var id in items)
 {
  var item               = items[id];
  item["id"]             = id;
  
  var label              = document.createElement("div");
  label.innerHTML        = item["text"];
  if(!selected) selected = label;        // AUTOSELECT FIRST LABEL
  
  if(item["color"])
  {
   label.style.color = item["color"];
  }
  
  Document_Element_SetData(label,   "uid", id);
  Document_Element_SetObject(label, "item",   item);
  Document_Element_SetObject(label, "header", header); 
  Document_CSS_SetClass(label,      "style-clickable");
  
  // WHEN A HEADER LABEL (LEFT SIDE) IS CLICKED, LOAD ITS ICONS AND CALL THE ASSOCIATED FUNCTION IF ANY 
  label.onclick =
  function(event)
  { 
   var element = event.currentTarget;
   var item    = Document_Element_GetObject(element, "item");
   var header  = Document_Element_GetObject(element, "header");
   
   Document_Element_SetObject(header, "selected", element);
   
   UI_Header_Update(header);
   
   if(item["onclick"]) item["onclick"](item);
  }
  
  if(item["disabled"]) Document_Element_Disable(label, "style-disabled");
  labels.appendChild(label);
 }
 
 
 if(options["selectfirst"])
 {
  Document_Element_SetObject(header, "selected", selected);
  UI_Header_Update(header);
 
  var item = Document_Element_GetObject(selected, "item");
  if(item["onclick"]) item["onclick"]();
 }
 
 return header;
}





function UI_Header_Update(header)
{
 var options  = Document_Element_GetObject(header,   "options");
 var selected = Document_Element_GetObject(header,   "selected");
 var item     = Document_Element_GetObject(selected, "item");
 
 if(!item) return;
 
 // IF THIS HEADER HAS MULTIPLE LABELS, UNDERLINE THE CURRENTLY SELECTED LABEL, DE-UNDERLINE ALL OTHERS
 if(Document_Element_GetData(header, "multi"))
 { 
  var labels   = UI_Element_Find(header, "labels");
  
  // UNDERLINING
  Document_Conditional_Class(labels, "style-underlined", selected); 
  
  // EXTRA CLASS
  if(options["css"])
  {
   Document_Conditional_Class(labels, options["css"], selected); 
  }
 }
   
 // DISPLAY ICONS FOR THIS LABEL
 var glyphs       = UI_Element_Find(header, "icons");
 glyphs.innerHTML = "";
   
 var icons = item["icons"] || [];
 for(var icon of icons)
 {
  var glyph = document.createElement("li");
  Document_CSS_SetClass(glyph, "fa-solid");
  Document_CSS_SetClass(glyph, "fa-" + icon["icon"]);
	
  var func = icon["onclick"];
  if(func)
  {
   Document_CSS_SetClass(glyph, "style-clickable");
   glyph.onclick = func;
  }
   
  glyphs.appendChild(glyph);
 }
 
}




function UI_Header_Set(header, tab, autoclick)
{
 var selected = UI_Element_Find(header, tab);
 Document_Element_SetObject(header, "selected", selected);
 
 UI_Header_Update(header);
 
 if(selected && autoclick) 
 {
  var item = Document_Element_GetObject(selected, "item");
  if(item["onclick"]) item["onclick"](item);
 }
}




function UI_Header_Disable(header, tab)
{
 var selected = UI_Element_Find(header, tab);
 
 Document_CSS_SetClass(selected, "style-disabled");
 selected.style.pointerEvents = "none";
}



function UI_Header_Enable(header, tab)
{
 var selected = UI_Element_Find(header, tab);
 
 Document_CSS_UnsetClass(selected, "style-disabled");
 selected.style.pointerEvents = "";
}







// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          L I S T S                                             // 
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

function UI_List_Items(items, selectedstyle, onselect, options = {style:"vertical", overflow:true}, itemcreator, sectioncreator)
{
 var style = options["style"] || "vertical";
 
 var itemlist = UI_Element_Create("core/itemlist-" + style);
 Document_Element_SetObject(itemlist, "selectedstyle", selectedstyle);
 Document_Element_SetObject(itemlist, "onselect", onselect);
 
 //if(options["overflow"]) itemlist.style.overflow = "";
 
 var select =
 function()
 {
  if(!options["selected"]) return;
  
  for(var element of itemlist.children)
  {
   var item = Document_Element_GetObject(element, "itemlist-item");
   if(item == options["selected"])
   {
	Document_CSS_SetClass(element, options["highlight"] || "style-outlined-alert"); 
	Document_Element_Animate(element, "flash 1.5s") ;
	
	element.scrollIntoView({behavior: "smooth", block: "center"});
   }	   
  }
 }
 
 if(options["sections"])
 {
  var sections = true;
  var catalog  = Array_Catalog_ByField(items, options["sections"]);
 }
 else
 {
  var sections = false; 
  var catalog  = {items};
 }
 
 for(var key in catalog)
 {
  // SECTION HEADER
  if(sections)
  {
   var element = sectioncreator(key, item);
   itemlist.appendChild(element);
  }
	 
  // ITEMS
  for(var item of catalog[key])
  {
   var element = itemcreator(item);
   Document_Element_SetObject(element, "itemlist-item", item);
   
   // IF ITEMS WILL BE ANIMATED, START THEM AS INVISIBLE
   if(options["animate"]) element.style.visibility = "hidden";
   
   element.onclick = 
   function(event)
   {
    var element       = event.currentTarget;
    var list          = element.parentElement;
 
    var selectedstyle = Document_Element_GetObject(list, "selectedstyle");
    var onselect      = Document_Element_GetObject(list, "onselect");

    Document_Conditional_Class(list, selectedstyle, element);    
    Document_Element_SetObject(list, "selecteditem", element);
 
    if(onselect) onselect(element);
   } 
  
   itemlist.appendChild(element);
  }
 }
 
 
 // ANIMATE LIST ITEMS?
 if(options["animate"])
 {  
  Document_Element_AnimateChildren(itemlist, "zoomIn 0.250s 1 ease-out", 
  {
   delay:    250, 
   interval: 125, 
  
   onstart:
   function(element) 
   {
    element.style.visibility = "visible";
   },
  
   onend:
   function(element)
   {
   }
  }).then(
  function()
  {
   // AFTER ALL HAS BEEN ANIMATED, CHECK SELECTED ITEM
   select();
  });
 }
 else  
 { 
  // CHECK SELECTED ITEM
  select();
 }
 
 return itemlist;
}






function UI_List_Files(files, onclick, options = {style:"standard"})
{
 style        = Safe_Get(options, "style", "standard");
 var filelist = UI_Element_Create("core/filelist-" + style);
 
 for(var file of files)
 {
  if(typeof file == "object")
  {
   var name = file["name"];
   var f    = file["onclick"] || onclick;
   var icon = file["icon"];
  }
  
  else	 
  
  {
   // NAME
   var name = Path_RemoveExtension(Path_Filename(file));
   var f    = onclick;
   
   var type = Media_Info_Type(file);
   switch(type)
   {
    case "image":
 	 var icon = "file-image";
    break;
   
    case "audio":
	 var icon = "file-audio";
    break;
   
    case "video":
	 var icon = "file-video";
    break;
   
    default:
	 var ext  = Path_Extension(file).toLowerCase();
     switch(ext)
	 {
      case "doc":
	  case "docx":
	  case "odt":
	 	var icon = "file-word";
	  break;
	 
	  case "xls":
	  case "xlsx":
	  case "odf":
		var icon = "file-excel";
	  break;
	 
	  case "pdf":
	 	var icon = "file-pdf";
	  break;
	 
	  default:
	 	var icon = "file";
	  break;
	}
    break;
   }
  }
 
  
  // CREATE ELEMENT
  var element = UI_Element_Create("core/filelist-" + style + "-item", {name, icon});
  Document_Element_SetData(element, "file", file);
  
  if(f) 
  {
   Document_CSS_SetClass(element, "style-clickable");
   Document_CSS_SetClass(element, "effect-highlight-accented");

   switch(f)
   {   
    case "download":
		element.onclick =
		function(event)
		{
	     var element = event.currentTarget;
		 var url  = Document_Element_GetData(element, "file");
		 
		 //Document_Element_Animate(item, "bounce 1s ease-in-out");
		 Request_Download(url);
		}
    break;	   
	
	default:
		 element.onclick = f;
	break;
   }
   
  }
  
  filelist.appendChild(element);
 }
 
 return filelist;
}



function UI_List_Checks(items, template = "plain", onchange)
{
 var box = UI_Element_Create("core/checklist-box-" + template);
 Document_Element_SetObject(box, "items", items);
 
 for(var item of items)
 {  
  var element   = UI_Element_Create("core/checklist-item-" + template, item);
  var check     = UI_Element_Find(element, "check");
  
  check.checked = item["value"];
  Document_Element_SetObject(check, "item", item);
  
  check.onclick = 
  function(event)
  {
   var element   = event.currentTarget;
   var item      = Document_Element_GetObject(element, "item", {});
   
   var list      = Document_Element_FindParent(element, "control", "checklist");
   var items     = Document_Element_GetObject(list, "items", []);
   
   item["value"] = element.checked;

   if(onchange) onchange(item, items);   
  }
  
  box.appendChild(element);
 }
 
 return box;
}





// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                         G A U G E S                                            // 
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function UI_Gauge_ProgressCircle(element, options = {width:"100%", height:"100%", zIndex:100}, color)
{
 var gauge              = UI_Element_Create("core/gauge-circle");
 element.style.position = "relative";
 element.appendChild(gauge);
 
 var canvas  = UI_Element_Find(gauge, "canvas");
 
 Object.assign(canvas.style, options);
 
 var context = canvas.getContext("2d"); 
 var radius  = 0.75;
 
 
 var plugins = 
 {
  legend: 
  {
   display: false
  },
   
  tooltip: 
  {
   enabled: false
  },
   
  datalabels: 
  {
   formatter: 
   function (value, context) 
   {
    return "";
   } 
  }
 }


 var options = 
 {
  plugins:    plugins,
  cutout:     (100 * radius) + "%",
  responsive: false,
  
  animation:
  {
   duration:0
  }
 }


 var data = 
 {
  datasets: 
  [
   {
    data:            [0, 1],
    backgroundColor: [color, "transparent"],
    borderWidth:     0
  }
  ]
 }


 var chart = 
 new Chart(context, 
 {
  type:       "doughnut",
 
  cutout:     100 * radius,
  responsive: false,
  data:       data, 
  options:    options

 });
 
 
 Document_Element_SetData(gauge, "type", "progress-circle");
 Document_Element_SetObject(gauge, "chart", chart);
 return gauge; 
}






function UI_Gauge_Update(gauge, progress)
{
 var type  = Document_Element_GetData(gauge, "type");
 var chart = Document_Element_GetObject(gauge, "chart");
 
 chart.data.datasets[0].data[0] = progress;
 chart.data.datasets[0].data[1] = 1 - progress;
 
 chart.update();
}




async function UI_Gauge_TimeUpdate(gauge, time)
{
 var promise = new Promise((resolve, reject) =>
 {
  var start = Date.now();
 
  var update = setInterval(
  function()
  {
   var delta = (Date.now() - start) / time;
   if(delta > 1) delta = 1;
  
   UI_Gauge_Update(gauge, delta);
  
   if(delta == 1) 
   {
	clearInterval(update);
    resolve();
   }
  },
  1000 / 60);  // 60 TIMES PER SECOND 
 });
 
 return promise;
}









// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                         C H A R T S                                            // 
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function UI_Chart_LabelFormatter(context)
{
 var index = context["dataIndex"];
 var data  = Safe_Get(context, ["chart", "sourcedata"]); 
	
 if(data) 
 {
  var label = Safe_Get(data, [index, "label"]); 
 }
 else
 {
  var label = "";
 }
	
 return label;
}



function UI_Chart_DataDestructure(data)
{
 var values = [];
 var colors = [];
 
 for(var item of data)
 {
  values.push(item["value"]);
  colors.push(item["color"]);
 }
 
 return {values, colors};
}




function UI_Chart_UpdateValues(element, values)
{  
 var chart = Document_Element_GetObject(element, "chart");
 
 chart.data.datasets[0].data = values;
 chart.update();
}




function UI_Chart_UpdateData(element, data)
{  
 var chart           = Document_Element_GetObject(element, "chart");
 chart["sourcedata"] = data;
 
 
 var destructured = UI_Chart_DataDestructure(data);
 
 chart.data.datasets[0].data            = destructured["values"];
 chart.data.datasets[0].backgroundColor = destructured["colors"];
 chart.update();
}





function UI_Chart_Sunburst(data, radius = 0.5, onclick, config = {width:"100%", height:"100%", zIndex:100})
{
 // CREATE ELEMENT
 var element            = UI_Element_Create("core/chart-doughnut");
 element.style.position = "relative";

  
 // SETUP CANVAS
 var canvas  = UI_Element_Find(element, "canvas");
 var context = canvas.getContext("2d");  
 Object.assign(canvas.style, config);
 
 
 // SETUP CHART DEFAULTS
 var plugins = 
 {
  legend: 
  {
   display: false
  },
   
  tooltip: 
  {
   enabled: true,
   
   callbacks: 
   {
    label:UI_Chart_LabelFormatter 
   }
  },
   
  datalabels:
  {
   anchor: "center", //start, center, end
    
   rotation: function(ctx) 
   {
    const valuesBefore = ctx.dataset.data.slice(0, ctx.dataIndex).reduce((a, b) => a + b, 0);
    const sum = ctx.dataset.data.reduce((a, b) => a + b, 0);
    const rotation = ((valuesBefore + ctx.dataset.data[ctx.dataIndex] /2) /sum *360);
    return rotation < 180 ? rotation-90 : rotation+90;
   },
      
   formatter: function (value, context) 
   {
	var index = context["dataIndex"];
    var label = Safe_Get(context, ["chart", "sourcedata", index, "label"], "");
	
	// LABEL CLIPPING?
	if(config["maxlength"])
	{
     if(label.length > config["maxlength"]) label = label.substr(0, config["maxlength"]) + "…";
	}
	
	return label;
   },
  }
 }


 // CUSTOM FONT?
 if(config["font"])
 {
  plugins["datalabels"]["font"] = config["font"];
 }


 // 
 var options = 
 {
  plugins:    plugins,
  cutout:     (100 * radius) + "%",
  responsive: true,
 }


 // DISSECT DATA INTO COMPONENTS
 var destructured = UI_Chart_DataDestructure(data);
 var chartdata    = 
 {
  datasets: 
  [
   {
    data:            destructured["values"],
    backgroundColor: destructured["colors"],
    borderWidth:     1
   }
  ]
 }


 var chart = 
 new Chart(context, 
 {
  type:       "doughnut",
  cutout:     100 * radius,
  responsive: false,
  data:       chartdata, 
  options
 });
 
 
 
 canvas.onclick =
 function()
 {  
  var elements = chart.getElementsAtEventForMode(event, 'nearest', { intersect: true }, true); 
  var element  = elements[0];
  //var label    = datasets[element.datasetIndex]["labels"][element.index];
  var index     = element["index"];
  
  //chart.data.datasets[0].backgroundColor[index] = "red";
  //chart.update();
  
  if(onclick) onclick(data[index], element);
 }
 
 
 chart["sourcedata"] = data;
 Document_Element_SetData(element,   "type",  "doughnut");
 Document_Element_SetObject(element, "chart", chart);
 return element; 
}





function UI_Chart_Doughnut(data, radius = 0.5, config = {width:"100%", height:"100%", zIndex:100})
{
 // CREATE ELEMENT
 var element            = UI_Element_Create("core/chart-doughnut");
 
  
 // SETUP CANVAS
 var canvas  = UI_Element_Find(element, "canvas");
 var context = canvas.getContext("2d");  
 Object.assign(canvas.style, config);
 
 
 if(typeof config["tooltip"] != "undefined") var tooltip = config["tooltip"]; else var tooltip = true;

 
 // SETUP CHART DEFAULTS
 var plugins = 
 {
  legend: 
  {
   display: false
  },
   
  tooltip: 
  {
   enabled: tooltip,
   
   callbacks: 
   {
    label:UI_Chart_LabelFormatter 
   }
  },
   
  datalabels: 
  {
   formatter: 
   function(value, context) 
   {
    return "";
   } 
  }
 }


 var options = 
 {
  plugins:    plugins,
  cutout:     (100 * radius) + "%",
  responsive: true,
 }


 // DISSECT DATA INTO COMPONENTS
 var destructured = UI_Chart_DataDestructure(data);
 var chartdata    = 
 {
  datasets: 
  [
   {
    data:            destructured["values"],
    backgroundColor: destructured["colors"],
    borderWidth:     0
   }
  ]
 }


 var chart = 
 new Chart(context, 
 {
  type:       "doughnut",
  cutout:     100 * radius,
  responsive: false,
  data:       chartdata, 
  options:    options
 });
 
 
 chart["sourcedata"] = data;
 Document_Element_SetData(element,   "type",  "doughnut");
 Document_Element_SetObject(element, "chart", chart);
 return element; 
}





function UI_Chart_Lines(labels, data, options = {}, y_formatter, x_formatter, onclick, config = {width:"100%", height:"100%", zIndex:100})
{
 // CREATE ELEMENT
 var element            = UI_Element_Create("core/chart-lines");
 element.style.position = "relative";

  
 // SETUP CANVAS
 var canvas  = UI_Element_Find(element, "canvas");
 var context = canvas.getContext("2d");
 Object.assign(canvas.style, config);
 
  
 // DATA
 var chartdata =
 {
  labels,
  
  datasets: data
 }
 
 // SET INTERPOLATION FOR ALL SETS IN DATA
 if(options["interpolation"]) 
 {
  for(var set of data) set["cubicInterpolationMode"] = "monotone";
 }



 
 // SETUP CHART DEFAULTS
 var plugins = 
 {
  legend: 
  {
   display: false
  },
   
  tooltip: 
  {
   enabled: true,
   
   callbacks: 
   {
    label:UI_Chart_LabelFormatter 
   }
  },
   
  datalabels: 
  {
   formatter: 
   function(value, context) 
   {
    return "";
   } 
  }
 }


 
 // OPTIONS
 var chartoptions = 
 {
  plugins:    plugins,
  
  responsive: true,
  
  scales: 
  {
   y: 
   {
    ticks: 
	{
     callback : y_formatter || function(value){return value}
    }
   },
   
   x:
   {
	ticks: 
	{
     callback : x_formatter || function(value){return ""}
    }
   }
  }
  
 }
 
   
 if(options["min"] != undefined)
 {
  Safe_Set(chartoptions, ["scales", "y", "min"],          options["min"]);
 }

 
 if(options["max"] != undefined)
 {
  Safe_Set(chartoptions, ["scales", "y", "max"],          options["max"])
 }
 
 
 if(options["responsive"])
 { 
  chartoptions["responsive"]          = true;
  chartoptions["maintainAspectRatio"] = false;	
 }
 
 
 if(!options["gaps"])
 { 
  chartoptions["spanGaps"] = true;
 }


 // CHART
 var chart = 
 new Chart(context, 
 {
  type:       "line",
  data:       chartdata, 
  options:    chartoptions
 });
 

 // MAP CANVAS CLICK TO POINT SELECTION IN CHART
 canvas.onclick = 
 function(event)
 {
  var points = chart.getElementsAtEventForMode(event, "nearest", {intersect: true}, true);
  
  if(points.length > 0)
  {
   var point = points[0];

   if(onclick) onclick(point, event);
  }
 };

 
 chart["sourcedata"] = chartdata;
 Document_Element_SetData(element,   "type",  "line");
 Document_Element_SetObject(element, "chart", chart);
 return element; 
}







function UI_Chart_Bars(sets, options = {})
{
 // CREATE ELEMENT
 var element            = UI_Element_Create("core/chart-bars");
 element.style.position = "relative";

  
 // SETUP CANVAS
 var canvas   = UI_Element_Find(element, "canvas");
 var context  = canvas.getContext("2d"); 


 // DATA
 var chartdata   = 
 {
  labels: [""],
  datasets: sets
 }

 
 // OPTIONS 
 var chartoptions = 
 {
  indexAxis: 'y',
  elements: 
  {
   bar: 
   {
    borderWidth: 2,
   }
  },
   
  responsive: true,
  
  plugins: 
  {
   legend:
   {
    display: false,
   },
	
   datalabels: 
   {
    formatter: function(value, context) 
	{
     return Safe_Get(context, ["dataset", "label"], "");
    }
   }
  }
 }
 
 
  
 if(options["min"])
 {
  Safe_Set(chartoptions, ["scales", "x", "suggestedMin"], options["min"])
 }
 
 
 if(options["max"])
 {
  Safe_Set(chartoptions, ["scales", "x", "suggestedMax"], options["max"])
 }
 
 
 
 // CONFIG
 const config = 
 {
  type:    "bar",
  data:    chartdata,
  options: chartoptions
 } 
 
 var chart = new Chart(context, config);

 chart["sourcedata"] = chartdata;
 Document_Element_SetData(element,   "type",  "bar");
 Document_Element_SetObject(element, "chart", chart);
 
 return element; 
}





function UI_Chart_Radar(labels, data, options = {}, config = {width:"100%", height:"100%", zIndex:100})
{
 // CREATE ELEMENT
 var element            = UI_Element_Create("core/chart-radar");
 element.style.position = "relative";

  
 // SETUP CANVAS
 var canvas  = UI_Element_Find(element, "canvas");
 var context = canvas.getContext("2d"); 
 Object.assign(canvas.style, config);

 
 // DATA
 var chartdata =
 {
  labels,
  datasets: data
 }
 
 
 // SETUP CHART DEFAULTS
 var plugins = 
 {
  legend: 
  {
   display: false
  },
   
  tooltip: 
  {
   enabled: false 
  },
   
  datalabels: 
  {
   formatter: 
   function(value, context) 
   {
    return "";
   } 
  }
 }


 // OPTIONS
 var chartoptions = 
 {
  aspectRatio: 1,
  plugins:    plugins,
 }
 
 
 // SET FONT SIZE AND PADDING (DOUBLE THE FONT'S SIZE)
 Safe_Set(chartoptions, ["scales", "r", "pointLabels", "font", "size"], Chart.defaults.font.size);
 Safe_Set(chartoptions, ["scales", "r", "pointLabels", "padding"],      parseInt(Chart.defaults.font.size) * 2);
 
 // DO NOT DISPLAY TICKS
 Safe_Set(chartoptions, ["scales", "r", "ticks", "display"], false);
 Safe_Set(chartoptions, ["scale", "stepSize"], 1);
   
 if(options["min"] != undefined)
 {
  Safe_Set(chartoptions, ["scale", "min"], options["min"]);
 }

 
 if(options["max"] != undefined)
 {
  Safe_Set(chartoptions, ["scale", "max"], options["max"])
 }
 
 
 if(options["responsive"])
 { 
  chartoptions["responsive"]          = true;
  chartoptions["maintainAspectRatio"] = false;	
 }
 
 console.log(chartdata);

 // CHART
 var chart = 
 new Chart(context, 
 {
  type:       "radar",
  data:       chartdata, 
  options:    chartoptions
 });
 

 chart["sourcedata"] = chartdata;
 Document_Element_SetData(element,   "type",  "radar");
 Document_Element_SetObject(element, "chart", chart);
 return element; 
}





// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      C A L E N D A R                                           // 
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function UI_Calendar(month, year, data = {},  config = {})
{ 
 // BASICS
 var today  = Date_Portion(Date_Now(), "date-only");
 var locale = UI_Language_Current(true);
 
 
 // TABLE
 var table  = UI_Table("cursive");
 table.style.tableLayout = "fixed";
 
 
 // HEADER
 var row = UI_Table_Row(table); 
 for(var i = 1; i <= 7; i++)
 {
  var cell       = UI_Table_Cell(row, {type:"header"});  
  cell.innerHTML = Date_Weekday_Name(i, "short", locale); 
 }
 
 
 var days   = Date_Month_ListDays(month, year);
 
 
 // FIRST ROW: SEE HOW MANY CELLS WE NEED TO SKIP TO GET TO THE FIRST DAY OF THE MONTH
 var row = UI_Table_Row(table); 
 
 var first = Date_Weekday_Get(days[0]);
 for(var weekday = 1; weekday < first; weekday++)
 {
  var cell              = UI_Table_Cell(row);
  cell.style.visibility = "hidden";
  
  row.appendChild(cell);
 }	 


 // FUNCTION THAT WILL DETERMINE WHETHER A CELL IS ACTIVE OR NOT, GIVEN A DAY AND DATA
 if(config["activeday"])
 {
  var activeday = config["activeday"];
 }
 else
 {
  var activeday =
  function(day, data)
  {
   return data[day];
  }
 }
 

 // NOW WE PROCEED: KEEP ADDING DAYS
 var d = 0;
 while(d < days.length)
 {	 
  var weekday = Date_Weekday_Get(days[d]);
  
  var cell       = UI_Table_Cell(row); 
  cell.innerHTML = Date_Get(days[d], "day"); 
    
  var day = Date_Portion(days[d], "date-only");
  Document_Element_SetData(cell, "date", day);
	
	
  // ACTIVE CELL?	
  var active = activeday(day, data);
	
	
  // CELL WITH DATA?
  if(active)
  {
   cell.style.backgroundColor = "var(--color-alert-light)"; 
   Document_Element_SetObject(cell, "data", data[day]);
  }
  else
  {
  }
  
  
  // CELL ONCLICK
  if(config["onclick"] && (active || config["emptyactive"]))
  {
   Document_CSS_SetClass(cell, "style-clickable");
   
   cell.onclick =
   function(event)
   {
    var element = event.currentTarget;
	var data    = Document_Element_GetObject(element, "data");
	var date    = Document_Element_GetData(element, "date");
	
	config["onclick"](cell, date, data);
   }
  }
 
    
  // HIGHLIGHT TODAY
  if(day == today) 
  {
   cell.style.backgroundColor = "var(--color-noted)";
   Document_Element_Animate(cell, "flash 1.5s ease-in-out 1.5");
  }
  
  
  // CHECK ROW END
  if(weekday == 7)
  {
   var row = false;
   
   // START NEW ROW UNLESS THIS WAS ALSO THE FINAL DAY
   if(d != (days.length -1))
   {
    var row = UI_Table_Row(table);
   }
  }
  
  d++;
 }


 return table;
}



// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          F R A M E S                                           // 
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function UI_Frame(template = "standard", background, options = {})
{
 var frame  = UI_Element_Create("core/frame-" + template);
 
 for(var component of ["top", "right", "bottom", "left"])
 {
  var element = UI_Element_Find(frame, component); 
  var url     = background + "/" + component + ".png";
  
  await Document_Image_Load(element, [url]);
 }
 
 return frame;
}



async function UI_Frame_Flexi(background, bordersize)
{
 var frame                  = UI_Table();
 frame.style.borderCollapse = "collapse";
 frame.style.width          = "auto";
 frame.style.height         = "auto";
 frame.style.overflow       = "hidden";
 
 
 var row            = UI_Table_Row(frame);
 
 var cell           = UI_Table_Cell(row);
 cell.colSpan       = 3;
 cell.style.padding = "0px";
 cell.style.height  = bordersize + "px";
 Document_Element_SetData(cell, "uid", "top");
 
 
 var row             = UI_Table_Row(frame);
 
 var cell            = UI_Table_Cell(row);
 cell.style.padding  = "0px";
 cell.style.width    = bordersize + "px";
 Document_Element_SetData(cell, "uid", "left");
 
 var cell            = UI_Table_Cell(row);
 cell.style.padding  = "0px";
 cell.style.overflow = "hidden";
 Document_Element_SetData(cell, "uid", "content");
 
 var cell            = UI_Table_Cell(row);
 cell.style.padding  = "0px";
 cell.style.width    = bordersize + "px";
 Document_Element_SetData(cell, "uid", "right");
 
 
 var row             = UI_Table_Row(frame);
 
 var cell            = UI_Table_Cell(row);
 cell.colSpan        = 3;
 cell.style.padding  = "0px";
 cell.style.height   = bordersize + "px";
 Document_Element_SetData(cell, "uid", "bottom");
 
 
 
 for(var component of ["top", "right", "bottom", "left"])
 {
  var element = UI_Element_Find(frame, component); 
  var url     = background + "/" + component + ".png";
  
  element.style.backgroundSize  = "100% 100%";
  element.style.backgroundImage = "url(" + url + ")";	  
 }
 
 return frame;
}









// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      S T I C K E R S                                           // 
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function UI_Sticker(element, sticker, options = {corner:"top", z:1000})
{
 sticker.style.position = "absolute";
 sticker.style.zIndex   = options["z"];
 Document_Element_SetData(sticker, "sticker", true);

 
 document.body.appendChild(sticker);
 
 
 var attach = 
 function(event)
 {  
  var point = Document_Element_Corner(element, options["corner"]);
  
  switch(options["corner"])
  {
   case "top":          var opposite = "bottom";       break;
   case "center":       var opposite = "center";       break;
   case "bottom":       var opposite = "top";          break;
   case "left top":     var opposite = "right bottom"; break;
   case "left":         var opposite = "right";        break;
   case "left bottom":  var opposite = "right top";    break;
   case "right top":    var opposite = "left top";     break;
   case "right":        var opposite = "left";         break;
   case "right bottom": var opposite = "left bottom";  break;
  }
  var rect         = sticker.getBoundingClientRect();
  var displacement = Geometry_Rect_Displacement(rect, opposite);
  
  var offset_left    = options["offset_left"] || 0;
  var offset_top     = options["offset_top"]  || 0;
  
  sticker.style.left = point["left"] - displacement["left"] + offset_left;
  sticker.style.top  = point["top"]  - displacement["top"]  + offset_top;
 }
 
 attach();
 
 var observer = new ResizeObserver(attach);
 observer.observe(element);
 
 return sticker;
}



function UI_Stickers_Clean(container)
{
 if(!container) var container = document.body;
 
 var stickers = Document_Element_FindChildren(container, "sticker");
 for(var sticker of stickers) sticker.remove();
}




function UI_Sticker_Frame(template, content, variables)
{
 var frame     = UI_Element_Create("core/" + template, variables);
 var container = UI_Element_Find(frame, "content");
 
 container.appendChild(content);
 
 return frame;
}










// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      L A N G U A G E                                           // 
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function UI_Language_Current(aslocale)
{
 var lang = Safe_Get(application, ["state", "core", "lang"], "en");
 
 if(aslocale) lang = Core_Data_Value("core/languages", lang, "code");
 
 return lang;
}



function UI_Language_Set(language)
{
 Safe_Set(application, ["state", "core", "lang"], language);
}



function UI_Language_Page(pageid)
{
 // FOR MODULES, WE ALLOW TO ADDRESS THE MODULE'S BASE PAGE (/MODULE) AS JUST "MODULENAME"
 if(!pageid.includes("/")) pageid = pageid + "/module";
	 
 var page = Safe_Get(application, ["data", pageid], {});
 return page;
}





function UI_Language_Exists(pageid, item, lang)
{	
 if(!lang) var lang = UI_Language_Current();
 var page   = UI_Language_Page(pageid);
 var string = Safe_Get(page, [item, lang], "");
 
 return string !== "";
}





function UI_Language_String(pageid, item, variables, lang)
{	  
 var page   = UI_Language_Page(pageid);
 
 // LANGUAGE TO BE USED
 if(!lang) var lang = UI_Language_Current();
 
 // TRY GETTING A STRING FOR THIS ITEM AND LANGUAGE
 var string = Safe_Get(page, [item, lang], "");
 
 //console.log(pageid, item, string);
 
 // NOT FOUND? TRY WITH ENGLISH (UNIVERSAL DEFAULT). IF NOT FOUND, JUST THE ITEM DEFINITION AS TEXT
 if(string == "") 
 {
  //console.log(pageid + " / " + itemid + " / " + lang + " was undefined");
  var string = Safe_Get(page, [item, "en"], item);
 }
 
 // FORMAT AND RETURN
 string = String_Variables_Set(string, variables);
 return string;
}



function UI_Language_Object(obj, def, variables, lang)
{
 if(!lang) var lang = UI_Language_Current();
 
 var text = Safe_Get(obj, [lang], "");
 if(text == "") var text = Safe_Get(obj, ["en"], def);
 
 if(variables) text = String_Variables_Set(text, variables);
 return text;
}





function UI_Language_Apply(text, pageid, variables, lang)
{ 
 var page = UI_Language_Page(pageid);
 
 if(!lang) var lang = UI_Language_Current();

 var keys = Object.keys(page);
 
 for(var key of keys)
 {
  var string = Safe_Get(page, [key, lang], "");
  if(string == "") var string = Safe_Get(page, [key, "en"], key);
  
  text = text.replaceAll("%" + key + "%", string);
 }
 
 if(variables) text = String_Variables_Set(text, variables);
 
 return text;
}




function UI_Language_Options(page, lang)
{
 if(!lang) var lang = UI_Language_Current();
 
 if(typeof page == "string") var page = Core_Data_Page(page);
 
 var options = [];
 for(var id in page)
 {
  var value = id;
  var text  = UI_Language_Object(page[id]);
  
  options.push({value, text});
 }
 
 return options;
}





function UI_Language_Date(date, format, lang)
{
 if(!lang) var lang = UI_Language_Current();
 var locale         = Core_Data_Value("core/languages", lang, "code");
 
 var text = Date_Format(date, locale, format);
 
 return text;
}







// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          I N I T                                               // 
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

Chart.defaults.font.family = Document_CSS_GetValue("text-caption-medium", "fontFamily")
Chart.defaults.font.size   = Document_CSS_GetValue("text-caption-medium", "fontSize");// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                  A C T I V I T I E S                                           //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Course_Class_ActivityVideo(data, state, source)
{
 var row       = UI_Element_Create("course/class-row-content");
 
 var lesson_id = Safe_Get(data, ["lesson", "source"]);
 var path      = "content/lessons/" + lesson_id + "/" + source;
 var results   = Safe_Get(data, ["activities", lesson_id + "/" + source], []);
    
 // COVER PICTURE
 var url           = path + "/cover.png";
 var element       = UI_Element_Find(row, "cover");
 var fallback      = Resources_URL("");
 Document_Image_Load(element, [url, fallback]);
  
  
 // COVER CAPTION
 var element       = UI_Element_Find(row, "caption");
 element.innerHTML = UI_Language_String("course/activities", "video");
  
  
 // ACTIONS
 var actions = UI_Element_Find(row, "actions");
 for(var activity of ["watch", "learn", "readspeak", "listenspeak", "listenwrite"])
 { 
  var icon   = Core_Data_Value("course/activities", "video activity " + activity, "icon") || Core_Data_Value("course/activities", "video", "icon");
  icon       = "<li class = 'fa fa-" + icon + "'></li>";
  
  var text   = icon + "&nbsp;&nbsp;&nbsp;" + UI_Language_String("course/activities", "video activity " + activity);
  var cfg    = Core_Data_Section("video/modes", activity);
   
  var action = Course_Class_DisplayAction(actions, text, activity, state, path, "content");
  Document_Element_SetObject(action, "config", cfg);
 }
  
 
 // EMPTY CHART
 var chart                = Course_Class_DisplayChart([], state);
 var element              = UI_Element_Find(row, "row-chart");
 Document_Element_Disable(element, "style-disabled");
 element.appendChild(chart);
 
 
 return row;
}




function Course_Class_ActivityTest(data, state, source)
{
 var row       = UI_Element_Create("course/class-row-content");
 
 var lesson_id = Safe_Get(data, ["lesson", "source"]);
 var path      = "content/lessons/" + lesson_id + "/" + source;
 var results   = Safe_Get(data, ["activities", lesson_id + "/" + source], []);
 var classdate = Safe_Get(data, ["class", "date_end"], Date_Now());
 
 // COVER PICTURE
 var url           = "content/lessons/" + lesson_id + "/cover.png";
 var element       = UI_Element_Find(row, "cover");
 var fallback      = Resources_URL("images/cover-test.jpg");
 Document_Image_Load(element, [url, fallback]);
  
 // COVER CAPTION
 var element       = UI_Element_Find(row, "caption");
 element.innerHTML = UI_Language_String("course/activities", "test");
  
  
 // ACTIONS
 var actions = UI_Element_Find(row, "actions");
  
  
 // PRE-LESSON ASSESSMENT
 var icon   = Core_Data_Value("course/activities", "test action prelesson", "icon") || Core_Data_Value("course/activities", "test", "icon");
 icon       = "<li class = 'fa fa-" + icon + "'></li>";
  
 var text   = icon + "&nbsp;&nbsp;&nbsp;" + UI_Language_String("course/activities", "test action prelesson");
 var action = Course_Class_DisplayAction(actions, text, "test", state, path, "content");
 if(User_Role() == "student" && (results.length != 0 || state == "post")) Document_Element_Disable(action, "style-disabled"); 
    
	
 // FREE PRACTICE: IF BEFORE CLASS AND NO RESULT YET, DISALLOW
 var icon   = Core_Data_Value("course/activities", "test action practice", "icon") || Core_Data_Value("course/activities", "test", "icon");
 icon       = "<li class = 'fa fa-" + icon + "'></li>";
 
 var text   = icon + "&nbsp;&nbsp;&nbsp;" +UI_Language_String("course/activities", "test action practice");
 var action = Course_Class_DisplayAction(actions, text, "practice", state, path, "nocontent");
 if(User_Role() == "student" && results.length == 0 && state == "pre") Document_Element_Disable(action, "style-disabled"); 
  
  
 // POST-LESSON ASSESSMENT
 var icon   = Core_Data_Value("course/activities", "test action postlesson", "icon") || Core_Data_Value("course/activities", "test", "icon");
 icon       = "<li class = 'fa fa-" + icon + "'></li>";
 
 var text   = icon + "&nbsp;&nbsp;&nbsp;" + UI_Language_String("course/activities", "test action postlesson");
 var action = Course_Class_DisplayAction(actions, text, "test", state, path, "content", {classdate});
 if(User_Role() == "student" && state == "pre") Document_Element_Disable(action, "style-disabled"); 
  
  
 // CHART
 var chart   = Course_Class_DisplayChart(results, state);
 var element = UI_Element_Find(row, "row-chart");
 element.appendChild(chart);
  
 // CHART TEXT
 Course_Class_DisplayChartText(row, results, state);
  
 return row;
}





function Course_Class_ActivityVocabulary(data, state, source)
{
 var row        = UI_Element_Create("course/class-row-content");
 
 var lesson_id  = Safe_Get(data, ["lesson", "source"]);
 var path       = "content/lessons/" + lesson_id + "/" + source;
 var results    = Safe_Get(data, ["activities", lesson_id + "/" + source], []);
 var classdate  = Safe_Get(data, ["class", "date_end"], Date_Now());
 var vocabulary = Safe_Get(data, ["lesson", "vocabulary"], {});
 
 
 // COVER PICTURE
 // TRY TO USE FIRST VOCABULARY TERM AS COVER
 var values        = Object.values(vocabulary);
 var url           = "content/vocabulary/" + values[0] + "/picture.png";
 var element       = UI_Element_Find(row, "cover");
 var fallback      = Resources_URL("images/cover-dictionary.jpg");
 Document_Image_Load(element, [url, fallback]);
 // CHECK DONT HAVE VOCABULARY
 if(typeof values[0] == "undefined" || values[0] == "") {
    var element              = UI_Element_Create("core/separator-horizontal-minimal");
    element.style.display = "none";
    return element;
 }

 // COVER CAPTION
 var element       = UI_Element_Find(row, "caption");
 element.innerHTML = UI_Language_String("course/activities", "vocabulary");
  
  
 // ACTIONS
 var actions = UI_Element_Find(row, "actions");
  
 // PRE-LESSON ASSESSMENT
 var icon   = Core_Data_Value("course/activities", "vocabulary action prelesson", "icon") || Core_Data_Value("course/activities", "vocabulary", "icon");
 icon       = "<li class = 'fa fa-" + icon + "'></li>";
 
 var text   = icon + "&nbsp;&nbsp;&nbsp;" + UI_Language_String("course/activities", "vocabulary action prelesson");
 var action = Course_Class_DisplayAction(actions, text, "test", state, path, "content");
 if(User_Role() == "student" && (results.length != 0 || state == "post")) Document_Element_Disable(action, "style-disabled"); 
	
 
 // FREE PRACTICE: IF BEFORE CLASS AND NO RESULT YET, DISALLOW
 var icon   = Core_Data_Value("course/activities", "vocabulary action practice", "icon") || Core_Data_Value("course/activities", "vocabulary", "icon");
 icon       = "<li class = 'fa fa-" + icon + "'></li>";
 
 var text   = icon + "&nbsp;&nbsp;&nbsp;" + UI_Language_String("course/activities", "vocabulary action practice");
 var action = Course_Class_DisplayAction(actions, text, "practice", state, path, "nocontent");
 if(User_Role() == "student" && results.length == 0 && state == "pre") Document_Element_Disable(action, "style-disabled");
  
 
 // POST-LESSON ASSESSMENT
 var icon   = Core_Data_Value("course/activities", "vocabulary action postlesson", "icon") || Core_Data_Value("course/activities", "vocabulary", "icon");
 icon       = "<li class = 'fa fa-" + icon + "'></li>";
 
 var text   = icon + "&nbsp;&nbsp;&nbsp;" + UI_Language_String("course/activities", "vocabulary action postlesson");
 var action = Course_Class_DisplayAction(actions, text, "test", state, path, "content", {classdate});
 if(User_Role() == "student" && state == "pre") Document_Element_Disable(action, "style-disabled"); 
  
  
 // CHART
 var chart   = Course_Class_DisplayChart(results, state);
 var element = UI_Element_Find(row, "row-chart");
 element.appendChild(chart);
  
 // CHART TEXT
 Course_Class_DisplayChartText(row, results, state)
  
  
 return row;
}





function Course_Class_ActivityDocuments(data, state, source)
{
 var row       = UI_Element_Create("course/class-row-content");
 
 var lesson_id = Safe_Get(data, ["lesson", "source"]);
 var path      = "content/lessons/" + lesson_id + "/" + source;
 var results   = Safe_Get(data, ["activities", lesson_id + "/" + source], []);
 var documents = Object_Subset(data["lesson"], "document ");
 
 
 // COVER PICTURE
 var url           = Resources_URL("images/cover-presentation.jpg");
 var element       = UI_Element_Find(row, "cover");
 Document_Image_Load(element, [url]);
 
 
 // COVER CAPTION
 var element       = UI_Element_Find(row, "caption");
 element.innerHTML = UI_Language_String("course/activities", "documents");
  
  
 // ACTIONS
 var actions = UI_Element_Find(row, "actions");
 
 // DOCUMENTS
 for(var id in documents)
 {
  var file = documents[id] || {};
  var name = file["file"]  || "";
  
  if(name && Path_Filename(Path_RemoveExtension(name)).toLowerCase() != "plan")
  {
   var icon     = Core_Data_Value("course/activities", "documents", "icon");
   icon         = "<li class = 'fa fa-" + icon + "'></li>";
  
   var text     = icon + "&nbsp;&nbsp;&nbsp;" + UI_Language_Object(file);
   var filename = file["file"]
  
   var action = Course_Class_DisplayAction(actions, text.toLowerCase(), filename, state, path, "nocontent"); 
   action.style.textTransform = "capitalize";
   
   // ENABLE ONLY AFTER LESSON
   if(User_Role() == "student" && state == "pre") Document_Element_Disable(action, "style-disabled"); 
  }
 }
 
 
 // EMPTY CHART
 var chart                = Course_Class_DisplayChart([], state);
 var element              = UI_Element_Find(row, "row-chart");
 Document_Element_Disable(element, "style-disabled");
 element.appendChild(chart);
  
  
 return row;
}




function Course_Class_ActivityPresentation(data, state, source)
{
 var row        = UI_Element_Create("course/class-row-content");
 
 var lesson_id  = Safe_Get(data, ["lesson", "source"]);
 var path       = "content/lessons/" + lesson_id + "/" + source;
 
 // COVER PICTURE
 var element       = UI_Element_Find(row, "cover");
 var url           = Resources_URL("images/cover-presentation.jpg");
 Document_Image_Load(element, [url]);
  
 // COVER CAPTION
 var element       = UI_Element_Find(row, "caption");
 element.innerHTML = UI_Language_String("course/activities", "presentation");
  
  
 // ACTIONS
 var actions = UI_Element_Find(row, "actions");
  
 // ACCESS THE PRESENTATION
 var icon   = Core_Data_Value("course/activities", "presentation", "icon");
 icon       = "<li class = 'fa fa-" + icon + "'></li>";
 
 var text   = icon + "&nbsp;&nbsp;&nbsp;" + UI_Language_String("course/activities", "presentation activity review");
 var path   = "content/lessons/" + lesson_id + "/presentation";
 var action = Course_Class_DisplayAction(actions, text, "test", state, path, "nocontent", {fastexit:true});
 
 // ENABLE ONLY AFTER LESSON
 if(User_Role() == "student" && state == "pre") Document_Element_Disable(action, "style-disabled"); 
  
  
 // EMPTY CHART
 var chart                = Course_Class_DisplayChart([], state);
 var element              = UI_Element_Find(row, "row-chart");
 Document_Element_Disable(element, "style-disabled");
 element.appendChild(chart);
  
  
 return row;
}





function Course_Class_ActivityBookpage(data, state, source)
{
 var row        = UI_Element_Create("course/class-row-content");
 
 var lesson_id  = Safe_Get(data, ["lesson", "source"]);
 var path       = "content/lessons/" + lesson_id + "/" + source;
 

 // COVER PICTURE
 var element       = UI_Element_Find(row, "cover");
 var url           = Resources_URL("images/cover-coursebook.png");
 Document_Image_Load(element, [url]);
  
 // COVER CAPTION
 var element       = UI_Element_Find(row, "caption");
 element.innerHTML = UI_Language_String("course/activities", "bookpage");
  
  
 // ACTIONS
 var actions = UI_Element_Find(row, "actions");
  
 // THIS CONFIGURATION WILL BE PASSED ALL THE WAY TO ACTIVITY_RUN FIRST AND BOOKPAGE RENDERER LATER
 var config =
 {
  fastexit : true,
  popup    : "transparent",
  scale    : true,
  shadow   : true
 }
  
 // ACCESS COURSEBOOK
 var icon   = Core_Data_Value("course/activities", "bookpage", "icon");
 icon       = "<li class = 'fa fa-" + icon + "'></li>";
 
 var text   = icon + "&nbsp;&nbsp;&nbsp;" + UI_Language_String("course/activities", "bookpage activity read");
 var path   = "content/lessons/" + lesson_id + "/bookpage";
 var action = Course_Class_DisplayAction(actions, text, "test", state, path, "nocontent", config);
 //if(User_Role() == "student" && state == "pre") Document_Element_Disable(action, "style-disabled"); 
 
 //BUTTON DOWNLOAD LESSON
 var iconDownload = document.createElement("div");
 iconDownload.classList.add("fa","fa-download","style-clickable","effect-highlight-text");
 iconDownload.style.cssText = "font-size:16px;";
 iconDownload.dataset.lesson = lesson_id;
 iconDownload.onclick = async (e) => {
    let element = e.target;
    Bookpage_Download(element.dataset.lesson);
 } 
 actions.parentElement.appendChild(iconDownload);
 
 // EMPTY CHART
 var chart                = Course_Class_DisplayChart([], state);
 var element              = UI_Element_Find(row, "row-chart");
 Document_Element_Disable(element, "style-disabled");
 element.appendChild(chart);
  
  
 return row;
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                    A S S E S S M E N T                                         //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Course_Class_DisplayAssessment(container)
{
 var data            = Core_State_Get("course", ["class-data"]);
 var assessment      = Safe_Get(data, ["seat", "assessment"], {});
 assessment = Round(assessment);
 container.innerHTML = "";
 
 // TEACHER FEEDBACK
 var row = Course_Class_AssessmentFeedback(data);
 
 container.appendChild(row);
 
 
 
 // OUTCOMES FOR LESSON AIMS AND SKILLS
 for(var category of ["outcomes", "core skills"])
 {
  outcomes = Safe_Get(data, ["lesson", category], {});
  //SETUP CORE SKILL FROM OUTCOME SKILL
  if(category == "core skills"){
    var coreskills = {};
    outcomedata= Safe_Get(data, ["lesson", "outcomes"], {});
    for (let id in outcomedata) {
        skill = outcomedata[id]["cefr"]["skill"];
        if(skill) coreskills[skill] = outcomes[skill];
    }
    outcomes = coreskills;
  }
  var row  = Assessment_Display_Assessment(category, outcomes, assessment);
  
  container.appendChild(row);
 }
 
}






function Course_Class_AssessmentFeedback(data, textonly)
{
 // TEACHER PICTURE
 var teacher_id = Safe_Get(data, ["teacher", "id"]);
 
 
 // GET ALL ASSESSMENT DATA FOR THIS STUDENT FOR THIS LESSON
 var assessment = Safe_Get(data, ["seat", "assessment"], {});
  assessment = Round(assessment);
 // GET ALL OUTCOMES FOR THIS LESSON, CATEGORIZED
 var outcomes = [];
 for(var category of ["outcomes", "core skills", "extra skills"])
 {
  outcomes[category] = Safe_Get(data, ["lesson", category], {});
 }
 
 
 // BEHAVIOR, ATTENDANCE AND FEEDBACK TAKEN DIRECTLY FROM SEAT
 var more = Safe_Get(data, ["seat"]);
 
 
 // TRANSCRIBE 
 var text = Assessment_Report_Transcribe(outcomes, assessment, more) + "<br><br>";
 
 if(textonly) return text; 
 
 var row = Assessment_Display_Feedback(teacher_id, text);
 return row;
}



function Round(assessment){
 for (let key in assessment) {
    assessment[key] = Math.ceil(assessment[key]);
 }
 return assessment;
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          B A D G E S                                           //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Course_Class_DisplayBadges(container)
{
 var data   = Core_State_Get("course", ["class-data"]);
 var badges = Safe_Get(data, ["seat", "badges"], []);
 var page   = UI_Element_Create("course/class-badges");
 
 badges = Array_Catalog_Counts(badges);
 for(var id in badges)
 {
  var attract = Core_Data_Section("classroom/attract", id);  
  var message = UI_Language_Object(attract);
  var sound   = attract["sound"];
  var emoji   = attract["icon"];
  
  var count   = badges[id];
  
  var element = UI_Element_Create("course/class-badge", {emoji, count, message});
  Document_Element_SetData(element, "sound",   sound);
  Document_Element_SetData(element, "message", message);
  
  //element.onclick = 
  
  element.style.visibility = "hidden";
  page.appendChild(element);
 }

 Document_Element_AnimateChildren(page, "zoomIn 0.5s 1", 
 {
  delay:    250, 
  interval: 250, 
  onstart:
  function(element) 
  {
   element.style.visibility = "visible";
  }
 }); 

 container.innerHTML = "";
 container.appendChild(page);
}



// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                         C L A S S                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Course_Class(container, seat_id = false)
{
 var page = UI_Element_Create("course/class");
 
 // SET BY ANOTHER MODULE? 
 if(!seat_id)
 {
  var seat_id = Core_State_Get("course", ["view-seat"], false);
  if(seat_id)
  {
   // UNSET
   Core_State_Set("course", ["view-seat"], false);
  }
 }
 
 // SET BY URL?
 if(!seat_id)
 {
  var seat_id = Client_Location_Parameter("seat");
 }
 
 // STILL NO VALID SEAT TO READ? THEN LEAVE
 if(!seat_id) return;
 
 // SET SEAT AS CURRENT
 Core_State_Set("course", ["current-class"], seat_id);
 
 


 //LOAD DATA AND SET AS CURRENT
 var data           = await Core_Api("Course_Seat_Data", {seat_id}); 
 data["scores"]     = data["activities"];
 data["activities"] = Array_Catalog_ByField(data["scores"], "source");
 // REMOVE CONTENT PRESENTATION IF LESSON IS ON HYBRID
 if(data.content.includes("presentation") && Lesson_Type(data.lesson.source) == "hybrid") data.content = data.content.filter(e => e != "presentation");
 // UGLY FIX THAT SHOULD HAPPEN ON THE BACKEND
 Lesson_AdjustDocuments(data["lesson"]);
 
 
 Core_State_Set("course", ["class-data"], data);
 
 
 // LESSON ID FROM DATA
 var lesson_id  = Safe_Get(data, ["lesson", "source"]);
 Core_State_Set("course", ["current-lesson"], lesson_id);
 
 
 // DETERMINE IF WE ARE VIEWING THE CLASS BEFORE OR AFTER IT WAS HELD
 var date_end = Safe_Get(data, ["class", "date_end"], Date_Now());
 if(Date_Now() > date_end) var state = "post"; else var state = "pre";
 Core_State_Set("course", ["class-state"], state);
 
 

 
 // DISPLAY HEADER
 var header = UI_Element_Find(page, "class-header");
 
 
 // TITLE
 var title = Safe_Get(data, ["lesson", "title"], "");
 var text  = UI_Language_Object(title);
 UI_Element_Find(header, "lesson-title").innerHTML = text;
 

 // DATE
 var date = Safe_Get(data, ["class", "date_start"], "");
 var text = UI_Language_Date(date, 
 {
  weekday: "long", 
  day:     "numeric", 
  month:   "long"  
 });
 
 UI_Element_Find(header, "class-date").innerHTML = text;
  
  
 // TIME
 var date    = Safe_Get(data, ["class", "date_start"], "");
 var from    = Date_Get(date, ["hour", "minutes"], ":");
 var date    = Safe_Get(data, ["class", "date_end"], "");
 var to      = Date_Get(date, ["hour", "minutes"], ":");
 
 var element = UI_Element_Find(header, "class-time");
 element.innerHTML = UI_Language_String("course/header", "time", {from, to});
 
 
 
 // CENTER
 var center = Safe_Get(data, ["class", "center_id"]);
 text       = Centers_Name(center);
 
 var element = UI_Element_Find(header, "class-center");
 element.innerHTML = UI_Language_String("course/header", "center", {text});
 
 
 // TEACHER 
 var teacher_id = Safe_Get(data, ["teacher", "id"]);

 var text = [];
 for(var field of ["firstname", "lastname"])
 {
  var value = Safe_Get(data, ["teacher", field], "");
  if(value) text.push(value);
 }
 text = text.join(" ").trim();
 
 var element = UI_Element_Find(header, "class-teacher");
 element.innerHTML = UI_Language_String("course/header", "teacher", {text});
 
 
 
 // AIMS
 var date     = Safe_Get(data, ["class", "date_end"], "");
 if(date > Date_Now()) var period = "future"; else var period = "past";
 var text     = UI_Language_String("course/class", "header aims " + period);
 UI_Element_Find(header, "lesson-intro").innerHTML = text;
  
 var aims     = UI_Element_Find(header, "lesson-aims"); 
 var outcomes = Safe_Get(data, ["lesson", "outcomes"], {});
 var keys     = Object.keys(outcomes);
 for(var key of keys)
 {
  var outcome = Safe_Get(outcomes, [key, "info"], {});
  outcome     = UI_Language_Object(outcome) || "";
  var text    = "•" + "&nbsp;&nbsp;" + String_Capitalize_Initial(outcome);
  
  if(text) 
  {
   var aim  = UI_Element_Create("course/class-content-aim", {text});
   
   aims.appendChild(aim);
  }
 }

 var header_menu = {
  content:
  {
   text :   UI_Language_String("course/class", "header switch content"),
   icons:   [],
   onclick: function(){Course_Class_DisplayActivities(UI_Element_Find(page, "content-rows"))}
  },
  
  assessment:
  {
   text :   UI_Language_String("course/class", "header switch assessment"),
   icons:   [],
   onclick: function(){Course_Class_DisplayAssessment(UI_Element_Find(page, "content-rows"))}
  },
  
  badges:
  {
   text :   UI_Language_String("course/class", "header switch badges"),
   icons:   [],
   onclick: function(){Course_Class_DisplayBadges(UI_Element_Find(page, "content-rows"))}
  },
  
  stream:
  {
   text :   UI_Language_String("course/class", "header switch stream"),
   icons:   [],
   onclick: function(){Course_Class_DisplayStream(UI_Element_Find(page, "content-rows"))}
  },

  review:
  {
   text :   UI_Language_String("course/class", "header switch review"),
   icons:   [],
   onclick: function(){Course_Class_DisplayReminderFile(UI_Element_Find(page, "content-rows"))}
  }
 };
 
 // REMOVE REVIEW HEADER IF THE PROGRAM NOT HAVE REVIEW
 var course_id = Core_State_Get("course", ["class-data", "class", "course_id"]);
 var course = await Core_Api("Courses_Read",{id:course_id}) || {};
 var programs = Core_Config("programs");
 if(typeof programs[course.program] != "undefined" && typeof programs[course.program]["review"] != "undefined" &&  !programs[course.program]["review"])
 {
   delete header_menu["review"];
 }
 // SWITCH
 var header = UI_Header("switches",header_menu,{selectfirst:true, css:"color-noted"});
 
 
 // DISABLE STREAM ACCESS IF THIS CLASS IS NOT ONLINE 
 var streaming = Safe_Get(data, ["class", "online"], false);
 if(streaming == "0") 
 {
  UI_Header_Disable(header, "stream");
 }

 // DISABLE REVIEW HEADER IF REVIEW FILE NOT AVAILABLE
 if(!course.reminder_id && header_menu.hasOwnProperty("review"))
 {
  UI_Header_Disable(header, "review");
 }
  
 // DISABLE ASSESSMENT SWITCH IF CLASS NOT PAST YET
 var date_end = Date_Complete(Safe_Get(data, ["class", "date_start"], "")); 

 if(date_end > Date_Now())
 {
  UI_Header_Disable(header, "assessment");
  UI_Header_Disable(header, "badges");
 }
  
 UI_Element_Find(page, "switches").appendChild(header);
  
 
 // SETUP SWITCHES BETWEEN CLASS SECTIONS (ACTIVITIES, ASSESSMENT, ETC.)
 var elements = Document_Element_FindChildren(page, "display", undefined, ["recurse"]);
 for(var element of elements) element.onclick = Course_Class_Display;

 
 container.innerHTML = "";
 container.appendChild(page);
}



/*
function Course_Class_Display(event)
{
 var element   = event.currentTarget;
 var display   = Document_Element_GetData(element, "display");
 var container = UI_Element_Find("content-rows");
 
 var f = Safe_Function("Course_Class_Display" + String_Capitalize_Initial(display));
 if(f) f(container);
}
*/



async function Course_Class_RefreshData()
{
 var data = Core_State_Get("course", ["class-data"], data);
 
 var student_id     = User_Id();
 var source         = Core_State_Get("course", ["current-lesson"]);
 
 // ACTIVITIES RESULTS
 var results        = await Core_Api("Activities_Results_ReadBySource", {student_id, source, strict:false});
 data["scores"]     = results;
 data["activities"] = Array_Catalog_ByField(results, "source");
 
 Core_State_Set("course", ["class-data"], data);
}







async function Course_Class_UpdateCharts()
{
 var student_id = User_Id();
 var source     = Core_State_Get("course", ["current-lesson"]);
 
 var data       = await Core_Api("Activities_Results_ReadBySource", {student_id, source, strict:false});
 data           = Array_Catalog_ByField(data, "source");
 
 var container = UI_Element_Find("content-rows");
 for(var source in data)
 {
  var element = Document_Element_FindChild(container, "source", source);
  
  if(element)
  {
   var chart = UI_Element_Find(element, "chart");
  }
 }
 
 console.log(data);
}





async function Course_Class_RunActivity(event)
{
 // GET ACTIVITY INFO
 var element = event.currentTarget;
 
 var mode    = Document_Element_GetData(element,   "mode");
 var state   = Document_Element_GetData(element,   "state");
 var source  = Document_Element_GetData(element,   "source");
 var config  = Document_Element_GetObject(element, "config") || {};
 
 console.log(config);
 
 // DEFAULT CONFIG
 Object.assign(config,
 {
  escape:     true, 
  mode:       mode, 
  navigation: false, 
  student:    User_Id()
 });
 
 

 // RUN ACTIVITY
 console.log("Running Activity " + source + " in mode " + mode.toUpperCase() + "/" + state.toUpperCase());
 var result = await Activity_Run(source, config);

 // IF THERE IS A RESULT (ACTIVITY WASN'T CLOSED BEFORE THE END ETC.)
 if(result !== false && result !== undefined)
 {
  if(mode != "practice")
  {
   // IN PRE-LESSON STATE, DISPLAY "NOW YOU CAN PRACTICE" INTERMISSION INSTEAD OF RESULT
   if(state == "pre")
   {
    var title   = UI_Language_String("course/popups", "intermission practice title");
    var text    = UI_Language_String("course/popups", "intermission practice text");
    var picture = Resources_URL("images/intermission-activity-assessed.png");
    
    if(mode == "test") await Activity_Result_Update();
    else await Activity_Result_Store(result);
    
    await UI_Popup_Intermission(title, text, picture, 3);
   }
   else
   {
    // DISPLAY RESULT 
    await Activity_Result_Popup(result);
   }
  
   console.log("data refreshed");
  
   // REFRESH CLASS DATA
   await Course_Class_RefreshData();
  
   // REDRAW CONTENT
   Course_Class_DisplayActivities(UI_Element_Find("content-rows"));
  }
 }
}

// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                       D I S P L A Y                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Course_Class_DisplayActivities(content, state)
{
 var data          = Core_State_Get("course", ["class-data"]);
 var state         = state || Core_State_Get("course", ["class-state"]);
 var lesson_id     = Safe_Get(data, ["lesson", "source"]);
 
 content.innerHTML = "";
 
 
 // SPACER
 var element              = UI_Element_Create("core/separator-horizontal-minimal");
 element.style.visibility = "hidden";
 content.appendChild(element);
 
 
 // LESSON FOLDERS PLUS SOME MANDATORY CATEGORIES 
 var folders = [...data["content"]];
 folders.push("vocabulary");
  
 
 for(category of ["bookpage", "video", "test", "vocabulary", "documents", "presentation"])
 {
  for(var folder of folders) if(folder.includes(category))
  {
   var activity = String_Filter_AllowAlpha(folder);
   
   var f = Safe_Function("Course_Class_Activity" + String_Capitalize_Initial(activity));
   if(f)
   {
    var row = f(data, state, folder);
   
    content.appendChild(row);
   }
   
  }
 }
 
}




function Coirse_Class_(path, mode, data)
{ 

}



function Course_Class_DisplayAction(container, text, mode, state, source, template, config)
{
 var findscore = 
 function(path, mode, data, classdate)
 {
  path = path.toLowerCase().trim();
  path = path.replace("content/lessons/", ""); 
 
  for(var item of data)
  {  
   
   if(!classdate || item["date"] > classdate)
   {
	var source  = item["source"] || "";
    source      = source.toLowerCase().trim();  

    if(source == path && item["mode"] == mode)
    {
     var score = item["score"];
     if(score < 0) score = 0; else if(score > 1) score = 1;
    
     return score;
    } 
   }
   
  }

  return false;  
 }
	
	
 var action = UI_Element_Create("course/class-action-" + template, {text});  
 if(source) action.onclick = Course_Class_RunActivity;
 
 Document_Element_SetData(action, "mode",   mode);
 Document_Element_SetData(action, "state",  state);
 Document_Element_SetData(action, "source", source);
 
 if(config) Document_Element_SetObject(action, "config", config);
    
 // IF CLASS DATE IS SPECIFIED, ACTIVITY RESULTS WILL BE FILTERED BY PICKING ONLY RESULTS AFTER CLASS DATE.
 // SERVES TO DISTINGUISH BETWEEN "PRE" AND "POST" WITH TESTING ACTIVITIES
 var classdate = Safe_Get(config, "classdate", false);
	
 // COMPLETION CHECK 
 var element = UI_Element_Find(action, "completion");
 if(element)
 {
  var data = Core_State_Get("course", ["class-data", "scores"], []);
   
  var score = findscore(source, mode, data, classdate);
  
  if(score !== false)
  {
   if(Numbers_Between(score, 0, 0.33))
   {
	element.style.color = "var(--color-bad)";
	element.className   = "fa-solid fa-circle-exclamation";
   }
   else
   if(Numbers_Between(score, 0.33, 0.75))
   {
	element.style.color = "var(--color-soso)";
	element.className   = "fa-solid fa-circle-question";
   }
   else
   if(Numbers_Between(score, 0.75, 1))
   {
	element.style.color = "var(--color-good)";
	element.className   = "fa-solid fa-circle-check";
   }
  }
 }
	 
 container.appendChild(action);
 
 return action;
}





function Course_Class_DisplayChart(results, state)
{  
 switch(state)
 {
  case "pre":
    // SORT BY SCORE TO GET THE FIRST
	Array_Items_Sort(results, "date"); 
	var index = 0;
  break;
  
  case "post":
	// SORT BY SCORE TO GET THE BEST
	Array_Items_Sort(results, "score");
	var index = results.length -1;
  break;
 }
 
  
 var items      = Safe_Get(results, [index, "data"], {});
 var chartdata  = Assessment_Report_ChartData(items, "assessment/activities-thresholds");
  
 // IF NO DATA
 if(chartdata.length == 0)
 {
  chartdata = [{color:Document_CSS_GetVariable("color-dark"), label:"", value:1}];
  var chart = UI_Chart_Doughnut(chartdata, 0.67); 
  
  Document_Element_Disable(chart, "style-translucent-light");
 }
 else 
 {
  var chart = UI_Chart_Doughnut(chartdata, 0.67); 
 }	 
 
 return chart;
}





function Course_Class_DisplayChartText(container, results, state)
{ 
 // ANALYZE RESULTS
 if(results && results.length > 0)
 {
  Array_Items_Sort(results, "date"); 
  var first = results[0];
  
  Array_Items_Sort(results, "score");
  var best = results[results.length - 1];
  
  console.log(results);
  console.log(best, first);
  console.log("");
   
  if(results.length > 1)
  {
   if(best == first) 
   {
	var improvement = 0;
   }
   else
   {
    var improvement = Math.floor((best["score"] - first["score"]) * 100);	  
   }
   
   // FIX IMPROVEMENT
   //improvement = improvement * 2;
   if(improvement > 100) improvement = 100;
   if(improvement == 0) improvement = 1;
   
  }
 }
 
 
 // CHART TEXT
 if(!results)
 {
  var text    = "";
  var subtext = "";
 }
 else
 if(results.length == 0)
 {
  var text    = UI_Language_String("course/activities", "chart none text");
  var subtext = UI_Language_String("course/activities", "chart none subtext");
 }
 else
 switch(state)
 {
  case "pre":
	if(results.length > 0)
	{
     var text    = Assessment_Grade_Display(first["score"]); 
	 var subtext = "";		
	}
	else
	{
     //var text =
	}
  break;
   
  case "post":
	if(results.length == 1)
	{
     var text    = Assessment_Grade_Display(first["score"]); 
	 var subtext = UI_Language_String("course/activities", "chart post subtext");
	}
	else
    {
     var text    = Assessment_Grade_Display(best["score"]); 
	 var subtext = UI_Language_String("course/activities", "chart post improvement", {improvement});
	}
  break;
 }
 
 
 // DISPLAY
 UI_Element_Find(container, "chart-text").innerHTML    = text;
 UI_Element_Find(container, "chart-subtext").innerHTML = subtext;
}





// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                         C O U R S E                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Course_OnShow(module, data)
{
}





async function Course_OnUnload()
{
}





async function Course_OnLoad(module, data)
{
 Core_State_Set("course", "page", "classes");
 Core_State_Set("course", "module-body", module);
 
 var items = {};
 for(var period of ["past", "last month", "last week" ,"this week", "this month","next week", "next month", "future"])
 {
  var item        = {};
  item["icons"]   = [];
  item["text"]    = UI_Language_String("course/periods", period);
  item["period"]  = Core_Data_Value("course/periods", period, "period");
  item["onclick"] = Course_Classes_Display;
  
  items[period]  = item;
 }
 
 var header = UI_Header("classes", items, {selectfirst:false, css:"color-noted", template:"big"});
 
 
 // SWITCH TO "THIS WEEK" VIEW BY DEFAULT, BUT NOT IF ANOTHER MODULE SENT US HERE TO VIEW A SPECIFIC SEAT
 if(!Module_Parameter_Get("viewseat")) UI_Header_Set(header, "this week", true);

 UI_Element_Find(module, "classes-header").appendChild(header);
}





async function Course_Classes_Display(item)
{
 var module = Core_State_Get("course", "module-body");
 
 // HIDE CLASS DETAIL
 var container              = UI_Element_Find(module, "class-detail");
 container.style.visibility = "hidden";
 container.innerHTML        = "";
 
 var period = item["period"];
 var range  = Date_Range(period);
 var seats  = await Core_Api("Class_Seats_ListByStudent", {date_from:range["from"], date_to:range["to"], options:{lesson:true, marknext:true}}); console.log(seats); 

 //var ids       = Array_From_Fields(classes, "lesson_id");
 //var info      = await Core_Api("Lessons_Info", {lessons:ids, sections:["info", "title"]});
 //Array_Integrate_AddFromObject(classes, info)
 
 // FIND UPCOMING CLASS, IF ANY
 var upcoming  = false;
 for(var seat of seats) if(seat["next"])
 {
  upcoming = seat;
  break;
 }
 
 // ASSEMBLE DISPLAY
 var list = UI_List_Items(seats, ["style-outlined-accented"], Course_Class_Display, {style:"vertical", overflow:true, sections:false, animate:true, selected:upcoming, highlight:"style-outlined-alert"},
 // ITEMS
 function(seat)
 {  
  var element = UI_Element_Create("course/lesson-thumbnail");
    
  // COVER
  var picture    = UI_Element_Find(element, "picture");
  var source     = "content/lessons/" + seat["lesson_id"] + "/cover.png";
  var fallback = Resources_URL("images/cover-lesson.jpg");
  Document_Image_Load(picture, [source, fallback]);
  
  // TITLE
  var title      = Safe_Get(seat, ["lesson", "title"], {});
  title          = UI_Language_Object(title);
  UI_Element_Find(element, "title").innerHTML = title;
  
  // DATE
  var date       = Safe_Get(seat, ["date_start"]);
  date           = UI_Language_Date(date, "date-time-compact");
  UI_Element_Find(element, "date").innerHTML = date;
  
  // ATTENDANCE
  var attendance = UI_Element_Find(element, "attendance-" + seat["attendance"]);
  if(attendance) attendance.style.display = "flex";
  
  Document_Element_SetObject(element, "seat", seat);
  return element;
 });
 
 
 // DISPLAY
 var container = UI_Element_Find(module, "classes-list"); 
 container.innerHTML = "";
 container.appendChild(list);
}



async function Course_Class_Display(element, seat_id)
{
 if(element)
 {
  var seat    = Document_Element_GetObject(element, "seat");
  var seat_id = seat["id"];
 }
    
 // DISPLAY CLASS DETAIL INSIDE RIGHT PANEL
 var container              = UI_Element_Find("class-detail");
 await Course_Class(container, seat_id);
 container.style.visibility = "visible";
 
 
 Core_State_Set("course", "page", "class");

 //SET DATA BOOK PAGE
 var currentLesson =  Core_State_Get("course", "current-lesson",null);
 var arrLesson  = Lesson_Get_From_Config(currentLesson,"lesson");
 var data = {};
 data["lessons"]    = await Core_Api("Lessons_Read", {sources:arrLesson["lesson"], data:{all:true}});
 data["vocabulary"] = {};
 for (const key in data["lessons"]) {
    const element = data["lessons"][key];
    data["vocabulary"][key] = element["vocabulary"];
 }
 data["bookpage"]   = await Bookpage_Read_Mutiple(arrLesson["lesson"]);
 data["dialogue"]   = await Dialogue_Read_Mutiple(arrLesson["lesson"]);
 Core_State_Set("course", ["class-data", "book-data"],data);
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                         S T R E A M                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Course_Class_DisplayStream(content, state)
{
 var data          = Core_State_Get("course", ["class-data"]);
 var state         = state || Core_State_Get("course", ["class-state"]);
 
 Core_State_Set("course", ["content-display"], content);
 
 content.innerHTML = "";
 
 // SPACER
 var element              = UI_Element_Create("core/separator-horizontal-minimal");
 element.style.visibility = "hidden";
 content.appendChild(element);
 
 
 // IF NOT STREAMING YET, CHECK AGAIN ONCE EVERY MINUTE
 if(!await Course_Class_CheckStream())
 {
  var check = setInterval(Course_Class_CheckStream, 60000);
  Core_State_Set("course", "streaming-check", check);
 }
}



async function Course_Class_CheckStream()
{
 var data     = Core_State_Get("course", ["class-data"]);
 var class_id = Safe_Get(data, ["class", "id"]);
 var display  = Core_State_Get("course", ["content-display"]);
 
 var status = await Core_Api("Class_Streaming", {class_id});
	
 var gateway = UI_Element_Create("course/class-stream-gateway");	
 UI_Element_Find(gateway, "title").innerHTML = UI_Language_String("course/stream", status + " " + "title");
 UI_Element_Find(gateway, "text").innerHTML  = UI_Language_String("course/stream", status + " " + "text");	
 
 if(status == "streaming")
 {
  // STOP CHECKING
  var check = Core_State_Get("course", "streaming-check");
  clearInterval(check);


  // SETUP AND SHOW "ENTER" BUTTON
  var button           = UI_Element_Find(gateway, "button");
  button.innerHTML     = UI_Language_String("course/stream", "button enter");
  button.style.display = "flex";
  
  var title      = UI_Element_Find(gateway, "title");
  title.style.color = "var(--color-alert)";
  Document_Element_Animate(title, "flash 1.5s ease-in-out infinite");
  
  button.onclick =
  async function(event)
  {
   var data = Core_State_Get("course", ["class-data"]);
   var url  = Safe_Get(data, ["class", "classrom_url"], "");
   
   window.open(url, "classroom", "popup, fullscreen=yes");
  }
  
  
  // DISPLAY AND ALERT
  gateway.appendChild(button);
  
  display.innerHTML = "";
  display.appendChild(gateway);
 
  Media_Audio_Play(Resources_URL("sounds/alert.mp3"));
  
  return true;
 }
 else
 {
  // HIDE "ENTER" BUTTON
  UI_Element_Find(gateway, "button").style.display = "none";
  
  
  // DISPLAY
  display.innerHTML = "";
  display.appendChild(gateway);
 
  return false;
 }
 
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                    C L A S S E S                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

function Courses_Classes_Display() {
  var course = Core_State_Get("courses", "selected-course", {});
  var display = Core_State_Get("courses", "course-display");
  var locale = UI_Language_Current(true);

  var classes = course["classes"] || [];

  var box = UI_Element_Find(display, "course-classes");
  box.innerHTML = "";

  var today = Date_Now();
  var day = 0;
  var last = today;
  for (let i = 0; i < classes.length; ++i) {
    var data = {};
    Object.assign(data, classes[i]);

    data["date"] = Date_Format(
      data["date_start"],
      locale,
      "date-short-weekday"
    );
    data["time"] =
      Date_Portion(data["date_start"], "time-timecode") +
      " - " +
      Date_Portion(data["date_end"], "time-timecode");

    if (data["date"] != last) {
      day++;
      last = data["date"];

      data["day"] = day;
    } else {
      data["day"] = "";
    }

    if (!data["class"]) data["class"] = "";

    if (data["date_start"] < today) var template = "past";
    else var template = "scheduled";
    var element = UI_Element_Create("courses/course-classes-" + template, data);

    if (data["id"]) {
      var icon = UI_Element_Find(element, "view");
      icon.style.display = "flex";
      Document_Element_SetData(icon, "class", data["id"]);
      icon.onclick = Courses_Classes_View;

      if (template == "scheduled" && data["day"]) {
        var cancelIcon = UI_Element_Find(element, "remove");
        cancelIcon.style.visibility = "visible";
        Document_Element_SetData(cancelIcon, "class", data["id"]);
        cancelIcon.onclick = (event) => Courses_Classes_Remove(i);
      }
    }

    if (Numbers_Is_Odd(day)) {
      element.style.backgroundColor = "var(--color-alt-1)";
    } else {
      element.style.backgroundColor = "var(--color-alt-2)";
    }

    box.appendChild(element);
  }
}

async function Courses_Classes_Remove(selectedIndex) {
  const course = Core_State_Get("courses", "selected-course", {});
  const currentClasses = course["classes"];

  const { agree, createMakeupClass } = await Popup_Cancel_Class();

  if (agree) {
    if (createMakeupClass) {
      const scheduleX = course["schedule"].reduce((result, item) => {
        result[item["day"]] = item;
        return result;
      }, {});
      const updatedClasses = [];
      let j = selectedIndex + 1;
      let lastEndDate;

      // CALCULATE NEW CLASS TIME
      const lastClass = currentClasses[currentClasses.length - 1]["date_start"];
      let newClassDate = Date_Add_Days(lastClass, 1);
      while (!scheduleX[Date_Weekday_Get(newClassDate)]) {
        newClassDate = Date_Add_Days(newClassDate, 1);
      }

      for (let i = selectedIndex; i < currentClasses.length; i++) {
        const current = currentClasses[i];
        const date_start = current["date_start"];
        const duration = current["duration"];

        while (
          j < currentClasses.length &&
          Date_Portion(currentClasses[j]["date_start"], "date-only") ===
            Date_Portion(date_start, "date-only")
        ) {
          j++;
        }

        let startDate =
          j < currentClasses.length
            ? Date_Portion(currentClasses[j]["date_start"], "date-only")
            : Date_Portion(newClassDate, "date-only");

        if (
          j < currentClasses.length &&
          lastEndDate &&
          Date_Portion(lastEndDate, "date-only") === startDate
        ) {
          // CASE: ROW ITEM HAS SAME DAY
          startDate = lastEndDate;
        } else {
          const dayofWeek = Date_Weekday_Get(startDate);
          startDate = Date_Add_Minutes(startDate, scheduleX[dayofWeek]["time"]);
        }

        const endDate = Date_Portion(
          Date_Add_Minutes(startDate, duration),
          "no-seconds"
        );
        lastEndDate = endDate;

        // UPDATE TIME FOR CURRENT ROW
        currentClasses[i]["date_start"] = Date_Portion(startDate, "no-seconds");
        currentClasses[i]["date_end"] = endDate;
        updatedClasses.push(currentClasses[i]);
      }

      await Promise.all([
        Core_Api("Class_Update", {
          classes: updatedClasses,
        }),
        Core_Api("Courses_Update_Classes", {
          id: course["id"],
          classes: currentClasses,
        }),
      ]);
    } else {
      // CANCEL CLASS WITHOUT CREATING MAKEUP CLASS
      const seletedClass = currentClasses[selectedIndex];
      const cancelFuncs = [
        Core_Api("Class_Cancel", {
          class_id: seletedClass["id"],
        }),
      ];
      if (
        currentClasses[selectedIndex + 1] &&
        Date_Portion(
          currentClasses[selectedIndex + 1]["date_start"],
          "date-only"
        ) === Date_Portion(seletedClass["date_start"], "date-only")
      ) {
        cancelFuncs.push(
          Core_Api("Class_Cancel", {
            class_id: currentClasses[selectedIndex + 1]["id"],
          })
        );
      }
      currentClasses.splice(selectedIndex, cancelFuncs.length);

      await Promise.all([
        Core_Api("Courses_Update_Classes", {
          id: course["id"],
          classes: currentClasses,
        }),
        ...cancelFuncs,
      ]);
    }

    // UPDATE LOCAL DATA
    course["date_start"] = currentClasses[0]["date_start"];
    course["date_end"] = currentClasses[currentClasses.length - 1]["date_end"];
    course["classes"] = currentClasses;
    Core_State_Set("courses", "selected-course", course);

    // UPDATE UI
    Courses_Classes_Display();
    const courseDisplay = Core_State_Get("courses", "course-display");
    const inputEndDate = UI_Element_Find(courseDisplay, "course-date_end");
    inputEndDate.value = Date_To_Input(course["date_end"] || "");
    const inputStartDate = UI_Element_Find(courseDisplay, "course-date_start");
    inputStartDate.value = Date_To_Input(course["date_start"] || "");
  }
}

async function Popup_Cancel_Class() {
  var promise = new Promise((resolve, reject) => {
    let createMakeupClass = true;
    const content = UI_Element_Create("courses/popup-cancel-class", {
      text: UI_Language_String("courses/popups", "cancel class description"),
    });
    const checkBox = UI_Element_Find(content, "check");
    checkBox.checked = createMakeupClass;
    checkBox.onchange = (event) => {
      createMakeupClass = event.target.checked;
    };
    var button_yes = {
      text: UI_Language_String("core/popups", "button yes"),
      onclick: function (popup) {
        UI_Popup_Close(popup);

        resolve({
          agree: true,
          createMakeupClass,
        });
      },
    };

    var button_no = {
      text: UI_Language_String("core/popups", "button no"),
      onclick: function (popup) {
        UI_Popup_Close(popup);

        resolve(false);
      },
    };

    UI_Popup_Create(
      {
        title: UI_Language_String("courses/popups", "cancel class title"),
        content,
        subtitle: UI_Language_String("courses/popups", "cancel class message"),
        onescape: function (popup) {
          resolve({});
        },
      },

      [button_yes, button_no]
    );
  });

  return promise;
}

async function Courses_Classes_View(event) {
  var element = event.currentTarget;
  var id = Document_Element_GetData(element, "class");

  await Class_Display(id);
}

async function Courses_Classes_Rollout() {
  var course = Core_State_Get("courses", "selected-course", {});

  // 1. COMPLETENESS CHECK :
  // PROGRAM, LEVEL, DURATION AND SCHEDULED DAYS MUST BE ALL SET BEFORE CREATING LESSONS
  for (var field of ["program", "level", "lesson_duration", "schedule"]) {
    if (
      !course[field] ||
      (Array.isArray(course[field]) && course[field].length == 0)
    ) {
      var picture = Resources_URL("images/cover-deny.png");
      var title = UI_Language_String("courses/popups", "allocate cant title");
      var content = UI_Language_String(
        "courses/popups",
        "allocate missing " + field
      );

      await UI_Popup_Alert(title, content, picture);

      Courses_Course_HighlightMissing("allocate", field);

      return;
    }
  }

  // 2. PROCEED TO CREATION
  var classes = [];
  var skipped = [];
  var count = 0;

  // 3. GET LESSON TOPICS SEQUENCE FROM PROGRAM/LEVEL COMBO
  var program = course["program"] || "";
  var level = course["level"] || "";
  var lessons = Core_Config(["programs", program, level], "").split(",");

  // 2. GET GLOBAL TIME-OFF AND COURSE'S CENTER TIME-OFF, COMBINED TO SEE WHICH DATES WE MUST SKIP
  var center = course["center_id"];
  var timeoff_center = await Timeoff_Read(center);
  var timeoff_global = await Timeoff_Read("global");
  var timeoff = timeoff_center.concat(timeoff_global);

  // 3. DETERMINE TEACHER PATTERN
  var teacher_pattern = Core_Config(
    ["course-teacher-configs", course["teacher_config"], "pattern"],
    "native"
  );
  teacher_pattern = teacher_pattern.split(",");

  // 4. CREATE CALENDAR
  var lesson_duration = course["lesson_duration"] / 60;
  var date_start = course["date_start"];
  var schedule = course["schedule"];

  var calendar = Courses_Classes_Calendar(
    date_start,
    schedule,
    lessons,
    lesson_duration,
    timeoff
  );
  console.log(calendar);

  // 5. TURN CALENDAR INTO LESSONS SEQUENCE
  var classes = [];
  var item_index = 0;
  var teacher_id = (typeof course["staff"]["teacher_id"] != "undefined") ? course["staff"]["teacher_id"]["id"] : null;
  var ta1_id =  (typeof course["staff"]["ta1_id"] != "undefined") ? course["staff"]["ta1_id"]["id"] : null;
  var ta2_id =  (typeof course["staff"]["ta2_id"] != "undefined") ? course["staff"]["ta2_id"]["id"] : null;
  var ta3_id =  (typeof course["staff"]["ta3_id"] != "undefined") ? course["staff"]["ta3_id"]["id"] : null;
  for (var item of calendar) {
    var date = item["date"];

    for (var slot of item["session"]) {
      var lesson_id = slot["lesson"];
      var duration = slot["duration"] * 60;
      var date_start = Date_Portion(date, "no-seconds");
      var date_end = Date_Portion(
        Date_Add_Minutes(date_start, duration),
        "no-seconds"
      );
      var teacher_type = teacher_pattern[item_index % teacher_pattern.length];

      classes.push({ date_start, date_end, duration, lesson_id, teacher_type, teacher_id, ta1_id, ta2_id, ta3_id });

      date = date_end;
    }

    item_index++;
  }

  // 6. CALL SERVICE TO ROLL OUT CALENDAR TO CLASSES AND UPDATE COURSE ACCORDINGLY
  // THE SERVICE RETURN CALENDAR MAKEUP FOR THE COURSE (SAME AS Courses_Calendar")

  var section = UI_Element_Find("section-schedule");
  Document_Element_Disable(section, "style-disabled");

  await Core_Api("Courses_Rollout", { id: course["id"], center, classes });

  // 7. DONE. RELOAD
  Courses_Course_Display(course["id"]);
}

async function Courses_Classes_Rollback() {
  var course = Core_State_Get("courses", "selected-course", {});

  // 1. CONFIRM
  var code = course["id"].padStart(6, "0");

  var picture = Resources_URL("images/cover-alert.jpg");
  var title = UI_Language_String("courses/popups", "rollback confirm title");
  var content = UI_Language_String("courses/popups", "rollback confirm text", {
    code,
  });

  var confirm = await UI_Popup_Code(title, content, picture, code);
  if (!confirm) return;

  // 2. CALL ROLLBACK SERVICE
  await Core_Api("Courses_Rollback", { id: course["id"] });

  // 3. RELOAD
  Courses_Course_Display(course["id"]);
}

function Courses_Classes_Calendar(
  date_start,
  schedule,
  lessons,
  lesson_duration,
  timeoff = [],
  content_duration = 2
) {
  // CALCULATE CALENDAR USING SCHEDULE AND TIME OFF
  var calendar = [];

  var date = Date_Portion(date_start, "date-only") + "0000";
  //Doan Nhat Nam 03/07/2023  Fix days error : Round to Ceil
  var days = Math.ceil((content_duration / lesson_duration) * lessons.length);
  var schedule_index = 0;
  //DOAN NHAT NAM 15/11/2023 SETUP FIRST SCHEDULE INDEX
  schedule.sort(function(a, b) {
    return parseInt(a["day"]) - parseInt(b["day"]) ;
  });

  for (let index = 0; index < schedule.length; index++) {
    if(Date_Weekday_Get(date) <= schedule[index]["day"])
    {
      schedule_index = index;
      break;
    }
  }
  //DOAN NHAT NAM 15/11/2023 SETUP FIRST SCHEDULE INDEX
  while (calendar.length < days) {
    // SCHEDULE ITEM
    var day = schedule[schedule_index % schedule.length];

    // FIND NEXT DATE WITH WEEKDAY SPECIFIED BY CURRENT SCHEDULE ITEM
    //Doan Nhat Nam 30/07/2023 set date when schedule.length = 1
    if(schedule.length == 1 && schedule_index > 0) date = Date_Add_Days(date, 1);
    //Doan Nhat Nam 30/07/2023 set date when schedule.length = 1
    while (Date_Weekday_Get(date) != day["day"]) date = Date_Add_Days(date, 1);

    // CHECK THAT THE LESSON WOULDN'T BE AFFECTED BY TIMEOFF
    var date_from =
      Date_Portion(date, "date-only") + Time_From_Minutes(day["time"], "");
    var date_to = Date_Portion(
      Date_Add_Minutes(date_from, Math.floor(lesson_duration * 60)),
      "no-seconds"
    );

    if (Timeoff_Check(date_from, date_to, timeoff)) {
      // NOT AVAILABLE DUE TO TIME OFF
      schedule_index++;
    }
    // DATE AVAILABLE
    else {
      calendar.push(date_from);
      schedule_index++;
    }
  }

  var date = date_start;
  var date_index = 0;
  var lesson_index = 0;
  var lesson_remainder = content_duration;
  var session_remainder = lesson_duration;

  var dates = [];
  var session = [];

  while (lesson_index < lessons.length) {
    // MORE TIME IS LEFT IN THE SESSION THAN IS LEFT IN THE CONTENT BLOCK
    if (session_remainder > lesson_remainder) {
      session.push({
        lesson: lessons[lesson_index],
        duration: lesson_remainder,
      });

      session_remainder = session_remainder - lesson_remainder;

      lesson_index++;
      lesson_remainder = content_duration;
    }
    // MORE TIME IS LEFT IN THE CONTENT BLOCK THAN IS LEFT IN THE SESSION
    else if (lesson_remainder > session_remainder) {
      // ADD A LESSON THAT TAKES ALL THE SESSION REMINDER
      session.push({
        lesson: lessons[lesson_index],
        duration: session_remainder,
      });

      dates.push({
        date: calendar[date_index],
        session,
      });

      date_index++;

      // CARRY OVER LESSON REMAINDER AND START NEW SESSION
      lesson_remainder = lesson_remainder - session_remainder;

      session = [];
      session_remainder = lesson_duration;
    }
    // TIME IN THE CONTENT BLOCK AND SESSION ARE EXACTLY THE SAME
    else {
      session.push({
        lesson: lessons[lesson_index],
        duration: lesson_remainder,
      });

      dates.push({
        date: calendar[date_index],
        session,
      });
      date_index++;

      // START NEW SESSION AND A NEW CONTENT BLOCK TOO
      lesson_remainder = content_duration;
      lesson_index++;

      session = [];
      session_remainder = lesson_duration;
    }
  }
  // Doan Nhat Nam 03/07/2023 : Fix dont add last lesson when lesson duration > content duration
  if(session.length > 0) dates.push({
      date: calendar[date_index],
      session,
    });
  // Doan Nhat Nam 03/07/2023 : Fix dont add last lesson when lesson duration > content duration

  return dates;
}
async function Create_Course_Lock(course){
    var user_id = User_Id();
    var data = {
        "user_id": user_id,
        "course_id": course.id,
        "last_update": Date_Portion(Date_Now(), "no-seconds")
    }
    
    // CREATE
    var id     = await Core_Api("Courses_Lock_New", {data});
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                       C O U R S E S                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//
var f = function(event) {
  Core_Api("Courses_Lock_Delete");
};

async function Courses_OnLoad(module, data)
{
 var page = await Courses_Display();
 
 UI_Element_Find(module, "module-page").appendChild(page);
 window.addEventListener("beforeunload", f);
}




async function Courses_OnShow(module, data)
{

}




async function Courses_OnUnload()
{
  await Core_Api("Courses_Lock_Delete");
  window.removeEventListener("beforeunload",f);
}




async function Courses_Display(options = {})
{
 var display = UI_Element_Create("courses/display");
 Core_State_Set("courses", "display", display);
 
 // ALL CENTERS
 var centers = Array_Organize_ByField(Centers_Available(), "id");
 
 // STORED SEARCH, IF ANY
 var search  = Core_State_Get("courses", "search", {});
 
 // DETERMINE AND STORE CENTERS AVAILABLE TO ME
 Core_State_Set("courses", "centers", centers);
  
 UI_Element_Find(display, "search-name").placeholder = UI_Language_String("courses/module", "input course name");
  
 // CENTERS SELECT
 var select = UI_Element_Find(display, "search-centers");
 Document_Select_OptionsFromObjects(select, centers, "name", false);
 
 if(typeof search["centers"] != "undefined") Document_Select_SelectByValue(select, search["centers"]);
 

 
 // STATUS
 var select = UI_Element_Find(display, "search-status"); 
 Document_Select_AddOption(select, UI_Language_String("courses", "search any"), "");
 Document_Select_AddOption(select, "---", "").disabled = true;
 UI_Select_FromDatapage(select, "courses/course-status");
 
 if(typeof search["status"] != "undefined") select.value = search["status"];
 
 
 
 
 // ALL PROGRAMS
 var programs = Core_Config("programs");
 
 // PROGRAM SELECT
 var select = UI_Element_Find(display, "search-program");
 Document_Select_AddOption(select, UI_Language_String("courses", "search any"), "");
 Document_Select_AddOption(select, "---", "").disabled = true;
 Document_Select_OptionsFromObjects(select, programs, "name", false);
 
 if(typeof search["program"] != "undefined") select.value = search["program"];
 
 select.onchange = 
 function(event)
 {
  var display   = Core_State_Get("courses", "display");
  var element  = event.currentTarget;
  var program  = element.value;
  
  // ALL LEVELS
  var programs = Core_Config("programs", "");
  var levels   = Safe_Get(programs, [program, "levels"], "").split(",");
  
  // LEVEL SELECT
  var select = UI_Element_Find(display, "search-level");
  Document_Select_Clear(select);
  Document_Select_AddOption(select, UI_Language_String("courses", "search any"), "");
  Document_Select_AddOption(select, "---", false).disabled = true;
  Document_Select_OptionsFromValues(select, levels, levels);
  
  //if(typeof search["level"] != "undefined") select.value = search["level"];
 }
 
 
 
 // DATE MODES
 var select   = UI_Element_Find(display, "search-datemode");
 UI_Select_FromDatapage(select, "courses/search-date-modes");
 select.value = "ends-after";
 
 select.onchange = 
 function(event)
 {
  var element = event.currentTarget;
  var display = Core_State_Get("courses", "display");
  
  var input   = UI_Element_Find(display, "search-datefrom");
  if(element.value == "ongoing")
  {
   input.style.display = "none";
  }
  else 
  {
   input.style.display = "flex";
  }	  
 }
 
 
 // DATE 
 var input = UI_Element_Find(display, "search-datefrom");
 if(typeof search["date"] != "undefined") input.value = Date_To_Input(search["date"]); else input.value = Date_To_Input(Date_Now());
 
 
 // TIMEFROM TIMETO
 var select_from = UI_Element_Find(display, "search-timefrom");
 var select_to   = UI_Element_Find(display, "search-timeto");
 var time_start  = Time_To_Minutes(Core_Config(["operations", "timetable", "time-opening"], "01:00"));
 var time_end    = Time_To_Minutes(Core_Config(["operations", "timetable", "time-closing"], "24:00"));
 var time        = time_start;
 while(time <= time_end)
 {
  var text = Time_From_Minutes(time);
  
  Document_Select_AddOption(select_from, text, time);
  Document_Select_AddOption(select_to,   text, time);
  
  time = time + 30;
 }
 
 select_from.value    = time_start;
 select_to.value      = time_end;
 
	
 // DAYS 
 var select = UI_Element_Find(display, "search-days");
 var locale = UI_Language_Current(true);
 for(var day = 1; day<=7; day++)
 {
  var text = Date_Weekday_Name(day, "long", locale);
  Document_Select_AddOption(select, text, day);
 }
 

 // BUTTON SEARCH
 UI_Element_Find(display, "button-course-search").onclick = Courses_Search;
 
 // BUTTON CREATE
 if(User_Can("create-courses"))
 UI_Element_Find(display, "button-course-new").onclick = Courses_New;
 else
 UI_Element_Find(display, "button-course-new").style.display = "none";
 return display;
}






// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          M O R E                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



async function Courses_Search(reload = true)
{
 var module = Core_State_Get("courses", "display");
 
 if(reload)
 {
  // SEARCH
  var name   = UI_Element_Find(module, "search-name").value                         || false;
  var centers   = [UI_Element_Find(module, "search-centers").value]                 || false;
  var program   = UI_Element_Find(module, "search-program").value                   || false;
  var level     = UI_Element_Find(module, "search-level").value                     || false;
  var status    = UI_Element_Find(module, "search-status").value                    || false;
  var date      = Date_From_Input(UI_Element_Find(module, "search-datefrom").value) || false;
  var date_mode = UI_Element_Find("search-datemode").value;
  var loadmore = Core_State_Get("courses","loadmore",false);
  var offset = Core_State_Get("courses","offset",0);
  if(!loadmore) Core_State_Set("courses","offset",0);
  
 
  var search    = {centers, program, level, date, date_mode, status, order:"date_start DESC", options: {limit:100, offset:offset, name}};
  Core_State_Set("courses", "search", search);
 
  var courses   = await Core_Api("Courses_List", search);
  Core_State_Set("courses", "data", courses);
 
  console.log(courses);
 }
 else
 { 
  var courses = Core_State_Get("courses", "data", []);
 }
 
 
 // FILTER THE RESULTS BY DATES/TIMES DATA
 var days      = Document_Input_Get(UI_Element_Find(module, "search-days"));
 var time_from = parseInt(UI_Element_Find(module, "search-timefrom").value);
 var time_to   = parseInt(UI_Element_Find(module, "search-timeto").value);

 var filtered = [];
  
 for(var course of courses)
 {  
  var validate = true;
  
  var schedule = course["schedule"] || [];
  for(var item of schedule)
  {
   // CHECK DAY
   if(days.length > 0 && !days.includes(item["day"])) 
   {
    validate = false;
	break;
   }
	
   // CHECK TIME
   if(!Numbers_Between(parseInt(item["time"]), time_from, time_to))
   {
    console.log("discarded for time " + item["time"] + " not between " + time_from + " and " + time_to);
    validate = false;
	break;
   }
  }
  
  if(validate) filtered.push(course);
 }
 
 var courses = filtered;
 
 await Courses_Search_Display(courses);
}




async function Courses_Search_Display(courses)
{
 var module = Core_State_Get("courses", "display");
 
 // ASSEMBLE RESULTS  
 var list = UI_List_Items(courses, ["style-outlined-accented", "outline-inner"], Courses_Course_Display, undefined,
 function(course)
 { 
  var locale   = UI_Language_Current(true);
  var centers  = Core_Config("centers");
  var programs = Core_Config("programs");
 
  var data              = {};
  
  data["name"]          = course["name"] || "#" + course["id"];
  
  data["date"]          = UI_Language_Date(course["date_start"], "monthdayyear-compact");
  data["center"]        = Safe_Get(centers,  [course["center_id"], "name"], course["center_id"]);
  data["program"]       = Safe_Get(programs, [course["program"], "name"], course["program"]) || UI_Language_String("courses/course-display", "no program");
  data["level"]         = course["level"] || UI_Language_String("courses/course-display", "no level");
  
  data["seats_taken"]   = course["seats"]["taken"] || 0;
  data["seats_total"]   = course["seats"]["total"] || 0;
  
  data["classes_taken"] = course["classes"]["taken"] || 0;
  data["classes_total"] = course["classes"]["total"] || 0;
  
  
  var days  = [];
  for(var item of course["schedule"] || [])
  {
   var day  = Date_Weekday_Name(item["day"], "short", locale);
   var time = Time_From_Minutes(item["time"]);
   
   days.push(day + " " + time);
  }
  data["days"] = days.join(", ");
  
  var element     = UI_Element_Create("courses/course-item", data);
  Document_Element_SetObject(element, "course", course);
  Document_Element_SetData(element, "course_id", course["id"]);
  
  return element;
 });

 Core_State_Set("courses", "courses-list", list);
 
 // ADD LOAD MORE LISTENER
 const handleInfiniteScroll = async (e) => {
   var element = e.target;
   var endOfElement = element.clientHeight + element.scrollTop >= element.scrollHeight - 100 ;
   var loadmore = Core_State_Get("courses", "loadmore", false);
   if (endOfElement && !loadmore) {
     console.log("load more courses");
     Core_State_Set("courses", "loadmore", true);

     var offset =  Core_State_Get("courses","offset",0);
     Core_State_Set("courses","offset",offset + 100);

     await Courses_Search(true);
     
     Core_State_Set("courses", "loadmore", false);
   }
 };

 if(courses.length > 0) list.onscroll = handleInfiniteScroll
 
 // DISPLAY RESULTS
 var container = UI_Element_Find(module, "courses-list"); 
 if(Core_State_Get("courses", "loadmore", false))
 {
  if(courses.length > 0)
  {
    list.children.forEach(element => {
      container.children[0].appendChild(element);
    });

    container.style.visibility = "visible";
  }
  // REMOVE LISTENER SCROLL
  var coursesData = Core_State_Get("courses", "data", []);
  if(coursesData.length == 0) container.children[0].onscroll = null;
 }
 else
 {
  if(courses.length > 0)
  {
    container.innerHTML  = "";
    container.appendChild(list);

    container.style.visibility = "visible";
  }
  else
  {
    container.style.visibility = "hidden";
    container.innerHTML  = "";
  }
 }
 

 // CLEAR COURSE DISPLAY
 UI_Element_Find(module, "course-display").innerHTML = ""; 
}




async function Courses_New()
{
 var title = UI_Language_String("courses/popups", "create course title");
 var text  = UI_Language_String("courses/popups", "create course text");
 var name  = await UI_Popup_Input(title, text);
 
 if(!name) return;
 
 var data           = {};
 data["name"]       = name;
 data["status"]     = "design";
 data["date_start"] = Date_Portion(Date_Now(), "date-only");
 data["center_id"]  = User_Center();
 
 // CREATE
 var id     = await Core_Api("Courses_New", {data});
 var course = await Core_Api("Courses_Read", {id});
 
 // RESET SEARCH, DISPLAY ONLY THIS NEWLY CREATED COURSE
 await Courses_Search_Display([course]);
 
 Courses_Course_Display(id);
}




async function Courses_Course_Display(element)
{
 // GLOBALS
 var locale   = UI_Language_Current(true);
 var centers  = Centers_Available();
 var programs = Core_Config("programs");
 
 
 // READ COURSE
 // IF THE PASSED ELEMENT IS A NUMBER OR STRING, THEN IT'S A DIRECT COURSE_ID
 if(typeof element != "object") 
 {
  var course_id = element;
 }
 else
 // OTHERWISE GET COURSE_ID FROM THE ELEMENT THAT TRIGGERED THE EVENT
 {
  var course_id = Document_Element_GetData(element, "course_id", {});
 }
 // READ
 var course    = await Core_Api("Courses_Read", {id:course_id, info:{all:true}});
 Core_State_Set("courses", "selected-course", course);
 
 // Check edit available
 var usercheck = await Core_Api("Course_Edit_Available",{id:course_id});
 if(usercheck != 0 && usercheck.id != User_Id()){
  
  let name = (usercheck.lastname ?? "") + " " + (usercheck.midname ?? "") + " " + (usercheck.firstname ?? "");
  let message = UI_Element_Create("courses/display-course-lock",{name:name});

  let container       = UI_Element_Find("course-display");
  container.innerHTML = "";
  container.appendChild(message);
  return
 } 
 
 // CREATE DISPLAY 
 var display = UI_Element_Create("courses/course-display", {}, {language:"courses/course-display"});
 Core_State_Set("courses", "course-display", display);

 
 // 1. SETUP CONTROLS
 
 // ID 
 var input      = UI_Element_Find(display, "course-id");
 input.readOnly = true;
 
 input.value    = course["id"];
 
 
 
 // NAME
 var input      = UI_Element_Find(display, "course-name");
 
 input.value    = course["name"] || "";
 input.onchange = Courses_Course_Update;
 
 
 
 // STATUS
 var select      = UI_Element_Find(display, "course-status");
 UI_Select_FromDatapage(select, "courses/course-status");
 
 select.value    = course["status"];
 select.onchange = Courses_Course_StatusChange;
 
 
 // CENTER
 var select      = UI_Element_Find(display, "course-center_id");
 var centers     = Core_State_Get("courses", "centers");
 Document_Select_AddOption(select, "", "");
 Document_Select_OptionsFromObjects(select, centers, "name", false);
 
 select.value    = course["center_id"];
 
 select.onchange = 
 async function(event)
 {
  await Courses_Course_Update(event); 
  await Courses_Course_UpdateRooms();
 }

 
 // PROGRAM
 var select   = UI_Element_Find(display, "course-program");
 var programs = Core_Config("programs");
 Document_Select_AddOption(select, "", "");
 Document_Select_OptionsFromObjects(select, programs, "name", false);
 
 select.value    = course["program"];
 select.onchange = 
 async function(event)
 {
  await Courses_Course_Update(event);
  await Courses_Course_UpdateLevels();
 }
 
 await Courses_Course_UpdateLevels();
 
 
 
 // LEVEL
 var select      = UI_Element_Find(display, "course-level");
 
 select.value    = course["level"];
 select.onchange = Courses_Course_Update;
 
 
 
 // LESSON DURATION
 var select = UI_Element_Find(display, "course-lesson_duration"); 
 UI_Select_FromDatapage(select, Core_Config(["lesson-durations"]));
 Document_Select_InsertOption(select, "", "");
 
 select.value    = course["lesson_duration"];
 select.onchange = Courses_Course_Update; 
 
 
 
 // TEACHER CONFIG
 var select = UI_Element_Find(display, "course-teacher_config"); 
 UI_Select_FromDatapage(select, Core_Config(["course-teacher-configs"]));
 Document_Select_InsertOption(select, "", "");
 
 select.value    = course["teacher_config"];
 select.onchange = Courses_Course_Update; 
 
 
 
 // DATE START
 var input      = UI_Element_Find(display, "course-date_start");
 
 input.value    = Date_To_Input(course["date_start"] || "");
 input.onchange = Courses_Course_Update;
 
 
 // DATE END
 var input      = UI_Element_Find(display, "course-date_end");
 input.readOnly = true;
 
 input.value    = Date_To_Input(course["date_end"] || "");
 input.onchange = Courses_Course_Update;
 
 
 
 // ROLL OUT CLASSES
 var icon       = UI_Element_Find(display, "course-classes-rollout");
 icon.onclick   = Courses_Classes_Rollout;
 
 // ROLL BACK CLASSES
 var icon       = UI_Element_Find(display, "course-classes-rollback");
 icon.onclick   = Courses_Classes_Rollback;

   
 // SEATS
 var select     = UI_Element_Find(display, "course-seats");
 for(var i = 1; i<30; i++)
 {
  Document_Select_AddOption(select, i, i);
 }
 
 select.value    = course["seats"] || 0;
 select.onchange = 
 async function(event)
 {
  await Courses_Course_Update(event);
  await Courses_Course_SetSeats();
 }
 
 
 // ROOMS
 var select      = UI_Element_Find(display, "course-room");
 select.onchange = Courses_Course_SetRoom;
 
 select.value    = course["room"] || "";
 Courses_Course_UpdateRooms();

 
 
 // NOTES
 var input      = UI_Element_Find(display, "course-notes");
 
 input.value    = course["notes"] || "";
 input.onchange = Courses_Course_Update;
   
   
 
 // 2. MORE DISPLAYS
 
 
 // 2A. SCHEDULE
 Courses_Schedule_Display();


 // 2B. STAFF
 Courses_Staff_Display();
 
 
 // 2C. STUDENTS
 Courses_Students_Display();
 

 // 2E. CLASSES
 Courses_Classes_Display();
 
 
 
 
 // 3. ENABLE/DISABLE SECTIONS BASED ON COURSE STATE / STATUS
 Courses_Course_UpdateUI();

 // CREATE COUNT LOG 
 Create_Course_Lock(course);

 // CHECK ROLE CAN EDIT
 if(!User_Can("edit-courses")) Courses_Course_Disable_Edit(display);
 
 var container       = UI_Element_Find("course-display");
 container.innerHTML = "";
 container.appendChild(display);
}




function Courses_Course_Unselect()
{
 UI_Element_Find("course-display").innerHTML = "";
 Core_State_Set("courses", "selected-course", false);
}




function Courses_Course_UpdateUI()
{
 var course   = Core_State_Get("courses", "selected-course", {});
 var display  = Core_State_Get("courses", "course-display");
 
 
 // IF ANY STAFF MEMBER IS SET, DO NOT ALLOW TO CHANGE TEACHER CONFIGURATION
 var select = UI_Element_Find(display, "course-teacher_config"); 
 if(Object_Valid(course["staff"]))
 {
  Document_Element_Disable(select, "style-disabled");
 }
 else
 {
  Document_Element_Restore(select, true);
 }
 
 
 var staff    = UI_Element_Find(display, "section-staff");
 var rollback = UI_Element_Find(display, "course-classes-rollback");
 var rollout  = UI_Element_Find(display, "course-classes-rollout");
 
 if(Courses_Course_Rolledout(course))
 {
  Document_Element_Restore(staff);
  Document_Element_Restore(rollback);
 }
 else
 {
  Document_Element_Disable(staff,    "style-disabled");
  Document_Element_Disable(rollback, "style-disabled");
 }

 Courses_Course_UpdateUI_ByStatus(course);
}


async function Courses_Course_StatusChange(event, element) {
  await Courses_Course_Update(event, element);
  let course   = Core_State_Get("courses", "selected-course", {});
  Courses_Course_UpdateUI_ByStatus(course);
}


function Courses_Course_UpdateUI_ByStatus(course) {
  const display  = Core_State_Get("courses", "course-display");
  const status = course["status"];
  const programm = UI_Element_Find(display, "course-program");
  const level = UI_Element_Find(display, "course-level");
  if(status !== "design") {
    Document_Element_Disable(programm, "style-disabled");
    Document_Element_Disable(level, "style-disabled");
  } else {
    Document_Element_Restore(programm);
    Document_Element_Restore(level);
  }

}

async function Courses_Course_UpdateLevels()
{
 var course   = Core_State_Get("courses", "selected-course", {});
 var display  = Core_State_Get("courses", "course-display");
 var select   = UI_Element_Find(display, "course-level");
  
 var programs = Core_Config("programs");
 var program  = course["program"];
 var levels   = Safe_Get(programs, [program, "levels"], "").split(",");
  
 Document_Select_Clear(select);
 Document_Select_AddOption(select, "", "");
 Document_Select_OptionsFromValues(select, levels, levels);
  
 select.value = course["level"];
}




async function Courses_Course_UpdateRooms()
{
 var course = Core_State_Get("courses", "selected-course", {});
 var rooms  = await Centers_Rooms(course["center_id"]);
 
 var display = Core_State_Get("courses", "course-display");
 var select  = UI_Element_Find(display, "course-room");
 Document_Select_Clear(select);

 Document_Select_AddOption(select, UI_Language_String("courses/rooms", "TBD"), "");
 Document_Select_AddOption(select, UI_Language_String("courses/rooms", "online"), "online");
 Document_Select_AddOption(select, "", "").disabled = true;
 
 for(var room in rooms)
 {
  Document_Select_AddOption(select, room, room);
 }
 
 select.value = course["room"];
}



async function Courses_Course_SetSeats(event)
{
 var course  = Core_State_Get("courses", "selected-course", {});
 
 var display = Core_State_Get("courses", "course-display");
 var element = UI_Element_Find(display, "course-seats");
 var seats   = element.value;
 var now     = Date_Now();
 
 await Core_Api("Classes_Batch_SetField", {field:"seats_total", value:seats, options:{course:course["id"], from:now}});
}


async function Courses_Course_SetRoom(event)
{
 var element = event.currentTarget;
 var room    = element.value;
 var course  = Core_State_Get("courses", "selected-course", {});
 var now     = Date_Now(); 
  
 // NOW DEPENDING ON WHAT ROOM IS CHOOSEN (TBD, ONLINE, OR ONE OF THE ACTUAL ROOMS) SET UP CLASSES
 switch(room)
 {
  case "":
	await Core_Api("Classes_Batch_SetField", {field:"classroom_id", value:null, options:{course:course["id"], from:now}});
	await Core_Api("Classes_Batch_SetField", {field:"online",       value:"0",  options:{course:course["id"], from:now}});
  break;
   
  case "online":
	await Core_Api("Classes_Batch_SetField", {field:"classroom_id", value:"online", options:{course:course["id"], from:now}});
	await Core_Api("Classes_Batch_SetField", {field:"online",       value:"1",      options:{course:course["id"], from:now}});
  break;
  
  default:
    // CONFIRM ROOM IS AVAILABLE THROUGHOUT ALL DATES
	var available = await Core_Api("Courses_Rooms_Available", {id:course["id"]});
		
	if(!available.includes(room))
	{
     if(available.length > 0) var rooms = available.join(", "); else var rooms = UI_Language_String("courses/popups", "room unavailable none");	     
		 
     var title    = UI_Language_String("courses/popups", "room unavailable title"); 
	 var content  = UI_Language_String("courses/popups", "room unavailable text", {rooms}); 
	 var picture  = Resources_URL("images/cover-alert.jpg");

	 var confirm  = await UI_Popup_Confirm(title, content, picture);

	 // IF NOT CONFIRMED, RESTORE ROOM TO PREVIOUS VALUE
	 if(!confirm) 
	 {
	  element.value = course["room"];
	  
	  return;
	 }
	}
	
	await Core_Api("Classes_Batch_SetField", {field:"classroom_id", value:room, options:{course:course["id"], from:now}});
	await Core_Api("Classes_Batch_SetField", {field:"online",       value:"0",  options:{course:course["id"], from:now}});
  break;
 }
 
 // UPDATE COURSE FIELD
 Courses_Course_Update(false, element); 
}



async function Courses_Course_Update(event, element)
{
 var course = Core_State_Get("courses", "selected-course", {});
 var id     = course["id"]; 
 
 Create_Course_Lock(course);
 if(!element) var element = event.currentTarget;
 
 var uid     = Document_Element_GetData(element, "uid");
 var field   = uid.split("-")[1];
 
 switch(element.type)
 {
  case "date":
	var value = Date_From_Input(element.value);
	var json  = false;
  break;
  
  default:
	var value = element.value;
	var json  = false;
  break;
 }
 
 course[field] = value;
 await Core_Api("Courses_Update_Field", {id, field, value, json});
}





async function Courses_Course_SwitchStatus()
{
 var course = Core_State_Get("courses", "selected-course", {});
 var id     = course["id"];
 
 switch(course["status"])
 {
  case "design":
    var title    = UI_Language_String("courses/popups", "status to-open title"); 
	var content  = UI_Language_String("courses/popups", "status to-open text"); 
	var picture  = Resources_URL("images/cover-alert.jpg");

	var confirm  = await UI_Popup_Confirm(title, content, picture);
	if(!confirm) return;
	
	Core_Api("Courses_Update_Field", {id, field:"status", value:"open"});
  break;
  
  case "open":
	var title    = UI_Language_String("courses/popups", "status to-design title"); 
	var content  = UI_Language_String("courses/popups", "status to-design text"); 
	var picture  = Resources_URL("images/cover-alert.jpg");

	var confirm  = await UI_Popup_Confirm(title, content, picture);
	if(!confirm) return;
	
	Core_Api("Courses_Update_Field", {id, field:"status", value:"design"});
  break;
 }
 
 Courses_Course_Display(id);
}





function Courses_Course_Rolledout(course)
{
 var classes   = course["classes"] || [];
 var rolledout = (classes.length > 0 && classes[0]["id"]);
 
 return rolledout;
}



async function Courses_Course_HighlightMissing(operation, missing)
{
 var uid     = Core_Data_Value("courses/popups", operation + " missing " + missing, "highlight");
 var element = UI_Element_Find("course-" + uid);
 
 await Document_Element_Animate(element.parentElement, "flash 1.5s 1.5");
}



async function Courses_Course_Delete(event)
{
 var course = Core_State_Get("courses", "selected-course", {});
 var id     = course["id"];
 
 // CONFIRM
 var code     = String(id).padStart(6, "0");
 var title    = UI_Language_String("courses/popups", "status delete title"); 
 var content  = UI_Language_String("courses/popups", "status delete text", {id:code}); 
 var picture  = Resources_URL("images/cover-alert.jpg");
 
 var confirm = await UI_Popup_Code(title, content, picture, code);
 if(!confirm) return;

 // DELETE FROM COURSES LIST
 var list    = Core_State_Get("courses", "courses-list", list);
 for(var element of list.children)
 {
  var course_id = Document_Element_GetData(element, "course_id", false);
  if(course_id == id)
  {
   element.remove();
   break;
  }
 }
 
 // HIDE DISPLAY
 Courses_Course_Unselect();
 
 // DELETE FROM DATABASE
 await Core_Api("Courses_Delete", {id});
}



function Courses_Course_Disable_Edit(display)
{

  var rollout = UI_Element_Find(display,"course-classes-rollout");
  rollout.parentElement.style.visibility = "hidden";

  var notes = UI_Element_Find(display,"course-notes");
  notes.readOnly = true;
  notes.onchange = null;

  var inputs = display.querySelectorAll("input");
  for (const input of inputs) {
    input.readOnly = true;
    input.onchange = null;
  }

  var selects = display.querySelectorAll("select");
  for (const select of selects) {
    select.disabled = true;
    select.onchange = null;
  }

  var adds = display.querySelectorAll("[data-uid='add']");
  for (const a of adds) {
    a.style.visibility = "hidden";
    a.onclick = null;
  }

  var views = display.querySelectorAll("[data-uid='view']");
  for (const view of views) {
    view.style.visibility = "hidden";
    view.onclick = null;
  }

  var removes = display.querySelectorAll("[data-uid='remove']");
  for (const r of removes) {
    r.style.visibility = "hidden";
    r.onclick = null;
  }

  var deletes = display.querySelectorAll("[data-uid='delete']");
  for (const d of deletes) {
    d.style.visibility = "hidden";
    d.onclick = null;
  }

}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      S C H E D U L E                                           //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Courses_Schedule_Display()
{
 var course   = Core_State_Get("courses", "selected-course", {});
 var display  = Core_State_Get("courses", "course-display");
 var locale   = UI_Language_Current(true);
 
 var box       = UI_Element_Find(display, "course-schedule");
 box.innerHTML = "";

 for(var item of course["schedule"])
 {   
  var day      = Date_Weekday_Name(item["day"], "long", locale);
  var time     = Time_From_Minutes(item["time"]);
  
  var duration = UI_Language_Object(Core_Config(["lesson-durations", item["duration"] || 120]));
  duration     = duration.split(" ");
  duration     = duration[0] + String_Lowercase_Initial(duration[1])[0] + ".";
  
  var element = UI_Element_Create("courses/course-schedule-item", {day, time, duration});
  
  Document_Element_SetObject(element, "schedule", item);
  UI_Element_Find(element, "delete").onclick = Courses_Schedule_Delete;
  
  box.appendChild(element);
 }
 
 // ADD NEW
 var element = UI_Element_Create("courses/course-schedule-add");
 UI_Element_Find(element, "add").onclick = Courses_Schedule_Add;
 box.appendChild(element);
}




async function Courses_Schedule_Delete(event)
{
 var course   = Core_State_Get("courses", "selected-course", {});
 
 var element  = event.currentTarget;
 var parent   = Document_Element_FindParent(element, "item", "schedule");
 var item     = Document_Element_GetObject(parent, "schedule");
 
 Array_Element_Delete(course["schedule"], item);
 await Core_Api("Courses_Update_Field", {id:course["id"], field:"schedule", value:course["schedule"], json:true});
 
 Courses_Schedule_Display();
}




async function Courses_Schedule_Add()
{
 var course = Core_State_Get("courses", "selected-course", {});
 var locale = UI_Language_Current(true);
 
 // SET UP POPUP CONTENT
 var content = UI_Element_Create("courses/popup-schedule-item");
 
 
 // WEEK DAY
 var select = UI_Element_Find(content, "weekday");
 for(var i = 1; i<=7; i++)
 {
  var text  = Date_Weekday_Name(i, "long", locale);
  var value = i;
  
  Document_Select_AddOption(select, text, value);
 }
 
 
 // TIME
 var select = UI_Element_Find(content, "time");
 var from = Time_To_Minutes(Core_Config(["operations", "lessons", "first"]));
 var to   = Time_To_Minutes(Core_Config(["operations", "lessons", "last"]));
 while(from <= to)
 {
  var text  = Time_From_Minutes(from);
  var value = from;
  Document_Select_AddOption(select, text, value);
  
  from = from + 15;
 }
 
 
 // DURATION
 /*
 var select = UI_Element_Find(content, "duration");
 UI_Select_FromDatapage(select, Core_Config(["lesson-durations"]));
 select.value = 120;
 */
 
 // BUTTONS
 var text    = UI_Language_String("courses/popups", "schedule add button");
 var onclick =
 async function(popup)
 {
  var course   = Core_State_Get("courses", "selected-course", {});
  var day      = UI_Element_Find(popup, "weekday").value;
  var time     = UI_Element_Find(popup, "time").value;
  //var duration = UI_Element_Find(popup, "duration").value;
    
  course["schedule"].push({day, time});
  await Core_Api("Courses_Update_Field", {id:course["id"], field:"schedule", value:course["schedule"], json:true});
   
  Courses_Schedule_Display();
  
  UI_Popup_Close(popup);
 }
 
 await UI_Popup_Create({content}, [{text, onclick}], undefined, {escape:true, open:true});  
}



// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                         S T A F F                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Courses_Staff_Display()
{
 var course   = Core_State_Get("courses", "selected-course", {});
 var display  = Core_State_Get("courses", "course-display");
 
 var box       = UI_Element_Find(display, "course-staff");
 box.innerHTML = "";

 var page = Core_Data_Page("courses/course-staff");
 // SCAN ALL STAFF ROLES (NATIVE TEACHER, LOCAL TEACHER ETC.)
 for(var place in page)
 {     
  var user      = Safe_Get(course, ["staff", place], false);
  
  var user_place = UI_Language_Object(page[place]);
  var user_role  = page[place]["role"];
  var user_id    = user["id"];
  var user_name  = user["firstname"] + " " + user["lastname"];
  
  // IS THIS STAFF MEMBER LOADED?
  if(user)
  {
   var element = UI_Element_Create("courses/course-staff-item", {name:user_name});
   
   UI_Element_Find(element, "name").onclick   = Courses_Staff_View;
   UI_Element_Find(element, "delete").onclick = Courses_Staff_Unset;
  }	  
  else
  {
   var element = UI_Element_Create("courses/course-staff-placeholder", {role:user_place});
   
   UI_Element_Find(element, "add").onclick = Courses_Staff_Set;
  }
  
  Document_Element_SetData(element,   "id",    user_id); 
  Document_Element_SetData(element,   "name",  user_name);
  Document_Element_SetData(element,   "place", place);
  Document_Element_SetData(element,   "role",  user_role);
  
  box.appendChild(element);
 }
 
}



async function Courses_Staff_Set(event)
{
 var course = Core_State_Get("courses", "selected-course", {});
 var config = Safe_Get(course, ["config"], []);


 // 1. DETERMINE WHAT PLACE = ROLE ARE WE SELECTING FOR (EXAMPLE:  ta2 = ta)
 var element = event.currentTarget;
 var parent  = Document_Element_FindParent(element, "item", "staff");
 var place   = Document_Element_GetData(parent, "place");
 var role    = Core_Data_Value("courses/course-staff", place, "role");
 var field   = Core_Data_Value("courses/course-staff", place, "field");
 
 

 // 2. COMPLETENESS CHECK: THE COURSE MUST BE WELL COMPILED BEFORE WE CAN ADD STAFF
 for(var check of ["center_id", "classes"])
 {
  if(!Safe_Validate(course[check]))
  {
   var picture = Resources_URL("images/cover-deny.png");
   var title   = UI_Language_String("courses/popups", "addstaff cant title"); 
   var content = UI_Language_String("courses/popups", "addstaff missing " + check);
  
   await UI_Popup_Alert(title, content, picture);
   
   Courses_Course_HighlightMissing("addstaff", check);
  
   return;
  }
 }
 
 
 
 // 3. PACKAGE CLASSES INTO DATE_START DATE_END ARRAY.
 var dates = [];
 for(var item of course["classes"])
 {
  // WE NEED TO TAKE TEACHER TYPE INTO ACCOUNT TO DETERMINE, FOR EACH DATE, IF WE ARE HAVING A NATIVE OR LOCAL TEACHER
  // IF THE TYPE OF EXPECTED TEACHER DOESN'T MATCH THE PATTERN, DO NOT ADD
  var skip = (place == "local_id" && item["teacher_type"] == "native") || (place == "teacher_id" && item["teacher_type"] == "local");
  
  if(!skip)
  {
   var date_start = item["date_start"];
   var date_end   = item["date_end"];
   var id         = item["id"];
  
   // KEEP DATES LINKED TO THEIR CLASS INDEX BECAUSE LATER WE MIGHT NEED TO FLTER THE DATES ARRAY
   dates.push({date_start, date_end, id});
  }
 }

 
 
 // 4. GET CENTERS RELATED TO THIS COURSE'S CENTER (WE CAN PICK STAFF FROM OTHER CENTERS, TOO)
 var centers  = Centers_Related(course["center_id"], true);
 
   
 // 5. CALL API TO LIST AVAILABLE USERS FOR THE PROVIDED DATES
 //var users    = await Core_Api("Users_List_ByCenter", {role:[role], center:centers, fields:"id,firstname,lastname", order:"firstname,lastname"});
 var users = await Core_Api("Users_Available_Teach", {centers, roles:[role], dates, 
 options:
 {
  info:"firstname,lastname",
  utc: true
 }});
 
 users = Object_To_Array(users);
 
 
 // 6. POPUP WITH AVAILABLE USERS
 var user = await Users_Popup_SelectFromList(users, {id:true, firstname:true, lastname:true}, "users/table-fields");
 if(!user) return;
  
  
 // 7. ASSIGN THE SELECTED USER
 
 
 // 7.1 ASSIGN USER TO CLASSES (ONLY CLASSES THAT ARE NOT IN THE PAST)
 var filtered = [];
 var now      = Date_Now();
 for(var item of dates) if(item["date_start"] > now) filtered.push(item);
 
 var classes = Array_From_Fields(filtered, "id");
 await Core_Api("Courses_Staff_Set", {classes, field, user_id:user["id"]});
 
 
 // 7.2 UPDATE COURSE STAFF
 var staff    = course["staff"];
 staff[place] = user;
 await Courses_Staff_Update();
 Courses_Staff_Display();
 
 
 Courses_Course_UpdateUI();
}





async function Courses_Staff_Unset(event, user_id)
{
 var course = Core_State_Get("courses", "selected-course", {});
 var staff  = Safe_Get(course, "staff", {});
 
 if(!user_id)
 {
  // USER ID NOT SPECIFIED = UNSET BY USER CLICK
  var element  = event.currentTarget;
  var parent   = Document_Element_FindParent(element, "item", "staff");
  var place    = Document_Element_GetData(parent, "place");
  var role     = Core_Data_Value("courses/course-staff", place, "role");
  var field    = Core_Data_Value("courses/course-staff", place, "field");
  var name     = Document_Element_GetData(parent, "name");
  var user_id  = Document_Element_GetData(parent, "id", user_id); 
 
 
  // CONFIRMATION POPUP
  var text     = UI_Language_Object(Core_Config(["roles"])[role]);
  var title    = UI_Language_String("courses/popups", "staff delete title", {role:text}); 
  var content  = UI_Language_String("courses/popups", "staff delete text",  {name}); 
  var picture  = Resources_URL("images/cover-logout.png");
 
  var confirm  = await UI_Popup_Confirm(title, content, picture);
  if(!confirm) return;
 }
 else
 {
  // USER ID SPECIFIED = UNSET BY DIRECT CALL FROM SOME OTHER FUNCTION
  
  // FIND WHAT PLACE THIS USER IS OCCUPYING
  var place = false;
  
  for(var key in staff)
  {
   if(staff[key]["id"] == user_id)
   {
	var place = key;
	break;
   }
  }
 }
 
 
 // REMOVE FROM ROLLED OUT CLASSES
 await Core_Api("Courses_Staff_Unset", {id:course["id"], field, user_id});
 
 // UNSET IN STAFF
 if(place) delete staff[place];
 
 // UPDATE STAFF
 await Courses_Staff_Update();
 Courses_Staff_Display();
 
 
 Courses_Course_UpdateUI();
}




async function Courses_Staff_Update()
{
 var course   = Core_State_Get("courses", "selected-course", {});
 
 // UPDATE DB
 var data = {};
 for(var place in course["staff"])
 {
  data[place] = course["staff"][place]["id"];
 }
 
 await Core_Api("Courses_Update_Field", {id:course["id"], field:"staff", value:data, json:true});
}




async function Courses_Staff_View(event)
{
 var element  = event.currentTarget;
 var parent   = Document_Element_FindParent(element, "item", "staff");
 var id       = Document_Element_GetData(parent, "id");
 
 await User_View_Popup(id);
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      S T U D E N T S                                           //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

function Courses_Students_Display()
{
 var course   = Core_State_Get("courses", "selected-course", {});
 var display  = Core_State_Get("courses", "course-display");
 
 var box       = UI_Element_Find(display, "course-students");
 box.innerHTML = "";

 var page = Core_Data_Page("courses/course-staff");
 // SCAN ALL STAFF ROLES (NATIVE TEACHER, LOCAL TEACHER ETC.)
 for(var user of course["students"])
 {     
  var user_name = user["firstname"] + " " + user["lastname"];
  
  var element = UI_Element_Create("courses/course-student-item", {name:user_name});  
   
  UI_Element_Find(element, "view").onclick   = Courses_Students_View;
  UI_Element_Find(element, "delete").style.display = "none";

  Document_Element_SetObject(element, "student", user);
    
  box.appendChild(element);
 }
 
}



async function Courses_Students_Remove(event)
{
 var course   = Core_State_Get("courses", "selected-course", {});
 
 var element  = event.currentTarget;
 var parent   = Document_Element_FindParent(element, "item", "student");
 var student  = Document_Element_GetObject(parent, "student"); 

 var students = course["students"] || [];
 Array_Element_Delete(students, student);

//  await Courses_Students_Update();

 await Core_Api("Courses_Students_Remove", {id:course["id"], student_id: student["id"]});
 Courses_Students_Display();
}




async function Courses_Students_View(event)
{ 
 var element  = event.currentTarget;
 var parent   = Document_Element_FindParent(element, "item", "student");
 var student  = Document_Element_GetObject(parent, "student"); 

 await User_View_Popup(student["id"]);
}




async function Courses_Students_Update()
{
 var course   = Core_State_Get("courses", "selected-course", {});
 
 // UPDATE DB
 var data = [];
 for(var student of course["students"])
 {
  data.push(student["id"]);
 }
 
 await Core_Api("Courses_Update_Field", {id:course["id"], field:"students", value:data, json:true});
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                        D A T A B A S E                                         //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

function Database_View_Create(service, pagerows, fields, language, onselectrow, actions, options = [])
{
 var view = {};
 
 view["service"]     = service;
 view["pagerows"]    = pagerows;
 view["fields"]      = fields;
 view["onselectrow"] = onselectrow;
 view["language"]    = language;
 view["actions"]     = actions;
 view["options"]     = options;
 
 console.log("Created database with view", view);
 
 var display = UI_Element_Create("database/list-standard");
 Document_Element_SetObject(display, "view", view);
 
 console.log(display);
 return display;
}




async function Database_View_Data(display, rows, fields)
{
 var view   = Document_Element_GetObject(display, "view");
 var search = Object_Copy(Document_Element_GetObject(display, "search"));
 
 
 //ROWS
 switch(rows)
 {
  // ALL ADDRESSABLE ROWS
  case "all":
	search["rows"] = false;
	search["page"] = false;
  break;

  // CURRENTLY DISPLAYED
  default:
  break;  
 }
 
 
 
 // FIELDS
 search["fields"] = fields || search["fields"];
 
 
 var data = await Core_Api(view["service"], search);
 return data;
}





async function Database_View_Download(display, rows, fields, filename)
{
 var data = await Database_View_Data(display, rows, fields);
 
 if(data.length == 0) return;
 var file = [];
 
 // HEADER
 var header = Object.keys(data[0]);
 header.join(",");
 file.push(header);
 
 // ROWS
 for(var row of data)
 {
  var line = Object.values(row);
  line     = line.join(",");
  
  file.push(line);
 }
 
 file = file.join("\r\n");
 
 Storage_Data_Download(file, filename, "text/csv");
}





async function Database_View_Query(display, search)
{
 var view = Document_Element_GetObject(display, "view");
  
 search["rows"] = view["pagerows"];
  
 // IF NO PAGE SELECTED, THEN DEFAULT TO PAGE 1 AND REQUEST STATS
 if(!search["page"]) 
 {
  search["page"]  = 0;
  search["stats"] = true;
 }
 
 Document_Element_SetObject(display, "search", search);
 
 
 console.log("Querying database with search", view["service"], search);
 
 // READ FROM DATABASE
 var data = await Core_Api(view["service"], search);
 
 
 
 // IF STATS REQUESTED, UPDATE
 if(search["stats"])
 {
  var stats    = data.pop();
  var count    = stats["count"];
  var pagesize = Module_Config("users", "page");
  var pages    = Math.floor(count / pagesize);
  
  view["count"] = count;
  view["pages"] = pages;  
 }
 
 view["current-page"] = search["page"];
  
  
  
 
 // CREATE TABLE
 var events    = {};
 events["row"] = view["onselectrow"];
 
 // HEADER EVENTS : SORT 
 for(var field in view["fields"])
 {
  events[field] = 
  async function(event)
  {
   element = event.currentTarget;
   field   = Document_Element_GetData(element, "field");
   
   console.log(search);
   console.log(view);
   
   // IF CLICKED THE SAME AGAIN, INVERT ORDER
   if(search["order"].replaceAll(" DESC", "") == field.replaceAll(" DESC", ""))
   {
	if(search["order"].includes(" DESC")) var mode = ""; else var mode = " DESC";
   }
   else
   {
	var mode = "";
   }
   
   search["order"] = field + mode;
   search["page"]  = 0;
   
   await Database_View_Query(display, search);
  }
 }
 
 var table = UI_Table_Data(data, view["fields"], view["language"], events, view["actions"]);
 
 
 // CREATE DISPLAY (VIEW)
 var container       = UI_Element_Find(display, "list");
 container.innerHTML = "";
 container.appendChild(table);
 
 
 // UPDATE PAGE SELECTOR
 var select = UI_Element_Find(display, "page");
 Document_Select_Clear(select);
 
 // IF STATS WERE REQUESTED, UPDATE PAGE SELECTOR ACCORDINGLY
 if(search["stats"])
 {
  for(var i = 0; i <  view["pages"]; i++)
  {
   var option = Document_Select_AddOption(select, UI_Language_String("database/list", "select page", {n:i + 1}), i);
  }
 }
 
 select.value = view["current-page"];
 
 Document_Element_SetObject(select, "display", display); 
 
 // PAGE CHANGE
 select.onchange = 
 async function(event)
 {
  var element = event.currentTarget;
  var display = Document_Element_GetObject(element, "display");
  var view    = Document_Element_GetObject(display, "view");
  var search  = Document_Element_GetObject(display, "search");
  
  search["page"] = element.value;
  
  await Database_View_Query(display, search);
 }
 
 console.log(view["current-page"], view["pages"]);
 

 // NAVIGATION
 
 // PREV
 var element = UI_Element_Find(display, "prev");
 if(parseInt(view["current-page"]) <= 0) Document_Element_Disable(element, "style-disabled"); else Document_Element_Restore(element);
 
 element.onclick = 
 function()
 {
  select.value = parseInt(select.value) -1;
  Document_Event_Trigger(select, "change");
 }

 
 // NEXT
 var element = UI_Element_Find(display, "next");
 if(parseInt(view["current-page"]) >= (view["pages"] - 1)) Document_Element_Disable(UI_Element_Find(display, "next"), "style-disabled");  else Document_Element_Restore(element);
 
 element.onclick = 
 function()
 {
  select.value = parseInt(select.value) +1;
  Document_Event_Trigger(select, "change");
 }
 
 
 // EXPORT
 
 // EXPORT PAGE
 var element = UI_Element_Find(display, "export-page");
 Document_Element_SetObject(element, "display", display);
 
 if(!User_Can("export-page")) Document_Element_Disable(element, "style-disabled");

 element.onclick = 
 function(event)
 {
  var element = event.currentTarget;
  var display = Document_Element_GetObject(element, "display");
  
  var filename = Safe_Get(view, ["service"], false);
  var fields   = Safe_Get(view, ["options", "export_fields"], false);
  
  Database_View_Download(display, view["pagerows"], fields, filename);
 }
 
 
 
 // EXPORT ALL
 var element = UI_Element_Find(display, "export-all");
 Document_Element_SetObject(element, "display", display);
 
 if(!User_Can("export-all")) Document_Element_Disable(element, "style-disabled");
 
 element.onclick = 
 function(event)
 {
  var element = event.currentTarget;
  var display = Document_Element_GetObject(element, "display");
  var view    = Document_Element_GetObject(display, "view");
  
  var filename = Safe_Get(view, ["service"], false);
  var fields   = Safe_Get(view, ["options", "export_fields"], false);
  
  Database_View_Download(display, "all", fields, filename);
 }
 
 
 
 // MORE OPERATIONS
 var operations = Safe_Get(view, ["options", "operations"], {});
 var container  = UI_Element_Find(display, "operations");
 
 for(id in operations)
 {
  var operation = operations[id];
  //REMOVE OLD OPERATION MESSAGE
  var message  = UI_Element_Find(display, id);
  if(typeof message != "undefined") message.remove();
  
  var element   = UI_Element_Create("database/list-operation", {id, icon:operation["icon"]});
   
  Document_Element_SetObject(element, "display", display);
  Document_Element_SetObject(element, "onclick", operation["onclick"]);
   
  element.onclick = 
  function(event)
  {
   var element = event.currentTarget;
   var display = Document_Element_GetObject(element, "display");
   var onclick = Document_Element_GetObject(element, "onclick");
    
   onclick(display);
  }
   
  container.appendChild(element);
 }
 
}async function Dialogue_Read(source)
{
 var dialogue = await Core_Api("Dialogue_Read", {source});
 
 return dialogue;
}




async function Dialogue_Display(dialogue, template = "standard", language = "en")
{
 if(typeof dialogue == "string")
 {
  var dialogue = await Dialogue_Read(dialogue);
 }	 
	
	
 var display   = UI_Element_Create("dialogue/display-" + template);
 var container = UI_Element_Find(display, "lines") || display;
 
 
 var lines = Safe_Get(dialogue, "lines", []) || [];
 for(var line of lines)
 {
  var character = line["character"];
  var text      = UI_Language_Object(line);
  var row       = UI_Element_Create("dialogue/line", {character, text});
  
  var picture   = UI_Element_Find(row, "portrait");
  var portrait  = Resources_URL("characters/" + character + "/portrait.png", "content");
  var def       = Resources_URL("images/default/propic-generic.png");
  Document_Image_Load(picture, [portrait, def]);
  
  container.appendChild(row);
 }
 
 return display;
}

async function Dialogue_Read_Mutiple(sources)
{
 var dialogues = await Core_Api("Dialogue_Read_Mutiple", {sources});
 
 return dialogues;
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                     D I A L O G U E                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Dialogue_OnLoad(module, data)
{
}



async function Dialogue_OnShow(module, data)
{
}




async function Dialogue_OnUnload()
{
}





// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          M O R E                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//
// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                     B O O K  P A G E                                           //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Editor_Bookpage()
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
  
 
 // SET BY ANOTHER MODULE? 
 if(!source)
 {
  var source = Core_State_Get("editor", ["edit-bookpage"], false);
  if(source)
  {
   // UNSET
   Core_State_Set("editor", ["edit-bookpage"], false);
  }
 }
 
 // JUST SET IT TO THE USER'S TEMP FOLDER
 if(!source)
 {
  var user_id = Safe_Get(application, ["user", "id"]); 
  var source  = Resources_URL("temp/editor/bookpage", "user", user_id);
 }

 Core_State_Set("editor", ["current-source"], source);
 
 
 // READ WIP BOOK PAGE 
 var bookpage = await Bookpage_Read(source);
   
 // SET AS CURRENTLY EDITED
 Core_State_Set("editor", ["bookpage", "current"], bookpage);
 
 // STORE AS LAST DIALOGUE EDITED
 Core_Api("User_Config_WriteValue", {file:"editor", section:"wip", field:"bookpage", value:source});


 // SET UP UI
 
 
 // READ AND USE AVAILABLE TEMPLATES
 var templates = await Core_Api("Bookpage_List_Templates");
 
 var select    = UI_Element_Find(submodule, "paragraph-template");
 Document_Select_AddOption(select, "", "");
 
 var items = Safe_Get(templates, "paragraphs", []);
 for(var template of items)
 {
  Document_Select_AddOption(select, template, template);
 }
 
 
 // PAGE TEMPLATE
 var select    = UI_Element_Find(submodule, "page-template");
 Document_Select_AddOption(select, "", "");
 
 var items = Safe_Get(templates, "pages", []);
 for(var template of items)
 {
  Document_Select_AddOption(select, template, template);
 }
 
 select.value    = Safe_Get(bookpage, ["page", "template"], "standard");
 select.onchange = Editor_Bookpage_SetTemplate;
 
 
 
 // STANDARD PARAGRAPHS
 var config   = Core_Data_Page("bookpage/paragraphs");
 var standard = Safe_Get(config, ["info", "paragraphs"], "").split(",");
 
 var select = UI_Element_Find(submodule, "paragraphs-list");
 var size   = 0;
 for(var id of standard)
 {
  var text = UI_Language_Object(config[id] || {});  
 
  Document_Select_AddOption(select, text, id);
  
  size++;
 }
 select.setAttribute("size", size);
 select.onclick  = Editor_Bookpage_SelectParagraph;
 
 
 // PARAGRAPH FIELDS
 for(var field of ["template", "title", "subtitle"])
 {
  var element      = UI_Element_Find(submodule, "paragraph-" + field);
  element.onchange = Editor_Bookpage_UpdateParagraphHeader;
 }
 
 // PARAGRAPH BLOCKS
 for(var n = 1; n <= 6; n++)
 {  
  var element     = UI_Element_Find(submodule, "paragraph-text-" + n);
  
  Document_Element_SetData(element, "n", n);
  
  element.onchange = Editor_Bookpage_UploadParagraphText;
 }
 
 // PARAGRAPH PICTURES
 for(var n = 1; n <= 6; n++)
 {  
  var element     = UI_Element_Find(submodule, "paragraph-picture-" + n);
  
  Document_Element_SetData(element, "n", n);
  
  element.onclick = Editor_Bookpage_UploadParagraphPicture;
 }
 
 // MANUAL RENDER
 UI_Element_Find(submodule, "page-render").onclick =
 async function()
 {
  await Editor_Bookpage_Display();
 }
 
 // SET/UNSET LAYOUT VISUALIZATION
 UI_Element_Find(submodule, "page-layout").onclick =
 async function()
 {
  var layout = Core_State_Get("editor", ["bookpage", "view-layout"], false);
  Core_State_Set("editor", ["bookpage", "view-layout"], !layout);
  
  await Editor_Bookpage_Display();
 }
 
 // WINDOW PREVIEW
 UI_Element_Find(submodule, "page-window").onclick =
 async function()
 {
  var lesson_id = Path_Filename(Path_Folder(Core_State_Get("editor", ["current-source"])));
  window.open("?framework=null&module=bookpage&lesson=" + lesson_id, "_", "popup, width="+ screen.width + ", height=" + screen.height + ", fullscreen=yes");
 }
 
 // DOWNLOAD BOOKPAGE
 UI_Element_Find(submodule, "page-download").onclick =
 async function()
 {
    var lesson = Core_State_Get("editor",["lessons","selected-lesson"],null);
    await Bookpage_Download(lesson);
 }
 
 // FIRST DISPLAY
 Editor_Bookpage_Display();
}





function Editor_Bookpage_SelectParagraph(event)
{ 
 var page      = Core_State_Get("editor", ["bookpage", "current"]);
 
 var select    = UI_Element_Find("paragraphs-list");
 var id        = select.value;
 if(!id) return;
 
 Core_State_Set("editor", ["bookpage", "selected-paragraph"], id);
 
 UI_Element_Find("paragraph-edit").style.visibility = "visible";

 // FIELDS
 for(var field of ["template", "title", "subtitle"])
 {
  var element   = UI_Element_Find("paragraph-" + field);
  element.value = Safe_Get(page, [id, field], "");
 }
 
 // TEXTS
 for(var n = 1; n <= 6; n++)
 {
  var texts = Safe_Get(page, [id, "texts"], []);
  var text  = texts[n] || "";
  
  var element   = UI_Element_Find("paragraph-text-" + n);
  element.value = text;
 }
 
 // PICTURES
 for(var n = 1; n <= 6; n++)
 {
  var pictures = Safe_Get(page, [id, "pictures"], []);
  var picture  = pictures[n] || false;
  
  var element  = UI_Element_Find("paragraph-picture-" + n);
  if(picture) element.src = picture + "?c=" + Date.now(); else element.src = Resources_URL("images/none.png");
 }
}





async function Editor_Bookpage_Display()
{
 var page            = Core_State_Get("editor", ["bookpage", "current"]);
 var layout          = Core_State_Get("editor", ["bookpage", "view-layout"], false);
 var element         = await Bookpage_Render(page, {}, {layout});
 
 var container       = UI_Element_Find("page-preview");
 container.innerHTML = "";
 container.appendChild(element);

 Document_Element_FitContent(element, 0.01);
}



async function Editor_Bookpage_SetTemplate()
{
 var page   = Core_State_Get("editor", ["bookpage", "current"]);
 var path   = Core_State_Get("editor", ["current-source"]);
 
 var select = UI_Element_Find("page-template");
 Safe_Set(page, ["page", "template"], select.value);
 
 var header = page["page"];

 Editor_Bookpage_Display();
 
 await Core_Api("Bookpage_Write_Header", {path, header});
}





async function Editor_Bookpage_UpdateParagraphHeader(event)
{ 
 var page      = Core_State_Get("editor", ["bookpage", "current"]);
 
 var select    = UI_Element_Find("paragraphs-list");
 var id        = select.value;
 if(!id) return;
  

 for(var field of ["template", "title", "subtitle"])
 {
  var element   = UI_Element_Find("paragraph-" + field); 
  Safe_Set(page, [id, field], element.value);
 }
 
 
 // UPDATE
 var path    = Core_State_Get("editor", ["current-source"]);
  
 // UPDATE PARAGRAPH HEADER
 var header = {};
 for(var field in page[id]) header[field] = page[id][field];	
 await Core_Api("Bookpage_Write_ParagraphHeader", {path, id, header});
 
 // DEPENDING ON UPDATED FIELD, PERFORM OTHER ACTIONS
 var element = event.srcElement;
 var uid     = Document_Element_GetData(element, "uid");
 
 Editor_Bookpage_Display();
}




async function Editor_Bookpage_UploadParagraphText(event)
{ 
 var page      = Core_State_Get("editor", ["bookpage", "current"]);
 var path      = Core_State_Get("editor", ["current-source"]);
 
 var element   = event.currentTarget;
 var n         = Document_Element_GetData(element, "n");
 var paragraph = Core_State_Get("editor", ["bookpage", "selected-paragraph"]);
 
 var texts    = Safe_Get(page, [paragraph, "texts"], []);
 var text     = texts[n] || "";
 
 var text = element.value;
 await Core_Api("Bookpage_Write_ParagraphText", {path, paragraph, n, text});
 
 Safe_Set(page, [paragraph, "texts", n], text);
 
 // RENDER PAGE AGAIN
 await Editor_Bookpage_Display();
}






async function Editor_Bookpage_UploadParagraphPicture(event)
{ 
 var page      = Core_State_Get("editor", ["bookpage", "current"]);
 var path      = Core_State_Get("editor", ["current-source"]);
 
 var element   = event.currentTarget;
 var n         = Document_Element_GetData(element, "n");
 var paragraph = Core_State_Get("editor", ["bookpage", "selected-paragraph"]);
 
 var pictures  = Safe_Get(page, [paragraph, "pictures"], []);
 var picture   = pictures[n] || false;
 
 // IF THERE IS ALREADY A PICTURE, DELETE IT
 if(picture)
 {
  Safe_Set(page, [paragraph, "pictures", n], false);
  element.src = Resources_URL("images/none.png");
  
  await Core_Api("Bookpage_Picture_Delete", {path, paragraph, n});
 }
 
 else

 // IF THERE IS NO PICTURE, UPLOAD ONE
 {
  var files = await Storage_File_Select({accept:".jpg"}) || [];
  if(files.length == 0) return;
 
  var dest = path + "/" + paragraph + "-" + n + ".jpg";
  await Storage_Files_Upload(files, "api.php?direct&f=Storage_File_Upload&dest=" + dest, {});
 
  UI_Element_Find("paragraph-picture-" + n).src = dest + "?c=" + Date.now();
 
  Safe_Set(page, [paragraph, "pictures", n], dest);
 }
 
 
 // RENDER PAGE AGAIN
 await Editor_Bookpage_Display();
 
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                         D A T A                                                //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Editor_Data(display, data = {}, config = {}, sources = {}, onchange, onevent)
{
 var editor = UI_Element_Create("editor/data-table");

 Document_Element_SetObject(editor, "display",  display);
 Document_Element_SetObject(editor, "data",     data);
 Document_Element_SetObject(editor, "config",   config);
 Document_Element_SetObject(editor, "sources",  sources); 
 Document_Element_SetObject(editor, "onchange", onchange);
 Document_Element_SetObject(editor, "onevent",  onevent);
 

 // SECTIONS
 for(var section_id in data)
 {
  if(Data_Key_Compliant(section_id, config))
  {
   Editor_Data_Section(editor, section_id);
  }
 }
 

 display.innerHTML = ""; 
 display.appendChild(editor); 
 
 return editor;
}




function Editor_Data_Refresh(editor)
{
 var display  = Document_Element_GetObject(editor, "display");
 var data     = Document_Element_GetObject(editor, "data");
 var config   = Document_Element_GetObject(editor, "config");
 var sources  = Document_Element_GetObject(editor, "sources");
 var onchange = Document_Element_GetObject(editor, "onchange");

 editor       = Editor_Data(display, data, config, sources, onchange);

 return editor;
}





function Editor_Data_Section(editor, section_id)
{  
 var data     = Document_Element_GetObject(editor, "data");
 var config   = Document_Element_GetObject(editor, "config");
 
 var section  = data[section_id];

 
 // CREATE SECTION HEADER
 var section_element = UI_Element_Create("editor/data-section", {id:section_id});
 UI_Element_Find(section_element, "text").innerHTML = section_id;
 
 Document_Element_SetObject(section_element, "data",   data);
 Document_Element_SetObject(section_element, "config", config);
 Document_Element_SetObject(section_element, "editor", editor);
  
  
 // IF THIS SECTION IS ABSENT FROM CONFIG, THEN IT CAN BE DELETED
 if(Safe_Get(config, [section_id]) === undefined)
 {
  var icon              = UI_Element_Find(section_element, "delete");
  icon.style.visibility = "visible";
  icon.onclick          = Editor_Data_DeleteSection;
  
  Document_Element_SetObject(icon, "section", section_element);
 }
  
 editor.appendChild(section_element);
  
    
	
	
 // CREATE ONE ROW FOR EACH ITEM IN THE SECTION
 for(var field_id in section)
 {
  Editor_Data_Field(editor, section_id, field_id);
 }
 
 
 
 // CREATE MENU
 var items = {};
 
 // FIRST MENU SECTION: TEMPLATES
 var templates = Data_Config_Templates(config);
 for(var id in templates)
 {
  var item      = {};
  
  item["icon"]  = "folder-plus";
  item["text"]  = "New " + templates[id]["name"];
  item["state"] = "enabled"; 
  item["func"]  = Editor_Data_NewSection;
  item["tag"]   = editor;
  
  items[id]     = item;
 }

 var menu = UI_Menu_Create("editor-menu", items); 

 var header = UI_Element_Find(section_element, "header");
 Document_Element_SetObject(header, "editor",  editor);
 Document_Element_SetObject(header, "section", section);
 
 UI_Menu_Assign(header, menu, {direction:"bottom right"});
 
 header.onclick = 
 function(event)
 {  
  var element = event.currentTarget;
  var editor  = Document_Element_GetObject(element, "editor");
  var section = Document_Element_GetObject(element, "section");
  
  Document_Element_SetObject(editor, "selectedsection", section);
  console.log(section);
 }
 

 return section_element;
}





function Editor_Data_Field(editor, section_id, field_id)
{
 var data     = Document_Element_GetObject(editor, "data");
 var config   = Document_Element_GetObject(editor, "config");
 var sources  = Document_Element_GetObject(editor, "sources"); 
 var onchange = Document_Element_GetObject(editor, "onchange");
 
 var section = data[section_id];
 var field   = data[section_id][field_id];
 
 var row     = UI_Element_Create("editor/data-row");
   
   
 // DISPLAY FIELD ID
 UI_Element_Find(row, "key").innerHTML = field_id;
    
 
 // IF SECTION_ID CONTAINS NUMBERS, IT MEANS IT CAME FROM A SECTION TEMPLATE, SO DERIVE IT
 var numbers = String_Filter_AllowDigits(section_id);
 if(numbers.length > 0)
 {
  var s_id = String_Filter_AllowAlpha(section_id) + " " + "N".repeat(numbers.length);
 }
 else
 {
  var s_id = section_id;
 }
	
 
 // IF FIELD CONTAINS NUMBERS, IT MEANS IT CAME FROM A FIELD TEMPLATE, SO DERIVE IT
 var numbers = String_Filter_AllowDigits(field_id);
 if(numbers.length > 0)
 {
  var f_id = String_Filter_AllowAlpha(field_id) + " " + "N".repeat(numbers.length);
 }
 else
 {
  var f_id = field_id;
 }
 
 
 
 // DETERMINE FIELD CONFIGURATION 
 var field_config = Object_From_String(Safe_Get(config, [s_id, f_id], ""));
 var type         = field_config["type"] || "text";
   
 var control           = UI_Element_Find(row, type);
 control.style.display = "inline-block";
   
 Document_Element_SetObject(control, "section", section);
 Document_Element_SetData(control,   "field",   field_id);
 Document_Element_SetData(control,   "type",    type);
 Document_Element_SetData(control,   "source",  field_config["source"]);
 
 
 switch(type)
 {
  case "text":
		control.innerHTML = section[field_id];
		//control.onkeyup   = Function_Debounce(Editor_Data_SetValue, 1500);
		control.onblur    = Editor_Data_SetValue;
		
		// FILTER SPECIAL CHARACTERS
		Document_Handler_KeyFilter(control, ['"', '\\']);
  break;
	
  case "select":
	    Document_Select_AddOption(control, "", "");
		 
		if(field_config["values"])
		{
		 var values = field_config["values"].split(",") || [];
		 for(var value of values) Document_Select_AddOption(control, value, value);
		}
		
		// IF SELECT SOURCE TYPE SPECIFIED, GET MEDIA FROM PROVIDED SOURCE
		var source = field_config["source"];
		if(source)
		{
		 // IF SOURCE CONTAINS A SLASH, THEN IT IS IMPLIED IT'S A DATA FILE
	     if(source.includes("/"))
		 {
		  var options = Core_Data_Page(source);
		  for(var value in options)
		  {
		   var text = UI_Language_Object(options[value]);
		   
		   Document_Select_AddOption(control, text, value);
		  }
		 }
		 // OTHERWISE TAKE FROM SPECIFIED SOURCES
		 else
		 {
		  var options = sources[source] || [];
	 
		  for(var option of options)
		  {
	       if(field_config["field-value"]) var value = option[field_config["field-value"]]; else var value = option;
		   if(field_config["field-text"])  var text  = option[field_config["field-text"]];  else var text  = option;
		   
		   Document_Select_AddOption(control, text, value, option);
		  }
		 }
		}
		    
		control.value    = section[field_id];
		control.onchange = Editor_Data_SetValue;
  break;
 }
   
  
 // IF THIS FIELD IS ABSENT FROM CONFIG, THEN IT CAN BE DELETED
 if(Safe_Get(config, [section_id, field_id]) === undefined)
 {
  UI_Element_Find(row, "delete").style.visibility = "visible";
 }
   
   
 // IS THIS FIELD EVEN EDITABLE AT ALL?
 if(field_config["edit"] == "hidden") row.style.display = "none";
   
 var section = UI_Element_Find(editor, "section-" + section_id);
 var fields  = UI_Element_Find(section, "fields");
 
 
 
 // CREATE FIELD CREATION MENU
 var items = {};
 
 // FIRST MENU SECTION: TEMPLATES
 var templates = Data_Config_Templates(config, section_id);
 for(var id in templates)
 {
  var item      = {};
  
  item["icon"]  = "square-plus";
  item["text"]  = UI_Language_String("editor", "data menu new", {id:templates[id]["name"]});
  item["state"] = "enabled"; 
  item["func"]  = Editor_Data_NewField;
  item["tag"]   = editor;
  
  var cid       = section_id + "_" + id;
  items[cid]    = item;
 }
 
 
 // IF THIS FIELD IS COMPLIANT WITH TEMPLATES IN THE CONFIGURATION DATA, THEN IT'S A FIELD THAT CAN BE DELETED
 if(Data_Key_Compliant(field_id, config[section_id], true)) 
 {
  var item = {};
  item["icon"]  = "trash-can";
  item["text"]  = UI_Language_String("editor", "data menu delete", {id:field_id});
  item["state"] = "enabled";
  item["func"]  = Editor_Data_DeleteField;
  item["tag"]   = editor;
  
  var cid         = section_id + "_" + field_id;
  items["break1"] = {};
  items[cid]      = item;
 }
 
 var menu = UI_Menu_Create("section-menu", items); 
 UI_Menu_Assign(row, menu, {direction:"bottom right"});
 
 
 Document_Element_SetData(row, "uid", section_id + "-" + field_id);
 fields.appendChild(row);
 return row;
}




function Editor_Sources_Update(editor, update)
{
 var sources  = Document_Element_GetObject(editor, "sources");
 if(update)
 {
  Object.assign(sources, update);
 }
 
 var controls = Document_Element_FindChildren(editor, "source", undefined, ["recurse"]);
 
 for(var control of controls)
 {
  var source = Document_Element_GetData(control, "source");
  if(sources[source])
  {
   var selected = control.value;   
      
   Document_Select_Clear(control);
   for(var item of sources[source]) Document_Select_AddOption(control, item, item);  

   control.value = selected;   
  }
 }
}




async function Editor_Data_SetValue(event)
{
 var element = event.currentTarget || event.target; 
 var editor  = Document_Element_FindParent(element, "uid", "editor");

 var section = Document_Element_GetObject(element, "section");
 var field   = Document_Element_GetData(element,   "field");
 var type    = Document_Element_GetData(element,   "type");
 
 switch(type)
 {
  case "text":
	var value = element.innerText;
  break;
  
  case "select":
	var value = element.value;
  break;
 }
 
 Safe_Set(section, [field], value);
 
 var onchange = Document_Element_GetObject(editor, "onchange");
 if(onchange) await onchange(editor, section, field);
}



function Editor_Data_FindSection(editor, id)
{
 var section = UI_Element_Find(editor, "section-" + id);
 
 return section;
}




async function Editor_Data_NewSection(item)
{ 
 var id       = Document_Element_GetData(item,     "uid");
 var editor   = Document_Element_GetObject(item,   "tag");
 var data     = Document_Element_GetObject(editor, "data");
 var config   = Document_Element_GetObject(editor, "config");
 var onchange = Document_Element_GetObject(editor, "onchange");
 
 var sections = Object.keys(data);
 var template = String_Numtemplate_Info(id);
 var next     = String_Numtemplate_Next(template, sections);
  
  
 // CREATE NEW DATA SECTION AND SET FIELD VALUES ACCORDING TO CONFIGURATION 
 data[next] = {};
 for(var field in config[id])
 {
  var field_config  = Object_From_String(config[id][field]);
  data[next][field] = field_config["default"] || "";
 }
 var element = Editor_Data_Section(editor, next); 
 
 
 // MAKE SURE THE NEWLY CREATED SECTION IS SEEN
 element.scrollIntoView({behavior: "smooth", block: "end"});
 Document_Element_Animate(element, "flash 1.5s");
 
 if(onchange) await onchange(editor);
 
 return data[next];
}






async function Editor_Data_NewField(item)
{ 
 var id       = Document_Element_GetData(item,     "uid");
 var editor   = Document_Element_GetObject(item,   "tag");
 var data     = Document_Element_GetObject(editor, "data");
 var config   = Document_Element_GetObject(editor, "config");
 var onchange = Document_Element_GetObject(editor, "onchange");
 
 
 // DERIVE SECTION AND FIELD IF FROM THE ITEM ID (PACKED AS SECTION_FIELD)
 var id         = id.split("_");
 var section_id = id[0];
 var field_id   = id[1];
 
 console.log(config);
 console.log(section_id, field_id);
 
 
 // DERIVE NEXT FIELD ID FROM FIELD IT AS TEMPLATE AND ALL OTHER FIELDS ALREADY PRESENT IN THE SECTION
 var section  = data[section_id];
 var fields   = Object.keys(section);
 var template = String_Numtemplate_Info(field_id);
 var next     = String_Numtemplate_Next(template, fields);
  

 // CREATE NEW SECTION FIELD ACCORDING TO CONFIGURATION 
 // GET DEFAULT VALUE
 var field_config = Object_From_String(config[section_id][field_id] || "");
 var value        = field_config["default"] || "";
 
 data[section_id][next] = value; 
 var element = Editor_Data_Field(editor, section_id, next); 
 
 
 // MAKE SURE THE NEWLY CREATED FIELD IS SEEN
 element.scrollIntoView({behavior: "smooth", block: "end"});
 Document_Element_Animate(element, "flash 1.5s");
 
 
 if(onchange) await onchange(editor, section_id, field_id);
}




function Editor_Data_DeleteField(item)
{
 var id       = Document_Element_GetData(item,     "uid");
 var editor   = Document_Element_GetObject(item,   "tag");
 var data     = Document_Element_GetObject(editor, "data");
 var config   = Document_Element_GetObject(editor, "config");
 var onchange = Document_Element_GetObject(editor, "onchange");
 
 
 // DERIVE SECTION AND FIELD IF FROM THE ITEM ID (PACKED AS SECTION_FIELD)
 var id         = id.split("_");
 var section_id = id[0];
 var field_id   = id[1];
 
 
 // REMOVE ROW FROM EDITOR
 var element = UI_Element_Find(editor, section_id + "-" + field_id);
 element.remove();
 
 
 // DELETE FROM DATA
 Safe_Delete(data, [section_id, field_id]);
 
 
 if(onchange) onchange(editor, section_id, field_id);
}






async function Editor_Data_DeleteSection(event)
{
 var icon     = event.currentTarget;
 var section  = Document_Element_GetObject(icon, "section");
 
 var id       = Document_Element_GetData(section,    "uid");
 id           = id.replace("section-", "");
 
 var editor   = Document_Element_GetObject(section,  "editor");
 var data     = Document_Element_GetObject(section,  "data");
 var config   = Document_Element_GetObject(section,  "config");
 var onchange = Document_Element_GetObject(editor,   "onchange");
 var onevent  = Document_Element_GetObject(editor,   "onevent");

 // DELETE FROM EDITOR
 section.remove();
 
 
 // DELETE FROM DATA
 var item = data[id];
 delete data[id]; 
 
 if(onevent)  await onevent(editor, "delete-section", id, item);
 if(onchange) await onchange(editor);
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                     D I A L O G U E                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Editor_Dialogue()
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 
 // SET BY ANOTHER MODULE? 
 if(!source)
 {
  var source = Core_State_Get("editor", ["edit-dialogue"], false);
  if(source)
  {
   // UNSET
   Core_State_Set("editor", ["edit-dialogue"], false);
  }
 }
 
 // JUST SET IT TO THE USER'S TEMP FOLDER
 if(!source)
 {
  var user_id = Safe_Get(application, ["user", "id"]); 
  var source  = Resources_URL("temp/editor/dialogue", "user", user_id);
 }

 Core_State_Set("editor", ["current-source"], source);
 
 // READ WIP DIALOGUE 
 var dialogue = await Dialogue_Read(source);
   
 // SET AS CURRENTLY EDITED
 Core_State_Set("editor", ["dialogue", "dialogue"], dialogue);
 
 // STORE AS LAST DIALOGUE EDITED
 Core_Api("User_Config_WriteValue", {file:"editor", section:"wip", field:"dialogue", value:source});


 // SET UP UI


 // IF NOT LOADED PREVIOUSLY, LOAD AVAILABLE CHARACTERS LIST
 var characters = Core_State_Get("editor", ["characters"]);
 if(!characters)
 {
  var characters = [];
 
  var list = await Core_Api("Characters_List"); 
  for(var id in list)
  {
   var name = list[id];
   characters.push({id, name});
  }

  Core_State_Set("editor", ["characters"],      characters);
 }
 
 
 // EXPORT
 UI_Element_Find(submodule, "dialogue-export").onclick = Editor_Dialogue_Export;
 
 // HEADER EDITOR
 var container = UI_Element_Find(submodule, "dialogue-header");
 var info      = Safe_Get(dialogue, "info", {}) || {};
 var config    = Core_Data_Page("dialogue/template");
 var template  = Data_Page_FromConfig(config);
 var header    = Data_Page_Complete(info, template);
 
 Data_Page_Sanitize(header, config);

 var editor    = Editor_Data(container, header, config, {characters}, Editor_Dialogue_Save);
 Core_State_Set("editor", ["dialogue", "editor"], editor);
 
 
 // SCRIPT EDITOR
 var container       = UI_Element_Find(submodule, "dialogue-script");
 
 var page            = UI_Element_Create("editor/dialogue-script");
 Core_State_Set("editor", ["dialogue", "script"], page);
 
 var languages       = Partner_Languages();
 var ids             = Object.keys(languages);
 var items           = {};
 for(var id of ids)
 {
  var item        = {};
  item["text"]    = UI_Language_Object(languages[id]).toUpperCase();
  item["onclick"] = Editor_Dialogue_SwitchLanguage;
  
  items[id] = item;
 }
 
 var header = UI_Header("languages", items, {selectfirst:true, css:"color-noted"});
 UI_Element_Find(submodule, "dialogue-language").appendChild(header);

 
 container.innerHTML = "";
 container.appendChild(page); 
}




function Editor_Dialogue_SelectCharacters(select, characters)
{
 Document_Select_Clear(select);
 Document_Select_AddOption(select, "", "");
  
 for(var character of characters)
 {
  Document_Select_AddOption(select, character["name"], character["id"]);
 }
}




function Editor_Dialogue_SwitchLanguage(item)
{ 
 var language = Safe_Get(item, ["id"], "en");
 
 var dialogue = Core_State_Get("editor", ["dialogue", "dialogue"]);
 var page     = Core_State_Get("editor", ["dialogue", "script"]);
 
 Editor_Dialogue_DisplayScript(dialogue, page, language);
}





function Editor_Dialogue_UsedCharacters()
{
 var editor     = Core_State_Get("editor", ["dialogue", "editor"]);
 var data       = Document_Element_GetObject(editor, "data", {});
 var characters = Core_State_Get("editor", ["characters"]);
 
 // FILTER ONLY CHARACTERS THAT ARE ACTUALLY USED HERE
 var options = []; 
 var used    = Safe_Get(data, "characters", {});
 for(var i in used)
 {
  var id = used[i];
  
  for(var character of characters) if(character["id"] == id)
  {	  
   options.push(character);
   break;
  }   
 }
 
 return options;
}




function Editor_Dialogue_UpdateScript()
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 // GET USED CHARACTERS
 var characters   = Editor_Dialogue_UsedCharacters(); 

 // UPDATE
 var container = UI_Element_Find(submodule, "dialogue-script");
 var elements  = Document_Element_FindChildren(container, "uid", "character", ["recurse"]);
 for(var select of elements)
 {
  var value    = select.value;
  
  Editor_Dialogue_SelectCharacters(select, characters);
  
  select.value = value;
 }
}




async function Editor_Dialogue_UpdateLine(event)
{
 var element       = event.currentTarget;
 var element       = Document_Element_FindParent(element, "uid", "line");
 
 var data          = Document_Element_GetObject(element, "line");
 var n             = Document_Element_GetData(element, "n");
 var language      = Document_Element_GetData(element, "language");
 
 data["character"] = UI_Element_Find(element, "character").value;
 data[language]    = UI_Element_Find(element, "text").value;
 
 var dialogue      = Core_State_Get("editor", ["dialogue"], []);
 var lines         = dialogue["lines"] || [];
 if(!lines[n])
 {
  lines[n] = data;
 }
  
 var path = Core_State_Get("editor", ["current-source"]);
 await Core_Api("Dialogue_WriteLine", {path, n, data});
}




async function Editor_Dialogue_Save(editor)
{
 Editor_Dialogue_UpdateScript();
 
 var data = Document_Element_GetObject(editor, "data");
 var path = Core_State_Get("editor", ["current-source"]);
 
 // APPARENTLY SOME CONVERSION IS NEEDED
 data = Array_To_Object(data);
 
 await Core_Api("Dialogue_WriteHeader", {path, data});
}




async function Editor_Dialogue_Export()
{
 var path = Core_State_Get("editor", ["current-source"]);
 
 await Core_Api("Dialogue_Export", {path});
 
 var icon = UI_Element_Find("dialogue-export");
 Document_Element_Animate(icon, "flash 1.5s");
}




function Editor_Dialogue_DisplayScript(dialogue, container, language = "en", native = "en")
{ 
 container.innerHTML = "";
 
 // GET USED CHARACTERS
 var characters = Editor_Dialogue_UsedCharacters(); 
 
 var lines = Safe_Get(dialogue, "lines", []) || [];

 for(var n = 0; n<100; n++)
 {
  var line      = lines[n] || {};
  var row       = UI_Element_Create("editor/dialogue-line", {n});
  
  
  // CHARACTER
  var select      = UI_Element_Find(row, "character");
  Editor_Dialogue_SelectCharacters(select, characters);
  select.value    = Safe_Get(line, "character", "");
  select.onchange = Editor_Dialogue_UpdateLine;
    
  // TEXT
  var edit      = UI_Element_Find(row, "text");
  var text      = Safe_Get(line, language, "");
  edit.value    = text;
  edit.onchange = Editor_Dialogue_UpdateLine;
  
  
  // NATIVE
  if(language != native)
  {
   var text         = Safe_Get(line, native, "");
   edit.title       = text;
   edit.setAttribute("placeholder", text);
  }
  
  
  Document_Element_SetObject(row, "line", line);
  Document_Element_SetData(row, "n", n);
  Document_Element_SetData(row, "language", language);
  
  container.appendChild(row);
 }
}
// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                 D O W N L O A D   B O O K                                      //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

function Editor_Downloadbook()
{
    // GET SUBMODULE BODY
    var submodule = Module_Page_Body();

    Core_State_Set("editor", ["downloadbook","display"],submodule);

    var download = UI_Element_Find(submodule, "book-download");
    download.style.display = "none";
    download.onclick = async () =>{
        var download = UI_Element_Find(submodule, "book-download");
        download.classList.add("loader");
        download.style.fontSize = "4px";
        download.style.marginTop = "10px";
        download.style.marginRight = "10px";
        var container = UI_Element_Find(submodule, "book-display");
        var program = UI_Element_Find(submodule, "search-program").value || false;
        var level = UI_Element_Find(submodule, "search-level").value || false;
        var flag = 1;
        var index = 0;
        while (flag) {
            flag = 0;
            var element = container.children[index] || null;
            if(element)
            {
                var element = Editor_Downloadbook_ConfigScale(element);
                var opt = {
                    filename:  program.toUpperCase() + '_' + level.toUpperCase() + '_BOOK(' + element.dataset.displayid +').pdf',
                }
                // CHECK ZOOM PAGE
                var cloneElement = element.cloneNode(true);
                if(document.body.style.zoom != null)
                {
                  cloneElement.style.transformOrigin = "top left";
                  cloneElement.style.marginLeft = (document.body.offsetWidth - document.body.clientWidth)/2;
                  if(document.body.style.zoom == 2 && parseFloat(document.body.clientWidth)  <= 1588)
                  {
                    cloneElement.style.marginLeft = parseFloat(cloneElement.style.marginLeft) + (1588 - parseFloat(document.body.clientWidth))/4;
                  }
                }
                await html2pdf().from(cloneElement).set(opt).save().then(function(){
                    flag = 1;
                    index ++ ;
                });
            }
        }
        download.classList.remove("loader");
        download.style.fontSize = null;
        download.style.marginTop = null;
        download.style.marginRight = null;
    }

    var search  = Core_State_Get("editor", ["downloadbook","search"], {});

    // ALL PROGRAMS
    var programs = Core_Config("programs");

    // PROGRAM SELECT
    var select = UI_Element_Find(submodule, "search-program");
    Document_Select_AddOption(select, UI_Language_String("courses", "search any"), "");
    Document_Select_AddOption(select, "---", "").disabled = true;
    Document_Select_OptionsFromObjects(select, programs, "name", false);
    
    if(typeof search["program"] != "undefined") select.value = search["program"];
    
    select.onchange = 
    function(event)
    {
        var display   = Core_State_Get("editor", ["downloadbook","display"]);
        var element  = event.currentTarget;
        var program  = element.value;
        
        // ALL LEVELS
        var programs = Core_Config("programs", "");
        var levels   = Safe_Get(programs, [program, "levels"], "").split(",");
        
        // LEVEL SELECT
        var select = UI_Element_Find(display, "search-level");
        Document_Select_Clear(select);
        Document_Select_AddOption(select, UI_Language_String("courses", "search any"), "");
        Document_Select_AddOption(select, "---", false).disabled = true;
        Document_Select_OptionsFromValues(select, levels, levels);
        
        if(typeof search["level"] != "undefined") select.value = search["level"];
    }

    var search = UI_Element_Find(submodule, "button-book-search");
    search.onclick = Editor_Downloadbook_Display;
}


async function Editor_Downloadbook_Display()
{
    var programConfig = Core_Config("programs");
    var submodule = Core_State_Get("editor", ["downloadbook","display"]);
    var program = UI_Element_Find(submodule, "search-program").value || false;
    var level = UI_Element_Find(submodule, "search-level").value || false;
    var download = UI_Element_Find(submodule, "book-download");
    download.style.display = "none";

    if(program && level)
    {
        var container = UI_Element_Find(submodule, "book-display");
        container.innerHTML = "";

        var loader = UI_Element_Create("editor/downloadbook-loader");
        container.appendChild(loader);

        var lessons = programConfig[program][level];
        var firstlesson = lessons.split(",")[0];
        var pagesRender = await Multi_Lesson_Bookpage_Render(firstlesson,lessons.split(",").length);
        var arrLesson  = Lesson_Get_From_Config(firstlesson,"lesson");
        var bookpages = await Core_Api("Bookpage_Read_Mutiple", {sources: arrLesson["lesson"] });
        
        container.innerHTML = "";
        var div ;
        var countPage = 0;
        var id = 0;
        for (const lessonName in pagesRender) {
          if(typeof bookpages[lessonName]["page"] != "undefined")
          {
            if(countPage == 0)
            {
            div = document.createElement("div");
            div.innerHTML = ""; 
            div.dataset.displayid = id;
            container.appendChild(div);
            } 
            countPage ++;

            var page = pagesRender[lessonName];
            if(page.firstElementChild){
                page.classList.remove("container-row");
                page.dataset.uid = lessonName;
                div.appendChild(page); 
                Bookpage_Adjust(page);
            }

            if(countPage == 20 )
            {
                countPage = 0;
                id++;
            }
          }
        } 
        download.style.display = "flex";
    }
    
}

function Editor_Downloadbook_ConfigScale(elements)
{
    for (let index = 0; index < elements.children.length; index++) 
    {
        var element = elements.children[index];

        if(element.dataset.scaled) continue;
        else
        {
            element.dataset.scaled = true;

            var vocabulary = UI_Element_Find(element,"vocabulary");
            var dialogue = UI_Element_Find(element,"dialogue");

            if(vocabulary)
            {
                if(typeof vocabulary.children[0].children[0] != "undefined")
                {
                        var scale = vocabulary.children[0].children[0].style.zoom || 1;
                        var width = vocabulary.clientWidth;
                        var height = vocabulary.clientHeight;
                        vocabulary.style.width = width/scale;
                        vocabulary.children[0].style.transform = "scale(" + scale + ")";
                        vocabulary.children[0].style.width = width/scale; 
                        vocabulary.children[0].style.height = height/scale; 
                        vocabulary.children[0].style.transformOrigin = "left top";
                        for (let index = 0; index < vocabulary.children[0].children.length; index++) 
                        {
                            var elementVocab = vocabulary.children[0].children[index];
                            elementVocab.style.zoom = null;
                        }
                }
            } 

            if(dialogue)
            {
                var lines = dialogue.children[0] || null;
                if(typeof lines.children[0] != "undefined")
                {
                    var scale = lines.children[0].style.zoom || 1;
                    var width = dialogue.clientWidth;
                    var height = dialogue.clientHeight;
                    dialogue.style.width = width/scale;
                    lines.style.alignItems = "stretch";
                    lines.style.transform = "scale(" + scale + ")";
                    lines.style.width = width/scale; 
                    lines.style.height = height/scale;  
                    lines.style.transformOrigin = "left top";
                    for (let index = 0; index < lines.children.length; index++) 
                    {
                        var elementDialogue = lines.children[index];
                        elementDialogue.style.zoom = null;
                        elementDialogue.lastElementChild.style.width = "100%";
                        var fontsize = window.getComputedStyle(elementDialogue.lastElementChild.lastElementChild, null).getPropertyValue('font-size');
                        elementDialogue.lastElementChild.lastElementChild.style.fontSize = fontsize*scale + 'px';
                    }
                }
            } 
        }
       
    }
    return elements;
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                         L E S S O N                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Editor_Lesson(submodule)
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 

 // SMART FINDER
 var icon = UI_Element_Find(submodule, "lessons-find");
 icon.onclick = 
 async function()
 {
  var current = Core_State_Get("editor", ["lessons", "selected-lesson"]);
  var id      = await Lesson_Popup_SelectFromCatalog(current);
  if(id)
  {
   Core_State_Set("editor", ["lessons", "selected-lesson"], id);
   Editor_Lesson_Select();
  }
 }

 
 // NEW LESSON
 var icon = UI_Element_Find(submodule, "lessons-new");
 icon.onclick = Editor_Lesson_New;

 // DELETE LESSON
 var icon = UI_Element_Find(submodule, "lessons-delete");
 icon.onclick = Editor_Lesson_Delete;


 // CONTENT PREVIEW AND EDITING HEADER 
 UI_Element_Find(submodule, "lesson-panel-header"); 
 var header = UI_Header("lesson-selector-header",
 {
  cover:
  {
   text :   UI_Language_String("editor", "lesson cover title"),
   icons:   [],
   onclick: Editor_Lesson_DisplayCover
  },
  
  presentation:
  {  
   text :   UI_Language_String("editor", "lesson presentation title"),
   icons:   [{icon:"pen-to-square", onclick:Editor_Lesson_EditPresentation}, {icon:"caret-left", onclick:Editor_Lesson_PresentationPrev}, {icon:"caret-right", onclick:Editor_Lesson_PresentationNext}],
   onclick: Editor_Lesson_DisplayPresentation
  },
  
  test:
  {
   text :   UI_Language_String("editor", "lesson homework title"),
   icons:   [{icon:"pen-to-square", onclick:Editor_Lesson_EditTest}, {icon:"caret-left", onclick:Editor_Lesson_TestPrev}, {icon:"caret-right", onclick:Editor_Lesson_TestNext}],
   onclick: Editor_Lesson_DisplayTest
  },
  
  documents:
  {
   text :   UI_Language_String("editor", "lesson documents title"),
   icons:   [{icon:"file-medical", onclick:Editor_Lesson_UploadDocuments}],  
   onclick: Editor_Lesson_DisplayDocuments 
  },
  
  dialogue:
  {
   text :   UI_Language_String("editor", "lesson dialogue title"),
   icons:   [{icon:"pen-to-square", onclick:Editor_Lesson_EditDialogue}],
   onclick: Editor_Lesson_DisplayDialogue
  },
  
  bookpage:
  {
   text :   UI_Language_String("editor", "lesson bookpage title"),
   icons:   [{icon:"download", onclick:Bookpage_Download},{icon:"pen-to-square", onclick:Editor_Lesson_EditBookpage}, {icon:"book-open", onclick:Editor_Lesson_PreviewBookpage}],
   onclick: Editor_Lesson_DisplayBookpage
  },
  
 }, {selectfirst:false, css:"color-noted"});
 
 UI_Element_Find(submodule, "components-header").appendChild(header);
 Core_State_Set("editor", ["lessons", "components-header"], header);
 
 
 // RETRIEVE LAST LESSON EDITED
 var wip = await Core_Api("User_Config_Read", {file:"editor", section:"wip", field:"lesson"});
 if(wip)
 {
  Core_State_Set("editor", ["lessons", "selected-lesson"], wip);
  await Editor_Lesson_Select();
 }
 else
 {
  await Editor_Lesson_Unselect();
 }
 
 
}





async function Editor_Lesson_Select()
{
 var submodule = Module_Page_Body();
 var id        = Core_State_Get("editor", ["lessons", "selected-lesson"]);
 
 UI_Element_Find(submodule, "lessons-current").value = id;
 
 var path   = "content/lessons/" + id;
 
 Core_State_Set("editor", ["lessons", "presentation"], false);
 Core_State_Set("editor", ["lessons", "test"],         false);
 Core_State_Set("editor", ["documents", "index"],      false); 


 Core_State_Set("editor", ["lessons", "source"], path);
  
 var data     = await Lesson_Load(id, {documents:true});
 var config   = Core_Data_Page("lessons/template");
 var template = Data_Page_FromConfig(config);
 var lesson   = Data_Page_Complete(data, template);
  
 Core_State_Set("editor", ["documents",  "index"], lesson["documents"]); 
  

 // DISPLAY DATA SOURCES
 var outcomes   = await Resources_Outcomes(false, "list");
 var vocabulary = await Resources_Vocabulary(false, "list");
 var documents  = Core_State_Get("editor", ["documents",  "index"], []);
 var projects   = await Resources_Projects(false, "list");
 var developers = Core_State_Get("editor", ["developers", "index"], []); 
 var skills     = await Resources_Skills();

 
 var container  = UI_Element_Find(submodule, "lesson-edit");
 var editor     = Editor_Data(container, lesson, config, {outcomes, vocabulary, documents, projects, developers, skills}, Editor_Lesson_Save, Editor_Lesson_Event);
 Core_State_Set("editor", ["lesson", "editor"], editor);
 

 
 // SHOW PANELS 
 UI_Element_Find(submodule, "lesson-panel-edit").style.visibility       = "visible";
 UI_Element_Find(submodule, "lesson-panel-components").style.visibility = "visible";
 UI_Element_Find(submodule, "lessons-delete").style.display             = "flex";
 UI_Element_Find(submodule, "components-content").innerHTML             = "";
 
 var header = Core_State_Get("editor", ["lessons", "components-header"]);
 var tab    = Core_State_Get("editor", ["lessons", "components-tab"]);
 if(tab) 
 {
  UI_Header_Set(header, tab, true);
 }
 
 
 // STORE AS LAST LESSON EDITED
 Core_Api("User_Config_WriteValue", {file:"editor", section:"wip", field:"lesson", value:id});
 
 //Document_Element_Restore(list);
}






async function Editor_Lesson_Unselect()
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 UI_Element_Find(submodule, "lessons-current").value = "";
 Core_State_Set("editor", ["lessons", "selected-lesson"], false);

 //UI_Element_Find(submodule, "lesson-panel-edit").style.visibility        = "hidden";
 UI_Element_Find(submodule, "lesson-panel-components").style.visibility  = "hidden";
 UI_Element_Find(submodule, "lessons-delete").style.display              = "none";
 UI_Element_Find(submodule, "components-content").innerHTML              = "";
 
 UI_Element_Find(submodule, "lesson-edit").innerHTML = "";
}





async function Editor_Lesson_New()
{
 var title       = UI_Language_String("editor/lesson", "popup new title");
 var placeholder = UI_Language_String("editor/lesson", "popup new placeholder");
 var id          = await UI_Popup_Input(title, undefined, undefined, placeholder);
 if(!id) return;
 
 var path   = "content/lessons/" + id;
 
 var config = Core_Data_Page("lessons/template");
 var data   = Data_Page_FromConfig(config);
 
 await Core_Api("Lesson_Write", {path:path, data:data});
  
 Core_State_Set("editor", ["lessons", "selected-lesson"], id);
 await Editor_Lesson_Select();
 
 Resources_Lessons(true);
}





async function Editor_Lesson_Delete()
{
 var id       = Core_State_Get("editor", ["lessons", "selected-lesson"]); 
  
 var title    = UI_Language_String("editor/lesson", "popup delete title");
 var subtitle = UI_Language_String("editor/lesson", "popup delete subtitle", {id});
 var confirm  = await UI_Popup_Code(title, subtitle, undefined, id);
 if(!confirm) return;
  
 var path = "content/lessons/" + id;
 
 Editor_Lesson_Unselect();
 await Core_Api("Lesson_Delete", {path:path});
 
 Resources_Lessons(true)
}




async function Editor_Lesson_Event(editor, event, id, item)
{
 if(!User_Can("modify-content")) return;
 console.log(id);
 
 switch(event)
 {
  case "delete-section":
	if(id.startsWith("document"))
	{
     var file   = "documents/" + item["file"];
	 var lesson = Core_State_Get("editor", ["lessons", "selected-lesson"]);
	 
     Core_Api("Editor_Lesson_DeleteFile", {lesson, file});
	}
  break;
 }
 
}


async function Editor_Lesson_Save(editor, event, item)
{
 if(!User_Can("modify-content")) return;
  
 var data = Document_Element_GetObject(editor, "data", {});
 
 var id   = Core_State_Get("editor", ["lessons", "selected-lesson"]);
 var path = "content/lessons/" + id;
 
 await Core_Api("Lesson_Write", {path:path, data:data});
}





async function Editor_Lesson_EditComponent(component)
{
 var lesson = Core_State_Get("editor", ["lessons", "selected-lesson"]);
 var source = "content/lessons/" + lesson + "/" + component;
 
 Core_State_Set("editor", "edit-" + component, source);
 Core_State_Set("editor", "back-to", component);
 
 console.log(component);
 await Module_Page_Set(component);
 
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 var back      = UI_Element_Find(submodule, "editor-lesson-back");
 if(back) 
 {
  back.style.display = "flex";

  back.onclick =
  async function()
  {
   await Module_Page_Set("lesson");
   
   var component = Core_State_Get("editor", "back-to");
   var header    = Core_State_Get("editor", ["lessons", "components-header"]);
   
   UI_Header_Set(header, component, true);
  }
 }
 
}







// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                    P R E S E N T A T I O N                                     //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Editor_Lesson_DisplayPresentation()
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 Core_State_Set("editor", ["lessons", "components-tab"], "presentation");
  
 var presentation = Core_State_Get("editor", ["lessons", "presentation"]);
 
 if(!presentation)
 {
  var path         = Core_State_Get("editor", ["lessons", "source"]);
  var presentation = await Presentation_Load(path + "/presentation");
  Core_State_Set("editor", ["lessons", "presentation"], presentation);
 }
 
 var display      = UI_Element_Create("editor/lesson-presentation");

 var container       = UI_Element_Find(submodule, "components-content");
 container.innerHTML = "";
 container.appendChild(display); 
 
 Presentation_Assign(presentation, display);
 Presentation_Slide_Display(presentation["slides"][0]); 
}



async function Editor_Lesson_EditPresentation()
{
 await Editor_Lesson_EditComponent("presentation");
}


function Editor_Lesson_PresentationPrev()
{
 var presentation = Core_State_Get("editor", ["lessons", "presentation"]);
 
 Presentation_Slide_Prev(presentation, true);
} 


function Editor_Lesson_PresentationNext()
{
 var presentation = Core_State_Get("editor", ["lessons", "presentation"]);
 
 Presentation_Slide_Next(presentation, true);
}






// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                             T E S T                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



async function Editor_Lesson_DisplayTest()
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 Core_State_Set("editor", ["lessons", "components-tab"], "test");
 

 var test    = Core_State_Get("editor", ["lessons", "test"]);
 if(!test)
 {
  var path = Core_State_Get("editor", ["lessons", "source"]);
  var test = await Test_Load(path + "/test");
  Core_State_Set("editor", ["lessons", "test"], test);	 
 }
 
 
 var display = UI_Element_Create("editor/lesson-test");
  
 var container       = UI_Element_Find(submodule, "components-content");
 container.innerHTML = "";
 container.appendChild(display); 
 
 Test_Assign(test, UI_Element_Find(display, "lesson-test")); 
 Test_Display(test);
}



async function Editor_Lesson_EditTest()
{
 await Editor_Lesson_EditComponent("test");
}




function Editor_Lesson_TestPrev()
{
 var test = Core_State_Get("editor", ["lessons", "test"]);
 
 Test_Sheet_Prev(test, true);
}




function Editor_Lesson_TestNext()
{
 var test = Core_State_Get("editor", ["lessons", "test"]);
 
 Test_Sheet_Next(test, true);
}






// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                            C O V E R                                           //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Editor_Lesson_DisplayCover()
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 Core_State_Set("editor", ["lessons", "components-tab"], "cover");
 
 var path    = Core_State_Get("editor", ["lessons", "source"])
 var display = UI_Element_Create("editor/lesson-cover");
  
 var container       = UI_Element_Find(submodule, "components-content");
 container.innerHTML = "";
 container.appendChild(display); 
 
 var source  = path + "/cover.png";
 Document_Image_Load(display, [source, ""], true); 
 
 display.onclick = Editor_Lesson_UploadCover;
}




async function Editor_Lesson_UploadCover(event)
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 var files = await Storage_File_Select({accept:".png"}) || [];
 if(files.length == 0) return;
 
 var id   = Core_State_Get("editor", ["lessons", "selected-lesson"]);
 var path = "content/lessons/" + id + "/cover.png";
 await Storage_Files_Upload(files, "api.php?direct&f=Storage_File_Upload&dest=" + path, {});
 
 UI_Element_Find(submodule, "lesson-cover").src = path + "?c=" + Date.now();
}







// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      D O C U M E N T S                                         //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Editor_Lesson_DisplayDocuments()
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 Core_State_Set("editor", ["lessons", "components-tab"], "documents");
 
 var path         = Core_State_Get("editor", ["lessons", "source"])
 var display      = UI_Element_Create("editor/lesson-documents");
 
 var id           = Core_State_Get("editor", ["lessons", "selected-lesson"]);
 var documents    = Core_State_Get("editor", ["documents", "index"]);
 
 if(!documents)
 {
  var documents = await Core_Api("Lesson_Files", {source:id, folder:"documents"});
  Core_State_Set("editor", ["documents", "index"], documents); 
 }
 
 var select       = UI_Element_Find(display, "documents-list");
 select.innerHTML = "";
 
 Document_Select_AddOption(select, "", "");
 for(var document of documents)
 {
  Document_Select_AddOption(select, document, document);
 }
  
 select.onchange = Editor_Lesson_PreviewDocument;
  
 
 var container       = UI_Element_Find(submodule, "components-content");
 container.innerHTML = "";
 container.appendChild(display); 
}





async function Editor_Lesson_UploadDocuments(event)
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 
 var files = await Storage_File_Select({accept:".pdf"}) || [];
 if(files.length == 0) return;
 
 var file = files[0];
 var name = file["name"];
 
 var id   = Core_State_Get("editor", ["lessons", "selected-lesson"]);
 var path = "content/lessons/" + id + "/documents/";
 var dest = path + "/" + name;
 
 await Storage_Files_Upload(files, "api.php?direct&f=Storage_File_Upload&dest=" + dest, {});
 
 // UPDATE INDEX IN MEMORY
 var documents = await Core_Api("Lesson_Files", {source:id, folder:"documents"});
 Core_State_Set("editor", ["documents",  "index"], documents); 
 
 // UPDATE EDITOR SOURCES
 var editor = Core_State_Get("editor", ["lesson", "editor"]);
 Editor_Sources_Update(editor, {documents});
 
 Editor_Lesson_DisplayDocuments();
 
 
 
 // AUTOCREATE DOCUMENT IN LESSON
 var data   = Document_Element_GetObject(editor, "data");
 var config = Document_Element_GetObject(editor, "config");
 
 var section = Data_Section_Add(data, config, "document NN");
 var doc     = section["data"];
 var id      = section["id"];  console.log(id);
 
 doc["file"] = name;
 doc["en"]   = Path_RemoveExtension(name); 
  
 editor = Editor_Data_Refresh(editor);
 Core_State_Set("editor", ["lesson", "editor"], editor);
 
 var section = Editor_Data_FindSection(editor, id);
 section.scrollIntoView({behavior: "smooth", block: "end"});

 // SAVE 
 Editor_Lesson_Save(editor);
}





function Editor_Lesson_PreviewDocument(event)
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 
 var select = UI_Element_Find(submodule, "documents-list");
 var option = Document_Select_SelectedOption(select);
 
 var id   = Core_State_Get("editor", ["lessons", "selected-lesson"]);
 var path = "content/lessons/" + id + "/documents";
 
 var container = UI_Element_Find(submodule, "document-preview");
 container.src = "content/lessons/" + id + "/documents/" + option.value;
}









// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      D I A L O G U E                                           //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



async function Editor_Lesson_DisplayDialogue(event)
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 
 var lesson = Core_State_Get("editor", ["lessons", "selected-lesson"]);
 var source = "content/lessons/" + lesson + "/dialogue";
 
 var dialogue = await Dialogue_Read(source);
 var display  = await Dialogue_Display(dialogue);
 
 var frame    = UI_Element_Create("editor/lesson-dialogue");
 frame.appendChild(display);

 var container       = UI_Element_Find(submodule, "components-content");
 container.innerHTML = "";
 container.appendChild(frame);
}



async function Editor_Lesson_EditDialogue(event)
{
 await Editor_Lesson_EditComponent("dialogue");
}






// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      B O O K   P A G E                                         //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Editor_Lesson_DisplayBookpage(event)
{
 // READ EXTRAS
 var editor     = Core_State_Get("editor", ["lesson", "editor"]);
 var lesson     = Document_Element_GetObject(editor, "data");

 var source     = Core_State_Get("editor", ["lessons", "selected-lesson"]);
 
 var page       = await Lesson_Bookpage_Render(source);
 

 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
  
  
 // RENDER PAGE
 var container       = UI_Element_Find(submodule, "components-content");
 container.innerHTML = "";
 container.appendChild(page);
 
 Document_Element_FitContent(page);
 Bookpage_Adjust(page);
}







async function Editor_Lesson_EditBookpage(event)
{
 await Editor_Lesson_EditComponent("bookpage");
}


async function Editor_Lesson_PreviewBookpage(event)
{
 var lesson_id = Core_State_Get("editor", ["lessons", "selected-lesson"]);
 window.open("?framework=null&module=bookpage&lesson=" + lesson_id, "_", "popup, width="+ screen.width + ", height=" + screen.height + ", fullscreen=yes");
}
// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                       E D I T O R                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Editor_OnLoad(module, data)
{ 
 // CONTENT DEVELOPERS LIST 
 var users = await Core_Api("Users_List_ByRole", {role:["contdev", "contman"]});
 var devs  = [];
 for(var user of users)
 { 
  var dev     = {}; 
  dev["id"]   = user["id"];
  dev["name"] = user["firstname"] + " " + user["lastname"];  
  
  devs.push(dev);
 }
 Core_State_Set("editor", ["developers", "index"], devs);
}





async function Editor_OnShow(module, data)
{
 // FOR THE EDITOR WE DON'T WANT TO PRESERVE LAST PAGE. MODULE PAGE WILL BE TAKEN ONLY FROM URL PARAMETER STRING, IF PRESENT
 Core_State_Set("editor", ["page"], false);
 
 var page = Module_Page_Get(); 
 
 await Editor_SetPage(false, page);
}




async function Editor_OnUnload()
{
}


 
 
 


async function Editor_Download()
{
 var source = Core_State_Get("editor", ["current-source"]);
 var blob   = await Core_Api("Storage_Folder_Download", {dir:source, passthru:true}, {type:"blob"});
 
 var filename = Path_Filename(Path_Folder(source)) + ".zip";
 Storage_Blob_Download(blob, filename);
}





async function Editor_ProcessImage(file, options = {})
{
 if(options["asktype"]) 
 {
  var title   = "";
  var content = "";
  var picture = "";
  
  var transparency = await UI_Popup_Confirm(title, content, picture);
  if(transparency) var format = "image/png"; else var format = "image/jpeg";
 }
 else
 {
  // DETERMINE FORMAT
  var format = options["type"] || file["override-type"] || file["type"] || "image/png";
 }
 
 // TURN FILE INTO DATA URL
 var data = await Storage_File_Read(file, {whole:true});
 
 // RESIZE
 var blob     = await Document_Image_Resize(data, {constraints:{width:800, height:600}, format:format, quality:0.5});
 blob["name"] = file["override-name"] || file["name"];
 
 return blob;
}






async function Editor_Main(submodule)
{
 var pages = Module_Data("editor", "module", "pages");
 var pages = pages.split(","); 
 
 for(var page of pages)
 {
  page = page.trim();
  
  
  var vars         = {};
  vars["pretitle"] = "";
  vars["title"]    = UI_Language_Object(Core_Data_Section("editor/" + page, "title"));
  vars["text"]     = UI_Language_Object(Core_Data_Section("editor/" + page, "text"));
  vars["picture"]  = Resources_URL("images/" + Core_Data_Value("editor/" + page, "media", "card"));
  
  var card     = UI_Element_Create("core/card-vertical-small", vars);
  Document_Element_SetData(card, "page", page);
  card.onclick = Editor_SetPage;
  
  submodule.appendChild(card);
 }
}




async function Editor_SetPage(event, page)
{
 if(event)
 {
  var element = event.currentTarget;
  var page    = Document_Element_GetData(element, "page");
 }
 
 // ANY WORK IN PROGRESS?
 var wip = await Core_Api("User_Config_Read", {file:"editor", section:"wip", field:page});
 if(wip)
 {
  Core_State_Set("editor", ["edit-" + page], wip);
 }
 
 // FLUSH EDITOR FROM CERTAIN SAVED STATES
 Editor_Flush();
 
 // LOAD
 await Module_Page_Set(page);
 
 // QUICK SEMI-HACK TO PROVIDE ALL INPUTS AND TEXT AREAS WITH FILTERING OF SPECIAL CHARACTERS
 var container = UI_Element_Find("module-page");
 var elements  = Document_Element_Children(container, true);
 for(var element of elements)
 {
  var type = element.nodeName.toLowerCase();
  if(type == "input" || type == "textarea") Document_Handler_KeyFilter(element, ['"', '\\']);
 }
}




function Editor_Control_UpdateQuirks(control)
{
	
 // COLOR QUIRK: IF A CONTROL IS A SELECT THAT PICKS FROM COLORS, THEN IT'S FONT COLOR SHOULD REFLECT THE CURRENTLY SELECTED COLOR'S VALUE
 var source =  Document_Element_GetData(control, "source");
 if(source == "colors")
 {
  var option = Document_Select_SelectedOption(control);
  if(option) var color = option.style.color; else var color = "";
  
  control.style.color = color;
 }
 
}



function Editor_Flush()
{
 var state = Core_State_Get("editor");
 var keys  = Object.keys(state);
 
 for(var key of keys) 
 {
  if(key.startsWith("selected-"))
  {
   Core_State_Set("editor", key, false);
  }
 }
}







// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                     R E S O U R C E S                                          //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



async function Editor_Resources_Upload(files, current)
{
 var title    = UI_Language_String("editor", "popup upload title");
 var subtitle = UI_Language_String("editor", "popup upload subtitle");
 var picture  = Resources_URL("images/files.png");
 var popup    = await UI_Popup_Create({title, subtitle, picture}, undefined, undefined, {escape:false, instant:true, open:true})


 var path  = Core_State_Get("editor", ["current-source"], "");
 var added = [];
 

 // OF THE UPLOADED RESOURCES, WE MUST FIRST OF ALL PROCESS IMAGES FOR SIZE REDUCTION
 var upload = [];
 for(var file of files)
 {   
  if(Media_Info_Type(file["name"] || "") == "image")
  {  
   console.log("File " + file["name"] + " needs processing");
   var processed = await Editor_ProcessImage(file);
   
   upload.push(processed);
  }
  else
  {
   upload.push(file);
  }
 }
 
 
 // THEN WE SEND FILES TO THE DESTINATION FOLDER
 await Storage_Files_Upload(upload, "api.php?direct&f=Core_Files_Upload&overwrite=0&path=" + path, {}, 
 // ON FILE UPLOADED
 function(name, data, response)
 {
  var res = Safe_JSON(response["path"]);
  var ext = Path_Extension(name).toLowerCase();
  var src = Path_Filename(res);
  
  added.push(src);
 });
 
 
 // UPDATE IN-MEMORY STRUCTURE
 for(var filename of added)
 {
  if(current.indexOf(filename) == -1) current.push(filename);
 }
 
 
 
 // UPDATE ALL SELECTS THAT MAKE USE OF RESOURCES
 Editor_Resources_UpdateControls(current);
 

 
 // RETURN PATHS FOR ALL THE NEWLY STORED RESOURCES
 UI_Popup_Close(popup);
 return added;
}





function Editor_Resources_UpdateControls(resources, container)
{
 if(!container) var container = document.body;
 
 
 // ALL MEDIA FILE SELECTS
 var selects     = Document_Element_FindChildren(container, "source", "media", ["recurse"]);
 var sources     = resources.filter(
 function(item)
 {
  var type = Media_Info_Type(item);
  return (type == "image" || type == "video" || type == "audio")
 }); 
 
 for(var select of selects)
 {  
  Document_Select_Clear(select);
  Document_Select_AddOption(select, "", "");
  
  for(var source of sources)
  {
   Document_Select_AddOption(select, source, source);
  }
 }
 
 
 // ALL PICTURE/VIDEO FILE SELECTS
 var selects     = Document_Element_FindChildren(container, "source", "pictures", ["recurse"]);
 var sources     = resources.filter(
 function(item)
 {
  var type = Media_Info_Type(item);
  return (type == "image" || type == "video")
 }); 
 
 for(var select of selects)
 {  
  Document_Select_Clear(select);
  Document_Select_AddOption(select, "", "");
  
  for(var source of sources)
  {
   Document_Select_AddOption(select, source, source);
  }
 }

 
 // ALL AUDIO FILE SELECTS
 var selects     = Document_Element_FindChildren(container, "source", "sounds", ["recurse"]);
 var sources     = resources.filter(
 function(item)
 {
  var type = Media_Info_Type(item);
  return (type == "audio")
 }); 
 
 for(var select of selects)
 { 
  Document_Select_Clear(select);
  Document_Select_AddOption(select, "", "");
 
  for(var source of sources)
  {
   Document_Select_AddOption(select, source, source);
  }
 }
}



async function Editor_Resources_Delete(item)
{
 var container = Document_Element_GetObject(item, "tag");
 var selected  = Document_Select_SelectedOption(container);
 if(!selected) return;
 
 var title     = UI_Language_String("editor", "popup delete title");
 var subtitle  = UI_Language_String("editor", "popup delete subtitle", {item:selected.value});
 var picture   = Resources_URL("images/delete.png");
 
 var confirm   = await UI_Popup_Confirm(title, subtitle, picture);
 
 if(confirm)
 {
  var resources = Document_Element_GetObject(container, "resources", resources);
  var path      = Core_State_Get("editor", ["current-source"], "");
  
  // DELETE FROM MEMORY
  Array_Element_Delete(resources, selected.value);
  
  // DELETE FILE
  await Core_Api("Core_File_Delete", {filename:path + "/" + selected.value});
  
  Editor_Resources_Display(resources, container);
 }
}



function Editor_Resources_Display(resources, container)
{
 container.innerHTML = "";
 
 for(var category of ["image", "audio", "video", "pdf"])
 {
  var text        = UI_Language_String("editor/media-types", category);
  var option      = Document_Select_AddOption(container, text, text);
  option.disabled = true;
  Document_CSS_SetClass(option, "text-option-category");
 
  
  for(var resource of resources)
  {
   var type = Media_Info_Type(resource);
   if(type == category)
   {
	Document_Select_AddOption(container, resource, resource);
   }
  }
  
  Document_Select_AddOption(container, "", "");
  option.disabled = true;
 }
 
 // MENU
 var items =
 {
  delete:
  {
   icon:  "trash-can", 
   text:  UI_Language_String("editor", "resources menu delete"),
   state: "enabled",
   tag:   container,
   func:  Editor_Resources_Delete
  }
 }
 
 var menu  = UI_Menu_Create("resources-menu", items);
 UI_Menu_Assign(container, menu);
 
 Document_Element_SetObject(container, "resources", resources);
}





function Editor_Resources_Catalog(resources, catalog)
{
 console.log(resources);
 for(var category of ["image", "audio", "video", "pdf"]) catalog[category] = [];
 
 for(var resource of resources)
 {
  var category = Media_Info_Type(resource);
  catalog[category].push(resource);
 }
 
}



function Editor_Resource_Preview()
{
 var container     = UI_Element_Find("resources-list");
 var preview       = UI_Element_Find("resource-preview");
 preview.innerHTML = "";  
  
 var option = Document_Select_SelectedOption(container);
 if(!option) return;
  
 var file = option.value;
 var type = Media_Info_Type(file);
  
 if(type)
 {
  var element = UI_Element_Create("editor/thumbnail-" + type);
   
  var source = Core_State_Get("editor", ["current-source"]);
  var media  = UI_Element_Find(element, "media");
  media.src  = source + "/" + file;
   
  var preview = UI_Element_Find("resource-preview");
  preview.appendChild(element);
 }
}
// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      O U T C O M E                                             //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



async function Editor_Outcome()
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 
 // ICONS
 UI_Element_Find(submodule, "outcome-new").onclick    = Editor_Outcome_New;
 UI_Element_Find(submodule, "outcome-delete").onclick = Editor_Outcome_Delete;
 UI_Element_Find(submodule, "outcome-find").onclick   = Editor_Outcome_Find;
 
 
 // LIST
 var list = UI_Element_Find(submodule, "outcomes-list");
 list.onclick = Editor_Outcome_Select;


 // DISPLAY TEST SHEETS
 await Editor_Outcome_List();
 
 
 // READ WIP
 var wip = await Core_Api("User_Config_Read", {file:"editor", section:"wip", field:"outcome"});
 if(wip)
 {
  var list = UI_Element_Find(submodule, "outcomes-list");
  Document_Select_SelectByValue(list, wip);
 
  Editor_Outcome_Select();
 }
}



async function Editor_Outcome_List()
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
	
 // STORE LIST FOR LATER USE
 var outcomes = await Resources_Outcomes(false, "list");
 
 // DISPLAY
 var list       = UI_Element_Find(submodule, "outcomes-list");
 list.innerHTML = "";
 for(var outcome of outcomes)
 {
  Document_Select_AddOption(list, outcome, outcome);
 }
 
}



async function Editor_Outcome_Select(event)
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();	

 var list = UI_Element_Find(submodule, "outcomes-list");
 if(list.selectedIndex == -1) return;
 
 var option = list.options[list.selectedIndex];
 var id     = option.value;
 Core_State_Set("editor", ["outcomes", "selected-outcome"], id);
  
 var data     = await Core_Api("Outcome_Read", {folder:"content/outcomes/" + id});
 var config   = Core_Data_Page("outcomes/template");
 var template = Data_Page_FromConfig(config);
 var outcome  = Data_Page_Complete(data, template);
 
 var container = UI_Element_Find(submodule, "outcome-edit");
 var outcomes  = await Resources_Outcomes(false, "list");
 
 Editor_Data(container, outcome, config, {outcomes:outcomes}, Editor_Outcome_Save);
 
 UI_Element_Find(submodule, "outcome-panel-edit").style.visibility = "visible";
 
 // STORE AS LAST OUTCOME EDITED
 Core_Api("User_Config_WriteValue", {file:"editor", section:"wip", field:"outcome", value:id});
}




async function Editor_Outcome_Unselect()
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
	
 var list           = UI_Element_Find(submodule, "outcomes-list");
 list.selectedIndex = -1;

 UI_Element_Find(submodule, "outcome-panel-edit").style.visibility = "hidden";
 
 UI_Element_Find(submodule, "outcome-edit").innerHTML = "";
}





async function Editor_Outcome_New()
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 
 var title       = UI_Language_String("editor/outcome", "popup new title");
 var placeholder = UI_Language_String("editor/outcome", "popup new placeholder");
 var id          = await UI_Popup_Input(title, undefined, undefined, placeholder);
 if(!id) return;
 
 id = id.toLowerCase().trim();
 
 // CHECK OVERWRITING
 var outcomes = await Resources_Outcomes(false, "list");
 if(outcomes.includes(id))
 {
  var title   = UI_Language_String("editor/outcome", "popup overwrite title");
  var text    = UI_Language_String("editor/outcome", "popup overwrite text", {id});
  var picture = Resources_URL("images/cover-alert.jpg");
  var confirm = await UI_Popup_Confirm(title, text, picture);
  
  if(!confirm) return;
 }	 
 
 
 // CREATE
 var path   = "content/outcomes/" + id;
 
 var config = Core_Data_Page("outcomes/template");
 var data   = Data_Page_FromConfig(config);

 await Core_Api("Outcome_Write", {path:path, data:data});
  
 var list   = UI_Element_Find(submodule, "outcomes-list");
 var option = Document_Select_AddOption(list, id, id);
 Document_Select_Sort(list);
 
 // AUTOSELECT
 option.scrollIntoView({behavior: "smooth", block: "center"});
 option.selected = true; 
 list.dispatchEvent(new Event("click"));
}




async function Editor_Outcome_Delete()
{
 var id   = Core_State_Get("editor", ["outcomes", "selected-outcome"]);
 
 var title    = UI_Language_String("editor/outcome", "popup delete title");
 var subtitle = UI_Language_String("editor/outcome", "popup delete subtitle", {id});
 var confirm  = await UI_Popup_Code(title, subtitle, undefined, id);
 if(!confirm) return;
 
 
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 
 var path = "content/outcomes/" + id;
 
 Editor_Outcome_Unselect();

 await Core_Api("Outcome_Delete", {path:path});
 await Resources_Outcomes(true);
 
 var list = UI_Element_Find(submodule, "outcomes-list"); 
 var option = Document_Select_OptionByValue(list, id);
 if(option) option.remove();
}




async function Editor_Outcome_Find()
{
}



async function Editor_Outcome_Save(editor)
{
 if(!User_Can("modify-content")) return;
 
 var data = Document_Element_GetObject(editor, "data", {});
 
 var id   = Core_State_Get("editor", ["outcomes", "selected-outcome"]);
 var path = "content/outcomes/" + id;
 
 await Core_Api("Outcome_Write", {path:path, data:data});
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                        E L E M E N T S                                         //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



function Editor_Presentation_ElementsControls()
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
  
 
 // ELEMENTS
 var list     = UI_Element_Find(submodule, "elements-list");
 list.onclick = Editor_Presentation_SelectElement; 

 
 
 // CREATE SHAPE SELECTION SUBMENU
 var page  = Core_Data_Page("editor/shapes");
 var items = {};
 for(var id in page)
 {
  var item      = {};
  item["id"]    = id;
  
  item["icon"]  = Resources_URL("images/shapes/" + page[id]["src"]);
  item["text"]  = UI_Language_Object(page[id]);
  item["state"] = "enabled";
  item["func"]  = Editor_Presentation_NewShape;
  
  items[id]     = item;
 }
 var shapemenu = UI_Menu_Create("shapes", items);
 
 
 
 // CREATE STYLE SELECTION SUBMENU THROUGH DATAPAGE
 var page       = Core_Data_Page("presentation/styles");
 var categories = Core_Data_Page("presentation/style-categories");
 var stylesmenu = UI_Menu_FromDatapage("element-style", page, "type", categories, Editor_Presentation_SwitchElementStyle);
 
 
 // CREATE TRANSFORMS SUBMENU THROUGH DATAPAGE
 var transmenu = UI_Menu_Create("element-transform", 
 {
  fullpage:
  {
   icon:   "expand", 
   text:   UI_Language_String("editor", "elements menu fullpage"),
   state:  "enabled",
   func:   Editor_Presentation_FullpageElement,
   tag:    "modify"
  },
  
  bringfront:
  {
   icon:   "window-restore", 
   text:   UI_Language_String("editor", "elements menu bringfront"),
   state:  "enabled",
   func:   Editor_Presentation_BringfrontElement,
   tag:    "modify"
  },
  
  sendback:
  {
   icon:   "window-minimize", 
   text:   UI_Language_String("editor", "elements menu sendback"),
   state:  "enabled",
   func:   Editor_Presentation_SendbackElement,
   tag:    "modify"
  }
 });
 
 
 
 // ELEMENTS LIST MENU 
 var menu = UI_Menu_Create("elements-create", 
 // MENU ITEMS
 {
  image:
  {
   icon:    "image", 
   text:    UI_Language_String("editor", "elements menu newimage"),
   state:  "enabled",
   func:    function(menu){Editor_Presentation_NewElement("image", menu)},
   tag:     "new"
  },

  video:
  {
   icon:    "film", 
   text:    UI_Language_String("editor", "elements menu newvideo"),
   state:  "enabled",
   func:    function(menu){Editor_Presentation_NewElement("video", menu)},
   tag:     "new"
  },

  text:
  {
   icon:    "align-justify", 
   text:    UI_Language_String("editor", "elements menu newtext"),
   state:  "enabled",
   func:    function(menu){Editor_Presentation_NewElement("text", menu)},
   tag:     "new"
  },
  
  shape:
  {
   icon:    "shapes",
   text:    UI_Language_String("editor", "elements menu newshape"),
   state:   "enabled",
   submenu: shapemenu,
   tag:     "new"
  },
  
  input:
  {
   icon:   "grip-lines", 
   text:   UI_Language_String("editor", "elements menu newinput"),
   state:  "enabled",
   func:   function(menu){Editor_Presentation_NewElement("input", menu)},
   tag:    "new"
  },
  
  iframe:
  {
   icon:   "person-through-window", 
   text:   UI_Language_String("editor", "elements menu newiframe"),
   state:  "enabled",
   func:   function(menu){Editor_Presentation_NewElement("iframe", menu, {url:"about:blank", src:"about:blank"})},
   tag:    "new"
  },
  
  paste:
  {
   icon:    "paste",
   text:    UI_Language_String("editor", "elements menu paste"),
   state:   "enabled",
   func:    Editor_Presentation_PasteElement,
   tag:     "new"
  },
  
  
  break0:
  {
   tag: "new"
  },
  
  
  resources:
  {
   icon:    "folder-open",
   text:    UI_Language_String("editor", "elements menu addresources"),
   state:  "enabled",
   func:    Editor_Presentation_AddResources,
   tag:     "new"
  },

  media:
  {
   icon:    "folder-open",
   text:    UI_Language_String("editor", "elements menu media"),
   state:  "enabled",
   func:    Editor_Presentation_SetElementMedia,
   tag:     "modify"
  },
  
  style:
  {
   icon:    "paint-roller",
   text:    UI_Language_String("editor", "elements menu style"),
   state:   "enabled",
   submenu: stylesmenu,
   tag:     "modify"
  },
  
  trans:
  {
   icon:    "wrench",
   text:    UI_Language_String("editor", "elements menu transform"),
   state:   "enabled",
   submenu: transmenu,
   tag:     "modify"
  },
  
  break1:
  {
   tag: "modify"
  },
  
  duplicate:
  {
   icon:    "clone",
   text:    UI_Language_String("editor", "elements menu duplicate"),
   state:   "enabled",
   func:    Editor_Presentation_DuplicateElement,
   tag:     "modify"
  },
  
  copy:
  {
   icon:    "copy",
   text:    UI_Language_String("editor", "elements menu copy"),
   state:   "enabled",
   func:    Editor_Presentation_CopyElement,
   tag:     "modify"
  },
  
  break2:
  {
   tag: "modify"
  },
  
  delete:
  {
   icon:    "trash-can", 
   text:    UI_Language_String("editor", "elements menu delete"),
   state:  "enabled",
   func:    Editor_Presentation_DeleteElement,
   tag:     "modify"
  }
 },
 
 // MENU EVENTS
 {
  onshow: Editor_Presentation_MenuElements
 }); 
 
 
 
 // ASSIGN MENU TO ELEMENTS LIST AND MAIN DISPLAY
 UI_Menu_Assign(list,    menu, {direction:"bottom right"});
 
 var display = UI_Element_Find(submodule, "slides-slide");
 UI_Menu_Assign(display, menu, {direction:"bottom right"});
 
 

 // ELEMENTS PROPERTIES HANDLER
 var container = UI_Element_Find(submodule, "element-properties");
 var elements  = Document_Element_FindChildren(container, "uid", undefined, ["recurse"]);
 for(var element of elements)
 {
  var id = Document_Element_GetData(element, "uid");
  id = id.split("-");
  
  if(id[0] == "element")
  {
   element.onchange = Editor_Presentation_UpdateElement;
  }
 }	

}







function Editor_Presentation_ListElements()
{ 
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 
 var slide = Core_State_Get("editor", ["selected-slide"]);
 if(!slide) return;
 
 
 // DISPLAY THIS SLIDE'S ITEMS
 var list       = UI_Element_Find(submodule, "elements-list");
 list.innerHTML = "";
 
 var elements = slide["elements"];
 
 for(var element of elements)
 {
  var value  = Document_Element_GetData(element, "uid");
  var text   = Document_Element_GetData(element, "name") || value; 
  var option = Document_Select_AddOption(list, text, value, element);
  
  // LINK
  Document_Element_SetObject(option, "element", element);
 }
}





function Editor_Presentation_UnselectElement()
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 
 // UPON UNSELECTING, SAVE SELECTED ELEMENT FIRST
 var selected_element = Core_State_Get("editor", ["selected-element"]);
 if(selected_element) Editor_Presentation_SaveElement(selected_element);
 
 // UNSELECT IN STATE
 Core_State_Set("editor", ["selected-element"], undefined);
	
 // UNSELECT IN ELEMENTS LIST
 var list = UI_Element_Find(submodule, "elements-list");
 list.selectedIndex = -1;

 // HIDE PANELS THAT ARE NOT SUPPOSED TO BE VISIBLE IF NO ELEMENT IS SELECTED
 UI_Element_Find(submodule, "element-properties").style.visibility = "hidden"; 

 // REFLECT UN-SELECTION ON SLIDE 
 Editor_Presentation_UpdateDisplayHelpers();
}





function Editor_Presentation_SelectElement(event)
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 var list   = UI_Element_Find(submodule, "elements-list");
 var option = Document_Select_SelectedOption(list);
 if(!option) return;
 
 var element = Document_Element_GetObject(option, "element");
 if(!element) return;
 
 // SAVE OLD SELECTED BEFORE CHANGE ELEMENT
 var elementSelected = Core_State_Get("editor",["selected-element"]);
 if(typeof elementSelected != "undefined" && elementSelected != element)
 Editor_Presentation_SaveElement(elementSelected, true);
 
 // REFLECT SELECTED ELEMENT CHANGE
 Core_State_Set("editor", ["selected-element"], element);
 
 
 // POPULATE ELEMENT PROPERTIES PANEL AND REVEAL IT
 Editor_Presentation_DisplayElement();
 

 Editor_Presentation_UpdateDisplayHelpers();
}






function Editor_Presentation_DisplayElement()
{ 
 // GET SELECTED ELEMENT INFO
 var element = Core_State_Get("editor", ["selected-element"]);
 if(!element) return;

 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 var container = UI_Element_Find(submodule, "element-properties");
 
 
 // FILTER CONTROL VISIBILITY BASED ON ELEMENT TYPE
 var type      = Document_Element_GetData(element, "type");
 var controls  = Document_Element_FindChildren(container, "filter", undefined, ["recurse"]);
 
 for(var control of controls)
 {
  var types = Document_Element_GetData(control, "filter");
  if(types)
  {
   if(types.indexOf(type) == -1) control.style.display = "none"; else control.style.display = "flex";
	   
  }
  else
  {
   control.style.display = "flex";
  }
 }
 
 
 // POPULATE CONTROLS
 var controls  = Document_Element_FindChildren(container, "uid", undefined, ["recurse"]);
 for(var control of controls)
 {
  // GET WHAT ELEMENT PROPERTY THIS CONTROL... CONTROLS
  var id     = Document_Element_GetData(control, "uid");
  var field  = id.split("-");  
  field      = field.slice(1, field.length).join("-");

  
  // STANDARD FIELD?
  if(PRESENTATION_FIELDS_STANDARD.includes(field))
  {   
   var style = element.style[field];
	 
   // TRICK/FIX
   if(field == "fontFamily") style = style.replaceAll('"', '');
	 
   control.value = style;
  }
  else
  // OTHER CASES
  switch(field)
  {
   // DATA
   case "name":
   case "moveable":
   case "visible":
   case "readonly":
   case "onclick_animation":
   case "ondrop_animation":
   case "onshow_animation":
   case "onhide_animation":
   case "onclick_sound":
   case "ondrop_sound":
   case "onshow_sound":
   case "onhide_sound":
	control.value = Document_Element_GetData(element, field);
   break;
      
   
   case "style":
	for(var option of control.options)
	{
     option.selected = option.value && (element.classList.contains(option.value));
	}
   break;
   
   
   case "innerHTML":
   case "value":
	control.value = element[field] || "";
   break;
   
  
   case "src":
	control.value = URL_Decode(Path_Filename(element.src || ""));
   break;
   
   
   case "url":
	control.value = URL_Decode(element.src);
   break;
   
   // STANDARD
   default:
	control.value = element[field] || "";
   break;
      
  }
  
  Editor_Control_UpdateQuirks(control);
 }	 
 
 
 UI_Element_Find(submodule, "element-properties").style.visibility = "visible";
}





async function Editor_Presentation_UpdateElement(event)
{	 
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 
 // GET CURRENT PRESENTATION 
 var presentation = Core_State_Get("editor", ["presentation"], {});

 // GET CONTROL INFO AND PROPERTY THAT IT AFFECTS
 var control = event.currentTarget;
 var id      = Document_Element_GetData(control, "uid");
 
 
 // GET SELECTED SLIDE INFO
 var slide = Core_State_Get("editor", ["selected-slide"]);
 if(!slide) return;
 
 
 // GET SELECTED ELEMENT INFO
 var element = Core_State_Get("editor", ["selected-element"]);
 if(!element) return;
 
 var field  = id.split("-");  
 field      = field.slice(1, field.length).join("-");
 
 
 // STANDARD?
 if(PRESENTATION_FIELDS_STANDARD.includes(field))
 {   
  element.style[field] = control.value;
 }
 
 
 // OTHER CASES
 switch(field)
 {
  case "name":
	Document_Element_SetData(element, field, control.value);
	
	var option = Document_Select_OptionByObject(UI_Element_Find(submodule, "elements-list"), element);
	if(option) option.text = control.value || Document_Element_GetData(element, "uid");
  break;
    
  case "moveable":
  case "visible":
  case "readonly":
	Document_Element_SetData(element, field, control.value);
	
	Editor_Presentation_UpdateDisplayHelpers();
  break;
   
  case "onclick_animation":
  case "ondrop_animation":
  case "onshow_animation":
  case "onhide_animation":
	Document_Element_SetData(element, field, control.value);
	
	var animation = Core_Data_Value("presentation/commands", control.value, "anim");
	if(animation) Document_Element_Animate(element, animation);
  break;
  
  
  case "onclick_sound":
  case "ondrop_sound":
  case "onshow_sound":
  case "onhide_sound":
	Document_Element_SetData(element, field, control.value);
  break;
  
  case "style":	
    var classes = [];
	for(var option of control.options)
	{
     if(option.selected) classes.push(option.value); //Document_CSS_SetClass(element, option.value); else Document_CSS_UnsetClass(element, option.value);
	}
	element.className = classes.join(" ");
  break;
  
  
  case "innerHTML":
  case "value":
	element[field] = control.value;
  break;
  
  
  case "src":
	element[field] = presentation["path"] + "/" + control.value;	
  break;
  
  
  case "url":
	element.src = control.value;
  break;
 }
  
   
   
 Editor_Control_UpdateQuirks(control); 
 
 
 // SAVE ELEMENT
 Editor_Presentation_ElementChanged(element);
}



async function Editor_Presentation_NewShape(item)
{
 var shape  = Document_Element_GetData(item, "uid");
 var data   = Core_Data_Section("editor/shapes", shape);
 var source = Resources_URL("images/shapes/" + data["src"]);
 
 var dest   = Core_State_Get("editor", ["presentation", "path"]);
 
 var src    = await Core_Api("Editor_Import_Resource", {dest, source});
 
 var element = Editor_Presentation_NewElement("shape");
 element.src = src;
}




function Editor_Presentation_NewElement(type, source, data = {})
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 
 // GET CURRENT PRESENTATION 
 var presentation = Core_State_Get("editor", ["presentation"], {});
 
 
 // GET CURRENT SLIDE
 var slide = Core_State_Get("editor", ["selected-slide"]);
 if(!slide) return;

 
 // DETERMINE INITIAL POSITION
 var x = Safe_Get(presentation, ["mouse", "x"], 0);
 var y = Safe_Get(presentation, ["mouse", "y"], 0);
 var z = Presentation_Slide_FindTopZ(slide, true) + 1;
 
 
 
 // CREATE ELEMENT
 var element = Presentation_Element_Create(undefined, type, data, slide);
 
 element.style.position = "absolute";
 element.draggable      = true;
 
 element.style.left     = x || "10px";
 element.style.top      = y || "10px";
 element.style.zIndex   = z || 0;
 

 // UPDATE SLIDE DISPLAY WITH NEW ELEMENT
 presentation["display"].appendChild(element);

 
 // REFRESH ELEMENT LIST
 Editor_Presentation_ListElements();

 
 // SELECT THE NEWLY CREATED ELEMENT
 Editor_Presentation_SetSelectedElement(element);
 
 
 // SWITCH TO ELEMENTS PANEL
 var header = UI_Element_Find(submodule, "presentation-selector");
 UI_Header_Set(header, "elements", true);
 
 
 // SAVE
 Editor_Presentation_ElementChanged(element);
 
 
 // RETURN THE NEWLY CREATED ELEMENT
 return element;
}



function Editor_Presentation_CopyElement()
{
 // GET CURRENT ELEMENT
 var element = Core_State_Get("editor", ["selected-element"]);
 if(!element) return;
 
 Core_State_Set("editor", ["copied-element"], element);
}




function Editor_Presentation_PasteElement(item)
{
 // GET CURRENT PRESENTATION 
 var presentation = Core_State_Get("editor", ["presentation"], {});
 
 
 // GET COPIED ELEMENT
 var element = Core_State_Get("editor", ["copied-element"]);
 if(!element) return;
 
 
 // DUPLICATE
 var duplicate = Editor_Presentation_DuplicateElement(item, element); 
 
 
 // UPDATE POSITION
 duplicate.style.left = Safe_Get(presentation, ["mouse", "x"], duplicate.style.left);
 duplicate.style.top  = Safe_Get(presentation, ["mouse", "y"], duplicate.style.top);
}



function Editor_Presentation_DuplicateElement(item, element)
{
 // GET CURRENT PRESENTATION 
 var presentation = Core_State_Get("editor", ["presentation"], {});
 
 
 // GET CURRENT SLIDE 
 var slide = Core_State_Get("editor", ["selected-slide"], {});
 
 
 // IF NO EXPLICIT ELEMENT IS PASSED, GET CURRENT ELEMENT
 if(!element) var element = Core_State_Get("editor", ["selected-element"]);
 if(!element) return;
 
 
 // DUPLICATE
 var duplicate          = Presentation_Element_Duplicate(element, slide);
 duplicate.style.left   = parseInt(element.style.left)             + 16; 
 duplicate.style.top    = parseInt(element.style.top)              + 16; 
 duplicate.style.zIndex = Presentation_Slide_FindTopZ(slide, true) + 1;
 
 
 // UPDATE NAME (DUPLICATE ELEMENTS HAVE THE SAME NAME AND WE CAN'T ALLOW IT)
 var name = Document_Element_GetData(duplicate, "name");
 name     = String_Copycount_Next(name);
 Document_Element_SetData(duplicate, "name", name);
 
 
 presentation["display"].appendChild(duplicate);
 
 
 // SELECT THE NEWLY CREATED ELEMENT
 Editor_Presentation_ListElements();
 Editor_Presentation_SetSelectedElement(duplicate);
 
 
 // SAVE ELEMENT RIGHT AWAY
 Editor_Presentation_SaveElement(duplicate, true);
 
 
 return duplicate;
}





async function Editor_Presentation_SetElementMedia()
{ 
 // GET CURRENT PRESENTATION 
 var presentation = Core_State_Get("editor", ["presentation"], {});
 
 // GET CURRENTLY SELECTED ELEMENT
 var selected_element = Core_State_Get("editor", ["selected-element"]);
 if(!selected_element) return;
 
 // SELECT A FILE AND UPLOAD IT TO THE PRESENTATION'S RESOURCES
 var current = Core_State_Get("editor", ["presentation", "resources"], []);
 var files   = await Storage_File_Select();
 if(files && files.length > 0)
 {
  var sources = await Editor_Resources_Upload(files, current);
 
  // ASSIGN NEW RESOURCE TO ELEMENT MEDIA
  selected_element.src = sources[0];
 }
}





function Editor_Presentation_SwitchElementStyle(item)
{
 var selected_element = Core_State_Get("editor", ["selected-element"]);
 if(!selected_element) return;
 
 
 // SWITCH STYLE
 var classid = Document_Element_GetData(item, "uid");
 Document_CSS_SwitchClass(selected_element, classid);
 
 
 // UPDATE ELEMENT DISPLAY (STYLE LISTBOX MUST MATCH THE NEWLY SET STYLE)
 Editor_Presentation_DisplayElement();
 
 
 // MARK ELEMENT FOR SAVE
 Editor_Presentation_ElementChanged(selected_element);
}






function Editor_Presentation_DeleteElement(menu)
{
 // GET CURRENT PRESENTATION 
 var presentation = Core_State_Get("editor", ["presentation"], {});
 
 // GET SELECTED SLIDE INFO
 var slide = Core_State_Get("editor", ["selected-slide"]);
 if(!slide) return;
 
 // SELECTED ELEMENT
 var selected_element = Core_State_Get("editor", ["selected-element"]);
 if(!selected_element) return;
 
 Editor_Presentation_UnselectElement();
 
 // DELETE ELEMENT
 var index = slide["elements"].indexOf(selected_element);
 if(index !== -1)
 {
  slide["elements"].splice(index, 1);
  presentation["display"].removeChild(selected_element);
 }
 
 Editor_Presentation_ListElements();
 
 
 // MARK CURRENT SLIDE AS CHANGED
 Editor_Presentation_SlideChanged();
}




function Editor_Presentation_FullpageElement(menu)
{
 // GET CURRENT PRESENTATION 
 var presentation = Core_State_Get("editor", ["presentation"], {});
 
 // GET SELECTED SLIDE INFO
 var slide = Core_State_Get("editor", ["selected-slide"]);
 if(!slide) return;
 
 // SELECTED ELEMENT
 var selected_element = Core_State_Get("editor", ["selected-element"]);
 if(!selected_element) return;
 
 
 // ENLARGE
 selected_element.style.left   = 0;
 selected_element.style.top    = 0;
 selected_element.style.width  = presentation["width"];
 selected_element.style.height = presentation["height"];
 
 
 // UPDATE ELEMENT DISPLAY
 Editor_Presentation_DisplayElement();
 
 // MARK ELEMENT FOR SAVE
 Editor_Presentation_ElementChanged(selected_element);
 
 // MARK CURRENT SLIDE AS CHANGED
 Editor_Presentation_SlideChanged();
 
 
 // UNSELECT ELEMENT (GOING SUDDENLY FULL PAGE CAN CAUSE PROBLEMS WITH SELECTION / DRAGGING)
 Editor_Presentation_UnselectElement();
}




function Editor_Presentation_SendbackElement(menu)
{
 // SELECTED ELEMENT
 var selected_element = Core_State_Get("editor", ["selected-element"]);
 if(!selected_element) return;

 Presentation_Element_SendToBack(selected_element);

 // UPDATE ELEMENT DISPLAY
 Editor_Presentation_DisplayElement();
 
 // MARK ELEMENT FOR SAVE
 Editor_Presentation_ElementChanged(selected_element);
 
 // MARK CURRENT SLIDE AS CHANGED
 Editor_Presentation_SlideChanged(); 
}




function Editor_Presentation_BringfrontElement(menu)
{
 // SELECTED ELEMENT
 var selected_element = Core_State_Get("editor", ["selected-element"]);
 if(!selected_element) return;
  
 Presentation_Element_BringToFront(selected_element);

 // UPDATE ELEMENT DISPLAY
 Editor_Presentation_DisplayElement();
 
 // MARK ELEMENT FOR SAVE
 Editor_Presentation_ElementChanged(selected_element);
 
 // MARK CURRENT SLIDE AS CHANGED
 Editor_Presentation_SlideChanged(); 
}





function Editor_Presentation_SetSelectedElement(element)
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 
 var list = UI_Element_Find(submodule, "elements-list"); 
 for(var option of list.options) if(Document_Element_GetObject(option, "element") == element)
 {
  // SELECT ELEMENT
  option.selected = true;
  Editor_Presentation_SelectElement();
	      
  return option;
 }
}




function Editor_Presentation_ElementChanged(element)
{
 if(!element) var element = Core_State_Get("editor", ["selected-element"]);
 if(!element) return;
 
 Document_Element_SetData(element, "changed", "yes");
 Presentation_Element_Snapshot(element);
 
 // IF ELEMENT CHANGED, SLIDE CHANGED AS WELL
 var slide = Document_Element_GetObject(element, "slide");
 if(slide) Editor_Presentation_SlideChanged(slide);
 
 element["changed"] = true;
}





// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                           M E N U S                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//




function Editor_Presentation_MenuElements(menu)
{
 var selected_element = Core_State_Get("editor", ["selected-element"]);
  
 var items = UI_Menu_ListItems(menu);
 for(var id in items)
 {
  var item = items[id];
  
  if(item["tag"] == "new"    && !selected_element) item["state"] = "enabled";
  else
  if(item["tag"] == "modify" && selected_element)  item["state"] = "enabled";
  else
  item["state"] = "hidden";
 }  
}





function Editor_Presentation_MenuStyles(menu)
{
 var selected_element = Core_State_Get("editor", ["selected-element"]);
 
 var items = UI_Menu_ListItems(menu);
 for(var key in items)
 {
  var item = items[key];
  
  if(selected_element && selected_element.className.indexOf(key) != -1) 
  {
   item["icon"] = "check";
  }
  else
  {
   item["icon"] = "";
  }	  
 }
}
// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                P R E S E N T A T I O N                                         //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Editor_Presentation()
{
 // FLUSH EDITOR FROM CERTAIN SAVED STATES
 Editor_Flush();
 
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 

 // DETERMINE PRESENTATION TO EDIT
 var source = false;
  
 
 // SET BY ANOTHER MODULE? 
 if(!source)
 {
  var source = Core_State_Get("editor", ["edit-presentation"], false);
  if(source)
  {
   // UNSET
   Core_State_Set("editor", ["edit-presentation"], false);
  }
 }
 
 
 
 
 // JUST SET IT TO THE USER'S TEMP FOLDER
 if(!source)
 {
  var user_id = Safe_Get(application, ["user", "id"]); 
  var source  = Resources_URL("temp/editor/presentation", "user", user_id);
 }
 
 Core_State_Set("editor", ["current-source"], source);
 
	
 // LOAD
 var presentation = await Presentation_Load(source, {mode:"edit"}); 

 // SET AS CURRENTLY EDITED
 presentation["mode"] = "edit";
 Core_State_Set("editor", ["presentation"], presentation);
 
 
 // STORE AS LAST PRESENTATION EDITED
 Core_Api("User_Config_WriteValue", {file:"editor", section:"wip", field:"presentation", value:source});
  
 


 // SETUP CONTROLS
 var header = UI_Header("presentation-selector",
 {
  slide:
  {
   text :   UI_Language_String("editor", "selector slide caption"),
   icons:   [{icon:"cloud-arrow-down", onclick:Editor_Download}, {icon:"tv", onclick:Editor_Presentation_Test}],
   onclick: Editor_Presentation_SelectPanel
  },
  
  elements:
  {
   text :   UI_Language_String("editor", "selector elements caption"),
   icons:   [{icon:"floppy-disk", onclick:Editor_Presentation_OnSave}],
   onclick: Editor_Presentation_SelectPanel
  },
  
  scripts:
  {
   text :   UI_Language_String("editor", "selector scripts caption"),
   icons:   [],
   onclick: Editor_Presentation_SelectPanel
  },
  
  resources:
  {
   text:  UI_Language_String("editor", "selector resources caption"),
   icons: [{icon:"folder-open", onclick:Editor_Presentation_AddResources}],
   onclick: Editor_Presentation_SelectPanel
  }
 });
  
 UI_Element_Find(submodule, "slide-panels-selector").appendChild(header);
  

 Editor_Presentation_SlidesControls();

 Editor_Presentation_ElementsControls();
 
 Editor_Presentation_ScriptsControls();
 
 
 
 // TRY TO AUTOMATICALLY ASSIGN DATA SOURCES TO SELECTS
 var container = UI_Element_Find(submodule, "slide-panels");
 var selects   = Document_Element_FindChildren(container, "source", undefined, ["recurse"]);
 for(var select of selects)
 {
  Document_Select_Clear(select);
  Document_Select_AddOption(select, "" , "");
  
  var source = Document_Element_GetData(select, "source");
  var svalue = Document_Element_GetData(select, "sourcevalue");
  var page   = Core_Data_Page("editor/" + source);
  
  if(page)
  {
   for(var id in page)
   {
    var text   = UI_Language_Object(page[id]);
    
	if(svalue) var value = page[id][svalue]; else var value = id;
	
    var option = Document_Select_AddOption(select, text, value);
   }
  }
 }
  



 // ALL STYLE SELECTS
 var selects    = [UI_Element_Find(submodule, "element-style")]; //Document_Element_FindChildren(container, "source", "styles", ["recurse"]);
 var page       = Core_Data_Page("presentation/styles");
 var categories = Core_Data_Page("presentation/style-categories");
 
 for(var select of selects)
 {  
  select.innerHTML = "";

  UI_Select_FromDatapage(select, page, "type", categories, "text-option-category")
 }
  
 
 

 // UPDATE SELECTS WITH DYNAMIC SOURCES
 var container = UI_Element_Find(submodule, "slide-panels-panels");
 Editor_Presentation_UpdateControls(container);
 
 
 // LIST RESOURCES
 Editor_Presentation_ListResources();
  
 
 // ASSIGN DISPLAY TO PRESENTATION
 //var display = UI_Element_Find(submodule, "slides-slide");
 //Presentation_Assign(presentation, display, Editor_Presentation_DisplayEventHandler);
 
 
 
 // DISPLAY SLIDES LIST
 Editor_Presentation_ListSlides();
 
 
 
 // SETUP KEYBOARD
 Input_Keyboard_Assign(document.body, Editor_Presentation_DisplayKeyboard);
 
 

 // SET UP UPLOAD OF NEW RESOURCES
 var display = UI_Element_Find(submodule, "slides-slide");
 
 Document_Handler_FileDrop(display, {},  Editor_Presentation_DropResources);
 
 

 // SET UP PASTING
 Document_Handler_Paste(
 {
  image: Editor_Presentation_PasteResource,
 }, 
 UI_Element_Find(submodule, "slides-edit"));
 
 
 // SET UP RESOURCE PREVIEW AND INSERT
 UI_Element_Find(submodule, "resources-list").onclick    = Editor_Resource_Preview;
 UI_Element_Find(submodule, "resources-list").ondblclick = Editor_Presentation_InsertResource;
 
 
 
 // SWITCH TO ELEMENTS PANEL
 var header = UI_Element_Find(submodule, "presentation-selector");
 UI_Header_Set(header, "slide", true);
 
 
 // DELAYED DISPLAY OF PRESENTATION (UI NEEDS TO BE ATTACHED TO THE DOM OR IT WILL FAIL)
 setTimeout(
 function()
 {
  // ASSIGN DISPLAY TO PRESENTATION
  var display = UI_Element_Find(submodule, "slides-slide");
  Presentation_Assign(presentation, display, Editor_Presentation_DisplayEventHandler);
  
  // IF PRESENTATION HAS AT LEST ONE SLIDE, SELECT IT AND DISPLAY IT
  if(presentation["slides"].length > 0)
  {  
   var list = UI_Element_Find(submodule, "slides-list");
  
   list.options[0].selected = true;
   list.options[0].click();
  
   Editor_Presentation_UpdateDisplayHelpers();
  }
 }, 250);
}






function Editor_Presentation_SelectPanel(item)
{	
 if(typeof item == "string") var selected = item; else var selected = item["id"];
 
 
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 
 // DISPLAY SELECTED PANEL AND HIDE ALL OTHERS
 var container = UI_Element_Find(submodule, "slide-panels-panels");
 Document_Conditional_Style(container, {display:"flex"}, {display:"none"}, "panel", selected);


 // TAKE A CHANCE TO SAVE THE CURRENT SLIDE IF CHANGES OCCURRED
 Editor_Presentation_SaveSlide();


 Core_State_Set("editor", ["presentation", "current-panel"], selected);
}






function Editor_Presentation_UpdateControls(container)
{
 var presentation = Core_State_Get("editor", ["presentation"]);
 var resources    = Core_State_Get("editor", ["presentation", "resources"], []);
 
  
 // THIS WILL LOAD MEDIA INTO SELECTS
 Editor_Resources_UpdateControls(resources, container);
 
 
 // ALL ELEMENTS SELECTS
 var selects  = Document_Element_FindChildren(container, "source", "elements", ["recurse"]);
 var slide    = Core_State_Get("editor", ["selected-slide"], {});
 var elements = slide["elements"] || [];
 
 for(var select of selects)
 {
  Document_Select_Clear(select);
  Document_Select_AddOption(select, "", "");
 
  for(var element of elements)
  {
   var value  = Document_Element_GetData(element, "uid");
   var text   = Document_Element_GetData(element, "name") || value; 
   var option = Document_Select_AddOption(select, text, value, element);
  }
 }
 
 
 
 // ALL COMMANDS SELECTS
 var selects    = Document_Element_FindChildren(container, "source", "commands", ["recurse"]);
 var page       = Core_Data_Page("presentation/commands");
 var categories = Core_Data_Page("presentation/command-categories");
 
 for(var select of selects)
 {  
  Document_Select_Clear(select);
  Document_Select_AddOption(select, "", "");
 
  UI_Select_FromDatapage(select, page, "type", categories, "text-option-category",
  // FILTER OUT COMMANDS THAT THIS SELECT DOES NOT ALLOW
  function(item)
  {
   var allow = Object_From_String(Document_Element_GetData(select, "allow"));
   if(allow)
   {
    var field = Object.keys(allow)[0];
    var value = Object.values(allow)[0];
    
    return (item[field] == value);	
   }
   else return true;
  });
 }
  
  
 
 
 // ALL FONTS SELECTS 
 var selects     = Document_Element_FindChildren(container, "source", "fonts", ["recurse"]);
 var system      = Core_Data_Page("core/system fonts");
 var custom      = Document_Fonts_List();
  
 for(var select of selects)
 { 
  Document_Select_Clear(select);
  Document_Select_AddOption(select, "", "");
 
  for(var source of custom)
  {
   var text                = source;
   var value               = source;
   var option              = Document_Select_AddOption(select, source, source);
   option.style.fontFamily = source; 
  }
  
 
  for(var source in system)
  {
   var text                = UI_Language_Object(system[source]);
   var value               = source;
   var option              = Document_Select_AddOption(select, text, value);
   option.style.fontFamily = source; 
  }
  
 }
 
 
 
 // ALL TEXT ALIGNMENT SELECTS 
 var selects    = Document_Element_FindChildren(container, "source", "alignment", ["recurse"]);
 var sources    = Core_Data_Page("editor/alignments");

 for(var select of selects)
 { 
  for(var source in sources)
  {
   var text                = UI_Language_Object(sources[source]);
   var value               = source;
   var option              = Document_Select_AddOption(select, text, value);
  }
  
 }
 
 
 
 // ALL COLOR SELECTS 
 var selects     = Document_Element_FindChildren(container, "source", "colors", ["recurse"]);
 var sources     = Core_Data_Page("core/colors");
 
 for(var select of selects)
 {  
  var svalue = Document_Element_GetData(select, "sourcevalue");
  
  Document_Select_Clear(select);
  Document_Select_AddOption(select, "", "transparent");
 
  for(var source in sources)
  {
   var text              = "████████████████ / " + UI_Language_Object(sources[source]);
   
   if(svalue)            var value = sources[source][svalue]; else var value = source;
   
   var option            = Document_Select_AddOption(select, text, value);
   option.style.color    = source;
   option.style.fontSize = "24px"; 
   
   // TRICK: WE USE DOM'S COLOR CONVERSION TO RESET THE OPTION VALUE, BECAUSE HEX ARE CONVERTED TO RGB AND SO THE ELEMENT STYLE/VALUES WON'T MATCH. 
   // SHOULD REFACTOR THE COLOR.DAT FILE INSTEAD
   if(!svalue) option.value = option.style.color;
  }
 }
  
}






function Editor_Presentation_Test()
{
 var presentation_source = Core_State_Get("editor", ["presentation", "path"]);
 
 var lesson_id           = presentation_source.replace("content/lessons/", "");
 lesson_id               = lesson_id.replace("/presentation", "");
 
 var slide_id            = Core_State_Get("editor", ["presentation", "current-slide", "id"]);
 
 var projector = window.open("?framework=null&module=classroom&page=present&lesson_id=" + lesson_id + "&slide=" + slide_id, "_", "popup, width="+ screen.width + ", height=" + screen.height + ", fullscreen=yes");
}








// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                       D I S P L A Y                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Editor_Presentation_DisplayEventHandler(event)
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
	
 switch(event["event"])
 {
  case "click":
  
    // TRIGGER SELECTION
	if(event["element"])
	{
     if(Editor_Presentation_SetSelectedElement(event["element"]))
	 {
	  
	 }
	}
	else
	{
     // UNSELECT
	 Editor_Presentation_UnselectElement();
	}
  
  break;
  
  
  case "dblclick":
    // TRIGGER SELECTION
	if(event["element"])
	{
     if(Editor_Presentation_SetSelectedElement(event["element"]))
	 {
	  // SWITCH TO ELEMENTS PANEL
	  var header = UI_Element_Find(submodule, "presentation-selector");
      UI_Header_Set(header, "elements", true);
	 }
	}
	else
	{
     // UNSELECT
	 Editor_Presentation_UnselectElement();
	}
  break;
    
	
  case "move":
    // ELEMENT POSITION HAS CHANGED: MARK IT FOR SAVING
    if(event["element"])
	{
     // SAVE ELEMENT
     Editor_Presentation_ElementChanged(event["element"]);
	}
  break;
  
  
  
  case "drop":
    // ELEMENT POSITION HAS CHANGED: MARK IT FOR SAVING
	if(event["element"])
	{
     // SAVE ELEMENT
     Editor_Presentation_ElementChanged(event["element"]);
	}
  break;
 }
}








function Editor_Presentation_DisplayKeyboard(event)
{
 // ABORT IF CURSOR IS IN AN EDIT FIELD
 var focused = document.activeElement;
 if(["input", "textarea"].includes(focused.nodeName.toLowerCase())) return;
 

 var selected_element = Core_State_Get("editor", ["selected-element"]);
 var grid_size        = 8;
 var changed          = false;

 // MODIFY SELECTED ITEM
 if(selected_element)
 {
  // DELETE 
  if(Input_Keyboard_Pressed(false, [KEY_DEL]) || Input_Keyboard_Pressed(false, [KEY_BACKSP]))
  {
   Editor_Presentation_DeleteElement();
  }
  else
	  
  // INCREASE SIZE
  if(Input_Keyboard_Pressed("Z", [KEY_LSHIFT]))
  {  
   var ratio = parseInt(selected_element.style.height) / parseInt(selected_element.style.width);
   
   selected_element.style.width  = parseInt(selected_element.style.width)  + grid_size;
   selected_element.style.height = Math.round(parseInt(selected_element.style.height) + grid_size * ratio);
   
   changed = true;
  }
  else
	  
  // DECREASE SIZE
  if(Input_Keyboard_Pressed("A", [KEY_LSHIFT]))
  {   
   var ratio = parseInt(selected_element.style.height) / parseInt(selected_element.style.width);
   
   selected_element.style.width  = parseInt(selected_element.style.width)  - grid_size;
   selected_element.style.height = Math.round(parseInt(selected_element.style.height) - grid_size * ratio);
   
   changed = true;
  }
  else
	  
  // INCREASE WIDTH
  if(Input_Keyboard_Pressed(false, [KEY_LSHIFT, KEY_RIGHT]))
  {
   selected_element.style.width = parseInt(selected_element.style.width) + grid_size;
   
   changed = true;
  }
  else
	  
  // DECREASE WIDTH
  if(Input_Keyboard_Pressed(false, [KEY_LSHIFT, KEY_LEFT]))
  {  
   selected_element.style.width = parseInt(selected_element.style.width) - grid_size;
   
   changed = true;
  }
  else
	  
  // INCREASE HEIGHT
  if(Input_Keyboard_Pressed(false, [KEY_LSHIFT, KEY_DOWN]))
  {  
   selected_element.style.height = parseInt(selected_element.style.height) + grid_size;
   
   changed = true;
  }
  else
	  
  // DECREASE HEIGHT
  if(Input_Keyboard_Pressed(false, [KEY_LSHIFT, KEY_UP]))
  {  
   selected_element.style.height = parseInt(selected_element.style.height) - grid_size;
   
   changed = true;
  }
  else
	  
  // MOVE RIGHT
  if(Input_Keyboard_Pressed(false, [KEY_RIGHT]))
  {  
   selected_element.style.left = parseInt(selected_element.style.left) + grid_size;
   
   changed = true;
  }
  else
	  
  // MOVE LEFT
  if(Input_Keyboard_Pressed(false, [KEY_LEFT]))
  {  
   selected_element.style.left = parseInt(selected_element.style.left) - grid_size;
   
   changed = true;
  }
  else
	  
  // MOVE DOWN
  if(Input_Keyboard_Pressed(false, [KEY_DOWN]))
  {  
   selected_element.style.top = parseInt(selected_element.style.top) + grid_size;
   
   changed = true;
  }
  else
	  
  // MOVE UP
  if(Input_Keyboard_Pressed(false, [KEY_UP]))
  {  
   selected_element.style.top = parseInt(selected_element.style.top) - grid_size;
   
   changed = true;
  }
  else
  
  // MOVE TO FRONT
  if(Input_Keyboard_Pressed(false, [KEY_PGUP]))
  {  
   selected_element.style.zIndex = parseInt(selected_element.style.zIndex) + 1;
   
   changed = true;
  }
  else
  
  // MOVE TO BACK
  if(Input_Keyboard_Pressed(false, [KEY_PGDN]))
  {  
   selected_element.style.zIndex = parseInt(selected_element.style.zIndex) - 1;
   
   changed = true;
  }
  
  else
	  
  // UNSELECT
  if(Input_Keyboard_Pressed(false, [KEY_ESC]))
  {
   Editor_Presentation_UnselectElement();
  }
  
  
  // SAVE ELEMENT
  if(changed) Document_Element_SetData(selected_element, "changed", "yes");
 }  
 
}







function Editor_Presentation_UpdateDisplayHelpers()
{
 var presentation     = Core_State_Get("editor", ["presentation"], {});
 var selected_slide   = Core_State_Get("editor", ["selected-slide"], undefined);
 var selected_element = Core_State_Get("editor", ["selected-element"], undefined);

 if(!selected_slide) return;
  
 // SPECIAL BORDER FOR SELECTED ELEMENT
 for(var element of selected_slide["elements"])
 { 
  if(element == selected_element) 
  {
   element.style.outline = "5px dashed var(--color-accented)";
  }
  else 
  {
   element.style.outline = "";
  }	   
 }  

 // INVISIBLE ITEMS ARE FILTERED TO GREYSCALE AND SEMI-TRANSPARENT
 for(var element of selected_slide["elements"])
 { 
  if(Document_Element_GetData(element, "visible") == "no") 
  {
   element.style.opacity = "0.25";
  }
  else 
  {
   element.style.opacity = "";
  }	   
 }  
}



















// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                           S A V E                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Editor_Presentation_SaveSlide(slide, forced)
{  
 if(!User_Can("modify-content")) return;
 
 
 // EXISTING SLIDE OR AUTOPICK CURRENT
 if(!slide) slide = Core_State_Get("editor", ["selected-slide"]);
 if(!slide) return;
 

 // DO NOT SAVE IF NO CHANGES OCCURRED SINCE LAST SAVE
 if(!forced && !slide["changed"]) return;
 
 
 // GET CURRENT PRESENTATION 
 var presentation = Core_State_Get("editor", ["presentation"], {});

 
 // GET DATA
 var path     = presentation["path"];
 var slide_id = slide["id"];
 var data     = Presentation_Slide_GetData(slide);
 
 
 // SAVE
 await Core_Api("Presentation_WriteSlide", {path:path, slide_id:slide_id, data:data});
 

 // MARK THE SLIDE AS UNCHANGED SINCE LAST SAVE
 slide["changed"] = false;
}







function Editor_Presentation_SaveElement(element, forced)
{
 if(!User_Can("modify-content")) return;
 
 
 // DO NOT SAVE IF NO CHANGES OCCURRED SINCE LAST SAVE
 if(!forced && Document_Element_GetData(element, "changed") == "no") return;
 
 
 // GET CURRENT PRESENTATION 
 var presentation = Core_State_Get("editor", ["presentation"], {});
 
 // GET SLIDE THE ELEMENT BELONGS TO
 var slide = Document_Element_GetObject(element, "slide");

 
 // GET DATA
 var path       = presentation["path"];
 var slide_id   = slide["id"];
 var element_id = Document_Element_GetData(element, "uid");
 var data       = Presentation_Element_GetData(element);
 
 
 // SAVE
 Core_Api("Presentation_WriteElement", {path:path, slide_id:slide_id, element_id:element_id, data:data});
 
 
 // MARK THE ELEMENT AS UNCHANGED SINCE LAST SAVE
 Document_Element_SetData(element, "changed", "no");
}


async function Editor_Presentation_OnSave(e)
{
  var slide = Core_State_Get("editor", ["selected-slide"]);
  await Editor_Presentation_SaveSlide(slide);
}



// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      R E S O U R C E S                                         //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



async function Editor_Presentation_AddResources()
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
	
 var files   = await Storage_File_Select({multiple:true});
 var current = Core_State_Get("editor", ["presentation", "resources"], []);
 
 await Editor_Resources_Upload(files, current);
 
 var container = UI_Element_Find(submodule, "slide-panels-panels");
 Editor_Presentation_UpdateControls(container);
 
 var container = UI_Element_Find(submodule, "resources-list"); 
 Editor_Resources_Display(current, container);
}




async function Editor_Presentation_DropResources(files)
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
	
 var slide   = Core_State_Get("editor", ["selected-slide"], {}); 
 var current = Core_State_Get("editor", ["presentation", "resources"], []);
 var dropped = await Editor_Resources_Upload(files, current);
 
 var offset  = 16;
 for(var file of dropped)
 {
  Editor_Presentation_ElementFromResource(file["name"], offset, offset);
  
  offset = offset + 16;
 } 
 
 Editor_Presentation_SaveSlide(slide, true);
 
 var container = UI_Element_Find(submodule, "slide-panels-panels");
 Editor_Presentation_UpdateControls(container);
 
 Editor_Presentation_ListResources();
}





function Editor_Presentation_ListResources()
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
	
 var container = UI_Element_Find(submodule, "resources-list");
 var list      = Core_State_Get("editor", ["presentation", "resources"], []);
 
 Editor_Resources_Display(list, container);
}








function Editor_Presentation_InsertResource()
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
	
 var container     = UI_Element_Find(submodule, "resources-list");
  
 var option = Document_Select_SelectedOption(container);
 if(!option) return;
  
 var file = option.value;
 
 var element = Editor_Presentation_ElementFromResource(file, 16, 16);
 
 console.log(element);
}





function Editor_Presentation_ElementFromResource(resource, x, y)
{
 var element = false;
 var type    = Media_Info_Type(resource);
  
 switch(type)
 {
  case "image":
	var element = Editor_Presentation_NewElement("image", false, {src:resource});
   
	element.style.left = x; 
	element.style.top  = y;
  break;
   
  case "video":
	var element = Editor_Presentation_NewElement("video", false, {src:resource});
   
	element.style.left = x; 
	element.style.top  = y; 
  break;
 }
 
 return element;
}




async function Editor_Presentation_PasteText(item)
{
 console.log(item);
}




async function Editor_Presentation_PasteResource(item)
{ 
 // GET PASTED IMAGE AS VIRTUAL FILE
 var file              = item.getAsFile();
 
 
 //var image        = await Document_Image_FromFile(file);
 //var transparency = Document_Image_HasTransparency(image);
 //console.log(transparency);
 //return; 
 file["override-type"] = "image/jpeg"; 


 var title     = UI_Language_String("editor", "popup name title");
 var subtitle  = UI_Language_String("editor", "popup name subtitle");
 var picture   = await Storage_File_Read(file, {whole:true});
 var name      = await UI_Popup_Input(title, subtitle, picture);
 if(!name)name = "image";
 file["override-name"] = name + ".jpg";
 
 
 var current = Core_State_Get("editor", ["presentation", "resources"], []);
 var added   = await Editor_Resources_Upload([file], current);
 var source  = added[0];


 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();

 
 // SWITCH TO RESOURCES PANEL
 var header = UI_Element_Find(submodule, "presentation-selector");
 UI_Header_Set(header, "resources", true);
 
 
 // UPDATE RESOURCES AND SELECT THE PASTED ONE
 var list = UI_Element_Find(submodule, "resources-list");
 
 Editor_Presentation_ListResources();
 Document_Select_SelectByValue(list, source);
 list.click();
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                        S C R I P T S                                           //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Editor_Presentation_ScriptsControls()
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 // SCRIPTS
 var list     = UI_Element_Find(submodule, "scripts-list");
 list.onclick = Editor_Presentation_SelectScript; 
  
 // SCRIPTS PANEL MENU
 var menu = UI_Menu_Create("scripts-menu", 
 // MENU ITEMS
 {  
  create:
  {
   icon:    "file-lines", 
   text:    UI_Language_String("editor", "scripts menu create"),
   func:    Editor_Presentation_NewScript,
   tag:     "new"
  },
  
  moveup:
  {
   icon:    "arrow-up", 
   text:    UI_Language_String("editor", "scripts menu moveup"),
   func:    Editor_Presentation_MoveScriptUp,
   tag:     "modify"
  },
  
  movedown:
  {
   icon:    "arrow-down", 
   text:    UI_Language_String("editor", "scripts menu movedown"),
   func:    Editor_Presentation_MoveScriptDown,
   tag:     "modify"
  },
  
  play:
  {
   icon:    "play", 
   text:    UI_Language_String("editor", "scripts menu test"),
   func:    Editor_Presentation_PlayScript,
   tag:     "modify"
  },
  
  
  
  break1:
  {
  },
  
  delete:
  {
   icon:    "trash-can", 
   text:    UI_Language_String("editor", "scripts menu delete"),
   state:  "enabled",
   func:    Editor_Presentation_DeleteScript,
   tag:     "modify"
  }
 },
 
 // MENU EVENTS
 {
  onshow: Editor_Presentation_MenuScripts
 }); 
  
 UI_Menu_Assign(list, menu, {direction:"bottom right"});
 
 
 
 
 // SCRIPT LINE MENU
 var menu = UI_Menu_Create("scripts-menu", 
 // MENU ITEMS
 {  
  create:
  {
   icon:    "file-lines", 
   text:    UI_Language_String("editor", "script line create"),
   func:    Editor_Presentation_NewLine,
   state:   "enabled",
   tag:     "new"
  },
  
  sort:
  {
   icon:    "arrow-down-short-wide", 
   text:    UI_Language_String("editor", "script line sort"),
   func:    Editor_Presentation_SortScript,
   state:   "enabled",
   tag:     "new"
  },
  
  break1:
  {
  },
  
  delete:
  {
   icon:    "trash-can", 
   text:    UI_Language_String("editor", "script line delete"),
   state:  "enabled",
   func:    Editor_Presentation_DeleteLine,
   tag:     "modify"
  }
 },
 
 // MENU EVENTS
 {
  onshow: Editor_Presentation_MenuLines
 });
 
 var panel = UI_Element_Find(submodule, "script-lines");
 UI_Menu_Assign(panel, menu, {direction:"bottom right"});
}




function Editor_Presentation_ListScripts()
{	
 var slide = Core_State_Get("editor", ["selected-slide"]);
 if(!slide) return;
 
 
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 
 // DISPLAY THIS SLIDE'S SCRIPTS
 var list       = UI_Element_Find(submodule, "scripts-list");
 list.innerHTML = "";
 
 
 // LIST SCRIPTS
 var scripts = slide["scripts"];
 
 for(var script of scripts)
 {
  var value  = script["id"];
  var text   = script["name"];
  var option = Document_Select_AddOption(list, text, value, script);
  
  script["option"] = option;
 }
 
 
 // UNSELECT LINE IF ANY SELECTED
 Editor_Presentation_UnselectLine();
}




function Editor_Presentation_UnselectScript()
{	
 // UNSELECT IN STATE
 Core_State_Set("editor", ["selected-script"], undefined);
 
// GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 // UNSELECT IN SCRIPTS LIST
 var list = UI_Element_Find(submodule, "scripts-list");
 list.selectedIndex = -1;

 // UNSELECT LINE
 Editor_Presentation_UnselectLine();

 // HIDE PANELS THAT ARE NOT SUPPOSED TO BE VISIBLE IF NO SCRIPT IS SELECTED
 UI_Element_Find(submodule, "script-properties").style.visibility = "hidden"; 
}





function Editor_Presentation_SelectScript(event)
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 var list   = UI_Element_Find(submodule, "scripts-list");
 var option = Document_Select_SelectedOption(list);
 if(!option) return;
 
 var script = Document_Element_GetObject(option, "object");
 if(!script) return;
 
 
 // REFLECT SELECTED SCRIPT CHANGE
 Core_State_Set("editor", ["selected-script"], script);
 
 
 // POPULATE SCRIPT PROPERTIES PANEL AND REVEAL IT
 Editor_Presentation_DisplayScript();
}




function Editor_Presentation_UpdateScript(event)
{
 var script = Core_State_Get("editor", ["selected-script"]);
 if(!script) return;
 
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 // SCRIPT NAME
 var control           = UI_Element_Find(submodule, "script-name");
 script["name"]        = control.value;
 script["option"].text = script["name"];
 
 
 // MARK CURRENT SLIDE AS CHANGED
 Editor_Presentation_SlideChanged();
}





function Editor_Presentation_DisplayScript()
{ 
 // IF THERE'S ACURRENTLY SELECTED LINE, UNSELECT IT
 Editor_Presentation_UnselectLine();
 
 // GET SELECTED SCRIPT INFO
 var script = Core_State_Get("editor", ["selected-script"]);
 if(!script) return;
 
 
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 
 // DISPLAY LINES
 var list = UI_Element_Find(submodule, "script-lines");
 list.innerHTML = "";
 
 // SCRIPT NAME
 var control      = UI_Element_Find(submodule, "script-name");
 control.value    = script["name"];
 control.onchange = Editor_Presentation_UpdateScript;
 
 for(var line of script["lines"])
 {	  
  // CREATE
  var element = UI_Element_Create("editor/script-line");
   
	
  // FILL ELEMENT'S SELECTS WITH OPTIONS
  Editor_Presentation_UpdateControls(element);
  
  
  // ASSOCIATE ELEMENT'S CONTROLS WITH LINE
  var controls = Document_Element_FindChildren(element, "uid", undefined, ["recurse"]);
  for(var control of controls)
  {
   var uid       = Document_Element_GetData(control, "uid");
   control.value = line[uid];
   
   Document_Element_SetObject(control, "line", line);
   control.onchange = Editor_Presentation_UpdateLine;
  }
  
  // LINE HINT
  Editor_Presentation_UpdateLineHint(element, line["command"]);
  
  // ON CLICK SELECT LINE
  element.onclick = Editor_Presentation_SelectLine;
  
  //ON DOUBLE CLICK TEST LINE
  element.ondblclick = Editor_Presentation_TestLine;
  
  // LINK WITH LINE, AND APPEND
  Document_Element_SetObject(element, "line", line);
  line["control"] = element;
  
  list.appendChild(element);
 }
 
 
 // HIGHLIGHT CURRENTLY SELECTED LINE
 Editor_Presentation_UpdateLineSelection();
 
 
 // SHOW SCRIPT PROPERTIES
 var container = UI_Element_Find(submodule, "script-properties");
 container.style.visibility = "visible"; 
}


 

 
 
 
function Editor_Presentation_NewScript()
{
 var slide = Core_State_Get("editor", ["selected-slide"]);
 if(!slide) return;
 
 
 // DETERMINE ID
 var max = -1;
 for(var s of slide["scripts"])
 {
  var i = parseInt(String_Filter_AllowDigits(s["id"]));
  if(i > max) max = i;
 }
 max    = max + 1;
 var id = String(max).padStart(2, "0");
 
 var data     = {};
 data["name"] = "Script " + id;
 
 
 // CREATE SCRIPT
 var script = Presentation_Script_Create(id, data, slide);
 slide["scripts"].push(script);
 
 
 // ADD AT LEAST ONE FIRST LINE
 var line = Presentation_Script_CreateLine(script);
 
 
 // SELECT AND DISPLAY
 Core_State_Set("editor", ["selected-script"], script);
 Editor_Presentation_ListScripts();
 
 
 // MARK CURRENT SLIDE AS CHANGED
 Editor_Presentation_SlideChanged();
}






function Editor_Presentation_DeleteScript()
{  
 var script = Core_State_Get("editor", ["selected-script"]);
 if(!script) return;
 
 var slide = Core_State_Get("editor", ["selected-slide"]);
 if(!slide) return;
 
 var index = slide["scripts"].indexOf(script);
 if(index !== -1) slide["scripts"].splice(index, 1);
 
 
 Editor_Presentation_UnselectScript();
 Editor_Presentation_ListScripts();
 
 
 // MARK CURRENT SLIDE AS CHANGED
 Editor_Presentation_SlideChanged();
}





function Editor_Presentation_SwapScripts(slide, index_a, index_b)
{
 var temp                        = slide["scripts"][index_b]["id"];
 slide["scripts"][index_b]["id"] = slide["scripts"][index_a]["id"];
 slide["scripts"][index_a]["id"] = temp;
 
 var temp                  = slide["scripts"][index_b];
 slide["scripts"][index_b] = slide["scripts"][index_a];
 slide["scripts"][index_a] = temp; 
}




function Editor_Presentation_MoveScriptUp()
{
 var slide = Core_State_Get("editor", ["selected-slide"]);
 
 var script = Core_State_Get("editor", ["selected-script"]);
 if(!script) return;
 
 var index = slide["scripts"].indexOf(script);
 
 if(index > 0)
 {  
  Editor_Presentation_SwapScripts(slide, index - 1, index);
 }
 
 // UPDATE SCRIPTS LIST DISPLAY
 Editor_Presentation_ListScripts();
 
 
 // MARK CURRENT SLIDE AS CHANGED
 Editor_Presentation_SlideChanged();
}




function Editor_Presentation_MoveScriptDown()
{
 var slide = Core_State_Get("editor", ["selected-slide"]);
 
 var script = Core_State_Get("editor", ["selected-script"]);
 if(!script) return;
 
 var index = slide["scripts"].indexOf(script);
 
 if(index < slide["scripts"].length - 1)
 {
  Editor_Presentation_SwapScripts(slide, index, index + 1);
 }
 
 // UPDATE SCRIPTS LIST DISPLAY
 Editor_Presentation_ListScripts();
 
 
 // MARK CURRENT SLIDE AS CHANGED
 Editor_Presentation_SlideChanged();
}





function Editor_Presentation_SortScript()
{
 var script =  Core_State_Get("editor", ["selected-script"]); 
 if(!script) return;
 
 script["lines"].sort(
 function(a, b)
 {
  if(parseFloat(a["time"]) > parseFloat(b["time"])) return +1; 
  else 
  if(parseFloat(a["time"]) < parseFloat(b["time"])) return -1; 
  else 
  return 0
 }); 
 
 Editor_Presentation_DisplayScript();
 
 
 // MARK CURRENT SLIDE AS CHANGED
 Editor_Presentation_SlideChanged();
}



async function Editor_Presentation_PlayScript()
{
 var script = Core_State_Get("editor", ["selected-script"]);
 if(!script) return;
 
 var slide = script["slide"];
 
 // TAKE A SNAPSHOT OF THE SLIDE AS IT IS NOW, EXECUTE SCRIPT, WAIT A SECOND, RESTORE THE SLIDE AS IT WAS
 
 Presentation_Slide_Snapshot(slide);
 
 await Presentation_Script_Execute(script,
 // FOR EACH LINE THAT IS STARTED`
 function(line)
 {
  var control = line["control"];
  
  // MARK LINE AS EXECUTING
  control.style.border = "5px dashed var(--color-accented)";
 },
 
 // FOR EACH LINE THAT HAS BEEN EXECUTED
 function(line)
 {
  var control = line["control"];
  
  // MARK LINE AS EXECUTED 
  control.style.border = "5px solid var(--color-accented)";
	
  // UPDATE DISPLAY HELPERS TO REFLECT CHANGES
  Editor_Presentation_UpdateDisplayHelpers();
 });
 
 
 // GIVE TIME TO SEE CHANGES
 await Client_Wait(1.5);
 
 
 // RESET SLIDE TO INITIAL STATE
 Presentation_Slide_Reset(slide);
 Editor_Presentation_UpdateDisplayHelpers();
}









// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                           L I N E S                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



function Editor_Presentation_SelectLine(event)
{
 var script = Core_State_Get("editor", ["selected-script"]);
 if(!script) return;
 
 var element = event.currentTarget;
 var line    = Document_Element_GetObject(element, "line");

 Core_State_Set("editor", ["selected-line"], line);
 
 
 // HIGHLIGHT ELEMENT TARGETED BY THIS LINE
 Editor_Presentation_HighlightLineElement(line);
 
 
 // UPDATE DISPLAY TO REFLECT SELECTION
 Editor_Presentation_UpdateLineSelection();
}





function Editor_Presentation_UnselectLine()
{
 var line = Core_State_Get("editor", ["selected-line"]);
 if(!line) return;
 
 Core_State_Set("editor", ["selected-line"], false);
 
 // UPDATE DISPLAY TO REFLECT SELECTION
 Editor_Presentation_UpdateLineSelection();
}




function Editor_Presentation_UpdateLineSelection()
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 var selected_line = Core_State_Get("editor", ["selected-line"]);
 
 var container = UI_Element_Find(submodule, "script-lines");
 Document_Conditional_Class(container, "color-accented", 
 function(element)
 {
  return (Document_Element_GetObject(element, "line") == selected_line);
 });
}





function Editor_Presentation_UpdateLineHint(box, command)
{
 var page = Core_Data_Page("core/presentation-commands");
 var hint = Safe_Get(page, [command, "hint"], "");
 
 var control         = UI_Element_Find(box, "params");
 control.placeholder = hint;
}




function Editor_Presentation_UpdateLine(event)
{
 var control = event.currentTarget;
 
 var field = Document_Element_GetData(control, "uid");
 var line  = Document_Element_GetObject(control, "line");

 line[field] = control.value; 


 // DEPENDING ON FIELD THAT CHANGED, HIGHLIGHT CHANGES
 switch(field)
 {
  case "command":
	var box     = Document_Element_FindParent(control, "uid", "line");
	var command = line[field];
	
    Editor_Presentation_UpdateLineHint(box, command);
  break;
  
  case "element":
    Editor_Presentation_HighlightLineElement(line); 
  break;
 }
 
 
 // MARK CURRENT SLIDE AS CHANGED
 Editor_Presentation_SlideChanged();
}





function Editor_Presentation_NewLine(menu, item, event)
{
 var selected_script = Core_State_Get("editor", ["selected-script"]);
 if(!selected_script) return;
 
 var line = Presentation_Script_CreateLine(selected_script);
 
 Editor_Presentation_DisplayScript();
 
 // MARK CURRENT SLIDE AS CHANGED
 Editor_Presentation_SlideChanged();
}





function Editor_Presentation_DeleteLine(menu, item, event)
{
 var script = Core_State_Get("editor", ["selected-script"]);
 if(!script) return;
 
 var line = Core_State_Get("editor", ["selected-line"]);
 if(!line) return;
 
 Editor_Presentation_UnselectLine();
 
 var index = script["lines"].indexOf(line);
 if(index == -1) return;
 
 script["lines"].splice(index, 1);
 
 Editor_Presentation_DisplayScript();
 
 // MARK CURRENT SLIDE AS CHANGED
 Editor_Presentation_SlideChanged();
}




function Editor_Presentation_HighlightLineElement(line)
{
 // SELECT ELEMENT SPECIFIED IN THIS LINE (IF ANY)
 var slide   = Core_State_Get("editor", ["selected-slide"]);

 // FIND ELEMENT TARGETED BY THE LINE
 var element = Presentation_Slide_FindElement(slide, line["element"]);
 if(element) 
 {
  Editor_Presentation_SetSelectedElement(element);
 }
 else
 {
  Editor_Presentation_UnselectElement();
 }
 
}




async function Editor_Presentation_TestLine(event, line)
{
 // IF CALLED BY EVENT, DETERMINE LINE THROUGH EVENT SOURCE
 if(event)
 {
  var script = Core_State_Get("editor", ["selected-script"]);
  if(!script) return;
 
  var element = event.currentTarget;
  var line    = Document_Element_GetObject(element, "line");
 }
 
 if(!line) return;
 
 
 // GET ELEMENT AFFECTED BY THIS LINE
 var element = Presentation_Script_LineTarget(line);
 
 
 // EXECUTE LINE FOR TESTING (UPDATE DISPLAY HELPERS TO REFLECT CHANGES)
 await Presentation_Script_ExecuteLine(line);
 Editor_Presentation_UpdateDisplayHelpers();
 

 // WAIT 1.5 SECONDS TO GIVE TIME TO SEE CHANGES
 await Client_Wait(1.5);  
 
 
 // RESET AFFECTED ELEMENT AND RESTORE DISPLAY HELPERS
 if(element) Presentation_Element_Reset(element);
 Editor_Presentation_UpdateDisplayHelpers();
}










// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                           M E N U S                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



function Editor_Presentation_MenuScripts(menu, event)
{ 
 var selected_script = Core_State_Get("editor", ["selected-script"]);
  
 // SETUP MENU
 var items = UI_Menu_ListItems(menu);
 for(var id in items)
 {
  var item = items[id];
  
  if(item["tag"] == "modify" && !selected_script)  item["state"] = "disabled";
  else
  item["state"] = "enabled";
 }  
}



function Editor_Presentation_MenuLines(menu, event)
{ 
 var selected_line = Core_State_Get("editor", ["selected-line"]);


 // SETUP MENU
 var items = menu["items"];
 
 for(var id in items)
 {
  var item = items[id];
  
  if(item["tag"] == "modify" && !selected_line)  item["state"] = "disabled";
  else
  item["state"] = "enabled";
 }  
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      S L I D E S                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Editor_Presentation_SlidesControls()
{
 // LOAD TEMPLATES
 var paths     = await Core_Api("Editor_Templates_List", {content:"slides"});
 var templates = Object_From_Paths(paths); 
 Core_State_Set("editor", ["slides-templates"], templates);
	
	
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 var select    = UI_Element_Find(submodule, "slides-list");
 
 
 // PERMISSIONS
 if(User_Can("create-templates")) var cansavetemplate = "enabled"; else var cansavetemplate = false;
 
 
 // SLIDE MENU
 var menu = UI_Menu_Create("elements-create", 
 // MENU ITEMS
 {
  moveup:
  {
   icon:    "arrow-up", 
   text:    UI_Language_String("editor", "slide menu moveup"),
   state:  "enabled",
   func:    function(menu){Editor_Presentation_MoveSlideUp()}
  },
  
  movedown:
  {
   icon:    "arrow-down", 
   text:    UI_Language_String("editor", "slide menu movedown"),
   state:  "enabled",
   func:    function(menu){Editor_Presentation_MoveSlideDown()}
  },
  
  /*
  swap:
  {
   icon:    "arrow-right-arrow-left", 
   text:    UI_Language_String("editor", "slide menu swap"),
   state:  "enabled",
   func:    Editor_Presentation_SwapSlides
  },
  */
  
  reset:
  {
   icon:    "arrows-rotate", 
   text:    UI_Language_String("editor", "slide menu reset"),
   state:  "enabled",
   func:    function(menu){Editor_Presentation_ResetSlide()}
  },

  newslide:
  {
   icon:    "plus", 
   text:    UI_Language_String("editor", "slide menu new"),
   state:  "enabled",
   func:    function(menu){Editor_Presentation_NewSlide()}
  },
  
  duplicate:
  {
   icon:    "clone", 
   text:    UI_Language_String("editor", "slide menu duplicate"),
   state:  "enabled",
   func:    Editor_Presentation_DuplicateSlide
  },


  break1: {},
  
  savetemplate:
  {
   icon:    "star", 
   text:    UI_Language_String("editor", "slide menu savetemplate"),
   state:   cansavetemplate,
   func:    Editor_Presentation_SaveSlideTemplate
  },
 
  loadtemplate:
  {
   icon:    "star-half-stroke", 
   text:    UI_Language_String("editor", "slide menu loadtemplate"),
   state:  "enabled",
   func:    Editor_Presentation_LoadSlideTemplate
  },
  
  break2: {},
 
  delete:
  {
   icon:   "trash-can", 
   text:    UI_Language_String("editor", "slide menu delete"),
   enabled: true,
   func:    function(menu){Editor_Presentation_DeleteSlide()}
  }
 },
 
 // MENU EVENTS
 {
  onshow: Editor_Presentation_MenuSlide
 }); 
 
 UI_Menu_Assign(select, menu);	
	
 // MANAGE KEYPRESS
 select.onkeyup = Editor_Presentation_MoveSlide;
	
	
	
	
 // SLIDE PROPERTIES HANDLER
 var container = UI_Element_Find(submodule, "slide-properties");
 var elements  = Document_Element_FindChildren(container, "uid", undefined, ["recurse"]);
 for(var element of elements)
 {
  var id = Document_Element_GetData(element, "uid");
  id = id.split("-");
  
  if(id[0] == "slide")
  {
   element.onchange = Editor_Presentation_UpdateSlide;
  }
 }
 
  
 // STAGE SELECT
 var select = UI_Element_Find(submodule, "slide-stage");
 UI_Select_FromDatapage(select, "presentation/stages");
 
}




function Editor_Presentation_ListSlides()
{
 var presentation = Core_State_Get("editor", ["presentation"], {});
 var slides       = Safe_Get(presentation, ["slides"], []);
 var selected     = Core_State_Get("editor", ["selected-slide"], undefined);

 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 // LIST SLIDES
 var select       = UI_Element_Find(submodule, "slides-list");
 select.innerHTML = ""; 
 
 for(var slide of slides)
 {   
  var value  = slide["id"];
  var text   = slide["header"]["name"];
  var option = Document_Select_AddOption(select, text, value);
  
  option.selected = (slide == selected);
  
  // LINK
  slide["option"] = option;
  Document_Element_SetObject(option, "slide", slide);
  
  option.onclick = Editor_Presentation_SelectSlide;
 }
 
  
}






function Editor_Presentation_SelectSlide(event, slide)
{ 
 // UNSELECT CURRENTLY SELECTED ELEMENT
 Editor_Presentation_UnselectElement();
 
 // UNSELECT CURRENTLY SELECTED SCRIPT
 Editor_Presentation_UnselectScript();
 
 // SAVE CURRENTLY SELECTED SLIDE
 var current = Core_State_Get("editor", ["selected-slide"]);
 if(current) Editor_Presentation_SaveSlide(current);
 
 
 if(!slide)
 {
  // SELECT NEW SLIDE AND UPDATE
  var slide = Document_Element_GetObject(event.currentTarget, "slide");
  if(!slide) return;
 }
 
 
 // IF SELECTED PROGRAMMATICALLY, UPDATE LISTBOX SELECTION
 if(!event && slide)
 {
  var select           = UI_Element_Find("slides-list");
  select.selectedIndex = Presentation_Slide_Index(slide["presentation"], slide);
 }
 
 // SET AS SELECTED
 Core_State_Set("editor", ["selected-slide"], slide);
 
 
 // RENDER CURRENT SLIDE
 Presentation_Slide_Display(slide);
 
 
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 // LIST THIS SLIDE'S ELEMENTS
 UI_Element_Find(submodule, "elements-list").style.visibility = "visible";
 Editor_Presentation_ListElements();
 
 
 // LIST THIS SLIDE'S SCRIPTS
 UI_Element_Find(submodule, "scripts-list").style.visibility = "visible";
 Editor_Presentation_ListScripts();
 

 // DISPLAY SLIDE PROPERTIES ON PANEL
 Editor_Presentation_DisplaySlide();
 
 
 // DISPLAY SLIDE TITLE
 var title = Safe_Get(slide, ["header", "name"], "");
 UI_Element_Find(submodule, "slide-title").innerHTML = title;
}





function Editor_Presentation_UnselectSlide()
{
 var slide = Core_State_Get("editor", ["selected-slide"]);
 if(!slide) return;
 
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 // CLEAR SLIDE DISPLAY
 var display = UI_Element_Find(submodule, "slides-slide");
 display.style.backgroundColor = "transparent";
 display.innerHTML = "";
 
 // UNSELECT SLIDE
 Core_State_Set("editor", ["selected-slide"], undefined);
 
 // HIDE PANELS THAT ARE NOT SUPPOSED TO BE SEEN IF NO SLIDE IS SELECTED
 UI_Element_Find(submodule, "slide-properties").style.visibility = "hidden";
 UI_Element_Find(submodule, "elements-list").style.visibility    = "hidden";
 UI_Element_Find(submodule, "scripts-list").style.visibility     = "hidden";
 
 
 // UNSELECT THINGS THARE NOT SUPPOSED TO BE SELECTED IF NO SLIDE IS SELECTED
 Editor_Presentation_UnselectElement();
 Editor_Presentation_UnselectScript();
 
 // TITLE
 UI_Element_Find(submodule, "slide-title").innerHTML = "";
 
 // SAVE
 Editor_Presentation_SaveSlide(slide);
}




async function Editor_Presentation_SwapSlides(presentation, index_a, index_b)
{
 var temp                              = presentation["slides"][index_b]["id"];
 presentation["slides"][index_b]["id"] = presentation["slides"][index_a]["id"];
 presentation["slides"][index_a]["id"] = temp;
 
 var temp                        = presentation["slides"][index_b];
 presentation["slides"][index_b] = presentation["slides"][index_a];
 presentation["slides"][index_a] = temp;
 
 await Editor_Presentation_SaveSlide(presentation["slides"][index_a], true);
 await Editor_Presentation_SaveSlide(presentation["slides"][index_b], true);
}




async function Editor_Presentation_MoveSlide(event)
{
 if(!event.ctrlKey) return;
 var swapping = Core_State_Get("editor", ["presentation", "swapping-slides"]);
 if(swapping) return;
 
 Core_State_Set("editor", ["presentation", "swapping-slides"], true);
 
 switch(event.key)
 {
  case "ArrowDown":
     await Editor_Presentation_MoveSlideDown();
  break;
  
  case "ArrowUp":
	await Editor_Presentation_MoveSlideUp();
  break;
 }
	 
 Core_State_Set("editor", ["presentation", "swapping-slides"], false);
}




async function Editor_Presentation_MoveSlideUp()
{
 var presentation = Core_State_Get("editor", ["presentation"]);
 
 var slide = Core_State_Get("editor", ["selected-slide"]);
 if(!slide) return;
 
 var index = presentation["slides"].indexOf(slide);
 
 if(index > 0)
 {  
  await Editor_Presentation_SwapSlides(presentation, index - 1, index);
 }
 
 // UPDATE SLIDES LIST DISPLAY
 Editor_Presentation_ListSlides();
}




async function Editor_Presentation_MoveSlideDown()
{
 var presentation = Core_State_Get("editor", ["presentation"]);
 
 var slide = Core_State_Get("editor", ["selected-slide"]);
 if(!slide) return;
 
 var index = presentation["slides"].indexOf(slide);
 
 if(index < presentation["slides"].length - 1)
 {
  await Editor_Presentation_SwapSlides(presentation, index, index + 1);
 }
 
 // UPDATE SLIDES LIST DISPLAY
 Editor_Presentation_ListSlides();
}




function Editor_Presentation_DeleteSlide(event)
{
 var presentation = Core_State_Get("editor", ["presentation"]);
 
 var slide = Core_State_Get("editor", ["selected-slide"]);
 if(!slide) return;
 
 // UNSELECT CURRENTLY SELECTED ELEMENT BEFORE DELETING THE SLIDE
 Editor_Presentation_UnselectElement();

 // UNSELECT CURRENTLY SELECTED SLIDE BEFORE DELETING IT
 Editor_Presentation_UnselectSlide();
 
 // DELETE THE SLIDE
 var index = presentation["slides"].indexOf(slide);;
 presentation["slides"].splice(index, 1);
 
 
 // DELETE IMMEDIATELY
 Core_Api("Presentation_DeleteSlide", {path:presentation["path"], slide_id:slide["id"]});


 // UPDATE SLIDES LIST DISPLAY
 Editor_Presentation_ListSlides();
}





function Editor_Presentation_NewSlide(event)
{
 var presentation = Core_State_Get("editor", ["presentation"]);
 
 
 // CREATE NEW SLIDE
 var slide = Presentation_Slide_Create(undefined, {}, presentation);
 
 
 // SAVE IMMEDIATELY
 Editor_Presentation_SaveSlide(slide, true);
 
 
 // SELECT AND DISPLAY
 Core_State_Set("editor", ["selected-slide"], slide);
 Editor_Presentation_ListSlides();
}





function Editor_Presentation_DuplicateSlide()
{
 var slide = Core_State_Get("editor", ["selected-slide"]);
 if(!slide) return;
 
 // DUPLICATE CURRENT SLIDE
 var duplicate = Presentation_Slide_Duplicate(slide); 
 
 // SAVE IMMEDIATELY
 Editor_Presentation_SaveSlide(duplicate, true);
 
 // UPDATE SLIDES LIST
 Editor_Presentation_ListSlides();
}





function Editor_Presentation_DisplaySlide()
{
 // GET SELECTED ELEMENT INFO
 var slide = Core_State_Get("editor", ["selected-slide"]);
 if(!slide) return;

 // GET SUBMODULE BODY
 var submodule = Module_Page_Body(); 

 var container = UI_Element_Find(submodule, "slide-properties");
 var controls  = Document_Element_FindChildren(container, "uid", undefined, ["recurse"]);
 for(var control of controls)
 {
  // GET WHAT ELEMENT PROPERTY THIS CONTROL... CONTROLS
  var id     = Document_Element_GetData(control, "uid");
  var field  = id.split("-");  
  field      = field.slice(1, field.length).join("-");
  
  control.value = slide["header"][field] || ""; 

  Editor_Control_UpdateQuirks(control);
 }	 
 
 UI_Element_Find(submodule, "slide-properties").style.visibility = "visible";
}




async function Editor_Presentation_UpdateSlide(event)
{	 
 // GET CURRENT PRESENTATION 
 var presentation = Core_State_Get("editor", ["presentation"], {});


 // GET CONTROL INFO AND PROPERTY THAT IT AFFECTS
 var control = event.currentTarget;
 var id      = Document_Element_GetData(control, "uid");
 
 
 // GET SELECTED SLIDE INFO
 var slide = Core_State_Get("editor", ["selected-slide"]);
 if(!slide) return;
 
 
 var field  = id.split("-");  
 field      = field.slice(1, field.length).join("-");
 

 
 switch(field)
 {
  case "name":
	slide["header"][field] = control.value; 
	
	var option  = slide["option"];
	option.text = control.value;
  break;
  
  case "color":
	slide["header"][field] = control.value; 
	
	Presentation_Slide_Display(slide);
  break;
  
  default:
	slide["header"][field] = control.value; 
  break;
 }
 
 
 Editor_Control_UpdateQuirks(control);
 
 
 // MARK CURRENT SLIDE AS CHANGED
 Editor_Presentation_SlideChanged();
}





function Editor_Presentation_SlideChanged(slide)
{
 if(!slide) var slide = Core_State_Get("editor", ["selected-slide"]);
 if(!slide) return;
 
 slide["changed"] = true;
}




function Editor_Presentation_ResetSlide(slide)
{
 if(!slide) var slide = Core_State_Get("editor", ["selected-slide"]);
 if(!slide) return;
 
 // RESET AND REDRAW
 Presentation_Slide_Reset(slide);
 Presentation_Slide_Display(slide);
 
 // UPDATE ELEMENTS LIST
 //Editor_Presentation_ListElements();
}




async function Editor_Presentation_SaveSlideTemplate()
{
 var presentation = Core_State_Get("editor", ["presentation"]);
 
 var slide = Core_State_Get("editor", ["selected-slide"]);
 if(!slide) return;
 
 
 var picture  = Resources_URL("images/cover-files.jpg");
 var title    = UI_Language_String("editor/presentation", "template save title");
 var button   = UI_Language_String("editor/presentation", "template save button");
 var subtitle = false;
 
 var text         = {};
 text["name"]     = UI_Language_String("editor/presentation", "template save name");
 text["category"] = UI_Language_String("editor/presentation", "template save category");

 var content = UI_Element_Create("editor/slides-savetemplate", text); 
 
 var category_select  = UI_Element_Find(content, "category");
 UI_Select_FromDatapage(category_select, "editor/slides-templates", undefined);
 
 var name_edit        = UI_Element_Find(content, "name");
 
 var save = 
 async function()
 {
  var source    = Safe_Get(slide, ["presentation", "path"]);
  var source_id = slide["id"];
  var category  = category_select.value;
  var name      = name_edit.value.trim() ?? slide_id;
  var dest      = "content/templates/slides/" + category + "/" + name;
  var dest_id   = "slide";
  
  await Core_Api("Presentation_CopySlide", {source, source_id, dest, dest_id});
  
  UI_Popup_Close(popup);
 }
 
 var popup = await UI_Popup_Create({title, subtitle, picture, content}, [{text:button, onclick:save}], undefined, {escape:true, open:true});
}



async function Editor_Presentation_LoadSlideTemplate()
{
 // GET CURRENT INFO
 var presentation = Core_State_Get("editor", ["presentation"]); 
 
 var slide = Core_State_Get("editor", ["selected-slide"]);
 if(!slide) return;
 
 
 // POPUP 
 var picture  = Resources_URL("images/cover-files.jpg");
 var title    = UI_Language_String("editor/presentation", "template load title");
 var button   = UI_Language_String("editor/presentation", "template load button");
 var subtitle = false;
 
 var content   = UI_Element_Create("editor/slides-loadtemplate", {}); 

 var categories      = Core_State_Get("editor", "slides-templates");
 var keys            = Object.keys(categories);
 var category_select = UI_Element_Find(content, "category"); 
 for(var key of keys)
 {   
  var text = UI_Language_String("editor/slides-templates", key);
  Document_Select_AddOption(category_select, text, key);
 }
 
 category_select.onchange = 
 function()
 {
  var name_select = UI_Element_Find(content, "name");
  Document_Select_Clear(name_select);
  
  var categories = Core_State_Get("editor", "slides-templates");
  var category   = category_select.value;
  var names      = Object.keys(categories[category] || {});
   
  for(var name of names)
  {
   Document_Select_AddOption(name_select, name, name);
  }	  
 }
 
 category_select.onchange();


 // ON CONFIRM
 var load = 
 async function()
 { 
  // GET CURRENT INFO
  var presentation = Core_State_Get("editor", ["presentation"]); 
 
  var slide = Core_State_Get("editor", ["selected-slide"]);
  if(!slide) return;
  
  var name_select     = UI_Element_Find(content, "name");
  var category_select = UI_Element_Find(content, "category"); 


  // COPY FROM SELECTED TEMPLATE TO CURRENT SLIDE
  var source    = "content/templates/slides/" + category_select.value + "/" + name_select.value;
  var source_id = "slide";
 
  var dest     = presentation["path"];
  var dest_id  = slide["id"];
  
  await Core_Api("Presentation_CopySlide", {source, source_id, dest, dest_id});
  
  
  // RELOAD SLIDE
  var slide = await Presentation_Slide_Reload(dest, dest_id, presentation);

  

  // UPDATE STRUCTURES AND DISPLAYS, AND AUTOSELECT SLIDE
  await Presentation_UpdateResources(presentation);

  Editor_Presentation_ListResources();
  Editor_Presentation_ListSlides();

  Editor_Presentation_SelectSlide(false, slide);
  Editor_Presentation_ListElements();
  Editor_Presentation_ListScripts();  
  
  // CLOSE
  UI_Popup_Close(popup);
 }
 
 var popup = await UI_Popup_Create({title, subtitle, picture, content}, [{text:button, onclick:load}], undefined, {escape:true, open:true});
}





// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                           M E N U S                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//




function Editor_Presentation_MenuSlide(menu)
{
 var selected_slide = Core_State_Get("editor", ["selected-slide"]);
  
 var menu_item = UI_Menu_GetItem(menu, "delete");
 if(selected_slide) menu_item["state"] = "enabled"; else menu_item["state"] = "disabled"; 	
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                            T E S T                                             //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Editor_Test()
{
 // FLUSH EDITOR FROM CERTAIN SAVED STATES
 Editor_Flush();
 
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 
 
 // IMMEDIATELY SET TEST MODULE TO EDIT MODE
 Core_State_Set("test", ["mode"], "edit");
 
 
 // DETERMINE TEST TO EDIT
 var source = false;
  
 // SET BY ANOTHER MODULE? 
 if(!source)
 {
  var source = Core_State_Get("editor", ["edit-test"], false);
  if(source)
  {
   // UNSET
   Core_State_Set("editor", ["edit-test"], false);
  }
 }
 
 // JUST SET IT TO THE USER'S TEMP FOLDER
 if(!source)
 {
  var user_id = Safe_Get(application, ["user", "id"]); 
  var source  = Resources_URL("temp/editor/test", "user", user_id);
 }
 
 Core_State_Set("editor", ["current-source"], source);
 
	
 // READ WIP TEST
 var test = await Test_Load(source);   
 
  
 
 // SET AS CURRENTLY EDITED
 Core_State_Set("editor", ["test"], test);
 
 
 // STORE AS LAST TEST EDITED
 Core_Api("User_Config_WriteValue", {file:"editor", section:"wip", field:"test", value:source});

 
 // SHEETS LIST SELECT
 var list     = UI_Element_Find(submodule, "test-sheets-list");
 list.onclick = Editor_Test_SelectSheet;
 
 
 // SHEETS LIST MENU 
 var submenu = UI_Menu_FromObject("new", Core_Data_Page("test/types"), false, Editor_Test_NewSheet);

 var menu = UI_Menu_Create("sheets-list", 
 // MENU ITEMS
 {
  new:
  {
   icon:    "clipboard-list", 
   text:    UI_Language_String("editor", "test sheets-menu new"),
   state:   "enabled",
   tag:     "new",
   submenu: submenu
  },
  
  duplicate:
  {
   icon:    "clone", 
   text:    UI_Language_String("editor", "test sheets-menu duplicate"),
   state:   "enabled",
   tag:     "modify",
   func:    Editor_Test_DuplicateSheet
  },
  
  moveup:
  {
   icon:    "arrow-up", 
   text:    UI_Language_String("editor", "test sheets-menu moveup"),
   state:   "enabled",
   tag:     "new",
   func:    Editor_Test_MoveupSheet
  },
  
  movedown:
  {
   icon:    "arrow-down", 
   text:    UI_Language_String("editor", "test sheets-menu movedown"),
   state:   "enabled",
   tag:     "new",
   func:    Editor_Test_MovedownSheet
  },
  
  break1:
  {
  },
  
  delete:
  {
   icon:  "trash-can", 
   text:  UI_Language_String("editor", "test sheets-menu delete"),
   state: "enabled",
   tag:   "modify",
   func:  Editor_Test_DeleteSheet
  }
 },
 
 // MENU EVENTS
 {
  onshow: Editor_Test_MenuSheets
 }); 
  
 var list = UI_Element_Find(submodule, "test-sheets-list");
 UI_Menu_Assign(list, menu, {direction:"bottom right"});


 
 // ASSEMBLE TEST SOURCES
 var sources         = Core_State_Get("editor", ["test", "sources"], {});
 sources["outcomes"] = await Resources_Outcomes(false, "list");
 
 Core_State_Set("editor", ["test", "sources"], sources);
 

 // SET TEST PREVIEW
 UI_Element_Find(submodule, "preview-practice").onclick = Editor_Test_Preview;
 UI_Element_Find(submodule, "preview-test").onclick     = Editor_Test_Preview;


 // SET TEST EXPORT
 UI_Element_Find(submodule, "export").onclick =
 function()
 {
  var filename = "test.zip";
  Editor_Download(filename);
 }
 
 
 
 // SET UP UPLOAD OF NEW RESOURCES
 var icon     = UI_Element_Find(submodule, "upload-resources");
 icon.onclick = Editor_Test_AddResources;

 Document_Handler_FileDrop(UI_Element_Find(submodule, "resources-list"), {}, 
 function(files)
 {
  Editor_Test_AddResources(false, files);
 });

 // DISPLAY TEST RESOURCES
 UI_Element_Find(submodule, "resources-list").onclick = Editor_Resource_Preview;
 
 Editor_Test_ListResources();
 
 
 // DISPLAY TEST SHEETS
 Editor_Test_ListSheets();
}






// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                     R E S O U R C E S                                          //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



async function Editor_Test_AddResources(event, files)
{
 if(!files)
 {
  var files  = await Storage_File_Select({multiple:true});
 }
 
 var current = Core_State_Get("editor", ["test", "resources"], []); 
 
 await Editor_Resources_Upload(files, current);
 
 Editor_Test_ListResources();
 
 Editor_Test_DisplaySheet();
}





function Editor_Test_ListResources()
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 var resources = Core_State_Get("editor", ["test", "resources"], []);
 var container = UI_Element_Find(submodule, "resources-list");
 
 var sources = Core_State_Get("editor", ["test", "sources"]);
 Editor_Resources_Catalog(resources, sources);
 
 Editor_Resources_Display(resources, container);
}






// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                           M I S C                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



async function Editor_Test_Preview(event)
{ 
 if(event)
 {
  var element = event.currentTarget;
  var mode    = Document_Element_GetData(element, "uid");
  mode        = mode.split("-");
  mode        = mode[1];
 }
 else
 {
  var mode = "preview";
 }
 
 var source  = Core_State_Get("editor", ["current-source"]);
 console.log(source, mode);
 
 // CURRENT SHEET
 var sheets = Core_State_Get("editor", ["test", "sheets"], []);
 var sheet  = Core_State_Get("editor", ["selected-sheet"], {});
 var index  = sheets.indexOf(sheet);
 
 if(!index) index = 0;

 
 await Activity_Run(source,
 {
  display:    "popup", 
  escape:     true, 
  mode, 
  navigation: true,
  sheet:      index,
  student:    -1
 }); 
 
 // SANITIZE TEST POST PREVIEW
 var sheets = Core_State_Get("editor", ["test", "sheets"]);
 
 for(var sheet of sheets)
 { 
  var type   = Safe_Get(sheet, ["info", "type"]);
  var config = Core_Data_Page("test/" + type);
 
  Data_Page_Sanitize(sheet, config);
 }
 
 // BACK TO EDIT MODE
 Test_Mode("edit");
}



function Editor_Test_SelectionRectangle(rectangle)
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 
 var editor  = Core_State_Get("editor", ["test", "editor"]);
 if(!editor) return;
  
 var section = Document_Element_GetObject(editor, "selectedsection");
 if(!section) return;
 
 // IF SECTION HAS COORDINATES, USE THE RECTANGLE TO CHANGE THEM
 if(section["left"])
 {
  section["left"]   = parseInt(rectangle.style.left);
  section["top"]    = parseInt(rectangle.style.top);
  section["width"]  = parseInt(rectangle.style.width);
  section["height"] = parseInt(rectangle.style.height);
  
  var sheet = Document_Element_GetObject(editor, "data");
  Editor_Test_PreviewSheet(sheet);
 }
 
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                         S H E E T S                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Editor_Test_ListSheets()
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 
 var list     = UI_Element_Find(submodule, "test-sheets-list");
 var test     = Core_State_Get("editor", ["test"], {}); 
 var selected = Core_State_Get("editor", ["selected-sheet"]);
 var sheets   = test["sheets"] || [];
 
 
 list.innerHTML = "";
 for(var sheet of sheets)
 {
  var type  = Safe_Get(sheet, ["info", "type"], "unknown");
  
  var text  = UI_Language_String("test/types", type);
  var value = sheet["id"];
  
  var option      = Document_Select_AddOption(list, text, value, sheet);
  option.selected = (sheet == selected);
 }
 
 list.onkeyup = Editor_Test_MoveSheet;
}




function Editor_Test_UnselectSheet()
{
 var sheet = Core_State_Get("editor", ["selected-sheet"]);
 
 // UNSELECT IN STATE
 if(sheet)
 {
  Core_State_Set("editor", ["selected-sheet"], false);
 }
 
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 
 // UNSELECT IN LISTBOX
 UI_Element_Find(submodule, "test-sheets-list").selectedIndex = -1;
 
 // HIDE CONTROLS
 UI_Element_Find(submodule, "sheet-panel-edit").style.visibility = "hidden";
 UI_Element_Find(submodule, "sheet-panel-preview").style.visibility = "hidden";
 
 // SAVE
 Editor_Test_SaveSheet(sheet);
}




function Editor_Test_SelectSheet(event, sheet)
{ 
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 // FIRST OF ALL, UPDATE AND SAVE CURRENT
 Editor_Test_UpdateSheet();
 Editor_Test_SaveSheet();
 
 var list = UI_Element_Find(submodule, "test-sheets-list");
 
 // SELECT IN LISTBOX
 if(sheet)
 {
  var option      = Document_Select_OptionByObject(list, sheet);
  option.selected = true;
 }
 
 var index = list.selectedIndex;
 if(index == -1) return;
 
 
 // SELECT IN STATE
 var option = list.options[index];
 var sheet  = Document_Element_GetObject(option, "object");
 
 Core_State_Set("editor", ["selected-sheet"], sheet);
 
 
 // DISPLAY
 Editor_Test_DisplaySheet();
 
 
 // SHOW PANELS IF NOT VISIBLE ALREADY
 UI_Element_Find(submodule, "sheet-panel-edit").style.visibility    = "visible";
 UI_Element_Find(submodule, "sheet-panel-preview").style.visibility = "visible";
}







function Editor_Test_DisplaySheet(sheet)
{
 // DETERMINE SHEET: EXPLICIT OR CURRENTLY SELECTED
 if(!sheet)
 {
  var sheet = Core_State_Get("editor", ["selected-sheet"], {});
 }
 
 if(!sheet) return;
 
 var type       = Safe_Get(sheet, ["info", "type"]);
 var config     = Core_Data_Page("test/" + type);
 var sources    = Core_State_Get("editor", ["test", "sources"], {});

 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 var container = UI_Element_Find(submodule, "test-sheet-edit");
 
 // DISPLAY SHEET SOURCE AS EDITABLE INI
 var editor = Editor_Data(container, sheet, config, sources,
 // ON CHANGE, PREVIEW SHEET AND SAVE IT
 function(editor)
 {
  var sheet = Document_Element_GetObject(editor, "data");
   
  // UPDATE PREVIEW 
  Editor_Test_PreviewSheet(sheet);
  
  // FORCED SAVE
  Editor_Test_SaveSheet(sheet, true);
 });
 
 Core_State_Set("editor", ["test", "editor"], editor);
 
 Editor_Test_PreviewSheet(sheet);
}





function Editor_Test_PreviewSheet(sheet)
{ 
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 var display = UI_Element_Find(submodule, "test-sheet-display");
 Test_Sheet_Display(sheet, display); 
 
 
 // ACTIVATE OR DEACTIVATE SPECIAL TOOLS BASED ON TEST TYPE
 var type = Safe_Get(sheet, ["info", "type"]); 
 switch(type)
 {
  case "identify-items":
    var element = UI_Element_Find(submodule, "test-main-content");
	Document_Handler_SelectionRectangle(element, "style-outlined-accented", false, Editor_Test_SelectionRectangle);
  break;
 }
}




function Editor_Test_UpdateSheet()
{
 var sheet = Core_State_Get("editor", ["selected-sheet"]);
 if(!sheet) return;
 
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();

 var edit      = UI_Element_Find(submodule, "test-sheet-edit");
 
 // MARK FOR SAVING
 sheet["changed"] = true;
 
 Editor_Test_PreviewSheet(sheet);
}





async function Editor_Test_NewSheet(item)
{
 var test = Core_State_Get("editor", ["test"]);
 
 // DETERMINE ID BASED ON EXISTING SHEETS
 var max = 0;
 for(var sheet of test["sheets"])
 {  
  var n = parseInt(sheet["id"]);
  if(n > max) max = n;
 }
 max         = max + 1;

 
 // DETERMINE WHAT TYPE OF SHEET ARE WE CREATING
 var type      = Document_Element_GetData(item, "uid");
 var config    = Core_Data_Page("test/" + type);
 var sheet     = Data_Page_FromConfig(config);

 sheet["id"] = String(max).padStart(2, "0");
 test["sheets"].push(sheet);
 
 sheet["source"] = test["source"]; 
 
 await Core_Api("Test_Sheet_Write", {path:test["source"], sheet_id:sheet["id"], data:sheet});
 
 // SELECT AND DISPLAY
 Editor_Test_ListSheets(); 
 Editor_Test_SelectSheet(null, sheet);
}





async function Editor_Test_DuplicateSheet()
{
 var test  = Core_State_Get("editor", ["test"], {});
 var sheet = Core_State_Get("editor", ["selected-sheet"], {});
 
 var duplicate = JSON.parse(JSON.stringify(sheet));

 // DETERMINE ID BASED ON EXISTING SHEETS
 var max = 0;
 for(var sheet of test["sheets"])
 {  
  var n = parseInt(sheet["id"]);
  if(n > max) max = n;
 }
 max             = max + 1;
 duplicate["id"] = String(max).padStart(2, "0");
 
 duplicate["source"] = test["source"];
 
 test["sheets"].push(duplicate);
 
 await Core_Api("Test_Sheet_Write", {path:test["source"], sheet_id:duplicate["id"], data:duplicate});
 
 
 // SELECT AND DISPLAY
 Editor_Test_ListSheets(); 
 Editor_Test_SelectSheet(null, duplicate);
}




async function Editor_Test_DeleteSheet()
{
 var test  = Core_State_Get("editor", ["test"], {});
 var sheet = Core_State_Get("editor", ["selected-sheet"], {});
 
 // UNSELECT CURRENT SHEET
 Editor_Test_UnselectSheet();
 
 // DELETE
 await Core_Api("Test_Sheet_Delete", {path:test["source"], sheet_id:sheet["id"]});
 Array_Element_Delete(test["sheets"], sheet);

 // REFRESH LIST OF SHEETS
 Editor_Test_ListSheets(); 
}






function Editor_Test_SwapSheets(test, index_a, index_b)
{
 var temp                      = test["sheets"][index_b]["id"];
 test["sheets"][index_b]["id"] = test["sheets"][index_a]["id"];
 test["sheets"][index_a]["id"] = temp;
 
 var temp                = test["sheets"][index_b];
 test["sheets"][index_b] = test["sheets"][index_a];
 test["sheets"][index_a] = temp;
 
 Editor_Test_SaveSheet(test["sheets"][index_a], true);
 Editor_Test_SaveSheet(test["sheets"][index_b], true);
}




function Editor_Test_MoveupSheet()
{
 var test = Core_State_Get("editor", ["test"]);
 
 var sheet = Core_State_Get("editor", ["selected-sheet"]);
 if(!sheet) return;
 
 var index = test["sheets"].indexOf(sheet);
 
 if(index > 0)
 {  
  Editor_Test_SwapSheets(test, index - 1, index);
 }
 
 // UPDATE sheetS LIST DISPLAY
 Editor_Test_ListSheets();
}




function Editor_Test_MovedownSheet()
{
 var test = Core_State_Get("editor", ["test"]);
 
 var sheet = Core_State_Get("editor", ["selected-sheet"]);
 if(!sheet) return;
 
 var index = test["sheets"].indexOf(sheet);
 
 if(index < test["sheets"].length - 1)
 {
  Editor_Test_SwapSheets(test, index, index + 1);
 }
 
 // UPDATE sheetS LIST DISPLAY
 Editor_Test_ListSheets();
}





async function Editor_Test_MoveSheet(event)
{
 if(!event.ctrlKey) return;
 var swapping = Core_State_Get("editor", ["test", "swapping-sheets"]);
 if(swapping) return;
 
 Core_State_Set("editor", ["test", "swapping-sheets"], true);
 
 switch(event.key)
 {
  case "ArrowDown":
     await Editor_Test_MovedownSheet();
  break;
  
  case "ArrowUp":
	await Editor_Test_MoveupSheet();
  break;
 }
	 
 Core_State_Set("editor", ["test", "swapping-sheets"], false);
}





function Editor_Test_ResourceToSheet(item)
{
 var id     = Document_Element_GetData(item, "uid");
 
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
  
 var edit      = UI_Element_Find(submodule, "test-sheet-edit"); 
 edit.value    = edit.value.substring(0, edit.selectionStart) + id + edit.value.substr(edit.selectionEnd);
 
 Editor_Test_UpdateSheet();
}



function Editor_Test_MenuSheets(menu)
{
}



async function Editor_Test_SaveSheet(sheet, forced)
{
 if(!User_Can("modify-content")) return;
 
 
 // IF NO SHEET PASSED, SAVE CURRENT
 if(!sheet) var sheet = Core_State_Get("editor", ["selected-sheet"]);
 if(!sheet) return;

 // SHEET HAS CHANGES TO SAVE OR FORCED SAVE?
 if(!forced && !sheet["changed"]) return;
 var test = Core_State_Get("editor", ["test"]);

 // SAVE
 await Core_Api("Test_Sheet_Write", {path:test["source"], sheet_id:sheet["id"], data:sheet});
 
 delete sheet["changed"];
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                    V O C A B U L A R Y                                         //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



async function Editor_Vocabulary()
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 
 // TERMS LIST
 var list = UI_Element_Find(submodule, "terms-list");
 list.onclick = Editor_Vocabulary_Select;
 
 
 // ICONS
 UI_Element_Find(submodule, "vocab-new").onclick    = Editor_Vocabulary_New;
 UI_Element_Find(submodule, "vocab-delete").onclick = Editor_Vocabulary_Delete;
 UI_Element_Find(submodule, "vocab-find").onclick   = Editor_Vocabulary_Find;
 

 // PICTURE UPLOAD
 UI_Element_Find(submodule, "term-picture").onclick = Editor_Vocabulary_UploadPicture;

 // AUDIO UPLOAD
 UI_Element_Find(submodule, "term-audio-upload").onclick = Editor_Vocabulary_UploadAudio;
 
 // AUDIO PLAYBACK
 UI_Element_Find(submodule, "term-audio-listen").onclick = Editor_Vocabulary_PlayAudio;


 // DISPLAY VOCABULARY TERMS
 await Editor_Vocabulary_List();
 
 
 // READ WIP
 var wip = await Core_Api("User_Config_Read", {file:"editor", section:"wip", field:"vocabulary"});
 if(wip)
 {
  var list = UI_Element_Find(submodule, "terms-list");
  Document_Select_SelectByValue(list, wip);
 
  Editor_Vocabulary_Select();
 }
}



async function Editor_Vocabulary_List()
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
	
	
 // STORE LIST FOR LATER USE
 var terms = await Resources_Vocabulary(false, "list");
 
 // DISPLAY
 var list       = UI_Element_Find(submodule, "terms-list");
 list.innerHTML = "";
 for(var term of terms)
 {
  Document_Select_AddOption(list, term, term);
 }
}




async function Editor_Vocabulary_Select(event)
{ 
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 var container = UI_Element_Find(submodule, "term-edit");
 var list      = UI_Element_Find(submodule, "terms-list");
 
 Document_Element_Disable(container, "style-disabled");
 Document_Element_Disable(list,      "style-disabled");
 
 
 
 if(list.selectedIndex == -1) return;
 
 var option = list.options[list.selectedIndex];
 var id     = option.value;
 var path   = "content/vocabulary/" + id;
 
 Core_State_Set("editor", ["vocabulary", "selected-term"], id);
  
 var data     = await Core_Api("Vocabulary_Read_Term", {source:"content/vocabulary/" + id});
 var config   = Core_Data_Page("vocabulary/template");
 var template = Data_Page_FromConfig(config);
 var term     = Data_Page_Complete(data, template);
 
 
  
 // DISPLAY DATA
 Editor_Data(container, term, config, {}, Editor_Vocabulary_Save);
 
 // DISPLAY PICTURE
 UI_Element_Find(submodule, "term-picture").src = path + "/picture.png" + "?c=" + Date.now();
  
 UI_Element_Find(submodule, "term-panel-edit").style.visibility    = "visible";
 UI_Element_Find(submodule, "term-media-preview").style.visibility = "visible";
 
 // STORE AS LAST TERM EDITED
 await Core_Api("User_Config_WriteValue", {file:"editor", section:"wip", field:"vocabulary", value:id});
 
 Document_Element_Restore(list);
 Document_Element_Restore(container);
}




async function Editor_Vocabulary_Unselect()
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 
 var list           = UI_Element_Find(submodule, "terms-list");
 list.selectedIndex = -1;

 UI_Element_Find(submodule, "term-panel-edit").style.visibility    = "hidden";
 UI_Element_Find(submodule, "term-media-preview").style.visibility = "hidden";
 
 UI_Element_Find(submodule, "term-edit").innerHTML = "";
}




async function Editor_Vocabulary_New()
{
 var title       = UI_Language_String("editor/vocabulary", "popup new title");
 var placeholder = UI_Language_String("editor/vocabulary", "popup new placeholder");
 var id          = await UI_Popup_Input(title, undefined, undefined, placeholder);
 if(!id) return;
 
 
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 var path   = "content/vocabulary/" + id;
 
 var config = Core_Data_Page("vocabulary/template");
 var data   = Data_Page_FromConfig(config);
 
 // AUTOSET MAIN LANGUAGE FIELD
 Safe_Set(data, ["main", "en"], id);

 await Core_Api("Vocabulary_Write_Term", {path:path, data:data});
 await Resources_Vocabulary(true);
 
 var list   = UI_Element_Find(submodule, "terms-list");
 var option = Document_Select_AddOption(list, id, id); 
 Document_Select_Sort(list);
 
 // AUTOSELECT
 option.scrollIntoView({behavior: "smooth", block: "center"});
 option.selected = true; 
 list.dispatchEvent(new Event("click"));
}




async function Editor_Vocabulary_Delete()
{
 var id   = Core_State_Get("editor", ["vocabulary", "selected-term"]);
  
 var title    = UI_Language_String("editor/vocabulary", "popup delete title");
 var subtitle = UI_Language_String("editor/vocabulary", "popup delete subtitle", {id});
 var confirm  = await UI_Popup_Code(title, subtitle, undefined, id);
 if(!confirm) return;
 
 
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();

 var path = "content/vocabulary/" + id;
 
 Editor_Vocabulary_Unselect();

 await Core_Api("Vocabulary_Delete", {path:path});
 await Resources_Vocabulary(true);
 
 var list = UI_Element_Find(submodule, "terms-list"); 
 var option = Document_Select_OptionByValue(list, id);
 if(option) option.remove();
}


async function Editor_Vocabulary_Find()
{
 
}




async function Editor_Vocabulary_Save(editor)
{
 Document_Element_Disable(UI_Element_Find("terms-list")); 
 Core_State_Set("editor", "saving", true);
 
 
 if(!User_Can("modify-content")) return;
 
 
 var data = Document_Element_GetObject(editor, "data", {});
 
 var id   = Core_State_Get("editor", ["vocabulary", "selected-term"]);
 var path = "content/vocabulary/" + id;
 
 await Core_Api("Vocabulary_Write_Term", {path:path, data:data});
 
 Core_State_Set("editor", "saving", false);
 Document_Element_Restore(UI_Element_Find("terms-list")); 
}



async function Editor_Vocabulary_UploadPicture(event)
{
 // GET SUBMODULE BODY
 var submodule = Module_Page_Body();
 
 
 var files = await Storage_File_Select({accept:".png"}) || [];
 if(files.length == 0) return;
 
 var id   = Core_State_Get("editor", ["vocabulary", "selected-term"]);
 var path = "content/vocabulary/" + id + "/picture.png";
 await Storage_Files_Upload(files, "api.php?direct&f=Storage_File_Upload&dest=" + path, {});
 
 UI_Element_Find(submodule, "term-picture").src = path + "?c=" + Date.now();
}



async function Editor_Vocabulary_UploadAudio(event)
{
 var files = await Storage_File_Select({accept:".mp3"}) || [];
 if(files.length == 0) return;
 
 var id   = Core_State_Get("editor", ["vocabulary", "selected-term"]);
 var path = "content/vocabulary/" + id + "/audio.mp3";
 await Storage_Files_Upload(files, "api.php?direct&f=Storage_File_Upload&dest=" + path, {});
}



async function Editor_Vocabulary_PlayAudio(event)
{
 var id   = Core_State_Get("editor", ["vocabulary", "selected-term"]);
 var path = "content/vocabulary/" + id + "/audio.mp3";
 
 Media_Audio_Play(path);
}
async function Grades_List_Display(teacher_id, managed = false)
{
 // IF SPECIFIC TEACHER AND TEACHER NOT CURRENT USER, LOAD IT
 if(teacher_id && teacher_id != User_Id()) 
 { 
  var user = await Core_Api("User_Read", {user_id:teacher_id, options:{fields:"id,firstname,lastname"}});
 }
 else
 {
  var user = await Core_User();
 }
 
 
 // CREATE DISPLAY
 var display = UI_Element_Create("grades/list-display");
 Core_State_Set("grades", "list-display", display);
 
 
 // IF LIST OF MANAGED TEACHERS, SHOW SELECTOR
 if(managed)
 {  
  // IF IT'S NOT A LIST BUT JUST A "TRUE" FLAG, BUILD THE LIST BY CALLING API
  if(typeof managed != "object")
  {
   var managed = await Core_Api("Users_List_ByManager", {manager_id:user["id"], fields:"id,firstname,lastname"});
  }

  var selector = UI_Element_Find(display, "selector");
  var select   = UI_Element_Find(selector, "teachers");
  
  // ADD MAIN USER TO THE LIST
  var name = [user["firstname"] || "", user["lastname"] || ""].join(" ").trim();
  Document_Select_AddOption(select, name, user["id"]);
  
  for(var teacher of managed)
  {
   var name = [teacher["firstname"] || "", teacher["lastname"] || ""].join(" ").trim();
   Document_Select_AddOption(select, name, teacher["id"]);
  }
  
  select.value = user["id"];
  
  select.onchange = 
  function()
  {
   Grades_List_Teacher(select.value);
  }
  
  selector.style.display = "flex";
 }
 
 await Grades_List_Teacher(user["id"]);


 return display;
}



async function Grades_List_Teacher(teacher_id)
{
 var display = Core_State_Get("grades", "list-display");
 // HIDE DETAIL VIEW
 UI_Element_Find(display, "detail").style.visibility = "hidden";


 // GET CLASS ASSESSMENT DATA
 var period     = parseInt(User_Config("admin-days", -30));
 var date_from  = Date_Portion(Date_Add_Days(Date_Now(), period), "no-seconds");
 var date_to    = Date_Portion(Date_Now(), "no-seconds");
 var data       = await Core_Api("Course_List_ByTeacher", {teacher_id, date_from, date_to});

 var gradesConfig = Core_Config("grades");
 var dataCustom = [];
 // CUSTOM DATA
 for(var item of data) 
 {
  var gradesLeson = Safe_Get(gradesConfig,[item["program"],item["level"]],"");
  if(gradesLeson != "")
  {
    gradesLeson = gradesLeson.split(";");
    var classes = item["classes"];
    gradesLeson.forEach(lesson => {
      lesson = lesson.split("__"); 
      var classFind = classes.find((element) =>  element["lesson_id"] == lesson[0]);
      if(typeof classFind != "undefined")
      {
        classFind["lesson"] = classFind["lesson_id"];
        classFind["type_name"] = lesson[1];
        classFind["course_id"] = item["id"];
        classFind["course_name"] = item["name"];
        classFind["program"] = item["program"];
        classFind["level"] = item["level"];
        if(classFind["date_start"] >= date_from && classFind["date_start"] <= date_to)
        {
          dataCustom.push(classFind);
        } 
      }
    });
  } 
 }

 for(var item of dataCustom) 
 {
  item["period"] = Date_Format_Period(Date_Now(), item["date_start"], {locale:UI_Language_Current(true), conversational:true});
 }
 
 // SORT BY DATE AND CLASS ID
 dataCustom.sort(
 function(a, b)
 {
  if(a["date_start"] < b["date_start"]) return 1;
  else
  if(a["date_start"] > b["date_start"]) return -1;
  else
  {
   if(a["id"] < b["id"]) return 1;
   else
   if(a["id"] > b["id"]) return -1;
   else   
   return 0;
  }
 });
 
 
 // ASSEMBLE DISPLAY
 var list = UI_List_Items(dataCustom, ["style-outlined-accented", "outline-inner"], Grades_List_Seat, {style:"vertical", overflow:true, sections:"period"},
 
 // ITEMS
 function(item)
 {  
  var locale      = UI_Language_Current(true);
  var info        = {};
  info["date"]    = Date_Format(item["date_start"], locale, "date-shortmonth-weekday-noyear") + ", " + Date_Format(item["date_start"], locale, "time-only");
  info["course"]  = item["course_name"];
  info["type"]    = item["type_name"];
 
  var element = UI_Element_Create("grades/list-item", info);  
  Document_Element_SetObject(element, "item", item);
  
  return element; 
 },
 
 // SECTIONS
 function(section, item)
 {
  var element = UI_Element_Create("assessment/list-section", {period:section.toUpperCase()});  
  return element;
 });
 


 // DISPLAY LIST 
 var container       = UI_Element_Find(display, "list");
 container.innerHTML = "";
 container.appendChild(list);
}




async function Grades_List_Seat(element)
{
 var item            = Document_Element_GetObject(element, "item");
 Core_State_Set("grades", "current-selected", item);

 var display         = Core_State_Get("grades", "list-display");
  
 var page            = await Grades_Assess_Display(item);
 Core_State_Set("grades", "page", page);

 var container       = UI_Element_Find(display, "detail-table");
 container.innerHTML = "";
 container.appendChild(page);

 var headerRowSub = UI_Element_Find(page,"header-sub");
 headerRowSub.style.top = headerRowSub.previousSibling.offsetHeight + 1;
 
 container.parentElement.style.visibility = "visible";
}




async function Grades_Assess_Display(item){

  var data = await Core_Api("Grades_List_ByCourse",{course_id:item["course_id"]});

  var dataCustomStudent = {};
  for (const key in data["students"]) {
    const studentTest = data["students"][key];
    if(typeof dataCustomStudent[studentTest["test_id"]] == "undefined") dataCustomStudent[studentTest["test_id"]] = {};
    dataCustomStudent[studentTest["test_id"]][studentTest["student_id"]] = studentTest;
  }

  var dataCustomTest = {};
  for (const key in data["course_test"]) {
    var test = data["course_test"][key];
    if(typeof dataCustomTest[test["test_type"]] == "undefined") dataCustomTest[test["test_type"]] = {};
    dataCustomTest[test["test_type"]][test["name"]] = {
      testId : test["id"],
      testType : test["test_type"],
      testName : test["name"],
      classId: test["class_id"],
      maxScore: test["max_score"],
      weight: test["weight"],
      students: dataCustomStudent[test["id"]]
    }
  }

  var programType = Grades_Program_Type(item["program"]);

  const table = UI_Table("standard", { fixed: true });
  table.classList.add("border-rounded");

  const headerRow = UI_Table_Row(table);
  headerRow.style.cssText = "position: sticky;z-index: 11;";
  headerRow.style.top = 0;

  const cellStudentHeader = UI_Table_Cell(headerRow, { type: "header" });
  cellStudentHeader.style.cssText = "position: sticky; left: 0; z-index: 1;border-top-left-radius: 6px; min-width:200px;"
  cellStudentHeader.innerHTML = UI_Language_String("grades/module","student name");
  cellStudentHeader.rowSpan = 2;

  const headerRowSub = UI_Table_Row(table);
  headerRowSub.dataset.uid = "header-sub";
  headerRowSub.style.cssText = "position: sticky;z-index: 10;";
  headerRowSub.style.top = 0;

  for (const testType in dataCustomTest) {
    const tests= dataCustomTest[testType];
    var type = testType;
    if(testType != "course_total" && !testType.toLowerCase().includes("total"))
    {
      let typeName;
      let typeNameNumber = "";
      if(Boolean(type.match(/\d/)))
      {
        let index = type.match(/\d/)["index"];
        typeName = type.slice(0,index);
        typeName = UI_Language_String("grades/module",(typeName.trim()).toLowerCase());
        typeNameNumber = " " + (type.slice(index)).trim();
      }
      else{
        typeName = UI_Language_String("grades/module",(type.trim()).toLowerCase());
      }
      const cellHeader = UI_Table_Cell(headerRow, { type: "header" });
      cellHeader.innerHTML = typeName + typeNameNumber;
      cellHeader.colSpan = Object.keys(tests).length;
    
      for (const testName in tests) {
        const test = tests[testName];
        let name = testName;
        let nameParse ;
        let nameNumber = "";
        if(Boolean(name.match(/\d/)) && programType != "sat")
        {
          let index = name.match(/\d/)["index"];
          nameParse = name.slice(0,index);
          nameParse = UI_Language_String("grades/module",(nameParse.trim()).toLowerCase());
          nameNumber = " " + (name.slice(index)).trim();
        }
        else{
          nameParse = UI_Language_String("grades/module",(name.trim()).toLowerCase());
        }
        const cellSub = UI_Table_Cell(headerRowSub, { type: "header" });
        cellSub.innerHTML = nameParse + nameNumber + Grades_Header_Tail(item,test["maxScore"],test["weight"]) ;
        cellSub.style.minWidth = "150px";
      }
    }
    else{
      const cellHeaderTotal = UI_Table_Cell(headerRow, { type: "header" });
      cellHeaderTotal.style.cssText = "border-top-right-radius: 6px;"
      cellHeaderTotal.innerHTML = UI_Language_String("grades/module", Object.keys(tests)[0].trim().toLowerCase())  + Grades_Header_Tail(item,Object.values(tests)[0]["maxScore"],test["weight"]);
      cellHeaderTotal.rowSpan   = 2;
      cellHeaderTotal.style.minWidth = "150px";
    }
  }

  var gradesConfig = Core_Config("grades");
  var gradesLeson = Safe_Get(gradesConfig,[item["program"],item["level"]],"");
  var seatsCheck = [];

  if(gradesLeson != "")
  {
    gradesLeson = gradesLeson.split(";");
    var lessons = []
    gradesLeson.forEach(lesson => {
      lesson = lesson.split("__");;
      lessons.push(lesson[0]);
    });

    var seats = await Core_Api("Class_Seats_ListByLessonName",{course_id:item["course_id"],lessons:lessons});
    seats.forEach(seat => {
      if(typeof seatsCheck[seat["class_id"]] == "undefined") seatsCheck[seat["class_id"]] = {}
      seatsCheck[seat["class_id"]][seat["student_id"]] = seat;
    });
  }
  
  var students = await Core_Api("Users_List_ByCourse",{course_id:item["course_id"]});

  students.forEach(user => {
    const row = UI_Table_Row(table);

    var cellStudentName =  UI_Table_Cell(row);
    cellStudentName.innerHTML = (user["lastname"]?? "")  + " " + (user["midname"] ?? "") + " " + (user["firstname"]?? "") ;
    cellStudentName.style.cssText = "position: sticky; left: 0; z-index: 1";

    for (const testType in dataCustomTest) {
      const tests= dataCustomTest[testType];
      for (const testName in tests) {
        const test = tests[testName];

        var cell =  UI_Table_Cell(row);
        if((typeof seatsCheck[test["classId"]] != "undefined" && typeof seatsCheck[test["classId"]][user["id"]] != "undefined") || testType == "course_total")
        {
          var input = UI_Element_Create("grades/grades-input");
          input.dataset.uid =  user["id"] + "__" + testName;
          input.onchange = Grades_Assess_Store
          input.min = 0;
          input.max = test["maxScore"];

          if(typeof test["students"] != "undefined" && typeof test["students"][user["id"]] != "undefined")
          {
            input.value = test["students"][user["id"]]["score"];
            Document_Element_SetObject(input, "studentTestId", test["students"][user["id"]]["id"]);
            Document_Element_SetObject(input, "defaultValue", test["students"][user["id"]]["score"]);
          } 
          // || parseInt(item["date_start"]) < parseInt(seatsCheck[test["classId"]][user["id"]]["date_start"]) 
          if(testType == "course_total" || testName.toLowerCase().includes("project") || testName.toLowerCase().includes("homework"))
          {
            //cell.classList.add("style-disabled");
            //input.classList.add("style-disabled");
            input.readOnly = true;
            input.style.cursor = "no-drop";
            input.style.fontWeight = "bolder";
          }

          switch (programType) {
            case "sat":
              var testTypeLower = testType.toLowerCase();
              if(testTypeLower.includes("best scores") || testTypeLower.includes("score improvement") || testName.toLowerCase().includes("total"))
              {
                //cell.classList.add("style-disabled");
                //input.classList.add("style-disabled");
                input.readOnly = true;
                input.style.cursor = "no-drop";
                input.style.fontWeight = "bolder";
              }
              break;
          
            case "ielts":
              if(testName.toLowerCase().includes("total"))
              {
                //cell.classList.add("style-disabled");
                //input.classList.add("style-disabled");
                input.readOnly = true;
                input.style.cursor = "no-drop";
                input.style.fontWeight = "bolder";
              }
              break;
            default:
              break;
          }

          // CHECK ROLE ALLOW EDIT
          var check =  User_Config("admin-edit-allow", "false")
          if(check == "false")
          {
            cell.classList.add("style-disabled");
            input.classList.add("style-disabled");
          } 

          Document_Element_SetObject(input, "courseId", item["course_id"]);
          Document_Element_SetObject(input, "classId", test["classId"]);
          Document_Element_SetObject(input, "testId", test["testId"]);
          Document_Element_SetObject(input, "testType", test["testType"]);
          Document_Element_SetObject(input, "testName", test["testName"]);
          Document_Element_SetObject(input, "maxScore", test["maxScore"]);
          Document_Element_SetObject(input, "percentage", test["weight"]);
          Document_Element_SetObject(input, "student", user["id"]);

          cell.appendChild(input);
        }
      }
    }
  });
  
  return table;
}


async function Grades_Assess_Store(e)
{
  var input = e.target;
  console.log(input);
  var maxScore = Document_Element_GetObject(input, "maxScore");
  var courseId = Document_Element_GetObject(input, "courseId");
  var classId = Document_Element_GetObject(input, "classId");
  var testId = Document_Element_GetObject(input, "testId");
  var weight = Document_Element_GetObject(input, "percentage");
  var studentId = Document_Element_GetObject(input, "student");
  var testType = Document_Element_GetObject(input, "testType");
  var defaultValue = Document_Element_GetObject(input, "defaultValue",null);
  var value = input.value;
  var selectedItem = Core_State_Get("grades", "current-selected");
  
  if(parseFloat(value) <= parseFloat(maxScore)) 
  {
    var data = await Core_Api("Grades_Student_Test", {course_id:courseId, class_id:classId, test_id:testId, student_id:studentId, score:value, max_score:maxScore, weight:weight}); 
    var page = Core_State_Get("grades", "page");
    
    switch (Grades_Program_Type(selectedItem["program"])) {
      case "sat":
        var dataUid = studentId + "__Final SAT score";

        var bestEnglish = UI_Element_Find(page,studentId + "__Best Verbal (English)");
        bestEnglish.value = data["best_english"];

        var bestMath = UI_Element_Find(page,studentId + "__Best Maths");
        bestMath.value = data["best_math"];

        var improvementMath = UI_Element_Find(page,studentId + "__Maths Improvement");
        improvementMath.value = data["improvement_math"];

        var improvementEnglish = UI_Element_Find(page,studentId + "__Verbal (English) Improvement");
        improvementEnglish.value = data["improvement_english"];

        var improvementTotal = UI_Element_Find(page,studentId + "__Score Improvement total");
        improvementTotal.value = data["improvement_total"];

        if(data["update_total"])
        {
          var updateTotal = UI_Element_Find(page,studentId + "__" + testType + " total");
          updateTotal.value = data["update_total"];
        }
        break;

      case "ielts":
        var dataUid = studentId + "__course total";
        if(data["update_total"])
        {
          var bestEnglish = UI_Element_Find(page,studentId + "__" + testType + " total");
          bestEnglish.value = data["update_total"];
        }
        break;

      default:
        var dataUid = studentId + "__course total";
        break;
    }
    var totalInput = UI_Element_Find(page,dataUid);
    totalInput.value = data["total_score"];
  }
  else{
    input.value = defaultValue;
  }
  
}


function Grades_Header_Tail(item,maxScore,weight)
{
  var programType = Grades_Program_Type(item["program"]);
  switch (programType) {
    case "sat":
      return "<i> (" + maxScore  + ")</i>"
    case "ielts":
      if(weight) return "<i> (" + maxScore  + "/" + weight + "%)</i>";
      else return "<i> (" + maxScore  + ")</i>"
    default:
      return "<i> (" + maxScore  + "/" + weight + "%)</i>"
  }
}


function Grades_Program_Type(program)
{
  var programs = Core_Config("programs");
  var programType = programs[program]["type"];
  return programType;
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                           G R A D E                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Grades_OnLoad(module, data)
{

}




async function Grades_OnShow(module, data)
{
}




async function Grades_OnUnload()
{
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                           H O M E                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Home_OnLoad(module, data)
{
 var user = Safe_Get(application, ["user"], {});
 
 var home = Core_Config(["roles", user["role"], "home"]) || user["role"];
 
 //LOAD COLOR 
 var colorTemplate = Safe_Get(user,["settings","preferences","color"],"default");
 if(colorTemplate != "default") document.body.className = colorTemplate;
  
 // MULTIPAGE MODULE
 Module_Page_Set(home);
}




async function Home_OnShow(module, data)
{
}




async function Home_OnUnload()
{
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                  H O M E  /  S T U D E N T                                     //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Home_Student(page)
{ 
 var data              = await Core_Api("Home_Student_Data", {}); console.log(data);
 var boxes             = [];

 // LAST CLASS TAKEN
 if(Safe_Get(data, ["last-class", "lesson_id"]))
 {
  var title            = UI_Language_String("home/student", "lastclass title");
  var subtitle         = UI_Language_Object(Safe_Get(data, ["last-class", "lesson", "title"], {})) || "";
  var date             = Date_Format_Period(Date_Now(), Safe_Get(data, ["last-class", "date_start"], ""),{locale:UI_Language_Current(true)});
  var action           = UI_Language_String("home/student", "lastclass action");
 
  var box              = UI_Element_Create("home/student-class", {title, subtitle, date, action});
  box.style.visibility = "hidden";
 
  var cover    = UI_Element_Find(box, "cover");  
  var source   = Safe_Get(data, ["last-class", "lesson_id"]);
  source       = "content/lessons/" + source + "/cover.png";
  var fallback = Resources_URL("images/cover-lesson.jpg");
  Document_Image_Load(cover, [source, fallback]);
 
  Document_Element_SetData(box, "seat", Safe_Get(data, ["last-class", "id"]));
  page.appendChild(box);
  boxes.push(box);
 }
 
 // NEXT CLASS TO ATTEND
 if(Safe_Get(data, ["next-class", "lesson_id"]))
 {
  var title            = UI_Language_String("home/student", "nextclass title");
  var subtitle         = UI_Language_Object(Safe_Get(data, ["next-class", "lesson", "title"], {}));
  var date             = Date_Format_Period(Date_Now(), Safe_Get(data, ["next-class", "date_start"], ""),{locale:UI_Language_Current(true)});
  var action           = UI_Language_String("home/student", "nextclass action");
 
  var box              = UI_Element_Create("home/student-class", {title, subtitle, date, action});
  box.style.visibility = "hidden";
 
  var cover    = UI_Element_Find(box, "cover");  
  var source   = Safe_Get(data, ["next-class", "lesson_id"]);
  source       = "content/lessons/" + source + "/cover.png";
  var fallback = Resources_URL("images/cover-lesson.jpg");
  Document_Image_Load(cover, [source, fallback]);
 
  Document_Element_SetData(box, "seat", Safe_Get(data, ["next-class", "id"]));
  page.appendChild(box);
  boxes.push(box);
 }
 
 // ANIMATE LESSONS POPPING UP
 Document_Element_AnimateChildren(page, "zoomIn 0.5s 1 ease-out", 
 {
  delay:    0, 
  interval: 250, 
  onstart:
  function(element) 
  {
   element.style.visibility = "visible";
  }
 });
 
 
 // LESSONS' ACTION BOXES POPPING OUT
 var time = 1000;
 for(var box of boxes)
 {
  let action     = UI_Element_Find(box, "action-view");
  var seat_id    = Document_Element_GetData(box, "seat");
 
  action.onclick = Home_Student_ViewSeat;
  Document_Element_SetData(action, "seat", seat_id); 
 
  setTimeout(
  function()
  {
   action.style.visibility = "visible";
  
   Document_Element_Animate(action, "rubberBand 0.5s");
  
  }, time);
  
  time = time + 1000;
 }

}




async function Home_Student_ViewSeat(event)
{
 var element = event.currentTarget;
 var seat_id = Document_Element_GetData(element, "seat");  console.log(seat_id);
 
 Module_Preload_Set("course", "viewseat", true);
 await Module_Load("course");
 await Course_Class_Display(false, seat_id);
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                  H O M E  /  T E A C H E R                                     //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Home_Teacher(page)
{ 
 // GET CLASS ASSESSMENT DATA UP TO 7 DAYS PRIOR
 var date_from = Date_Portion(Date_Add_Days(Date_Now(), -300), "no-seconds");
 var date_to   = Date_Portion(Date_Now(), "no-seconds");
 var data      = await Core_Api("Classes_Assessment_Data", {date_from, date_to});


 var info      = await Classes_Assessment_Map(data); 
 info.reverse();
 
 
 var container = UI_Element_Find(page, "outstanding-classes");
 
 for(var item of info)
 {
  if(item["attention"])
  {
   var title    = UI_Language_Object(Safe_Get(item, ["lesson", "title"], {})) || "";
   //var date     = Date_Format_Period(Date_Now(), item["date_start"], "");
   var date     = Date_Format(item["date_start"], undefined, "date-time-compact");
   var element  = UI_Element_Create("home/teacher-outstanding-class", {title, date});
   var cover    = UI_Element_Find(element, "cover");
   var source   = "content/lessons/" + item["lesson_id"] + "/cover.png";
   var fallback = Resources_URL("images/cover-lesson.jpg");
   Document_Image_Load(cover, [source, fallback]);
   
   var lines = UI_Element_Find(element, "outstanding-seats");
   for(var seat of item["seats"])
   {
	if(seat["attention"])
	{
     var name     = "";  console.log(seat);
     var line     = UI_Element_Create("home/teacher-outstanding-seat", {name});
	 var sections = UI_Element_Find(line, "sections");
	 
	 for(var missing of seat["missing"]) 
	 {
      var text    = UI_Language_String("home/teacher", "missing " + missing);
	  var icon    = Core_Data_Value("home/attention", missing, "icon");
	  var section = UI_Element_Create("home/teacher-outstanding-item", {icon, text});
	  
	  Document_Element_SetData(section, "section", missing);
	  section.onclick = Home_Teacher_DisplaySeat;
	  
      sections.appendChild(section);	  
	 }
	 
	 var picture  = UI_Element_Find(line, "picture");
	 var source   = Resources_URL("propic.jpg", "user", seat["student_id"]);
	 var fallback = Resources_URL("images/default/propic-student.png");
	 Document_Image_Load(picture, [source, fallback]); 
	 picture.onclick = Home_Teacher_DisplaySeat;
	 
	 
     Document_Element_SetObject(line, "seat",  seat);
	 Document_Element_SetData(line,   "title", title);
	 Document_Element_SetData(line,   "date",  item["date_start"]);
	 
	 
	 lines.appendChild(line);
	}
   }
   
   element.style.visibility = "hidden";
   container.appendChild(element);
  }
 }

 
 
 Document_Element_AnimateChildren(container, "slideInLeft 0.5s 1 ease-out", 
 {
  delay:    0, 
  interval: 250, 
  onstart:
  function(element) 
  {
   element.style.visibility = "visible";
  }
 });
 
}





async function Home_Teacher_DisplaySeat(event)
{
 var element         = event.currentTarget;
 var section         = Document_Element_GetData(element, "section");
    
 var container       = Document_Element_FindParent(element,  "uid", "seat");
 var seat            = Document_Element_GetObject(container, "seat");
 var title           = Document_Element_GetData(container,   "title");
 var date            = Document_Element_GetData(container,   "date");
 
 var current         = Core_State_Get("home", ["current-seat"]);
 if(current != seat["id"])
 {
  var page            = await Assessment_Assess_Seat(seat["id"]);
 
  var container       = UI_Element_Find("seat-title");
  container.innerHTML = title.toUpperCase() + ", " + Date_Format(date, UI_Language_Current(true));
 
  var container       = UI_Element_Find("seat-assessment");
  container.innerHTML = "";
  container.appendChild(page);
 }
 
 if(section) Home_Teacher_HighlightSection(section);
 
 Core_State_Set("home", ["current-seat"], seat["id"]);
}




async function Home_Teacher_HighlightSection(section)
{
 var container = UI_Element_Find("seat-assessment"); 
 var section   = UI_Element_Find(container, "section-" + section);
 if(!section) return;
 
 section.scrollIntoView({behavior: "smooth", block: "center"});
 Document_Element_Animate(section, "flash 1s 2");
}const ALERT_TYPES = {
  success: {
    className: "alert-success",
    title: "Info",
  },
  error: {
    className: "alert-error",
    title: "Error",
  },
  info: {
    className: "alert-info",
    title: "Info",
  },
};
let alert;

async function Inventory_OnLoad(module, data) {
  // INITIAL DATA
  Core_State_Set("inventory", "groups", data);
  generateProgramGroup().then((res) =>
    Core_State_Set("inventory", "groupPrograms", res)
  );

  // INIT PAGES
  const warehousePage = UI_Element_Create("inventory/warehouse/warehouse");
  const adminPage = UI_Element_Create("inventory/admin/admin");
  const assignmentPage = UI_Element_Create("inventory/assignment/assignment");

  const container = UI_Element_Find(module, "inventory-container");
  Core_State_Set("inventory", "container", container);
  container.appendChild(warehousePage);
  container.appendChild(adminPage);
  container.appendChild(assignmentPage);

  const pages = [
    {
      key: "warehouse",
      page: warehousePage,
      isLoaded: false,
    },
    {
      key: "assignment",
      page: assignmentPage,
      isLoaded: false,
    },
    {
      key: "admin",
      page: adminPage,
      isLoaded: false,
    },
  ];

  // CREATE MENU HEADER
  var menus = Core_Data_Page("inventory/menus");

  var items = {};
  for (const key in menus) {
    items[key] = {};
    items[key]["text"] = UI_Language_Object(menus[key]);
    items[key]["icons"] = [];
    items[key]["onclick"] = () => {
      pages.forEach((item) => {
        if (item["key"] == key) {
          item["page"].style.display = "flex";
          if (!item["isLoaded"]) {
            Safe_Function(
              "Inventory_" + String_Capitalize_Initial(key),
              function () {}
            )();
            item["isLoaded"] = true;
          }
        } else {
          item["page"].style.display = "none";
        }
      });
    };
  }

  var header = UI_Header("inventory-menu", items, {
    selectfirst: true,
    css: "color-noted",
    template: "standard",
  });

  UI_Element_Find(module, "module-header").appendChild(header);

  // INIT ALERT
  alert = UI_Element_Create("inventory/components/inventory-alert");
  document.body.appendChild(alert);
}

async function Inventory_OnUnload() {
  document.body.removeChild(alert);
  alert = null;
}

function showAlertMessage(message, type = "success") {
  const { className, title } = ALERT_TYPES[type];
  alert.innerHTML = `<strong>${UI_Language_String(
    "inventory/module",
    "alert " + type
  )}! ${message}</strong>`;
  alert.classList.add(className);
  alert.style.opacity = 1;

  setTimeout(() => {
    alert.classList.remove(className);
    alert.style.opacity = 0;
  }, 6000);
}

async function UpdateRequestStatus(id, status) {
  const { error, data } = await Core_Api("Inventory_Update_Transfer_Request", {
    id: id,
    fields: {
      status: status,
    },
  });

  if (data) {
    showAlertMessage("Update Status Successfuly");
    showTransferTable();
  }

  return { error, data };
}

function removeAccents(str) {
  return str
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "")
    .replace(/đ/g, "d")
    .replace(/Đ/g, "D");
}

function createSearchElement(
  stateKey,
  {
    btnTitle = "",
    onSearch,
    showDate = false,
    showCenter = true,
    programData = null,
  }
) {
  const searchContainer = UI_Element_Create(
    "inventory/components/inventory-search",
    {
      "btn-search":
        btnTitle || UI_Language_String("inventory", "button search"),
    }
  );

  // CENTERS
  const centersElement = UI_Element_Find(searchContainer, "search-centers");
  if (showCenter) {
    const centers = Core_Config("centers");
    Document_Select_OptionsFromObjects(centersElement, centers, "name", false);
    Core_State_Set("inventory", [stateKey, "center"], centersElement.value);
    centersElement.onchange = (e) => {
      Core_State_Set("inventory", [stateKey, "center"], e.target.value);
    };
  } else {
    centersElement.parentElement.style.display = "none";
  }

  const programElement = UI_Element_Find(searchContainer, "search-program");

  // PROGRAM
  const programs = programData || Core_Config("programs");
  Document_Select_AddOption(
    programElement,
    UI_Language_String("inventory", "search any"),
    ""
  );
  Document_Select_AddOption(programElement, "---", "").disabled = true;

  Document_Select_OptionsFromObjects(programElement, programs, "name", false);
  Core_State_Set("inventory", [stateKey, "program"], programElement.value);
  programElement.onchange = (e) => {
    const value = e.target.value;
    Core_State_Set("inventory", [stateKey, "program"], value);
    displayLevels(searchContainer, [stateKey], value, programs);
  };

  // LEVELS
  displayLevels(searchContainer, [stateKey], programElement.value, programs);

  // ITEM GROUP
  const groups = Core_State_Get("inventory", "groups");
  const groupsElement = UI_Element_Find(searchContainer, "search-groups");
  Document_Select_AddOption(
    groupsElement,
    UI_Language_String("inventory", "search any"),
    ""
  );
  Document_Select_AddOption(groupsElement, "---", "").disabled = true;
  Document_Select_OptionsFromObjects(
    groupsElement,
    groups,
    "item_group",
    false
  );
  Core_State_Set("inventory", [stateKey, "group"], groupsElement.value);
  groupsElement.onchange = (e) =>
    Core_State_Set("inventory", [stateKey, "group"], e.target.value);

  // DATE
  if (showDate) {
    UI_Element_Find(searchContainer, "date-container").style.display = "flex";
    const inputDate = UI_Element_Find(searchContainer, "search-datefrom");
    inputDate.value = Date_To_Input(Date_Now());
    Core_State_Set("inventory", [stateKey, "date"], inputDate.value);
    inputDate.onchange = (event) =>
      Core_State_Set(
        "inventory",
        [stateKey, "date"],
        event.currentTarget.value
      );

    // DATE MODE
    const selectDateMode = UI_Element_Find(searchContainer, "search-datemode");
    UI_Select_FromDatapage(selectDateMode, "courses/search-date-modes");
    selectDateMode.value = "ends-after";
    Core_State_Set("inventory", [stateKey, "date_mode"], selectDateMode.value);
    selectDateMode.onchange = (event) => {
      const value = event.currentTarget.value;
      inputDate.style.display = value == "ongoing" ? "none" : "flex";
      Core_State_Set("inventory", [stateKey, "date_mode"], value);
    };
  }

  UI_Element_Find(searchContainer, "btnSearch").onclick = onSearch;

  return searchContainer;
}

function displayLevels(parent, state = [], programKey, programData = null) {
  const levelsElement = UI_Element_Find(parent, "search-levels");
  Document_Select_Clear(levelsElement);
  Document_Select_AddOption(
    levelsElement,
    UI_Language_String("inventory", "search any"),
    ""
  );
  Document_Select_AddOption(levelsElement, "---", "-").disabled = true;
  Core_State_Set("inventory", [...state, "level"], levelsElement.value);
  levelsElement.onchange = (e) => {
    let value = e.target.value;
    if (value.includes("-CAM")) {
      value = value.replaceAll("-CAM", "");
    }
    Core_State_Set("inventory", [...state, "level"], value);
  };

  if (programKey && programKey.length > 0) {
    const levelStr =
      programData?.[programKey]?.["levels"] ||
      Core_Config(["programs", programKey, "levels"]);

    const levels =
      levelStr?.split(",")?.reduce(
        (result, item) => ({
          ...result,
          [item]: {
            name: item,
          },
        }),
        {}
      ) || {};
    Document_Select_OptionsFromObjects(levelsElement, levels, "name", false);
  }

  return levelsElement;
}

async function generateProgramGroup() {
  const programs = Core_Config("programs");

  const programGroup = Object.keys(programs)?.reduce((result, key) => {
    const program = programs[key]["program"];
    let levels = programs[key]["levels"] || "";
    if (result[program]) return result;
    levels = levels.replaceAll("-CAM", "");
    return {
      ...result,
      [program]: {
        name: program,
        program,
        levels,
      },
    };
  }, {});

  return programGroup;
}

async function exportExecl(e) {
  const XLSX = await import(
    "https://cdn.sheetjs.com/xlsx-0.20.0/package/xlsx.mjs"
  );
  const state = Document_Element_GetObject(e.target, "state");
  const items = Core_State_Get("inventory", [state, "items"]) ?? [];
  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.json_to_sheet(items);
  XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
  XLSX.writeFile(wb, "LMS_data_export.xlsx");
}

function btnClicked(e, state) {
  var elementBefore = Core_State_Get("inventory", [state, "search-selected"]);
  if (typeof elementBefore !== "undefined") {
    elementBefore.style.backgroundColor = "var(--color-dark)";
    elementBefore.style.color = null;
  }

  var element = e.target;
  Core_State_Set("inventory", [state, "search-selected"], element);
  element.style.backgroundColor = "var(--color-accented)";
  element.style.color = "white";
}

function reloadGroupsData() {
  const groups = Core_State_Get("inventory", "groups");
  var selectgroups = document.querySelectorAll("[data-uid='search-groups']");
  console.log(selectgroups);
  for (let index = 0; index < selectgroups.length; index++) {
    var element = selectgroups[index];
    Document_Select_Clear(element);
    Document_Select_AddOption(
      element,
      UI_Language_String("inventory", "search any"),
      ""
    );
    Document_Select_AddOption(element, "---", "").disabled = true;
    Document_Select_OptionsFromObjects(element, groups, "item_group", false);
    //CHECK AND RESET SELECTED VALUE
    let check = element.parentElement.parentElement.parentElement.parentElement;
    switch (check.dataset.uid) {
      case "warehouse-container":
        element.value = Core_State_Get("inventory", ["warehouse", "group"], "");
        break;
      case "inventory-admin":
        element.value = Core_State_Get("inventory", ["admin", "group"], "");
        break;
      case "assignment-container":
        element.value = Core_State_Get(
          "inventory",
          ["assignment", "group"],
          ""
        );
        break;
      default:
        break;
    }
  }
}

function createLoading() {
  const loading = document.createElement("div");
  loading.classList.add("loader");
  loading.style = "font-size: 4px; margin-left: 25px; margin-right: 10px";
  return loading;
}

async function runWithLoading(button, callback) {
  const loading = createLoading();
  let state = "";
  if (state == "requesting") return;

  let data;
  try {
    // Show loading
    button.classList.add("style-disabled");
    button.appendChild(loading);

    state = "requesting";

    if (callback) {
      data = await callback();
    }
    // Remove loading
    state = "done";
    button.classList.remove("style-disabled");
    button.removeChild(loading);

    return data;
  } catch (error) {
    button.removeChild(loading);
    state = "done";
  }

  return null;
}
// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      L E S S O N S                                             //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Lesson_Load(source, data = {})
{ 
 var lesson       = await Core_Api("Lesson_Read", {source:source, data:data}) || {};
 lesson["source"] = source;

 Lesson_AdjustDocuments(lesson);
  
 return lesson;
}



function Lesson_AdjustDocuments(lesson)
{
 // AUTOADJUST DOCUMENTS : FOR EACH ONE OF THE FILES CONTAINED IN "DOCUMENTS", SEE IF IT WAS ASSOCIATED TO AN EXISTING "DOCUMENT XX" SECTION
 var documents = Object_Subset(lesson, "document ")
 var sections  = {};
 var count     = 0;
 
 for(var file of lesson["documents"] || [])
 {  
  var search = Path_RemoveExtension(file).toLowerCase();
  var found  = false;
  
  for(var id in documents)
  {   
   var filename = (documents[id]["file"] || "");
   
   if(Path_RemoveExtension(filename).toLowerCase() == search) 
   {
	found  = true;
    var en = documents[id]["en"] || Path_RemoveExtension(file);
	
	break;
   }
  }
  
  if(!found) var en = Path_RemoveExtension(file);
  
  sections["document " + count.toString().padStart(2, "0")] = {file, en};
  
  count++;
 }
 
 Object_Purge(lesson, "document ");
 for(var id in sections)
 {
  lesson[id] = sections[id];
 }
}



async function Lesson_Summary_Popup(lesson)
{
 // GATHER DATA
 
 var userid = User_Id();

 if(typeof lesson == "string") var source = lesson; else var source = Safe_Get(lesson, ["source"], "");
 Core_State_Set("lesson", ["summary", "source"], source); 

 var info   = await Core_Api("Lesson_Metadata", {lesson:source, options:{rating:userid}});
 Core_State_Set("lesson", ["summary", "info"], info); 
 
 
 
 // CREATE POPUP
 var popup  = await UI_Popup_Create({}, [], "lessons/summary", {open:false, escape:true});
 Core_State_Set("lesson", ["summary", "popup"], popup); 
 
 var element  = UI_Element_Find(popup, "lesson-cover");
 var source   = "content/lessons/" + Safe_Get(lesson, ["source"], "") + "/cover.png";
 var fallback = Resources_URL("images/cover-lesson.jpg");
 Document_Image_Load(element, [source, fallback]);
 
 var element       = UI_Element_Find(popup, "lesson-type");
 var text          = UI_Language_String("lessons/types", Safe_Get(lesson, ["info", "type"], "standard"));
 element.innerHTML = text;
 
 var element       = UI_Element_Find(popup, "lesson-title");
 var text          = UI_Language_Object(Safe_Get(lesson, ["title"], {}));
 element.innerHTML = text;
 
 var element       = UI_Element_Find(popup, "lesson-desc");
 var text          = UI_Language_Object(Safe_Get(lesson, ["desc-teacher"], {}));
 text                = text.replaceAll("\n", "<br>");
 text                = text.replaceAll("\r\n", "<br>");
 element.innerHTML = text;
 
 
 // AUTHORS
 var container = UI_Element_Find(popup, "lesson-authors");
 var authors   = info["authors"] || [];
 for(var author of authors)
 {
  var name = []; 
  if(author["firstname"]) name.push(author["firstname"]);
  if(author["lastname"])  name.push(author["lastname"]);
  name = name.join(" ");
  
  var item  = UI_Element_Create("lessons/summary-author", {name});
  var image = UI_Element_Find(item, "image");
  
  User_Picture_Load(image, author["id"]);
  
  container.appendChild(item);
 }
  
 // RATING
 Lesson_Summary_UpdateRating();
 
 // FEEDBACK
 var element         = UI_Element_Find(popup, "lesson-feedback");
 element.placeholder = UI_Language_String("lessons/popups", "summary notes placeholder");
 element.value       = info["feedback"] || "";
 
 element.onchange    =
 function(event)
 {
  var element = event.currentTarget;
  var source  = Core_State_Get("lesson", ["summary", "source"]);  
  
  Core_Api("Lesson_Feedback", {lesson:source, feedback:element.value});
 }
 
 await UI_Popup_Show(popup);
}



function Lesson_Summary_UpdateRating()
{
 var info  = Core_State_Get("lesson", ["summary", "info"]);
 var popup = Core_State_Get("lesson", ["summary", "popup"]); 
 
 var score           = info["rating"] || 0;
 var container       = UI_Element_Find(popup, "lesson-rating");
 container.innerHTML = "";
 
 for(var i = 1; i<=5; i++)
 {
  if(i <= score) var template = "full"; else var template = "empty";
  var point = UI_Element_Create("lessons/summary-point-" + template);
  
  Document_Element_SetData(point, "score", i);
  point.onclick = Lesson_Summary_Rate;
 
  container.appendChild(point);
 }
}



async function Lesson_Summary_Rate(event)
{
 var point  = event.currentTarget;
 var score  = Document_Element_GetData(point, "score");
 
 var userid = User_Id();
 var info   = Core_State_Get("lesson", ["summary", "info"]);
 var source = Core_State_Get("lesson", ["summary", "source"]);  
 
 Safe_Set(info, ["rating"], score);
 Lesson_Summary_UpdateRating();
 
 Core_Api("Lesson_Rate", {lesson:source, userid, score});
}




function Lesson_Id_Decode(id)
{
 var parts = String_Split(id, ["_", "-", ".", " "]);
   
 // PAD MISSING PARTS
 for(var i = parts.length; i<3; i++)
 {
  Array_Element_Insert(parts, 0, "");
 }
 
 var decoded = 
 { 
  program : parts[0],
  level   : parts[1],
  lesson  : parts[2]
 }
 
 return decoded;
}




async function Lesson_Popup_SelectFromCatalog(selected, options = {})
{
 var promise = new Promise(async(resolve, reject) =>
 {
  var lessons = await Resources_Lessons();
  var catalog = Safe_Get(lessons, ["catalog"], {});
     
  var content        = UI_Element_Create("lessons/popup-catalog-select", {}, {language:"lessons/popups"});
  var program_select = UI_Element_Find(content, "program");
  var level_select   = UI_Element_Find(content, "level");
  var lesson_select  = UI_Element_Find(content, "lesson");
 
  // PROGRAMS
  var programs = Object.keys(catalog);
  Document_Select_AddOption(program_select, "", "");
  Document_Select_OptionsFromValues(program_select, programs, programs);
  program_select.onchange = 
  function()
  {
   Document_Select_Clear(level_select);   
   Document_Select_Clear(lesson_select);
  
   Document_Select_AddOption(level_select, "", "");
  
   var program = program_select.value;
   var levels  = Object.keys(catalog[program]);
   Document_Select_OptionsFromValues(level_select, levels, levels);
  }
  
  // LEVELS
  level_select.onchange = 
  function()
  {
   Document_Select_Clear(lesson_select); 
   Document_Select_AddOption(lesson_select, "", "");
  

   var program = program_select.value;
   var level   = level_select.value;
   
   var lessons  = Object.keys(catalog[program][level] || {}).sort();
   Document_Select_OptionsFromValues(lesson_select, lessons, lessons);
  }
  
  
  if(selected)
  {
   var parts = Lesson_Id_Decode(selected);
   
   program_select.value = parts["program"];
   program_select.onchange();
   
   level_select.value = parts["level"];
   level_select.onchange();
   
   lesson_select.value = parts["lesson"];
  }
  
   
  var onescape =
  function()
  {
   resolve(false);
   
   return true;
  }
  
  var button_select = 
  {
   text   : UI_Language_String("lessons/popups", "catalog select select"),
   onclick:
   function(popup)
   {
	var program = program_select.value;
    var level   = level_select.value;
    var lesson  = lesson_select.value;
	
	// IF OPTIONS DICTATE WE CAN ACCEPT PARTIAL LESSON CODES...
	if(options["partial"])
	{
     var  id = [];
     
	 if(program) id.push(program);
	 if(level)   id.push(level);
	 if(lesson)  id.push(lesson);
	 
	 id = id.join(options["partial"]);
	 resolve(id);
	}
	else
    {
     // OTHERWISE, THE COMBINED LESSON MUST EXIST
     var id = Safe_Get(catalog, [program, level, lesson, "id"], false);
     resolve(id);	
	}
	
	UI_Popup_Close(popup);
   }
  }
 
  await UI_Popup_Create({content}, [button_select], "flexi", {open:true, escape:onescape});
  
  // RESOLVE
 });
 
 return promise;
}



async function Lesson_Bookpage_Render(source)
{
 var lesson     = await Core_Api("Lesson_Read", {source:source, data:{all:true}});
 var bookpage   = await Bookpage_Read("content/lessons/" + source + "/bookpage");
 var dialogue   = await Dialogue_Read("content/lessons/" + source + "/dialogue");
 var vocabulary = await Vocabulary_Terms_Read("content/lessons/" + source);
 
 var extras = {};
 

 // TITLE
 extras["title"]     = UI_Language_Object(lesson["title"] || {});
 extras["lesson-id"] = source;
 extras["cover"]     = "content/lessons/" + source + "/cover.png";
 
 // TYPE 
 var type            = Safe_Get(lesson, ["info", "type"], "");
 var info            = Core_Data_Value("lessons/types", type, "bookparagraph") || "***";
 extras["type"]      = UI_Language_Object(info, "");
 
 // DIALOGUE
 var display              = await Dialogue_Display(dialogue, "columns");
 extras["dialogue"]       = display.outerHTML;
 
 var title                = Safe_Get(dialogue, ["info", "title"], {}); 
 extras["dialogue-title"] = UI_Language_Object(title, "");
 
 
 // VOCABULARY
 var vocabulary       = await Vocabulary_Display(vocabulary, "dynamic");
 extras["vocabulary"] = vocabulary.outerHTML;
  
  
 // RENDER PAGE
 var rendered = await Bookpage_Render(bookpage, extras, {scale:true, layout:false, shadow:true});
 return rendered;
}



async function Lesson_Bookpage_Window(lesson)
{
 var info    = await Client_Screen_Info();
 var display = info["primary"] || window.screen;

 var url     = Client_Location_Current() + "?module=bookpage&lesson=" + lesson + "&framework=null&print=true";
 var win     = window.open(url, "bookpage", "popup, width="+ display["availWidth"] + ", height=" + display["availHeight"] + ", fullscreen=yes");
 
 return win;
}

function Lesson_Get_From_Config(lesson,option){
    var programs = Core_Config("programs");
    for (const pkey in programs) {
        var program = programs[pkey]
        for (const key in program) {
            if(key != "name" && key != "program" && key != "levels"){
                var listLesson = program[key];
                var arrLesson = listLesson.split(",");
                if(arrLesson.indexOf(lesson) >= 0 || arrLesson.indexOf(lesson.toUpperCase()) >= 0){
                    let position = arrLesson.indexOf(lesson) >= 0 ? arrLesson.indexOf(lesson) : arrLesson.indexOf(lesson.toUpperCase());
                    if(option == "next"){
                        return arrLesson[position + 1] || null;
                    }
                    else if(option == "prev") return arrLesson[position - 1] || null;
                    else if(option == "lesson") return {"lesson":arrLesson,"index":position}
                }
            }    
        }
    }
    
}

async function Multi_Lesson_Bookpage_Render(inputLesson,pageNumber = 5)
{
 var data = Core_State_Get("course",["class-data", "book-data"],{});
 if(Object.keys(data).length === 0){
    var arrLesson  = Lesson_Get_From_Config(inputLesson,"lesson");
    data["lessons"]    = await Core_Api("Lessons_Read", {sources:arrLesson["lesson"], data:{all:true}});
    data["vocabulary"] = {};
    for (const key in data["lessons"]) {
        const element = data["lessons"][key];
        data["vocabulary"][key] = element["vocabulary"];
    }
    data["bookpage"]   = await Bookpage_Read_Mutiple(arrLesson["lesson"]);
    data["dialogue"]   = await Dialogue_Read_Mutiple(arrLesson["lesson"]);
 }
 var result = {};
 
 var lessons = Object.keys(data["lessons"]);
 var indexCurrent = -1;
 for (let index = 0; index < lessons.length; index++) {
   const les = lessons[index];
   if(les == inputLesson || les == inputLesson.toUpperCase()){
    indexCurrent = index;
    break;
   }
 }
 var lessonRender = [];
 for (let index = indexCurrent - pageNumber; index < indexCurrent + pageNumber + 1; index++) {
    if(index >= 0 && index < lessons.length) lessonRender.push(lessons[index]);
 }

 for (const key in data["lessons"]) {
    if(lessonRender.includes(key)){
        var lesson     = data["lessons"][key];
        var bookpage   = data["bookpage"][key];
        var dialogue   = data["dialogue"][key];
        var vocabulary = data["vocabulary"][key];
        // DELETE VOCAB FALSE
        let vocabkeys = Object.keys(vocabulary);
        for (let index = 0; index < vocabkeys.length; index++) {
            const vocabkey = vocabkeys[index];
            if(vocabulary[vocabkey] == false) delete vocabulary[vocabkey];
        }
        var extras = {};
        
        // TITLE
        extras["title"]     = UI_Language_Object(lesson["title"] || {});
        extras["lesson-id"] = key;
        extras["cover"]     = "content/lessons/" + key + "/cover.png";
        
        // TYPE 
        var type            = Safe_Get(lesson, ["info", "type"], "");
        var info            = Core_Data_Value("lessons/types", type, "bookparagraph") || "***";
        extras["type"]      = UI_Language_Object(info, "");
        
        // DIALOGUE
        var display              = await Dialogue_Display(dialogue, "columns");
        extras["dialogue"]       = display.outerHTML;
        
        var title                = Safe_Get(dialogue, ["info", "title"], {}); 
        extras["dialogue-title"] = UI_Language_Object(title, "");
        
        
        // VOCABULARY
        var vocabulary       = await Vocabulary_Display(vocabulary, "dynamic");
        extras["vocabulary"] = vocabulary.outerHTML;
        
        
        // RENDER PAGE
        var rendered = await Bookpage_Render(bookpage, extras, {scale:true, layout:false, shadow:true});
        result[key] = rendered; 
    }
 }

 return result;
}

async function Lesson_Popup_SelectTypePlacement(selected)
{
  var promise = new Promise(async(resolve, reject) =>
 {
  var config = Core_Config("lesson-placement");
     
  var content        = UI_Element_Create("lessons/popup-placement-select", {}, {language:"lessons/popups"});
  var program_select = UI_Element_Find(content, "program");
  var lesson_select  = UI_Element_Find(content, "lesson");
 
  // PROGRAMS
  var programs = Object.keys(config);
  Document_Select_AddOption(program_select, "", "");
  Document_Select_OptionsFromValues(program_select, programs, programs);
  program_select.onchange = 
  function()
  { 
   Document_Select_Clear(lesson_select);
   Document_Select_AddOption(lesson_select, "", "");
  
   var program = program_select.value;
   if(program != "") 
   {
    var lessons  = (config[program]["lessons"]).split(",");
    Document_Select_OptionsFromValues(lesson_select, lessons, lessons);
   }

  }
  
  if(selected)
  {
   var selectedProgram = null;
   programs.forEach(element => {
    var lessons =  config[element]["lessons"] ;
    
    if(lessons.includes(selected)) selectedProgram = element;
   });
   program_select.value = selectedProgram;
   program_select.onchange();
   
   lesson_select.value = selected;
  }
  
   
  var onescape =
  function()
  {
   resolve(false);
   
   return true;
  }
  
  var button_select = 
  {
   text   : UI_Language_String("lessons/popups", "catalog select select"),
   onclick:
   function(popup)
   {
    var lesson  = lesson_select.value;
	  resolve(lesson);	

	  UI_Popup_Close(popup);
   }
  }
 
  await UI_Popup_Create({content}, [button_select], "flexi", {open:true, escape:onescape});
  
  // RESOLVE
 });
 
 return promise;
}


function Lesson_Type(lesson)
{
  var programs = Core_Config("programs");
  for (const pkey in programs) {
      var program = programs[pkey]
      for (const key in program) {
          if(key != "name" && key != "program" && key != "levels" && key != "type"){
              var listLesson = program[key];
              var arrLesson = listLesson.split(",");
              if(arrLesson.indexOf(lesson) >= 0 || arrLesson.indexOf(lesson.toUpperCase()) >= 0){
                return program["type"];
              }
          }
      }
  }
  return false;
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          L O G I N                                             //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Login_OnLoad(module, data)
{
 // LOGO
 var image   = UI_Element_Find(module, "logo");
 var source  = Resources_URL("images/login-logo.png", "partner");
 Document_Image_Load(image, [source]);
 
 // BACKGROUND
 var video = UI_Element_Find(module, "background-video");
 video.src = Resources_URL("video/login-loop.mp4", "partner");
 
 // SETUP LOGIN BUTTON
 var button       = UI_Element_Find(module, "button-login");
 button.innerHTML = UI_Language_String("login", "login button text");
 button.onclick   = Login_Login;
 
 // SETUP SSO LOGIN BUTTON
  var container = UI_Element_Find(module, "button");
  var text    = UI_Language_String("login", "ssologin button text");
  let element = UI_Element_Create("login/button-ssologin-plain", {text:text});
  
  // MENU ITEM ID
  Document_Element_SetData(element, "uid", "button-ssologin");
  
  // MENU ITEM ICON
  var sources = [];
  var icon    = UI_Element_Find(element, "icon");
  var image   = Module_Data("login", "ssologin button text", "ssologin-icon");
  sources.push(Resources_URL("images/" + image) + ".png");
  
  Document_Image_Load(icon, sources);
  
  //Document_Element_SetData(element, "module", item);
  element.onclick           = Login_SSOLogin;  
  //element.style.visibility  = "hidden";
  container.appendChild(element);
 
 // SETUP FIELDS TO SUBMIT LOGIN EVENT ON ENTER KEY PRESSED
 Document_Handler_EnterKey(UI_Element_Find(module, "username"), Login_Login);
 Document_Handler_EnterKey(UI_Element_Find(module, "password"), Login_Login);
}




async function Login_OnShow(module, data)
{
 // LOGO
 var logo  = UI_Element_Find(module, "logo");
 var login = UI_Element_Find(module, "login");
 
 UI_Element_Find("background-video").play()
 
 await Document_Element_Animate(logo,  "fadeInUp 1.5s ease-out 1");
 
 Document_Element_Show(login);
 Document_Element_Animate(login, "fadeIn 0.5s linear 1");
}




async function Login_OnUnload()
{
}







// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          M O R E                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Login_Login()
{
 var login    = UI_Element_Find("login");
 var username = UI_Element_Find("username");
 var password = UI_Element_Find("password");
 
 var response = await Core_Api("Core_Login", {user_id:username.value, password:password.value});
 
 if((typeof response == "object") && (response["id"]))
 {
  // ANIMATE DISAPPEARANCE
  var box = UI_Element_Find("box-main");
  
  await Document_Element_Animate(box, "fadeOutUp 1.75s ease-out 1 normal forwards");
  await Module_Load("main", document.body);
  await Module_Load("home");
 }
 else
 {
  Document_Element_Animate(login, "headShake 0.75s linear 1");
 }
 
}

async function Login_SSOLogin()
{
  window.location.href = "ssologin.php?goauth=y&crossUser=google";
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          M A I N                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Main_OnLoad(module, data)
{ 
 // TEXTURE
 UI_Element_Find(module, "texture").style.backgroundImage = "url(" + Resources_URL("images/texture.jpg", "partner") + ")";

  
 // USER PROFILE
 var user     = await Core_User();
 var element  = UI_Element_Create("main/menu-item-user", {username:user["firstname"]});
 
 
 // APPLY USER PREFERENCES
 Profile_Preferences_ApplyLanguage();
 Profile_Preferences_ApplySize();
 
 
 
 var icon     = UI_Element_Find(element, "user-propic");
 User_Picture_Load(icon, user);
 
 icon.onclick = Main_Menu_LoadModule;
 Document_Element_SetData(icon, "module", "profile");
 
 UI_Element_Find(module, "main-user").appendChild(element);
 Document_Element_Animate(element, "slideInLeft 1s 1 ease-out");
 
 	
 // BUILD MENU
 var container = UI_Element_Find(module, "main-menu");

 var modules = Safe_Get(application, ["config", "roles", user["role"], "modules"], "");
 var menu    = Array_From_String(modules);
 for(var item of menu)
 {
  // MENU ITEM TEXT
  var text    = UI_Language_String(item, "module");
  let element = UI_Element_Create("main/menu-item-plain", {text:text});
  
  // MENU ITEM ID
  Document_Element_SetData(element, "uid", "menu-" + item);
  
  // MENU ITEM ICON
  var sources = [];
  var icon    = UI_Element_Find(element, "icon");
  var image   = Module_Data(item, "module", "menu-icon");
  sources.push(Resources_URL("images/" + image) + ".png");
  
  Document_Image_Load(icon, sources);
  
  Document_Element_SetData(element, "module", item);
  element.onclick           = Main_Menu_LoadModule;  
  element.style.visibility  = "hidden";
  
  container.appendChild(element);
 }
  
 Document_Element_AnimateChildren(container, "slideInUp 1s 1 ease-out", 
 {
  delay:    0, 
  interval: 175, 
  onstart:
  function(element) 
  {
   element.style.visibility = "visible"
  }
 });
 
}




async function Main_OnShow(module, data)
{
 //Module_Load("home");
 /*
 var container = UI_Element_Find(module, "main-menu");
 container.style.overflow = "auto hidden";
 Document_Element_FitContent(container, 0.1);
 container.style.overflow = "hidden";
 */
}








async function Main_OnUnload()
{
}




// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          M E N U                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Main_Menu_LoadModule(event)
{
 var element = event.currentTarget;
 var module  = Document_Element_GetData(element, "module");
 
 var container = UI_Element_Find("main-menu");
 Document_Conditional_Class(container, "shadow-sharp-bottom",   element);
 // Document_Conditional_Class(container, "style-highlight-light", element);
 
 Module_Load(module);
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                    M E S S A G E S                                             //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Messages_OnLoad(module, data)
{
 
}



async function Messages_OnShow(module, data)
{
 var items = {};
 
 for(var group of ["unread", "this week", "last week", "last month"])
 {
  var item        = {};
  
  item["icons"]   = [];
  item["text"]    = UI_Language_String("messages/groups", group);
  item["period"]  = Core_Data_Value("messages/groups", group, "period");
  item["onclick"] = Messages_List;
  
  items[group]    = item;
 }
 
 var header = UI_Header("classes", items, {selectfirst:false, css:"color-noted", template:"big"});
 UI_Header_Set(header, "unread", true);

 UI_Element_Find(module, "module-header").appendChild(header);
}




async function Messages_OnUnload()
{
}





// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          M O R E                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Messages_List(item)
{
 UI_Element_Find("message-display").style.visibility = "hidden";
 
 // LOAD OR RETRIEVE MESSAGES
 if(item)
 {
  var period   = item["period"];
 
  switch(period) 
  {
   case "unread":
	 var range  = {from:undefined, to:undefined};
	 var unread = true;
   break;
   
   default:
	 var range  = Date_Range(period);
	 var unread = false;
   break;
  }
 
  var messages = await Core_Api("Messages_List", {date_from:range["from"], date_to:range["to"], options:{unread, users:true}});
  Core_State_Set("messages", "data",    messages);
  Core_State_Set("messages", "section", item);
 }
 else
 {
  var messages = Core_State_Get("messages", "data", messages);
 }
 
 
 
 // NO MESSAGES?
 if(messages.length == 0)
 {  
  Core_State_Set("messages", "list", false);
 
  var none            = UI_Element_Create("messages/message-none");
   
  var container       = UI_Element_Find("messages-list");
  container.innerHTML = "";
  container.appendChild(none);
 
  return;
 }
  
  
  
 // LIST MESSAGES 
 var list = UI_List_Items(messages, ["style-outlined-accented", "outline-inner"], Messages_Message_Open, {style:"vertical", overflow:true},
 function(message)
 {  
  console.log(message);
  
  // SENDER
  var sender = [Safe_Get(message, ["sender", "firstname"], ""), Safe_Get(message, ["sender", "lastname"], "")].join("");
  
  // SUBJECT
  var subject = Safe_Get(message, "subject", "");
  
  
  // CREATE ITEM
  var item = UI_Element_Create("messages/message-item", {sender, subject});
  Document_Element_SetData(item, "message", message["id"]);
  
  // SENDER PICTURE
  var picture = UI_Element_Find(item, "picture");
  
  if(message["sender_id"])
  {
   User_Picture_Load(picture, message["sender_id"]);
  }
  else
  {
  }
  
  // READ/UNREAD
  if(message["date_read"]) 
  {
   Document_CSS_SetClass(item, "style-translucent-medium");
  }
  
  
  // ACTIONS
  var actions = UI_Element_Find(item, "actions");
  
  
  // DELETE
  var element = UI_Element_Create("messages/icon", {icon:"trash-can"});
  Document_Element_SetData(element, "message", message["id"]);
  element.onclick = Messages_Message_Delete;
  actions.appendChild(element);
  
  // SET READ/UNREAD
  if(message["date_read"]) 
  {
   var icon = "envelope-open";
  }
  else
  {
   var icon = "envelope";
  }
  

  return item;
 });
 
 Core_State_Set("messages", "list", list);
 
 
 // DISPLAY LIST
 var container       = UI_Element_Find("messages-list");
 container.innerHTML = "";
 container.appendChild(list);
}




async function Messages_Message_Open(element)
{
 var id      = Document_Element_GetData(element, "message");
 var message = await Core_Api("Messages_Read", {id});
 
 
 // DISPLAY
 var display = UI_Element_Find("message-display");
 Messages_Message_Display(message, display);
 
 display.style.visibility = "visible";
 

 // SET MESSAGE AS READ 
 await Core_Api("Messages_Set_Read", {id, read:true});
}




function Messages_Message_Display(message, container)
{
 // SUBJECT
 var text = message["subject"]; 
 UI_Element_Find(container, "message-subject").innerHTML = text; 
  
 // TEXT
 var text = UI_Language_String("messages/admin-task-language",message["text"]); 
 UI_Element_Find(container, "message-text").innerHTML = text;
}




async function Messages_Message_Delete(event)
{
 var element = event.currentTarget;
 var id      = Document_Element_GetData(element, "message");
 
 // CONFIRM
 var title    = UI_Language_String("messages/popups", "delete title"); 
 var content  = UI_Language_String("messages/popups", "delete text"); 
 var picture  = Resources_URL("images/cover-alert.jpg");
 
 var confirm = await UI_Popup_Confirm(title, content, picture);
 if(!confirm) return;
 
 
 //DELETE
 await Core_Api("Messages_Delete", {id});
 UI_Element_Find("message-display").style.visibility = "hidden";
 
 
 // REFRESH LIST
 var section = Core_State_Get("messages", "section");
 await Messages_List(section);
}




async function Messages_Message_Popup(id)
{
 // LOAD MESSAGE
 var message = await Core_Api("Messages_Read", {id});
 
 // ENCAPSULATE
 var content = UI_Element_Create("messages/popup-content");
 Messages_Message_Display(message, content);
 
 // DISPLAY POPUP
 await UI_Popup_Intermission(false, content, false, 5);
 
 // SET MESSAGE AS READ 
 await Core_Api("Messages_Set_Read", {id, read:true});
}




async function Messages_Pending_Popups()
{
 var pending = await Core_Api("Messages_List", {options:{type:"popup", unread:true}});
 
 for(var message of pending)
 {
  await Messages_Message_Popup(message["id"]);
 }
}



async function Messages_Popup_SendMultiple(ids, options = {})
{
 var users = [];
 
 // COLLECT TEMPLATES
 var templates = await Core_Api("Core_Files_PartnerTemplates", {type:"messages"});
  
 // CREATE POPUP CONTENT
 var content = UI_Element_Create("messages/popup-sendmultiple", {}, {language:"messages/popups"});
 
 
 // USERS SPECIFIED
 if(Object_Is_Array(ids))
 {
  // READ USERS
  users = await Core_Api("Users_Read", {ids, fields:"id,firstname,lastname", options:{order:"firstname,lastname", array:true}});
 }
 else
 // USERS LOADED DYNAMICALLY BY QUERY
 {
  // ASSUME IDS IS A STANDARD QUERY NAME
  var name = ids; 
  users    = await Core_Api("Queries_Query", {name, fields:["id", "name", "lastname"]});
 }
 
 
 // DISPLAY USERS
 for(var user of users) 
 {
  user["text"]  = [user["firstname"], user["lastname"]].join(" ");
  user["value"] = "checked";
 }
 
 var list = UI_List_Checks(users, "tight"); 
 UI_Element_Find(content, "users").appendChild(list);

 
 // FILL TYPES SELECT
 var select = UI_Element_Find(content, "types");
 UI_Select_FromDatapage(select, "messages/types");
 select.value = "message";
 
 
 // FILL TEMPLATE SELECT
 var select = UI_Element_Find(content, "templates");
 Document_Select_AddOption(select, "", "");
 for(var template of templates) Document_Select_AddOption(select, template, template);
 
 select.onchange = 
 async function(event)
 {
  var element  = event.currentTarget;
  var template = element.value; 
  var html     = await Core_Api("Messages_Template", {template, data:options["data"] || {}});
  
  UI_Element_Find(content, "preview").innerHTML = html;
 }
 
 var button_send = 
 { 
  text   : UI_Language_String("messages/popups", "button send"), 
  onclick: 
  async function()
  {
   var users = [];
   var items = Document_Element_GetObject(list, "items");
   for(var item of items) if(item["value"]) users.push(item["id"]);
    
   
   // CONFIRM  
   var title    = UI_Language_String("messages/popups", "messages send title"); 
   var text     = UI_Language_String("messages/popups", "messages send text", {count:users.length}); 
   var picture  = Resources_URL("images/cover-alert.jpg");
   var confirm  = await UI_Popup_Confirm(title, text, picture);
   
   if(!confirm) return;
   
   
   // SEND
   var sender_id       = User_Id();
   var subject         = UI_Element_Find(content, "subject").value;
   var type            = UI_Element_Find(content, "types").value;
   var template        = UI_Element_Find(content, "templates").value;
   var date_expiration = Date_From_Input(UI_Element_Find(content, "expiration").value);
   if(!date_expiration) date_expiration = false;
   
   if(options["fields"]) var fields = options["fields"]; else var fields = false;
     
   await Core_Api("Messages_Send_Multiple", {sender_id, users, subject, options:{template, date_expiration, type, fields}});
   
   
   // CLOSE
   UI_Popup_Close(popup);
  }
 }
 
 // POPUP
 var popup = await UI_Popup_Create({content}, [button_send], "intermission-content", {open:true, escape:true});
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          N U L L                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Null_OnLoad(module, data)
{
 // RE-READ USER
 await Core_User();
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                     P E R F T E S T                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Perftest_OnLoad(module, data)
{
	
}



async function Perftest_OnShow(module, data)
{
 // HOW LONG?
 var time = Time_Now() + (Client_Location_Parameter("time") || 10);
 
 // WHAT TEST?
 var script = Safe_Function("Perftest_Script_" + String_Capitalize_Initial(Client_Location_Parameter("script")), function(){});  
 
 // GO 
 while(Time_Now() < time)
 {	 
  await script();
 }
 
 // DONE
 console.log("done");
}



async function Perftest_OnUnload()
{
}





// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      S C R I P T S                                             //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



async function Perftest_Script_Random()
{
 var scripts = Functions_List("Perftest_Script");
 delete scripts["Perftest_Script_Random"];
 
 var script = scripts[Array_Elements_Random(Object.keys(scripts))];
 await script();
}




async function Perftest_Script_Teach()
{
 var t = Client_Location_Parameter("t") || 0.5;
 t = t * 1000;
 setTimeout(function(){
	location.reload(true);
 },600000);
 try {
		// LOAD TEACHER PAGE AND WAIT A BIT
	await Module_Load("teach", UI_Element_Find("main-module"));
	await Client_Wait((500 + Numbers_Random(0, 2500)) / 1000);

	// FIND ALL CLASSES
	var table   = UI_Element_Find("classes-calendar");
	var cells   = Document_Element_Children(table, true);
	var classes = [];
	for(var cell of cells)
	{
	var data = Document_Element_GetObject(cell, "classes");
	if(data) classes.push(...data);
	}


	// EXTRACT A CLASS AND LOAD IT
	var cls = Array_Elements_Random(classes);
	Core_State_Set("global", ["view-class"], cls["id"]);
	await Module_Load("classroom", UI_Element_Find("main-module"));
	await Client_Wait((t + Numbers_Random(0, 1000)) / 1000);

	// PLAY AROUND WITH STUDENTS AND SLIDES, RANDOMLY
	var actions = Numbers_Random(5, 15);
	for(var i = 0; i<actions; i++)
	{
		var action = Numbers_Random(0, 2);   

		switch(action)
		{
		// CLICK AND ASSESS A STUDENT
		case 0:
			var seats = Core_State_Get("classroom", ["class", "seats"]);
			var seat  = Array_Elements_Random(seats);
			await Classroom_Manage_SelectStudent(undefined, seat);
		
			// ASSESS RANDOMLY
			var assessments = Numbers_Random(1, 5);
			
			// GET SELECTS IN ASSESSMENT PANEL
			var panel    = UI_Element_Find("presentation-panel-right")
			var elements = Document_Element_Children(panel, true);
			var selects  = [];
			for(var element of elements) if(element.tagName == "SELECT") selects.push(element);

			for(var a = 0; a<assessments; a++)
			{
			var select = Array_Elements_Random(selects);
			select.value = Array_Elements_Random(select.options).value;
			Document_Event_Trigger(select, "change");
			
			await Client_Wait((t + Numbers_Random(0, 1000)) / 1000);
			}
		break;

		// CLICK A SLIDE
		case 1:
			// LIST SLIDES
			var panel    = UI_Element_Find("presentation-thumbnails");
			var elements = Document_Element_Children(panel);
			var slides   = [];
			for(var element of elements) if(element.onclick) slides.push(element);
			
			// PICK A RANDOM ONE, CLICK IT, AND WAIT A BIT
			var slide = Array_Elements_Random(slides);
			Document_Event_Trigger(slide, "click");
			
			await Client_Wait((t + Numbers_Random(0, 1000)) / 1000);
		break;
		}
    }
 } catch (error) {
	console.log(error)
 }
 
 
 await Client_Wait((500 + Numbers_Random(0, 100)) / 1000);
}




async function Perftest_Script_Course()
{
 var t = Client_Location_Parameter("t") || 1;
 t = t * 1000;
 setTimeout(function(){
	location.reload(true);
 },600000);
 // LOAD COURSE PAGE AND WAIT A BIT
 await Module_Load("course", UI_Element_Find("main-module"));
 var moduleBody = Core_State_Get("course","module-body");
 await Client_Wait((t + Numbers_Random(0, 100)) / 1000);
 var actions = Numbers_Random(5,15);
 console.log("Random class : " + actions)
 var countcatch = 0;
 for (let a = 0; a < actions; a++) {
	try {
		//RANDOM CLICK LABELS AND GET CLASSES 
		var labels = ['past', 'last month', 'last week', 'this week', 'next week', 'next month', 'future'];
		//var labels = ['past'];
		var classes = [];
		while (classes.length == 0) {
			var key = Numbers_Random(0, 6);
			var label = UI_Element_Find(moduleBody,labels[key]);

			Document_Event_Trigger(label, "click");
			await Client_Wait((t*2 + Numbers_Random(0, 1000)) / 1000);

			var classList   = UI_Element_Find("classes-list");
			if(typeof classList.children[0] != "undefined"){
			/* for (let index = 0; index < classList.children[0].children.length; index++) {
				let element = classList.children[0].children[index];
				classes.push(element);
			} */
			let element = classList.children[0].children[0];
			classes.push(element);
			}
		}
		await Client_Wait((t/2 + Numbers_Random(0, 1000)) / 1000);

		// LOAD CLASS
		var cls = Array_Elements_Random(classes);
		console.log("class:",cls);
		Document_Event_Trigger(cls, "click");
		await Client_Wait((t*5 + Numbers_Random(0, 1000)) / 1000);


		// CREATE HOMEWORK TEST OR VOCAB TEST
		var check = false;
		var count = 0;
		while (check == false) {
			try {
				var rows = UI_Element_Find("content-rows").children;
				check = true;
			} catch (error) {
				count ++;
				await Client_Wait((t*2 + Numbers_Random(0, 1000)) / 1000);
				if(count == 10) break;

				console.log("error........................."+error);
				console.log(UI_Element_Find("content-rows"));
			}
		}
		if(count == 10) continue;
		
		var testaction = [];
		for (let i = 0; i < rows.length; i++) {
			let element = rows[i];
			let caption = UI_Element_Find(element,"caption");
			if(typeof caption !== "undefined" && caption.textContent == "VIDEO") {
				testaction.push(element);
			}
			if(typeof caption !== "undefined" && caption.textContent == "HOMEWORK") {
				testaction.push(element);
			}
			if(typeof caption !== "undefined" && caption.textContent == "VOCABULARY") {
				testaction.push(element);
			}
			if(typeof caption !== "undefined" && caption.textContent == "MATERIALS") {
				testaction.push(element);
			}
			if(typeof caption !== "undefined" && caption.textContent == "CLASSROOM") {
				testaction.push(element);
			}
		}
		console.log("testaction:",testaction);
		// RAMDOM TEST ACTION
		var testactionramdom = [];
		let actionnumber = Numbers_Random(1, testaction.length);
		//actionnumber = 1;
		for (let r = 0; r < actionnumber; r++) {
			let actionindex = Numbers_Random(0, testaction.length - 1);
			testactionramdom.push(testaction[actionindex]);
		}

		for (let e = 0; e < testactionramdom.length; e++) {
			var element = testactionramdom[e];
			let caption = UI_Element_Find(element,"caption");
			let action = UI_Element_Find(element,"actions");
			if(typeof action !== "undefined")
			{
				var listaction = action.children
				// RANDOM LISTACTION
				var randomlistaction = [];
				let actionnumber = Numbers_Random(1, listaction.length);
				for (let r = 0; r < actionnumber; r++) {
					var actionindex = Numbers_Random(0, listaction.length - 1);
					if(typeof listaction[actionindex] != "undefined")
					randomlistaction.push(listaction[actionindex]);
				}
				//console.log("randomlist",randomlistaction);
				for (let l = 0; l < randomlistaction.length; l++) {
					var act = randomlistaction[l];
					if(act.classList.contains("style-disabled")) {}
					else
					{
						try {
							Document_Event_Trigger(act, "click");

							await Client_Wait((t*2 + Numbers_Random(0, 1000)) / 1000);

							switch (caption.textContent) {
								case "HOMEWORK": case "VOCABULARY":
									
									// RANDOM SCORE TEST 
									var type =  Core_State_Get("activity", ["type"]);
									var checkfinishtest = UI_Element_Find("activity-finish");
									if(typeof checkfinishtest == "undefined") break;
									while (checkfinishtest.style.display == "none"){
										// NOT FINISH
										let score = Numbers_Random(0, 10) / 10;

										await Client_Wait((t/2 + Numbers_Random(0, 1000)) / 1000);

										switch (type) {
											case "test":
												let sheets = Core_State_Get("activity", ["data","sheets"]);
												console.log(sheets);
												let index = Core_State_Get("activity", ["data","index"]);
												if(sheets == []) console.log("check empty...........................")

												sheets[index]["result"] = score;
												Core_State_Set("activity", ["data","sheets"],sheets);
												await Client_Wait((t/2 + Numbers_Random(0, 1000)) / 1000);

												if(index == sheets.length -1 )
												{
													var next = UI_Element_Find("activity-next")
													next.style.display = "none";
													
													checkfinishtest.style.display = "flex";
													Document_Element_Animate(checkfinishtest, "flash 1.5s 1.5");
													await Client_Wait((t/2 + Numbers_Random(0, 1000)) / 1000);
												}
												else {
													// RANDOM CHOOSE SHEETS
													var nextslide = Numbers_Random(index + 1, sheets.length - 1)
													for (let slideindex = index; slideindex < nextslide; slideindex++) {
														sheets[slideindex]["result"] = score;
														Core_State_Set("activity", ["data","sheets"],sheets);	
													}
													Core_State_Set("activity", ["data","index"],nextslide - 1);

													Activity_Test_Next();
												}

												break;
										
											case "vocabulary":
												let data = Core_State_Get("activity", ["data"]);
												let vocabindex = Core_State_Get("activity", ["index"]);

												data[vocabindex]["score"] = score;
												Core_State_Set("activity", ["data"],data);
												await Client_Wait((t/2 + Numbers_Random(0, 1000)) / 1000);

												if(vocabindex == data.length -1 )
												{
													checkfinishtest.style.display = "flex";
													Activity_Vocabulary_UpdateLastTerm();
													await Client_Wait((t/2 + Numbers_Random(0, 1000)) / 1000);
												} 
												else{
													// RANDOM CHOOSE DATA
													var nextdata = Numbers_Random(vocabindex + 1, data.length - 1)
													for (let slideindex = vocabindex; slideindex < nextdata; slideindex++) {
														data[slideindex]["score"] = score;
														Core_State_Set("activity", ["data"],data);	
													}
													Core_State_Set("activity", ["index"],nextdata - 1);

													Activity_Vocabulary_ControlNext();
												} 
												break;
										}
										
										await Client_Wait((t/2 + Numbers_Random(0, 500)) / 1000);
									}
									
									//Document_Event_Trigger(checkfinishtest, "click");
									await Client_Wait((t + Numbers_Random(0, 1000)) / 1000);

									break;
								case "CLASSROOM":
									var slides = Core_State_Get("activity",["presentation","slides"]);
									for (let s = 0; s < slides.length; s++) {
										var next = UI_Element_Find("activity-next")
										if(typeof next == "undefined") break;
										Document_Event_Trigger(next, "click");
										await Client_Wait((t + Numbers_Random(0, 1000)) / 1000);
									}
									break;
								default:
									var playbutton = UI_Element_Find(UI_Element_Find("player"),"control-play");
									if(typeof playbutton !== "undefined"){
										UI_Element_Find("video").muted="muted";
										await Client_Wait((t*2 + Numbers_Random(0, 500)) / 1000);
										Document_Event_Trigger(playbutton, "click");

										await Client_Wait((t*10 + Numbers_Random(0, 1000)) / 1000);
									} 
									else await Client_Wait((t*3 + Numbers_Random(0, 1000)) / 1000);
									break;
							}
						} catch (error) {
							await Client_Wait((t + Numbers_Random(0, 1000)) / 1000);
							console.log("error........................."+error)
						}
					} 
					//REMOVE POPUP 
					let buttonclose = UI_Element_Find("buttons");
					if(typeof buttonclose !== "undefined")	Document_Event_Trigger(buttonclose, "click");
					await Client_Wait((t + Numbers_Random(0, 1000)) / 1000);
			
					var popup = UI_Element_Find("layer-back");
					if(typeof popup !== "undefined" ) 
					{
						popup.parentElement.remove();
						var body = UI_Element_Find(document.body, "main-body");
						Document_CSS_UnsetClass(body, "style-blurred-medium");
					}
					await Client_Wait((t + Numbers_Random(0, 1000)) / 1000);

				}	
			}
		}
		
		await Client_Wait((t + Numbers_Random(0, 1000)) / 1000);
	} catch (th) {
		countcatch++;
		console.log("error:..." + th);
		if(countcatch == 5) location.reload();
		continue;
	}
 }

}



async function Perftest_Script_CourseNoRandom()
{
  var t = Client_Location_Parameter("t") || 1;
  t = t * 1000;
  // LOAD COURSE PAGE AND WAIT A BIT
  await Module_Load("course", UI_Element_Find("main-module"));
  var moduleBody = Core_State_Get("course","module-body");
	try {
		//RANDOM CLICK LABELS AND GET CLASSES 
		var labels = ['last week', 'this week'];
		var classes = [];
    var key = 0;
		while (key < 2) {
			var label = UI_Element_Find(moduleBody,labels[key]);

			Document_Event_Trigger(label, "click");
			await Client_Wait((t + Numbers_Random(0, 1000)) / 1000);

			var classList   = UI_Element_Find("classes-list");
			if(typeof classList.children[0] != "undefined")
			for (let index = 0; index < classList.children[0].children.length; index++) {
				let element = classList.children[0].children[index];
				console.log("class:",element);
        
        // LOAD CLASS
        Document_Event_Trigger(element, "click");
        await Client_Wait((t + Numbers_Random(0, 1000)) / 1000);
        // CREATE HOMEWORK TEST OR VOCAB TEST
        var check = false;
        while (check == false) {
          try {
            var rows = UI_Element_Find("content-rows").children;
            check = true;
          } catch (error) {
            console.log("error........................."+error);
            console.log(UI_Element_Find("content-rows"));
            break;
          }
        }

        if(check)
        for (let i = 0; i < rows.length; i++) {
          let element = rows[i];
          let caption = UI_Element_Find(element,"caption");
          let action = UI_Element_Find(element,"actions");
        
          if(typeof action !== "undefined" && typeof caption !== "undefined")
          {
            var listaction = action.children
            // RANDOM LISTACTION
            var randomlistaction = [];
            let actionnumber = Numbers_Random(1, listaction.length);
            for (let r = 0; r < actionnumber; r++) {
              var actionindex = Numbers_Random(0, listaction.length - 1);
              if(typeof listaction[actionindex] != "undefined")
              randomlistaction.push(listaction[actionindex]);
            }
      
            for (let l = 0; l < randomlistaction.length; l++) {
              var act = randomlistaction[l];
              if(act.classList.contains("style-disabled")) {}
              else
              {
                try {
                  Document_Event_Trigger(act, "click");

                  await Client_Wait((t + Numbers_Random(0, 1000)) / 1000);

                  switch (caption.textContent) {
                    case "HOMEWORK": case "VOCABULARY":
                      
                      // RANDOM SCORE TEST 
                      var type =  Core_State_Get("activity", ["type"]);
                      var checkfinishtest = UI_Element_Find("activity-finish");
                      if(typeof checkfinishtest == "undefined") break;
                      while (checkfinishtest.style.display == "none"){
                        // NOT FINISH
                        let score = Numbers_Random(0, 10) / 10;

                        await Client_Wait((t/4 + Numbers_Random(0, 1000)) / 1000);

                        switch (type) {
                          case "test":
                            let sheets = Core_State_Get("activity", ["data","sheets"]);
                            console.log(sheets);
                            let index = Core_State_Get("activity", ["data","index"]);
                            if(sheets == []) console.log("check empty...........................")

                            sheets[index]["result"] = score;
                            Core_State_Set("activity", ["data","sheets"],sheets);
                            await Client_Wait((t/4 + Numbers_Random(0, 1000)) / 1000);

                            if(index == sheets.length -1 )
                            {
                              var next = UI_Element_Find("activity-next")
                              next.style.display = "none";
                              
                              checkfinishtest.style.display = "flex";
                              Document_Element_Animate(checkfinishtest, "flash 1.5s 1.5");
                              await Client_Wait((t/4 + Numbers_Random(0, 1000)) / 1000);
                            }
                            else {
                              // RANDOM CHOOSE SHEETS
                              var nextslide = Numbers_Random(index + 1, sheets.length - 1)
                              for (let slideindex = index; slideindex < nextslide; slideindex++) {
                                sheets[slideindex]["result"] = score;
                                Core_State_Set("activity", ["data","sheets"],sheets);	
                              }
                              Core_State_Set("activity", ["data","index"],nextslide - 1);

                              Activity_Test_Next();
                            }

                            break;
                        
                          case "vocabulary":
                            let data = Core_State_Get("activity", ["data"]);
                            let vocabindex = Core_State_Get("activity", ["index"]);

                            data[vocabindex]["score"] = score;
                            Core_State_Set("activity", ["data"],data);
                            await Client_Wait((t/4 + Numbers_Random(0, 1000)) / 1000);

                            if(vocabindex == data.length -1 )
                            {
                              checkfinishtest.style.display = "flex";
                              Activity_Vocabulary_UpdateLastTerm();
                              await Client_Wait((t/4 + Numbers_Random(0, 1000)) / 1000);
                            } 
                            else{
                              // RANDOM CHOOSE DATA
                              var nextdata = Numbers_Random(vocabindex + 1, data.length - 1)
                              for (let slideindex = vocabindex; slideindex < nextdata; slideindex++) {
                                data[slideindex]["score"] = score;
                                Core_State_Set("activity", ["data"],data);	
                              }
                              Core_State_Set("activity", ["index"],nextdata - 1);

                              Activity_Vocabulary_ControlNext();
                            } 
                            break;
                        }
                        
                        await Client_Wait((t/4 + Numbers_Random(0, 500)) / 1000);
                      }
                      
                      //Document_Event_Trigger(checkfinishtest, "click");
                      await Client_Wait((t/2 + Numbers_Random(0, 1000)) / 1000);

                      break;
                    case "CLASSROOM":
                      var slides = Core_State_Get("activity",["presentation","slides"]);
                      for (let s = 0; s < slides.length; s++) {
                        var next = UI_Element_Find("activity-next")
                        if(typeof next == "undefined") break;
                        Document_Event_Trigger(next, "click");
                        await Client_Wait((t/2 + Numbers_Random(0, 1000)) / 1000);
                      }
                      break;
                    default:
                      var playbutton = UI_Element_Find(UI_Element_Find("player"),"control-play");
                      if(typeof playbutton !== "undefined"){
                        UI_Element_Find("video").muted="muted";
                        await Client_Wait((t + Numbers_Random(0, 500)) / 1000);
                        Document_Event_Trigger(playbutton, "click");

                        await Client_Wait((t*5 + Numbers_Random(0, 1000)) / 1000);
                      } 
                      else await Client_Wait((t*3 + Numbers_Random(0, 1000)) / 1000);
                      break;
                  }
                } catch (error) {
                  await Client_Wait((t/2 + Numbers_Random(0, 1000)) / 1000);
                  console.log("error........................."+error)
                }
              } 
              //REMOVE POPUP 
              let buttonclose = UI_Element_Find("buttons");
              if(typeof buttonclose !== "undefined")	Document_Event_Trigger(buttonclose, "click");
              await Client_Wait((t + Numbers_Random(0, 1000)) / 1000);
          
              var popup = UI_Element_Find("layer-back");
              if(typeof popup !== "undefined" ) 
              {
                popup.parentElement.remove();
                var body = UI_Element_Find(document.body, "main-body");
                Document_CSS_UnsetClass(body, "style-blurred-medium");
              }
              await Client_Wait((t + Numbers_Random(0, 1000)) / 1000);

            }	
          }
        }
			}
      await Client_Wait((t + Numbers_Random(0, 1000)) / 1000);
      key++;
		}
	} catch (th) {
		throw th;
	}
}




async function Perftest_Script_TeachNoRandom()
{
 try {
  var t = Client_Location_Parameter("t") || 0.5;
  t = t * 1000;
		// LOAD TEACHER PAGE AND WAIT A BIT
	await Module_Load("teach", UI_Element_Find("main-module"));
	await Client_Wait((t/2 + Numbers_Random(0, 2500)) / 1000);

	// FIND ALL CLASSES
	var table   = UI_Element_Find("classes-calendar");
	var cells   = Document_Element_Children(table, true);
	var classes = [];
  var dateStart = Date_Portion(Date_Week_FirstDay(Date_Now()), "date-only") + "0000"; 
  var dateEnd = Date_Portion(Date_Week_LastDay(Date_Now()), "date-only") + "2359"; 
	for(var cell of cells)
	{
	  var data = Document_Element_GetObject(cell, "classes");
    if(data)
    {
      var date_start = data[0]["date_start"];
      if(dateEnd - date_start > 0  && date_start - dateStart > 0) 
      {
        var dataIndex = 0;
        while (dataIndex < data.length) {
          // EXTRACT A CLASS AND LOAD IT
            var cls = data[dataIndex];
            console.log("classroom:",cls)
            Core_State_Set("global", ["view-class"], cls["id"]);
            await Module_Load("classroom", UI_Element_Find("main-module"));
            await Client_Wait((t + Numbers_Random(0, 2500)) / 1000);

            // PLAY AROUND WITH STUDENTS AND SLIDES, RANDOMLY
            var actions = Numbers_Random(5, 15);
            for(var i = 0; i<actions; i++)
            {
              var action = Numbers_Random(0, 2);   

              switch(action)
              {
              // CLICK AND ASSESS A STUDENT
              case 0:
                var seats = Core_State_Get("classroom", ["class", "seats"]);
                var seat  = Array_Elements_Random(seats);
                await Classroom_Manage_SelectStudent(undefined, seat);
              
                // ASSESS RANDOMLY
                var assessments = Numbers_Random(1, 5);
                
                // GET SELECTS IN ASSESSMENT PANEL
                var panel    = UI_Element_Find("presentation-panel-right")
                var elements = Document_Element_Children(panel, true);
                var selects  = [];
                for(var element of elements) if(element.tagName == "SELECT") selects.push(element);

                for(var a = 0; a<assessments; a++)
                {
                var select = Array_Elements_Random(selects);
                select.value = Array_Elements_Random(select.options).value;
                Document_Event_Trigger(select, "change");
                
                await Client_Wait((t/4 + Numbers_Random(0, 1000)) / 1000);
                }
              break;

              // CLICK A SLIDE
              case 1:
                // LIST SLIDES
                var panel    = UI_Element_Find("presentation-thumbnails");
                var elements = Document_Element_Children(panel);
                var slides   = [];
                for(var element of elements) if(element.onclick) slides.push(element);
                
                // PICK A RANDOM ONE, CLICK IT, AND WAIT A BIT
                var slide = Array_Elements_Random(slides);
                if(typeof slide != "undefined")
                Document_Event_Trigger(slide, "click");
                
                await Client_Wait((t/4 + Numbers_Random(0, 1000)) / 1000);
              break;
              }
            }
          dataIndex++;
        }
      }
    }
	}

 } catch (error) {
	console.log(error)
 }
 
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                P R E S E N T A T I O N                                         // 
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

const PRESENTATION_FIELDS_CUSTOM   = ["name", "moveable", "readonly", "visible", "onclick_animation", "onclick_sound", "onshow_animation", "onshow_sound", "onhide_animation", "onhide_sound", "ondrop_animation", "ondrop_sound"];
const PRESENTATION_FIELDS_STANDARD = ["left", "top", "zIndex", "width", "height", "color", "backgroundColor", "borderWidth", "borderStyle", "borderColor", "borderRadius", "padding", "fontFamily", "fontSize", "fontWeight", "fontStyle", "lineHeight", "textDecoration", "textAlign", "filter"];
const PRESENTATION_SCRIPT_LINE     = ["time", "element", "command", "params", "sound"];



async function Presentation_Load(url, options = {})
{
 var width  = 1024;
 var height = 768;
 
 var presentation          = {};
 presentation["width"]     = width;
 presentation["height"]    = height;
 presentation["slides"]    = [];
 presentation["path"]      = url; 
 presentation["grid-size"] = 8;
 presentation["mode"]      = Safe_Get(options, ["mode"], "");
 
 
 var data = await Core_Api("Presentation_Read", {path:url});	
 
 
 // RESOURCES
 presentation["resources"] = data["resources"];
 
 
 // PARSE SLIDES
 for(var section of data["slides"])
 {	
  // NEW SLIDE
  var slide = Presentation_Slide_Create(section["id"], section, presentation);
  
  
  // SLIDE ELEMENTS   
  var elements = Object_Subset(section, "element");
	
  var ids = Object.keys(elements);
  for(var id of ids)
  {
   var item    = section[id];
   var element = Presentation_Element_Create(id, item["type"], item, slide);
  }
  
  
  // SLIDE SCRIPTS
  var scripts = Object_Subset(section, "script");
	
  for(var sid in scripts)
  {
   var script = Presentation_Script_Create(sid, scripts[sid], slide);
   
   // ADD ELEMENT
   slide["scripts"].push(script);
  }
    
 }
  
 return presentation;
}





async function Presentation_UpdateResources(presentation)
{
 var source    = presentation["path"];
 var resources = await Core_Api("Presentation_ListResources", {source});
 
 presentation["resources"] = resources;
 
 return;
}




function Presentation_Adjust_OnclickToScripts(presentation)
{
 var slides = presentation["slides"] || [];
 
 for(var slide of slides)
 {
  var elements = slide["elements"];
  
  for(var element of elements)
  {
   var onclick = Document_Element_GetData(element, "onclick_animation");
   if(onclick)
   {
	var uid         = Document_Element_GetData(element, "uid");
	var name        = Document_Element_GetData(element, "name");
	var script      = Presentation_Script_Create(uid, data = {name}, slide);
    
	var line        = Presentation_Script_CreateLine(script);
    line["element"] = uid;
    line["command"] = Document_Element_GetData(element, "onclick_animation");
    line["sound"]   = Document_Element_GetData(element, "onclick_sound");
	
	script["lines"].push(line);
	slide["scripts"].push(script);
	  
  
	Document_Element_SetData(element, "onclick_animation", "");
	Document_Element_SetData(element, "onclick_sound",     "");
   }	   
  }
  
 }
}



function Presentation_Adapt(presentation)
{
 var display  = presentation["display"];
 if(!display) return;
 
 var rect    = display.getBoundingClientRect();
 var scale_x = rect.width  / presentation["width"];
 var scale_y = rect.height / presentation["height"];
 
 //console.log(scale_x, scale_y);
 presentation["scale"] = {x:scale_x, y:scale_y};
 
 for(var slide of presentation["slides"])
 {
  for(var element of slide["elements"])
  {
   Presentation_Element_Reset(element);
  }
 }
}





function Presentation_Assign(presentation, display, handler)
{
 presentation["display"]       = display;
 presentation["current-slide"] = presentation["current-slide"] ?? 0;
 presentation["handler"]       = handler;
 
 Document_Element_SetObject(display, "presentation", presentation);
 
 Presentation_Adapt(presentation);
 
 display.draggable   = true;
 display.onclick     = Presentation_Event_Click;
 display.ondblclick  = Presentation_Event_Dblclick;
 display.ondragstart = Presentation_Event_DragStart;
 display.onmouseup   = Presentation_Event_MouseUp;
 display.onmousemove = Presentation_Event_MouseMove;
}








// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                           S L I D E S                                          // 
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Presentation_Slide_Create(id, data, presentation)
{
 var slide             = {};
 
 // IF NO ID DEFINED, TRY TO CREATE A NEW ONE
 if(!id && presentation) var id = Presentation_Slide_NewId(presentation);
 
 slide["id"]           = id;
 slide["header"]       = {};
 slide["elements"]     = [];
 slide["scripts"]      = [];
 slide["presentation"] = presentation;
  
 if(data && data["header"]) Object.assign(slide["header"], data["header"]);

 if(!slide["header"]["name"]) slide["header"]["name"] = "Slide " + id;


 // ADD SLIDE TO PRESENTATION
 if(presentation)
 {
  presentation["slides"].push(slide);
 }

 return slide;
}




async function Presentation_Slide_Reload(path, id, presentation)
{ 
 // CURRENT SLIDE WITH THAT ID
 var slide = Presentation_Slide_Find(presentation, id);
 if(!slide) return;
 
 var index = Presentation_Slide_Index(presentation, slide);
 
 
 // REPLACE WITH NEW SLIDE
 var section = await Core_Api("Presentation_ReadSlide", {path, slide_id:id}); 
 var slide   = Presentation_Slide_Create(id, section, presentation); 
 presentation["slides"].pop();
 presentation["slides"][index] = slide;
  
 
 // SLIDE ELEMENTS   
 var elements = Object_Subset(section, "element");
	
 var ids = Object.keys(elements);
 for(var id of ids)
 {
  var item    = section[id];
  var element = Presentation_Element_Create(id, item["type"], item, slide);
 }
   
   
 // SLIDE SCRIPTS
 var scripts = Object_Subset(section, "script");
	
 for(var sid in scripts)
 {
  var script = Presentation_Script_Create(sid, scripts[sid], slide);
   
  // ADD ELEMENT
  slide["scripts"].push(script);
 }
 
 
 return slide;
}






function Presentation_Slide_Display(slide)
{
 var presentation = slide["presentation"];
 if(!presentation["display"]) return;
 
 if(!slide) var slide = Safe_Get(presentation, ["current-slide"], false);
 if(!slide) return; 
 
 
 // RENDER
 presentation["display"].innerHTML = "";
 presentation["display"].append(...slide["elements"]);
 presentation["display"].style.backgroundColor = slide["header"]["color"] || "white";
 
 
 // SET DISPLAYED SLIDE AS CURRENT
 Safe_Set(presentation, ["current-slide"], slide);
}





function Presentation_Slide_Render(slide, display)
{  
 var presentation = slide["presentation"];
  
 display.style.position = "relative";
 display.style.overflow = "hidden";
 
 // RENDER
 var rect    = display.getBoundingClientRect();
 var scale_x = rect.width  / presentation["width"];
 var scale_y = rect.height / presentation["height"]; 
 
 display.innerHTML = "";
 for(var element of slide["elements"]) 
 {
  var node = element.cloneNode(true);
  Document_Element_Scale(node, scale_x, scale_y);
  
  display.appendChild(node);
 }
 
 display.style.backgroundColor = slide["header"]["color"] || "white";
}




function Presentation_Slide_Current(presentation)
{
 var slide = presentation["current-slide"];
 
 return slide;
}



function Presentation_Slide_Index(presentation, slide)
{
 if(!slide) var slide = presentation["current-slide"];
 
 var index = presentation["slides"].indexOf(slide);
 
 return index;
}




function Presentation_Slide_Find(presentation, id)
{
 for(var slide of presentation["slides"])
 {
  if(slide["id"] == id) return slide;
 }
}



function Presentation_Slide_Next(presentation, set, reset)
{
 var index = Presentation_Slide_Index(presentation);
 
 index = index + 1;
 if(index > presentation["slides"].length - 1) index = presentation["slides"].length - 1;
 
 var slide = presentation["slides"][index];
 
 if(reset)
 {
  Presentation_Slide_Reset(slide);
 }
 
 if(set)
 {
  Presentation_Slide_Display(slide);
 }
 
 return slide;
}





function Presentation_Slide_Prev(presentation, set, reset)
{
 var index = Presentation_Slide_Index(presentation);
 
 index = index - 1;
 if(index < 0) index = 0;
 
 var slide = presentation["slides"][index];
 
 if(reset)
 {
  Presentation_Slide_Reset(slide);
 }
 
 if(set)
 {
  Presentation_Slide_Display(slide);
 }
 
 return slide;
}





async function Presentation_Slide_NextScript(slide)
{
 var scripts = Safe_Get(slide, ["scripts"], []);
 if(scripts.length == 0) return;
 
 var current = Safe_Get(slide, ["current-script"], 0);
 if(current >= scripts.length) return;
 
 await Presentation_Script_Execute(scripts[current]);
 
 current = current + 1;
 Safe_Set(slide, ["current-script"], current);
}





async function Presentation_Slide_PrevScript(slide)
{
 var scripts = Safe_Get(slide, ["scripts"], []);
 if(scripts.length == 0) return;
 
 var current = Safe_Get(slide, ["current-script"], 0);
 if(current <= scripts.length) return;
 
 await Presentation_Script_Execute(scripts[current]);
 
 current = current - 1;
 Safe_Set(slide, ["current-script"], current);
}




async function Presentation_Slide_PlayScripts(slide, pause = 1)
{
 var scripts = slide["scripts"];

 for(var script of scripts) 
 {
  await Presentation_Script_Execute(script);

  Client_Wait(pause);
 }
}




function Presentation_Slide_GetData(slide)
{
 var data = {};
 
 
 // HEADER
 data["header"] = {};
 Object.assign(data["header"], slide["header"]);
 
 
 // ELEMENTS
 for(var element of slide["elements"])
 {
  var properties = Presentation_Element_GetData(element);
  var id         = properties["id"];
  
  data[id]       = properties;
 }
 
 
 // SCRIPTS
 var s = 0;
 for(var script of slide["scripts"])
 {
  var sid = "Script " + String(s).padStart(2, "0");
  
  var item     = {};
  item["name"] = script["name"];
  
  var n = 0;
  for(var line of script["lines"])
  {
   var lid   = String(n).padStart(2, "0");
   
   item[lid] = Object_To_String(line); 
   n = n + 1;
  }
  
  data[sid] = item;
  s = s + 1;
 }
 

 return data;
}






function Presentation_Slide_NewId(presentation)
{
 var max = -1;
 for(var s of presentation["slides"])
 {
  var i = parseInt(s["id"]);
  if(i > max) max = i;
 }
 max    = max + 1;
 
 var id = String(max).padStart(2, "0");
 
 return id;
}





function Presentation_Slide_Duplicate(slide)
{
 var presentation = slide["presentation"]; 

 var data               = Presentation_Slide_GetData(slide); 
 data["header"]["name"] = String_Copycount_Next(data["header"]["name"]);
 var duplicate          = Presentation_Slide_Create(undefined, data, presentation); 

 // CREATE A DUPLICATE OF EACH ELEMENT
 for(var element of slide["elements"]) 
 {
  Presentation_Element_Duplicate(element, duplicate);
 }  
 
 
 // CRAETE A DUPLICATE OF EACH SCRIPT
 duplicate["scripts"] = [];
 for(var script of slide["scripts"])
 {
  var scriptcopy      = {};
  
  scriptcopy["slide"] = duplicate;
  scriptcopy["id"]    = script["id"];
  scriptcopy["name"]  = script["name"];
  scriptcopy["lines"] = [];
  
  for(var line of script["lines"])
  {
   var linecopy = {};
  
   linecopy["script"]  = scriptcopy;  
   linecopy["command"] = line["command"];
   linecopy["element"] = line["element"];
   linecopy["params"]  = line["params"];
   linecopy["sound"]   = line["sound"];
   linecopy["time"]    = line["time"];
  
   scriptcopy["lines"].push(linecopy);
  }
  
  duplicate["scripts"].push(scriptcopy);
 }
 
 return duplicate;
}







function Presentation_Slide_FindTopZ(slide, valueonly)
{
 if(!slide) return 0;
 
 var top     = 0;
 var element = undefined;
 
 for(e of slide["elements"])
 {
  var z = parseInt(e.style.zIndex);

  if(z > top) 
  {
   top     = z;
   element = e; 
  }
 }
 
 if(valueonly) return top; else return element;
}




function Presentation_Slide_FindBottomZ(slide, valueonly)
{
 if(!slide) return 0;
 
 var bottom  = 2147483638;
 var element = undefined;
 
 for(e of slide["elements"])
 {
  var z = parseInt(e.style.zIndex);

  if(z < bottom) 
  {
   bottom  = z;
   element = e;
  }
 }
 
 if(valueonly) return bottom; else return element;
}





function Presentation_Slide_FindElement(slide, id)
{
 if(!slide) return;
 
 for(var element of slide["elements"])
 {
  if(Document_Element_GetData(element, "uid") == id)
  {
   return element;
  }
 }
}




function Presentation_Slide_FindScript(slide, id)
{
 if(!slide) return;
 
 for(var script of slide["scripts"])
 {
  if(script["id"] == id) return script;
 }
}




function Presentation_Slide_ElementsByName(slide, name)
{
 if(!slide) return;
 
 var elements = [];
 
 for(var element of slide["elements"])
 {
  if(Document_Element_GetData(element, "name") == name)
  {
   elements.push(element);
  }
 }
 
 return elements;
}




function Presentation_Slide_Snapshot(slide)
{
 // SNAPSHOT ALL SLIDE'S ELEMENTS
 for(var element of slide["elements"])
 {
  var data = Presentation_Element_GetData(element);
  
  Document_Element_SetObject(element, "dna", data);
 }
}





function Presentation_Slide_Reset(slide)
{ 
 var scale = Safe_Get(slide, ["presentation", "scale"]);
 
 // RESET ALL SLIDE'S ELEMENTS
 for(var element of slide["elements"] || [])
 {
  Presentation_Element_Reset(element);
  
  /*
  if(scale)
  {
   if(!element["noscale"]) Document_Element_Scale(element, scale["x"], scale["y"]);
  }
  */
 }
 
 // RESET ALL SLIDE'S SCRIPTS
 for(var script of slide["scripts"] || [])
 {
  script["executed"] = false;
 }
 
 slide["current-script"] = 0;
}









// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                        E L E M E N T S                                         // 
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Presentation_Element_Create(id, type, data = {}, slide) 
{ 
 switch(type)
 {
  case "image":
	var element = document.createElement("img");
	
	// DEFAULTS
	element.style.width  = "64";
    element.style.height = "64";
  break;
  
  
  case "shape":
	var element = document.createElement("img");
	
	// DEFAULTS
	element.style.width  = "64";
    element.style.height = "64";
  break;
  
	
  case "video":
    var element = document.createElement("video");
	
	// DEFAULTS
	element.style.width  = "128";
    element.style.height = "64";
	
	element.addEventListener("mouseover", function(){element.controls = true;},  false);
	element.addEventListener("mouseout",  function(){element.controls = false;}, false);
  break;
	
  case "text":
  case "textarea":
	var element                   = document.createElement("div");
	element.style.resize          = "none";
	element.style.backgroundColor = "transparent";
	element.style.border          = "none";
	element.style.overflow        = "hidden";
	element.innerHTML             = data["text"] || data["value"] || "";
	
	// DEFAULTS
	element.style.width  = "128";
    element.style.height = "128";
  break;
	
  case "input":
	var element              = document.createElement("input");
    element.style.resize     = "none";

	// DEFAULTS
	element.style.width  = "128";
    element.style.height = "32";
  break;
  
  
  case "iframe":
	var element = document.createElement("iframe");
	
	//element["noscale"]   = true;
    element.src          = "about:blank";
	element.style.width  = "256";
    element.style.height = "256";
	
	element.style.borderWidth = "12px";
	element.style.borderColor = "white";
	
	Document_Element_SetData(element,   "url",  "about:blank");
	//element.style.border = "0";
  break;
   
   
  default:
	var element = document.createElement("null");
  break;
 }
 

 // IF UNDEFINED, DERIVE IT FROM THE SLIDE
 if(!id && slide) 
 {
  var id = Presentation_Element_NewId(slide, type);
 }
 

 Document_Element_SetData(element,   "type",  type);
 Document_Element_SetData(element,   "uid",   id);
 Document_Element_SetObject(element, "slide", slide);
 
 // APPLY PASSED DATA
 Presentation_Element_ApplyData(element, data);
 
 
 // AUTONAME IF NEEDED
 var defaultname = String_Capitalize_Initial(type) + " " + String_Filter_AllowDigits(id);
 var elementname = data["name"] || defaultname || "";
 Document_Element_SetData(element, "name", elementname);
 
 
 // STORE ORIGINAL DATA
 Document_Element_SetObject(element, "dna", data);

 
 // LINK TO SLIDE
 if(slide)
 {
  slide["elements"].push(element);
 } 
 
 
 return element;
}






function Presentation_Element_GetData(element) 
{
 var properties = {};
 
 // ID
 properties["id"]        = Document_Element_GetData(element, "uid");
 properties["type"]      = Document_Element_GetData(element, "type");
 
 // CORE PROPERTIES
 properties["value"]     = element.value;
 properties["innerHTML"] = element.innerHTML;
 properties["className"] = element.className;
 
 // SRC
 switch(properties["type"])
 {
  case "iframe":
	properties["url"] = element.src;
  break;
	
  default:
	properties["src"] = Path_Filename(element.src);
  break;
 }
 
 
 // STANDARD PROPERTIES 
 for(var field of PRESENTATION_FIELDS_STANDARD)
 {
  properties[field] = element.style[field] || "";
 }	
  
  
 // CUSTOM PROPERTIES
 for(var field of PRESENTATION_FIELDS_CUSTOM)
 {
  properties[field] = Document_Element_GetData(element, field, "");
 }


 return properties;
}





function Presentation_Element_ApplyData(element, data)
{
 var slide = Document_Element_GetObject(element, "slide");
 var path  = Safe_Get(slide, ["presentation", "path"], "");
 	
	
 // FIXED PROPERTIES
 element.draggable        = true
 element.autocomplete     = "never";
 element.style.position   = "absolute";
 element.style.userSelect = "none";
 element.style.zIndex     = 0;


 // APPLY DATA	 
 if(data)
 {
  // CORE PROPERTIES
  element.value     = data["value"]     || data["text"] || "";
  element.innerHTML = data["innerHTML"] || data["text"] || "";
  element.className = data["className"] || "";
 
  // SRC
  switch(Document_Element_GetData(element, "type"))
  {
   case "iframe":
	element.src = data["url"];
   break;
	
   default:
	element.src = path + "/" + data["src"];
   break;
  }
 
 
  // STANDARD PROPERTIES 
  for(var field of PRESENTATION_FIELDS_STANDARD)
  {
   element.style[field] = data[field] || element.style[field] || "";
  }	
  
 
  // CUSTOM PROPERTIES
  for(var field of PRESENTATION_FIELDS_CUSTOM)
  {
   Document_Element_SetData(element, field, data[field] || "");
  }
 
 }
 
 
 // MANAGE VISIBILITY
 var slide = Document_Element_GetObject(element, "slide");
 var mode  = Safe_Get(slide, ["presentation", "mode"], "");
 if(mode == "edit")
 {
  // IN PRESENTATION EDITING MODE, ALWAYS VISIBLE
  element.style.visibility = "visible";
 }
 else
 {
  // IN REAL MODE, STARTUP VISIBILITY DEPENDS ON THE "VISIBLE" CUSTOM PROPERTY
  var visible = (Document_Element_GetData(element, "visible") != "no"); 
  
  if(visible) element.style.visibility = "visible"; else element.style.visibility = "hidden";
 }
 
 
 // MORE POSTPROCESSING FOR "LIVE" MODE
 if(mode != "edit")
 {
  // IF ELEMENT HAS AN ONCLICK EVENT, SHOW IT AS CLICKABLE
  if(Document_Element_GetData(element, "onclick_animation"))
  {
   element.style.cursor = "pointer"; 
  }
  
  // IF ELEMENT IS A VIDEO, SHOW CONTROLS AND OVERRIDE ONCLICK TO DO AUTOPLAY
  {
   
  }
 }
 

}



function Presentation_Element_Snapshot(element)
{
 var data = Presentation_Element_GetData(element);
  
 Document_Element_SetObject(element, "dna", data);
}





function Presentation_Element_Reset(element)
{
 var slide = Document_Element_GetObject(element, "slide", {});
 var scale = Safe_Get(slide, ["presentation", "scale"], false);
 
 var id   = Document_Element_GetData(element,   "uid");
 var type = Document_Element_GetData(element,   "type");
 var data = Document_Element_GetObject(element, "dna");

 Presentation_Element_ApplyData(element, data);
 
 if(scale && !element["noscale"]) Document_Element_Scale(element, scale["x"], scale["y"]);
}






function Presentation_Element_Duplicate(element, slide)
{
 if(!slide)
 {
  var slide    = Document_Element_GetObject(element, "slide");
 }

 var data      = Presentation_Element_GetData(element);
 var duplicate = Presentation_Element_Create(undefined, data["type"], data, slide);
 
 return duplicate;
}






function Presentation_Element_NewId(slide, type)
{ 
 var max = 0;
 for(e of slide["elements"])
 {
  var id = Document_Element_GetData(e, "uid");
  var n  = parseInt(String_Filter_AllowDigits(id));
  
  if(n > max) max = n;
 }
 var id = "Element " + String(max + 1).padStart(3, "0"); 
 
 return id;
}





function Presentation_Element_Active(element)
{
 var dataset = element["dataset"] || {};
 var events  = Object_Subset(dataset, "onclick_");
   
 for(var id in events)
 { 
  var ev = events[id] || "";
  
  if(ev && ev.trim() != "") 
  {
   return true;
  }   
 }
 
 return false;
}




function Presentation_Element_SendToBack(element)
{
 if(!element) return;
 
 var slide = Document_Element_GetObject(element, "slide");
 if(!slide) return;
 
 var z = parseInt(Presentation_Slide_FindBottomZ(slide, true));
 
 // IF THE BOTTOM ELEMENT HAS ALREADY A Z OF 0, WE NEED TO PUSH ALL ELEMENTS UP, AND SET THIS ONE TO 0
 if(z == 0)
 { 
  var slide = Document_Element_GetObject(element, "slide");
  for(var e of slide["elements"]) e.style.zIndex = parseInt(e.style.zIndex) + 1;
  
  element.style.zIndex = 0;
 }
 else
 { 
  element.style.zIndex = z - 1;
 }	 

}




function Presentation_Element_BringToFront(element)
{
 if(!element) return;
 
 var slide = Document_Element_GetObject(element, "slide");
 if(!slide) return;
 
 var z = Presentation_Slide_FindTopZ(slide, true);
 element.style.zIndex = parseInt(z) + 1;
}





// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                        S C R I P T S                                           // 
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

function Presentation_Script_Create(id, data = {}, slide)
{
 var script        = {};
 
 script["id"]      = id;
 script["name"]    = data["name"] || id;
 script["lines"]   = [];
 script["slide"]   = slide;
 
 if(data)
 {
  for(var lid in data)
  {
   switch(lid)
   {
	case "name":
	 script["name"] = data[lid];
	break;
	
	default:
	 var token = data[lid];
	 var line  = Object_From_String(token);
	 
	 line["script"] = script;
	 
	 script["lines"].push(line);
    break;
   }
   

  }
 }
 
 return script;
}





function Presentation_Script_CreateLine(script)
{
 var line       = {};
 line["script"] = script;
 
 for(var key of PRESENTATION_SCRIPT_LINE) line[key] = "";
 script["lines"].push(line);
 
 return line;
}




function Presentation_Script_LineTarget(line)
{
 var script = line["script"];
 if(!script) return;
 
 var slide  = script["slide"];
 if(!slide) return;
 
 if(!line["element"]) return;
 
 return Presentation_Slide_FindElement(slide, line["element"]);
}




function Presentation_Script_LineParams(line)
{
 var params = line["params"] || "";
 
 params = params.split(",");
 for(var i in params) params[i] = params[i].trim();
 
 return params;
}






async function Presentation_Script_Execute(script, onlinestart, onlineexecuted)
{
 var promise = new Promise((resolve, reject) =>
 {
  // CLEAN UP EXECUTION STATUS FOR ALL LINES
  for(let line of script["lines"]) delete line["executed"];
 
  // FIRE UP EXECUTION "THREADS" FOR ALL LINES
  for(let line of script["lines"])
  {
   var time = Math.floor(parseFloat(line["time"]) * 1000);
   if(time == "" || isNaN(time)) var time = 0;
    
   line["running"] =
   setTimeout(
   async function()
   {
	// IF ON LINE START EVENT SET, CALL BACK
    if(onlinestart) onlinestart(line);
	
	// EXECUTE     
    await Presentation_Script_ExecuteLine(line);
    
	// MARK AS EXECUTED
	clearTimeout(line["running"]);
    line["executed"] = true;
    
	// IF ON LINE EXECUTED EVENT SET, CALL BACK
    if(onlineexecuted) onlineexecuted(line);
	
    // CHECK IF ALL EXECUTED
	var done = true;
	for(let check of script["lines"])
	{
     if(!check["executed"])
     {
	  done = false;
	  break;
	 }
	}
	 
	// IF ALL EXECUTED, ASYNC RETURN FROM MAIN FUNCTION
	if(done) 
	{
     script["executed"] = true;
	 resolve();
	}
   }, 
   time);
  }
 });
 
 return promise;
}






async function Presentation_Script_ExecuteLine(line, slide)
{
 // IF SLIDE NOT EXPLICIT, DERIVE FROM SCRIPT
 if(!slide)
 {
  var script       = line["script"];
  var slide        = script["slide"];
 }
 
 var presentation = slide["presentation"];
 
 
 // DECODE COMMAND
 var command = line["command"];
 var command = Core_Data_Page("presentation/commands")[command];
 if(!command) 
 {
  return;
 }
 
 
 // TARGET ELEMENT
 var element = Presentation_Slide_FindElement(slide, line["element"]);
 
 // COMMAND PARAMETERS
 var params  = Presentation_Script_LineParams(line);
 
 
 // ANIMATION
 if(command["anim"])
 {
  var animation = command["anim"];
  const durationConfig = Core_State_Get("classroom" , ["config" , "animationDuration"]);

  if(durationConfig) {
    const commands = command["anim"].split(" ") || [];
    const newAnimation = commands.reduce((result, item, index) => {
      let newStr = item;
      if(index == 1) newStr = `${durationConfig}s`
      return `${result} ${newStr}`;
    }, "");
    animation = newAnimation;
  }
 }
 else
 {
  var animation = false;
 }
  
 
 // SOUND
 if(line["sound"])
 {
  var path  = presentation["path"];
  var sound = path + "/" + line["sound"];
 }
 else
 {
  var sound = false;
 }
 
 
 
 
 
 // EXECUTE DIFFERENT COMMAND TYPES
 switch(command["type"])
 {
  case "animate":
	 // PLAY SOUND 
     if(sound) Media_Audio_Play(sound);
	 
	 // PLAY ANIMATION
     if(element && animation) await Document_Element_Animate(element, animation);
  break;
  
  
  case "modify":
	switch(line["command"])
	{
	 case "grow":
        var time   = parseInt(params[0])   || 1;
		var factor = parseFloat(params[1]) || 2;
	
	    // PLAY SOUND 
        if(sound) Media_Audio_Play(sound); 
	
	    // EXPAND ELEMENT
		await Document_Element_Zoom(element, factor, time);
	 break;
	
	
	 case "shrink":
		var time   = parseInt(params[0])   || 1;
		var factor = parseFloat(params[10]) || 0.5;
		 
		// PLAY SOUND 
        if(sound) Media_Audio_Play(sound); 
		
		// SHRINK ELEMENT
		await Document_Element_Zoom(element, factor, time);
	 break;
	 
	 
	 case "move":
	    var params = Presentation_Script_LineParams(line);
        var time   = parseInt(params[0])   || 1;
		
		// IF 2 PARAMS, THEN PARAM 2 IS INTERPRETED AS ANOTHER ELEMENT'S NAME: WE'LL MOVE ON TOP OF THAT (CENTER-TO-CENTER)
		if(params.length == 2)
		{
	     // FIND DESTINATION ELEMENT
		 var elements = Presentation_Slide_ElementsByName(slide, params[1]);
		 if(elements.length > 0)
		 {		  
		  // FIND THIS ELEMENT'S POSITION AND CENTER
		  var position = Document_Element_Position(element); 
		  var center   = Document_Element_Center(element); 
		  
		  // DETERMINE DESTINATION ELEMENT CENTER
		  var dest     = Document_Element_Center(elements[0]);
		    
		  // SET DESTINATION
		  var left = position.left + (dest.left - center.left); 
		  var top  = position.top  + (dest.top  - center.top);
		 }
		}
		else
		{
		 var left = parseFloat(params[1]) || 0;
		 var top  = parseFloat(params[2]) || 0;
		}
		
		// PLAY SOUND 
        if(sound) Media_Audio_Play(sound);
		
		// MOVE ELEMENT
		await Document_Element_Interpolate(element, {left:left, top:top}, time);
	 break;
	 
	 
	 case "bringtofront":
	    // PLAY SOUND 
        if(sound) Media_Audio_Play(sound);
		
		Presentation_Element_BringToFront(element);
	 break;
	 
	 
	 case "sendtoback":
	    // PLAY SOUND 
        if(sound) Media_Audio_Play(sound);
	 
		Presentation_Element_SendToBack(element);
	 break;
	 
	 
	 case "center":
	    var size   = Document_Element_Size(presentation["display"]);
		
		var width  = size["width"];//parseInt(presentation["display"].style.width);
		var height = size["height"];//parseInt(presentation["display"].style.height);
		
		var left   = (width / 2)  - (parseFloat(element.style.width)  / 2);
		var top    = (height / 2) - (parseFloat(element.style.height) / 2);
		
		// PLAY SOUND 
        if(sound) Media_Audio_Play(sound);
		
		// CENTER
		element.style.left = left;
		element.style.top  = top;
	 break;
	 
	 
	 case "clearstyle":
	    // PLAY SOUND 
        if(sound) Media_Audio_Play(sound);
	 
	    // CLEAR STYLE
		element.className = "";
	 break;
	 
	 
	 case "reset":
	    // PLAY SOUND 
        if(sound) Media_Audio_Play(sound);
	 
	    // RESET ELEMENT
		Presentation_Element_Reset(element);
	 break;
    } 
  break;
  
  
  case "show":
    // SHOW ELEMENT. IF PRESENTATION IN EDIT MODE, JUST SET VISIBILITY DATA TO YES
	if(presentation["mode"] == "edit")
	{
     Document_Element_SetData(element, "visible", "yes");
	}
	else
	// OTHERWISE REALLY SHOW
	{
	 element.style.visibility = "visible";	
	}
	
	// PLAY SOUND 
    if(sound) Media_Audio_Play(sound);
	 
	// PLAY ANIMATION
    if(element && animation) await Document_Element_Animate(element, animation);
  break;
   
   
  case "hide":
    // PLAY SOUND 
    if(sound) Media_Audio_Play(sound);
	 
	// PLAY ANIMATION
    if(element && animation) await Document_Element_Animate(element, animation);
  
 
    // HIDE ELEMENT. IF PRESENTATION IN EDIT MODE, JUST SET VISIBILITY DATA TO NO
	if(presentation["mode"] == "edit")
	{
	 Document_Element_SetData(element, "visible", "no");
	}
	else
	// OTHERWISE REALLY HIDE
	{
	 element.style.visibility = "hidden";	
	}
  break;
 }


}













// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                         E V E N T S                                            // 
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Presentation_Event_Click(event)
{
 var display      = event.currentTarget;
 var presentation = Document_Element_GetObject(display, "presentation");
 var element      = event.srcElement;
 var item         = Document_Element_GetObject(element, "item");
 
 
 
 // CLICKED DISPLAY = CLICKED NOTHING
 if(element == display) 
 {
  var element = false;
  var item    = false;
 }
 
 
 // CHECK IF THE CLICK IS ACTUALLY A BYPRODUCT OF A DROP EVENT
 if(element)
 {
  var timefromdrop = Date.now() - parseInt(Document_Element_GetData(element, "droptime"));
  
  // IF IT IS, THEN LET'S CANCEL THIS EVENT. NOT A REAL CLICK
  if(timefromdrop < 100) return;
 }
 
 
 // CLICKED SOME ELEMENT (FIRE ONLY IF NOT IN EDIT MODE)
 if(element && presentation["mode"] !== "edit")
 {  
  // PROCESS ELEMENT CLICK
  var line        = {};
  line["element"] = Document_Element_GetData(element, "uid");
  line["command"] = Document_Element_GetData(element, "onclick_animation");
  line["sound"]   = Document_Element_GetData(element, "onclick_sound");
  
  var slide = Document_Element_GetObject(element, "slide");
  if(slide)
  {
   Presentation_Script_ExecuteLine(line, slide);
  }
 }
  
 
  
 // PROPAGATE TO HANDLER
 if(presentation["handler"])
 {
  var e = {};
  
  e["event"]   = "click";
  e["element"] = element;
  
  presentation["handler"](e);
 }
}






function Presentation_Event_Dblclick(event)
{
 var display      = event.currentTarget;
 var presentation = Document_Element_GetObject(display, "presentation");
 var element      = event.srcElement;
 var item         = Document_Element_GetObject(element, "item");
 
 // CLICKED DISPLAY = CLICKED NOTHING
 if(element == display) 
 {
  var element = false;
  var item    = false;
 }
 
 
 // PROPAGATE TO HANDLER
 if(presentation["handler"])
 {
  var e = {};
  
  e["event"]   = "dblclick";
  e["element"] = element;
  
  presentation["handler"](e);
 }
}





function Presentation_Event_DragStart(event)
{
 event.preventDefault();
 
 
 // IF CLICKED OUTSIDE ELEMENTS, JUST RETURN
 var display = event.currentTarget;
 if(element == display) return;
 

 // GET DATA 
 var element = event.srcElement;
 var id      = Document_Element_GetData(element, "uid");
 var slide   = Document_Element_GetObject(element, "slide");    
 var mode    = Safe_Get(slide, ["presentation", "mode"], "");
 
 
 // IF NOT IN EDIT MODE, CHECK IF THE ELEMENT IS MOVEABLE
 if(mode !== "edit")
 {
  var moveable = (Document_Element_GetData(element, "moveable") == "yes");
  if(!moveable) return;
 }	 


 // START DRAGGING 
 Document_Element_SetObject(display, "dragging", element);
 //Document_CSS_SwitchClass(element, "style-drag-dragging");
}






function Presentation_Event_MouseUp(event)
{
 var display      = event.currentTarget;
 var element      = Document_Element_GetObject(display, "dragging");
 var presentation = Document_Element_GetObject(display, "presentation"); 
 
  
 if(element)
 {
  Document_Element_SetObject(display, "dragging", undefined);
  //Document_CSS_SwitchClass(element, "style-drag-dragging");
 
  Document_Element_SetData(element, "droptime", Date.now()); 
  console.log("dropped", element);
 }
 
 
 // PROPAGATE TO HANDLER
 if(presentation["handler"])
 {
  var e = {};
  
  e["event"]   = "drop";
  e["element"] = element;
  
  presentation["handler"](e);
 }
}
 



function Presentation_Event_MouseMove(event)
{   
 var display      = event.currentTarget;
 var presentation = Document_Element_GetObject(display, "presentation"); 
 var element      = Document_Element_GetObject(display, "dragging");
  
  
 // ACQUIRE AND STORE CURRENT X, Y POSITION RELATIVE TO DISPLAY  
 var rect = event.target.getBoundingClientRect();
 var left = event.clientX - rect.left; 
 var top  = event.clientY - rect.top;
 
 Safe_Set(presentation, ["mouse"], {x:left, y:top});
 
  
  
 var grid_size    = Safe_Get(presentation, ["grid-size"], 8);
   
 if(element)
 {
  //var crect = display.getBoundingClientRect();
  //var erect = element.getBoundingClientRect();
  
  //var left = erect.left - crect.left;
  //var top  = erect.top  - crect.top;   
  
  var mx = event.movementX;
  var my = event.movementY;
  
  // var mx = Math.round(event.movementX / grid_size) * grid_size; 
  // var my = Math.round(event.movementY / grid_size) * grid_size; 
    
  element.style.left = parseInt(element.style.left) + mx;
  element.style.top  = parseInt(element.style.top)  + my;   
 }
 
 
 
 // PROPAGATE TO HANDLER
 if(presentation["handler"])
 {
  var e = {};
  
  e["event"]   = "move";
  e["element"] = element;
  
  presentation["handler"](e);
 }
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                       P R O F I L E                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Profile_OnLoad(module, data)
{
 var user     = await Core_User();

  
 var picture = UI_Element_Find(module, "profile-picture");	
 User_Picture_Load(picture, user);
 picture.onclick = Profile_Picture_Upload;
 
 var container = UI_Element_Find(module, "profile-settings");
 
 
 var languages = Partner_Data("localization", "languages").split(",");
 var options   = {};
 for(var language of languages) options[language] = UI_Language_String("core/languages", language, {}, language); // DISPLAY EACH LANGUAGE NAME IN ITS NATIVE NAME
 var panel     = Profile_Preferences_Panel("language", options, 
 async function()
 {
  Profile_Preferences_ApplyLanguage();
  
  await Core_Reload();
  Module_Load("profile");
 })
 
 UI_Element_Find(panel, "options").value = User_Settings_Get("preferences", "language") || "en";
 
 container.appendChild(panel); 


 var panel     = Profile_Preferences_Panel("size", false, Profile_Preferences_ApplySize);
 container.appendChild(panel);


 var panel     = Profile_Preferences_Panel("sound");
 container.appendChild(panel); 
 
 
 var panel     = Profile_Preferences_Panel("music");
 container.appendChild(panel);  
 
 var panel     = Profile_Preferences_Panel("color",false, () => 
 {
  var theme =  Safe_Get(application, ["user", "settings", "preferences", "color"], "default");
  document.body.className = theme;
 });
 container.appendChild(panel);
  
 var text      = UI_Language_String("profile/settings", "password change text");
 var action    = UI_Language_String("profile/settings", "password change action");
 var panel     = UI_Element_Create("profile/settings-action", {text, action});
 panel.onclick = Profile_Password_Change;
 container.appendChild(panel); 
 
 
 var text      = UI_Language_String("profile/settings", "account logout text");
 var action    = UI_Language_String("profile/settings", "account logout action");
 var panel     = UI_Element_Create("profile/settings-action", {text, action});
 panel.onclick = Profile_Account_Logout;
 container.appendChild(panel); 
 
 
 // ABOUT ME
 var element      = UI_Element_Find(module, "profile-about");
 Document_Element_SetData(element, "field", "about");
 element.value    = Safe_Get(user, ["about"]) || "";
 element.onchange = Profile_User_Set; 
 
 //DOAN NHAT NAM 02/11/2023 ADD INPUT ELEMENT TO UPDATE NICKNAME
 var aboutContent =  element.parentElement;

 var cardInput = UI_Element_Create("core/card-input",{id:"card-nickanme",caption: UI_Language_String("profile/module","nickname caption") ,text:UI_Language_String("profile/module","change nickname")});
 var input = UI_Element_Find(cardInput, "input-card-nickanme");
 Document_Element_SetData(input, "field", "nickname");
 input.value    = Safe_Get(user, ["nickname"]) || "";
 input.onchange = Profile_User_Set

 if(user.role == "student")
 {
   Document_CSS_SetClass(cardInput, "style-disabled");
   input.onchange = null;
 }
 
 aboutContent.appendChild(cardInput);
 //DOAN NHAT NAM 02/11/2023 ADD INPUT ELEMENT TO UPDATE NICKNAME
 
 // ANIMATE ELEMENTS
 var container = UI_Element_Find(module, "profile-settings");
 for(var element of container.children) element.style.visibility = "hidden";
 
 Document_Element_AnimateChildren(container, "slideInRight 0.250s ease-in-out", 
 {
  delay:    125, 
  interval: 125, 
  onstart:
  function(element) 
  {
   element.style.visibility = "visible";
  }
 });

 
 var container = UI_Element_Find(module, "profile-user");
 for(var element of container.children) element.style.visibility = "hidden";
 
 Document_Element_AnimateChildren(container, "zoomIn 0.250s ease-in-out", 
 {
  delay:    125, 
  interval: 125, 
  onstart:
  function(element) 
  {
   element.style.visibility = "visible";
  }
 });
}



async function Profile_OnShow(module, data)
{
}




async function Profile_OnUnload()
{
}








// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          M O R E                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Profile_Preferences_Panel(preference, options, onchange)
{
 var text      = UI_Language_String("profile/settings", "preferences " + preference + " text");
 var panel     = UI_Element_Create("profile/settings-options", {text});
 
 var select   = UI_Element_Find(panel, "options");
 Document_Element_SetData(select, "preference", preference);
 
 if(options)
 {
  for(var value in options) Document_Select_AddOption(select, options[value], value);
 }
 else
 {
  UI_Select_FromDatapage(select, "profile/settings-" + preference);
  select.value = User_Settings_Get("preferences", preference);
 }
 
 select.onchange = 
 async function(event)
 {
  await Profile_Preferences_Set(event);
  
  if(onchange) onchange();
 }
 
 return panel;
}




async function Profile_Account_Logout()
{
 var title    = UI_Language_String("profile", "logout popup title"); 
 var content  = UI_Language_String("profile", "logout popup text"); 
 var picture  = Resources_URL("images/cover-logout.png");

 var confirm  = await UI_Popup_Confirm(title, content, picture);
 if(!confirm) return;
 
 await Core_Logout();
 
 Module_Load("login", document.body);
}





async function Profile_Picture_Upload()
{
 var files = await Storage_File_Select({accept:".jpg"});
 var file  = files[0];
 
 var data = await Storage_File_Read(file, {whole:true});
 
 var blob = await Document_Image_Resize(data, 
 {
  constraints:
  {
   width:  400, 
   height: 400
  }, 
  
  format:"image/jpg", 
  
  quality:0.5
 });
 
 //var user_id = 1;
 //var dest    = Resources_URL("propic.jpg", "user", user_id); 
 
 // READ DATA ONLY AND STORE
 var data = await Storage_File_Read(blob, {whole:false}); 
 Storage_File_Upload("propic.jpg", data, "image/jpg", "api.php?direct&f=User_Picture_Upload", {});
 
 // READ AS A WHOLE INCLUDING BASE64 HEADER, AND DISPLAY ON BIG PICTURE AND PROPIC IN THE MENU BAR
 var picture = await Storage_File_Read(blob, {whole:true});  
 
 var element = UI_Element_Find("user-propic");
 Document_Element_Animate(element, "rubberBand 0.5s linear 1");
 element.src = picture;
 
 var element = UI_Element_Find("profile-picture");
 Document_Element_Animate(element, "rubberBand 0.5s linear 1");
 element.src = picture;
}






async function Profile_Password_Change(event)
{
 var popup    = false;
 
 var picture  = Resources_URL("images/cover-password.png");
 var title    = UI_Language_String("profile", "password change title");
 var button   = UI_Language_String("profile", "password change button");
 var subtitle = false;
 
 var text        = {};
 text["current"] = UI_Language_String("profile", "password change current");
 text["new"]     = UI_Language_String("profile", "password change new");
 text["repeat"]  = UI_Language_String("profile", "password change repeat");
 var content     = UI_Element_Create("profile/password-change", text); 
 
 var change   =
 async function()
 {  
  var current = UI_Element_Find(content, "current");
  var newpass = UI_Element_Find(content, "new");
  var repeat  = UI_Element_Find(content, "repeat");
  var setpass = newpass.value.trim();
  
  // NEW PASS NOT REPEATED CORRECTLY?
  if(newpass.value != repeat.value)
  {
   repeat.value = UI_Language_String("profile", "password change different");  
   Document_Element_Animate(repeat,  "headShake 0.75s ease-in-out 1");
   
   await Client_Wait(2);
   repeat.value = "";
   
   return;
  }
  
  
  // MINIMUM LENGTH NOT RESPECTED?
  var minlength = 5;
  if(setpass.length < minlength)
  {
   newpass.value = UI_Language_String("profile", "password change tooshort", {n:minlength});  
   Document_Element_Animate(newpass, "headShake 0.75s ease-in-out 1");
   
   await Client_Wait(2);
   newpass.value = setpass;
   
   return;
  }
  

  // TRY CHANGING
  var result = await Core_Api("User_ChangePassword", {old:current.value, new:setpass});
  
  if(result == "ok")
  {
   UI_Popup_Close(popup);
  }
  else
  {  
   current.value = UI_Language_String("profile", "password change wrong", {length:minlength});  
   Document_Element_Animate(current, "headShake 0.75s ease-in-out 1");
   
   await Client_Wait(2);
   current.value = "";
   
   return;
  }
 }
 
 popup = await UI_Popup_Create({title, subtitle, picture, content}, [{text:button, onclick:change}], undefined, {escape:true, open:true});  
}




async function Profile_Preferences_Set(event)
{
 var element = event.currentTarget;
 var field   = Document_Element_GetData(element, "preference");
 var value   = element.value;
 
 await User_Settings_Set("preferences", field, value);
}



async function Profile_User_Set(event)
{
 var element = event.currentTarget;
 var field   = Document_Element_GetData(element, "field");
 var value   = element.value;
  
 await Core_Api("User_Update_Field", {field, value});
}





function Profile_Preferences_ApplySize()
{
 var size = User_Settings_Get("preferences", "size");
 
 var zoom = Core_Data_Value("profile/settings-size", size, "zoom");
 
 document.body.style.zoom = zoom;
}




function Profile_Preferences_ApplyLanguage()
{
 var language = User_Settings_Get("preferences", "language") || "en";
 
 UI_Language_Set(language);
}async function Progress_Core()
{
 var data       = Core_State_Get("progress", "data", []);
 var page       = UI_Element_Create("progress/core");
 var coreskills = data["core-skills"] || [];
 
 // DATASET
 var sets = [];
 
 var i    = 0;
 for(var skill of coreskills)
 {
  // COLLECT VALUES
  var set  = []; 
  for(var item of data["classes"])
  {
   var score = Safe_Get(item, ["assessment", skill]);
   set.push(score); 
  }	
  
  var set = Dataset_Compute_CumulativeAverages(data["classes"], ["assessment", skill], 5);

  // LABELS AND COLORS
  var color           = "color-wheel-" + i % 16;
  var labels          = Array(set.length).fill("");
  var borderColor     = Document_CSS_GetVariable(color);
  var backgroundColor = Color_Hex_ToRGBA(Document_CSS_GetVariable(color), 0.5);
  
  sets.push(
  {
   data: set,
   borderColor,
   backgroundColor,
   fill: true,
   skill
  });
  
  i++;
 }
 

 // CREATE CHART 
 var chart  = UI_Chart_Lines(labels,
 // DATA
 sets,

 // OPTIONS
 {
  responsive    : true,
  interpolation : true,
  min           : 0,
  max           : 5
 },
 
 // Y FORMATTER
 Assessment_Chart_FormatAxis); 
 
 UI_Element_Find(page, "core-skills-chart").appendChild(chart);
 
 
 // HEADER
 var items = {};

 items["all"] =
 {
  text :   UI_Language_String("progress", "coreskills header all"),
  icons:   [],
  skill:   "all",
  chart:   Document_Element_GetObject(chart, "chart"),
  onclick: Progress_Skills_ViewData
 }

 var i = 0;  
 for(var skill of coreskills)
 {
  items[skill]            = {};
  
  items[skill]["text"]    = UI_Language_Object(Safe_Get(data, ["skills", "core skills", skill, "info"], {}));
  items[skill]["icons"]   = [];
  items[skill]["color"]   = Document_CSS_GetVariable("color-wheel-" + i % 16);
  items[skill]["skill"]   = skill;
  items[skill]["chart"]   = Document_Element_GetObject(chart, "chart");
  items[skill]["onclick"] = Progress_Skills_ViewData;
  
  i++;
 }
 
 var header = UI_Header("switch-core-skill", items, {selectfirst:false, css:"color-noted"});
 UI_Element_Find(page, "core-skills-header").appendChild(header);
 
 
 var container       = UI_Element_Find("module-page");
 container.innerHTML = "";
 container.appendChild(page);
}
async function Progress_Extra()
{
 var data        = Core_State_Get("progress", "data", []);
 var curriculum  = Core_State_Get("progress", "curriculum");
 var page        = UI_Element_Create("progress/extra");
 var extraskills = data["extra-skills"] || [];
 
 
 
 var color           = "color-noted";
 var borderColor     = Document_CSS_GetVariable(color);
 var backgroundColor = Color_Hex_ToRGBA(Document_CSS_GetVariable(color), 0.5);
  
 var dataset         = Progress_Dataset_Skillset(data["extraskills-averages"]);
 var chart           = UI_Chart_Radar(dataset["labels"], [{data:dataset["scores"], borderColor, backgroundColor}], {min:0, max:5, responsive:false}, {width:"160px", height:"160px", zIndex:100});
 UI_Element_Find(page, "extra-skills-chart").appendChild(chart);



 // MATCHING PROFILE
 var profiles        = Object_Subset(data["curriculum"], "profile");
 var max             = 0;
 var similar         = "none";
 for(var profile in profiles)
 {
  var similarity = Progress_Compare_Skillset(profiles[profile], data["extraskills-averages"]); 
  
  if(similarity > max)
  {
   max     = similarity;  
   similar = profile;
  }
 }
 
 similarity = max;
 
 
 var color           = "color-alert";
 var borderColor     = Document_CSS_GetVariable(color);
 var backgroundColor = Color_Hex_ToRGBA(Document_CSS_GetVariable(color), 0.5);
  
 var dataset         = Progress_Dataset_Skillset(profiles[similar]);
 var chart           = UI_Chart_Radar(dataset["labels"], [{data:dataset["scores"], borderColor, backgroundColor}], {min:0, max:5, responsive:false}, {width:"160px", height:"160px", zIndex:100});
 UI_Element_Find(page, "profile-match-chart").appendChild(chart);
 
 // DISPLAY PROFILE NAME 
 similar = "profile researcher";
 similarity = Math.floor(100 * similarity);
 UI_Element_Find(page, "profile-match-name").innerHTML = UI_Language_Object(profiles[similar]).toUpperCase() + " (" + similarity + "%)";
 
 
 // DISPLAY PROFILE PICTURE
 UI_Element_Find(page, "profile-match-picture").src     = Resources_URL(similar.replace("profile ", "") + ".jpg", "curriculum", curriculum);
 
 Document_Element_Animate(UI_Element_Find(page, "profile-match-picture"), "flipInY 1.5s"); 
 Document_Element_Animate(UI_Element_Find(page, "profile-match-name"), "slideInRight 1s"); 
 
 
 var container       = UI_Element_Find("module-page");
 container.innerHTML = "";
 container.appendChild(page);
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                       P R O G R E S S                                          //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Progress_OnLoad(module, data)
{
 // DETERMINE SELECTED CURRICULA. WE WILL DEFAULT TO "DEFAULT"

 
 // GET DATA FOR SELECTED CURRICULUM
 var curriculum  = "default";
 var classes     = 30; 
 var data        = await Core_Api("Progress_Curriculum_Data", {curriculum, classes}); 
 
 Core_State_Set("progress", "curriculum", curriculum);
 Core_State_Set("progress", "data",       data);
 
 
 
 // CALCULATE IN-TIME SCORES FOR AVERAGE ASSESSMENT AND SINGLE CORE SKILLS 
 var coreskills      = Object.keys(Safe_Get(data, ["skills", "core skills"], {}));
 data["core-skills"] = coreskills;
 
 for(var item of data["classes"])
 {
  item["overall"]      = Assessment_Report_Grade(item["assessment"] || {});
  item["core skills"]  = Assessment_Report_Grade(item["assessment"] || {}, coreskills);
 }
 
 
 
 // CALCULATE AVERAGES FOR EXTRA SKILLS
 var extraskills      = Object.keys(Safe_Get(data, ["skills", "extra skills"], {}));
 data["extra-skills"] = extraskills; 
 
 data["extraskills-averages"] = {};
 for(var skill of extraskills)
 {
  // COLLECT VALUES AND AVERAGE
  var score = 0;
  var c     = 0;
  for(var item of data["projects"])
  {
   var value = Safe_Get(item, ["assessment", skill]);
   
   if(value)
   {
	score = score + parseInt(value);
    c++;
   }
  }	
  
  if(c == 0) var score = 0; else score = score / c;
  
  data["extraskills-averages"][skill] = score;
 }
 


  
 // HEADER
 var header = UI_Header("progress",
 {
  overall:
  {
   text :   UI_Language_String("progress", "module header overall"),
   icons:   [],
   onclick: Progress_Overall
  },
 
  core:
  {
   text :   UI_Language_String("progress", "module header core"),
   icons:   [],
   onclick: Progress_Core
  },
 
  extra:
  {
   text :   UI_Language_String("progress", "module header extra"),
   icons:   [],
   onclick: Progress_Extra
  },
 
  outcomes:
  {
   text :   UI_Language_String("progress", "module header outcomes"),
   icons:   [],
   onclick: Progress_Outcomes
  },
  
  vocabulary:
  {
   text :   UI_Language_String("progress", "module header vocabulary"),
   icons:   [],
   onclick: Progress_Vocabulary
  }
 },

 {selectfirst:false, css:"color-noted", template:"big"});
 
 Core_State_Set("progress", "header", header);
 UI_Element_Find(module, "module-header").appendChild(header);
}



async function Progress_OnShow(module, data)
{
 var header = Core_State_Get("progress", "header");
 
 UI_Header_Set(header, "overall", true);
}




async function Progress_OnUnload()
{
}




// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          M O R E                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Progress_Compare_Skillset(set_a, set_b)
{
 distances = [];
 
 for(var skill in set_a)
 {
  var d              = Math.abs(set_a[skill] - set_b[skill]);  
  if(isNaN(d)) var d = 5;
  
  distances.push(d);
 }

 var similarity = (5 - Object_Values_Average(distances)) / 5;
 
 return similarity;
}





function Progress_Dataset_Skillset(scores)
{
 var data   = Core_State_Get("progress", "data");
 var skills = Safe_Get(data, ["skills", "extra skills"]);
 
 var set   = {labels:[], scores:[]};
 
 for(var skill in skills)
 {
  var info  = Safe_Get(skills, [skill, "info"], {});  
  var label = UI_Language_Object(info) || skill;
  
  set["scores"].push(parseFloat(scores[skill]));
  set["labels"].push(label);
 }
 
 return set;
}





function Progress_Skills_ViewData(item)
{
 var chart = item["chart"];
 var skill = item["skill"];
 
 for(var set of chart.data.datasets)
 {
  if(skill == "all") 
  {
   set.hidden = false;
  }
  else
  {
   set.hidden = set["skill"] != skill;
  }
 }
 
 // TRIGGER CHART RE-ANIMATION
 chart.reset(); 
 chart.draw(); 
 chart.update();
}
async function Progress_Outcomes()
{
 var page = UI_Element_Create("progress/outcomes");
 
 var outcomes   = await Resources_Index("outcomes-catalog");
 var assessment = await Core_Api("Progress_Data_Outcomes");
 Core_State_Set("progress", ["outcomes", "assessment"], assessment);

 var container       = UI_Element_Find(page, "outcomes-levels");
 //container.innerHTML = "";
 
 var n = 0;
 for(var level of ["pr", "a1", "a2", "b1", "b2"])
 {
  // CALCULATE PERCENTAGE OF ACHIEVED OUTCOMES
  var all = Safe_Get(outcomes, ["index", level], []);
  var i   = 0;
  var length = 0;
  for(var outcomeParentname of all)
  {
    var outcomeParent = Safe_Get(outcomes, ["by parent", outcomeParentname], []);
    for(var outcome of outcomeParent)
    {
      length++;
      if(typeof assessment[outcome] != "undefined") i++
    }
  }
  i = i / length;
  console.log(i,length)
  
  var chartbox = UI_Element_Create("progress/outcomes-chart");
  
  
  var color = "color-wheel-" + n % 16;
  var full  = Document_CSS_GetVariable(color);
  var faint = Color_Hex_ToRGBA(Document_CSS_GetVariable(color), 0.25);
  
  chartdata = [{color:full, label:"", value:i}, {color:faint, label:"", value:1-i}];
  var chart = UI_Chart_Doughnut(chartdata, 0.67, {zIndex:100, tooltip:false}); 
  
  //var box = UI_Element_Create("progress/outcomes-level-chart");
  //box.appendChild(chart);
  Document_Element_SetData(chart, "level",       level);
  Document_Element_SetData(chart, "colorfull",  full);
  Document_Element_SetData(chart, "colorfaint", faint);
  
  Document_CSS_SetClass(chart, "style-clickable");
  chart.onclick = Progress_Outcomes_DisplayLevel;
  
  UI_Element_Find(chartbox, "text").innerHTML        = level.toUpperCase();
  UI_Element_Find(chartbox, "subtext").style.display = "none";
  UI_Element_Find(chartbox, "chart").appendChild(chart);
  
  container.appendChild(chartbox);
  
  n++;
 }
 
 
 var container       = UI_Element_Find("module-page");
 container.innerHTML = "";
 container.appendChild(page);
}



async function Progress_Outcomes_DisplayLevel(event, chart)
{
 var element = event.currentTarget;
 var level   = Document_Element_GetData(element, "level"); 
 var full    = Document_Element_GetData(element, "colorfull"); 
 var faint   = Document_Element_GetData(element, "colorfaint"); 
 
 // GET OUTCOMES AND THEIR NAMES
 var assessment = Core_State_Get("progress", ["outcomes", "assessment"], []);
 var outcomes   = await Resources_Index("outcomes-catalog"); 
 var names      = await Resources_Index("outcomes-" + UI_Language_Current());
 
 
 // FOR EACH SLICE (MACRO OUTCOME) SET IT AS FAINT OR FULL BASED ON ACTUAL COUNT OF MICRO
 var chartdata = [];
 var basecolor = Document_CSS_GetVariable("color-dark");
 for(var id of outcomes["index"][level] || []) 
 {
  // CALCULATE
  var all   = outcomes["by parent"][id];
  var count = 0;
  for(var token of all) if(typeof assessment[token] != "undefined") count++;
  count = count / all.length;  
  
  // CHART SLICE
  var value = 1;
  var label = names[id];
  
  if(Numbers_Between(count, 0.9, 1)) var color = count;
  else
  if(Numbers_Between(count, 0.75, 0.9)) var color = 0.5;
  else
  if(Numbers_Between(count, 0.5, 0.75)) var color = 0.33;
  else
  if(Numbers_Between(count, 0.25, 0.5)) var color = 0.2;
  else
  var color = 0.1;
  	  
  color = Color_Hex_ToRGBA(full, color);
  
  chartdata.push({value, label, color, id, count});
 }

 // SORT CHART DATA BY COUNT
 chartdata.sort(
 function(a, b)
 {
  if(a["count"] < b["count"]) return 1;
  else
  if(a["count"] > b["count"]) return -1;
  else
  return 0;
 });

 
 var chart  = UI_Chart_Sunburst(chartdata, 0.33, Progress_Outcomes_DisplayMacro, 
 {
  zIndex:    100, 
  maxlength: 20,
  font:
  {
  }
 });
 
 Document_CSS_SetClass(chart, "style-clickable");
 
 
 console.log(Document_Element_GetObject(chart, "chart"));

 
 
 var container       = UI_Element_Find("level-macros");
 container.innerHTML = "";
 container.appendChild(chart);
}



async function Progress_Outcomes_DisplayMacro(item, chart)
{ 
 // GET OUTCOMES AND THEIR NAMES
 var assessment = Core_State_Get("progress", ["outcomes", "assessment"], []);
 var outcomes   = await Resources_Index("outcomes-catalog"); 
 var names      = await Resources_Index("outcomes-" + UI_Language_Current());
 
 var items      = Safe_Get(outcomes, ["by parent", item["id"]], []);
 
 UI_Element_Find("level-micros-title").innerHTML = String_Capitalize_Initial(names[item["id"]]);
 
 var container  = UI_Element_Find("level-micros-list");
 container.innerHTML = "";
 for(var id of items)
 {
  var name  = String_Capitalize_Initial(names[id]);
  var score = assessment[id];
    
  var element                   = UI_Element_Create("progress/outcomes-item-micro", {name});
  element.style.backgroundColor = item["color"];
  
  if(typeof score == "undefined")
  {
   Document_Element_Disable(element, "style-disabled");
   var score = 0;
  }
  
  var meter = UI_Element_Find(element, "score");
  for(var i = 1; i<=5; i++)
  {
   if(i <= score) var template = "full"; else var template = "empty";
   var point = UI_Element_Create("progress/star-" + template);
  
   meter.appendChild(point);
  } 
  
  container.appendChild(element);
 }
}async function Progress_Overall()
{
 var data = Core_State_Get("progress", "data", []);
 var page = UI_Element_Create("progress/overall");
 
 // DATASET
 var set = [];
 for(var item of data["classes"])
 {
  set.push(item["overall"]); 
 }	 

 //var set = Dataset_Compute_CumulativeAverages(data["classes"], 5, "overall");

 // LABELS AND COLOR
 var labels          = Array(set.length).fill("");
 var borderColor     = Document_CSS_GetVariable("color-noted");
 var backgroundColor = Color_Hex_ToRGBA(Document_CSS_GetVariable("color-noted"), 0.5);
 
 var chart  = UI_Chart_Lines(labels,
 // DATA
 [
  {data:set, borderColor, backgroundColor, fill:true}, 
 ],

 // OPTIONS
 {
  responsive    : true,
  interpolation : true,
  min           : 0,
  max           : 5
 },
 
 // Y FORMATTER
 Assessment_Chart_FormatAxis,
 
 // X FORMATTER,
 false,
 
 // ONCLICK
 Progress_Overall_DisplayClass
 ); 
 
 UI_Element_Find(page, "classes-chart").appendChild(chart);
 
 
 // SET SOME INTERACTIONS
 UI_Element_Find(page, "class-detail").onclick    = Progress_Overall_HideClass;
 UI_Element_Find(page, "class-thumbnail").onclick = Progress_Overall_ViewClass;
 
 
 var container       = UI_Element_Find("module-page");
 container.innerHTML = "";
 container.appendChild(page);
}





async function Progress_Overall_DisplayClass(point, event)
{
 var data     = Core_State_Get("progress", "data");
 var index    = point.index;
 var item     = Safe_Get(data, ["classes", index], {});
 
 var title    = UI_Language_Object(item["lesson_title"] || {});
 var date     = UI_Language_Date(item["date_start"], "date-time-compact")
 var cover    = Resources_URL("cover.png", "lesson", item["lesson_id"]); 
 var fallback = "";
 
 UI_Element_Find("class-title").innerHTML = title;
 UI_Element_Find("class-date").innerHTML  = date;
 
 Document_Image_Load(UI_Element_Find("class-cover"), [cover, fallback]);
 
 UI_Element_Find("class-detail").style.display = "flex";
 
 Core_State_Set("progress", "seat-id", item["id"]);
}






function Progress_Overall_HideClass(event)
{
 UI_Element_Find("class-detail").style.display = "none";
}






async function Progress_Overall_ViewClass(event)
{
 var seat_id = Core_State_Get("progress", "seat-id");
 
 await Module_Load("course");
 await Course_Class_Display(false, seat_id);
 
 //Course_Class_DisplayAssessment();
}async function Progress_Vocabulary()
{
 var page = UI_Element_Create("progress/vocabulary");
 
 var vocabulary = await Resources_Index("vocabulary-catalog");
 
 var terms      = await Core_Api("Progress_Data_Vocabulary");
 terms          = Object_To_Array(terms);
 Core_State_Set("progress", ["vocabulary", "terms"], terms);

 var container       = UI_Element_Find(page, "vocabulary-levels");
 //container.innerHTML = "";
 
 var n = 0;
 for(var level of ["pr", "a1", "a2", "b1", "b2"])
 {
  // CALCULATE PERCENTAGE OF LEARNED VOCAB
  var all = Safe_Get(vocabulary, ["by level", level], []);
  var i   = 0;
  for(var term of all)
  {
   if(terms.includes(term)) i++
  }
  i = i / all.length;
  
  var chartbox = UI_Element_Create("progress/outcomes-chart");
  
  
  var color = "color-wheel-" + n % 16;
  var full  = Document_CSS_GetVariable(color);
  var faint = Color_Hex_ToRGBA(Document_CSS_GetVariable(color), 0.25);
  
  chartdata = [{color:full, label:"", value:i}, {color:faint, label:"", value:1-i}];
  var chart = UI_Chart_Doughnut(chartdata, 0.67, {zIndex:100, tooltip:false}); 
  
  Document_Element_SetData(chart, "level",       level);
  Document_Element_SetData(chart, "colorfull",  full);
  Document_Element_SetData(chart, "colorfaint", faint);
  
  Document_CSS_SetClass(chart, "style-clickable");
  chart.onclick = Progress_Vocabulary_DisplayLevel;
  
  UI_Element_Find(chartbox, "text").innerHTML        = level.toUpperCase();
  UI_Element_Find(chartbox, "subtext").style.display = "none";
  UI_Element_Find(chartbox, "chart").appendChild(chart);
  
  container.appendChild(chartbox);
  
  n++;
 }
 
 var container       = UI_Element_Find("module-page");
 container.innerHTML = "";
 container.appendChild(page);
}





async function Progress_Vocabulary_DisplayLevel(event, chart)
{
 var element = event.currentTarget;
 var level   = Document_Element_GetData(element, "level"); 
 var full    = Document_Element_GetData(element, "colorfull"); 
 var faint   = Document_Element_GetData(element, "colorfaint"); 
 
 // GET OUTCOMES AND THEIR NAMES
 var terms      = Core_State_Get("progress", ["vocabulary", "terms"], []);
 var vocabulary = await Resources_Index("vocabulary-catalog");  
 
 var container       = UI_Element_Find("vocabulary-terms-list");
 container.innerHTML = "";
 
 // FOR EACH SLICE (MACRO OUTCOME) SET IT AS FAINT OR FULL BASED ON ACTUAL COUNT OF MICRO
 var chartdata = [];
 var basecolor = Document_CSS_GetVariable("color-dark");
 for(var term of vocabulary["by level"][level] || []) 
 {
  var element = UI_Element_Create("progress/vocabulary-term", {term:Vocabulary_Term_Purge(term)});
  
  if(terms.includes(term))
  {
   element.style.backgroundColor = full;
   Document_CSS_SetClass(element, "style-clickable");
   Document_Element_SetData(element, "term_id", term);
   
   element.onclick = 
   async function(event)
   {
	var element = event.currentTarget;
	var term_id = Document_Element_GetData(element, "term_id");
	
	var display = await Vocabulary_Term_Display(term_id, "big");
	
	var container = UI_Element_Find("vocabulary-term-detail");
	container.innerHTML = "";
	container.appendChild(display);
	
	
 	Document_Element_FitContent(container);
   }
  }
  else 
  {
   element.style.backgroundColor = faint;
   Document_Element_Disable(element, "style-disabled");
  }

  container.appendChild(element);    
 }
 
 UI_Element_Find("vocabulary-terms").style.display = "flex";
 
 // ANIMATE WORDS
 if(false)
 Document_Element_AnimateChildren(container, "fadeInUp 1s 1", 
 {
  appear: true,
  delay:   50, 
  interval: 50, 
  onstart:
  function(element) 
  {
  }
 });
}



async function Progress_Vocabulary_DisplayMacro(item, chart)
{ 
 // GET OUTCOMES AND THEIR NAMES
 var assessment = Core_State_Get("progress", ["outcomes", "assessment"], []);
 var outcomes   = await Resources_Index("outcomes-catalog"); 
 var names      = await Resources_Index("outcomes-" + UI_Language_Current());
 
 var items      = Safe_Get(outcomes, ["by parent", item["id"]], []);
 
 UI_Element_Find("level-micros-title").innerHTML = String_Capitalize_Initial(names[item["id"]]);
 
 var container  = UI_Element_Find("level-micros-list");
 container.innerHTML = "";
 for(var id of items)
 {
  var name  = String_Capitalize_Initial(names[id]);
  var score = assessment[id];
    
  var element                   = UI_Element_Create("progress/outcomes-item-micro", {name});
  element.style.backgroundColor = item["color"];
  
  if(typeof score == "undefined")
  {
   Document_Element_Disable(element, "style-disabled");
   var score = 0;
  }
  
  var meter = UI_Element_Find(element, "score");
  for(var i = 1; i<=5; i++)
  {
   if(i <= score) var template = "full"; else var template = "empty";
   var point = UI_Element_Create("progress/star-" + template);
  
   meter.appendChild(point);
  } 
  
  container.appendChild(element);
 }
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                P R O J E C T S  /  L I S T                                     //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Projects_List_Display(teacher_id, managed = false)
{
 // IF SPECIFIC TEACHER AND TEACHER NOT CURRENT USER, LOAD IT
 if(teacher_id && teacher_id != User_Id()) 
 { 
  var user = await Core_Api("User_Read", {user_id:teacher_id, options:{fields:"id,firstname,lastname"}});
 }
 else
 {
  var user = Core_User();
 }
 
 
 // CREATE DISPLAY
 var display = UI_Element_Create("projects/list-display");
 Core_State_Set("projects", "list-display", display);
 
 
 // IF LIST OF MANAGED TEACHERS, SHOW SELECTOR
 if(managed)
 {  
  // IF IT'S NOT A LIST BUT JUST A "TRUE" FLAG, BUILD THE LIST BY CALLING API
  if(typeof managed != "object")
  {
   var managed = await Core_Api("Users_List_ByManager", {manager_id:user["id"], fields:"id,firstname,lastname"});
  }

  var selector = UI_Element_Find(display, "selector");
  var select   = UI_Element_Find(selector, "teachers");
  
  // ADD MAIN USER TO THE LIST
  var name = [user["firstname"] || "", user["lastname"] || ""].join(" ").trim();
  Document_Select_AddOption(select, name, user["id"]);
  
  for(var teacher of managed)
  {
   var name = [teacher["firstname"] || "", teacher["lastname"] || ""].join(" ").trim();
   Document_Select_AddOption(select, name, teacher["id"]);
  }
  
  select.value = user["id"];
  
  select.onchange = 
  function()
  {
   Projects_List_Teacher(select.value);
  }
  
  selector.style.display = "flex";
 }
 
 await Projects_List_Teacher(user["id"]);


 return display;
}




async function Projects_List_Teacher(teacher_id)
{
 var display = Core_State_Get("projects", "list-display");
  
 // HIDE DETAIL VIEW
 UI_Element_Find(display, "groups").style.visibility = "hidden";
 UI_Element_Find(display, "view").style.visibility   = "hidden";


 // GET CLASS ASSESSMENT DATA
 var period     = parseInt(User_Config("admin-days", -30)); period = -3000;
 var date_from  = Date_Portion(Date_Add_Days(Date_Now(), period), "no-seconds");
 var date_to    = Date_Portion(Date_Now(), "no-seconds");
 var data       = await Core_Api("Projects_List_ByTeacher", {teacher_id, date_from, date_to, options:{}});


 // PROCESS DATA
 
 // SECTION
 for(var item of data) item["period"] = Date_Format_Period(Date_Now(), item["date_start"], {locale:UI_Language_Current(true), conversational:true});
 
 // SORT BY DATE AND CLASS ID
 data.sort(
 function(a, b)
 {
  if(a["date_start"] < b["date_start"]) return 1;
  else
  if(a["date_start"] > b["date_start"]) return -1;
  else
  {
   return 0;
  }
 });
 
 
 // ASSEMBLE DISPLAY
 var list = UI_List_Items(data, ["style-outlined-accented", "outline-inner"], Projects_List_Project, {style:"vertical", overflow:true, sections:"period"},
 
 // ITEMS
 function(item)
 {  
  var locale      = UI_Language_Current(true);
  var info        = {};
  
  info["date"]    = Date_Format(item["date_start"], locale, "date-shortmonth-weekday-noyear") + ", " + Date_Format(item["date_start"], locale, "time-only");
  info["project"] = item["project_id"];
  
  var element = UI_Element_Create("projects/list-item", info);  
  Document_Element_SetObject(element, "item", item);
  
  return element; 
 },
 
 // SECTIONS
 function(section, item)
 {
  var element = UI_Element_Create("projects/list-section", {period:section.toUpperCase()});  
  return element;
 });
 


 // DISPLAY LIST 
 var container       = UI_Element_Find(display, "list");
 container.innerHTML = "";
 container.appendChild(list);
}




async function Projects_List_Project(element)
{
 var item    = Document_Element_GetObject(element, "item");
 var display = Core_State_Get("projects", "list-display");

 var info    = await Core_Api("Project_Read", {id:item["project_id"], files:true});
 Core_State_Set("projects", "view", info);
  
 var container       = UI_Element_Find(display, "groups");
 container.innerHTML = "";
  
 var groups = await Core_Api("Project_List_Students", {project_id:item["id"]});
 for(var n in groups)
 {
  var students = groups[n] || [];
  var element  = Project_Group_Display(n, students, 
  {
   assess: Projects_List_Assess, 
   file:   Projects_List_OpenFile
  });
  
  container.appendChild(element);
 }
 

 container.style.visibility = "visible";
}




async function Projects_List_Assess(event)
{
 var display = Core_State_Get("projects", "list-display");

 var element = event.currentTarget;
 var student = Document_Element_GetObject(element, "student");
 var info    = Core_State_Get("projects", "view"); console.log(info);
  
 var skills  = info["skills"] || {};
 var list    = Object.values(skills);
 var aims    = await Core_Api("Outcomes_Read", {list, folder:"skills"});
 
 var element = UI_Element_Create("projects/project-assessment-teacher");
 // CHANGE FIRSTNAME TO NICKNAME IF HAS NICKNAME
 var name = student["firstname"];
 if(Boolean(student["nickname"]))
 {
   name = student["nickname"];
 } 
 var section = Assessment_Section(name, aims, student["assessment"], 
 async function(event)
 {
  var element = event.currentTarget;
  var skill   = Document_Element_GetData(element, "uid");
  
  if(!student["assessment"]) student["assessment"] = [];
  
  Safe_Set(student, ["assessment", skill], element.value); 
  var value = isNaN(parseInt(element.value)) ? element.value : parseInt(element.value);
  await Core_Api("Assessment_Outcome_Store", {table:"projects_students", id:student["id"], field:skill, value:value}); 
 });
 
 element.appendChild(section);
 
 var container       = UI_Element_Find(display, "view");
 container.innerHTML = "";
 container.appendChild(element);
 
 container.style.visibility = "visible";
}




async function Projects_List_OpenFile(event)
{
 var display = Core_State_Get("projects", "list-display");
 
 var element = event.currentTarget;
 var url     = Document_Element_GetData(element, "url");
 
 var element = UI_Element_Create("projects/project-display");
 element.src = url;
  
 var container       = UI_Element_Find(display, "view");
 container.innerHTML = "";
 container.appendChild(element);
 
 container.style.visibility = "visible";
 //window.open(url);
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                       P R O J E C T S                                          //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Projects_OnLoad(module, data)
{
 Core_State_Set("projects", "data", data);
 
 var role = User_Role();
 var page = UI_Element_Create("projects/page-" + role);
 
 // ADD INFO TO PROJECTS (USED FOR SECTIONS)
 for(var project of data)
 {
  project["period"] = Date_Format_Period(Date_Now(), project["date_due"], {locale:UI_Language_Current(true), conversational:true});
 }
 
 var onclick = Safe_Function("Projects_" + String_Capitalize_Initial(role) + "_DisplayProject", function(){});
 
 // ASSEMBLE DISPLAY
 var list = UI_List_Items(data, ["style-outlined-accented"], onclick, {style:"vertical", overflow:true, sections:"period", animate:true/*, selected:upcoming, highlight:"style-outlined-alert"*/},
 // ITEMS
 function(project)
 {  
  var element = UI_Element_Create("projects/project-thumbnail");
  Document_Element_SetObject(element, "project", project);
  
  // TITLE
  var data    = Safe_Get(project, ["data", "title"], {});
  var title   = UI_Language_Object(data);
  UI_Element_Find(element, "title").innerHTML = title;
  
  // DATE
  var data = Safe_Get(project, ["date_due"], Date_Now());
  var date = UI_Language_Date(data, 
  {
   weekday: "long", 
   day:     "numeric", 
   month:   "long"  
  });
  UI_Element_Find(element, "date").innerHTML = UI_Language_String("projects/projects", "date due", {date});
  
  
  // COVER
  var image   = UI_Element_Find(element, "picture");
  var cover   = Resources_URL("projects/" + project["project_id"] + "/cover.png", "content");
  var def     = Resources_URL("images/cover-project.png");
  Document_Image_Load(image, [cover, def]);
  
  
  // ASSESSMENT PRESENT?
  if(project["assessment"])
  {
   var icon = UI_Element_Find(element, "assessment");
   icon.style.display = "flex";
  }
  

  // DUE SOON?
  var due  = project["date_due"] || Date_Now();
  var days = Date_Distance(Date_Now(), due, "days");
  
  if(days <= 2)
  {
   var icon = UI_Element_Find(element, "due");
   icon.style.display = "flex";
   Document_Element_Animate(icon, "flash 1.5s 1.5");
  }
  
  return element;
 },
 
 // SECTIONS
 function(section, item)
 {
  var period = UI_Language_String("projects/projects", "date due", {date:section}).toUpperCase();
  
  var element = UI_Element_Create("projects/list-section", {period});  
  return element;
 });
 
 
 
 // LIST PROJECTS
 var container       = UI_Element_Find(page, "projects-list");
 container.innerHTML = "";
 container.appendChild(list);
 
 UI_Element_Find(module, "module-page").appendChild(page);
}



async function Projects_OnShow(module, data)
{
}




async function Projects_OnUnload()
{
}








// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          M O R E                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Projects_Group_OpenFile(event)
{
 var element = event.currentTarget;
 var url     = Document_Element_GetData(element, "url");
 
 var display = UI_Element_Create("projects/project-display");
 display.src = url;
  
 var container       = UI_Element_Find("project-display");
 container.innerHTML = "";
 container.appendChild(display);
 
 
 //window.open(url);
}



async function Projects_Student_DisplayProject(element)
{
 var project  = Document_Element_GetObject(element, "project");
 Core_State_Set("projects", "current", project);
 
 var files = {};
 
 
 // MAIN PROJECT FILE
 files["project"] =
 {
  text   : UI_Language_String("projects/files", "file project"),
  onclick: Projects_Student_DisplayProjectfile
 }
 
 
 // OTHER FILES
 var info     = await Core_Api("Project_Read", {id:project["project_id"], files:true});
 var items    = [];
 var filter   = Core_Data_Value("projects/files", "files", "student").split(",");
 for(var file of info["files"])
 {  
  var name = String_Simplify(Path_RemoveExtension(Path_Filename(file)))
  if(filter.includes(name))
  {
   files[name] =
   {
	text:   UI_Language_String("projects/files", "file " + name),
	file,
	onclick: Projects_Student_DisplayFile 
   }
  }
 }
 
 // ASSESSMENT
 var disabled = !project["assessment"];

 files["assessment"] =
 {
  text: UI_Language_String("projects/files", "file assessment"),
  onclick:Projects_Student_DisplayAssessment,
  disabled
 }
 
 
 
 
 var header = UI_Header("header-files", files, {selectfirst:false, css:"color-noted"});
  
 
 // DISPLAY
 var container       = UI_Element_Find("project-files");
 container.innerHTML = "";
 container.appendChild(header);
 
 var container       = UI_Element_Find("project-display");
 container.innerHTML = "";
 
 var panel = UI_Element_Find("project-panel");
 panel.style.visibility = "visible";
}





async function Projects_Student_DisplayFile(item)
{
 var display = UI_Element_Create("projects/project-display");
 display.src = item["file"];
 
 var container       = UI_Element_Find("project-display");
 container.innerHTML = "";
 container.appendChild(display);
}




async function Projects_Student_DisplayProjectfile(element)
{
 var project = Core_State_Get("projects", "current");
 url         = project["url"];
  
 var display = UI_Element_Create("projects/project-display");
 display.src = url;
 
 var container       = UI_Element_Find("project-display");
 container.innerHTML = "";
 container.appendChild(display);
}




async function Projects_Student_DisplayAssessment(element)
{
 var project    = Core_State_Get("projects", "current");
 var skills     = Safe_Get(project, ["data", "skills"], {});
 var list       = Object.values(skills);
 var aims       = await Core_Api("Outcomes_Read", {list, folder:"skills"});

 var text       = Assessment_Category_Transcribe(aims, project["assessment"]);
 
 
 
 var display = UI_Element_Create("projects/project-assessment-student");
  
 var row     = Assessment_Display_Feedback(project["assigner_id"], text);
 display.appendChild(row);
 
 var row     = Assessment_Display_Assessment("extra skills", aims, project["assessment"]);
 display.appendChild(row);
 
 
 var container       = UI_Element_Find("project-display");
 container.innerHTML = "";
 container.appendChild(display);
}



async function Projects_Teacher_DisplayProject(event)
{
 var display  = Core_State_Get("projects", "list-display");
 
 var element  = event.currentTarget;
 var project  = Document_Element_GetObject(element, "project");
 Core_State_Set("projects", "current", project);
 
 var groups = await Core_Api("Project_List_Students", {project_id:project["id"]});
 console.log(groups);
 
 var container       = UI_Element_Find(display, "project-groups");
 container.innerHTML = "";
 
 for(var n in groups)
 {
  var students = groups[n] || [];
  
  var item     = Project_Group_Display(n, students, {assess:Projects_Teacher_Assess, file:Projects_Group_OpenFile});
 
  container.appendChild(item);
 }
}



async function Projects_Teacher_Assess(event)
{
 var element = event.currentTarget;
 var student = Document_Element_GetObject(element, "student");
 var project = Core_State_Get("projects", "current", project);
  
 var skills  = Safe_Get(project, ["data", "skills"], {});
 var list    = Object.values(skills);
 var aims    = await Core_Api("Outcomes_Read", {list, folder:"skills"});
 
 var display = UI_Element_Create("projects/project-assessment-teacher");
 var section = Assessment_Section(student["firstname"], aims, student["assessment"], 
 async function(event)
 {
  var element = event.currentTarget;
  var skill   = Document_Element_GetData(element, "uid");
  
  if(!student["assessment"]) student["assessment"] = [];
  
  Safe_Set(student, ["assessment", skill], element.value); 
  var value = isNaN(parseInt(element.value)) ? element.value : parseInt(element.value);
  await Core_Api("Assessment_Outcome_Store", {table:"projects_students", id:student["id"], field:skill, value:value}); 
 });
 
 display.appendChild(section);
 
 var container       = UI_Element_Find("project-display");
 container.innerHTML = "";
 container.appendChild(display);
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                       P R O J E C T                                          //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Project_Read(id)
{
 var project = await Core_Api("Project_Read", {id});
 
 return project;
}



async function Project_Assign(student_id, class_id, project_group = 0, project_id)
{
 // CREATE STUDENT'S DATABASE RECORD
 var id   = await Core_Api("Project_Assign", {student_id, class_id, project_group, project_id});
 
 // CREATE (OR RETRIEVE) GROUP'S GOOGLE DRIVE LINK
 var url  = await Project_GetFile(class_id, project_id)
 
 return {id, url};
}





async function Project_GetFile(class_id = 0, project_id = 0)
{
 var name = class_id + "-" + project_group;
 var url  = await Request_Post(document.location.origin + "/services/google/file_create.php", {type : "slides", name}, "json");

  // WRITE LOG
  await Core_Api("Users_Write_Log",{
    event: "file_create",
    data: {
        api_name : "file_create",
        request : {type : "slides", name},
        response : url
    },
    user_id: User_Id()
 });
 
 return url;
}




function Project_Group_Display(n, students, options = {})
{ 
 var element = UI_Element_Create("projects/project-group", {n}, {language:"classroom/projects"});
 Document_Element_SetData(element, "group", n);
 
 // FIND GROUP PROJECT FILE URL
 if(options["file"])
 {
  var url = Projects_Group_GetFile(students);
  if(url)
  {
   var icon           = UI_Element_Find(element, "file");
   Document_Element_SetData(icon, "url", url);
   
   icon.style.display = "flex";
   icon.onclick       = options["file"];
  }
 }
 
 
 // DISPLAY STUDENTS
 if(students)
 { 
  for(var student of students)
  {
   var item = UI_Element_Create("projects/project-student", {name:student["firstname"]});
   
   // CHANGE FIRSTNAME TO NICKNAME IF HAS NICKNAME
   if(Boolean(student["nickname"]))
   {
     var name = UI_Element_Find(item,"student-name");
     name.innerHTML = student["nickname"];
   } 

   var img  = UI_Element_Find(item, "image");
   User_Picture_Load(img, student["student_id"], "student");
	
   for(var action of ["remove", "assess"])
   {
    if(options[action]) 
	{
     var icon     = UI_Element_Find(item, action);
     var onclick  = options[action];		
     icon.onclick = onclick; 
	 
	 icon.style.display = "flex";
	 
	 Document_Element_SetObject(icon, "student", student);
	}
   }
   
   Document_Element_SetData(item, "project_id", student["project_id"]);
   Document_Element_SetData(item, "student_id", student["student_id"]);
   
   element.appendChild(item);
  }
 }
 
 return element;
}





function Projects_Group_GetFile(students)
{
 for(var student of students)
 {
  if(student["url"]) return(student["url"]);
 }
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                       Q U E R I E S                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Queries_OnLoad(module, data)
{
}



async function Queries_OnShow(module, data)
{
}




async function Queries_OnUnload()
{
}





// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          M O R E                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                     R E S O U R C E S                                          //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Resources_Get(type, mode)
{
 switch(mode)
 {
  case "list":
	return Core_State_Get("resources", [type, "list"]); 
  break;
  
  case "catalog":
	return Core_State_Get("resources", [type, "catalog"]); 
  break;
  
  default:
	return Core_State_Get("resources", [type]); 
  break;
 }
}



async function Resources_Update(type, force, catalog_function)
{
 var list = Resources_Get(type, "list");
 
 if(!list || force)
 {
  var list = await Core_Api("Resources_" + String_Capitalize_Initial(type), {});
  Core_State_Set("resources", [type, "list"], list);
  
  if(catalog_function)
  {
   var catalog = catalog_function(list);
   Core_State_Set("resources", [type, "catalog"], catalog);
  }
 }
 
 return list;
}




function Resources_URL(path, type = "application", id)
{
 switch(type)
 {
  case "application":
	var resource = "resources/" + path;
  break;
  
  case "partner":
	var resource = "partners/" + Partner_Name() + "/" + path;
  break;
  
  case "user":
    var userfolder = User_Folder(id);
	var resource   = "partners/" + Partner_Name() + "/users/" + userfolder + "/" + path;
  break;
  
  case "content":
	var resource = "content/" + path;
  break;
  
  case "lesson":
	var resource = "content/lessons/" + id + "/" + path;
  break;
  
  case "curriculum":
	var resource = "content/curricula/" + id + "/" + path; 
  break;
  
  default:
	var resource = path;
  break;
 }
 
 return resource;
}




async function Resources_Lessons(update, mode)
{
 var list = await Resources_Update("lessons", update,
 function(list)
 {
  var catalog = {};
	 
  for(var item of list)
  {
   var parts = String_Split(item, ["_", "-", ".", " "]);
   
   // PAD MISSING PARTS
   for(var i = parts.length; i<3; i++)
   {
	Array_Element_Insert(parts, 0, "");
   }
   
   // STRUCTURE CATALOG
   Safe_Set(catalog, parts, {id:item});
  }
  
  return catalog;
 });
 
 return Resources_Get("lessons", mode);
}





async function Resources_Vocabulary(update, mode)
{
 var list = await Resources_Update("vocabulary", update,
 function(list)
 {
  var catalog = {};
  
  for(var item of list)
  {
   var parts = String_Split(item, ["_", "-", ".", " "]);
   
   // PAD MISSING PARTS
   for(var i = parts.length; i<2; i++)
   {
	Array_Element_Insert(parts, 0, "");
   }
   
   // STRUCTURE CATALOG
   Safe_Set(catalog, parts, {id:item});
  }
  
  return catalog;
 });
 
 return Resources_Get("vocabulary", mode);
}





async function Resources_Outcomes(update, mode)
{
 var list = await Resources_Update("outcomes", update,
 function(list)
 {
  var catalog = {};
  
  for(var item of list)
  {
   var parts = String_Split(item, ["_", "-", ".", " "]);
   
   // PAD MISSING PARTS
   for(var i = parts.length; i<3; i++)
   {
	Array_Element_Insert(parts, 0, "");
   }
   
   // STRUCTURE CATALOG
   Safe_Set(catalog, parts, {id:item});
  }

  return catalog;
 });
 
 return Resources_Get("outcomes", mode);
}




async function Resources_Skills(update)
{
 var list = await Resources_Update("skills", update);
 
 return Resources_Get("skills", "list");
}



async function Resources_Projects(update, mode)
{
 var list = await Resources_Update("projects", update,
 function(list)
 {
  var catalog = {};
  
  for(var item of list)
  {
   var parts = String_Split(item, ["_", "-", ".", " "]);
   
   // PAD MISSING PARTS
   for(var i = parts.length; i<3; i++)
   {
	Array_Element_Insert(parts, 0, "");
   }
   
   // STRUCTURE CATALOG
   Safe_Set(catalog, parts, {id:item});
  }

  return catalog;
 });
 
 return Resources_Get("projects", mode);
}




async function Resources_Index(index, update)
{
 if(!update)
 {
  var resource = Core_State_Get("resources", ["index", index], false);
  if(resource) return resource;
 }	 
 
 var resource = await Core_Api("Resources_Index", {index});
 Core_State_Set("resources", ["index", index], resource);
 
 return resource;
}
// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                        P R O J E C T                                           //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Classroom_Manage_DisplayReminder()
{
 var reviewElement = UI_Element_Find("review");
 Document_Element_Animate(reviewElement, "flash 1.5s 4");
 var class_id       = Core_State_Get("classroom", ["class", "info", "id"]);
  
 // IF A REMINDER HASN'T BEEN ALLOCATED YET, DO IT 
 var courseObj     = Core_State_Get("course",["current-course"]);
 
 var user = Safe_Get(application, ["user"], {});
 if([Core_State_Get("classroom", ["class", "info", "teacher_id"]),Core_State_Get("classroom", ["class", "info", "assistant_id"]),Core_State_Get("classroom", ["class", "info", "ta1_id"]),Core_State_Get("classroom", ["class", "info", "ta2_id"]),Core_State_Get("classroom", ["class", "info", "ta3_id"])].includes(user.id)){
    var userid = user.id;
    reminder_id       = await Core_Api("Reminder_Create", {course:courseObj, teacher_id:userid});
    window.open("https://docs.google.com/document/d/"+reminder_id, "_blank");
 }
 else{
    var reminder_id = Core_State_Get("course",["current-course", "reminder_id"]);
    var teacher_id = Core_State_Get("classroom", ["class", "info", "teacher_id"]);
    if(!reminder_id)
    {
      reminder_id       = await Core_Api("Reminder_Create", {course:courseObj, teacher_id});
      Core_State_Set("course",["current-course","reminder_id"], reminder_id);
    }

    var page = UI_Element_Create("classroom/document-container");
    page.src = "https://docs.google.com/document/d/" + reminder_id + "/?usp=sharing&embedded=true&rm=demo";
    var container       = UI_Element_Find("presentation-panel-right");
    container.innerHTML = "";
    container.appendChild(page);
 }
}

async function Course_Class_DisplayReminderFile(content, state)
{
    var course_id = Core_State_Get("course", ["class-data", "class", "course_id"]);
    var courseObj = await Core_Api("Courses_Read",{id:course_id,fields:"reminder_id"});
    var reminder_id = courseObj.reminder_id;

    var page = UI_Element_Create("course/review-file-container");
    page.src = "https://docs.google.com/document/d/" + reminder_id + "/?usp=sharing&embedded=true&rm=demo";

    content.innerHTML = "";
    content.appendChild(page);
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                         A Z U R E                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Services_Azure_ListVoices()
{
 var voices = Core_State_Get("services", ["azure", "tts", "voices"]);
 if(!voices)
 {
  var voices = await Core_Service("azure-listvoices", {type:"neural"});
  Core_State_Set("services", ["azure", "tts", "voices"], voices);
 }
 
 return voices;
}



async function Services_Azure_LocaleVoices(locale)
{
 var voices = await Services_Azure_ListVoices();
 
 var list = {};
 for(var voice of voices)
 { 
  if(voice["Locale"].toLowerCase().startsWith(locale))
  {
   var dialect = voice["LocaleName"];
   if(!list[dialect]) list[dialect] = [];
 
   list[dialect].push(voice);
  }
 }
 
 return list;
}



async function Services_Azure_Speak(text, voice, options = {})
{
 // IF VOICE OBJECT PASSED RATHER THAN NAME, EXTRACT NAME FROM IT
 if(typeof voice == "object") var voice = voice["ShortName"] || "";
 
 // ASSEMBLE DATA
 var data = {text, voice};
 Object.assign(data, options);

 // CALL SERVICE
 var audio = await Core_Service("azure-speak", data, {type:"blob"});
 
 // RETURN BLOB
 return audio;
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                     S E T T I N G S                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Settings_OnLoad(module, data)
{
}



async function Settings_OnShow(module, data)
{
}




async function Settings_OnUnload()
{
}





// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          M O R E                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                S U B S C R I P T I O N                                         //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Subscription_OnLoad(module, data)
{
}



async function Subscription_OnShow(module, data)
{
}




async function Subscription_OnUnload()
{
}





// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          M O R E                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                           T E A C H                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Teach_OnLoad(module, data)
{
 var thismonth = parseInt(Date_Get(Date_Now(), "month"));
 var select    = UI_Element_Find(module, "header-month");
 for(var month = 1; month <= 12; month++)
 {
  var name   = Date_Month_Name(month).toUpperCase();
  var option = Document_Select_AddOption(select, name, month);
 }
 select.value    = thismonth;
 select.onchange = Teach_Month_Select;
 
 var thisyear = parseInt(Date_Get(Date_Now(), "year"));
 var select   = UI_Element_Find(module, "header-year");
 for(var year = thisyear - 5; year <= thisyear + 1; year++)
 {
  var option = Document_Select_AddOption(select, year, year);
 }
 select.value    = thisyear;
 select.onchange = Teach_Month_Select;
}




async function Teach_OnUnload()
{
}





async function Teach_OnShow(module, data)
{
 Teach_Month_Select();
}









async function Teach_Month_Select()
{
 // GET MONTH
 var year      = UI_Element_Find("header-year").value;
 var month     = UI_Element_Find("header-month").value;
 var container = UI_Element_Find("classes-calendar");
 
 date_from     = Date_Portion(year + month.toString().padStart(2, "0") + "01000000", "no-seconds");
 date_to       = Date_Portion(Date_Add_Months(date_from, 1), "no-seconds");


 // GET CLASSES AND ORGANIZE THEM BY DAY
 var classes = await Core_Api("Classes_List_ByTeacher", {date_from, date_to});
 for(var item of classes) item["day"] = Date_Portion(item["date_start"], "date-only");
 classes = Array_Catalog_ByField(classes, "day");
  
 Teach_Calendar_Month(container, month, year, classes);
}




async function Teach_Calendar_Month(container, month, year, classes = [])
{
 var classes = Core_State_Get("teach", "classes", classes);
 var today   = Date_Portion(Date_Now(), "date-only");
 var locale  = UI_Language_Current(true);
 
 
 // CLEAR ASSESSMENT PANEL
 UI_Element_Find("student-assessment").innerHTML = "";
  
 // CLEAR CLASS PREVIEW 
 UI_Element_Find("class-preview").style.visibility = "hidden";
 UI_Element_Find("class-preview").innerHTML = "";
 
 
 // CLEAR CLASSES LIST
 UI_Element_Find("classes-list").style.visibility = "hidden";
 UI_Element_Find("classes-list").innerHTML = "";
 
 
 // CREATE CALENDAR 
 var table = UI_Table("cursive");
 
 
 // HEADER
 var row = UI_Table_Row(table); 
 for(var i = 1; i <= 7; i++)
 {
  var cell       = UI_Table_Cell(row, {type:"header"});  
  cell.innerHTML = Date_Weekday_Name(i, "short", locale); 
 }
 
 
 
 var days   = Date_Month_ListDays(month, year);
 
 // FIRST ROW: SEE HOW MANY CELLS WE NEED TO SKIP TO GET TO THE FIRST DAY OF THE MONTH
 var row = UI_Table_Row(table); 
 
 var first = Date_Weekday_Get(days[0]);
 for(var weekday = 1; weekday < first; weekday++)
 {
  var cell              = UI_Table_Cell(row);
  cell.style.visibility = "hidden";
  
  row.appendChild(cell);
 }	 


 // NOW WE PROCEED: KEEP ADDING DAYS
 var d = 0;
 while(d < days.length)
 {	 
  var weekday = Date_Weekday_Get(days[d]);
  
  var cell       = UI_Table_Cell(row); 
  cell.innerHTML = Date_Get(days[d], "day"); 
  
  var day = Date_Portion(days[d], "date-only");
  if(classes[day])
  {
   cell.onclick               = Teach_Calendar_Day;
   cell.style.backgroundColor = "var(--color-noted)";
   Document_CSS_SetClass(cell, "style-clickable");
 
   Document_Element_SetObject(cell, "classes", classes[day]);
  }
  else
  {
  }
  
  if(day == today) 
  {
   cell.style.backgroundColor = "var(--color-alert-light)";
   Document_Element_Animate(cell, "flash 1.5s ease-in-out 1.5");
  }
  
  if(weekday == 7)
  {
   var row = false;
   
   // START NEW ROW UNLESS THIS WAS ALSO THE FINAL DAY
   if(d != (days.length -1))
   {
    var row = UI_Table_Row(table);
   }
  }
  
  d++;
 }
 
 container.innerHTML = "";
 container.appendChild(table);
 
 Core_State_Set("teach", ["calendar", "table"], table);
}




async function Teach_Calendar_Day(event)
{
 var element = event.currentTarget;
 var classes = Document_Element_GetObject(element, "classes");
 
 var table   = Core_State_Get("teach", ["calendar", "table"]);
 var cells   = Document_Element_GetObject(table, "cells");
 
 // HIGHLIGHT SELECTED DAY 
 Document_Conditional_Class(cells, "style-outlined-accented", element);


 // CLEAR CLASS PREVIEW 
 UI_Element_Find("class-preview").style.visibility = "hidden";
 UI_Element_Find("class-preview").innerHTML = "";
 
 
 // DISPLAY CLASSES FOR THE DAY
 var container       = UI_Element_Find("classes-list");
 container.innerHTML = "";
 
 var now     = Date_Portion(Date_Now(), "no-seconds");
 var current = false;
 
 for(var item of classes)
 { 
  var time    = Date_Format(item["date_start"], "en-US", "time-only") + " - " + Date_Format(item["date_end"], "en-US", "time-only")
  var center  = item["center_id"];
  var code    = item["lesson_id"];
  var element = UI_Element_Create("teach/class-item", {time, center, code});
  
  Document_Element_SetObject(element, "class", item);
  element.onclick    = Teach_Class_Preview; 
  
  container.appendChild(element);
  
  // IS THIS THE CURRENT CLASS?
  if(Numbers_Between(now, item["date_start"], item["date_end"]))
  { 
   current = element;
  }
 }
 
 container.style.visibility = "visible";
 
 
 // IF THERE IS A CLASS RIGHT NOW, BLINK AND SCROLL INTO VIEW AUTOMATICALLY
 if(current)
 {
  Document_Element_Animate(current, "flash 1.5s 3");
  current.scrollIntoView({behavior: "smooth", block: "center"})
 }
}




async function Teach_Class_Preview(event)
{
 var element   = event.currentTarget;
 var classitem = Document_Element_GetObject(element, "class");
 
 Core_State_Set("teach", ["calendar", "selected-class"], element); 
 var container = UI_Element_Find("classes-list");
 Document_Conditional_Class(container, "style-outlined-accented", element);
 
 
 var page = await Class_Preview(classitem["id"], 
 {
  classroom   : Teach_Class_Start, 
  assessment  : Teach_Class_Assess, 
  online      : false, 
  attendance  : false, 
  quickassess : UI_Element_Find("student-assessment"),
  nickname    : true
 });
  
 
 // CLEAR ASSESSMENT PANEL
 UI_Element_Find("student-assessment").innerHTML = "";
 
 
 // DISPLAY
 var container       = UI_Element_Find("class-preview");
 container.innerHTML = "";
 container.appendChild(page);
 
 container.style.visibility = "visible";
}




async function Teach_Class_Start(event, id)
{
 if(!id)
 {
  var element   = event.currentTarget;
  var classdata = Document_Element_GetObject(element, "class");
  var id        = classdata["id"];
 }
 
 Core_State_Set("global", ["view-class"], id);
 Module_Load("classroom");
}



async function Teach_Class_Assess(event, id)
{
 if(!id)
 {
  var element   = event.currentTarget;
  var classdata = Document_Element_GetObject(element, "class");
  var id        = classdata["id"];
 }
 
 await Assessment_Assess_Class(id);
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                              C L A S S I F Y    I T E M S                                      //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Test_ClassifyItems_Display(sheet, display)
{
 // PREPARE
 var elements = [];
 
 // QUESTION
 var question = Safe_Get(sheet, ["question"], {});
 var element  = Test_Element_Question("standard", question, {source:sheet["source"]}, sheet);
 elements.push(element);
 
 
 // CONTAINERS FOR DRAG AND DROP AND LIST OF ALL ITEMS
 var containers = [];
 var allitems   = [];
 
 
 // CONTENT
 var content = Test_Element_Container("twocolumns");
 var left    = UI_Element_Find(content, "left");
 var right   = UI_Element_Find(content, "right");
 elements.push(content);
 
 containers.push(right);
 
 
 
 // ORGANIZE ITEMS BY CATEGORY
 var items      = Object_Subset(sheet, "item");
 var categories = {};
 for(var id in items)
 {
  var item = items[id];
  Safe_Push(categories, item["category"], item);
 }


 
 // CREATE CATEGORY BOXES
 for(var category in categories)
 {
  var box = Test_Element_Create("category-box", {category}, sheet);
  Document_Element_SetData(box, "category", category);
  
  // ADD THIS CATEGORY BOX'S ITEMS SUBDIV TO THE LIST OF DRAG AND DROP CONTAINERS
  containers.push(UI_Element_Find(box, "category-items"));
  
  // ADD CATEGORY BOX TO THE TEST
  left.appendChild(box);
  
  
  // NOW ADD THIS CATEGORY'S ITEMS TO THE CONTENT PILE
  var items = categories[category];
  for(var item of items)
  {
   var element = Test_Element_Item("small", item, {mode:"single media", source:sheet["source"]});
   Document_Element_SetObject(element, item);
   
   // ADD ITEM TO THE CONTENT CONTAINER
   right.appendChild(element);
   
   allitems.push(item);
  }
  
 }
 
 // SHUFFLE ITEMS
 console.log(right);
 Document_Element_ShuffleChildren(right);
 
 Document_Handler_DragSwapParent(containers, "style-highlight-accented", Test_ClassifyItems_Drag);
 
 if(Test_Mode() != "edit")
 {   
  sheet["items"] = allitems; 
 }
 
 
 return elements;
}




async function Test_ClassifyItems_Drag(event)
{   
 var element   = event["dragged"];
 var from      = event["from"];
 
 // DRAG ACTION SUCCEEDED
 if(event["success"])
 {
  var sheet        = Core_State_Get("test", ["current-sheet"]);
  
  var container    = Document_Element_FindParent(event["container"], "category");
  if(!container) return;
  
  var category     = Document_Element_GetData(container, "category");
  var item         = Document_Element_GetObject(element, "item");
  
  item["put-into"] = category;
  
  // PRACTICE MODE: BOUNCE BACK ELEMENT IF WRONG
  if(Test_Mode() == "practice")
  {
   Safe_Add(sheet, ["attempts"], +1); 
  
   switch(Test_ClassifyItems_Evaluate(item))
   {
	case "wrong":
		await Test_Feedback_Wrong(item["element"]);
	
		// RESTORE TO PREVIOUS CONTAINER
		item["element"].remove();
		from.appendChild(item["element"]);
	
		Safe_Add(sheet, ["mistakes"], +1); 
	break;
	
	default:
	    if(Test_ClassifyItems_Evaluate(item) == "right")
		{
	 	 await Test_Feedback_Right(item["element"], {permanent:true});
		
		 Document_Element_Disable(item["element"]);
		}	
	break;
   }
   
   return;
  }
  
  Document_Element_Animate(element, "rubberBand 0.5s linear 1");

  Media_Audio_Play(Resources_URL("sounds/drop.mp3"));
 }
 else
 {
  Document_Element_Animate(element, "shakeY 0.5s linear 1"); 
   
  Media_Audio_Play(Resources_URL("sounds/swosh.mp3"));
 }
}





function Test_ClassifyItems_Evaluate(item)
{
 if(item["category"] == item["put-into"]) return "right"; else return "wrong";
}




async function Test_ClassifyItems_Feedback(sheet)
{
 var items = sheet["items"];
 var max   = items.length;

 
 
 // DISABLE ELEMENTS INTERACTION
 for(var item of items)
 {
  item["element"].draggable = false;
 }
 
 
 // IN PRACTICE MODE, JUST CHECK THE SHEET'S NUMBER OF MISTAKES MADE
 if(Test_Mode() == "practice")
 {
  var mistakes = Safe_Get(sheet, ["mistakes"], 0);
  var attempts = Safe_Get(sheet, ["attempts"], 0);
  var score    = (1 - (mistakes / attempts)) || 0;
 }
 
 
 if(Test_Mode() == "test")
 {
  var score = 0;
  
  for(var item of sheet["items"])
  {
   switch(Test_ClassifyItems_Evaluate(item))
   {
    case "right": 
	    await Test_Feedback_Right(item["element"], {permanent:true});
		
		score = score + 1;
    break;
   
    case "wrong":
		await Test_Feedback_Wrong(item["element"], {permanent:true});
		
		score = score - 0.5;
    break;
   }
  }
  
  score = score / max;
 }
 
 return score;
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                  F I L L    B L A N K S                                        //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Test_FillBlanks_Display(sheet, display)
{ 
 // PREPARE
 var elements = [];
 
 
 // QUESTION
 var question = Safe_Get(sheet, ["question"], {});
 var element  = Test_Element_Question("standard", question, {source:sheet["source"]}, sheet);
 elements.push(element);
 
 
 // CONTENT
 var content = Test_Element_Container("standard");
 if(Test_Mode() == "edit") Document_Element_Disable(content);

 // TEXT WITH BLANKS
 var assisted   = Safe_Get(sheet, ["info", "assisted"], "no");
 var paragraphs = Object_Subset(sheet, "paragraph");
 
 
 // COLLECT ALL BLOCKS FROM ALL PARAGRAPHS, FOR POSSIBLE USE LATER
 var allblocks = [];
 for(var id in paragraphs)
 {
  var paragraph = paragraphs[id];
  var string    = paragraph["text"];
  var blocks    = String_Extract_TagBlocks(string);
  
  for(var block of blocks)
  {
   if(block["type"] == "tag")
   {
	allblocks.push(block);
   }
  }
 }
 
 
 var blanks = [];
 for(var id in paragraphs)
 { 
  var paragraph = paragraphs[id];
  
  // CREATE PARAGRAPH BOX
  var box          = Test_Element_Box("blocks", sheet);
  Document_Element_SetObject(box, "paragraph", paragraph);
  if(Test_Mode() != "edit") 
  {
   paragraph["box"] = box;
  }
  
  var string       = paragraph["text"];
  var blocks       = String_Extract_TagBlocks(string);
     
	 
  // FOR EACH BLOCK OF TEXT WITHIN THIS PARAGRAPH...
  var uid = 0;
  for(var block of blocks)
  {
   switch(block["type"])
   {
	case "text":
		// JUST A TEXT BLOCK
		var element = Test_Element_Create("block-text", {text:block["content"]}, sheet);
	break;
	
	case "tag": 
	   
	   switch(assisted)
	   {
		case "yes":
			// IF ASSISTED, USE A SELECT WITH ALL POSSIBLE BLOCKS FOR THIS PARAGRAPH, IN SCRAMBLED ORDER
			var element = Test_Element_Create("block-select", blocks, sheet); 

			var tokens  = [];	
			for(var token of blocks) if(token["type"] == "tag") 
			{
			 tokens.push(token);
			}
		
			for(var token of tokens)
			{
			 // ATTACH THE CORRECT BLOCK AS OBJECT TO THE OPTION, SO THAT LATER WE CAN EASILY CHECK IF THE SELECTED OPTION IS CORRECT OR NOT
			 var option = Document_Select_AddOption(element, token["content"], token["content"], block);
			}
		
			// SCRAMBLE OPTIONS
			Document_Element_ShuffleChildren(element);
   
			// ADD NULL OPTION ON TOP
			Document_Select_InsertOption(element, "", "");
			element.selectedIndex = 0;
       break;   
		   
		   
	   case "all":
			// IF ASSISTED / ALL, USE A SELECT WITH ALL POSSIBLE BLOCKS FROM ALL PARAGRAPHS, IN SCRAMBLED ORDER
			var element = Test_Element_Create("block-select", blocks, sheet); 

			for(var token of allblocks)
			{
			 // ATTACH THE CORRECT BLOCK AS OBJECT TO THE OPTION, SO THAT LATER WE CAN EASILY CHECK IF THE SELECTED OPTION IS CORRECT OR NOT
			 var option = Document_Select_AddOption(element, token["content"], token["content"], block);
			}
		
			// SCRAMBLE OPTIONS
			Document_Element_ShuffleChildren(element);
   
			// ADD NULL OPTION ON TOP
			Document_Select_InsertOption(element, "", "");
			element.selectedIndex = 0;
       break;
	   
	   
	   default:
		    // IF NOT ASSISTED, USE A TEXT INPUT
	        var element = Test_Element_Create("block-input", block, sheet); 
       break;
	  }
	  
	  blanks.push(block);
	  
	break;
   } 
  
   Document_Element_SetData(element,   "uid",   uid);
   Document_Element_SetObject(element, "box",   box); 
   Document_Element_SetObject(element, "block", block);
   element.onchange = Test_FillBlanks_Input;
   
   if(Test_Mode() != "edit") block["element"] = element;
  
   // ADD ITEM TO THE PARAGRAPH
   box.appendChild(element);
  
   uid = uid + 1;
  }	
  
  // ADD PARAGRAPH TO THE CONTENT CONTAINER
  content.appendChild(box);
 }
 
 
 // IF NOT IN EDIT MODE, STORE BLANKS FOR LATER USE
 if(Test_Mode() != "edit") sheet["blanks"] = blanks;
 
 
 // ADD CONTENT CONTAINER TO THE TEST LAYOUT
 elements.push(content);
 return elements;
}






async function Test_FillBlanks_Input(event)
{
 var input     = event.currentTarget;
 
 var item      = Document_Element_GetObject(input, "item");
 var sheet     = Document_Element_GetObject(input, "sheet");
 var box       = Document_Element_GetObject(input, "box");
 var block     = Document_Element_GetObject(input, "block");
 var paragraph = Document_Element_GetObject(box,   "paragraph");
  
 var assisted  = (Safe_Get(sheet, ["info", "assisted"], "no") == "yes");
 
 // IF TEST MODE IS "PRACTICE" WE NEED TO GIVE IMMEDIATE FEEDBACK
 if(Test_Mode() == "practice")
 {   
  Safe_Add(sheet, ["attempts"], +1); 
  
  switch(Test_FillBlanks_Evaluate(block))
  {
   // IS THIS A CORRECT ITEM? IF NOT, GIVE NEGATIVE FEEDBACK, MARK THE SHEET, AND STOP HERE
   case "right":
       await Test_Feedback_Right(input, {permanent:true});
	
	   Document_Element_Disable(input);
   break;
  
   default:
       Safe_Add(sheet, ["mistakes"], +1); 

       await Test_Feedback_Wrong(input);
	  
	   input.value = "";
   break;
  }
 }
}


function Test_FillBlanks_Evaluate(block)
{ 
 // FIND OUR BLOCK AND THE CORRESPONDING STORED INPUT
 var value  = block["element"].value;
 var input  = value.trim().toLowerCase(); 
 var answer = block["content"];    
 
 console.log(answer);
 
 // COMPARE INPUT TO BLOCK
 var similarity = 1 - String_Analysis_Distance(String_Simplify(answer), String_Simplify(input));
 
 
 if(similarity >= Module_Config("test", "score-perfect", 0.9)) 
 {	 
  return "right";
 }	   
 else
 {
  return "wrong";
 }
  
}





async function Test_FillBlanks_Feedback(sheet)
{
 var paragraphs = Object_Subset(sheet, "paragraph"); 
 var blanks     = sheet["blanks"];
 var max        = blanks.length;
 
 
 // DISABLE ELEMENTS
 for(var block of blanks)
 {
  Document_Element_Disable(block["element"]);
 }
 
 
 // IN PRACTICE MODE, JUST CHECK THE SHEET'S NUMBER OF MISTAKES MADE
 if(Test_Mode() == "practice")
 {
  var mistakes = Safe_Get(sheet, ["mistakes"], 0);
  var attempts = Safe_Get(sheet, ["attempts"], 0);
  var score    = (1 - (mistakes / attempts)) || 0;
 }


 if(Test_Mode() == "test")
 {
  // CALCULATE SCORE
  var score = 0;
  
  for(var block of blanks)
  {
   switch(Test_FillBlanks_Evaluate(block))
   {
	case "right":
		score = score + 1;
		
		await Test_Feedback_Right(block["element"], {permanent:true}); 
	break;
	
	case "wrong":
		await Test_Feedback_Wrong(block["element"], {permanent:true}); 
		
		//block["element"].value = block["content"];
		
		// MAKE ELEMENT WIDE ENOUGH TO SHOW THE WHOLE CORRECT ANSWER
		block["element"].style.width = "";
		//block["element"].size        = "";
    
    //SHOW CORRECT ANSWER 
    var element = Test_Element_Create("block-text", {text:"(" + block["content"] + ")"}, sheet);
    element.style.color = "var(--color-good)";
    block["element"].parentNode.insertBefore(element,block["element"].nextSibling)
	break;
   }
  }
   
  if(score < 0) score = 0; 
  var score = score / max;  
 }
 
 

 return score;
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                H I G H L I G H T    T E X T                                    //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Test_HighlightText_Display(sheet, display)
{ 
 // PREPARE
 var elements = [];

 
 // QUESTION
 var question = Safe_Get(sheet, ["question"], {});
 var element  = Test_Element_Question("standard", question, {source:sheet["source"]}, sheet);
 elements.push(element);
 
 
 
 // CONTENT
 var content = Test_Element_Container("standard");
 elements.push(content);
 
 
 
 // TEXT WITH HIGHLIGHTS
 var paragraphs = Object_Subset(sheet, "paragraph");
 var alltokens  = [];
 
 for(var id in paragraphs)
 {
  var paragraph = paragraphs[id]
  var string    = paragraph["text"]; 
  var blocks    = String_Extract_TagBlocks(string);
  
  // CREATE PARAGRAPH BOX
  var box = Test_Element_Box("blocks");
  Document_Element_SetObject(box, "paragraph", paragraph);
  if(Test_Mode() != "edit") paragraph["box"] = box;
  
  for(var block of blocks)
  {   
   var tokens = block["content"].split(" ");
   
   for(var text of tokens)
   if(text != "")
   {
	var element     = Test_Element_Create("block-text", {text}, sheet);
	element.onclick = Test_HighlightText_Highlight;
	    
	box.appendChild(element);
	
	if(Test_Mode() != "edit")
	{
     var token            = {};
	 
	 token["block"]       = block;
	 token["element"]     = element;
	 token["paragraph"]   = paragraph;
	 token["highlighted"] = false;
	 
	 Document_Element_SetObject(element, "token", token);
	 
	 alltokens.push(token);
	}
	
   }

  }	

  // ADD PARAGRAPH TO CONTENT CONTAINER
  content.appendChild(box);  
 }
 
 if(Test_Mode() != "edit")
 {
  sheet["tokens"] = alltokens;
 }
 
 return elements;
}





async function Test_HighlightText_Highlight(event)
{
 var element   = event.currentTarget;
 var sheet     = Document_Element_GetObject(element, "sheet");
 var token     = Document_Element_GetObject(element, "token");
 var paragraph = Safe_Get(token, ["paragraph"]);
 
 if(!token) return;
 
 console.log(paragraph);
 
 // IF WE ARE ABOUT TO HIGHLIGHT A TOKEN WE NEED TO CHECK IF THERE'S A LIMIT TO THE MAXIMUM NUMBER OF HIGHLIGHTABLE TOKENS
 if(!token["highlighted"])
 {
  var highlighted = Safe_Get(paragraph, ["highlighted"], 0);
  var max         = Safe_Get(paragraph, ["max"], 0);
  
  // ALREADY REACHED MAX NUMBER OF SELECTIONS? STOP HERE
  if(max > 0 && highlighted >= max)
  {
   return;
  }
 }
 
 
 // SWITCH STATE
 token["highlighted"] = !token["highlighted"];
  
 // UPDATE HIGHLIGHTED COUNT
 var highlighted = Safe_Get(paragraph, ["highlighted"], 0);
 if(token["highlighted"])
 {
  paragraph["highlighted"] = highlighted + 1;	 
 }	
 else
 {
  paragraph["highlighted"] = highlighted - 1;	 
 }	
 	

 // IF WE JUST HIGHLIGHTED SOMETHING, AND TEST MODE IS "PRACTICE" THEN WE NEED TO GIVE IMMEDIATE FEEDBACK
 if(token["highlighted"] && Test_Mode() == "practice")
 {  
  Safe_Add(sheet, ["attempts"], +1); 
 
  switch(Test_HighlightText_Evaluate(token))
  {
   case "right":
	  await Test_Feedback_Right(token["element"], {permanent:true, outline:"outer"});
	  
	  Document_Element_Disable(token["element"]);
   break;
   
   case "wrong":
	  await Test_Feedback_Wrong(token["element"]);
	  token["highlighted"] = false;
	
	  Safe_Add(sheet, ["mistakes"], +1); 
   break;
  }
 }
 
 
 // UPDATE VISUALS
 for(var token of sheet["tokens"])
 {
  if(token["highlighted"])
  {
   token["element"].style.backgroundColor = "var(--color-accented)";
  }
  else
  {
   token["element"].style.backgroundColor = "";
  }
 }
}

	

	
function Test_HighlightText_Evaluate(token)
{
 var highlighted = token["highlighted"];
 var correct     = (token["block"]["type"] == "tag");

 
 // INCORRECT TOKEN, BUT SELECTED
 if(!correct && highlighted)
 {
  return "wrong";
 }
 else
 // INCORRECT TOKEN, NOT SELECTED
 if(!correct && !highlighted)
 {
  return "";
 }
 else
 // CORRECT TOKEN, SELECTED
 if(correct && highlighted)
 {
  return "right";
 }
 else
 // CORRECT TOKEN, MISSED
 if(correct && !highlighted)
 {
  return "wrong";
 }
 	
}







async function Test_HighlightText_Feedback(sheet)
{
 // DISABLE ELEMENTS
 for(var token of sheet["tokens"])
 {
  Document_Element_Disable(token["element"]);
 }
 
 
 
 // CALCULATE MAX
 var max = 0;
 for(var token of sheet["tokens"])
 {
  if(token["block"]["type"] == "tag")
  {
   max = max + 1;
  }
 }


 
 
 // IN PRACTICE MODE, JUST CHECK THE SHEET'S NUMBER OF MISTAKES MADE
 if(Test_Mode() == "practice")
 {
  var mistakes = Safe_Get(sheet, ["mistakes"], 0);
  var attempts = Safe_Get(sheet, ["attempts"], 0);
  var score    = (1 - (mistakes / attempts)) || 0;
 }


 
 if(Test_Mode() == "test")
 {
  var score = 0;
  
  for(var token of sheet["tokens"])
  {
   switch(Test_HighlightText_Evaluate(token))
   {
    case "right":
        await Test_Feedback_Right(token["element"], {permanent:true, outline:"outer"});
		
		score = score + 1;
    break;
   
    case "wrong":
		await Test_Feedback_Wrong(token["element"], {permanent:true, outline:"outer"});
		
		score = score - 0.5;
    break;
   }
  }
  
  if(score < 0) score = 0;
  score = score / max;  
 }
 
 

 // RETURN SCORE
 return score;
}


// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                I D E N T I F Y    I T E M S                                    //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Test_IdentifyItems_Display(sheet, display)
{ 
 // PREPARE
 var elements = [];
 
 
 // QUESTION
 var question = Safe_Get(sheet, ["question"], {});
 var element  = Test_Element_Question("standard", question, {picture:false, source:sheet["source"]}, sheet);
 elements.push(element);
 
 
 
 // BIG PICTURE
 var bigpicture = Test_Element_Container("bigpicture");
 Document_Element_SetData(bigpicture, "uid", "test-main-content");
 elements.push(bigpicture);

 var source    = sheet["source"] + "/" + Safe_Get(sheet, ["question", "picture"], "");
 
 var picture   = UI_Element_Find(bigpicture, "picture");
 Document_Image_Load(picture, [source]);
 
 // PREVENT PICTURE FROM BEING DRAGGED AROUND
 picture.ondragstart =
 function(event)
 {
  return false;
 }
 
 
 // ITEM SELECTION
 picture.onclick = Test_IdentifyItems_Select;
 
 
 // CREATE ITEMS CLICKAREAS
 var items     = Object_Subset(sheet, "item");
 var z         = 1000;
 for(var id in items)
 {
  var item                 = items[id];
  
  var element              = Test_Element_Create("area-square");
  element.style.left       = item["left"];
  element.style.top        = item["top"];
  element.style.width      = item["width"];
  element.style.height     = item["height"];
  element.style.zIndex     = z;
  
  element.onclick          = Test_IdentifyItems_Select;
  element.innerHTML        = item["name"].toUpperCase();
  Document_Element_SetData(element, "type", "item-square");
  
  bigpicture.appendChild(element);
  
  z++;
  
  // IF IN EDIT MODE, MAKE THE ELEMENT VISIBLE
  if(Test_Mode() == "edit") element.style.visibility = "visible";
 }
 
  
 return elements;
}





async function Test_IdentifyItems_Select(event)
{  
 // CAN ADD ONE MORE SELECTION?
 var sheet      = Core_State_Get("test", ["current-sheet"]); 
 var items      = Object_Subset(sheet, "item");
 var content    = UI_Element_Find("test-main-content"); 
 var selections = Document_Element_FindChildren(content, "type", "user-cross");
 if(selections.length >= Object.keys(items).length) return; 
 
 
 var container = UI_Element_Find("test-main-content");
 var coords    = Document_Event_RelativeCoords(event);
 
 var element              = UI_Element_Create("test/element-area-cross");
 element.style.visibility = "hidden";
 container.appendChild(element);
 var rect                 = element.getBoundingClientRect();


 element.style.left       = coords["x"] - (parseInt(rect.width) / 2);
 element.style.top        = coords["y"] - (parseInt(rect.height) / 2);
 element.style.zIndex     = 1000;
 Document_Element_SetData(element, "type", "user-cross");
 
 element.style.visibility = "visible";
 Media_Audio_Play(Resources_URL("sounds/drop.mp3"));   
 Document_Element_Animate(element, "rubberBand 0.5s linear 1");
 
 element.onclick = Test_IdentifyItems_Remove;
 
 
 // IN PRACTICE MODE, GIVE IMMEDIATE FEEDBACK
 if(Test_Mode() == "practice")
 { 
  Safe_Add(sheet, ["attempts"], +1); 
  
  switch(Test_IdentifyItems_Evaluate(element, "item-square", true)) 
  {
   case "right":
	   element.style.color = "var(--color-good)";	
	   await Test_Feedback_Right(element, {permanent:true, nostyle:true});
	   
	   Document_Element_Disable(element);
   break;
  
   case "wrong":
      element.style.color = "var(--color-bad)";
      await Test_Feedback_Wrong(element, {nostyle:true});
  
      element.remove();
  
      var sheet = Core_State_Get("test", ["current-sheet"]); 
      Safe_Add(sheet, ["mistakes"], +1);
   break;
  }
 }
 
}





async function Test_IdentifyItems_Remove(event)
{
 var element = event.currentTarget;
 
 Media_Audio_Play(Resources_URL("sounds/swosh.mp3"));
 await Document_Element_Animate(element, "fadeOutUp 0.5s linear 1");
 
 element.remove();
}





function Test_IdentifyItems_Evaluate(element, mode, remove)
{
 var result = "wrong";
 var list   = Document_Element_ListColliding(element);
 
 for(var collider of list)
 {  
  var type = Document_Element_GetData(collider, "type"); 
  if(type == mode) 
  {
   if(remove) collider.remove();
   result = "right";
  }
 }
	
 return result;
}





async function Test_IdentifyItems_Feedback(sheet)
{
 var items = Object_Subset(sheet, "item");
 var max   = Object.keys(items).length;


 // DISABLE ELEMENTS INTERACTION
 var content = UI_Element_Find("test-main-content");
 Document_Element_Disable(content);
 
 
 // IN PRACTICE MODE, JUST CHECK THE SHEET'S NUMBER OF MISTAKES MADE
 if(Test_Mode() == "practice")
 {
  var mistakes = Safe_Get(sheet, ["mistakes"], 0);
  var attempts = Safe_Get(sheet, ["attempts"], 0);
  var score    = (1 - (mistakes / attempts)) || 0;
 }
 

 
 if(Test_Mode() == "test")
 {
  var score = 0;
  
  // CHECK AREAS: CORRECTLY MARKED, OR NOT?
  var elements = Document_Element_FindChildren(content, "type", "item-square");
  for(var element of elements)
  {   
   switch(Test_IdentifyItems_Evaluate(element, "user-cross"))
   {
    case "right":
 	 element.style.innerHTML       = ""; 
	 element.style.visibility      = "visible";
	 element.style.backgroundColor = "var(--color-right)";
	
	 await Test_Feedback_Right(element, {nostyle:true, permanent:true});
	
	 score = score + 1;
    break;
	
	case "wrong":
 	 element.style.innerHTML       = ""; 
	 element.style.visibility      = "visible";
	 element.style.backgroundColor = "var(--color-bad)";
	
	 await Test_Feedback_Wrong(element, {nostyle:true, permanent:true});
	
	 score = score - 1;
    break;
   }
  }
  
  
  if(score < 0) score = 0;
  score = score / max;
 }
 
 
 return score;
}



/*
 // CHECK CROSSES
 var elements = Document_Element_FindChildren(content, "type", "user-cross");
  for(var element of elements)
  {
   switch(Test_IdentifyItems_Evaluate(element, "item-square"))
   {
	case "right":
	    element.style.color = "var(--color-good)";
		
		await Test_Feedback_Right(element, {nostyle:true, permanent:true});
		
		score = score + 1;
	break;
	
	case "wrong":
		element.style.color = "var(--color-bad)";
		
		await Test_Feedback_Wrong(element, {nostyle:true, permanent:true});
		
		score = score - 0.5;
	break;
   }
  }
*/// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                   M A T C H    I T E M S                                       //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Test_MatchItems_Display(sheet, display)
{
 // PREPARE
 var elements   = [];
 var containers = {};
 var allitems   = [];
 
 
 // QUESTION
 var question = Safe_Get(sheet, ["question"], {}); 
 var element  = Test_Element_Question("standard", question, {source:sheet["source"]}, sheet);
 elements.push(element);
 
 
 
 // LEFT SIDE
 containers["left"] = Test_Element_Container("compact");
 elements.push(containers["left"]);
 
 
 // RIGHT SIDE
 containers["right"] = Test_Element_Container("compact");
 elements.push(containers["right"]);
 


 // CREATE ITEMS
 var items = Object_Subset(sheet, "item"); 
 for(var id in items)
 {
  var item    = items[id];
  var column  = item["column"] || "left";
  
  if(column == "left") 
  {
   var grip   = "right"; 
   var style  = false;
  }
  else 
  {
   var grip  = "left";
   var style = false;
   
   allitems.push(item);
  }
  
  var element = Test_Element_Item("magnetic", item, {grip:grip, source:sheet["source"]}, sheet);
  if(style) Document_CSS_SetClass(element, style);
  
  containers[column].appendChild(element);
  
  if(Test_Mode() != "edit")
  {
   item["index"] = Document_Element_Index(item["element"]);
  }
 }
 
 
 // SHUFFLE RIGHT COLUMN
 Document_Element_ShuffleChildren(containers["right"]);
 
 
 // SET UP DRAGSWAPPING OF ITEMS ON THE RIGHT COLUMN
 Document_Handler_DragSwap(Document_Element_Children(containers["right"]), "style-blurred-light", Test_MatchItems_Drag);
 

 if(Test_Mode() != "edit")
 {
  sheet["items"] = allitems;
 }	 
 
 return elements;
}






async function Test_MatchItems_Drag(event)
{  
 if(event["success"])
 {
  var sheet  = Core_State_Get("test", ["current-sheet"]);
   
  var dragged = event["dragged"];
  var dropped = event["dropped"];
  
  
  Document_Element_Animate(dragged, "rubberBand 0.5s linear 1");
  Document_Element_Animate(dropped, "rubberBand 0.5s linear 1");
  
  Media_Audio_Play(Resources_URL("sounds/drop.mp3"));
  
  // IF PRACTICE MODE, CHECK IF CORRECT
  if(Test_Mode() == "practice")
  {
   Safe_Add(sheet, ["attempts"], +1); 
   
   var item = Document_Element_GetObject(dragged, "item");
   
   switch(Test_MatchItems_Evaluate(item))
   {
	case "right":
		 await Test_Feedback_Right(item["element"], {permanent:true});
		
		 Document_Element_Disable(item["element"]);
		 Document_Element_SetData(item["element"], "evaluated", true);
	break;
  
    case "wrong":
    
       await Test_Feedback_Wrong(dragged);
       Document_Elements_Swap(dragged, dropped);
   
       var sheet = Document_Element_GetObject(dragged, "sheet");
       Safe_Add(sheet, ["mistakes"], +1); 
	   
	   return;
    break;
   }
  }
  
 }
 else
 {
  Document_Element_Animate(dragged, "shakeY 0.5s linear 1"); 
   
  Media_Audio_Play(Resources_URL("sounds/swosh.mp3"));
 }
}







function Test_MatchItems_Evaluate(item)
{
 var element       = item["element"];
 var true_index    = item["index"];
 var current_index = Document_Element_Index(item["element"]); 
 
 if(true_index == current_index) return "right"; else return "wrong";
}







async function Test_MatchItems_Feedback(sheet)
{
 var items = sheet["items"];
 var max   = items.length;


 // DISABLE ELEMENTS INTERACTION
 for(var item of items)
 {
  item["element"].draggable = false;
 }
 
 
 // IN PRACTICE MODE, JUST CHECK THE SHEET'S NUMBER OF MISTAKES MADE
 if(Test_Mode() == "practice")
 {
  var mistakes = Safe_Get(sheet, ["mistakes"], 0);
  var attempts = Safe_Get(sheet, ["attempts"], 0);
  var score    = (1 - (mistakes / attempts)) || 0;
 }
 

 
 if(Test_Mode() == "test")
 {
  var score = 0;
  
  for(var item of items)
  {  
   switch(Test_MatchItems_Evaluate(item))
   {
    case "right":
	    await Test_Feedback_Right(item["element"], {permanent:true});
		
		score = score + 1;
    break;
   
    case "wrong":
		await Test_Feedback_Wrong(item["element"], {permanent:true});
		
		score = score - 0.5;
    break;
   }
  }
  
  if(score < 0) score = 0;
  score = score / max;
 }
 
 
 return score;
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          T E S T                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Test_OnLoad(module, data)
{
 UI_Element_Find(module, "button-confirm").onclick = Test_Confirm;
 UI_Element_Find(module, "button-next").onclick    = Test_Next;
 UI_Element_Find(module, "button-finish").onclick  = Test_Finish;
  
 var source = Module_Parameter_Get("test");
 var test   = await Test_Load(source);
 if(!test) return;
 
 Core_State_Set("test", ["test"], test);
 Test_State("wait-answer");
 
 var mode   = Module_Parameter_Get("mode") || "test";
 Test_Mode(mode);
 
 var display = UI_Element_Find(module, "test-display");
 Test_Assign(test, display);
 
 Test_Display(test);
 Test_Update(module);


 // INIT TEST STORE (CAPTURE AT LEAST DATE AND TEST ID) 
 var store = Module_Parameter_Get("store");
 Core_State_Set("test", ["store"], store);

 Test_Store();
}




async function Test_OnShow(module, data)
{	

}




async function Test_OnUnload()
{
}




async function Test_Store()
{
 var test  = Core_State_Get("test", ["test"]);
 var store = Core_State_Get("test", ["store"]);

 if(!store) return;

 await Core_Api("Test_Results_Store", {id:store, test_id:test["source"], score:0, data:{}});
}




function Test_State(state)
{
 if(state == undefined) return Core_State_Get("test", ["state"]);
 
 Core_State_Set("test", ["state"], state);
}




async function Test_Update(display)
{
 if(!display) var display = document.body;
 
 var test           = Core_State_Get("test", ["test"], {});
 var index          = parseInt(test["index"]) + 1;
 var total          = test["sheets"].length;
 UI_Element_Find(display, "test-progress").innerHTML = index + " / " + total;
 
 
 var buttons = {};
 for(var button of ["confirm", "next", "finish"])
 {
  buttons[button] = UI_Element_Find(display, "button-" + button);
 }
 
 var state = Test_State();
 switch(state)
 {
  case "wait-answer":
    buttons["confirm"].style.display = "flex";
	buttons["next"].style.display    = "none";
	buttons["finish"].style.display  = "none";
  break;
  
  case "wait-continue":
    buttons["confirm"].style.display = "none";
	buttons["next"].style.display    = "flex";
	buttons["finish"].style.display  = "none";
  break;
  
  case "wait-end":
    buttons["confirm"].style.display = "none";
	buttons["next"].style.display    = "none";
	buttons["finish"].style.display  = "flex";
  break;
  
  default:
	for(var button in buttons) buttons[button].style.display = "none";
  break;
 }
}



async function Test_Confirm()
{
 // HIDE BUTTONS
 UI_Element_Find("test-buttons").style.visibility = "hidden";
 
 var test = Core_State_Get("test", ["test"], {});
 
 Test_State("none");
 Test_Update();
 
 var sheet       = Test_Sheet_Current(test);
 sheet["result"] = await Test_Feedback_CurrentSheet(); 
 
 await Client_Wait(2);
 
 if(Test_Sheet_Last(test))
 {
  Test_State("wait-end");
 }
 else
 {
  Test_State("wait-continue");
 }
 
 Test_Update();
 
 // SHOW BUTTONS
 UI_Element_Find("test-buttons").style.visibility = "visible";
}



async function Test_Next()
{
 // HIDE BUTTONS
 UI_Element_Find("test-buttons").style.visibility = "hidden";
 
 
 var test                 = Core_State_Get("test", ["test"], {});
 
 var display              = UI_Element_Find("test-display");
 
 await Document_Element_Animate(display, "bounceOut 0.75s ease-in-out");
 Test_Sheet_Next(test, true);
 await Document_Element_Animate(display, "bounceIn 0.75s ease-in-out");
 
 await Client_Wait(1);
 
 Test_State("wait-answer"); 
 Test_Update();
 
 
 // SHOW BUTTONS
 UI_Element_Find("test-buttons").style.visibility = "visible";
}



function Test_Finish()
{
 var test = Core_State_Get("test", ["test"], {});
 
 Test_State("none");
 Test_Update();
 
 var display       = UI_Element_Find("test-display");
 display.innerHTML = "";
 
 Test_Store();
}
// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                               M U L T I P L E    C H O I C E                                   //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Test_MultipleChoice_Display(sheet, display)
{
 // PREPARE
 var elements = [];
 
 
 // QUESTION
 var question = Safe_Get(sheet, ["question"], {});
 var element  = Test_Element_Question("standard", question, {source:sheet["source"]}, sheet);
 elements.push(element);
 
 
 // CONTENT
 var content = Test_Element_Container("standard");
 elements.push(content);


 // ANSWERS
 var items = Object_Subset(sheet, "answer"); 
 for(var id in items)
 {
  var item        = items[id];
  var element     = Test_Element_Item("standard", item, {source:sheet["source"]}, sheet);
  element.onclick = Test_MultipleChoice_Select;
  
  if(Test_Mode() != "edit") item["element"] = element;
  
  // ADD ITEM TO CONTENT
  content.appendChild(element);
 }

 Document_Element_ShuffleChildren(content);
 

 return elements;
}







async function Test_MultipleChoice_Select(event)
{
 Media_Audio_Play(Resources_URL("sounds/click.mp3"));
 
 // ACQUIRE DATA FROM CLICKED ELEMENT
 var element = event.currentTarget;
 var item    = Document_Element_GetObject(element, "item");
 var sheet   = Document_Element_GetObject(element, "sheet");
 var items   = Object_Subset(sheet, "answer");
 

 
 // SELECT/UNSELECT 
 Safe_Switch(item, ["selected"]);
 
 
 // IF WE JUST SELECTED AN ITEM, AND WE ARE IN PRACTICE MODE, LET'S SEE IF WE NEED TO REJECT THE SELECTION
 if(item["selected"] && Test_Mode() == "practice")
 {
  Safe_Add(sheet, ["attempts"], +1); 
  
  switch(Test_MultipleChoice_Evaluate(item))
  {
   case "right":
	  item["selected"] = true;
	  await Test_Feedback_Right(item["element"], {permanent:true});
	  
	  Document_Element_Disable(item["element"]);
   break;
   
   default:
   
	  item["selected"] = false;
      await Test_Feedback_Wrong(item["element"]);
   
      Safe_Add(sheet, ["mistakes"], +1);
	  
	  return;
   break; 	  
  }
  
  return;
 }
 
 
 // MANAGE MULTI SELECT
 var multi = (Safe_Get(sheet, ["info", "multiple"], "no") == "yes");

 //IF MULTIPLE SELECTION NOT ALLOWED, UNSELECT ALL ITEMS EXCEPT THE CLICKED ONE
 if(!multi)
 {
  for(var id in items) 
  if(items[id] != item) 
  {
   items[id]["selected"] = false;
  }   
 }
 
 
 
 // UPDATE TEST VISUALS
 for(var id in items) 
 {
  var item = items[id];
  
  if(item["selected"]) 
  {
   Document_CSS_SetClass(item["element"], "style-outlined-accented");
  }
  else
  {
   Document_CSS_UnsetClass(item["element"], "style-outlined-accented");
  }
 }
 
}





function Test_MultipleChoice_Evaluate(item)
{
 var correct  = (item["correct"] == "yes");
 var selected = (item["selected"]);
 
 // CORRECT AND SELECTED. GOOD
 if(correct && selected)
 {
  return "right";
 }
 else
 // CORRECT BUT NOT SELECTED. BAD
 if(correct && !selected)
 {
  return "wrong";
 }
 // INCORRECT AND SELECTED. BAD
 if(!correct && selected)
 {
  return "wrong";
 }
 else
 // INCORRECT BUT NOT SELECTED. NEUTRAL
 if(!correct && !selected)
 {
  return "";
 }
}






async function Test_MultipleChoice_Feedback(sheet, silent)
{   
 // CORRECT ITEMS
 var max = 0;
 var items = Object_Subset(sheet, "answer");
 
 for(var id in items)
 {
  var item = items[id];
  
  if(item["correct"] == "yes") max = max + 1;
 }
 
 
 
 // DISABLE ELEMENTS
 for(var id in items)
 {
  var item = items[id];
  Document_Element_Disable(item["element"]);
 }
 
 
 
 // IN PRACTICE MODE, JUST CHECK THE SHEET'S NUMBER OF MISTAKES MADE
 if(Test_Mode() == "practice")
 {
  var mistakes = Safe_Get(sheet, ["mistakes"], 0);
  var attempts = Safe_Get(sheet, ["attempts"], 0);
  var score    = (1 - (mistakes / attempts)) || 0;
 }
 
 
 
 // IN TEST MODE, SCAN ITEMS AND FOR EACH ONE CHECK IF CORRECTLY SELECTED AS EXPECTED, OR NOT
 if(Test_Mode() == "test")
 {
  // CALCULATE SCORE
  var score = 0;
  
  for(var id in items)
  {
   var item = items[id];
   
   switch(Test_MultipleChoice_Evaluate(item))
   {
    case "right":
	 score = score + 1;
	
	 await Test_Feedback_Right(item["element"], {permanent:true});
	break;
   
    case "wrong":
	
 	 await Test_Feedback_Wrong(item["element"], {permanent:true});  
	 
	 score = score - 0.5;
	 
    break;
   }
   
  }
  
 
  if(score < 0) score = 0;
  score = score / max;
 }
 
 
 
 // RETURN SCORE
 return score;
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                  O P E N   Q U E S T I O N S                                   //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Test_OpenAnswers_Display(sheet, display)
{
 // PREPARE
 var elements = [];
 
 
 // QUESTION
 var question = Safe_Get(sheet, ["question"], {});
 var element  = Test_Element_Question("standard", question, {source:sheet["source"]}, sheet);
 
 elements.push(element);
 
 
 // CONTENT
 var content = Test_Element_Container("standard");
 elements.push(content);
 

 // ANSWERS
 var items = Object_Subset(sheet, "answer");
 for(var id in items)
 {
  var item    = items[id];
  var element = Test_Element_Item("opentext", item, {mode:"single media", source:sheet["source"]}, sheet);
  
  if(Test_Mode() != "edit") item["element"] = element;
  
  var input         = UI_Element_Find(element, "input");
  input.onchange    = Test_OpenAnswers_Input;
  input.placeholder = UI_Language_String("test", "item placeholder type");
  Document_Element_SetObject(input, "item", item);
  Document_Element_SetObject(input, "container", element);
  
  if(Test_Mode() != "edit") item["input"] = input;
  
  
  // ADD ITEM TO CONTENT CONTAINER
  content.appendChild(element);
 }
 
 return elements;
}




async function Test_OpenAnswers_Input(event)
{ 
 var input     = event.currentTarget;
 var item      = Document_Element_GetObject(input, "item");
 var sheet     = Document_Element_GetObject(input, "sheet");

 
 // IF TEST MODE IS "PRACTICE" WE NEED TO GIVE IMMEDIATE FEEDBACK
 if(Test_Mode() == "practice")
 {  
  Safe_Add(sheet, ["attempts"], +1); 
  
  switch(Test_OpenAnswers_Evaluate(item))
  {
   case "right":
		await Test_Feedback_Right(item["element"], {permanent:true});
		
		Document_Element_Disable(item["element"]);
   break;
   
   default:
		Safe_Add(sheet, ["mistakes"], +1); 
		
		await Test_Feedback_Wrong(item["element"]);
   
		input.value = "";
	break;
  }
 }
 

}




function Test_OpenAnswers_Evaluate(item)
{
 var input = item["input"].value;
 input     = input.trim().toLowerCase();
  
 // TEST INPUT AGAINST ALL POSSIBLE ANSWERS
 var compare = [];
 var answers = Safe_Get(item, ["answers"], "").split("/");
 for(var answer of answers) 
 {
  var text = answer.trim().toLowerCase();
    
  var similarity = 1 - String_Analysis_Distance(text, input, {alphanum:true});  
  console.log(text, input, similarity);
   
  compare.push({answer, similarity}); 
 }
   
 // SORT BY BETTER SIMILARITY AND PICK FIRST AS BEST MATCH
 Array_Items_Sort(compare, "similarity");
 compare.reverse();
 var best = compare[0];
    
 if(best["similarity"] >= Module_Config("test", "score-perfect")) 
 { 
  return "right";
 }	   
 else
 {
  return "wrong";
 }
 
}




async function Test_OpenAnswers_Feedback(sheet)
{  
 // ITEMS
 var items = Object_Subset(sheet, "answer");
 var max  = Object.keys(items).length;

 
 // DISABLE ELEMENTS
 for(var id in items)
 {
  var item = items[id];
  Document_Element_Disable(item["element"]);
 }
 

 // IN PRACTICE MODE, JUST CHECK THE SHEET'S NUMBER OF MISTAKES MADE
 if(Test_Mode() == "practice")
 {
  var mistakes = Safe_Get(sheet, ["mistakes"], 0);
  var attempts = Safe_Get(sheet, ["attempts"], 0);
  var score    = (1 - (mistakes / attempts)) || 0;
 }


 // IN TEST MODE, SCAN ITEMS AND FOR EACH ONE CHECK IF CORRECTLY SELECTED AS EXPECTED, OR NOT
 if(Test_Mode() == "test")
 {
  // CALCULATE SCORE
  var score = 0;
  
  for(var id in items)
  {
   var item  = items[id];
  
   switch(Test_OpenAnswers_Evaluate(item))
   {
	case "right":
		score = score + 1;
		
		await Test_Feedback_Right(item["element"], {permanent:true}); 
		
		item["input"].value = UI_Language_String("test", "item answers yours") + ' "' + item["input"].value + '"\r\n' + UI_Language_String("test", "item answers valid") + " " + item["answers"];
	break;
	
	case "wrong":
		await Test_Feedback_Wrong(item["element"], {permanent:true});
		
		item["input"].value = UI_Language_String("test", "item answers yours") + ' "' + item["input"].value + '"\r\n' + UI_Language_String("test", "item answers valid") + " " + item["answers"];
		//item["input"].value = UI_Language_String("test", "item answers valid") + " " + item["answers"];


		// MAKE SURE EVERYTHING CAN BE READ
		item["input"].parentElement.style.height = "";
		Document_Element_FitText(item["input"], {mode:"vertical"});
	break;
   }
  }
  
  if(score < 0) score = 0;
  score = score / max;
 }
 
 
 
 return score;
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                   O R D E R    I T E M S                                       //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Test_OrderItems_Display(sheet, display)
{
 // PREPARE
 var elements = [];
 
 
 // QUESTION
 var question = Safe_Get(sheet, ["question"], {});
 var element  = Test_Element_Question("standard", question, {source:sheet["source"]}, sheet);
 elements.push(element);
 
 
 // CONTENT
 var content = Test_Element_Container("blocks");
 Document_Element_SetData(content, "uid", "test-main-content");
 elements.push(content);



 
 // CREATE ITEMS
 var items  = Object_Subset(sheet, "item");
 var index  = 0;
 
 for(var id in items)
 {
  var item    = items[id];
  var element = Test_Element_Item("minimal", item, {mode:"single media", source:sheet["source"]}, sheet);
  
  content.appendChild(element);
  
  if(Test_Mode() != "edit") item["index"] = index;
  index = index + 1;
 }
 
 if(Test_Mode() != "edit") sheet["items"] = items;
 
 
 // SHUFFLE
 Document_Element_ShuffleChildren(content);
 
 
 // SET UP DRAGSWAPPING OF ITEMS
 Document_Handler_DragSwap(Document_Element_Children(content), "style-blurred-light", Test_OrderItems_Drag);
  
 
 return elements;
}








async function Test_OrderItems_Drag(event)
{ 
 var dragged = event["dragged"];
 var dropped = event["dropped"];
 
 if(event["success"])
 {
  Document_Element_Animate(dragged, "rubberBand 0.5s linear 1");
  Document_Element_Animate(dropped, "rubberBand 0.5s linear 1");
  
  Media_Audio_Play(Resources_URL("sounds/drop.mp3"));
  
  if(Test_Mode() == "practice")
  {
   Safe_Add(sheet, ["attempts"], +1); 
   
   var item = Document_Element_GetObject(dragged, "item"); 
   switch(Test_OrderItems_Evaluate(item))
   {
	case "right":
	   await Test_Feedback_Right(item["element"], {permanent:true});
	   
	   Document_Element_Disable(item["element"]);
	   Document_Element_SetData(item["element"], "evaluated", true);
	break;
	
	default:
       await Test_Feedback_Wrong(item["element"]);
   
       Document_Elements_Swap(dragged, dropped);
   
       var sheet = Document_Element_GetObject(dragged, "sheet");
       Safe_Add(sheet, ["mistakes"], +1); 
    break;
   }
  }
  
 }
 else
 {
  Document_Element_Animate(dragged, "shakeY 0.5s linear 1"); 
   
  Media_Audio_Play(Resources_URL("sounds/swosh.mp3"));
 }
}





function Test_OrderItems_Evaluate(item)
{
 var true_index    = item["index"];
 var current_index = Document_Element_Index(item["element"]);
 
 if(true_index == current_index) return "right"; else return "wrong";
}




async function Test_OrderItems_Feedback(sheet)
{
 var items = sheet["items"];
 var max   = Object.keys(items).length;


 // DISABLE ELEMENTS INTERACTION
 for(var id in items)
 {
  var item = items[id];
  item["element"].draggable = false;
 }
 
 
 // IN PRACTICE MODE, JUST CHECK THE SHEET'S NUMBER OF MISTAKES MADE
 if(Test_Mode() == "practice")
 {
  var mistakes = Safe_Get(sheet, ["mistakes"], 0);
  var attempts = Safe_Get(sheet, ["attempts"], 0);
  var score    = (1 - (mistakes / attempts)) || 0;
 }
 

 
 if(Test_Mode() == "test")
 {
  var score = 0;
  
  for(var id in items)
  {   
   var item = items[id];
   
   switch(Test_MatchItems_Evaluate(item))
   {
    case "right":
	    await Test_Feedback_Right(item["element"], {permanent:true});
		
		score = score + 1;
    break;
   
    case "wrong":
		await Test_Feedback_Wrong(item["element"], {permanent:true});
		
		score = score - 0.5;
    break;
   }
  }
  
  if(score < 0) score = 0;
  score = score / max;
 }
 
 
 return score;
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                             S P E E C H    R E C O G N I T I O N                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Test_SpeechRecognition_Display(sheet, display)
{
 // PREPARE
 var elements = [];
 
 
 // QUESTION
 var question = Safe_Get(sheet, ["question"], {});
 var element  = Test_Element_Question("standard", question, {source:sheet["source"]}, sheet);
 elements.push(element);
 
 
 // CONTENT
 var content = Test_Element_Container("standard");
 elements.push(content);
 
 
 
 // DISPLAY SPEECH ITEMS
 var items     = Object_Subset(sheet, "item");
 var sentences = [];
 
 for(var id in items)
 {
  var item    = items[id];
  
  // ADD THIS ITEM'S TEXT TO THE LIST OF RECOGNIZABLE SENTENCES
  var answers = Safe_Get(item, ["answers"], "").split("/");
  for(answer of answers) sentences.push(answer.toLowerCase().trim());
  
  
  // CREATE ELEMENT 
  var element = Test_Element_Item("speech", item, {mode:"single media", source:sheet["source"]}, sheet);
  if(Test_Mode() != "edit") item["element"] = element;
  
  // ELEMENT'S MICROPHONE ICON (CLICK AND RECORD)  
  var speak = UI_Element_Find(element, "speak");  
  
  Document_Element_SetObject(speak, "sentences", sentences);
  Document_Element_SetObject(speak, "sheet", sheet);
  Document_Element_SetObject(speak, "item",  item);
  
  speak.onclick = Test_SpeechRecognition_Record;
  
  
  // ELEMENT'S EAR ICON (CLICK AND RE-LISTEN)  
  var listen = UI_Element_Find(element, "listen"); 
  Document_Element_SetObject(speak, "item",  item);
 
  listen.onclick = Test_SpeechRecognition_Playback;
  Document_Element_SetObject(listen, "item",  item);
  
  content.appendChild(element);  
 }
 
 
 return elements;
}







async function Test_SpeechRecognition_Record(event)
{
 var element   = event.currentTarget;
 var icon      = UI_Element_Find(element, "icon");
 
 var sheet     = Document_Element_GetObject(element, "sheet");
 var item      = Document_Element_GetObject(element, "item");
 var sentences = Document_Element_GetObject(element, "sentences");
 
 
 // DISABLE TEST DISPLAY BEFORE RECORDING STARTS
 Test_Disable();
 
 var content_lang = "en";
 var result       = await Handler_Speech_Recognition(sentences, content_lang, element, {icon, letter_time:300, pause_time:500});
 
 // RE ENABLE TEST DISPLAY
 Test_Enable();
 
 
 // STORE RESULT FOR PLAYBACK
 if(Test_Mode() != "edit")
 {
  var item       = Document_Element_GetObject(element, "item");
  item["result"] = result;
  
  var listen = UI_Element_Find(item["element"], "listen");
  
  // IF TEST IN PRACTICE MODE, GIVE IMMEDIATE FEEDBACK
  if(Test_Mode() == "practice")  
  {
   Safe_Add(sheet, ["attempts"], +1); 
   
   switch(Test_SpeechRecognition_Evaluate(item))
   {
	case "right":
		var icon = UI_Element_Find(item["element"], "speak");
		Document_Element_Disable(icon);
		Document_CSS_SetClass(icon, "style-disabled");
		
		await Test_Feedback_Right(item["element"], {permanent:true});   
	break;
	
	case "wrong":
		listen.style.visibility = "hidden";
		await Test_Feedback_Wrong(item["element"]);   
   
		Safe_Add(sheet, ["mistakes"], +1);
   
		return;
	break;
   }
  }
 
  
  // ACTIVATE PLAYBACK BUTTON AND MAKE SURE THE USER SEES IT
  listen.style.visibility = "visible";
  
  Document_Element_Animate(listen, "flash 1.5s");
 }
 
}




function Test_SpeechRecognition_Evaluate(item)
{
 var confidence = Safe_Get(item, ["result", "confidence"], 0);
 
 if(confidence >= Module_Config("test", "score-soso")) return "right"; else return "wrong";
}




async function Test_SpeechRecognition_Playback(event)
{
 var element = event.currentTarget;
 var item    = Document_Element_GetObject(element, "item");
 var result  = item["result"];
  
 var sample  = Safe_Get(result, ["sample"]);
 
 if(sample)
 {
  var icon = UI_Element_Find(element, "icon");
  Document_Element_Animate(icon, "flash 1.5s ease-in-out infinite");
	
  await Media_Audio_Play(sample);
	
  Document_Element_Animate(icon, false);
 }
}




async function Test_SpeechRecognition_Feedback(sheet)
{
 var items = Object_Subset(sheet, "item");
 var max   = Object.keys(items).length;
  
 // DISABLE
 for(var id in items)
 {
  var item  = items[id];
  var speak = UI_Element_Find(item["element"], "speak");
  
  Document_CSS_SetClass(speak, "style-disabled");
 }
 
 
 
 // IN PRACTICE MODE, JUST CHECK THE SHEET'S NUMBER OF MISTAKES MADE
 if(Test_Mode() == "practice")
 {
  var mistakes = Safe_Get(sheet, ["mistakes"], 0);
  var attempts = Safe_Get(sheet, ["attempts"], 0);
  var score    = (1 - (mistakes / attempts)) || 0;
 }
	 
 
 
 // CALCULATE SCORE
 if(Test_Mode() == "test")
 {
  var score = 0;
  
  for(var id in items)
  {
   var item = items[id];
 
   switch(Test_SpeechRecognition_Evaluate(item))
   {
    case "right":
		await Test_Feedback_Right(item["element"], {permanent:true});
		
		score = score + 1;
    break;
   
    case "wrong":
		await Test_Feedback_Wrong(item["element"], {permanent:true});
		
		UI_Element_Find(item["element"], "audio").style.display   = "none";
		UI_Element_Find(item["element"], "picture").style.display = "none";
		UI_Element_Find(item["element"], "text").style.display    = "flex";
		
		UI_Element_Find(item["element"], "text").innerHTML        = UI_Language_String("test", "item answers valid") + " " + item["answers"];
    break;
   } 	  
  }
  
  if(score < 0) score = 0;
  score = score / max;
 }
 
 return score;
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          T E S T                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Test_Load(source)
{
 var test = await Core_Api("Test_Read", {source:source});

 // PROCESS SHEETS
 var sheets = Safe_Get(test, ["sheets"], []);
  
 for(var sheet of sheets)
 {   
  sheet["source"] = source;
 }
 
 test["state"] = {};
 test["index"] = 0;
 
 return test;
}




function Test_Mode(mode)
{
 // SETS THE MODE
 if(mode) 
 {
  Core_State_Set("test", ["mode"], mode); 
 }
 // WITH NO PARAMETERS, RETURNS THE MODE
 else
 {
  return Core_State_Get("test", ["mode"]); 
 }
}





// RETURNS A FUNCTION BASED ON THE TEST SHEET'S TYPE, APPROPRIATELY CAMEL-CASED AND USED AS A NAMESPACE TO IDENTIFY TEST-TYPE-SPECIFIC FUNCTION SETS
function Test_Function(sheet, funcname)
{
 var type      = Safe_Get(sheet, ["info", "type"], "");
 var namespace = String_Capitalize_Camel(type, "-", "");
 var func      = window["Test_" + namespace + "_" + String_Capitalize_Initial(funcname)];
 
 return func || function(){};
}




function Test_Evaluate(sheet, silent)
{
 Core_State_Set("test", ["stage"], "evaluate");
 
 var score = Test_Function(sheet, "evaluate")(sheet, silent);
 Test_SetState(sheet["id"], "evaluation", "score", score);
 
 UI_Element_Find("test-evaluate").style.visibility = "hidden";
}



function Test_Assign(test, display)
{
 test["display"] = display;
}



function Test_Display(test)
{
 Core_State_Set("test", ["current-test"], test);
 
 if(!test["display"]) return;
 
 var index = test["index"] || 0;
 var sheet = Safe_Get(test, ["sheets", index], false);
 
 if(sheet)
 { 
  Test_Sheet_Display(sheet, test["display"]);
 }
}




function Test_Result(test)
{
 var score = 0;
 var data  = [];
 
 for(var sheet of test["sheets"])
 {
  score = score + sheet["result"];
  data.push(
  {
   question: sheet["id"],
   score:    sheet["result"] || 0
  });
 }
 
 score = (score / data.length) || 0;
 
 var result = {score, data};
 return result;
}	



function Test_Disable()
{
 var display = Core_State_Get("test", ["current-test", "display"]);
 if(!display) return;
 
 display.style.pointerEvents = "none";
}



function Test_Enable()
{
 var display = Core_State_Get("test", ["current-test", "display"]);
 if(!display) return;
 
 display.style.pointerEvents = "";
}




// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                       S H E E T S                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



function Test_Sheet_Display(sheet, display)
{ 
 Core_State_Set("test", ["stage"], "display");
 Core_State_Set("test", ["current-sheet"], sheet);
 
 // SANITIZE SHEET 
 var type       = Safe_Get(sheet, ["info", "type"]);
 var config     = Core_Data_Page("test/" + type);
 var sources    = Core_State_Get("editor", ["test", "sources"], {});

 Data_Page_Sanitize(sheet, config, true);
 
 // CALL SHEET'S DISPLAY FUNCTION
 var elements  = Test_Function(sheet, "display")(sheet, display); 

 display.innerHTML = "";
 for(var element of elements) display.appendChild(element);
  
 
 // THIS IS USED MOSTLY TO AVOID AUDIO FEEDBACK FROM REPEATING
 Core_State_Set("test", ["feedback", "last"], "");
  
 // IF SHEET NOT ALREADY EVALUATED, SET UP CONFIRM BUTTON
 /*
 var score = Test_GetState(sheet["id"], "evaluation", "score");
 if(typeof score == "undefined")
 {
  UI_Element_Find("test-evaluate").style.visibility = "visible";
  
  UI_Element_Find("test-evaluate-button").onclick = 
  function()
  {
   var sheet = Core_State_Get("test", ["current-sheet"]);
   Test_Evaluate(sheet, false);
  } 
 }
 else
 // IF SHEET ALREADY EVALUATED, HIDE THE CONFIRMATION BUTTON AND PERFORM A SILENT EVALUATION TO UPDATE IT VISUALLY
 {
  UI_Element_Find("test-evaluate").style.visibility = "hidden";
  Test_Evaluate(sheet, true);
 }
 */
 
 //if(Test_Mode() != "edit") Test_Function(sheet, "update")(sheet); 
}



function Test_Sheet_Current(test)
{
 var sheets = test["sheets"] || [];
 var index  = test["index"]  || 0;
 
 return sheets[index];
}




function Test_Sheet_Last(test)
{
 var sheets = test["sheets"] || [];
 var index  = test["index"]  || 0;
 
 return (index == sheets.length - 1);
}





function Test_Sheet_Next(test, set)
{
 var sheets = test["sheets"] || [];
 var index  = test["index"]  || 0;
 
 index = index + 1;
 if(index >= sheets.length -1) index = sheets.length-1;
 
 test["index"] = index;
 var sheet     = Safe_Get(test, ["sheets", index], false);
 
 if(set) Test_Display(test);
 
 return sheet;
}




function Test_Sheet_Prev(test, set)
{
 var sheets = test["sheets"] || [];
 var index  = test["index"]  || 0;
 
 index = index - 1;
 if(index < 0) index = 0;
 
 test["index"] = index;
 var sheet     = Safe_Get(test, ["sheets", index], false);
 
 if(set) Test_Display(test);
 
 return sheet;
}










// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      E L E M E N T S                                           //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//





function Test_Element_Disable(element)
{
 Document_CSS_UnsetClass(element, "style-pushable");
 Document_CSS_UnsetClass(element, "style-selectable");
 Document_CSS_UnsetClass(element, "style-clickable");
 
 element.onclick = false;
}






function Test_Element_Setup(element, item = {}, options = {}, sheet = {})
{ 
 // MODE
 var mode = Core_State_Get("test", ["mode"]);
 switch(mode)
 {
  case "edit":
	element.style.pointerEvents = "none";
  break;
  
  default:
	item["element"] = element;
  break;
 }
 
 
 // SET RESOURCES PATH
 var source      = options["source"] || "";
 
 
 Document_Element_SetData(element, "source",  source);
 Document_Element_SetObject(element, "item",  item);
 Document_Element_SetObject(element, "sheet", sheet);
 
 
 // LOAD STANDARD COMPONENTS
 var components = {};
 
 
 // TEXT
 var text      = Safe_Get(item, ["text"], false);
 var component = UI_Element_Find(element, "text");
 
 if(text && component)
 {  
  component.innerHTML = text;
  components["text"]  = component; 
 }
 
 
 // PICTURE
 var picture   = Safe_Get(item, ["picture"], false);
 var component = UI_Element_Find(element, "picture");
 
 if(component && picture)
 {
  Document_Image_Load(component, [source + "/" + picture, Resources_URL("images/cover-test.jpg")]);
  components["picture"] = component;
 }
 
 
 
 // PDF
 var pdf       = Safe_Get(item, ["pdf"], false);
 var component = UI_Element_Find(element, "pdf");
 
 if(component && pdf)
 { 
  component.src = source + "/" + pdf + "#toolbar=0&navpanes=0&scrollbar=0"; 
  console.log(component.src);
  components["pdf"] = component;
  
 }
 
 
 
 // AUDIO
 var audio     = Safe_Get(item, ["audio"], false);
 var component = UI_Element_Find(element, "audio"); 
 if(audio && component)
 {
  component.src       = source + "/" + audio;
  components["audio"] = component;
 }
 else
 {
 }
 
 
 
 
 
 // INSTRUCTIONS
 var component    = UI_Element_Find(element, "instructions");
 var instructions = UI_Language_Object(sheet["instructions"] || sheet["info"] || {});
 
 if(instructions && component)
 {  
  component.innerHTML         = instructions;
  components["instructions"]  = component; 
 }


 // GRIP
 if(options["grip"])
 {
  var grip = UI_Element_Find(element, "grip-" + options["grip"]);
  if(grip) grip.style.display = "flex";
 }


 // NOW CONFIGURE ELEMENT LAYOUT ACCORDING TO MULTIMEDIA COMPONENTS & OPTIONS
 var remove     = [];
 

 // IF OPTIONS DICTATE IT, REMOVE
 for(var component of ["picture", "audio", "text", "pdf"])
 {
  if(options[component] === false) remove.push(component);
 }
 
 
 // IF COMPONENT ABSENT FROM THE HTML TEMPLATE, REMOVE
 for(var component of ["picture", "audio", "text", "pdf"])
 {
  if(!components[component]) remove.push(component);
 }
 
 
 // ONE MEDIA ELEMENT ONLY
 var mode = options["mode"] || "";
 switch(mode)
 {
  case "single media":
	  if(components["picture"])
	  {
	   remove.push("audio", "text", "pdf");
	  }
	  else
	  if(components["audio"])
	  {
	   remove.push("picture", "text", "pdf");
	  }
	  else
	  if(components["text"])
	  {
	   remove.push("picture", "audio", "pdf");
	  }
	  else
	  if(components["pdf"])
	  {
	   remove.push("picture", "audio", "text");
	  }
  break;
 }
 
 
 
 var exclusion = options["exclusion"] || "";
 switch(exclusion)
 {
  case "audio excludes text":
	  if(components["audio"])
	  {
	   UI_Element_Find(element, "text").style.display = "none";
	  }
	  else
	  if(components["text"])
	  {
	   UI_Element_Find(element, "audio").style.display = "none";
	  }
  break;
 }
 
 
 for(var component of remove) 
 {
  var div = UI_Element_Find(element, component);
  if(div) div.style.display = "none";
 }
 
 
 // COLLAPSE COMPOUND COMPONENTS IF ALL SUBCOMPONENTS ARE EMPTY
 for(var compound of ["audiotext"])
 {
  var div = UI_Element_Find(element, compound);
  if(div)
  {
   var collapse = false;
   
   switch(compound)
   {
	case "audiotext":
		var collapse = !components["audio"] && !components["text"];
	break;
   }
   
   if(collapse) div.style.display = "none";
  }
 }

 
 return components;
}





function Test_Element_Container(template)
{
 // CREATE ELEMENT
 var element = UI_Element_Create("test/element-container-" + template); 
 
 return element;
}




function Test_Element_Box(template, sheet, item)
{
 // CREATE ELEMENT
 var element = UI_Element_Create("test/element-box-" + template); 
 
 Document_Element_SetObject(element, "item",  item);
 Document_Element_SetObject(element, "sheet", sheet);
 
 return element;
}





function Test_Element_Item(template, item = {}, options = {}, sheet = {})
{
 // CREATE ELEMENT
 var element = UI_Element_Create("test/element-item-" + template, item); 
 Document_Element_SetObject(element, "item", item);
 
 // SETUP ELEMENT MULTIMEDIA COMPONENTS
 Test_Element_Setup(element, item, options, sheet);

 return element;
}






function Test_Element_Question(template, question = {}, options = {}, sheet = {})
{
 // CREATE ELEMENT
 var element = UI_Element_Create("test/element-question-" + template, question); 
 
 // SETUP ELEMENT MULTIMEDIA COMPONENTS
 Test_Element_Setup(element, question, options, sheet);
 
 return element;
}





function Test_Element_Create(template, item = {}, sheet = {})
{
 // CREATE ELEMENT
 var element = UI_Element_Create("test/element-" + template, item); 
 
 Document_Element_SetObject(element, "item",  item);
 Document_Element_SetObject(element, "sheet", sheet);
 
 return element;
}








// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                       F E E D B A C K                                          //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//




async function Test_Feedback_CurrentSheet()
{
 Core_State_Set("test", ["stage"], "feedback");
 
 var sheet  = Core_State_Get("test", ["current-sheet"]); 
 var result = await Test_Function(sheet, "feedback")(sheet);
 
 return result;
}





async function Test_Feedback_Wrong(element, options = {})
{ 
 // AVOID REPEATING AUDIO FEEDBACK 
 if(Core_State_Get("test", ["stage"], "") == "feedback" && Core_State_Get("test", ["feedback", "last"], "") == "wrong")
 {
  options["silent"] = true;
 }
 Core_State_Set("test", ["feedback", "last"], "wrong");
 
 var display     = Core_State_Get("test", ["current-test", "display"]);
 options["lock"] = display;
 
 await Handler_Element_Feedback(element, "bad", options);
}




async function Test_Feedback_Right(element, options = {})
{  
 // AVOID REPEATING AUDIO FEEDBACK 
 if(Core_State_Get("test", ["stage"], "") == "feedback" && Core_State_Get("test", ["feedback", "last"], "") == "right")
 {
  options["silent"] = true;
 }
 Core_State_Set("test", ["feedback", "last"], "right");
 
 var display     = Core_State_Get("test", ["current-test", "display"]);
 options["lock"] = display;
 
 await Handler_Element_Feedback(element, "good", options);
}


// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                      T I M E   O F F                                           //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Timeoff_OnLoad(module, data)
{
 var page = await Timeoff_Display();
 
 UI_Element_Find(module, "module-page").appendChild(page); 
}



async function Timeoff_OnShow(module, data)
{
 // FIRST UPDATE
 Timeoff_Calendar();
}




async function Timeoff_OnUnload()
{
}




async function Timeoff_Display(options)
{
 var display =  UI_Element_Create("timeoff/display");
 Core_State_Set("timeoff", "display", display);
 
 
 // ROLES 
 var roles = ["teacher", "ta"];
 
 
 // ENTITIES FOR WHICH TO SET TIME OFF
 var entities = User_Config("set-timeoff", "myself");
 entities = entities.split(",");
 
 
 var def    = false;
 var select = UI_Element_Find(display, "header-entity");
 for(var entity of entities)
 {
  switch(entity)
  {
   case "myself":
        var text        = UI_Language_String("timeoff", "entity myself").toUpperCase();
		var value       = "";
		var option      = Document_Select_AddOption(select, text, value);
        option.disabled = true;		
		
		var user        = await User_Read(true, {});
        var text        = user["firstname"] + " " + user["lastname"];
		var value       = User_Id();
		var option      = Document_Select_AddOption(select, text, value);
        option.onclick  = false;	
		
		var option      = Document_Select_AddOption(select, "", "");
		option.disabled = true;
		
		if(!def) var def = User_Id();
   break;
   
   case "center":
		var text        = UI_Language_String("timeoff", "entity centers").toUpperCase();
		var value       = "";
		var option      = Document_Select_AddOption(select, text, value);
        option.disabled = true;		
		
        var text        = Centers_Name(User_Center());
		var value       = User_Center();
		var option      = Document_Select_AddOption(select, text, value);
        option.onclick  = false;	
		
		var option      = Document_Select_AddOption(select, "", "");
		option.disabled = true;
   break;
   
   case "teachers":
		var users        = await Core_Api("Users_List_ByCenter", {role:roles, center:[User_Center()], fields:"role,id,firstname,lastname", order:"firstname,lastname"});
	    users            = Array_Catalog_ByField(users, "role");
	 	
		for(var role of roles)
		{
	     var text        = UI_Language_Object(Core_Config(["roles", role], {}), "").toUpperCase();
		 var value       = "";
		 var option      = Document_Select_AddOption(select, text, value);
         option.disabled = true;		
	 	 
		 for(var user of users[role])
		 {
          var text        = user["firstname"] + " " + user["lastname"];
	 	  var value       = user["id"]
		  var option      = Document_Select_AddOption(select, text, value);
          option.onclick  = false;	
		 }
		 
		 var option      = Document_Select_AddOption(select, "", "");
		 option.disabled = true;;
		}
		
		var option      = Document_Select_AddOption(select, "", "");
		option.disabled = true;
   break;
   
   case "global":
   break;
  }
 }
 
 select.value    = def;
 select.onchange = Timeoff_Calendar;
 
 
 // MONTHS
 var thismonth = parseInt(Date_Get(Date_Now(), "month"));
 var select    = UI_Element_Find(display, "header-month");
 for(var month = 1; month <= 12; month++)
 {
  var name   = Date_Month_Name(month).toUpperCase();
  var option = Document_Select_AddOption(select, name, month);
 }
 select.value    = thismonth;
 select.onchange = Timeoff_Calendar;
 
 
 // YEARS
 var thisyear = parseInt(Date_Get(Date_Now(), "year"));
 var select   = UI_Element_Find(display, "header-year");
 for(var year = thisyear - 2; year <= thisyear + 2; year++)
 {
  var option = Document_Select_AddOption(select, year, year);
 }
 select.value    = thisyear;
 select.onchange = Timeoff_Calendar;
 
 
 await Timeoff_Calendar();
 
 return display;
}





// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                   R E A D  /  W R I T E                                        //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Timeoff_Read(entity)
{
 if(entity == "global") 
 {
  var type = "global"
  var source = "timeoff";
 }
 else 
 {
  // NUMERICAL = USER
  if(!isNaN(entity))
  {
   var type = "user";
   var source = "users/" + entity + "/" + "timeoff";
  }
  else
  // NON NUMERICAL = CENTER
  {
   var type = "center"
   var source = "centers/" + entity + "/" + "timeoff";
  }
 }
 
 Core_State_Set("timeoff", "source", source);
 Core_State_Set("timeoff","timeoff-type",type);
 Core_State_Set("timeoff","timeoff-entity",entity);
 var data = await Core_Api("Timeoff_Read", {type,value:entity});
 
 return data;
}




async function Timeoff_Item_Update(event)
{     
 var source  = Core_State_Get("timeoff", "source");
 
 var element = event.currentTarget;
 element     = Document_Element_FindParent(element, "uid", "item");
 
 var data    = Core_State_Get("timeoff", "current-data");
 var id      = Document_Element_GetData(element,   "id");
 var item    = Document_Element_GetObject(element, "item");
 
 // UPDATE ITEM LOCALLY
 item["notes"]    = UI_Element_Find(element, "notes").value;
 

 // STORE
 await Core_Api("Timeoff_Update_Notes", {id:item["id"], notes:item["notes"]}); 
}





async function Timeoff_Item_Delete(event)
{     
 var source  = Core_State_Get("timeoff", "source");
 
 var element = event.currentTarget;
 element     = Document_Element_FindParent(element, "uid", "item");
 
 var data    = Core_State_Get("timeoff", "current-data");
 var id      = Document_Element_GetData(element, "id");
 var item    = Document_Element_GetObject(element, "item");
 
 
 // DELETE
 Array_Element_DeleteAt(data, id);
 await Core_Api("Timeoff_Delete", {id:item["id"]}); 
 

 // REDRAW CALENDAR
 var cell = Core_State_Get("timeoff", "current-cell", cell);
 var day  = Core_State_Get("timeoff", "current-day",  day);
 
 await Timeoff_Calendar(false);
 Timeoff_List(cell, day);
}






// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                             U I                                                //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Timeoff_Calendar(reload)
{
 var display = Core_State_Get("timeoff", "display");
 
 UI_Element_Find(display, "timeoff-list-panel").style.visibility = "hidden";
 
 var option = Document_Select_SelectedOption(UI_Element_Find(display, "header-entity"));
 var entity = option.value;
  
 var year   = UI_Element_Find(display, "header-year").value;
 var month  = UI_Element_Find(display, "header-month").value;
 
 // LOAD DATA?
 if(reload || (Core_State_Get("timeoff", "current-entity") != entity))
 { 
  var data = await Timeoff_Read(entity);
  
  Core_State_Set("timeoff", "current-data",   data);
  Core_State_Set("timeoff", "current-entity", entity);
 }
 else
 {
  var data = Core_State_Get("timeoff", "current-data", {});
 }
 
 // CREATE CALENDAR
 var calendar = UI_Calendar(month, year, data, {emptyactive:true, onclick:Timeoff_List,
 activeday:
 function(day, data)
 {
  var items = Timeoff_Day(data, day);
  return (items.length > 0);
 }});
 
 
 // DRAW CALENDAR
 var container       = UI_Element_Find(display, "timeoff-calendar");
 container.innerHTML = "";
 
 // EMPTY ITEMS LIST
 Timeoff_List(false);
 
 container.appendChild(calendar);
}




async function Timeoff_Add(event)
{
 var type = Core_State_Get("timeoff","timeoff-type");
 var value = Core_State_Get("timeoff","timeoff-entity");
 var cell   = Core_State_Get("timeoff", "current-cell", cell);
 var day    = Core_State_Get("timeoff", "current-day",  day);
   
   
 // SET UP POPUP CONTENT
 var content = UI_Element_Create("timeoff/popup-day-set", {}, {language:"timeoff/popups"});
  
 // UPDATE TOTAL
 var showtotal =
 function()
 {
  var time_from  = UI_Element_Find(content, "time_from").value;
  var time_to    = UI_Element_Find(content, "time_to").value;
    
  var date_from  = day + String_Filter_AllowDigits(time_from);
  var date_to    = day + String_Filter_AllowDigits(time_to);
	
  UI_Element_Find(content, "time_total").value = Timeoff_Duration_Text(date_from, date_to); 
 }
  
 
 // TIME_FROM INPUT
 var element   = UI_Element_Find(content, "time_from"); 
 element.value = Core_Config(["operations", "lessons", "first"]);
 element.onchange = showtotal; 
   
 // TIME_TO INPUT
 var element   = UI_Element_Find(content, "time_to"); 
 element.value = Core_Config(["operations", "lessons", "last"]);
 element.onchange = showtotal; 
  
 showtotal();
  
 var buttons = [];
 
 // "SET" BUTTON
 var text    = UI_Language_String("timeoff/popups", "day set button");
 var onclick =
 async function(popup)
 {
  var time_from  = UI_Element_Find(content, "time_from").value;
  var time_to    = UI_Element_Find(content, "time_to").value;
  
  var date_from  = day + String_Filter_AllowDigits(time_from);
  var date_to    = day + String_Filter_AllowDigits(time_to);
  
  var item       = {date_from, date_to};

  await Core_Api("Timeoff_Add", {type, value, item});   
  
  await Timeoff_Calendar(true);
  Timeoff_List(cell, day);
  
  UI_Popup_Close(popup);
 }
 
 buttons.push({text, onclick});
 
  
 // OPEN POPUP
 var picture = Resources_URL("images/cover-logout.png");
 var date    = Date_Format(day, UI_Language_Current(true), "date-short-weekday-noyear");
 var title   = UI_Language_String("timeoff/popups", "day set title", {date}); 
  
 await UI_Popup_Create({content, title, picture}, buttons, "flexi", {escape:true, open:true});  
}




function Timeoff_List(cell, day)
{
 var display = Core_State_Get("timeoff", "display");
 
 if(!cell)
 {
  UI_Element_Find(display, "timeoff-date").innerHTML = "";
  UI_Element_Find(display, "timeoff-list").innerHTML = "";	
  
  return;
 }	 
 
 
 Core_State_Set("timeoff", "current-cell", cell);
 Core_State_Set("timeoff", "current-day",  day);
 
 var data  = Core_State_Get("timeoff", "current-data");
 var items = Timeoff_Day(data, day);

 UI_Element_Find(display, "timeoff-date").innerHTML = Date_Format(day, UI_Language_Current(true), "date-long-weekday"); 
 
 var container       = UI_Element_Find(display, "timeoff-list");
 container.innerHTML = "";
 
 // EXISTING ITEMS
 for(var item of items)
 {
  var id = data.indexOf(item);
  
  var time_from = Date_Portion(item["date_from"], "time-timecode");
  var time_to   = Date_Portion(item["date_to"],   "time-timecode");
  var duration  = Timeoff_Duration_Text(item["date_from"], item["date_to"]);
  var notes     = item["notes"] || "";
  
  var element = UI_Element_Create("timeoff/timeoff-item", {time_from, time_to, duration});
  
  Document_Element_SetData(element,   "id",   id);
  Document_Element_SetObject(element, "item", item);
  
  UI_Element_Find(element, "delete").onclick = Timeoff_Item_Delete;
  
  var input      = UI_Element_Find(element, "notes");
  input.value    = notes;
  input.onchange = Timeoff_Item_Update;
  
  container.appendChild(element);
 }
 
  // ADD NEW ITEM BUTTON
 var element     = UI_Element_Create("timeoff/timeoff-add");
 element.onclick = Timeoff_Add; 
 container.appendChild(element);
 
 UI_Element_Find(display, "timeoff-list-panel").style.visibility = "visible";
}







// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                        U T I L S                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Timeoff_Check(date_from, date_to, data)
{ 
 // CHECK INTERVAL?
 if(date_from && date_to)
 {
  for(var item of data)
  {
   var overlap = Numbers_Range_Intersect({from:date_from, to:date_to}, {from:item["date_from"], to:item["date_to"]});
   if(overlap) return true;
  }
 }
 else
 // CHECK SINGLE TIME ONLY?
 if(date_from)
 {
  var overlap = Numbers_Within(date_from, {from:item["date_from"], to:item["date_to"]});
  if(overlap) return true;
 }
 
 return false;
}



function Timeoff_Day(timeoff, day)
{
 var items = [];
 day       = Date_Portion(day, "date-only");
 
 for(var item of timeoff)
 {
  if(Date_Portion(item["date_from"], "date-only") == day)
  {
   items.push(item);
  }
 }
 
 return items;
}




function Timeoff_Duration_Text(date_from, date_to)
{
 var hours = Date_Distance(date_from, date_to, "hours");
     
 if(hours >= 8) var text = UI_Language_String("timeoff", "period fullday");
 else
 if(hours >= 4) var text = UI_Language_String("timeoff", "period halfday");
 else           
 var text = UI_Language_String("timeoff", "period hours", {hours});

 return text;
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                     T I M E T A B L E                                          //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//



// GLOBALS
// WE USE GLOBALS HERE INSTEAD OF CORE_STATE BECAUSE COMPUTATION COULD GET INTENSE WITH HUNDREDS OF TIMETABLE SLOTS ON SCREEN
var TIMETABLE_HOUR_START,  
    TIMETABLE_HOUR_END,
	TIMETABLE_TIME_START,
	TIMETABLE_TIME_END,
	TIMETABLE_MIN_TIME,
	TIMETABLE_MIN_HEIGHT,
	TIMETABLE_SLOT_MARGIN,
	TIMETABLE_DAY_SLOTS;
	


async function Timetable_OnLoad(module, data)
{  
 Core_State_Set("timetable", "module", module);
 
 // 0. SET CONFIG GLOBALS
 TIMETABLE_HOUR_START   = Core_Config(["operations", "timetable", "time-opening"], "08:30");
 TIMETABLE_HOUR_END     = Core_Config(["operations", "timetable", "time-closing"], "22:30");
 
 TIMETABLE_TIME_START   = Time_To_Minutes(TIMETABLE_HOUR_START); 
 TIMETABLE_TIME_END     = Time_To_Minutes(TIMETABLE_HOUR_END); 

 TIMETABLE_MIN_TIME    = parseInt(Core_Config(["operations", "timetable", "time-segment"], "30")); // MINUTES
 TIMETABLE_MIN_HEIGHT  = 32;                                                                       // PIXELS FOR A MIN_TIME MINUTES SLOT
 
 TIMETABLE_SLOT_MARGIN = 4;

 TIMETABLE_DAY_SLOTS   = (TIMETABLE_TIME_END - TIMETABLE_TIME_START) / TIMETABLE_MIN_TIME;
 
 
  
 // 1. VIEW

 // SET BY ANOTHER MODULE?  
 var view = Core_State_Get("timetable", "view", false);
 
 // SET BY URL?
 if(!view)
 {
  var view = Client_Location_Parameter("view");
 }
 
 
 // STILL NO VIEW? DEFAULT TO CENTER-TEACHERS
 if(!view) var view = "center-teachers"; 
 
 Core_State_Set("timetable", "view", view);
 
 
 
 // 2. DATE
 
 // SET BY ANOTHER MODULE? 
 var date = Core_State_Get("timetable", "date", false);
 
 // SET BY URL?
 if(!date)
 {
  var date = Client_Location_Parameter("date");
 }
 
 // STILL NO DATE? SET IT TO TODAY
 if(!date) var date = Date_Now();
 
 Timetable_Set_Date(date);
 
 
 
 
 // 3. CENTER
 
 // SET BY ANOTHER MODULE? 
 var center = Core_State_Get("timetable", "center", false);
 
 // SET BY URL?
 if(!center)
 {
  var center = Client_Location_Parameter("center");
 }
 
 // STILL NO CENTER? SET IT TO USER'S HOME CENTER
 if(!center) var center = User_Center();
 
 Core_State_Set("timetable", "center", center);
 
 
 // 3b. ROOM
 
 // SET BY ANOTHER MODULE? 
 var room = Core_State_Get("timetable", "room", false);
 
 // SET BY URL?
 if(!room)
 {
  var room = Client_Location_Parameter("room");
 }
 
 // STILL NO CENTER? SET IT TO USER'S HOME CENTER
 if(!room) var room = User_Center();
 
 Core_State_Set("timetable", "room", room);
 
 
 
 // 4. USER
 
 // SET BY ANOTHER MODULE? 
 var user = Core_State_Get("timetable", "user", false);
 
 // SET BY URL?
 if(!user)
 {
  var user = Client_Location_Parameter("user");
 }
 
 // STILL NO USER? SET IT TO USER'S HOME CENTER
 if(!user) var user = User_Id();
 
 Core_State_Set("timetable", "user", user);
 
 
 
 
 // GET DATA
 Core_State_Set("timetable", "center-last", false);
 
 await Timetable_Function("Data");
}



async function Timetable_Header_SelectCenter()
{
 var select = UI_Element_Find("timetable-center");
 var center = select.value;
 
 Core_State_Set("timetable", "center", center);
 
 // RELOAD ROOMS, TEACHERS, AND COURSES
 await Timetable_Data_Center("week");
 
 // UPDATE ENTITIES (DISPLAYING THE RIGHT ROOMS AND TEACHERS)
 await Timetable_Header_UpdateEntities("teacher:all");
 
 // UPDATE TIMETABLE
 await Timetable_Update();
}



async function Timetable_Header_UpdateEntities(selected)
{
 var module = Core_State_Get("timetable", "module");

 var center = Core_State_Get("timetable", "center", User_Center());  
 var type   = UI_Element_Find(module, "timetable-type").value;
 console.log(type);

 
 var select = UI_Element_Find("timetable-entity");
 Document_Select_Clear(select);
 
 switch(type)
 {
  case "teachers":
	// ALL TEACHERS
	Document_Select_AddOption(select, UI_Language_String("timetable", "header all"), "teacher:all");
 
    // EMPTY ROW
    Document_Select_AddOption(select, "", "").disabled = true;
 
	// TEACHERS
	var teachers = Core_State_Get("timetable", "teachers", []);
	for(var teacher of teachers)
	{
	 Document_Select_AddOption(select, [teacher["firstname"], teacher["lastname"]].join(" "), "teacher:" + teacher["id"]); 
	}
	
	var selected = "teacher:all";
  break;
 
 
  case "rooms":
	// ALL ROOMS
	var option = Document_Select_AddOption(select, UI_Language_String("timetable", "header all"), "room:all");
 
    // EMPTY ROW
    Document_Select_AddOption(select, "", "").disabled = true;
  
	// ROOMS
	var rooms = Core_State_Get("timetable", "rooms", {});
	for(var id in rooms)
	{
	 Document_Select_AddOption(select, id, "room:" + id); 
	}
	
	var selected = "room:all";
  break;
  
  
  case "courses":
	// EMPTY ROW
    Document_Select_AddOption(select, "", "").disabled = true;
  
	// COURSES
	var courses = Core_State_Get("timetable", "courses", {});
	for(var course of courses)
	{
     var text = course["name"] || course["id"];
	 Document_Select_AddOption(select, text, "course:" + course["id"]); 
	}
	
	var selected = "course:";
  break;
 }
 
 
 // ON ENTITY SELECTION
 select.onchange = 
 async function()
 {
  var select = UI_Element_Find("timetable-entity");
  var entity = select.value.split(":");
  console.log(entity);
  
  switch(entity[0])
  {
   case "teacher":
	switch(entity[1])
	{
     case "all":
		Core_State_Set("timetable", "view", "center-teachers");
		
		await Timetable_Update();
	 break;
	 
	 default:
		Core_State_Set("timetable", "view", "teacher-week");
		Core_State_Set("timetable", "user", entity[1]); 
		
		await Timetable_Update();
	 break;
	}
   break;
   
   case "room":
	switch(entity[1])
	{
     case "all":
		Core_State_Set("timetable", "view", "center-rooms");
		
		await Timetable_Update();
	 break;
	 
	 default:
		Core_State_Set("timetable", "view", "room-week");
		Core_State_Set("timetable", "room", entity[1]); 
		
		await Timetable_Update();
	 break;
	}
   break;
   
   case "course":
	switch(entity[1])
	{
     case "all":
		Core_State_Set("timetable", "view", "center-courses");
		
		await Timetable_Update();
	 break;
	 
	 default:
		Core_State_Set("timetable", "view", "course-week");
		Core_State_Set("timetable", "course", entity[1]); 
		
		await Timetable_Update();
	 break;
	}
   break;
  }
 }
 
 
 if(selected) 
 {
  console.log(selected);
  select.value = selected;
  select.onchange();
 }
}




async function Timetable_OnShow(module, data)
{
 // HEADER: AVAILABLE CENTERS
 var centers = Centers_Available();
 var center  = Core_State_Get("timetable", "center", User_Center());
 var select  = UI_Element_Find(module, "timetable-center");
 for(var item of centers)
 {
  var option   = new Option();
  option.value = item["id"];
  option.text  = item["name"];
  
  if(item["id"] == center) option.selected = true;
  
  select.appendChild(option);
 }
 
 select.onchange = Timetable_Header_SelectCenter;
 
 
 // HEADER: ENTITY TYPES
 var select = UI_Element_Find(module, "timetable-type");
 for(var item of ["teachers", "rooms", "courses"])
 { 
  Document_Select_AddOption(select, UI_Language_String("timetable", "header " + item) , item);
 }
 select.value    = "teachers";
 select.onchange = 
 function()
 {
  Timetable_Header_UpdateEntities();
 }
 
 Timetable_Header_UpdateEntities();
 
 
 var durations = UI_Menu_FromObject("durations", Core_Config(["lesson-durations"]), false, Timetable_Menu_New);
 
 var menu = UI_Menu_Create("slot-menu", 
 // MENU ITEMS
 {
  new:
  {
   icon:    "square-plus", 
   text:    UI_Language_String("timetable/menus", "lesson new"),
   state:   "enabled",
   tag:     "new",
   func:    false,
   submenu: durations
  },
      
  copy:
  {
   icon:  "clipboard", 
   text:  UI_Language_String("timetable/menus", "lesson copy"),
   state: "enabled",
   tag:   "modify",
   func:  Timetable_Menu_Copy
  },
  
  paste:
  {
   icon:  "paste", 
   text:  UI_Language_String("timetable/menus", "lesson paste"),
   state: "enabled",
   tag:   "modify",
   func:  Timetable_Menu_Paste
  },
  
  delete:
  {
   icon:  "trash-can", 
   text:  UI_Language_String("timetable/menus", "lesson delete"),
   state: "enabled",
   tag:   "modify",
   func:  Timetable_Menu_Delete
  }
 },
 {
  onshow: Timetable_Menu_Show
 });
 
 Core_State_Set("timetable", "slot-menu", menu);
 
 
 
 // SET BY USER ROLE
 switch(User_Config("operate-on-timetables"))
 {
  case "self":
	// DISABLE CENTER AND TEACHER SELECTOR AND SELECT VIEW MODE = TEACHER-WEEK, TEACHER = MYSELF
	Core_State_Set("timetable", "view", "teacher-week");
	
	var select           = UI_Element_Find(module, "timetable-center");
	//select.style.display = "none";
  select.disabled = true;
	select.value         = User_Center();
	
	var select           = UI_Element_Find(module, "timetable-type");
	//select.style.display = "none";
  select.disabled = true;
	select.value         = "teachers";
	
	var select           = UI_Element_Find(module, "timetable-entity");
	//select.style.display = "none";
  select.disabled = true;
	select.value         = "teacher:" + User_Id();
  await Timetable_Update();
  break;
 }

	
 // DISPLAY
 Timetable_Display();
}




async function Timetable_OnUnload()
{
}








// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          C O R E                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Timetable_Function(name)
{
 var view = Core_State_Get("timetable", "view");
 view     = view.split("-");
 name     = "Timetable_" + String_Capitalize_Initial(view[0]) + String_Capitalize_Initial(view[1]) + "_" + name;
 f        = Safe_Function(name);
 
 console.log(name);
 return await f();
}



async function Timetable_Update()
{
 await Timetable_Function("Data");
 Core_State_Set("timetable", "force-reload", false);
 

 await Timetable_Display();	
}



async function Timetable_Set_Date(date)
{
 Core_State_Set("timetable", "date", date);
 
 var day = Date_Portion(date, "date-only");
 Core_State_Set("timetable", "day", date);
 
 var range =
 { 
  from: day + "0000",
  to:   day + "2359"
 }
 Core_State_Set("timetable", "day-range", range);
 
 var week = Date_Portion(Date_Week_FirstDay(date), "date-only");
 Core_State_Set("timetable", "week", week);
 
 var range =
 { 
  from: week + "0000",
  to:   Date_Portion(Date_Add_Days(day, 7), "date-only") + "2359"
 }
 Core_State_Set("timetable", "week-range", range);
}





async function Timetable_Display()
{
 var date     = Core_State_Get("timetable", "date");
 var view     = Core_State_Get("timetable", "view");
 var classes  = Core_State_Get("timetable", "classes");
 var teachers = Core_State_Get("timetable", "teachers");
  
 
 // CREATE AND SETUP TIMETABLE
 var timetable = UI_Element_Create("timetable/timetable");
 Core_State_Set("timetable", "display", timetable);
 
 UI_Element_Find(timetable, "nav-goto").onclick   = Timetable_Navigation_GoTo;
 UI_Element_Find(timetable, "nav-search").onclick = Timetable_Navigation_Search;
 UI_Element_Find(timetable, "nav-prev").onclick   = Timetable_Navigation_Prev;
 UI_Element_Find(timetable, "nav-next").onclick   = Timetable_Navigation_Next;
 UI_Element_Find(timetable, "nav-update").onclick = Timetable_Update;
 
  
 // SYNC HEADERS AND DATA SCROLLING
 var timetable_slots   = UI_Element_Find(timetable, "slots");
 var timetable_time    = UI_Element_Find(timetable, "time"); 
 var timetable_headers = UI_Element_Find(timetable, "headers");
 
 timetable_slots.onscroll =
 function()
 {
  timetable_time.scrollTop     = timetable_slots.scrollTop;
  timetable_headers.scrollLeft = timetable_slots.scrollLeft;
 }
 
 

 // FIRST COLUMN (HEADER): DISPLAY HOURS
 var column  = UI_Element_Find(timetable, "time");
 
 var time_scan = TIMETABLE_TIME_START;
 while(time_scan < TIMETABLE_TIME_END)
 {
  var time          = Time_From_Minutes(time_scan);
  var slot          = UI_Element_Create("timetable/slot-time", {time});
  slot.style.height = TIMETABLE_MIN_HEIGHT + "px";
  
  column.appendChild(slot);
  
  time_scan = time_scan + TIMETABLE_MIN_TIME; 
 }
 

 // DISPLAY CLASSES COLUMNS
 await Timetable_Function("Display");
 
 
 // RENDER
 var container       = UI_Element_Find("module-page");
 container.innerHTML = "";
 container.appendChild(timetable);
 
 
 
 // HIGHLIGHT CREATED CLASS IF ANY
 var id = Core_State_Get("timetable", "class-created");
 if(id)
 {
  var slot = UI_Element_Find(timetable, "class-" + id);
  Document_Element_Animate(slot, "zoomIn 0.75s 1");  
  
  Core_State_Set("timetable", "class-created", false);
 }
 
 // HIGHLIGHT UPDATED CLASS IF ANY
 var id = Core_State_Get("timetable", "class-updated");
 if(id)
 {
  var slot = UI_Element_Find(timetable, "class-" + id);
  Document_Element_Animate(slot, "flash 1.5s 1");  
  
  Core_State_Set("timetable", "class-updated", false);
 }
 
}




// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                            U I                                                 //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

function Timetable_Slot_Display(template = "open", data = {}, display = {}, onclick)
{
 var slot   = UI_Element_Create("timetable/slot-" + template);
 var config = {};
 
 var type   = data["type"];
 if(type)
 {
  var config = Core_Config(["lesson-types", type], {});
 }
 
 if(config["color"]) slot.style.backgroundColor = config["color"];
 
 
 // FIELDS THAT WILL BE ALWAYS DISPLAYED
 display["id"]    = true;
 
 // SCAN FIELDS
 for(var field in display)
 {
  var element = UI_Element_Find(slot, field);
  if(element)
  {
   if(!display[field]) element.style.display = "none";
   else
   switch(field)
   {
    case "id":
		if(data["online"] == 1) var online = "<li class = 'fa fa-globe'></li>" + " "; else var online = "";
			
		if(data["seats_taken"] >= data["seats_total"]) element.style.backgroundColor = "var(--color-alert)";
		else
		if(data["seats_taken"] == data["seats_total"] -1) element.style.backgroundColor = "var(--color-soso)";	
		
		Document_Element_SetData(slot, "uid", "class-" + data["id"]);
		Document_Element_SetData(element, "classid", data["id"]);
		element.innerHTML = online + "#" + data["id"];
		
		// CLICKING ON THE ID COPIES IT TO CLIPBOARD
		element.onclick = 
		function(event)
		{
	     var element = event.currentTarget;		
	     event.stopPropagation();
		 
		 var id = Document_Element_GetData(element, "classid");
	     navigator.clipboard.writeText(id);
		 
		 Document_Element_Animate(element, "fadeIn 1s");
		}
    break;
    
    case "teacher":
	    // IF NO TEACHER ID, DISPLAY "NO TEACHER YET"
		if(!data["teacher_id"])
		{
	     var name = UI_Language_String("timetable/slot", "teacher missing");
		}
		else
		{
		 // FIND TEACHER ID IN CURRENTLY LOADED TEACHERS. IF NOT AVAILABLE, USE GENERIC STRING
		 var name     = UI_Language_String("timetable/slot", "teacher unknown");
		
		 var teachers = Core_State_Get("timetable", "teachers");
		 for(var teacher of teachers)
		 {
	      if(teacher["id"] == data["teacher_id"])
		  {
	       var name = [teacher["firstname"] || "", teacher["lastname"] || ""].join(" ").trim("");
		   break;
		  }
		 }
		}
		
		element.innerHTML = "<li class = 'fa fa-person-chalkboard'></li>" + " " + name;
    break;
	
	case "center":
	    var name = Centers_Name(data["center_id"]);
	    if(!name) name = UI_Language_String("timetable/slot", "center unknown");
		
		element.innerHTML = "<li class = 'fa-solid fa-building'></li>" + " " + name;
	break;
   
    case "room":
	    if(!data["classroom_id"])
		{
	     var name = UI_Language_String("timetable/slot", "room TBD");
		}
		else
		{
	     var name = data["classroom_id"];
		}
	   
		element.innerHTML = "<li class = 'fa fa-chalkboard'></li>" + " " + name;
    break;
   
    case "lesson":
		element.innerHTML = "<li class = 'fa fa-book'></li>" + " " + (data["lesson_id"] || "") || "";
    break;

    default:
	 element.innerHTML = data[field] || "";
    break;
   }
  }
  
 }
 
 
 // SPECIAL CASE: IF ONLY ONE LOCATION ELEMENT IS DISPLAYED, REMOVE GAPS
 if(!display["center"] || !display["room"])
 {
  var element = UI_Element_Find(slot, "location");
  if(element) Document_CSS_PurgeClasses(element, "gap-");
 }
 
 var time     = Time_To_Minutes(Date_Portion(data["date_start"], "time-only")); 
 var position = (time - TIMETABLE_TIME_START) / TIMETABLE_MIN_TIME;
 var size     = data["duration"] / TIMETABLE_MIN_TIME;
	   
 slot.style.position = "absolute";
 slot.style.left     = (TIMETABLE_SLOT_MARGIN / 2) + "px";
 slot.style.width    = "calc(100% - " + TIMETABLE_SLOT_MARGIN + "px)";
 slot.style.top      = ((position * TIMETABLE_MIN_HEIGHT) + (TIMETABLE_SLOT_MARGIN/2)) + "px";
 slot.style.height   = ((size     * TIMETABLE_MIN_HEIGHT) - TIMETABLE_SLOT_MARGIN) + "px";

 Document_Element_SetData(slot,   "type", template);
 Document_Element_SetObject(slot, "data", data);
 slot.onclick = onclick;

 var menu = Core_State_Get("timetable", "slot-menu");
 UI_Menu_Assign(slot, menu, {direction:"bottom right"}); 

 return slot;
}




async function Timetable_Slot_View(event)
{
 var element = event.currentTarget;
 var data    = Document_Element_GetObject(element, "data");

 // PRESERVE SCROLL POSITION
 Timetable_View_Save();

 // DISPLAY POPUP
 if(User_Config("operate-on-timetables") == "self") await Class_Display_NoEdit(data["id"]);
 else
 await Class_Display(data["id"]);
 
 // IF MODIFIED, RELOAD AND DISPLAY CLASS
 if(Core_State_Get("classes", ["display", "updated"]))
 {
  // RELOAD
  var updated = await Core_Api("Classes_List_ById", {ids:[data["id"]], fields:"id,type,date_start,online,duration,teacher_id,ta1_id,ta2_id,ta3_id,center_id,classroom_id,lesson_id,seats_total,seats_taken,course_id"});
  updated     = updated[0];
  
  // FIND AND REPLACE
  var classes = Core_State_Get("timetable", "classes");
  var i       = Timetable_Data_GetClass(data["id"], "index");
  classes[i]  = updated;
 
  // DISPLAY
  Core_State_Set("timetable", "class-updated", data["id"]);
  await Timetable_Display();
  
  // RESTORE SCROLL POSITION
  Timetable_View_Restore();
 }
}





function Timetable_Column_Fill(column, data = {})
{
 var time_scan = TIMETABLE_TIME_START;
 
 while(time_scan < TIMETABLE_TIME_END) 
 {
  var slot_data           = Object.assign({}, data);
  
  var date                = slot_data["date"];
  slot_data["date_start"] = date + Time_From_Minutes(time_scan, "");
  slot_data["duration"]   = TIMETABLE_MIN_TIME;
  var slot                = Timetable_Slot_Display("empty", slot_data, []);
  slot.style.zIndex       = 0;
	
  column.appendChild(slot); 
  time_scan = time_scan + TIMETABLE_MIN_TIME;
 }  
 
}


function Timetable_View_Save()
{
 // PRESERVE SCROLL POSITION
 var slots  = UI_Element_Find("slots");
 var scroll = {top:slots.scrollTop, left:slots.scrollLeft};
 
 Core_State_Set("timetable", ["view-scroll"], scroll);
}



function Timetable_View_Restore()
{
 // RESTORE SCROLL POSITION
 var scroll = Core_State_Get("timetable", ["view-scroll"], {});
 
 var slots        = UI_Element_Find("slots");
 slots.scrollTop  = scroll["top"];
 slots.scrollLeft = scroll["left"];
}







// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                    N A V I G A T I O N                                         //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Timetable_Navigation_Prev(event)
{
 Timetable_View_Save();
 
 var view = Core_State_Get("timetable", "view-range");
 
 switch(view)
 {
  case "day":
	
	var date = Core_State_Get("timetable", "day");
	date     = Date_Add_Days(date, -1);
	
	Timetable_Set_Date(date);
	
	await Timetable_Update();	
  break;
  
  case "week":
	
	var date = Core_State_Get("timetable", "week");
	date     = Date_Add_Days(date, -7);
	
	Timetable_Set_Date(date);
	
	await Timetable_Update();	
  break;
 }
 
 Timetable_View_Restore();
}



async function Timetable_Navigation_Next(event)
{
 Timetable_View_Save();
 
 var view = Core_State_Get("timetable", "view-range");
 
 switch(view)
 {
  case "day":
	
	var date = Core_State_Get("timetable", "day");
	date     = Date_Add_Days(date, 1);
	
	Timetable_Set_Date(date);
	
	await Timetable_Update();
  break;
  
  case "week":
	
	var date = Core_State_Get("timetable", "week");
	date     = Date_Add_Days(date, 7);
	
	Timetable_Set_Date(date);
	
	await Timetable_Update();	
  break;
 }
 
 Timetable_View_Restore();
}




async function Timetable_Navigation_GoTo(event)
{
 var element  = event.currentTarget;
 var position = Document_Element_Corner(element, "center");
 
 var date = await Client_Picker("date", position);
 if(date)
 {
  Timetable_View_Save();
  
  date = Date_From_Input(date);
  
  Timetable_Set_Date(date);
  await Timetable_Update();	
  
  Timetable_View_Restore();
 }

}




async function Timetable_Navigation_Search(event)
{
 var element = event.currentTarget;
}





// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          D A T A                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Timetable_Data_Center(range = "day")
{
 // DETERMINE TIME PERIOD
 var day       = Core_State_Get("timetable", "day");
 var week      = Core_State_Get("timetable", "week");
 var center    = Core_State_Get("timetable", "center");
 
 var range     = Core_State_Get("timetable", range + "-range");
 var date_from = range["from"];
 var date_to   = range["to"];
 
 
 // LOAD CLASSES FROM GIVEN TIME PERIOD / CENTER
 var classes = await Core_Api("Classes_List_ByCenter", 
 {
  center_id:center, 
  date_from, 
  date_to, 
  fields:"id,type,date_start,online,duration,teacher_id,ta1_id,ta2_id,ta3_id,classroom_id,lesson_id,seats_total,seats_taken,course_id", 
 });
 
 
 Core_State_Set("timetable", "classes", classes);
 
 
 // IF CENTER HAS CHANGED, WE NEED TO RELOAD SOME CENTER-RELATED DATA
 if(Core_State_Get("timetable", "force-reload") || !Core_State_Get("timetable", "center-last") || (Core_State_Get("timetable", "center-last") != Core_State_Get("timetable", "center")))
 {
  // LOAD ALL TEACHERS FOR THIS CENTER
  var teachers = await Core_Api("Users_List_ByCenter", {center, role:"teacher", fields:"id,firstname,lastname", order:"firstname,lastname"});
  Core_State_Set("timetable", "teachers", teachers); 
 
  // LOAD ROOMS FOR THIS CENTER
  var rooms = await Core_Api("Center_Rooms", {center});
  Core_State_Set("timetable", "rooms", rooms); 
  
  // LOAD COURSES FOR THIS CENTER
  var courses = await Core_Api("Courses_Ongoing", {centers:[center]});
  Core_State_Set("timetable", "courses", courses); 
 }
 
 
 // SET CENTER
 Core_State_Set("timetable", "center-last", center);
}




async function Timetable_Data_User(user, range = "day")
{
 Core_State_Set("timetable", "user", user);
 
 
 // DETERMINE TIME PERIOD
 var day       = Core_State_Get("timetable", "day");
 var week      = Core_State_Get("timetable", "week");
 
 var range     = Core_State_Get("timetable", range + "-range");
 var date_from = range["from"];
 var date_to   = range["to"];
 
 
 // LOAD CLASSES FROM GIVEN TIME PERIOD / CENTER
 var classes = await Core_Api("Classes_List_ByTeacher", 
 {
  teacher_id:user, 
  date_from, 
  date_to, 
  fields:"id,type,date_start,duration,online,teacher_id,ta1_id,ta2_id,ta3_id,center_id,classroom_id,lesson_id,seats_total,seats_taken,course_id", 
 });
 
 
 Core_State_Set("timetable", "classes", classes);
}




async function Timetable_Data_Room(center, room, range = "day")
{
 Core_State_Set("timetable", "center", center);
 Core_State_Set("timetable", "room", room);
 
 
 // DETERMINE TIME PERIOD
 var day       = Core_State_Get("timetable", "day");
 var week      = Core_State_Get("timetable", "week");
 
 var range     = Core_State_Get("timetable", range + "-range");
 var date_from = range["from"];
 var date_to   = range["to"];
 
 
 // LOAD CLASSES FROM GIVEN TIME PERIOD / CENTER
 var classes = await Core_Api("Classes_List_ByRoom", 
 {
  center_id:center,
  classroom_id:room, 
  date_from, 
  date_to, 
  fields:"id,type,date_start,online,duration,teacher_id,ta1_id,ta2_id,ta3_id,classroom_id,lesson_id,seats_total,seats_taken,course_id", 
 });
 
 Core_State_Set("timetable", "classes", classes);
}




async function Timetable_Data_Course(course, range = "week")
{
 Core_State_Set("timetable", "course", course);
 
 
 // DETERMINE TIME PERIOD
 var day       = Core_State_Get("timetable", "day");
 var week      = Core_State_Get("timetable", "week");
 
 var range     = Core_State_Get("timetable", range + "-range");
 var date_from = range["from"];
 var date_to   = range["to"];
 
 
 // LOAD CLASSES FROM GIVEN TIME PERIOD / CENTER
 var classes = await Core_Api("Classes_List_ByCourse", 
 {
  course_id:course,
  date_from, 
  date_to, 
  fields:"id,type,date_start,online,duration,teacher_id,ta1_id,ta2_id,ta3_id,center_id,classroom_id,lesson_id,seats_total,seats_taken,course_id", 
 });
 
 Core_State_Set("timetable", "classes", classes);
}





function Timetable_Data_GetClass(id, mode = "data")
{
 switch(mode)
 {
  case "data":
  case "index":
    var classes = Core_State_Get("timetable", "classes");
	var i = 0;
	
	for(var item of classes) 
	{
	 if(item["id"] == id)
	 {   
      if(mode == "index") return i; else return item;
	 }
	 
	 i++;
	}
  break;
  

  case "slot":
   var element = UI_Element_Find("class-" + data["id"]);
   
   return element;
  break;
 }
}






// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                            M E N U                                             //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Timetable_Menu_Show(menu, event)
{
 var element = event.currentTarget; 
 var type    = Document_Element_GetData(element, "type");
 var data    = Document_Element_GetObject(element, "data");
 
 Core_State_Set("timetable", "selected-class", data);
 
 var items = Document_Element_GetObject(menu, "items");
 
 switch(type)
 {
  case "empty":
	items["new"]["state"]    = "enabled";
	items["delete"]["state"] = "hidden";
	items["copy"]["state"]   = "hidden";
	
	var copied = Core_State_Get("timetable", "class-copied", false);
	if(copied)
	{
	 items["paste"]["state"]  = "enabled";
	}
	else
	{
	 items["paste"]["state"]  = "disabled";
	}	
  break;
  
  case "open":
	items["new"]["state"]    = "hidden";
	items["delete"]["state"] = "enabled";
	items["copy"]["state"]   = "enabled";
	items["paste"]["state"]  = "hidden";
  break;
 }
 
 
}

async function Timetable_Menu_Delete()
{
 var data = Core_State_Get("timetable", "selected-class");
 
 // CONFIRM
 var code     = data["id"].padStart(6, "0");
 var title    = UI_Language_String("timetable/popups", "class delete title"); 
 var content  = UI_Language_String("timetable/popups", "class delete text", {id:code}); 
 var picture  = Resources_URL("images/cover-alert.jpg");
 //Doan Nhat Nam 15/06/2023 Check lesson belongs to a course 
  var check = data["course_id"];
  if(check != null){
      content = UI_Language_String("timetable/popups", "class fail delete text"); 
      await UI_Popup_Create({title, content, picture}, undefined, undefined)
  }
  else{
    var confirm = await UI_Popup_Code(title, content, picture, code);
    if(!confirm) return;
    
    // DELETE FROM DB
    await Core_Api("Class_Cancel", {class_id:data["id"]});
    
    
    // DELETE FROM MEMORY
    var classes = Core_State_Get("timetable", "classes");
    for(var item of classes) 
    {
      if(item["id"] == data["id"])
      {
      Array_Element_Delete(classes, item);
      
      var element = UI_Element_Find("class-" + data["id"]);
      if(element) await Document_Element_Animate(element, "zoomOut 0.75s 1");  
    
      break;
      }
    }
    // UPDATE
    await Timetable_Display();
  }
 //Doan Nhat Nam 15/06/2023 Check lesson belongs to a course 
 
}



async function Timetable_Menu_New(item)
{
 var data     = Core_State_Get("timetable", "selected-class");
 var duration = Document_Element_GetData(item, "uid");
 
 var request         = {};
 request["center"]   = data["center"];
 request["room"]     = data["room"];
 request["date"]     = data["date_start"]; 
 request["teacher"]  = data["teacher"];
 request["duration"] = duration;
 request["utc"]      = true;
 console.log(request);
 
 var response        = await Core_Api("Class_Validate", request);
 console.log(response); 
 
 if(response["fail"])
 {
  var picture = Resources_URL("images/cover-deny.png");
  var title   = UI_Language_String("timetable/popups", "create fail title"); 
  var content = UI_Language_String("timetable/popups", "create " + response["fail"]);
  
  await UI_Popup_Alert(title, content, picture);
  
  return;
 }
 
 // TEACHER IS SET, ROOM ISN'T
 if(request["teacher"] && !request["room"])
 {
  // PICK A ROOM
  var room = await Centers_Room_Select(response["rooms"], false, false, {online:true});
  if(!room) return;
  
  var online = (room == "online");
  
  // CREATE
  var create =
  {
   center_id:    data["center"],
   classroom_id: room,
   date_start:   data["date_start"],
   duration,
   teacher_id:   data["teacher"],
   online
  }
 }
 else
 // ROOM IS SET, TEACHER ISN'T
 if(request["room"] && !request["teacher"])
 {
  // PICK A TEACHER
  var title   = UI_Language_String("timetable/popups", "teacher select title");
  var teacher = await Users_Popup_SelectFromList(Object_To_Array(response["teachers"]), {firstname:true, lastname:true}, "users/table-fields");
  if(!teacher) return;
  
  var teacher_id  = teacher["id"];
  
  // CREATE
  var create =
  {
   center_id:    data["center"],
   classroom_id: data["room"],
   date_start:   data["date_start"],
   duration,
   teacher_id
  }
 }
 
 
 // UPDATE DB
 var newclass         = await Core_Api("Class_Create", {data:create, utc:true, info:true});
  
 // UPDATE IN MEMORY
 var classes = Core_State_Get("timetable", "classes");
 classes.push(newclass);
  
  
 // UPDATE TIMETABLE
 Core_State_Set("timetable", "class-created", newclass["id"]);
 
 
 Timetable_Scroll_Save();
 
 await Timetable_Display();
 
 Timetable_Scroll_Restore();
}



async function Timetable_Menu_Copy()
{
}



async function Timetable_Menu_Paste()
{
}


function Timetable_Scroll_Save()
{
 var timetable = Core_State_Get("timetable", "display");
 if(!timetable) 
 {
  Core_State_Set("timetable", "scroll", false);
  return;
 }
 
 var slots      = UI_Element_Find(timetable, "slots");
 var scroll     = {};
 scroll["left"] = slots.scrollLeft;
 scroll["top"]  = slots.scrollTop;
 
 Core_State_Set("timetable", "scroll", scroll);
}



function Timetable_Scroll_Restore()
{
 var timetable = Core_State_Get("timetable", "display");
 if(!timetable) return;
 
 var scroll    = Core_State_Get("timetable", "scroll", scroll);
 if(!scroll) return;
 
 var slots        = UI_Element_Find(timetable, "slots");
 slots.scrollLeft = scroll["left"];
 slots.scrollTop  = scroll["top"];
}async function Timetable_CenterRooms_Data()
{
 var center = Core_State_Get("timetable", "center", User_Center());
 var day    = Core_State_Get("timetable", "day");  
   
 Core_State_Set("timetable", "view-range", "day");
 Core_State_Set("timetable", "view-details", 
 {
  id      : true,
  teacher : true,
  center  : false,
  lesson  : true,
  room    : false,
  time    : false
 });
 
 await Timetable_Data_Center("day");
}



async function Timetable_CenterRooms_Display()
{
 var center    = Core_State_Get("timetable", "center");
  
 var timetable = Core_State_Get("timetable", "display");
 var date      = Core_State_Get("timetable", "date");
 var classes   = Core_State_Get("timetable", "classes");
 
 var headers   = UI_Element_Find(timetable, "headers"); 
 var slots     = UI_Element_Find(timetable, "slots"); 
 
 
 // NAVIGATION HEADER
 var date = Core_State_Get("timetable", "day");
 var text = Date_Format(Core_State_Get("timetable", "day"), UI_Language_Current(true), "date-short-weekday-noyear");
 UI_Element_Find(timetable, "nav-date").innerHTML = text;

 var day  = Date_Portion(date, "date-only");

 // ORGANIZE DATA
 for(var item of classes) item["date_day"] = Date_Portion(item["date_start"], "date-only");
 var classes = Array_Catalog_ByField(classes, "classroom_id");
 
 for(var classroom_id in classes)
 {
  classes[classroom_id] = Array_Catalog_ByField(classes[classroom_id], "date_day");
 }

 // GET ROOMS 
 var rooms = Core_State_Get("timetable", "rooms");


 // ONE COLUMN PER ROOM
 for(var id in rooms)
 {     
  // COLUMN HEADER
  var caption    = id;
  var subcaption = "";
  
  var header          = UI_Element_Create("timetable/column-header", {caption, subcaption});
  headers.appendChild(header);
  
 
  // COLUMN DATA
  var column = UI_Element_Create("timetable/column-slots", {id, caption});
  column.style.height = (TIMETABLE_MIN_HEIGHT * TIMETABLE_DAY_SLOTS) + "px"; 
 

  // FIRST, FILL LOWEST COLUMN LAYER WITH EMPTY SLOTS
  var data        = {};
  data["center"]  = center;
  data["room"]    = id;
  data["date"]    = day; 
  data["teacher"] = false;
  
  Timetable_Column_Fill(column, data);
 
 
  // CREATE CLASSES SLOTS ON A HIGHER LAYER
  console.log(classes);
  var items = Safe_Get(classes, [id, day], []); 
  for(var item of items)
  {
   var slot          = Timetable_Slot_Display("open", item, Core_State_Get("timetable", "view-details", {}), Timetable_Slot_View);
   slot.style.zIndex = 100;
   
   column.appendChild(slot);
  }
 
 
  // DISPLAY COLUMN
  slots.appendChild(column);
 }
}


async function Timetable_CenterTeachers_Data()
{
 var center = Core_State_Get("timetable", "center", User_Center());
 var day    = Core_State_Get("timetable", "day");  
   
 Core_State_Set("timetable", "view-range", "day");
  
 Core_State_Set("timetable", "view-details", 
 {
  id      : true,
  teacher : false,
  center  : false,
  lesson  : true,
  room    : true,
  time    : false
 });

 await Timetable_Data_Center("day");
}



async function Timetable_CenterTeachers_Display()
{
 var timetable = Core_State_Get("timetable", "display");
 var date      = Core_State_Get("timetable", "date");
 var center    = Core_State_Get("timetable", "center");
 var classes   = Core_State_Get("timetable", "classes");
 var headers   = UI_Element_Find(timetable, "headers"); 
 var slots     = UI_Element_Find(timetable, "slots"); 
 
 
 // NAVIGATION HEADER
 var date = Core_State_Get("timetable", "day");
 var text = Date_Format(Core_State_Get("timetable", "day"), UI_Language_Current(true), "date-short-weekday-noyear");
 UI_Element_Find(timetable, "nav-date").innerHTML = text;
	
 var day  = Date_Portion(date, "date-only");
	
 // ORGANIZE DATA
 for(var item of classes) item["date_day"] = Date_Portion(item["date_start"], "date-only"); 
 var classes = Array_Catalog_ByField(classes, "teacher_id");
  
 for(var teacher_id in classes)
 {
  classes[teacher_id] = Array_Catalog_ByField(classes[teacher_id], "date_day");
 }
	
 // GET TEACHERS 
 var teachers = Core_State_Get("timetable", "teachers");
    
	
 // ONE COLUMN PER TEACHER
 for(var teacher of teachers)
 {
  var id         = teacher["id"];
     
  // COLUMN HEADER
  var caption    = teacher["firstname"] || "";
  var subcaption = teacher["lastname"]  || "";
	 
  var header          = UI_Element_Create("timetable/column-header", {caption, subcaption});
  headers.appendChild(header);
	 
	 
  // COLUMN DATA
  var column = UI_Element_Create("timetable/column-slots", {id:teacher["id"], caption});
  column.style.height = (TIMETABLE_MIN_HEIGHT * TIMETABLE_DAY_SLOTS) + "px"; 
	 

  // FIRST, FILL LOWEST COLUMN LAYER WITH EMPTY SLOTS
  var data        = {};
  data["center"]  = center;
  data["room"]    = false;
  data["date"]    = day; 
  data["teacher"] = teacher["id"];
  
  Timetable_Column_Fill(column, data);
	 
	 
  // CREATE CLASSES SLOTS ON A HIGHER LAYER
  var items = Safe_Get(classes, [teacher["id"], day], []); 
  for(var item of items)
  {
   var slot          = Timetable_Slot_Display("open", item, Core_State_Get("timetable", "view-details", {}), Timetable_Slot_View);
   slot.style.zIndex = 100;
	  
   column.appendChild(slot);
  }
	 
	 
  // DISPLAY COLUMN
  slots.appendChild(column);
 }
}async function Timetable_CourseWeek_Select()
{
 var center  = User_Center();
 var courses = await Core_Api("Courses_Ongoing", {centers:[center]});
 
 var options = [];
 for(var course of courses)
 {
  var value = course["id"];
  var text  = course["name"] || course["id"];
  
  options.push({text, value});
 }
 
 var course = await UI_Popup_Select("", "", false, options);
 if(!course) return;
 
 Core_State_Set("timetable", "force-reload", true);
 Core_State_Set("timetable", "course", course);
 Core_State_Set("timetable", "view", "course-week");

 await Timetable_Update();
}


async function Timetable_CourseWeek_Data()
{
 var course = Core_State_Get("timetable", "course");
 var week   = Core_State_Get("timetable", "week");  
  
 Core_State_Set("timetable", "view-range", "week");
 Core_State_Set("timetable", "view-details", 
 {
  id      : true,
  teacher : true,
  center  : true,
  lesson  : true,
  room    : true,
  time    : false
 });
 
 await Timetable_Data_Course(course,"week");
}



async function Timetable_CourseWeek_Display()
{
 var center = Core_State_Get("timetable", "center", User_Center());
 var room   = Core_State_Get("timetable", "room", "");
 
 var timetable = Core_State_Get("timetable", "display");
 var date      = Core_State_Get("timetable", "date");
 var classes   = Core_State_Get("timetable", "classes");

 var headers   = UI_Element_Find(timetable, "headers"); 
 var slots     = UI_Element_Find(timetable, "slots"); 
 
 // NAVIGATION HEADER
 var week = Core_State_Get("timetable", "week"); 
 var text = "Week Of " + Date_Format(week, UI_Language_Current(true), "date-short-noyear");
 UI_Element_Find(timetable, "nav-date").innerHTML = text;
 
	
 // ORGANIZE DATA
 for(var item of classes) item["day"]  = Date_Portion(item["date_start"], "date-only");  
 var classes = Array_Catalog_ByField(classes, "day");
	
	
 // ONE COLUMN PER DAY
 for(var i = 0; i<7; i++)
 {
  var weekday    = Date_Portion(Date_Add_Days(week, i), "date-only");
     
  // COLUMN HEADER
  var caption    = Date_Weekday_Name(Date_Weekday_Get(weekday), "long", UI_Language_Current());
  var subcaption = Date_Format(weekday, UI_Language_Current(true), "date-short-noyear");
	 
  var header     = UI_Element_Create("timetable/column-header", {caption, subcaption});
  headers.appendChild(header);
	 
	 
  // COLUMN DATA
  var column = UI_Element_Create("timetable/column-slots", {id:weekday});
  column.style.height = (TIMETABLE_MIN_HEIGHT * TIMETABLE_DAY_SLOTS) + "px"; 
	 

  // FIRST, FILL LOWEST COLUMN LAYER WITH EMPTY SLOTS
  var data        = {};
  data["center"]  = center;
  data["room"]    = room;
  data["date"]    = weekday; 
  data["teacher"] = false;
    
  Timetable_Column_Fill(column, data);
	 
	 
  // CREATE CLASSES SLOTS ON A HIGHER LAYER
  var items = Safe_Get(classes, [weekday], []); 
  for(var item of items)
  {
   var slot          = Timetable_Slot_Display("open", item, Core_State_Get("timetable", "view-details", {}) , Timetable_Slot_View);
   slot.style.zIndex = 100;
	  
   column.appendChild(slot);
  }
	 
	 
  // DISPLAY COLUMN
  slots.appendChild(column);
 }
 
}


async function Timetable_RoomWeek_Data()
{
 var center = Core_State_Get("timetable", "center", User_Center());
 var room   = Core_State_Get("timetable", "room", "");
 var week   = Core_State_Get("timetable", "week");  
  
 Core_State_Set("timetable", "view-range", "week");
 Core_State_Set("timetable", "view-details", 
 {
  id      : true,
  teacher : true,
  center  : false,
  lesson  : true,
  room    : false,
  time    : false
 });
 
 await Timetable_Data_Room(center, room, "week");
}



async function Timetable_RoomWeek_Display()
{
 var center = Core_State_Get("timetable", "center", User_Center());
 var room   = Core_State_Get("timetable", "room", "");
 
 var timetable = Core_State_Get("timetable", "display");
 var date      = Core_State_Get("timetable", "date");
 var classes   = Core_State_Get("timetable", "classes");

 var headers   = UI_Element_Find(timetable, "headers"); 
 var slots     = UI_Element_Find(timetable, "slots"); 
 
 // NAVIGATION HEADER
 var week = Core_State_Get("timetable", "week"); 
 var text = "Week Of " + Date_Format(week, UI_Language_Current(true), "date-short-noyear");
 UI_Element_Find(timetable, "nav-date").innerHTML = text;
 
	
 // ORGANIZE DATA
 for(var item of classes) item["day"]  = Date_Portion(item["date_start"], "date-only");  
 var classes = Array_Catalog_ByField(classes, "day");
	
	
 // ONE COLUMN PER DAY
 for(var i = 0; i<7; i++)
 {
  var weekday    = Date_Portion(Date_Add_Days(week, i), "date-only");
     
  // COLUMN HEADER
  var caption    = Date_Weekday_Name(Date_Weekday_Get(weekday), "long", UI_Language_Current());
  var subcaption = Date_Format(weekday, UI_Language_Current(true), "date-short-noyear");
	 
  var header     = UI_Element_Create("timetable/column-header", {caption, subcaption});
  headers.appendChild(header);
	 
	 
  // COLUMN DATA
  var column = UI_Element_Create("timetable/column-slots", {id:weekday});
  column.style.height = (TIMETABLE_MIN_HEIGHT * TIMETABLE_DAY_SLOTS) + "px"; 
	 

  // FIRST, FILL LOWEST COLUMN LAYER WITH EMPTY SLOTS
  var data        = {};
  data["center"]  = center;
  data["room"]    = room;
  data["date"]    = weekday; 
  data["teacher"] = false;
    
  Timetable_Column_Fill(column, data);
	 
	 
  // CREATE CLASSES SLOTS ON A HIGHER LAYER
  var items = Safe_Get(classes, [weekday], []); 
  for(var item of items)
  {
   var slot          = Timetable_Slot_Display("open", item, Core_State_Get("timetable", "view-details", {}) , Timetable_Slot_View);
   slot.style.zIndex = 100;
	  
   column.appendChild(slot);
  }
	 
	 
  // DISPLAY COLUMN
  slots.appendChild(column);
 }
 
}


async function Timetable_TeacherWeek_Data()
{
 var teacher = Core_State_Get("timetable", "user", User_Id());
 var week    = Core_State_Get("timetable", "week");  
  
 Core_State_Set("timetable", "view-range", "week");
 Core_State_Set("timetable", "view-details", 
 {
  id      : true,
  teacher : false,
  center  : true,
  lesson  : true,
  room    : true,
  time    : false
 });
 
 await Timetable_Data_User(teacher, "week");
}


async function Timetable_TeacherWeek_Display()
{
 var teacher   = Core_State_Get("timetable", "user");
 var center    = Core_State_Get("timetable", "center");
 
 var timetable = Core_State_Get("timetable", "display");
 var date      = Core_State_Get("timetable", "date");
 var classes   = Core_State_Get("timetable", "classes");
 
 var headers   = UI_Element_Find(timetable, "headers"); 
 var slots     = UI_Element_Find(timetable, "slots"); 
 
 
 // NAVIGATION HEADER
 var week = Core_State_Get("timetable", "week");
 var text = "Week Of " + Date_Format(week, UI_Language_Current(true), "date-short-noyear");
 UI_Element_Find(timetable, "nav-date").innerHTML = text;


 // ORGANIZE DATA
 for(var item of classes) item["day"]  = Date_Portion(item["date_start"], "date-only");
 var classes = Array_Catalog_ByField(classes, "day");


 // ONE COLUMN PER DAY
 for(var i = 0; i<7; i++)
 {
  var weekday    = Date_Portion(Date_Add_Days(week, i), "date-only");
  
  // COLUMN HEADER
  var caption    = Date_Weekday_Name(Date_Weekday_Get(weekday), "long", UI_Language_Current());
  var subcaption = Date_Format(weekday, UI_Language_Current(true), "date-short-noyear");
  
  var header     = UI_Element_Create("timetable/column-header", {caption, subcaption});
  headers.appendChild(header);
  
  
  // COLUMN DATA
  var column = UI_Element_Create("timetable/column-slots", {id:weekday});
  column.style.height = (TIMETABLE_MIN_HEIGHT * TIMETABLE_DAY_SLOTS) + "px"; 
     

  // FIRST, FILL LOWEST COLUMN LAYER WITH EMPTY SLOTS
  var data        = {};
  data["center"]  = center;
  data["room"]    = false;
  data["date"]    = weekday; 
  data["teacher"] = teacher;
  
  Timetable_Column_Fill(column, data);
 
 
  // CREATE CLASSES SLOTS ON A HIGHER LAYER
  var items = Safe_Get(classes, [weekday], []); 
  for(var item of items)
  {
   var slot          = Timetable_Slot_Display("open", item, Core_State_Get("timetable", "view-details", {}), Timetable_Slot_View);
   slot.style.zIndex = 100;
  
   column.appendChild(slot);
  }
 
 
  // DISPLAY COLUMN
  slots.appendChild(column);
 }
}

// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                     T E M P L A T E                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Trung_OnLoad(module, data)
{
 console.log(data);
 
 Core_State_Set("trung", ["stairs", "step"], 0);
 
 var step = Core_State_Get("trung", ["stairs", "step"]);
}



async function Trung_OnShow(module, data)
{
 var container = UI_Element_Find(module, "module-page");
 
 var users     = await Core_Api("Users_Read", {ids:[137, 103, 102]});
 
 for(var id in users)
 {
  var user     = users[id];
  var element  = UI_Element_Create("trung/red-box", {count:user["firstname"]}, {});
  
  Document_Element_SetObject(element, "user", user);
  
  element.onclick = 
  function(event)
  {
   var element = event.currentTarget;
   var user    = Document_Element_GetObject(element, "user");
   
   alert(user["lastname"]);
  }
  
  container.appendChild(element);
 }
 

}




async function Trung_OnUnload()
{
}





// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          M O R E                                               //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Users_Family_DisplayMain(id, options = {})
{
 var data = await Core_Api("Family_Read", {id, options:{manager:true}});
 console.log(data);
 
 Core_State_Set("users", "family-id", id);
 Core_State_Set("users", "family-data", data);
 
 var display = UI_Element_Create("users/family-main", {}, {language:"users/family-main"});
 
 // DROPDOWN SOURCES
 
 // 1. CENTERS
 var element = UI_Element_Find(display, "family-center");
 Document_Select_AddOption(element, "", ""); 
 var centers = Centers_Available();
 for(var center of centers) Document_Select_AddOption(element, center["name"], center["id"]);

 // 2. STATUSES
 var element = UI_Element_Find(display, "family-status");
 Document_Select_AddOption(element, "", ""); 
 UI_Select_FromDatapage(element, "families/statuses"); 
 
 // 3. TYPES
 var element = UI_Element_Find(display, "family-type");
 Document_Select_AddOption(element, "", ""); 
 UI_Select_FromDatapage(element, "families/types"); 


 // STANDARD FIELDS
 for(var field in data)
 {
  var element = UI_Element_Find(display, "family-" + field);
  
  if(element)
  {
   Document_Input_Set(element, data[field]);
   Document_Element_SetData(element, "field", field);
   
   // ON VALUE CHANGE - UPDATE
   element.onchange =
   async function(event)
   {
	console.log("update");
	
    var element = event.currentTarget;
    var field   = Document_Element_GetData(element, "field");
	var value   = Document_Input_Get(element);
	
	var id      = Core_State_Get("users", "family-id");
	
    await Core_Api("Family_Update_Field", {id, field, value});
   }
   
  }
 
 }
 
 
 // JSON DATA FIELDS
 var more   = data["data"] || {};
 var inputs = Document_Element_FindChildren(display, "type", "data", ["recurse"]);
 
 for(var element of inputs)
 {
  var field = Document_Element_GetData(element, "uid");
  
  if(field)
  {
   if(typeof more[field] != "undefined") Document_Input_Set(element, more[field]);
   Document_Element_SetData(element, "field", field);
   
   // ON VALUE CHANGE - UPDATE
   element.onchange =
   async function(event)
   {
	console.log("update");
	
    var element = event.currentTarget;
    var field   = Document_Element_GetData(element, "field");
	var value   = Document_Input_Get(element);
	
	var id      = Core_State_Get("users", "family-id");
	
    await Core_Api("Family_Update_Data", {id, field, value});
   }
   
  }
 
 }
 
 
 // MANAGER
 var element = UI_Element_Find(display, "family-manager_id");
 Document_CSS_SetClass(element, "style-clickable");
 var manager = data["manager"];
 if(manager)
 {
  var firstname = manager["firstname"] || "";
  var lastname  = manager["lastname"]  || "";
  
  element.value = [firstname, lastname].join(" ").trim();
 }
 element.onclick = Users_Family_ChangeManager;
 
 
 
 // APPLY PERMISSIONS
 var editable = User_Config("edit-family-fields", "").split(",");
 
 var elements = Document_Element_FindChildren(display, "field", undefined, ["recurse"]);
 for(var element of elements)
 {
  var field = Document_Element_GetData(element, "field");
  if(!editable.includes(field))
  {
   Document_Element_Disable(element);
  }
 }
 
 
 
 return display;
}



async function Users_Family_DisplayMore(family, maindisplay = false)
{
 var display = UI_Element_Create("users/family-more");
 if(maindisplay) Document_Element_SetObject(display, "main-display", maindisplay);
 
 var view   = User_Config("view-family-more", "").split(",");
 var items  = {};
 
 var header_dispatcher =
 async function(item)
 {
  console.log(item);
  
  var f    = Safe_Function("Users_Family_Display" + String_Capitalize_Initial(item["display"]), function(){});
  var data = await f(item["family"], maindisplay);

  var container = UI_Element_Find(display, "data");
  container.innerHTML = "";
  container.appendChild(data);
 }
 
 // BUILD HEADER BASED ON MORE.DAT INFORMATION + PARTNER CONFIGURATION
 var more   = Core_Data_Page("users/family-more");
 for(var field in more)
 { 
  // IS THE CURRENT USER ALLOWED TO SEE THIS PAGE?
  if(view.includes(field))
  {
   var item        = {};
   item["text"]    = UI_Language_String("users/family-more", field);
   item["icons"]   = [];
   item["family"]  = family;
   item["display"] = field;
   item["onclick"] = header_dispatcher;
   items[field]    = item;
  }
 }
 
 var header = UI_Header("header-more", items, {selectfirst:false, css:"color-noted", template:"standard"}); 
 
 UI_Element_Find(display, "header").appendChild(header);
 return display;
}




async function Users_Family_DisplayUsers(family, maindisplay)
{
 if(typeof family == "object") var users = family["users"] || []; else var users = await Core_Api("Family_Users", {id:family});
 
 users     = Object.values(users);
 var table = UI_Table_Data(users, {id:true, firstname:true, lastname:true}, "users/table-fields",
 // EVENTS
 {
  row:
  async function(event)
  {
   var element = event.currentTarget;
   var user    = Document_Element_GetObject(element, "item");
   
   if(maindisplay)
   {
    var display           = await Users_User_DisplayMain(user["id"]);
	maindisplay.innerHTML = "";
	maindisplay.appendChild(display);
   }
  }
 },
 
 // ACTIONS
 {
  delete:
  {
   icon:"trash-can",
   onclick: async function(item, row)
   {
	console.log(item);
	
	var name    = [item["firstname"] || "", item["lastname"] || ""].join(" ").trim();
    var title   = UI_Language_String("users/popups", "family removeuser title"); 
    var text    = UI_Language_String("users/popups", "family removeuser text", {name}); 
    var picture = Resources_URL("images/cover-alert.jpg");
 
    var confirm  = await UI_Popup_Confirm(title, text, picture);
    if(!confirm) return; 
	
	await Core_Api("User_Update_Field", {user_id:item["id"], field:"family_id", value:null});
	row.remove();
   }
  }
 });
 
 return table;
}




async function Users_Family_ChangeManager(event)
{
 var element = event.currentTarget;
 var family  = Core_State_Get("users", "family-data")
 var role    = Module_Config("families", "managed-by", "").split(",");

 var center = Array_From_Fields(Centers_Available(), "id");
 if(center.length == 0) center = [User_Center()];

 var users   = await Core_Api("Users_List_ByCenter", {role, center, fields:"id,firstname,lastname", order:"firstname,lastname"});
 var manager = await Users_Popup_SelectFromList(users, {firstname:true, lastname:true}, "users/table-fields");

 if(manager && manager["id"] != family["manager_id"])
 {
  // UPDATE DB
  Core_Api("Family_Update_Field", {id:family["id"], field:"manager_id", value:manager["id"]});// UPDATE DISPLAY
  
  // UPDATE MEMORY
  family["manager_id"] = manager["id"];
  
  // UPDATE DISPLAY
  var firstname = manager["firstname"] || "";
  var lastname  = manager["lastname"]  || "";
  
  element.value = [firstname, lastname].join(" ").trim(); 
 }
}
// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                          U S E R S                                             //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Users_OnLoad(module, data)
{ 
 // CREATE MENU HEADER
 var menus = Core_Data_Page("users/menus");
 var items = {};
 for(var key in menus)
 {
  items[key]            = {};
  items[key]["text"]    = UI_Language_Object(menus[key]);
  items[key]["icons"]   = [];
  items[key]["onclick"] = Safe_Function("Users_" + String_Capitalize_Initial(key), function(){});
 }
 
 var header = UI_Header("users-menu", items, {selectfirst:false, css:"color-noted", template:"standard"});
  
 UI_Element_Find(module, "module-header").appendChild(header);
 
 
 
 // CREATE STAFF SUBMENU
 var items   = {};
 var roles   = User_Config("edit-staff", "").split(",");
 for(var role of roles)
 {
  var item      = [];
  item["icon"]  = "";
  item["text"]  = UI_Language_Object(Core_Config(["roles", role], {}));
  item["state"] = "enabled";
  item["func"]  = Users_Staff_List;
  item["tag"]   = role;

  items[role]   = item;
 }
 var menu = UI_Menu_Create("staff-submenu", items);
 Core_State_Set("users", ["menus", "staff"], menu);
}



async function Users_OnUnload()
{
}



async function Users_OnShow(module, data)
{
}




function Users_ClearDisplay()
{
 var element = UI_Element_Find("user-main");
 element.style.visibility = "hidden";
 element.innerHTML        = "";
 
 var element = UI_Element_Find("user-more");
 element.style.visibility = "hidden";
 element.innerHTML        = "";
}






async function Users_Students()
{
 Users_ClearDisplay();
 
 var operations = 
 {
  message : 
  {
   icon    : "envelope",
   onclick : Users_List_Message
  }
 }
 
 var display   = Database_View_Create("Users_List_ByCenter", Module_Config("users", "page"), {id:true, firstname:true, lastname:true, email:true}, "users/table-fields", Users_User_Select, false, {export_fields:"id,firstname,lastname,email,mobile,center", operations});
 
 var scope = User_Config("operate-on-users");
 switch(scope)
 {
  case "all":
  
	var center = User_Center();
 
	await Database_View_Query(display,
	{
	 center,
	 fields : "id,firstname,lastname",
	 role   : "student",
	 order  : "lastname, firstname",
	}); 
  break;
  
  case "managed":	
	
	var manager = User_Id();
	
	await Database_View_Query(display,
	{		
	 manager,
	 fields : "id,firstname,lastname",
	 role   : "student",
	 order  : "lastname, firstname",
	}); 
  break;
 }
 
 Core_State_Set("users", "list-display", display);

 var container       = UI_Element_Find("list-display");
 container.innerHTML = "";
 container.appendChild(display);
 container.style.visibility = "visible";
}




async function Users_List_Message(display)
{
 // GET ALL DISPLAY STUDENTS IDS
 var users = await Database_View_Data(display, "all", "id");
 var ids   = Array_From_Fields(users, "id");
 
 await Messages_Popup_SendMultiple(ids);
}




async function Users_Staff()
{ 
 var menu     = Core_State_Get("users", ["menus", "staff"]);
 var position = Document_Element_Corner(UI_Element_Find("staff"), "bottom"); 
 
 setTimeout(
 function()
 {
  UI_Menu_Show(menu, position["left"], position["top"] + parseInt(Document_CSS_GetValue("gap-medium", "gap")) * 2, {direction:"bottom"});
 }, 125);
}




async function Users_Staff_List(item)
{  
 Users_ClearDisplay();
 
 var operations = 
 {
  message : 
  {
   icon    : "envelope",
   onclick : Users_List_Message
  }
 }
  
 var display = Database_View_Create("Users_List_ByCenter", Module_Config("users", "page"), {id:true, firstname:true, lastname:true, email:true}, "users/table-fields", Users_User_Select, false, {export_fields:"id,firstname,lastname,email,mobile,center", operations});
 
 var role = Document_Element_GetObject(item, "tag");
 var center = User_Center();
 
 await Database_View_Query(display,
 {
  center,
  role,
  order  : "lastname, firstname",
 }); 
 
 Core_State_Set("users", "list-display", display);

 var container       = UI_Element_Find("list-display");
 container.innerHTML = "";
 container.appendChild(display);
 container.style.visibility = "visible";
}




async function Users_Search()
{
 var centers = [User_Center()];
 
 var user    = await Users_Popup_SelectFromSearch(centers, [], fields = "id,firstname,lastname", count = 100, order = "id");
 if(!user) return;
  
 Users_ClearDisplay();
 
 var table           = UI_Table_Data([user], {id:true, firstname:true, lastname:true}, "users/table-fields", Users_User_Select);
 var container       = UI_Element_Find("list-display");
 container.innerHTML = ""; 
 container.appendChild(table);
 container.style.visibility = "visible";
 
 Users_User_Select(false, user);
}





// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                     F A M I L I E S                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Users_Families()
{
 Users_ClearDisplay();
  
 var display = Database_View_Create("Families_List_ByCenter", Module_Config("families", "page"), {id:true, name:true, type:Core_Data_Page("families/types")}, "families/table-fields", Users_Family_Select);
 
 var center = User_Center();
 
 await Database_View_Query(display,
 {
  center,
  order  : "name",
 }); 
 
 Core_State_Set("families", "list-display", display);

 var container       = UI_Element_Find("list-display");
 container.innerHTML = "";
 container.appendChild(display);
 container.style.visibility = "visible";
}



async function Users_Family_Select(event)
{
 var element = event.currentTarget;
 var family  = Document_Element_GetObject(element, "item");
    
 var display = await Users_Family_DisplayMain(family["id"]);
 var more    = await Users_Family_DisplayMore(family["id"], UI_Element_Find("user-main"));
  
 var container  = UI_Element_Find("user-main");
 container.innerHTML        = "";
 container.appendChild(display);
 container.style.visibility = "visible";
  
 var container  = UI_Element_Find("user-more");
 container.innerHTML        = "";
 container.appendChild(more);
 container.style.visibility = "visible";
}






// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                            U S E R                                             //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Users_User_Select(event, user)
{ 
 if(!user)
 {
  var element = event.currentTarget;
  var user    = Document_Element_GetObject(element, "item");
 }
 
 var display = await Users_User_DisplayMain(user["id"]);
 var more    = await Users_User_DisplayMore(user["id"]);
  
 var container  = UI_Element_Find("user-main");
 container.innerHTML        = "";
 container.appendChild(display);
 container.style.visibility = "visible";
  
 var container  = UI_Element_Find("user-more");
 container.innerHTML        = "";
 container.appendChild(more);
 container.style.visibility = "visible";
}



async function Users_User_DisplayMain(id, options = {})
{
 var data = await Core_Api("User_Read", {user_id:id, options:{family:true, manager:true}});
 console.log(data);
 
 Core_State_Set("users", "user-id", id);
 Core_State_Set("users", "user-data", data);
 
 var display = UI_Element_Create("users/user-main", {}, {language:"users/user-main"});
 
 // DROPDOWN SOURCES
 
 // 1. ROLES
 var element = UI_Element_Find(display, "user-role");
 Document_Select_AddOption(element, "", ""); 
 UI_Select_FromConfig(element, "roles");
 
 // 2. CENTERS
 var element = UI_Element_Find(display, "user-center");
 Document_Select_AddOption(element, "", ""); 
 var centers = Centers_Available();
 for(var center of centers) Document_Select_AddOption(element, center["name"], center["id"]);

 // 3. STATUSES
 var element = UI_Element_Find(display, "user-status");
 Document_Select_AddOption(element, "", ""); 
 UI_Select_FromDatapage(element, "users/statuses"); 

 // 4. NATIONALITIES
 var element = UI_Element_Find(display, "user-nationality");
 Document_Select_AddOption(element, "", ""); 
 UI_Select_FromConfig(element, "nationalities");
 
 // 5. GENDERS
 var element = UI_Element_Find(display, "user-gender");
 Document_Select_AddOption(element, "", ""); 
 UI_Select_FromDatapage(element, "users/genders"); 
 

 // STANDARD FIELDS
 for(var field in data)
 {
  var element = UI_Element_Find(display, "user-" + field);
  
  if(element)
  {
   Document_Input_Set(element, data[field]);
   Document_Element_SetData(element, "field", field);
   
   // ON VALUE CHANGE - UPDATE
   element.onchange =
   async function(event)
   {
	console.log("update");
	
    var element = event.currentTarget;
    var field   = Document_Element_GetData(element, "field");
	var value   = Document_Input_Get(element);
	
	var user_id = Core_State_Get("users", "user-id");
	
    await Core_Api("User_Update_Field", {user_id, field, value});
   }
   
  }
 
 }
 
 
 // SPECIAL FIELDS
 
 // PICTURE
 var element = UI_Element_Find(display, "user-picture");
 await User_Picture_Load(element, data, undefined, true);
 Document_CSS_SetClass(element, "style-clickable");
 element.onclick =
 function(event)
 {
  var element = event.currentTarget;
  var user_id = Core_State_Get("users", "user-id");
  
  User_Picture_Upload(user_id, {update:[element]});
 }
 
 
 // FAMILY
 var element = UI_Element_Find(display, "user-family_id");
 Document_CSS_SetClass(element, "style-clickable");
 var family = data["family"];
 if(family)
 {
  element.value = family["name"] || family["id"];
 }
 element.onclick = Users_User_ChangeFamily;

 // MANAGER
 var element = UI_Element_Find(display, "user-manager_id");
 Document_CSS_SetClass(element, "style-clickable");
 var manager = data["manager"];
 if(manager)
 {
  var firstname = manager["firstname"] || "";
  var lastname  = manager["lastname"]  || "";
  
  element.value = [firstname, lastname].join(" ").trim();
 }
 element.onclick = Users_User_ChangeManager;
 
 
 
 // APPLY PERMISSIONS
 var editable = User_Config("edit-user-fields", "").split(",");
 
 var elements = Document_Element_FindChildren(display, "field", undefined, ["recurse"]);
 for(var element of elements)
 {
  var field = Document_Element_GetData(element, "field");
  if(!editable.includes(field))
  {
   Document_Element_Disable(element);
  }
 }
 
 
 
 return display;
}



async function Users_User_ChangeFamily(event)
{
 var element  = event.currentTarget;
 var user     = Core_State_Get("users", "user-data");
 
 var center   = User_Center();
 var families = await Core_Api("Families_List_ByCenter", {center});
 
 var title    = UI_Language_String("users/popups", "select family title");
 var family   = await UI_Popup_SelectData(title, families, {id:true, name:true, type:Core_Data_Page("families/types")}, "families/table-fields");
 
 if(family && user["family_id"] != family["id"])
 {  
  // UPDATE DB
  Core_Api("User_Update_Field", {user_id:user["id"], field:"family_id", value:family["id"]});
  
  // UPDATE MEMORY
  user["family_id"] = family["id"];
  
  // UPDATE DISPLAY
  element.value = family["name"] || family["id"];
 }
}


async function Users_User_ChangeManager(event)
{  
 var element = event.currentTarget;
 var user    = Core_State_Get("users", "user-data")
 var role    = Core_Config(["roles", user["role"], "managed-by"], "none").split(",");

 var center = Array_From_Fields(Centers_Available(), "id");
 if(center.length == 0) center = [User_Center()];

 var users   = await Core_Api("Users_List_ByCenter", {role, center, fields:"id,firstname,lastname", order:"firstname,lastname"});
 var manager = await Users_Popup_SelectFromList(users, {firstname:true, lastname:true}, "users/table-fields");

 if(manager && manager["id"] != user["manager_id"])
 {
  // UPDATE DB
  Core_Api("User_Update_Field", {user_id:user["id"], field:"manager_id", value:manager["id"]});
  
  // UPDATE MEMORY
  user["manager_id"] = manager["id"];
  
  // UPDATE DISPLAY
  var firstname = manager["firstname"] || "";
  var lastname  = manager["lastname"]  || "";

  element.value = [firstname, lastname].join(" ").trim(); 
 }
}








// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                             M O R E                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

async function Users_User_DisplayMore(user)
{
 if(typeof user != "object") var user = await Core_Api("User_Read", {user_id:user, options:{fields:"id,role"}});
  
 var display = UI_Element_Create("users/user-more");
 
 var edit   = User_Config("edit-user-data", "").split(",");
 var items  = {};
 
 // BUILD HEADER BASED ON ROLE INFORMATION + PARTNER CONFIGURATION
 var data = User_Role_Config(user["role"], "user-data", "").split(",");
 for(var field of data)
 { 
  // IS THE CURRENT USER ALLOWED TO SEE THIS PAGE?
  if(edit.includes(field))
  {
   var item        = {};
   item["text"]    = UI_Language_String("users/user-more", field);
   item["icons"]   = [];
   item["onclick"] = Safe_Function("Users_More_Display" + String_Capitalize_Initial(field), function(){});
   items[field]    = item;
  }
 }
 
 var header = UI_Header("header-more", items, {selectfirst:false, css:"color-noted", template:"standard"}); 
 
 UI_Element_Find(display, "header").appendChild(header);
 return display;
}



async function Users_More_DisplayFamily(event)
{
 var element  = event.currentTarget;
 var user     = Core_State_Get("users", "user-data");
 
 // DISPLAY
 var container = UI_Element_Find("user-more");
 
 // BUTTONS
 var buttons           = UI_Element_Find(container, "buttons");
 buttons.innerHTML     = "";
 buttons.style.display = "none";
 
 if(user["family_id"])
 {
  var display    = await Users_Family_DisplayMain(user["family_id"]);
  
  var data       = UI_Element_Find(container, "data");
  data.innerHTML = "";
  data.appendChild(display);
 }
 else
 {
 }
 
}



async function Users_More_DisplayClasses(event)
{
 var user    = Core_State_Get("users", "user-data");
 var classes = await Core_Api("Classes_List_ByStudent", {student_id:user["id"]});
 
 for(var item of classes)
 {
  item["period"] = Date_Format_Period(Date_Now(), item["date_start"], {locale:UI_Language_Current(true), conversational:true});
 }
 
 var list = UI_List_Items(classes, ["style-outlined-accented", "outline-inner"], Users_More_DisplayClass, {style:"vertical", overflow:true, sections:"period"},
 // ITEMS
 function(item)
 {
  var info    = Class_Info(item);
  
  var element = UI_Element_Create("users/more-class-item", info);
  Document_Element_SetObject(element, "item", item);
  
  return element;
 },

 // SECTIONS
 function(section, item)
 {
  var element = UI_Element_Create("users/more-class-section", {period:section.toUpperCase()});  
  return element;
 });
 
 
 // DISPLAY
 var container = UI_Element_Find("user-more");
 
 // BUTTONS
 var buttons           = UI_Element_Find(container, "buttons");
 buttons.innerHTML     = "";
 buttons.style.display = "none";


 var data       = UI_Element_Find(container, "data");
 data.innerHTML = "";
 data.appendChild(list);
}



async function Users_More_DisplayPlacements(event)
{
 var user    = Core_State_Get("users", "user-data");
 var classes = await Core_Api("Classes_List_ByStudent", {student_id:user["id"], options:{types:["placement"]}});
 
 for(var item of classes)
 {
  item["period"] = Date_Format_Period(Date_Now(), item["date_start"], {locale:UI_Language_Current(true), conversational:true});
 }
 
 var list = UI_List_Items(classes, ["style-outlined-accented", "outline-inner"], Users_More_DisplayClass, {style:"vertical", overflow:true, sections:"period"},
 // ITEMS
 function(item)
 {
  var info    = Class_Info(item);
  
  var element = UI_Element_Create("users/more-class-item", info);
  Document_Element_SetObject(element, "item", item);
  
  return element;
 },

 // SECTIONS
 function(section, item)
 {
  var element = UI_Element_Create("users/more-class-section", {period:section.toUpperCase()});  
  return element;
 });

 
 // DISPLAY
 var container  = UI_Element_Find("user-more");
 
 // DATA
 var data       = UI_Element_Find(container, "data");
 data.innerHTML = "";
 data.appendChild(list);

 // BUTTONS
 var buttons           = UI_Element_Find(container, "buttons");
 buttons.innerHTML     = "";
 buttons.style.display = "flex";
 
 var text       = UI_Language_String("users/user-more", "button book placement");
 var button     = UI_Element_Create("core/button-medium-plain", {text});
 button.onclick = 
 async function()
 {
  var student = user["id"];
  var center  = User_Center(); // CURRENTLY SELECTED CENTER ONLY
  
  var seat    = await User_More_BookPlacement(student, center);
  console.log("booked " + seat);
  
  // IF BOOKED, RELOAD DATA
  if(seat)
  {
   Users_More_DisplayPlacements();
  }
 }
 
 buttons.appendChild(button);
}




async function User_More_BookPlacement(student, center)
{ 
 // CONFIGURE AND LAUNCH A CLASS SEARCH POPUP WITH AUTOSEARCH AND BOOKING
 var seat = await Classes_Search_Popup(
 {
  type:      "placement", 
  center,
  datefrom:  Date_Now(),
  dateto:    Date_Add_Days(Date_Now(), 60),
  seats:     "yes"
 },
    
 {
  autosearch:true,
  book:true
 },

 {
  student
 });
 
 return seat;
}




async function Users_More_DisplayClass(element)
{
 var item = Document_Element_GetObject(element, "item");
 await Class_Display(item["id"]);
}




async function Users_More_DisplayFiles(event)
{
 // DISPLAY
 var container  = UI_Element_Find("user-more");
  
 // BUTTONS
 var buttons           = UI_Element_Find(container, "buttons");
 buttons.innerHTML     = "";
 buttons.style.display = "none";
 
 var user       = Core_State_Get("users", "user-data");
 var files      = await Core_Api("User_Files_List", {id:user["id"], folder:"documents"});
 
 var list       = UI_List_Files(files, "download", {style:"icons"});
  
 var data       = UI_Element_Find(container, "data");
 data.innerHTML = "";
 data.appendChild(list);
}




async function Users_More_DisplayPermissions(event)
{
 var user_id = Core_State_Get("users", "user-id");
  
 // READ PERMISSIONS
 var permissions = await Core_Api("User_Config_Read", {user_id, file:"permissions"});
 
 
 // DISPLAY
 var container  = UI_Element_Find("user-more");
  
 // BUTTONS
 var buttons           = UI_Element_Find(container, "buttons");
 buttons.innerHTML     = "";
 buttons.style.display = "none";
 
 
 // CENTERS
 var page       = UI_Element_Create("users/user-more-permissions", {}, {language:"users/user-more"});
 
 var allcenters = Centers_List();
 var centers    = [];
 for(var id in allcenters)
 {
  var item      = {};
  
  item["id"]    = id;
  item["text"]  = allcenters[id]["name"] || id;
  item["value"] = Safe_Get(permissions, ["centers", id]);
  
  centers.push(item);
 }
 
 var list    = UI_List_Checks(centers, "plain",
 async function(item, items)
 {
  var user_id = Core_State_Get("users", "user-id");
  var centers = {};
  
  for(var item of items)
  {
   if(item["value"])
   {
	var id = item["id"];
	centers[id] = true;
   }
  }
  
  await Core_Api("User_Config_WriteSection", {user_id, file:"permissions", section:"centers", data:centers});
 });
 
 
 UI_Element_Find(page, "centers").appendChild(list);
  
 var data       = UI_Element_Find(container, "data");
 data.innerHTML = "";
 data.appendChild(page);
}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                         U S E R S                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

function User_Folder(id)
{
 var folder = id;
 
 return folder;
}



function User_Role()
{
 return Safe_Get(application, ["user", "role"], "none");
}



function User_Center()
{
 return Safe_Get(application, ["user", "center"], "none");
}




function User_Settings_Get(section, field, def)
{
 return Safe_Get(application, ["user", "settings", section, field], def);
}



async function User_Settings_Set(section, field, value)
{
 Safe_Set(application, ["user", "settings", section, field], value);
 
 await Core_Api("User_Config_WriteValue", {file:"settings", section, field, value});
}





async function User_Read(current, options = {settings:true, permissions:true, propic:true})
{
 var user = Safe_Get(application, ["user"], {});
 
 if(!current)
 {
  var data = await Core_Api("User_Read", {options});
  Object.assign(user, data);
 }
 
 return user;
}




function User_Id()
{
 var id = Safe_Get(application, ["user", "id"]);
 
 return id;
}




function User_Can(what, def = "no")
{
 var role  = User_Role();
 
 var value = Core_Config(["roles", role, "can-" + what], def);
 
 // EXPLICIT RETURN OF CAN STRING
 if(def == "what")
 {
  var can = value;
 }
 else
 // RETURN BOOLEAN EVALUATION
 {
  var can = (value == "yes");
 }
 
 return can;
}




function User_Config(what, def = false)
{
 var role  = User_Role();
 
 var value = Core_Config(["roles", User_Role(), what], def);
 
 return value;
}



function User_Role_Config(role, what, def = false)
{ 
 var value = Core_Config(["roles", User_Role(), what], def);
 
 return value;
}







async function User_View_Popup(id, options = {})
{
 var user  = await Core_Api("User_Read", {user_id:id, options:{fields:"id,firstname,lastname,role,center,mobile,email"}});
 var popup = await UI_Popup_Create({}, [], "users/popup-view", {open:false, escape:true});
 
 User_Picture_Load(UI_Element_Find(popup, "propic"), user);
 
 UI_Element_Find(popup, "name").innerHTML = user["firstname"] + " " + user["lastname"];
 UI_Element_Find(popup, "id").innerHTML   = id;

 UI_Element_Find(popup, "data-role").innerHTML   = UI_Language_Object(Core_Config(["roles", user["role"] || ""], {}), "");
 UI_Element_Find(popup, "data-center").innerHTML = Centers_Name(user["center"] || "");
 UI_Element_Find(popup, "data-mobile").innerHTML = user["mobile"] || "";
 UI_Element_Find(popup, "data-email").innerHTML  = user["email"]  || "";

 if(typeof options["css"] != "undefined")
 {
  var popupWindow = UI_Element_Find(popup, "propic").parentElement;
  popupWindow.style.cssText = popupWindow.style.cssText + options["css"];
 }

 await UI_Popup_Show(popup);
}




function User_Card(user, template = "standard", more = false)
{
 var card = UI_Element_Create("users/card-" + template);
 
 // PICTURE
 var element = UI_Element_Find(card, "picture");
 if(user["id"])
 {
  User_Picture_Load(element, user);
 }
 else
 {
  element.style.visibility = "hidden";
 }
 
 // NAME
 for(var field of ["firstname", "lastname"])
 {
  var element = UI_Element_Find(card, field);
  
  if(element)
  {
   element.innerHTML = user[field] || "";
  }
 }
 
 // MORE
 if(more)
 {
  var element = UI_Element_Find(card, "more");
  element.style.display = "flex";
  element.appendChild(more);
 }
 
 Document_Element_SetObject(card, "user", user);
 
 return card;
}




async function Users_Popup_SelectFromList(users = [], fields = {firstname:true, lastname:true}, language, title = false)
{
 var promise = new Promise((resolve, reject) =>
 {
  var title   = title || UI_Language_String("users/popups", "select list title");
  var text    = UI_Language_String("users/popups", "select list button");
  
  var content = UI_Element_Create("users/popup-select-box");
  var table   = UI_Table_Data(users, fields, language)
  content.appendChild(table);
 
  var onclick = 
  function(popup)
  {
   UI_Popup_Close(popup);
   
   var row = Document_Element_GetObject(table, "selected-row");
   if(row)
   {
	var user = Document_Element_GetObject(row, "item");
   }
   else
   {
	var user = false;
   }
   
   resolve(user);
  }

  var onescape =
  function()
  {
   resolve(false);
  }
 
  UI_Popup_Create({title, content}, [{text, onclick}], "flexi", {escape:true, open:true, onescape});  
 });
 
 return promise;
}




async function Users_Popup_SelectFromSearch(centers = [], roles = [], fields = "firstname,lastname", count = 100, order = "id")
{
 var promise = new Promise((resolve, reject) =>
 {
  var title   = UI_Language_String("users/popups", "select list title");
  var text    = UI_Language_String("users/popups", "select list button");
  
  var content = UI_Element_Create("users/popup-select-search", {}, {language:"users/popups"});
  var table   = false;
  
  // DEBOUNCEABLE SEARCH FUNCTION
  var update_timeout = false;
  function update()
  {
   if(update_timeout) clearTimeout(update_timeout);
   
   update_timeout = setTimeout(
   async function()
   {
	var search =
	{
     centers,
	 roles,
	 fields,
	 count,
	 order
	}
	
	// GET OTHER SEARCH VALUES FROM THE POPUP
	for(var field of ["lastname", "firstname", "email", "mobile", "id"]) search[field] = UI_Element_Find(content, field).value;	

    var users       = await Core_Api("Users_Search", {search});
	
	var tablefields = {id:true};
	for(var field of fields.split(",")) tablefields[field] = true;
	table     = UI_Table_Data(users, tablefields, "users/table-fields")
	
    var display = UI_Element_Find(content, "users");
	display.innerHTML = "";
	display.appendChild(table);
  
	update_timeout = false;
   }, 1000);
  }
  
 
  // FIELDS
  for(var field of ["lastname", "firstname", "email", "mobile", "id"])
  {
   var element  = UI_Element_Find(content, field);
    
   element.onkeypress  = update;
   element.onblur      = update;
  }
 
  
  var onclick = 
  function(popup)
  {
   UI_Popup_Close(popup);
   
   var row = Document_Element_GetObject(table, "selected-row");
   if(row)
   {
	var user = Document_Element_GetObject(row, "item");
   }
   else
   {
	var user = false;
   }
   
   resolve(user);
  }


  var onescape =
  function()
  {
   resolve(false);
  }
 
  UI_Popup_Create({title, content}, [{text, onclick}], "flexi", {escape:true, open:true, onescape});  
 });
 
 return promise;
}





async function User_Picture_Load(picture, user, role = "generic", hide = false)
{
 if(typeof user == "object") var id = user["id"]; else var id = user;
 
 var role = user["role"] || role || "generic";
 
 if(hide) picture.style.visibility = "hidden";
 
 var image    = Resources_URL("propic.jpg", "user", id);
 var fallback = Resources_URL("images/default/propic-" + role + ".png"); 
 var generic  = Resources_URL("images/default/propic-generic.png"); 
 
 var result = true;
 if(typeof user != "object" || typeof user["propic"] =="undefined") user = await Core_Api("User_Read", {user_id:id, options: {fields:"id",propic:true}});
 if(user["propic"] != null) picture.src = "data:image/png;base64, " + user["propic"];
 else result   = await Document_Image_Load(picture, [generic], {nocache:true});
 
 if(hide && result != "hide") picture.style.visibility = "visible";
}





async function User_Picture_Upload(user_id, options)
{
 var files = await Storage_File_Select({accept:".jpg"});
 var file  = files[0];
 
 var data = await Storage_File_Read(file, {whole:true});
 
 var blob = await Document_Image_Resize(data, 
 {
  constraints:
  {
   width:  400, 
   height: 400
  }, 
  
  format:"image/jpg", 
  
  quality:0.5
 });
 
 
 // READ DATA ONLY AND STORE
 if(!user_id) var user_id = User_Id();
 
 var data = await Storage_File_Read(blob, {whole:false}); 
 Storage_File_Upload("propic.jpg", data, "image/jpg", "api.php?direct&f=User_Picture_Upload&id=" + user_id + "", {});
 
 // READ AS A WHOLE INCLUDING BASE64 HEADER, AND DISPLAY ON BIG PICTURE AND PROPIC IN THE MENU BAR
 var picture = await Storage_File_Read(blob, {whole:true});  
 
 if(options["update"]) 
 {
  var elements = options["update"] || [];
  
  for(var element of elements)
  {
   if(options["animate"]) Document_Element_Animate(element, "rubberBand 0.5s linear 1");
   
   element.src = picture;
  }
 }

}// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                         V I D E O                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Video_Load(source)
{
 var video  = await Core_Api("Video_Read", {source});
 var player = UI_Element_Create("video/player");
 
 Core_State_Set("video", "current", video);
 Document_Element_SetObject(player, "video", video);
 
 // SET UP INTERNAL HTML5 PLAYER
 var controller          = UI_Element_Find(player, "video");
 controller.ontimeupdate = Video_OnUpdate;
 Document_Element_SetObject(player,     "controller", controller);
 Document_Element_SetObject(controller, "player",     player);
 
 controller.onended = Video_OnEnd;
 
 
 // SUBTITLES DISPLAY
 var element = UI_Element_Find(player, "subtitles");
 Document_Element_SetObject(player, "display-subtitles", element);
 

 controller.src = video["source"] + "/video.mp4"; 
 
 return player;
}




function Video_Setup(container, player, config = {pause:true, back:true, stop:"", continue:"play", music:true})
{
 Document_Element_SetObject(player, "config", config);
 var video = Document_Element_GetObject(player, "video");
 
 // REARRANGE SUBTITLES
 var lang_content  = config["lang_content"] || "en";
 var lang_user     = config["lang_user"]    || "vn";
 var subtitles     = Safe_Get(video, ["subtitles", lang_content], []);
 var i = 0;
 for(var line of subtitles)
 {
  line["translation"] = Safe_Get(video, ["subtitles", lang_user, i, "text"], "");
  i++;
 }
 video["subtitles"] = subtitles;
 
 
 
 // PURGE VOCAB TERMS
 video["terms"] = video["terms"] || {}; 
 for(var key in video["terms"])
 {
  var purged = Vocabulary_Term_Purge(key);
  
  // REPLACE ITEM BY PURGED KEY VS ORIGINAL KEY
  var item = video["terms"][key];
  delete video["terms"][key];
  video["terms"][purged] = item;
  
  // PRESERVE ORIGINAL KEY INSIDE ITEM
  item["id"] = key;
 }
 var list = Object.keys(video["terms"]);
 
 
 // LINK TERMS
 for(var line of subtitles)
 {
  var analyzed     = String_Analysis_Categorize(line["text"], list);
  line["analysis"] = analyzed;
  line["terms"]    = list;
  
  // DETERMINE IF LINE CONTAINS IMPORTANT CONTENT
  for(var block of analyzed)
  { 
   if(block["type"] == "term")
   {
	line["important"] = true;
	break;
   }
  }
  
  var displaymode     = config["subtitles"] || "none";
  line["displaymode"] = displaymode;
 }
 
 
 
 
 // CONTROLS
 
 // PLAY
 var button           = UI_Element_Find(player, "control-play");
 //button.style.display = "none";
 button.onclick       = Video_Control_Play;
 Document_Element_SetObject(button, "player", player);
 
 // PAUSE
 var button           = UI_Element_Find(player, "control-pause");
 button.style.display = "none";
 button.onclick       = Video_Control_Pause;
 Document_Element_SetObject(button, "player", player);
 
 // BACK
 var button           = UI_Element_Find(player, "control-back");
 button.style.display = "none";
 button.onclick       = Video_Control_Back;
 Document_Element_SetObject(button, "player", player);
 
 // REDO
 var button           = UI_Element_Find(player, "control-redo");
 button.style.display = "none";
 button.onclick       = Video_Control_Redo;
 Document_Element_SetObject(button, "player", player);
 
 // INPUT
 var input      = UI_Element_Find(player, "control-input");
 input.onchange = Video_Control_Input;
 Document_Handler_EnterKey(input, Video_Control_Input);
 
 // RECORD
 var record     = UI_Element_Find(player, "speak");
 record.onclick = Video_Control_Record;
 Document_Element_SetObject(record, "player", player);
 
 
 // STATE
 var state = [];
 Document_Element_SetObject(player, "state", state);
 
 
 // DISPLAY
 container.innerHTML = "";
 container.appendChild(player);
 
 
 // START MUSIC, MUFFLED (VOLUME 0.1)
 if(config["music"])
 {
  var source = Safe_Get(video, ["info", "soundtrack", "source"]);
  if(source)
  {
   state["soundtrack-volume"] = 0.75;
   source                     = Resources_URL("music/" + source);	  
   state["soundtrack"]        = Media_Audio_Play(source, {volume:0.1, loop:true, container:player});
  }
 }
 
 
 // ATTRACT ATTENTION ON PLAY BUTTON
 Document_Element_Animate(UI_Element_Find(player, "control-play"), "heartBeat 2s 2"); 
}




function Video_OnUpdate(event)
{
 var controller = event.srcElement;
 
 var player     = Document_Element_GetObject(controller, "player");
 var video      = Document_Element_GetObject(player, "video");
 var config     = Document_Element_GetObject(player, "config");
 var state      = Document_Element_GetObject(player, "state");
 
 var subtitles  = video["subtitles"];
 var display    = Document_Element_GetObject(player, "display-subtitles");
 
 
 // STOP IMMEDIATELY IF FOR ANY REASON THE UPDATE MESSAGE HAPPENS WHILE THE VIDEO IS ACTUALLY PAUSED
 if(controller.paused) return;
 
 
 
 // GET CURRENT SUBTITLES LINE
 var current_line      = Video_Line_Current(subtitles, controller.currentTime * 1000);
 state["current-line"] = current_line;  
   
 // IF WITHIN A SCRIPT LINE
 if(current_line)
 {  
  if(!state["last-line"] || state["last-line"] != current_line)
  {
   // IF CONFIGURED TO STOP BEFORE EACH LINE, THEN STOP
   if(config["stop"] == "before")
   {
    Video_Pause(player);
	
	Video_Line_Display(current_line, display);
   
    state["last-line"] = current_line;
    return;
   }
   
  }
 }
 else
 // IF BETWEEN LINES
 {
  // IF THERE WAS A LAST LINE, IT MEANS WE A LINE HAS JUST ENDED
  if(state["last-line"])
  {
   
   // IF CONFIGURED TO STOP AFTER EACH LINE, THEN STOP
   if(config["stop"] == "after")
   {
    Video_Pause(player);
       
    state["last-line"] = false;
    return;
   }
   
  }
  else
  // IF NO PRIOR LAST LINE, THEN WE ARE STILL BEFORE THE VERY FIRST. NOTHING TO DO 
  {
  }
 }


 // IF NO CURRENT LINE, CLEAR THE DISPLAY
 if(!current_line)
 {
  display.innerHTML = "";
 }
 
 
 // IF LINE HAS CHANGED, SET LAST LINE TO THIS ONE
 if(current_line && state["last-line"] != current_line) 
 {  
  // IF NEW CURRENT LINE IS IMPORTANT AND CONFIG SAYS TO STOP ON IMPORTANT LINES, STOP
  if(current_line["important"] && config["stop"] == "important")
  {
   Video_Pause(player);	  
  }

  Video_Line_Display(current_line, display);
  
  state["last-line"] = current_line; 
 }
}




function Video_OnEnd(event)
{
 var controller = event.srcElement;
 
 var player     = Document_Element_GetObject(controller, "player");
 var video      = Document_Element_GetObject(player, "video");
 var config     = Document_Element_GetObject(player, "config");
 var state      = Document_Element_GetObject(player, "state");
 
 if(config["onend"]) config["onend"](player);
}







// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                         L I N E S                                              //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

function Video_Line_DisplayNone(line)
{
 return [];
}



// TEXT AS SINGLE BLOCK
function Video_Line_DisplayPlain(line)
{
 var elements = [];
 
 var text    = line["text"];
 var element = UI_Element_Create("video/block-text", {text});
 elements.push(element);
 
 
 return elements;
}


// TEXT AS SINGLE BLOCK, WITH TRANSLATION
function Video_Line_DisplayBoth(line)
{
 var elements = []; console.log(line);
 
 var text        = line["text"];
 var translation = line["translation"]; 
 var element     = UI_Element_Create("video/block-both", {text, translation});
 elements.push(element);
 
 
 return elements;
}



// TEXT AS A SINGLE BLOCK, WITH VISUAL/AUDIO FEEDBACK
function Video_Line_DisplayFeedback(line)
{
 var elements = [];
 
 var text    = line["text"];
 var element = UI_Element_Create("video/block-text", {text});
 elements.push(element);
 
 if(line["match"]) 
 {
  Handler_Element_Feedback(element, "good", {permanent:true});
 }
 else
 {
  Handler_Element_Feedback(element, "bad", {permanent:true});
 }
 
 return elements;
}




// TEXT AS DISTINCT BLOCKS
function Video_Line_DisplayBlocks(line)
{
 var elements = [];
 
 for(var block of line["analysis"])
 {  
  var text = block["text"];
   
  if(text.trim())
  {
   var element = UI_Element_Create("video/block-text", {text});
   elements.push(element);
  }  
 }
 
 return elements;
}




// TEXT AS DISTINCT BLOCKS, WITH VISUAL/AUDIO FEEDBACK
function Video_Line_DisplayMatches(line)
{
 var elements = [];
 
 for(var block of line["analysis"])
 {  
  var text = block["text"];
   
  if(text.trim())
  {
   var element = UI_Element_Create("video/block-text", {text});
   elements.push(element);
   
   if(block["match"]) 
   {
	Handler_Element_Feedback(element, "good", {permanent:true, silent:true});
   }
   else
   {
	Handler_Element_Feedback(element, "bad", {permanent:true, silent:true});
   }
  }  
 }
 
 return elements;
}




// TEXT AS DISTINCT BLOCKS, WITH INTERACTIVE VOCABULARY
function Video_Line_DisplayAnalysis(line)
{
 var elements = [];
 
 for(var block of line["analysis"])
 {
  var type = block["type"];
  var text = block["text"];
  
  if(text.trim())
  {
   var element = UI_Element_Create("video/block-" + type, {text});
   Document_Element_SetObject(element, "block", block);
   
   if(type == "term") 
   {
	element.onclick = Video_Line_DisplayTerm;
   }
   
   elements.push(element);
  }
 
 }
 
 return elements;
}




function Video_Line_Display(line, display, mode)
{
 if(!mode) var mode = line["displaymode"];
 
 var displayer = Safe_Function("Video_Line_Display" + String_Capitalize_Initial(mode)); 
 var elements  = displayer(line);
  
 display.innerHTML = "";
 display.append(...elements);
}




async function Video_Line_DisplayTerm(event)
{
 var element = event.currentTarget;
 var block   = Document_Element_GetObject(element, "block");
 
 var sticker = Document_Element_GetObject(element, "sticker");
 if(sticker) 
 {
  sticker.remove();
  Document_Element_SetObject(element, "sticker", false);
 }
 else
 {
  // CLEAN ALL OTHER STICKERS FIRST 
  UI_Stickers_Clean();
  
  // ADD VOCAB STICKER
  
  // FIND WHAT VOCAB ITEM THIS TEXT CORRESPONDS TO
  var video    = Core_State_Get("video", "current");
  var terms    = video["terms"];
  var vocab_id = terms[block["text"].trim().toLowerCase()];
  
  var sticker = await Vocabulary_Term_Sticker(vocab_id, element, "top", "standard", 
  {
   side_short: 10, 
   side_long:  20, 
   color:      "var(--color-accented)", 
   z:          10000,
   translate:  true,
   listen:     true
  }); 
  
  
  Document_Element_SetObject(element, "sticker", sticker);
 }
}





function Video_Line_Current(lines, time)
{
 for(var line of lines)
 {
  if(time > line["start"] && time < line["end"])
  {
   return line;
   break;
  }	  
 }
 
 return false;
}




function Video_Line_Previous(lines, time)
{
 var previous = false;

 for(var line of lines)
 {
  if(line["end"] < time && (!previous || previous["end"] < line["end"]))
  {
   previous = line; 
  }	  
 }
 
 return previous;
}









// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                       C O M M A N D S                                          //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

function Video_Play(player)
{
 var config = Document_Element_GetObject(player, "config");
 
 UI_Element_Find(player, "curtain").style.visibility = "hidden";
 UI_Element_Find(player, "video").play();
 Video_SetVolume(player, 1);
 
 // HIDE PLAY BUTTON
 UI_Element_Find(player, "control-play").style.display  = "none";
 
 // IF ALLOWED TO PAUSE FREELY, ACTIVATE PAUSE BUTTON UPON PLAY
 if(config["pause"])
 {
  UI_Element_Find(player, "control-pause").style.display = "flex";
 }
 
 // HIDE BACK BUTTON
 UI_Element_Find(player, "control-back").style.display = "none";
 
 // HIDE REDO BUTTON
 UI_Element_Find(player, "control-redo").style.display = "none";
 
 // HIDE SPEAK BUTTON
 UI_Element_Find(player, "speak").style.display = "none";
}





async function Video_Pause(player)
{
 var config = Document_Element_GetObject(player, "config");
 var state  = Document_Element_GetObject(player, "state");
 
 UI_Element_Find(player, "video").pause();
 UI_Element_Find(player, "curtain").style.visibility = "visible";
 Video_SetVolume(player, 0.1);
 
 // CONTINUE OPTIONS
 switch(config["continue"])
 {  
  case "play":
	// JUST HIDE PAUSE AND SHOW PLAY BUTTON
	UI_Element_Find(player, "control-play").style.display  = "flex";
	UI_Element_Find(player, "control-pause").style.display = "none";
  break;
  
  
  case "type":
  	// HIDE SUBTITLES
	UI_Element_Find(player, "subtitles").style.display = "none";
	
	
    // SHOW INPUT FIELD TO ALLOW TYPING
	UI_Element_Find(player, "type").style.display = "flex";
	
	var input = UI_Element_Find(player, "control-input");
	
	Document_Element_SetObject(input, "player", player);
	Document_Element_SetObject(input, "line",   state["last-line"]);
	input.focus();
  break;
  
  
  case "speak":
	//HIDE SUBTITLES
	if(config["subtitles"] == "none") UI_Element_Find(player, "subtitles").style.display = "none";
	
	// SHOW SPEAK FIELD TO ALLOW RECORDING
	var speak = UI_Element_Find(player, "speak");
	speak.style.display     = "flex";
	
	if(config["stop"] == "before") var line = state["current-line"]; else var line = state["last-line"]; 
	
	Document_Element_SetObject(speak, "line", line);
  break;
 }
 
 
 
 // WHEN PAUSED, ALSO ENABLE THE BACK BUTTON, IF ALLOWED
 if(config["back"])
 {
  UI_Element_Find(player, "control-back").style.display = "flex";
 }
}




function Video_Back(player)
{
 var state      = Document_Element_GetObject(player, "state");
 var video      = Document_Element_GetObject(player, "video");
 var config     = Document_Element_GetObject(player, "config");
 var controller = Document_Element_GetObject(player, "controller");
 var display    = Document_Element_GetObject(player, "display-subtitles");
 
 if(!controller.paused) Video_Pause(player);
 display.innerHTML = "";
 
 
 // FIND PREVIOUS LINE
 var line           = Video_Line_Current(video["subtitles"],  controller.currentTime * 1000);
 if(!line) var line = Video_Line_Previous(video["subtitles"], controller.currentTime  * 1000);
 
 
 // INVALIDATE LAST LINE
 state["last-line"] = false;
 
 
 // GO BACK
 if(line)
 {
  controller.currentTime = ((line["start"] - 250) / 1000);
 }
 else
 {
  controller.currentTime = 0;
 }
 
}



function Video_Redo(player)
{
 var state      = Document_Element_GetObject(player, "state");
 var video      = Document_Element_GetObject(player, "video");
 var config     = Document_Element_GetObject(player, "config");
 var controller = Document_Element_GetObject(player, "controller");
 var display    = Document_Element_GetObject(player, "display-subtitles");
 
 display.innerHTML = "";
 
 
 // FIND PREVIOUS LINE
 var line = state["redo"];
 controller.currentTime = ((line["start"] - 250) / 1000);
 
 // IF BY CONFIG WE NEED TO STOP BEFORE EACH LINE, UPON REDOING A LINE WE MUST INVALIDATE LAST-LINE
 if(config["stop"] == "before") state["last-line"] = false;
 
 // HIDE SPEAK BUTTON
 UI_Element_Find(player, "speak").style.display = "none";
 
 UI_Element_Find(player, "control-redo").style.display = "none";
 Video_Play(player);
}




function Video_SetVolume(player, volume)
{
 var state = Document_Element_GetObject(player, "state");
 var audio = Safe_Get(state, ["soundtrack", "audio"]);
 
 if(!audio) return;

 if(!volume) var volume = Safe_Get(state, ["soundtrack-volume"], 0);
 audio["volume"] = volume;
}








// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                     C O N T R O L S                                            //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//

function Video_Control_Play(event)
{
 var button = event.currentTarget;
 var player = Document_Element_GetObject(button, "player");
 
 // A MANUAL PLAY CAUSES SOME ELEMENTS TO RESET
 UI_Element_Find(player, "control-input").value = "";
 
 Video_Play(player);
}




function Video_Control_Pause(event)
{
 var button = event.currentTarget;
 var player = Document_Element_GetObject(button, "player");

 Video_Pause(player);
}



function Video_Control_Back(event)
{
 var button = event.currentTarget;
 var player = Document_Element_GetObject(button, "player");

 Video_Back(player);
}



function Video_Control_Redo(event)
{
 var button = event.currentTarget;
 var player = Document_Element_GetObject(button, "player");

 Video_Redo(player);
}




async function Video_Control_Record(event)
{
 var button  = event.currentTarget;
 var icon    = UI_Element_Find(button, "control-record");
 var player  = Document_Element_GetObject(button, "player");
 var state   = Document_Element_GetObject(player, "state");
 var line    = Document_Element_GetObject(button, "line");
 var display = Document_Element_GetObject(player, "display-subtitles");
 
 state["redo"] = line;
 
 
 // FIRE UP SPEECH RECOGNITION
 var result = await Handler_Speech_Recognition([line["text"]], "en", button, {icon, onend:
 function(result)
 {
 }});
 
 line["match"] = (result["confidence"] >= Module_Config("video", "speech-good", 0.67));
 
 
 // HIDE INPUT
 UI_Element_Find(player, "speak").style.display = "none";
 
 // SHOW FEEDBACK
 UI_Element_Find(player, "subtitles").style.display = "flex";
 Video_Line_Display(line, display, "feedback");
 
 // SHOW PLAY AND REDO BUTTONS
 UI_Element_Find(player, "control-play").style.display = "flex";
 UI_Element_Find(player, "control-redo").style.display = "flex";
}




function Video_Control_Input(event)
{
 var input   = event.currentTarget;
 var player  = Document_Element_GetObject(input,  "player");
 var state   = Document_Element_GetObject(player, "state");
 var line    = Document_Element_GetObject(input,  "line");
 var display = Document_Element_GetObject(player, "display-subtitles");
 
 
 var target_text = line["analysis"];
 var guess_text  = String_Analysis_Categorize(input.value, line["terms"]);
 String_Analysis_StructuredMatch(target_text, guess_text);
 
 UI_Element_Find(player, "type").style.display      = "none";
 UI_Element_Find(player, "subtitles").style.display = "flex";
 
 Video_Line_Display(line, display, "matches");
 state["redo"] = line;
 
 // SHOW PLAY AND REDO BUTTONS
 UI_Element_Find(player, "control-play").style.display = "flex";
 UI_Element_Find(player, "control-redo").style.display = "flex";
 
 //Video_Play(player);
}
// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                       P R A C T I C E                                          //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Vocabulary_Practice(list, index, display, config = {})
{
 // HACKS. REMOVE LATER
 var native_lang  = "vn";//Client_Language_Get();
 var content_lang = config["content_lang"] || "en"; 
 
 var term         = list[index]; console.log(term);
 var text         = Safe_Get(term, ["info", content_lang], "").toLowerCase();
 
 term["display"]  = display;
 term["config"]   = config;
 
 var content = UI_Element_Create("vocabulary/term-practice");
 
 
 // PICTURE
 var element = UI_Element_Find(content, "picture");
 var source  = term["source"] + "/picture.png";
 Document_Image_Load(element, [source]);
 
 Document_Element_SetObject(element, "config", config); 
 Document_Element_SetObject(element, "term",   term);
 Document_Element_SetObject(element, "text",   text);
 
 element.onclick = 
 function(event)
 {
  var element = event.currentTarget;
  var term    = Document_Element_GetObject(element, "term");
  
  Vocabulary_Term_Listen(term);
 }
 
 
 
 // MEANING 
 var element = UI_Element_Find(content, "meaning");
 
 Document_Element_SetObject(element, "config", config); 
 Document_Element_SetObject(element, "term",   term);
 Document_Element_SetObject(element, "text",   text);
 
 for(var item of list)
 { 
  var value = Safe_Get(item, ["info", content_lang], "");
  var itext = Safe_Get(item, ["info", native_lang],  "");
   
  Document_Select_AddOption(element, itext, value);
 }
  
 Document_Element_ShuffleChildren(element); 
 Document_Select_InsertOption(element, "", "");
  
 Safe_Set(term, ["meaning", "element"], Document_Element_FindParent(element, "component", "item"));
 element.value    = "";
 element.onchange = Vocabulary_Practice_Meaning;
 
  
 
  
 // SPELLING
 var element      = UI_Element_Find(content,   "spelling");

 Document_Element_SetObject(element, "config", config); 
 Document_Element_SetObject(element, "term",   term);
 Document_Element_SetObject(element, "text",   text);
  
 Safe_Set(term, ["spelling", "element"], Document_Element_FindParent(element, "component", "item"));
 element.onchange = Vocabulary_Practice_Spelling;
 
 
 
   
 // PRONUNCIATION
 var element     = UI_Element_Find(content,    "record");

 Document_Element_SetObject(element, "config", config); 
 Document_Element_SetObject(element, "term",   term);
 Document_Element_SetObject(element, "text",   text);
  
 Safe_Set(term, ["pronunciation", "element"], Document_Element_FindParent(element, "component", "item")); 
 element.onclick = Vocabulary_Practice_Pronunciation;


  
 // LISTEN
 Vocabulary_Term_Listen(term);
 
 
 // DISPLAY 
 display.innerHTML = "";
 display.appendChild(content);
}





async function Vocabulary_Practice_Meaning(event)
{
 var element    = event.currentTarget;
 var config     = Document_Element_GetObject(element, "config");
 var term       = Document_Element_GetObject(element, "term");
 var text       = Document_Element_GetObject(element, "text");
  
 if(text == element.value.toLowerCase()) var result = 1; else result = 0;
 console.log(text, element.value.toLowerCase());
 
 // STORE RESULT
 Safe_Set(term, ["meaning", "result"], result);
 
 
 // FEEDBACK
 var result = await Vocabulary_Practice_Feedback(term, "meaning", config["mode"]);
 
 // IN PRACTICE MODE, IF BAD RESET AND RETRY
 if(config["mode"] == "practice" && !result)
 {
  element.value = "";
 }

}



async function Vocabulary_Practice_Spelling(event)
{
 var element    = event.currentTarget;
 var config     = Document_Element_GetObject(element, "config");
 var term       = Document_Element_GetObject(element, "term");
 var text       = Document_Element_GetObject(element, "text");
   
 var dist       = String_Analysis_Distance(text.toLowerCase(), element.value.toLowerCase());
 var result     = 1 - dist;
 
 // STORE RESULT
 Safe_Set(term, ["spelling", "result"], result);
 
 
 // FEEDBACK
 var result = await Vocabulary_Practice_Feedback(term, "spelling", config["mode"]);
 
 // IN PRACTICE MODE, IF BAD RESET AND RETRY
 if(config["mode"] == "practice" && !result)
 {
  element.value = "";
 }
 
}




async function Vocabulary_Practice_Pronunciation(event)
{
 var element    = event.currentTarget;
 var config     = Document_Element_GetObject(element, "config");
 var term       = Document_Element_GetObject(element, "term");
 var text       = Document_Element_GetObject(element, "text");
  
 var content_lang = config["content_lang"] || "en"; 
 var icon         = UI_Element_Find(element, "microphone");
 var sentences    = [text];
   
 var result = await Handler_Speech_Recognition(sentences, content_lang, element, {icon});
 result     = result["confidence"] || 0;
 if(result >= Module_Config("vocabulary", "score-soso")) result = 1; else result = 0;
    
 // STORE RESULT
 Safe_Set(term, ["pronunciation", "result"], result);
 
 
 // FEEDBACK
 var result = await Vocabulary_Practice_Feedback(term, "pronunciation", config["mode"]);
 
 // IN PRACTICE MODE, IF BAD RESET AND RETRY
 if(config["mode"] == "practice" && !result)
 {
 }
}




async function Vocabulary_Practice_Feedback(term, component, mode)
{
 var element = Safe_Get(term, [component, "element"]);
 var result  = Safe_Get(term, [component, "result"]);
 
 if(result == 1) var value = "good"; else value = "bad";
 
 var result = false;
 switch(mode)
 {
  case "practice":
	if(value == "good")
	{
     await Handler_Element_Feedback(element, value, {permanent:true});
	 Document_Element_Disable(element);
	 
	 Safe_Add(term, ["attempts"], +1);
	 result = true;
	}
	else
    {
     await Handler_Element_Feedback(element, value);
	 
	 delete term[component]["result"];
	 
	 Safe_Add(term, ["attempts"], +1);
	 Safe_Add(term, ["mistakes"], +1);
	 result = false;
	}
  break;
  
  case "test":
	 await Handler_Element_Feedback(element, value, {permanent:true});
	 Document_Element_Disable(element);
	 
	 if(value == "good") result = true; else result = false;
  break;
 }

 var oncomplete = Safe_Get(term, ["config", "oncomplete"]);
 Vocabulary_Practice_TermComplete(term);
 
 return result;
}



async function Vocabulary_Practice_TermComplete(term)
{
 var config     = term["config"] || {};
 
 var complete   = true;
 var score      = 0;
 
 // CHECK COMPLETION
 var count      = 0;
 var components = ["meaning", "spelling", "pronunciation"];
 for(var component of components)
 {
  if(typeof Safe_Get(term, [component, "result"]) != "undefined")
  {
   score = score + Safe_Get(term, [component, "result"]);
   count = count + 1;
  }
 }
 
 term["completion"] = components.length / count;
 
 
 // COMPLETE?
 if(count == components.length)
 {	 
  if(config["mode"] == "practice")
  {
   term["score"] = (1 - (term["mistakes"] / term["attempts"])) || 0;
  }
  else
  {
   term["score"] = score / count;
  }
  
  var picture = UI_Element_Find(term["display"], "picture");
  Document_CSS_PurgeClasses(picture, "style-blurred");
  
  var oncomplete = config["oncomplete"];
  if(oncomplete) oncomplete(term);
 }
}




function Vocabulary_Practice_Result(list)
{
 var score = 0;
 var data  = [];
 
 for(var term of list)
 {
  score = score + term["score"];
  data.push(
  {
   term:  term["id"],
   score: term["score"] || 0
  });
 }
 
 score = (score / data.length) || 0;
 
 var result = {score, data};
 return result;
}
// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                     V O C A B U L A R Y                                        //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


async function Vocabulary_Term_Read(source)
{
 var term = await Core_Api("Vocabulary_Read_Term", {source:source}); 
 
 return term;
}




async function Vocabulary_Terms_Read(source, list = "vocabulary")
{
 var terms = await Core_Api("Vocabulary_Read_Terms", {terms:list, source:source}); 
 
 return terms;
}




async function Vocabulary_Term_Display(term, template = "standard", options = {})
{
 var content_lang = "en";  // HACK, TO BE CHANGED LATER    
 var user_lang    = "vn";  // HACK, TO BE CHANGED LATER
 
 
 // IF TERM IS A STRING RATHER THAN AN OBJECT, THEN WE INTERPRET IT AS A SINGLE VOCABULARY TERM TO BE LOADED FROM THE GLOBAL VOCABULARY
 if(typeof term == "string")
 {
  var term = await Vocabulary_Term_Read("content/vocabulary/" + term); 
 }
	

 // IF OPTIONS SPECIFY "HTML" THEN WE ARE PASSING EXPLICIT HTML IN "TEMPLATE" AND WE USE THAT TO BUILD THE DISPLAY	
 // THIS IS USED WHEN VOCABULARY_DISPLAY IS BUILDING A DISPLAY WITH SEVERAL TERMS AND USING A DYNAMIC TEMPLATE FROM CONTENT/TEMPLATES
 if(options["html"])
 {
  var display = UI_Element_Create(template, {}, {html:true});
 }
 else
 {
  var display = UI_Element_Create("vocabulary/term-" + template);
 }
 
 Document_Element_SetObject(display, "term", term);
 
 
 
 // PICTURE
 // Picture-Background is a clone used to display a copy of the picture as background in some special cases/templates
 for(var component of ["picture", "picture-background"])
 {
  var picture = UI_Element_Find(display, component);
  if(picture)
  {
   await Document_Image_Load(picture, [term["source"] + "/picture.png"], {nocache:true, waitloaded:true});
   Document_Element_SetObject(picture, "term", term);
   
   picture.onclick = 
   function(event)
   {
    var element = event.currentTarget;
    var term    = Document_Element_GetObject(element, "term");
    
    Vocabulary_Term_Listen(term);
   }
  } 
 }
 
 
 // TEXT
 var text = UI_Element_Find(display, "text");
 if(text) 
 {
  var info       = term["info"] || {};
  var word       = UI_Language_Object(info, "", undefined, content_lang)
  text.innerHTML = word;
 
  Document_Element_SetObject(text, "term", term);
  Document_Element_SetData(text,   "lang", content_lang);

  text.onclick = Vocabulary_Term_ShowTranslation; 
 }
 
 
 
 // EXAMPLE
 var example = UI_Element_Find(display, "example");
 if(example)
 {
  example.innerHTML = UI_Language_Object(term["example 00"]);
 }
 
 
 
 return display;
}





async function Vocabulary_Term_Sticker(term, element, corner, template = "standard", options = {side_short:10, side_long:20, color:"var(--color-accented)", z:1000})
{
 var display  = await Vocabulary_Term_Display(term, template); 
 var term     = Document_Element_GetObject(display, "term");
 var frame    = UI_Sticker_Frame("frame-bubble-" + corner, display, options); 
 
 var sticker  = UI_Sticker(element, frame, {corner:corner, z:options["z"]});
 Document_Element_SetObject(sticker, "term", term);
 

 if(options["translate"]) 
 {
  var text = UI_Element_Find(sticker, "text");
  Vocabulary_Term_ShowTranslation({currentTarget:text});
 }
 
 
 if(options["listen"])
 {
  Vocabulary_Term_Listen(term);
 }
 
 
 return sticker;
}




async function Vocabulary_Term_Listen(term)
{
 var content_lang = "en";      
 var user_lang    = Client_Language_Get();
 
 if(term["audio"]) 
 // USE SAMPLED AUDIO
 {
  await Media_Audio_Play(term["audio"]);
 }
 else
 // USE SPEECH SYNTHESIS	  
 {
  var text = UI_Language_Object(term["info"], undefined, undefined, content_lang);
  await Media_Speech_Speak(text, "en-us", {rate:0.5});
 }
}




async function Vocabulary_Term_ShowTranslation(event)
{
 var element = event.currentTarget;
 var term    = Document_Element_GetObject(element, "term");
 
 var content_lang = "en";      
 var user_lang    = "vn";
 
 var lang = Document_Element_GetData(element, "lang");
 if(lang == user_lang) lang = content_lang; else lang = user_lang;
  
 Document_Element_Animate(element, "flip 1s");
 await Client_Wait(0.5);
 element.innerHTML = UI_Language_Object(term["info"], undefined, undefined, lang);
  
 Document_Element_SetData(element, "lang", lang);
}





function Vocabulary_Term_Purge(term)
{
 var splitter = false;
 for(var char of ["_", "-"])
 {
  if(term.includes(char))
  {
   splitter = char;
   break;
  }
 }
 
 if(!splitter) return term;
 
 term = term.split(splitter);
 return term[0];
}



async function Vocabulary_Display(terms, template = "standard")
{
 // SPECIAL CASE: "DYNAMIC" TEMPLATE WILL READ DYNAMIC TEMPLATE FILES FROM THE CONTENT FOLDER
 if(template == "dynamic")
 {
  var html      = await Core_Api("Content_Templates_Read", {files:["vocabulary/display", "vocabulary/term"]});
  var display   = UI_Element_Create(html["vocabulary/display"], {}, {html:true});
 }
 else
 // STANDARD BUILT-IN TEMPLATES
 {
  var display   = UI_Element_Create("vocabulary/display-" + template);
 }
 
 var container = UI_Element_Find(display, "lines") || display;
 
 // IF SOURCE IS NOT AN EXPLICIT LIST OF TERMS, BUT RATHER A PATH TO READ THEM
 if(typeof terms == "string")
 {
  var terms = await Vocabulary_Terms_Read(terms);
 }
 

 for(var id in terms)
 {
  var term = terms[id];
  
  // SPECIAL CASE: "DYNAMIC" TEMPLATE WILL READ DYNAMIC TEMPLATE FILES FROM THE CONTENT FOLDER (ALREADY LOADED ABOVE)
  if(template == "dynamic")
  {
   var row = await Vocabulary_Term_Display(term, html["vocabulary/term"], {html:true});
  }
  else
  {
   var row = await Vocabulary_Term_Display(term, "line");
  }
  
  container.appendChild(row);
 }
 
 return display;
}


// -----------------------------------------------------------------------------------------------//
//                                                                                                //
//                                    W H I T E B O A R D                                         //
//                                                                                                //
// -----------------------------------------------------------------------------------------------//


function Whiteboard_Create(container, events = {}, options = {fps:24, model:"whiteboard"})
{
 var whiteboard = UI_Element_Create("whiteboard/" + options["model"] || "whiteboard");
 container.appendChild(whiteboard);
  
 var canvas           = UI_Element_Find(whiteboard, "canvas");
 var handle           = canvas.getContext("2d");
 var size             = Document_Element_Size(canvas);
 handle.canvas.width  = size["width"];
 handle.canvas.height = size["height"];
 
 Document_Element_SetObject(whiteboard, "canvas", canvas);
 Document_Element_SetObject(whiteboard, "handle", handle);
 Document_Element_SetObject(whiteboard, "events", events);
 
 Whiteboard_SetPen(whiteboard);

 
 whiteboard.onmousedown = Whiteboard_Draw_Start;
 whiteboard.onmouseup   = Whiteboard_Draw_End;
 whiteboard.onmousemove = Whiteboard_Draw_Draw;
 
 //var fps                = options["fps"] || 24;
 //whiteboard.onmousemove = Function_ThrottleEvent(Whiteboard_Draw_Draw, 1000 / fps);
 
 var container = UI_Element_Find(whiteboard, "tools");
 var pens      = Core_Data_Page("whiteboard/pens");
 for(var id in pens)
 {
  var pen                   = pens[id];
  
  var tip                   = UI_Element_Create("whiteboard/tip-" + pen["type"]);
  tip.style.position        = "relative";
  tip.style.width           = "16px";
  tip.style.backgroundColor = RgbaToRgb(pen["color"]);
  tip.style.outline         = "solid 2px";
  tip.style.outlineColor    = "var(--color-dark)";
  tip.title                 = UI_Language_Object(pen);
  
  Document_CSS_SetClass(tip, "style-clickable");
  Document_CSS_SetClass(tip, "style-selectable");

  Document_Element_SetData(tip, "name", id);
  Document_Element_SetObject(tip, "whiteboard", whiteboard);
  
  tip.onclick = 
  function(event)
  {
   var element    = event.currentTarget;
   var name       = Document_Element_GetData(element, "name");
   var whiteboard = Document_Element_GetObject(element, "whiteboard");
   
   Media_Audio_Play(Resources_URL("sounds/click.mp3"));
   Document_Element_Animate(element, "rubberBand 0.5s");
   Whiteboard_SetPen(whiteboard, name);
  }
  
  container.appendChild(tip);
 }
 
 return whiteboard;
}



function Whiteboard_Canvas_Store(whiteboard, name)
{
 var canvas = Document_Element_GetObject(whiteboard, "canvas");
 var image  = canvas.toDataURL("image/png");
 
 Document_Element_SetObject(whiteboard, name, image);
 
 return image;
}



function Whiteboard_Canvas_Recall(whiteboard, name)
{
 var data = Document_Element_GetObject(whiteboard, name);
 if(!data) return;
  
 var handle   = Document_Element_GetObject(whiteboard, "handle");
 var image    = new Image();
 image.onload =
 function()
 {  
  handle.clearRect(0, 0, handle.canvas.width, handle.canvas.height);
  handle.drawImage(image, 0, 0);
 }
 
 image.src  = data; 
}



function Whiteboard_Canvas_Erase(whiteboard)
{
 var handle = Document_Element_GetObject(whiteboard, "handle");
 handle.clearRect(0, 0, handle.canvas.width, handle.canvas.height);
 
 
 // ONERASE
 var events = Document_Element_GetObject(whiteboard, "events");
 var f      = Safe_Get(events, "onerase", false);
 if(f) f(whiteboard);
}




function Whiteboard_SetPen(whiteboard, set = {type:"round", size:8, color:"black", mode:"source-over"})
{
 if(typeof set == "string")
 {
  var pens = Core_Data_Page("whiteboard/pens");
  var set  = pens[set] || {};
 }
	
 var pen = Document_Element_GetObject(whiteboard, "pen") || {};
 Object.assign(pen, set);
 
 Document_Element_SetObject(whiteboard, "pen", pen);
 
 var tip = UI_Element_Create("whiteboard/tip-" + pen["type"]);
 Document_Element_SetObject(whiteboard, "tip", tip);
 tip.style.width           = pen["size"] + "px";
 tip.style.backgroundColor = pen["color"];
 
 var overlay       = UI_Element_Find(whiteboard, "overlay");
 overlay.innerHTML = "";
 overlay.appendChild(tip);
 
 var handle     = Document_Element_GetObject(whiteboard, "handle");
 handle.lineCap = pen["type"];
 
 handle.globalCompositeOperation = pen["mode"];
}


 
 
function Whiteboard_Draw_Start(event)
{
 var whiteboard = event.currentTarget;
 var canvas = Document_Element_GetObject(whiteboard, "canvas");
 
 Document_Element_SetData(whiteboard, "status", "draw");

 var rect     = whiteboard.getBoundingClientRect();
 var pointer  = {};
 var heightfullscreen = 0;
 var widthfullscreen = 0;
 if(document.fullscreenElement)
 {
    heightfullscreen = rect.height - canvas.height; 
    widthfullscreen = rect.width  - canvas.width;
 }
 pointer["x"] = event.clientX - rect.left - (event.clientX * widthfullscreen / rect.width);
 pointer["y"] = event.clientY - rect.top - (event.clientY * heightfullscreen / rect.height);
 
 Document_Element_SetObject(whiteboard, "pointer", pointer);
 
 
 // ONDRAWSTART
 var events = Document_Element_GetObject(whiteboard, "events");
 var f      = Safe_Get(events, "ondrawstart", false);
 if(f) f(whiteboard);
}

 
 
 
function Whiteboard_Draw_End(event)
{
 var whiteboard = event.currentTarget;
 
 Document_Element_SetData(whiteboard, "status", "");
 
 
 // ONDRAWEND
 var events = Document_Element_GetObject(whiteboard, "events");
 var f      = Safe_Get(events, "ondrawend", false);
 if(f) f(whiteboard);
}

 
 
 
 
function Whiteboard_Draw_Draw(event)
{  
 var whiteboard = event.currentTarget || event.srcElement;
 if(!whiteboard)
 {
  //event.preventDefault();
  return;
 }
 

 
 var tip  = Document_Element_GetObject(whiteboard, "tip");
 var size = Document_Element_Size(tip);
 var rect = whiteboard.getBoundingClientRect();
 
 var left = (event.clientX - rect.left - (size["width"] / 2))  + "px";
 var top  = (event.clientY - rect.top  - (size["height"] / 2)) + "px";
 
 tip.style.left = left;
 tip.style.top  = top;
 
 
 var status = Document_Element_GetData(whiteboard, "status");
 var canvas = Document_Element_GetObject(whiteboard, "canvas");

 switch(status)
 {
  case "draw":
	var handle  = Document_Element_GetObject(whiteboard, "handle");
	var pointer = Document_Element_GetObject(whiteboard, "pointer");
    var pen     = Document_Element_GetObject(whiteboard, "pen");
     
	handle.beginPath();
	handle.strokeStyle = pen["color"];
	handle.lineWidth   = pen["size"];
	handle.moveTo(pointer["x"], pointer["y"]);
 
  var heightfullscreen = 0;
  var widthfullscreen = 0;
  if(document.fullscreenElement)
  {
    heightfullscreen = rect.height - canvas.height; 
    widthfullscreen = rect.width  - canvas.width;
  }
	pointer["x"] = event.clientX - rect.left - (event.clientX * widthfullscreen / rect.width);
	pointer["y"] = event.clientY - rect.top -(event.clientY * heightfullscreen / rect.height);
 
	handle.lineTo(pointer["x"], pointer["y"]);
	handle.stroke();
  break;
 }
 
 
 // ONDRAW
 var events = Document_Element_GetObject(whiteboard, "events");
 var f      = Safe_Get(events, "ondraw", false);
 if(f) f(whiteboard);
}

function RgbaToRgb(string){
  if(string.includes("rgb"))
  { 
    var array = string.split(",");
    return "rgb(" + (array[0].match(/(\d+)/))[0] + "," + parseFloat(array[1]) + "," + parseFloat(array[2]) + ")";
  }else return string;
}async function Inventory_Admin() {
  Core_State_Set("inventory", "inventory-table-header", [
    UI_Language_String("inventory/module", "table no"),
    UI_Language_String("inventory/module", "table item code"),
    UI_Language_String("inventory/module", "table item name"),
    UI_Language_String("inventory/components/module", "search group"),
    UI_Language_String("inventory/components/module", "search program"),
    UI_Language_String("inventory/components/module", "search level"),
  ]);

  var module = Core_State_Get("inventory", "container");
  const container = UI_Element_Find(module, "inventory-admin");

  const itemDetailContainer = UI_Element_Create(
    "inventory/components/inventory-detail",
    {
      btnAction: UI_Language_String("inventory/module", "button save"),
    }
  );

  // Init search UI
  const groupPrograms = Core_State_Get("inventory", "groupPrograms");
  const searchElement = createSearchElement("admin", {
    showCenter: false,
    showProgram: false,
    onSearch: (e) => { btnClicked(e,"admin");  showItemsAdminTable(); },
    programData: groupPrograms,
  });

  const exportButton = UI_Element_Create("core/button-small-stretch",{text:UI_Language_String("inventory/components/module","button export")});
  Document_Element_SetObject(exportButton, "state", "admin");
  exportButton.onclick = (e) => { exportExecl(e);}
  UI_Element_Find(searchElement, "action-container").appendChild(exportButton);

  const loadDataButton = UI_Element_Create("core/button-small-stretch",{text:UI_Language_String("inventory/components/module","button load")});
  loadDataButton.style.justifyContent = "space-around";
  loadDataButton.onclick = async function(){
    var div = document.createElement("div");
    div.classList.add("loader");
    div.style.cssText = " font-size: 4px; position: absolute; margin-left: 200px";
    loadDataButton.appendChild(div);
    
    var updateStatus = await Core_Api("Inventory_Items_Create_Update_FromD365&filter=true");
    if(updateStatus)
    {
      loadDataButton.removeChild(loadDataButton.firstElementChild);
      //UPDATE GROUP DATA
      var groups = await Core_Api("Inventory_Get_Groups_Item");
      Core_State_Set("inventory", "groups", groups);
      reloadGroupsData()
      showItemsAdminTable();
      showAlertMessage("Data has been updated");
    }
    else showAlertMessage("No Data has been updated!!");
  }
  UI_Element_Find(searchElement, "action-container").appendChild(loadDataButton);
  
  container.appendChild(searchElement);

  // Init List Item
  const itemListContainer = UI_Element_Create(
    "inventory/components/inventory-list"
  );
  container.appendChild(itemListContainer);

  container.appendChild(itemDetailContainer);
  UI_Element_Find(itemDetailContainer, "btn-action").onclick = updateItemInfo;
  UI_Element_Find(itemDetailContainer, "btn-export").style.display = "none";
}

async function showItemsAdminTable() {
  var module = Core_State_Get("inventory", "container");
  const container = UI_Element_Find(module, "inventory-admin");
  UI_Element_Find(container, "item-detail").style.visibility = "hidden";

  const itemListContainer = UI_Element_Find(container, "item-list-container");
  itemListContainer.style.visibility = "visible";
  itemListContainer.innerHTML = "";
  const itemlist = document.createElement("div");
  itemlist.classList.add("container-column");
  itemlist.style.width = "100%";
  itemlist.style.overflow = "hidden auto";
  itemListContainer.appendChild(itemlist);
  const table = UI_Table("standard", { fixed: true });
  itemlist.appendChild(table);

  const headerRow = UI_Table_Row(table);
  headerRow.style.position = "sticky";
  headerRow.style.top = 0;

  // CREATE TABLE HEADER
  var header = Core_State_Get("inventory", "inventory-table-header");
  header.forEach((item) => {
    const cell = UI_Table_Cell(headerRow, { type: "header" });
    cell.innerHTML = item;
  });

    const data =
    (await Core_Api("Inventory_Items_Search", {
      search: {
        group: Core_State_Get("inventory", ["admin", "group"]),
        program: Core_State_Get("inventory", ["admin", "program"]),
        level: Core_State_Get("inventory", ["admin", "level"]),
      },
    })) || [];

  Core_State_Set("inventory", ["admin", "items"], data);
  Core_State_Set("inventory", ["admin", "selectedItemIndex"], null);

  if (data && data.length > 0) {
    for (let i = 0; i < data.length; i++) {
      const { item_name = "", available = "", item_code = "" ,item_group = "", unit = "", program = "", level = ""} = data[i];
      const row = UI_Table_Row(table, { selectable: true }, () =>
        itemAdminDetail(i)
      );
      const noCell = UI_Table_Cell(row);
      noCell.innerHTML = i + 1;

      var itemCodeCell = UI_Table_Cell(row);
      itemCodeCell.innerHTML = item_code;

      var itemNameCell = UI_Table_Cell(row);
      itemNameCell.innerHTML = item_name;

      var groupCell = UI_Table_Cell(row);
      groupCell.innerHTML = item_group;

      var programCell = UI_Table_Cell(row);
      programCell.innerHTML = program;

      var levelCell = UI_Table_Cell(row);
      levelCell.innerHTML = level;
    }
  } else {
    const row = UI_Table_Row(table);
    const messageCell = UI_Table_Cell(row);
    messageCell.colSpan = header.length;
    messageCell.style.height = "300px";
    messageCell.innerText = "No items";
  }
}

function itemAdminDetail(index) {
  Core_State_Set("inventory", ["admin", "selectedItemIndex"], index);
  const item = Core_State_Get("inventory", ["admin", "items"])[index];
  const { item_code, item_name, item_group, program, level } = item || {};

  var module = Core_State_Get("inventory", "container");
  const container = UI_Element_Find(module, "inventory-admin");
  const itemDetailContainer = UI_Element_Find(container, "item-detail");
  itemDetailContainer.style.visibility = "visible";
  const itemInfoContainer = UI_Element_Find(itemDetailContainer, "item-info");
  itemInfoContainer.innerHTML = "";

  [
    {
      value: item_code,
      name: "code",
    },
    {
      value: item_name,
      name: "name",
    },
    {
      value: item_group,
      name: "group",
    },
    {
      value: program,
      name: "program",
    },
    {
      value: level,
      name: "level",
    },
  ].forEach((item) => {
    Core_State_Set(
      "inventory",
      ["admin", "item-detail", item.name],
      item.value
    );
  });

  // ITEM CODE
  var code = UI_Element_Create("core/control-box-plain");
  code.innerHTML = item_code;

  codedetail = UI_Element_Create("inventory/components/item-detail", {
    label: UI_Language_String("inventory/module", "table item code"),
  });
  codedetail.appendChild(code);
  itemInfoContainer.appendChild(codedetail);

  // ITEM NAME
  var name = UI_Element_Create("core/control-edit-plain");
  name.value = item_name;
  name.onchange = (e) => {
    Core_State_Set(
      "inventory",
      ["admin", "item-detail", "name"],
      e.target.value
    );
  };
  namedetail = UI_Element_Create("inventory/components/item-detail", {
    label: UI_Language_String("inventory/module", "table item name"),
  });
  namedetail.appendChild(name);
  itemInfoContainer.appendChild(namedetail);

  // SELECT GROUP
  var group = UI_Element_Create("core/control-dropdown-plain");
  Document_Select_OptionsFromObjects(
    group,
    Core_State_Get("inventory", "groups"),
    "item_group",
    false
  );
  group.dataset.uid = "item-info-group";
  group.value = item_group;
  group.onchange = (e) => {
    Core_State_Set(
      "inventory",
      ["admin", "item-detail", "group"],
      e.target.value
    );
  };
  groupdetail = UI_Element_Create("inventory/components/item-detail", {
    label:  UI_Language_String("inventory/module", "change group"),
  });
  groupdetail.appendChild(group);
  itemInfoContainer.appendChild(groupdetail);

  // PROGRAM
  const programs = Core_State_Get("inventory", "groupPrograms");
  const programElement = UI_Element_Create("core/control-dropdown-plain");
  programElement.dataset.uid = "search-program";
  Document_Select_AddOption(
    programElement,
    UI_Language_String("inventory", "search any"),
    "Any"
  );
  Document_Select_AddOption(programElement, "---", "").disabled = true;
  Document_Select_OptionsFromObjects(programElement, programs, "name", false);
  programElement.value = program ?? "Any";

  Core_State_Set(
    "inventory",
    ["admin", "item-detail", "program"],
    programElement.value
  );
  programElement.onchange = (e) => {
    Core_State_Set(
      "inventory",
      ["admin", "item-detail", "program"],
      e.target.value
    );
    displayLevels(
      itemInfoContainer,
      ["admin", "item-detail"],
      e.target.value,
      programs
    );
  };

  const programContainer = UI_Element_Create(
    "inventory/components/item-detail",
    {
      label: UI_Language_String("inventory/module", "change program"),
    }
  );
  programContainer.appendChild(programElement);
  itemInfoContainer.appendChild(programContainer);

  // LEVELS
  const levelElement = UI_Element_Create("core/control-dropdown-plain");
  levelElement.dataset.uid = "search-levels";
  const levelContainer = UI_Element_Create("inventory/components/item-detail", {
    label:  UI_Language_String("inventory/components/module", "search level"),
  });
  levelContainer.appendChild(levelElement);
  itemInfoContainer.appendChild(levelContainer);

  displayLevels(
    levelContainer,
    ["admin", "item-detail"],
    programElement.value,
    programs
  );
  levelElement.value = level ?? "";
}

async function updateItemInfo() {
  const isAccept = await UI_Popup_Confirm(
    UI_Language_String("inventory/module", "update information"),
    UI_Language_String("inventory/module", "update confirm text"),
  );
  if (!isAccept) return;

  const itemDetail = Core_State_Get("inventory", ["admin", "item-detail"]);

  res = await Core_Api("Inventory_Item_Update", {
    item: {
      item_code: itemDetail.code,
      item_group: itemDetail.group,
      item_name: itemDetail.name,
      program: itemDetail.program,
      level: itemDetail.level,
    },
  });
  if (res) {
    showAlertMessage("Update Item SuccessFuly !");
    showItemsAdminTable();
    var module = Core_State_Get("inventory", "container");
    const container = UI_Element_Find(module, "inventory-admin");
    UI_Element_Find(container, "item-detail").style.visibility = "visible";
  } else {
    showAlertMessage("Operation error !!!");
  }
}

let previousCourseItem;

async function Inventory_Assignment() {
  const inventoryContainer = Core_State_Get("inventory", "container");

  const assignmentPage = UI_Element_Find(
    inventoryContainer,
    "assignment-container"
  );
  Core_State_Set("inventory", ["assignment", "container"], assignmentPage);

  // ADD SEARCH VIEW
  const searchElement = createSearchElement("assignment", {
    onSearch: (e) => {
      btnClicked(e, "assignment");
      onAssign();
    },
    showDate: true,
    btnTitle: UI_Language_String("inventory/module", "button-assign"),
  });
  const btnTakeback = UI_Element_Create("core/button-small-stretch", {
    text: UI_Language_String("inventory/module", "button take back"),
  });
  btnTakeback.onclick = (e) => {
    btnClicked(e, "assignment");
    onTakeBack();
  };
  UI_Element_Find(searchElement, "action-container").appendChild(btnTakeback);

  // ADD LIST VIEW
  const courseListContainer = UI_Element_Create(
    "inventory/components/inventory-list"
  );
  courseListContainer.dataset.uid = "course-list-container";
  courseListContainer.style.width = "300px";
  courseListContainer.style.flex = "";

  const itemsListContainer = UI_Element_Create(
    "inventory/components/inventory-list"
  );

  const detailContainer = UI_Element_Create(
    "inventory/components/inventory-detail",
    {
      btnAction: UI_Language_String("inventory/module", "button save"),
    }
  );
  detailContainer.style.flex = "1";
  UI_Element_Find(detailContainer, "btn-action").onclick = onSaveData;

  assignmentPage.appendChild(searchElement);
  assignmentPage.appendChild(courseListContainer);
  assignmentPage.appendChild(itemsListContainer);
  assignmentPage.appendChild(detailContainer);
}

async function onTakeBack() {
  Core_State_Set("inventory", ["assignment", "action"], "take-back");
  clearUI();
  const courses = await fetchCourses();
  onDisplayCourses(courses, {
    onClickCourse: async () => {
      const data = await fetchUsersAndItems().then((res) => {
        const assignedUser = res["items_users"]?.reduce((result, item) => {
          const key = `${item["user_id"]}`;
          if (result[key]) {
            result[key] = {
              ...result[key],
              [item["item_code"]]: item,
            };
          } else {
            result[key] = {
              [item["item_code"]]: item,
            };
          }

          return result;
        }, {});
        return {
          items: res["items"],
          users: res["users"],
          assignedUser: assignedUser,
        };
      });
      Core_State_Set("inventory", ["assignment", "items_users"], data);
      showStudentsForReturning();
    },
  });
}

async function onAssign() {
  Core_State_Set("inventory", ["assignment", "action"], "assign");
  clearUI();
  const courses = await fetchCourses();
  onDisplayCourses(courses, {
    onClickCourse: async () => {
      const response = await fetchUsersAndItems();

      const assignedUser = response["items_users"]?.reduce((result, item) => {
        const key = `${item["item_code"]}-${item["user_id"]}`;
        result[key] = item;
        return result;
      }, {});

      const data = {
        items: response["items"],
        users: response["users"],
        assignedUser: assignedUser,
      };
      Core_State_Set("inventory", ["assignment", "items_users"], data);
      showItemsForAssigning();
    },
  });
}

async function onSaveData(e) {
  let {
    action,
    selectItemIdx,
    selectStudents,
    center,
    items_users,
    takebackItems,
    takebackStudent,
  } = Core_State_Get("inventory", ["assignment"]);

  switch (action) {
    case "take-back": {
      if (!takebackStudent || !takebackItems || takebackItems.length == 0) {
        showAlertMessage(
          UI_Language_String("inventory/module", "alert message please", {
            text: UI_Language_String("inventory/module", "table take back"),
          }),
          "info"
        );
        return;
      }

      const isAccept = await UI_Popup_Confirm(
        UI_Language_String("inventory/module", "popup confirm", {
          text: UI_Language_String("inventory/module", "popup take back"),
        }),
        UI_Language_String("inventory/module", "popup confirm text", {
          text: UI_Language_String("inventory/module", "popup take back"),
        })
      );
      if (!isAccept) return;

      const { data, error } = await Core_Api("Inventory_TakeBack", {
        item_codes: takebackItems,
        userid: takebackStudent["id"],
        center_code: center,
      });

      if (error) {
        showAlertMessage(error, "error");
      } else {
        showAlertMessage(
          UI_Language_String("inventory/module", "table take back") +
            " " +
            UI_Language_String("inventory/module", "alert success")
        );
      }
      takebackItems.forEach((item) => {
        delete items_users["assignedUser"][takebackStudent["id"]][item];
      });
      Core_State_Set("inventory", ["assignment", "items_users"], items_users);
      showItemsForReturning();
      return;
    }
    case "assign": {
      if (!selectItemIdx || !selectStudents || selectStudents.length == 0) {
        showAlertMessage(
          UI_Language_String("inventory/module", "alert message please", {
            text: UI_Language_String("inventory/module", "table assign"),
          }),
          "info"
        );
        return;
      }

      const currentItem = items_users["items"]?.[selectItemIdx];

      const { popup, continueBtn, messageText } = await showPopupConfirmX(
        UI_Language_String("inventory/module", "table assign"),
        UI_Language_String("inventory/module", "popup confirm text", {
          text: UI_Language_String("inventory/module", "popup assign"),
        }),
        {
          action: async () => {
            return await Core_Api("Inventory_Assign_ItemStudents", {
              item_code: currentItem?.["item_code"],
              users: selectStudents.map((userId) => ({
                id: userId,
                isAssigned: true,
              })),
              center_code: center,
            });
          },
          onFailure: (error) => {
            console.log(error);
            return error;
          },
          onSuccess: (data) => {
            var {
              newQuantity,
              assignedStudents = [],
              unassignedStudents = [],
              message,
            } = data;

            if (assignedStudents.length > 0) {
              selectStudents.forEach((userId) => {
                if (unassignedStudents.indexOf(userId) < 0) {
                  items_users["assignedUser"][
                    `${currentItem["item_code"]}-${userId}`
                  ] = {
                    user_id: userId,
                    item_code: currentItem["item_code"],
                  };
                }
              });

              currentItem["available"] = newQuantity;
              items_users["items"][selectItemIdx] = currentItem;

              Core_State_Set(
                "inventory",
                ["assignment", "items_users"],
                items_users
              );

              showItemsForAssigning();
              showStudentsForAssigning();

              if (unassignedStudents.length == 0) {
                showAlertMessage(
                  UI_Language_String("inventory/module", "table assign") +
                    " " +
                    UI_Language_String("inventory/module", "alert success")
                );
                UI_Popup_Close(popup);
              } else {
                const users = Core_State_Get("inventory", [
                  "assignment",
                  "items_users",
                  "users",
                ]);

                const failureUsers = users.reduce((result, item) => {
                  if (unassignedStudents.includes(item.id)) result.push(item);
                  return result;
                }, []);

                let userStr = failureUsers
                  .map(
                    ({ id, firstname, lastname }) =>
                      `<li>[${id} - ${firstname}${lastname}]</li>`
                  )
                  .join(" ");

                messageText.innerHTML = `Having some errors with these students: <br/><ul style="text-align:left">${userStr}</ul>`;
                continueBtn.innerText = "Try Again";
                selectStudents = unassignedStudents;
              }
              return;
            }

            // Can not assgin to any student
            if (unassignedStudents.length > 0 && assignedStudents.length == 0) {
              messageText.innerHTML = `All students can not be assigned: <br/><p style="text-align:left">Error: ${message}</p>`;
              continueBtn.innerText = "Try Again";
              return;
            }
          },
        }
      );
      return;
    }
  }
}

function clearUI() {
  const { container } = Core_State_Get("inventory", ["assignment"]);
  UI_Element_Find(container, "item-list-container").style.visibility = "hidden";
  const detailContainer = UI_Element_Find(container, "item-detail");
  detailContainer.style.visibility = "hidden";
  UI_Element_Find(detailContainer, "btn-action").classList.remove(
    "style-disabled"
  );
}

async function fetchCourses() {
  const { center, level, program, date, date_mode } = Core_State_Get(
    "inventory",
    ["assignment"]
  );
  const courses = await Core_Api("Courses_List", {
    centers: [center],
    level,
    program,
    order: "date_start DESC",
    status: false,
    date_mode,
    date: Date_From_Input(date),
  });
  return courses;
}

async function fetchUsersAndItems() {
  const { selectedCourse } = Core_State_Get("inventory", ["assignment"]);
  const { level, program: courseProgram, id } = selectedCourse;
  const programConfigs = Core_Config("programs");
  const group = Core_State_Get("inventory", ["assignment", "group"], "");
  const data = await Core_Api("Inventory_Assignment_Items_Users", {
    group: group,
    level,
    program: programConfigs[courseProgram]?.["program"] || "",
    course_id: id,
  });
  return data;
}

async function onDisplayCourses(courses, { onClickCourse = null } = {}) {
  const { container } = Core_State_Get("inventory", ["assignment"]);

  const courseListContainer = UI_Element_Find(
    container,
    "course-list-container"
  );
  courseListContainer.innerHTML = "";
  if (courses && courses.length > 0) {
    courseListContainer.style.visibility = "visible";
  } else {
    courseListContainer.style.visibility = "hidden";
    return;
  }

  const locale = UI_Language_Current(true);
  const centers = Core_Config("centers");
  const programs = Core_Config("programs");

  courses.forEach((course) => {
    const days = [];
    course["schedule"]?.forEach((item) => {
      const day = Date_Weekday_Name(item["day"], "short", locale);
      const time = Time_From_Minutes(item["time"]);
      days.push(day + " " + time);
    });

    const courseItem = UI_Element_Create("inventory/components/course-item", {
      name: course["name"] || "#" + course["id"],
      date: UI_Language_Date(course["date_start"], "monthdayyear-compact"),
      center: Safe_Get(
        centers,
        [course["center_id"], "name"],
        course["center_id"]
      ),
      days: days.join(", "),
      program:
        Safe_Get(programs, [course["program"], "name"], course["program"]) ||
        "no program",
      level: course["level"] || "no level",
      seats_taken: course["seats"]["taken"] || 0,
      seats_total: course["seats"]["total"] || 0,
      classes_taken: course["classes"]["taken"] || 0,
      classes_total: course["classes"]["total"] || 0,
    });
    Document_Element_SetData(courseItem, "course_id", course["id"]);
    courseItem.onclick = (event) => {
      if (previousCourseItem) {
        previousCourseItem.classList.toggle("style-outlined-accented");
      }
      courseItem.classList.toggle("style-outlined-accented");
      previousCourseItem = courseItem;
      Core_State_Set("inventory", ["assignment", "selectedCourse"], course);
      UI_Element_Find(container, "item-detail").style.visibility = "hidden";
      onClickCourse && onClickCourse(course["id"]);
    };
    courseListContainer.appendChild(courseItem);
  });
}

async function showItemsForAssigning() {
  const { container, items_users } = Core_State_Get("inventory", [
    "assignment",
  ]);
  Core_State_Set("inventory", "inventory-table-header", [
    UI_Language_String("inventory/module", "table item code"),
    UI_Language_String("inventory/module", "table item name"),
    UI_Language_String("inventory/module", "table in store"),
  ]);
  const data = items_users["items"] || [];

  const itemsContainer = UI_Element_Find(container, "item-list-container");
  itemsContainer.style.visibility = "visible";
  itemsContainer.innerHTML = "";

  const table = UI_Table("standard", { fixed: true });
  itemsContainer.appendChild(table);
  const headerRow = UI_Table_Row(table);

  var header = Core_State_Get("inventory", "inventory-table-header");
  header.forEach((item) => {
    const cell = UI_Table_Cell(headerRow, { type: "header" });
    cell.innerHTML = item;
  });

  if (data && data.length > 0) {
    for (let i = 0; i < data.length; i++) {
      const { item_name = "", available = "", item_code } = data[i];
      const row = UI_Table_Row(table, { selectable: true }, onItemClick);
      row.id = i;
      row.dataset.data = data[i];
      const itemCodeCell = UI_Table_Cell(row);
      itemCodeCell.innerHTML = item_code;
      const bookNameCell = UI_Table_Cell(row);
      bookNameCell.innerHTML = item_name;
      const instoreCell = UI_Table_Cell(row);
      instoreCell.innerHTML = available;
    }
  } else {
    const row = UI_Table_Row(table);
    const messageCell = UI_Table_Cell(row);
    messageCell.colSpan = header.length;
    messageCell.style.height = "300px";
    messageCell.innerText = UI_Language_String(
      "inventory/module",
      "table no item"
    );
  }
}

async function showItemsForReturning() {
  const { container, items_users, takebackStudent } = Core_State_Get(
    "inventory",
    ["assignment"]
  );
  Core_State_Set("inventory", "inventory-table-header", [
    UI_Language_String("inventory/module", "table item code"),
    UI_Language_String("inventory/module", "table item name"),
    UI_Language_String("inventory/module", "table take back"),
  ]);
  const data = items_users["items"] || [];
  const assignedUser = items_users["assignedUser"];

  const detailContainer = UI_Element_Find(container, "item-detail");
  const actionContainer = UI_Element_Find(detailContainer, "actions-detail");
  const inforElement = UI_Element_Find(detailContainer, "item-info");

  detailContainer.style.visibility = "visible";
  inforElement.innerHTML = "";

  const table = UI_Table("standard", { fixed: true });
  inforElement.appendChild(table);

  const headerRow = UI_Table_Row(table);
  var header = Core_State_Get("inventory", "inventory-table-header");
  header.forEach((item) => {
    const cell = UI_Table_Cell(headerRow, { type: "header" });
    cell.innerHTML = item;
  });

  const selectedItems = [];
  if (takebackStudent && data && data.length > 0) {
    for (let i = 0; i < data.length; i++) {
      const { item_name = "", item_code } = data[i];
      if (assignedUser[`${takebackStudent["id"]}`]?.[item_code]) {
        selectedItems.push(item_code);
        const row = UI_Table_Row(table, { selectable: false });
        row.id = item_code;
        row.dataset.data = data[i];
        const itemCodeCell = UI_Table_Cell(row);
        itemCodeCell.innerHTML = item_code;
        const bookNameCell = UI_Table_Cell(row);
        bookNameCell.innerHTML = item_name;
        const checkBoxCell = UI_Table_Cell(row);
        const checkbox = UI_Element_Create(
          "inventory/components/input-checkbox"
        );
        checkbox.onchange = (event) => {
          const value = event.target.checked;
          const itemCode = event.target.parentElement.parentElement.id;
          let selectItems =
            Core_State_Get("inventory", ["assignment", "takebackItems"]) || [];
          if (value) {
            selectItems.push(itemCode);
          } else {
            selectItems = selectItems.filter((item) => item != itemCode);
          }
          Core_State_Set(
            "inventory",
            ["assignment", "takebackItems"],
            selectItems
          );
        };
        checkBoxCell.appendChild(checkbox);
      }
    }
  }

  if (selectedItems.length == 0) {
    const row = UI_Table_Row(table);
    const messageCell = UI_Table_Cell(row);
    messageCell.colSpan = header.length;
    messageCell.style.height = "300px";
    messageCell.innerText = UI_Language_String(
      "inventory/module",
      "table no item"
    );

    // hide buttons
    actionContainer.style.display = "none";
  } else {
    // show buttons
    actionContainer.style.display = "flex";
  }
}

function onItemClick(event) {
  const idx = event.target.parentElement.id;
  Core_State_Set("inventory", ["assignment", "selectItemIdx"], idx);

  showStudentsForAssigning();
}

async function showStudentsForReturning() {
  const { container, items_users } = Core_State_Get("inventory", [
    "assignment",
  ]);
  const students = items_users["users"] || [];

  const itemListContainer = UI_Element_Find(container, "item-list-container");
  itemListContainer.innerHTML = "";
  itemListContainer.style.visibility = "visible";

  const table = createStudentTable(students, {
    onClickRow: (student, index) => {
      Core_State_Set("inventory", ["assignment", "takebackStudent"], student);
      showItemsForReturning();
    },
  });

  itemListContainer.appendChild(table);
}

async function showStudentsForAssigning() {
  Core_State_Set("inventory", ["assignment", "selectStudents"], []);

  const { container, items_users, selectItemIdx } = Core_State_Get(
    "inventory",
    ["assignment"]
  );
  const currentItem = items_users["items"][selectItemIdx];
  const students = items_users["users"];

  const detailContainer = UI_Element_Find(container, "item-detail");
  detailContainer.style.visibility = "visible";
  const inforElement = UI_Element_Find(detailContainer, "item-info");
  inforElement.innerHTML = "";

  const table = createStudentTable(students, {
    showCheckBox: true,
    onHandleCheckBox: (checkbox, item) => {
      if (
        items_users["assignedUser"]?.[
          `${currentItem["item_code"]}-${item["id"]}`
        ]
      ) {
        checkbox.checked = true;
        checkbox.disabled = true;
      }
      if (currentItem["available"] == 0) checkbox.disabled = true;
    },
  });
  inforElement.appendChild(table);

  const actionContainer = UI_Element_Find(detailContainer, "actions-detail");
  actionContainer.style.display =
    students && students.length > 0 ? "flex" : "none";

  if (currentItem["available"] == 0) {
    UI_Element_Find(actionContainer, "btn-action").classList.add(
      "style-disabled"
    );
  } else {
    UI_Element_Find(actionContainer, "btn-action").classList.remove(
      "style-disabled"
    );
  }
}

function createStudentTable(
  students,
  { showCheckBox = false, onHandleCheckBox, onClickRow } = {}
) {
  const table = UI_Table("standard", { fixed: true });

  const headerRow = UI_Table_Row(table);
  headerRow.style.position = "sticky";
  headerRow.style.top = 0;
  // CREATE TABLE HEADER
  var header = [
    UI_Language_String("inventory/module", "table no"),
    UI_Language_String("inventory/module", "table student"),
  ];
  header.forEach((item) => {
    const cell = UI_Table_Cell(headerRow, { type: "header" });
    cell.innerHTML = item;
  });

  if (showCheckBox) {
    let checkall = UI_Element_Create("inventory/components/input-checkbox");
    checkall.onchange = onCheckAllStudent;
    UI_Table_Cell(headerRow, { type: "header" }).appendChild(checkall);
  }

  if (students && students.length > 0) {
    for (let i = 0; i < students.length; i++) {
      const { firstname, lastname, id } = students[i];
      const row = UI_Table_Row(table, { selectable: onClickRow || false }, () =>
        onClickRow(students[i], i)
      );
      row.id = id;
      const noCell = UI_Table_Cell(row);
      noCell.innerHTML = i + 1;
      const nameCell = UI_Table_Cell(row);
      nameCell.innerHTML = `${firstname || ""} ${lastname || ""}`;

      if (showCheckBox) {
        const checkBoxCell = UI_Table_Cell(row);
        const checkbox = UI_Element_Create(
          "inventory/components/input-checkbox"
        );
        onHandleCheckBox && onHandleCheckBox(checkbox, students[i]);
        checkbox.onchange = onCheckStudent;
        checkBoxCell.appendChild(checkbox);
      }
    }
  } else {
    const row = UI_Table_Row(table);
    const messageCell = UI_Table_Cell(row);
    messageCell.colSpan = 3;
    messageCell.style.height = "300px";
    messageCell.innerText = "No students";
  }
  return table;
}

function onCheckStudent(event) {
  const value = event.target.checked;
  const id = event.target.parentElement.parentElement.id;
  let selectStudents =
    Core_State_Get("inventory", ["assignment", "selectStudents"]) || [];
  if (value) {
    selectStudents.push(id);
  } else {
    selectStudents = selectStudents.filter((item) => item != id);
  }
  Core_State_Set("inventory", ["assignment", "selectStudents"], selectStudents);
}

function onCheckAllStudent(e) {
  const value = e.target.checked;
  const table = e.target.parentElement.parentElement.parentElement;
  var listcheckbox = table.querySelectorAll("input[type=checkbox]");
  var firstcheck = 1;
  listcheckbox.forEach((element) => {
    if (firstcheck) {
      firstcheck = 0;
    } else if (value && !element.checked) element.click();
    else if (!value && element.checked) element.click();
  });
}
async function openPopupRequest() {
  const popupContent = UI_Element_Create("inventory/popup-approve", {
    title: UI_Language_String("inventory/module", "approve-popup-title"),
  });
  const headers = UI_Element_Find(popupContent, "headers");
  const itemList = UI_Element_Find(popupContent, "requests");
  const table = UI_Element_Find(popupContent, "table");
  const tbody = UI_Element_Find(popupContent, "tbody");
  const approvePopup = await UI_Popup_Create(
    {
      content: popupContent,
    },
    [],
    ""
  );

  const data =
    (await Core_Api("Inventory_Get_Requests", {
      centercode: Core_State_Get("inventory", "center"),
    })) || [];

  if (data && data.length > 0) {
    headers.style.visibility = "visible";
    data.forEach((item, index) => {
      const element = createListItem(item, index);
      tbody.appendChild(element);
    });
  } else {
    itemList.innerHTML = "No item requests";
    itemList.style.marginTop = "100px";
  }
}

function createListItem(item, index) {
  const itemView = UI_Element_Create("inventory/request-list-item", {
    no: index + 1,
    id: item["id"],
    name: item["item_name"],
    itemcode: item["item_code"],
    fromcenter: item["from_center"],
    status: item["status"],
    quantity: item["quantity"],
    btnAccept: "Accept",
    btnReject: "Reject",
  });

  // const btnAccept = UI_Element_Find(itemView, "btn-accept");
  // btnAccept.onclick = onClickAccept;

  // const btnReject = UI_Element_Find(itemView, "btn-reject");
  // btnReject.onclick = onClickReject;
  return itemView;
}

async function onClickReject(event) {
  const id = event.target.parentElement["id"];
  const { error } = await onUpdateStatus(id, "rejected");

  if (error) {
    showAlertMessage(error, "error");
    return;
  }

  showAlertMessage("Reject successfully");
  const statusElement = UI_Element_Find(event.target.parentElement, "status");
  statusElement.innerHTML = "rejected";
}

async function onClickAccept(event) {
  const id = event.target.parentElement["id"];

  const { error } = await onUpdateStatus(id, "accepted");
  if (error) {
    showAlertMessage(error, "error");
    return;
  }

  showAlertMessage("Accpet successfully");
  const statusElement = UI_Element_Find(event.target.parentElement, "status");
  statusElement.innerHTML = "accepted";
}

async function onUpdateStatus(id, status) {
  return await Core_Api("Inventory_Update_Transfer_Request", {
    id,
    fields: {
      status,
    },
  });
}
async function showPopupConfirm(title, content, popupData = {}) {
  // Initial UI
  const popupContent = UI_Element_Create(
    "inventory/popup-confirm/popup-confirm",
    {
      title: title,
    }
  );
  UI_Element_Find(popupContent, "content").innerText = content;

  const errorMessage = UI_Element_Find(popupContent, "errorMessage");

  const loading = document.createElement("div");
  loading.classList.add("loader");
  loading.style = "font-size: 4px; margin-left: 25px; margin-right: 10px";

  const continueBtn = UI_Element_Create("core/button-small-plain", {
    text: UI_Language_String("inventory/module", "button continue"),
  });
  UI_Element_Find(popupContent, "buttonContainer").appendChild(continueBtn);

  const popup = await UI_Popup_Create({ content: popupContent }, [], "");

  let state;
  // Register click events
  continueBtn.onclick = async () => {
    try {
      if (state == "requesting") return;

      // Show loading
      continueBtn.classList.add("style-disabled");
      continueBtn.appendChild(loading);

      state = "requesting";
      const { id, status } = popupData;
      const { error, data } = await UpdateRequestStatus(id, status);

      // Remove loading
      state = "done";
      continueBtn.classList.remove("style-disabled");
      continueBtn.removeChild(loading);

      if (data) {
        UI_Popup_Close(popup);
        return;
      }

      if (error) {
        errorMessage.innerText = error;
        continueBtn.innerText = "Try Again";
      }
    } catch (error) {
      continueBtn.removeChild(loading);
      state = "done";
    }
  };
}

async function showPopupConfirmX(title, content, options = {}) {
  // Initial UI
  const popupContent = UI_Element_Create(
    "inventory/popup-confirm/popup-confirm",
    {
      title: title,
    }
  );
  UI_Element_Find(popupContent, "content").innerText = content;

  const errorMessage = UI_Element_Find(popupContent, "errorMessage");

  const loading = document.createElement("div");
  loading.classList.add("loader");
  loading.style = "font-size: 4px; margin-left: 25px; margin-right: 10px";

  const continueBtn = UI_Element_Create("core/button-small-plain", {
    text: UI_Language_String("inventory/module", "button continue"),
  });
  UI_Element_Find(popupContent, "buttonContainer").appendChild(continueBtn);

  const popup = await UI_Popup_Create({ content: popupContent }, [], "");

  const { onFailure, action, onSuccess } = options;

  let state;
  // Register click events
  continueBtn.onclick = async () => {
    try {
      if (state == "requesting") return;

      // Show loading
      continueBtn.classList.add("style-disabled");
      continueBtn.appendChild(loading);

      state = "requesting";

      const { error, data } = await action();
      // Remove loading
      state = "done";
      continueBtn.classList.remove("style-disabled");
      continueBtn.removeChild(loading);

      if (data) {
        onSuccess && onSuccess(data);
      } else if (error) {
        errorMessage.innerText = onFailure ? onFailure(error) : error;
        continueBtn.innerText = "Try Again";
      }
    } catch (error) {
      // continueBtn.hasChildNodes() && continueBtn.removeChild(loading);
      state = "done";
    }
  };

  return { popup, continueBtn , messageText: errorMessage };
}
let dataTable;
let searchData;

function resetTransferState() {
  searchData = null;
  dataTable = null;
}

async function openPopupTransfer() {
  var header = [
    UI_Language_String("inventory/module", "table no"),
    UI_Language_String("inventory/components/module", "search centers"),
    UI_Language_String("inventory/module", "table in store"),
    UI_Language_String("inventory/module", "table need"),
  ];
  const popupContent = UI_Element_Create("inventory/popup-transfer/popup", {
    title: UI_Language_String("inventory/module", "transfer-popup-title"),
    "btn-request": UI_Language_String("inventory/module", "button-request"),
  });

  const edtCenter = UI_Element_Find(popupContent, "edt-center");
  edtCenter.placeholder = "Search center";
  edtCenter.onchange = onSearchCenter;
  const btnRequest = UI_Element_Find(popupContent, "btn-request");
  btnRequest.onclick = onRequest;
  btnRequest.style.width = "auto";
  btnRequest.style.minWidth = "96px";

  // CREATE RESULT TABLE
  const tableContainer = UI_Element_Find(popupContent, "table-result");
  dataTable = UI_Table("standard", { fixed: true });
  tableContainer.appendChild(dataTable);

  const headerRow = UI_Table_Row(dataTable);
  header.forEach((item) => {
    const cell = UI_Table_Cell(headerRow, { type: "header" });
    cell.innerHTML = item;
  });

  updateTableData("");

  const popup = await UI_Popup_Create(
    {
      content: popupContent,
    },
    [],
    "",
    {
      open: true,
      escape: async () => {
        resetTransferState();
        UI_Popup_Close(popup);
      },
    }
  );
}

async function onSearchCenter(e) {
  searchData = [];
  const { items, selectedItemIdx, center } = Core_State_Get("inventory", [
    "warehouse",
  ]);
  const centers = Core_Config("centers");
  const searchValue = removeAccents(e.currentTarget.value.toLowerCase());
  if (!searchValue) return;
  const searchResult = Object.keys(centers).filter(
    (key) =>
      centers[key]["name"].toLowerCase().includes(searchValue) && key !== center
  );

  if (searchResult && searchResult.length > 0) {
    searchData = await Core_Api("Inventory_Load_byCenter", {
      centers: searchResult,
      options: {
        item_code: items[selectedItemIdx]["item_code"],
      },
    });
  }
  updateTableData(searchData);
}

function updateTableData(data) {
  const rows = dataTable.rows.length;
  for (let i = 1; i < rows; i++) {
    dataTable.deleteRow(i);
  }
  if (data && data.length > 0) {
    const centers = Core_Config("centers");
    data.forEach((item, index) => {
      const { available, center_code } = item;
      if (available > 0) {
        const row = UI_Table_Row(dataTable);
        const noCell = UI_Table_Cell(row);
        noCell.innerHTML = index + 1;
        const nameCell = UI_Table_Cell(row);
        nameCell.innerHTML = centers[center_code]["name"] || "";
        const instoreCell = UI_Table_Cell(row);
        instoreCell.innerHTML = available;
        const needCell = UI_Table_Cell(row);
        const edtNeedNumber = UI_Element_Create("core/control-edit-plain");
        edtNeedNumber.style.width = "80px";
        edtNeedNumber.type = "number";
        edtNeedNumber.min = 0;
        edtNeedNumber.onchange = (e) => onChangeQuantity(index, e);
        needCell.appendChild(edtNeedNumber);
      }
    });
  } else {
    const row = UI_Table_Row(dataTable);
    const messageCell = UI_Table_Cell(row);
    messageCell.colSpan = 4;
    messageCell.innerText = UI_Language_String(
      "inventory/module",
      "table no item"
    );
  }
}

function onChangeQuantity(index, e) {
  const { available } = searchData[index];
  const quantity = e.target.value;
  if (quantity > available) {
    showAlertMessage(
      UI_Language_String("inventory/module", "alert not enough quantity"),
      "error"
    );
  }
  searchData[index]["needNum"] = Number(quantity);
}

async function onRequest() {
  if (!searchData || searchData.length == 0) {
    showAlertMessage(
      UI_Language_String("inventory/module", "alert search center"),
      "info"
    );
    return;
  }

  // verfiy the amount of quantity for each center
  for (let item of searchData) {
    const { needNum, available } = item;
    if (needNum > available) {
      showAlertMessage(
        UI_Language_String("inventory/module", "alert not enough quantity"),
        "error"
      );
      return;
    }
  }

  const isAccept = await UI_Popup_Confirm(
    UI_Language_String("inventory/module", "popup confirm request"),
    UI_Language_String("inventory/module", "popup confirm text request")
  );
  if (!isAccept) return;

  const items = searchData.filter((item) => item["needNum"]);
  if (items) {
    const { center } = Core_State_Get("inventory", "warehouse");
    const data = items.map(({ item_code, center_code, needNum }) => ({
      item_code,
      from_center: center,
      to_center: center_code,
      quantity: needNum,
    }));

    const res = await Core_Api("Inventory_Create_Transfer_Requests", {
      data,
    });

    if (res && res.length) {
      showAlertMessage(
        UI_Language_String("inventory/module", "alert request") +
          " " +
          UI_Language_String("inventory/module", "alert success")
      );
    }
  }
}
function Inventory_Warehouse_History() {
  Core_State_Set("inventory", "inventory-table-header", [
    UI_Language_String("inventory/module", "table no"),
    UI_Language_String("inventory/components/module", "search centers"),
    UI_Language_String("inventory/module", "table item code"),
    UI_Language_String("inventory/module", "table item name"),
    UI_Language_String("inventory/module", "table in store"),
    UI_Language_String("inventory/module", "table request"),
    UI_Language_String("inventory/module", "table status"),
  ]);
  Core_State_Set("inventory", ["warehouse", "center-options"], "from");
  //HIDE DETAIL
  if (typeof itemDetailContainer !== "undefined")
    itemDetailContainer.style.display = "none";
  showTransferTable();
}

async function showTransferTable() {
  var module = Core_State_Get("inventory", "container");
  var itemListContainer = UI_Element_Find(module, "item-list-container");
  itemListContainer.style.visibility = "visible";
  itemListContainer.style.display = "flex";
  itemListContainer.innerHTML = "";
  const table = UI_Table("standard", { fixed: true });
  itemListContainer.appendChild(table);
  const headerRow = UI_Table_Row(table);

  // CREATE TABLE HEADER
  var header = Core_State_Get("inventory", "inventory-table-header");
  header.forEach((item) => {
    const cell = UI_Table_Cell(headerRow, { type: "header" });
    cell.innerHTML = item;
  });

  var options = Core_State_Get("inventory", ["warehouse", "center-options"]);
  const data =
    (await Core_Api("Inventory_Request_Search", {
      center_code: Core_State_Get("inventory", ["warehouse", "center"]),
      item_group: Core_State_Get("inventory", ["warehouse", "group"]),
      program: Core_State_Get("inventory", ["warehouse", "program"]),
      level: Core_State_Get("inventory", ["warehouse", "level"]),
      options: options,
    })) || [];

  if (data && data.length > 0) {
    for (let i = 0; i < data.length; i++) {
      //CHECK IS HISTORY OR REQUEST PENDING
      if (
        options == "from" ||
        (options == "to" && data[i].status == "pending")
      ) {
        const {
          id = "",
          item_name = "",
          available = "",
          item_code = "",
          from_center = "",
          to_center = "",
          status = "",
          quantity = "",
        } = data[i];
        const row = UI_Table_Row(table);
        const noCell = UI_Table_Cell(row);
        noCell.innerHTML = i + 1;
        var centerCell = UI_Table_Cell(row);
        if (options == "from") {
          centerCell.innerHTML = to_center;
        } else centerCell.innerHTML = from_center;
        var itemCodeCell = UI_Table_Cell(row);
        itemCodeCell.innerHTML = item_code;
        var itemNameCell = UI_Table_Cell(row);
        itemNameCell.innerHTML = item_name;
        var instore = UI_Table_Cell(row);
        instore.innerHTML = available;
        var request = UI_Table_Cell(row);
        request.innerHTML = quantity;
        var statusCell = UI_Table_Cell(row);
        var statusContainer = UI_Element_Create(
          "inventory/components/request-status"
        );
        if (status == "pending") {
          if (options == "from") {
            var textStatus = UI_Element_Create("core/text-caption-medium", {
              text: "Requesting",
            });
            statusContainer.appendChild(textStatus);
            var btnCancel = UI_Element_Create("core/button-small-stretch", {
              text: UI_Language_String("inventory/module", "button-cancel"),
            });
            btnCancel.dataset.id = id;
            btnCancel.onclick = CancelRequest;
            statusContainer.appendChild(btnCancel);
            statusCell.appendChild(statusContainer);
          } else {
            var btnAccept = UI_Element_Create("core/button-small-stretch", {
              text: UI_Language_String("inventory/module", "button-accept"),
            });
            btnAccept.dataset.id = id;
            btnAccept.dataset.quantity = quantity;
            btnAccept.onclick = AcceptRequest;
            statusContainer.appendChild(btnAccept);
            var btnReject = UI_Element_Create("core/button-small-stretch", {
              text: UI_Language_String("inventory/module", "button-reject"),
            });
            btnReject.dataset.id = id;
            btnReject.onclick = RejectRequest;
            statusContainer.appendChild(btnReject);
            statusCell.appendChild(statusContainer);
          }
        } else statusCell.innerHTML = status;
      }
    }
  } else {
    const row = UI_Table_Row(table);
    const messageCell = UI_Table_Cell(row);
    messageCell.colSpan = header.length;
    messageCell.style.height = "300px";
    messageCell.innerText = UI_Language_String(
      "inventory/module",
      "table no item"
    );
  }
}

async function CancelRequest(e) {
  Core_State_Set("inventory", ["warehouse", "status-update"], "canceled");
  await showPopupConfirm(
    UI_Language_String("inventory/module", "popup confirm", {
      text: UI_Language_String("inventory/module", "button-cancel"),
    }),
    UI_Language_String("inventory/module", "popup confirm text", {
      text: UI_Language_String("inventory/module", "button-cancel"),
    }),
    {
      id: e.target.dataset.id,
      status: "canceled",
    }
  );
}
function Inventory_Warehouse_Waiting() {
  Core_State_Set("inventory", "inventory-table-header", [
    UI_Language_String("inventory/module", "table no"),
    UI_Language_String("inventory/components/module", "search centers"),
    UI_Language_String("inventory/module", "table item code"),
    UI_Language_String("inventory/module", "table item name"),
    UI_Language_String("inventory/module", "table in store"),
    UI_Language_String("inventory/module", "table request"),
    UI_Language_String("inventory/module", "table status"),
  ]);
  Core_State_Set("inventory", ["warehouse", "center-options"], "to");

  showTransferTable();

  //HIDE DETAIL
  if (typeof itemDetailContainer !== "undefined")
    itemDetailContainer.style.display = "none";
}

async function AcceptRequest(e) {
  await showPopupConfirm(
    UI_Language_String("inventory/module", "popup confirm", {
      text: UI_Language_String("inventory/module", "button-accept"),
    }),
    UI_Language_String("inventory/module", "popup confirm text", {
      text: UI_Language_String("inventory/module", "button-accept"),
    }),
    {
      id: e.target.dataset.id,
      status: "accepted",
    }
  );
}

async function RejectRequest(e) {
  await showPopupConfirm(
    UI_Language_String("inventory/module", "popup confirm", {
      text: UI_Language_String("inventory/module", "button-reject"),
    }),
    UI_Language_String("inventory/module", "popup confirm text", {
      text: UI_Language_String("inventory/module", "button-reject"),
    }),
    {
      id: e.target.dataset.id,
      status: "rejected",
    }
  );
}
async function Inventory_Warehouse() {
  const inventoryContainer = Core_State_Get("inventory", "container");

  const warehousePage = UI_Element_Find(
    inventoryContainer,
    "warehouse-container"
  );
  Core_State_Set("inventory", ["warehouse", "container"], warehousePage);

  const itemsContainer = UI_Element_Create(
    "inventory/components/inventory-list"
  );

  const itemDetailContainer = UI_Element_Create(
    "inventory/components/inventory-detail",
    {
      btnAction: UI_Language_String(
        "inventory/module",
        "button request transfer"
      ),
    }
  );

  UI_Element_Find(itemDetailContainer, "btn-action").onclick =
    openPopupTransfer;

  UI_Element_Find(itemDetailContainer, "btn-export").style.display = "none";

  let groupPrograms = Core_State_Get("inventory", "groupPrograms");

  if (!groupPrograms) {
    groupPrograms = await generateProgramGroup();
  }
  const searchElement = createSearchElement("warehouse", {
    onSearch: (e) => {btnClicked(e,"warehouse"); showWareHouseItems();},
    programData: groupPrograms,
  });

  const actions = UI_Element_Create("inventory/warehouse/search-actions", {
    btnHistory: UI_Language_String("inventory/module", "button history"),
    btnAccept: UI_Language_String("inventory/module", "button request"),
  });

  UI_Element_Find(actions, "btnAccept").onclick = (e) => {
    btnClicked(e,"warehouse");
    itemDetailContainer.style.display = "none";
    Inventory_Warehouse_Waiting();
  };
  UI_Element_Find(actions, "btnHistory").onclick = (e) => {
    btnClicked(e,"warehouse");
    itemDetailContainer.style.display = "none";

    Inventory_Warehouse_History();
  };

  const exportButton = UI_Element_Create("core/button-small-stretch",{text:UI_Language_String("inventory/components/module","button export")});
  exportButton.onclick = (e) => { exportExecl(e);}
  Document_Element_SetObject(exportButton, "state", "warehouse");
  
  const loadDataButton = UI_Element_Create("core/button-small-stretch",{text:UI_Language_String("inventory/components/module","button load D365")});
  loadDataButton.onclick = async (e) => {
    var centerMapping = Core_Config("centers-mapping");
    var center = UI_Element_Find(searchElement,"search-centers").value;
    var warehouseCode = centerMapping[center]["warehourse-code"];
    var div = document.createElement("div");
    div.classList.add("loader");
    div.style.cssText = " font-size: 4px; position: absolute; margin-left: 200px";
    loadDataButton.appendChild(div);
    
    var updateStatus = await Core_Api("Inventory_Create_Update_FromD365&filter=true&center="+ warehouseCode);
    if(updateStatus)
    {
      loadDataButton.removeChild(loadDataButton.firstElementChild);
      showWareHouseItems();
      showAlertMessage("Data has been updated");
    }
    else showAlertMessage("No Data has been updated!!");
  }
  // ADD ACTIONS
  const actionsContainer = UI_Element_Find(searchElement, "action-container");
  actionsContainer.appendChild(actions);
  actionsContainer.appendChild(exportButton);
  actionsContainer.appendChild(loadDataButton);

  warehousePage.appendChild(searchElement);
  warehousePage.appendChild(itemsContainer);
  warehousePage.appendChild(itemDetailContainer);
}

async function showWareHouseItems() {
  const { container, center, group, program, level } = Core_State_Get(
    "inventory",
    ["warehouse"]
  );

  Core_State_Set("inventory", "inventory-table-header",[
    UI_Language_String("inventory/module", "table no"),
    UI_Language_String("inventory/module", "table item code"),
    UI_Language_String("inventory/module", "table item name"),
    UI_Language_String("inventory/module", "table in store"),
    UI_Language_String("inventory/module", "table in order"),
  ]);
  
  UI_Element_Find(container, "item-detail").style.display = "flex";
  UI_Element_Find(container, "item-detail").style.visibility = "hidden";

  const data = await Core_Api("Inventory_Load_byCenter", {
    centers: [center],
    options: {
      group: group,
      program: program,
      level: level,
    },
  });

  Core_State_Set("inventory", ["warehouse", "items"], data);

  const itemsContainer = UI_Element_Find(container, "item-list-container");
  itemsContainer.style.visibility = "visible";
  itemsContainer.innerHTML = "";

  const table = UI_Table("standard", { fixed: true });
  itemsContainer.appendChild(table);
  const headerRow = UI_Table_Row(table);
  var header = Core_State_Get("inventory", "inventory-table-header");
  header.forEach((item) => {
    const cell = UI_Table_Cell(headerRow, { type: "header" });
    cell.innerHTML = item;
  });

  if (data && data.length > 0) {
    for (let i = 0; i < data.length; i++) {
      const { item_name = "", available = "", item_code, on_order } = data[i];
      const row = UI_Table_Row(table, { selectable: true }, () => {
        onClickItem(i);
      });
      const noCell = UI_Table_Cell(row);
      noCell.innerHTML = i + 1;
      const itemCodeCell = UI_Table_Cell(row);
      itemCodeCell.innerHTML = item_code;
      const bookNameCell = UI_Table_Cell(row);
      bookNameCell.innerHTML = item_name;
      const instoreCell = UI_Table_Cell(row);
      instoreCell.innerHTML = available;
      const inOrderCell = UI_Table_Cell(row);
      inOrderCell.innerHTML = on_order;
    }
  } else {
    const row = UI_Table_Row(table);
    const messageCell = UI_Table_Cell(row);
    messageCell.colSpan = 5;
    messageCell.style.height = "300px";
    messageCell.innerText =  UI_Language_String("inventory/module", "table no item");
  }
}

function onClickItem(index) {
  Core_State_Set("inventory", ["warehouse", "selectedItemIdx"], index);
  const item = Core_State_Get("inventory", ["warehouse", "items"])[index];
  const { available, item_name, item_code, on_order } = item || {};

  const warehouseContainer = Core_State_Get("inventory", [
    "warehouse",
    "container",
  ]);

  const detailContainer = UI_Element_Find(warehouseContainer, "item-detail");
  detailContainer.style.visibility = "visible";

  const itemInfoContainer = UI_Element_Find(detailContainer, "item-info");
  itemInfoContainer.innerHTML = "";

  [
    {
      title: UI_Language_String("inventory/module", "table item code"),
      value: item_code,
    },
    {
      title: UI_Language_String("inventory/module", "table item name"),
      value: item_name,
    },
    {
      title: UI_Language_String("inventory/module", "table in store"),
      value: available || "_",
    },
    {
      title: UI_Language_String("inventory/module", "table in order"),
      value: on_order || "_",
    },
  ].forEach((item) => {
    const nameItem = UI_Element_Create(
      "inventory/warehouse/inventory-list-item",
      {
        label: item.title,
        desc: item.value,
      }
    );
    itemInfoContainer.appendChild(nameItem);
  });
}
